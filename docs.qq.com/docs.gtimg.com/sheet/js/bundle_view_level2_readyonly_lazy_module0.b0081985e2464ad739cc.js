self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["bundle_view_level2_readyonly_lazy_module0"],{"../spread-sheet/src/base/util/browser.ts":function(e,t,n){n.d(t,{j7:function(){return l},kw:function(){return s},r9:function(){return a}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js");var o=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),r=n.n(o),i=(n("../spread-sheet/src/base/util/timer.ts"),n("../packages/common-utils/src/index.ts"));function s(){return(r().isTencentDocsApp?document.body.offsetWidth:Math.min(window.innerWidth,document.body.offsetWidth))>=640}function a(){var e=(0,i.gr)()?window.screen.width:window.screen.height,t=window.innerWidth/e;return t<.4?.33:t>=.4&&t<.6?.5:t>=.6&&t<.9?.66:1}function l(){if(r().isIE){var e=window.screen;return e.deviceXDPI&&e.logicalXDPI?e.deviceXDPI/e.logicalXDPI*100:100}if(r().isFirefox)return 100;if(r().isChrome){var t=window.outerWidth/window.innerWidth;return r().isWindows&&Math.round(100*t)>95&&Math.round(100*t)<105&&(t=1),Math.round(100*t)}if(r().isSafari)return Math.round(window.outerWidth/window.innerWidth*100);var n=1;if(void 0!==window.devicePixelRatio&&(n=window.devicePixelRatio),void 0!==window.outerWidth&&void 0!==window.innerWidth){var o=window.outerWidth/window.innerWidth;100!==Math.round(100*o)&&0!==window.outerWidth||(n=1)}return Math.round(100*n)}},"../spread-sheet/src/base/util/decorator/loading-decorator.ts":function(e,t,n){n.d(t,{n:function(){return r}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.concat.js");var o=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};function r(){return function(e,t,r){var i=r.value;r.value=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var s,a;return o(this,void 0,void 0,regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(s=n.g.snackLoading)||void 0===s||s.show(3e3),e.next=3,i.call.apply(i,[this].concat(t));case 3:return o=e.sent,null===(a=n.g.snackLoading)||void 0===a||a.hide(),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})))}}}},"../spread-sheet/src/base/util/phone-number.ts":function(e,t,n){n.d(t,{AI:function(){return l},E$:function(){return m},Iq:function(){return i},YH:function(){return p},un:function(){return u}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.object.values.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/esnext.global-this.js"),n("../node_modules/core-js/modules/es.number.constructor.js");var o=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),r=n.n(o),i={"ar-DZ":"^(\\+?213|0)(5|6|7)\\d{8}$","ar-SY":"^(!?(\\+?963)|0)9\\d{8}$","ar-SA":"^(!?(\\+?966)|0)5\\d{8}$","en-US":"^(\\+?1)[2-9]\\d{2}[2-9](?!11)\\d{6}$","cs-CZ":"^(\\+?420)[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$","de-DE":"^(\\+?0{0,2}49[\\-]?)([0-9]{10,11})$","da-DK":"^(\\+?45)(\\d{8})$","el-GR":"^(\\+?30)(69\\d{8})$","en-AU":"^(\\+?61|0)4\\d{8}$","en-GB":"^(\\+?44|0)7\\d{9}$","en-HK":"^(\\+?852\\-?)[569]\\d{3}\\-?\\d{4}$","en-IN":"^(\\+?91|0)[789]\\d{9}$","en-NZ":"^(\\+?64|0)2\\d{7,9}$","en-ZA":"^(\\+?27|0)\\d{9}$","en-ZM":"^(\\+?26)09[567]\\d{7}$","es-ES":"^(\\+?34)(6\\d{1}|7[1234])\\d{7}$","fi-FI":"^(\\+?358|0)\\s(4(0|1|2|4|5)?|50)\\s?(\\d\\s?){4,8}\\d$","fr-FR":"^(\\+?33|0)[67]\\d{8}$","he-IL":"^(\\+972|0)([23489]|5[0248]|77)[1-9]\\d{6}","hu-HU":"^(\\+?36)(20|30|70)\\d{7}$","it-IT":"^(\\+?39)\\s?3\\d{2} ?\\d{6,7}$","ja-JP":"^(\\+?81|0)\\d{1,4}[ \\-]?\\d{1,4}[ \\-]?\\d{4}$","ms-MY":"^(\\+?6?01){1}(([145]{1}(\\-|\\s)?\\d{7,8})|([236789]{1}(\\s|\\-)?\\d{7}))$","nb-NO":"^(\\+?47)[49]\\d{7}$","nl-BE":"^(\\+?32|0)4\\d{8}$","nn-NO":"^(\\+?47)[49]\\d{7}$","pl-PL":"^(\\+?48)[5-8]\\d ?\\d{3} ?\\d{2} ?\\d{2}$","pt-BR":"^(\\+?55|0)\\-?[1-9]{2}\\-?[2-9]{1}\\d{3,4}\\-?\\d{4}$","pt-PT":"^(\\+?351)9[1236]\\d{7}$","ru-RU":"^(\\+?7|8)9\\d{9}$","sr-RS":"^(\\+3816|06)[- \\d]{5,9}$","tr-TR":"^(\\+?90|0)5\\d{9}$","vi-VN":"^(\\+?84|0)((1(2([0-9])|6([2-9])|88|99))|(9((?!5)[0-9])))([0-9]{7})$","zh-CN":"^(\\+?0?86\\-?)?((13[0-9])|(14[5-9])|(15([0-3]|[5-9]))|(16[6-7])|(17[1-8])|(18[0-9])|(19[1|3])|(19[5|6])|(19[8|9]))\\d{8}$","zh-TW":"^(\\+?886\\-?|0)9\\d{8}$"},s={"zh-CN":{regExp:"^([\\(（]?\\+?0?0?\\d{2,3}[\\)）]?[- ]?)?([\\(（]?0?\\d{2,3}[\\)）]?[- ]?)?([2-8]\\d{2,3}[- ]?\\d{4})((-|转|,| )(\\d+))?$",getExtIndex:function(e){var t=e.split("-");if(2===t.length&&7===t[0].length&&4===t[1].length)return e.lastIndexOf("-");var n=e.replace(this.regExp,"$4");return n?e.lastIndexOf(n):void 0}}},a=[110,119,120,122,999,112,114,1e4,10010,10011,10060,10086,11185,12300,12310,12315,12319,12333,12345,12348,12358,12365,12365,12366,12369,12395,12395,12591,16300,17900,17901,17908,17909,17910,17911,17920,17921,17931,17950,17951,17970,17971,17979,17987,17990,17991,17999,95033,95105,95116,95118,95119,95120,95160,95168,95169,95188,95384,95500,95501,95511,95512,95516,95518,95519,95522,95533,95555,95558,95559,95561,95566,95567,95568,95577,95588,95595,95598,95599,95766,95777,95803,95805,95806,95808,95809,95810,95811,95812,95813,95815,95816,95828,95829,95838,95839,95858,95859,95877,95880,5888,95900,95901,95911,95936,95937,95938,95939,95950,95951,95958,95963,95968,95993,96e3,96001,96002,96003,96005,96008,96010,96011,96014,96015,96096,96100,96101,96105,96110,96111,96112,96113,96118,96119,96120,96121,96126,96128,96129,96157,96158,96166,96168,96169,96177,96178,96179,96181,96188,96190,96191,96196,96197,96199,96300];function l(e,t){for(var n={isValid:!1,regExp:null,getExtIndex:null},o=String(e).replace(/((\s)|(-))/g,""),r=[c,d,h],i=0,s=r.length;i<s;i++){var a=0===i?o:e,l=r[i](String(a),t);if(l.isValid){n=l;break}}return n}function c(e,t){for(var n=t?[i[t]]:Object.values(i),o=0;o<n.length;o++){var r=new RegExp(n[o]);if(r.test(String(e)))return{isValid:!0,regExp:r,getExtIndex:null}}return{isValid:!1,getExtIndex:null,regExp:null}}function d(e,t){for(var n=t?[s[t]]:Object.values(s),o=0;o<n.length;o++){var r=new RegExp(n[o].regExp);if(r.test(String(e)))return{isValid:!0,getExtIndex:n[o].getExtIndex,regExp:r}}return{isValid:!1,getExtIndex:null,regExp:null}}function u(e){var t,o=String(e),r=l(o);if(!r.isValid)return null===n.g||void 0===n.g||n.g.log.error("不合法的号码: "+o),o;var i=null===(t=r.getExtIndex)||void 0===t?void 0:t.call(r,o);return void 0!==i&&r.regExp?String(e).substring(0,i)+","+String(e).substring(i+1):e}function p(e){var t;if(!e)return null;if(r().isTencentDocsApp)return null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.mqq)||void 0===t?void 0:t.invoke("nav","openSchema",{uri:"tel:"+e});var n=document.getElementById("dial-phone");n&&document.body.removeChild(n);var o=document.createElement("a");o.id="dial-phone",o.href="tel:"+e,document.body.appendChild(o),null===o||void 0===o||o.click()}function h(e,t){var n=!1,o=Number(e);return a.forEach((function(e){e===o&&(n=!0)})),{isValid:n,getExtIndex:null,regExp:null}}function m(e){var t;if(!e)return null;if(r().isTencentDocsApp)return null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.mqq)||void 0===t?void 0:t.invoke("nav","openSchema",{uri:e});var n=document.getElementById("email-string");n&&document.body.removeChild(n);var o=document.createElement("a");o.id="email-string",o.href=e,document.body.appendChild(o),null===o||void 0===o||o.click()}},"../spread-sheet/src/core/utils/linkedRange.ts":function(e,t,n){n.d(t,{$q:function(){return s},Tu:function(){return l},XI:function(){return a}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js");var o=n("../node_modules/i18next/dist/esm/i18next.js"),r=n("../packages/model/src/range/hexRangeUtils.ts"),i=n("../spread-sheet/src/base/util/url.ts"),s=function(e,t){if(null===t||void 0===t?void 0:t[0]){var n=t[0].linkUrl;if(null===n||void 0===n?void 0:n.split("=")){var o=(null===n||void 0===n?void 0:n.split("="))[1],r=e.workbookRangeManager.getLinkedWorkbookRangeById(o);if(r)return r}}return null},a=function(e,t){var n=s(e,t);if(n){var i=function(e,t){var n=t.sheetId,i=e.sheetManager.getSheetBySheetId(n);if(!i)return o.ZP.t("链接无效");var s=""+(0,r.range2RelativeHex)(t,i);return"'"+i.getTitle()+"'!"+s}(e,n.range);return i}return(null===t||void 0===t?void 0:t.length)?o.ZP.t("链接无效"):""},l=function(e,t){var n=(0,i.lS)(t);return n&&e.sheetManager.hasSheetId(n)?{sheetId:n,title:e.sheetManager.getSheetTitleBySheetId(n)}:null}},"../spread-sheet/src/core/view/level-2/addon/addon-center.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return W}}),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.from.js");var o,r=n("react"),i=n.n(r),s=n("react-dom"),a=n.n(s),l=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),c=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),d=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),u=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.array.find.js"),n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js")),p=n("../node_modules/i18next/dist/esm/i18next.js"),h=n("../node_modules/classnames/index.js"),m=n.n(h),f=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),v=n.n(f),g=n("../node_modules/@tencent/docs-addon-sdk/lib/index.esm.js");n("../node_modules/core-js/modules/es.array.map.js"),function(e){e[e.Seperator=0]="Seperator",e[e.ImageButton=1]="ImageButton",e[e.DropdownButton=2]="DropdownButton",e[e.TextButton=3]="TextButton",e[e.SeperatorBlock=4]="SeperatorBlock"}(o||(o={}));var _,y,w=n("../node_modules/@tencent/dui/lib/components/Tooltip/index.js"),C=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).onMouseUp=function(e){t.props.disabled||t.props.onClick(e,t.props.id,t.props.type)},t}return(0,d.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=void 0===t?"":t,o=e.disabled,r=e.selected,s=e.iconClassName,a=e.tips,l=m()("st-button",s,{"st-button-disabled":o,"st-button-selected":r});return i().createElement(w.default,{placement:"top",title:a||n},i().createElement("div",{className:l,onMouseUp:this.onMouseUp},n))},t}(i().Component),E=function(e){function t(){return e.apply(this,arguments)||this}return(0,d.Z)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.title,o=void 0===n?"":n,r=t.text,s=t.disabled,a=t.tips,l=m()("st-text-button",{"st-button-disabled":s}),c=i().createElement("div",{className:l,style:{fontSize:"13px"},onClick:function(t){return e.props.onClick(t,e.props.id,e.props.type)}},r);return a||o?i().createElement(w.default,{placement:"top",title:a||o},c):c},t}(i().Component),I=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).stopPropagationAndPreventDefault=function(e){e.stopPropagation(),e.preventDefault()},t}(0,d.Z)(t,e);var n=t.prototype;return n.render=function(){var e=this,t=this.props,n=t.posX,o=t.posY,r=t.visible,s=t.buttons,a=t.onMouseEnter,l=t.onMouseLeave,c=t.onClick,d={left:n,top:o};return r&&s.length>0?i().createElement("span",{className:"suspend-toolbar",style:d,onMouseDown:this.stopPropagationAndPreventDefault,onMouseMove:this.stopPropagationAndPreventDefault,onMouseUp:this.stopPropagationAndPreventDefault,onMouseEnter:a,onMouseLeave:l},s.map((function(t){return e.getCanShow(t)?e.renderDiffType(t,c):""}))):""},n.renderDiffType=function(e,t){return e.type===o.ImageButton&&e.config?i().createElement(C,{key:e.id,id:e.id,type:e.type,tips:e.config.tips,title:e.config.title,iconClassName:e.config.iconClassName,disabled:e.disabled,selected:e.selected,onClick:t}):e.type===o.Seperator?i().createElement("div",{className:"st-separator"}):e.type===o.TextButton&&e.config?i().createElement(E,{key:e.id,id:e.id,type:e.type,tips:e.config.tips,title:e.config.title,text:e.config.text,disabled:e.disabled,onClick:t}):e.type===o.SeperatorBlock?i().createElement("div",{key:e.id,className:"st-separator-block"+(-1!==e.id.indexOf("big")?" bigblock":"")}):void 0},n.getCanShow=function(e){return!e.shouldShow||e.shouldShow()},t}(i().Component);!function(e){e.OpenOriginUrl="openOriginUrl",e.CopyUrl="copyUrl",e.Refresh="refresh",e.Delete="delete",e.EditAddon="editAddon"}(_||(_={})),function(e){e.Copy="st-button-copylink",e.Refresh="st-button-refresh",e.Delete="st-button-delete",e.Cancel="st-button-cancelLink",e.Edit="st-button-editSrcUrl"}(y||(y={}));var b=n("../spread-sheet/src/core/feature/copyPaste/clipboardCopy.ui.ts"),x=n("../spread-sheet/src/core/feature/copyPaste/interfaces.ts"),S=n("../node_modules/@tencent/tencent_doc_open_url/dist/index.js"),k=n("../packages/model/src/range/index.ts"),A=n("../packages/model/src/new-embedded/index.ts"),D=n("../spread-sheet/src/core/view/lib/mutex-management/MutexManagement.ts"),T=n("../packages/lib/EventEmitter.ts"),P="show",L="hide",R=function(){function e(e){var t=this;this.emitter=new T.Z,this.handleAddonActiveShow=function(e){t.currentAddonObjectId=e,t.mutexManagement.mutexShow(D.d.ADDON)},this.handleAddonActiveHide=function(){t.currentAddonObjectId=""},this.mutexManagement=e,this.mutexManagement.addMutexComponent(D.d.ADDON,this),this.emitter.on(P,this.handleAddonActiveShow),this.emitter.on(L,this.handleAddonActiveHide)}return e.prototype.mutexHide=function(){this.emitter.emit(L)},(0,l.Z)(e,[{key:"activeId",get:function(){return this.currentAddonObjectId}}]),e}();function M(e){var t=e.scale,n=e.layoutData,o=e.areaData,r=(n.left+o.col.frozen.viewSize)/t,i=(n.top+o.row.frozen.viewSize)/t,s=o.getColByDisplayViewLeft(r-o.col.flow.offsetSize),a=o.getRowByDisplayViewTop(i-o.row.flow.offsetSize),l=n.width/t>>0,c=n.height/t>>0;return{x:r-o.getGlobalLeftByCol(s),y:i-o.getGlobalTopByRow(a),colIndex:s,rowIndex:a,width:l,height:c}}function j(e,t){var n=t.position,o=n.rowIndex,r=n.colIndex,i=t.width,s=t.height,a=t.x||0,l=t.y||0,c=e.getGlobalLeftByCol(r)+a;return{top:e.getGlobalTopByRow(o)+l,left:c,width:i,height:s}}var N=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},O=function(e){function t(t){var n;return(n=e.call(this,t)||this).deleteByHotKey=function(e){n.state.isOnEdit&&["Backspace","Delete"].includes(e.key)&&n.handleDeleteAddoniFrame()},n.handleTouchStart=function(e){e.stopPropagation(),n.props.app.permissions.sheetStatus.canEdit&&n.state.isOnEdit&&(document.addEventListener("mousemove",n.handleTouchmove,!0),document.addEventListener("mouseup",n.handleTouchend,!0),document.addEventListener("touchmove",n.handleTouchmove,!0),document.addEventListener("touchend",n.handleTouchend,!0))},n.handleTouchmove=function(e){var t=n.props,o=t.app,r=t.setProps;e.stopPropagation();var i=n.operateData,s=i.diffX,a=i.diffY;o.permissions.sheetStatus.canEdit&&((n.state.style.left||0)+s<0||(n.state.style.top||0)+a<0||n.setState({style:{left:(n.state.style.left||0)+s,top:(n.state.style.top||0)+a,width:n.state.style.width,height:n.state.style.height},isMoving:!0},(function(){null===r||void 0===r||r({top:n.state.style.top,left:n.state.style.left,scale:n.scale.scale,width:n.state.style.width,height:n.state.style.height})})))},n.handleTouchend=function(){n.updateEmbedObjectLocation(),n.setState({isMoving:!1}),document.removeEventListener("mousemove",n.handleTouchmove,!0),document.removeEventListener("mouseup",n.handleTouchend,!0),document.removeEventListener("touchmove",n.handleTouchmove,!0),document.removeEventListener("touchend",n.handleTouchend,!0)},n.toggleEditStatus=function(e){void 0===e&&(e=!0);var t=n.props,o=t.addonEdit,r=t.objectId,i=t.setProps;e&&o.emitter.emit(P,r),n.container.current&&(n.container.current.style.display=e?"block":"none"),n.setState({isOnEdit:e}),null===i||void 0===i||i({zIndex:e?1e4:9999,scale:n.scale.scale,width:n.state.style.width,height:n.state.style.height})},n.updateEmbedObjectLocation=function(){var e=n.props,t=e.objectId,o=e.app,r=e.areaData,i=o.spreadsheet.embeddedObjectManager.getEmbeddedObject(t);if(i&&o.permissions.sheetStatus.canEdit&&!(Math.abs(n.operateData.currX-n.operateData.startX)<=1&&Math.abs(n.operateData.currY-n.operateData.startY)<=1)){var s=M({scale:n.scale.scale,layoutData:{width:n.state.style.width,height:n.state.style.height,left:n.state.style.left,top:n.state.style.top},areaData:r}),a=s.x,l=s.y,c=s.colIndex,d=s.rowIndex,u=i.clone();u.location.x=a,u.location.y=l,u.location.position={colIndex:c,rowIndex:d},u.properties.addon.addonData.isNew=!0;var p=u.location.sheetId,h=new k.GridRange(p,d,d,c,c);o.requestApi.updateEmbeddedObject({sheetId:p,objects:[u],range:h})}},n.onClick=function(e,t){n.events[t]()},n.handleEditAddon=function(){return N((0,c.Z)(n),void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeAddonById(this.props.docsAddonObject.addonId);case 2:case"end":return e.stop()}}),e,this)})))},n.handleCopyAddoniFrame=function(){var e=n.props.docsAddonObject.originURL;(0,b.ES)({copyContent:{html:"",plain:e},type:x.GI.input}),u.default.show({type:"success",message:p.ZP.t("复制链接成功"),autoClose:!0,closable:!0})},n.handleDeleteAddoniFrame=function(){var e=n.props,t=e.objectId,o=e.app,r=o.spreadsheet.embeddedObjectManager.getEmbeddedObject(t);if(r){var i=r.location.sheetId;o.requestApi.deleteEmbeddedObject({embeddedObjectType:A.NEW_EMBEDDED_OBJECT_TYPE.ADDON,objectId:t,sheetId:i})}},n.handleRefreshIFrame=function(){var e=n.props.docsAddonObject.embedURL,t=n.iframeRef.current;t&&(t.src=e)},n.handleOpenOriginUrl=function(){var e=n.props.docsAddonObject.originURL;(0,S.tencentDocOpenUrlForAll)({url:e})},n.getToolbarPosition=function(){var e=n.props.initialStyle,t=e.top,o=e.height;return t<40?{posX:-2,posY:o+9}:{posX:-2,posY:-40}},n.state={isOnEdit:!1,style:t.initialStyle,isMoving:!1},n.scale=t.scale,n.operateData=n.props.spreadsheetView.operateContext.operateData,n.iframeRef=i().createRef(),n.container=i().createRef(),n}(0,d.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this.props,n=t.addonEdit,o=t.objectId;n.emitter.on(L,(function(){return e.toggleEditStatus(!1)})),n.emitter.on(P,(function(t){t!==o&&e.toggleEditStatus(!1)})),document.addEventListener("keydown",this.deleteByHotKey)},n.componentWillUnmount=function(){var e=this.props.addonEdit;e.emitter.off(L),e.emitter.off(P),document.removeEventListener("keydown",this.deleteByHotKey)},n.render=function(){var e,t=this,n=this.props,r=n.objectId,s=n.app,a=n.docsAddonObject.embedURL,l=this.state.style,c=l.width,d=l.height,u=this.scale.scale,h=this.state,f=h.isOnEdit,g=h.isMoving,w=this.getToolbarPosition(),C=w.posX,E=w.posY;return i().createElement("div",{className:"addon-insert-embed",onClick:function(){return t.toggleEditStatus(!0)},style:{transform:"scale("+u+")"}},i().createElement("div",{className:m()("addon-insert-container",{"selected-border":f}),onMouseDown:this.handleTouchStart,onTouchStart:this.handleTouchStart},i().createElement("iframe",{id:r,ref:this.iframeRef,src:a,width:c||0,height:d||0,style:{border:"none",pointerEvents:f?"all":"none",margin:v().isMobile?"6px":"4px"}})),i().createElement(I,{visible:f&&v().isPC,buttons:(e=s.permissions.sheetStatus,[{id:_.OpenOriginUrl,type:o.TextButton,config:{tips:p.ZP.t("跳转到源网页"),text:p.ZP.t("打开链接")}},{id:"separator_1",type:o.Seperator},{id:_.CopyUrl,type:o.ImageButton,config:{tips:p.ZP.t("复制链接"),iconClassName:y.Copy},shouldShow:function(){return e.canCopy}},{id:"separator_2",type:o.Seperator,shouldShow:function(){return e.canCopy}},{id:_.Refresh,type:o.ImageButton,config:{tips:p.ZP.t("刷新"),iconClassName:y.Refresh}},{id:"separator_4",type:o.Seperator,shouldShow:function(){return e.canEdit}},{id:_.Delete,type:o.ImageButton,config:{tips:p.ZP.t("删除"),iconClassName:y.Delete},shouldShow:function(){return e.canEdit}}]),posX:C,posY:E,onClick:this.onClick}),i().createElement("div",{className:m()("addon-iframe-box-mask",{"mask-selected":f&&!g})}),i().createElement("div",{className:"addon-dragger",ref:this.container}))},n.executeAddonById=function(e){return N(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.os.fetchContentContainerConfiguration(e);case 2:n=t.sent,(o=n.toolbar)&&o.length>0&&(null===(r=o.find((function(e){return e.type===g.Sd.CUSTOM})))||void 0===r?void 0:r.action)&&g.os.executeToolbarButtonAction(e,r.action);case 5:case"end":return t.stop()}}),t)})))},(0,l.Z)(t,[{key:"events",get:function(){var e;return(e={})[_.CopyUrl]=this.handleCopyAddoniFrame,e[_.Delete]=this.handleDeleteAddoniFrame,e[_.Refresh]=this.handleRefreshIFrame,e[_.OpenOriginUrl]=this.handleOpenOriginUrl,e[_.EditAddon]=this.handleEditAddon,e}}]),t}(i().Component),B=n("../node_modules/lodash/isEqual.js"),Z=n.n(B),U=function(){function e(e,t){var n=this;this.addonBox=document.createElement("div"),this.destroy=function(){n.addonBox.remove()},this.setProps=function(e){var t=Object.assign(Object.assign({},n.previosSetProps),e);if(!Z()(t,n.previosSetProps)){n.previosSetProps=t;var o=e.left,r=e.top,i=e.scale,s=e.zIndex;void 0!==o&&void 0!==r&&Object.assign(n.addonBox.style,{left:o*(null!==i&&void 0!==i?i:1)+"px",top:r*(null!==i&&void 0!==i?i:1)+"px"}),void 0!==s&&Object.assign(n.addonBox.style,{zIndex:s})}},this.container=e,this.addonBox.classList.add("addon-box"),this.container.appendChild(this.addonBox),this.renderBox(t)}var t=e.prototype;return t.renderBox=function(e){this.setProps(Object.assign(Object.assign({},e.initialStyle),{scale:e.scale.scale})),a().render(this.getComponent(e),this.addonBox)},t.getComponent=function(e){return i().createElement(O,Object.assign({},e,{setProps:this.setProps}))},e}(),H=function(){function e(e){this.addonMap=new Map,this.board=document.createElement("div"),Object.assign(this,e),this.board.classList.add("addon-stage-board"),this.blockBoard.hiddenBoard.append(this.board)}var t=e.prototype;return t.drawAddon=function(e,t,n,o){void 0===o&&(o=!0);var r=this.addonMap.get(e),i={app:this.app,spreadsheetView:this.spreadsheetView,initialStyle:t,objectId:e,docsAddonObject:n,addonEdit:this.addonEdit,scale:this.scale,areaData:this.spreadsheetView.areaData};o?(r?r.renderBox(i):r=new U(this.board,i),this.addonMap.set(e,r)):r&&(r.container.style.display="none")},t.deleteAddon=function(e){var t=this.addonMap.get(e);null===t||void 0===t||t.destroy(),this.addonMap.delete(e)},t.updateLocation=function(e,t){var n=this.addonMap.get(e);null===n||void 0===n||n.setProps(Object.assign(Object.assign({},t),{scale:this.scale.scale}))},e}(),V=function(){function e(e){var t=this;this.addonData=new Map,this.updateLocation=function(e,n){var o=t.addonData.get(e);if(o){Object.assign(o,n);var r=o.rect;t.addonBoard.updateLocation(e,r)}},Object.assign(this,e),this.addonBoard=new H({blockBoard:this.mainBoard.bottom.right,spreadsheetView:this.app.view.canvas.spreadsheetView,app:this.app,addonEdit:this.addonEdit,scale:this.scale,areaData:this.areaData})}var t=e.prototype;return t.getAddonData=function(e){return this.addonData.get(e)},t.drawAddon=function(e){this.addonData.set(e.id,e);var t=e.rect;this.mainBoard.bottom.right.isInBoardVisibleArea(t,100)&&this.addonBoard.drawAddon(e.id,e.rect,e.data,e.display)},t.updateAddon=function(e,t){var n=this.addonData.get(e);if(n){Object.assign(n,t);var o=n.rect,r=n.data,i=n.display;this.mainBoard.bottom.right.isInBoardVisibleArea(o,100)?this.addonBoard.drawAddon(e,o,r,i):this.addonBoard.deleteAddon(e)}},t.deleteAddon=function(e){this.addonData.delete(e),this.addonBoard.deleteAddon(e)},t.deleteAllAddons=function(){var e=this;this.addonData.forEach((function(t,n){e.addonBoard.deleteAddon(n)})),this.addonData.clear()},t.getAddonByIdInBoards=function(e){var t=null;return this.addonBoard.addonMap.get(e)&&(t=this.addonBoard.addonMap.get(e)),t},t.refresh=function(){this.deleteAllAddons(),this.drawCurAddon()},t.drawCurAddon=function(){var e=this,t=this.app.spreadsheet.embeddedObjectManager.embeddedObjectMap,o=Array.from(t.keys()),r=o.length,i=0;n.g.requestAnimationFrame((function s(){var a=o[i],l=t.get(a);if((null===l||void 0===l?void 0:l.location.sheetId)===e.app.spreadsheet.activeSheetId&&(null===l||void 0===l?void 0:l.properties.type)===A.NEW_EMBEDDED_OBJECT_TYPE.ADDON){var c=l.objectId,d=l.properties,u=l.location,p=d.addon,h=p.addonId,m=p.addonData;if(m.isNew){var f=j(e.areaData,u),v=m.anchorId,g={addonId:h,embedURL:m.embedURL,originURL:m.originURL,anchorId:v};e.drawAddon({id:c,rect:f,data:g,display:!0})}else{var _=l.clone(),y=_.location,w=y.x,C=y.y,E=y.width,I=y.height,b=y.sheetId,x=u.clone(),S=M({scale:e.scale.scale,layoutData:{width:E,height:I,left:w,top:C},areaData:e.areaData}),D=S.x,T=S.y,P=S.colIndex,L=S.rowIndex;x.position.colIndex=P,x.position.rowIndex=L,x.x=D,x.y=T;var R=new k.GridRange(b,L,L,P,P);_.location=x,_.properties.addon.addonData.isNew=!0;var N=j(e.areaData,x),O=m.anchorId,B={addonId:h,embedURL:m.embedURL,originURL:m.originURL,anchorId:O};e.drawAddon({id:c,rect:N,data:B,display:!0}),e.app.requestApi.updateEmbeddedObject({sheetId:b,objects:[_],range:R})}}(i+=1)<r&&n.g.requestAnimationFrame(s)}))},e}(),K=n("../spread-sheet/src/core/view/utils/base-func.ts"),G=n("../node_modules/lodash/throttle.js"),z=n.n(G),F=function(e){var t=this;this.setTimeoutThrottledUpdate=z()((function(){t.updateAllAddon()}),50),this.promiseThrottledUpdate=(0,K.ad)((function(){t.updateAllAddon()})),this.updateAllLocation=(0,K.ad)((function(){t.spreadsheet.embeddedObjectManager.each((function(e){e.location.sheetId===t.spreadsheet.activeSheetId&&e.properties.type===A.NEW_EMBEDDED_OBJECT_TYPE.ADDON&&t.updateLocation({object:e})}))})),this.updateAllAddon=function(){t.spreadsheet.embeddedObjectManager.each((function(e){e.location.sheetId===t.spreadsheet.activeSheetId&&e.properties.type===A.NEW_EMBEDDED_OBJECT_TYPE.ADDON&&t.updateAddon({object:e})}))},this.addAddon=function(e){var n=e.object,o=n.objectId,r=n.location,i=n.properties.addon,s=i.addonId,a=i.addonData,l=a.anchorId,c=a.embedURL,d=a.originURL,u=a.displayText,p=r.width,h={addonId:s,anchorId:l,displayText:u,embedURL:c,height:r.height,originURL:d,width:p},m=j(t.areaData,r);t.addonStage.drawAddon({id:o,data:h,rect:m,display:!0})},this.deleteAddon=function(e){t.addonStage.deleteAddon(e.objectId)},this.updateAddon=function(e){var n=e.object,o=n.objectId,r=n.location,i=n.properties.addon,s=i.addonId,a=i.addonData,l=a.anchorId,c=a.embedURL,d=a.originURL,u=a.displayText,p=r.width,h={addonId:s,anchorId:l,displayText:u,embedURL:c,height:r.height,originURL:d,width:p},m=j(t.areaData,r);t.addonStage.updateAddon(o,{id:o,data:h,rect:m,display:!0})},this.updateLocation=function(e){var n=e.object,o=n.objectId,r=n.location,i=j(t.areaData,r);t.addonStage.updateLocation(o,{rect:i})},Object.assign(this,e),this.addonStage.drawCurAddon(),this.dataCallView.onAddAddon(this.addAddon),this.dataCallView.onUpdateAddon(this.updateAddon),this.dataCallView.onDeleteAddon(this.deleteAddon),this.areaData.row.frozen.onUpdateViewSize(this.promiseThrottledUpdate),this.areaData.row.flow.onUpdateViewSize(this.promiseThrottledUpdate),this.areaData.col.frozen.onUpdateViewSize(this.promiseThrottledUpdate),this.areaData.col.flow.onUpdateViewSize(this.promiseThrottledUpdate),this.areaData.row.frozen.onUpdateTotalSize(this.promiseThrottledUpdate),this.areaData.row.flow.onUpdateTotalSize(this.promiseThrottledUpdate),this.areaData.col.frozen.onUpdateTotalSize(this.promiseThrottledUpdate),this.areaData.col.flow.onUpdateTotalSize(this.promiseThrottledUpdate),this.areaData.onUpdateOffset(this.setTimeoutThrottledUpdate),this.dataCallView.onInsertCol(this.updateAllLocation),this.dataCallView.onInsertRow(this.updateAllLocation),this.dataCallView.onDeleteCol(this.updateAllLocation),this.dataCallView.onDeleteRow(this.updateAllLocation),this.dataCallView.onSetColVisible(this.promiseThrottledUpdate),this.dataCallView.onSetRowVisible(this.promiseThrottledUpdate),this.dataCallView.onSetColWidth(this.updateAllLocation),this.dataCallView.onSetRowHeight(this.updateAllLocation)},W=function(){function e(e){Object.assign(this,e),this.addonEdit=new R(this.mutexManagement),this.addonStage=new V({mainBoard:this.mainBoard,scale:this.scale,areaData:this.areaData,spreadsheet:this.spreadsheet,app:this.spreadsheetApp,addonEdit:this.addonEdit}),this.addonKeeper=new F({dataCallView:this.dataCallView,spreadsheet:this.spreadsheet,areaData:this.areaData,scale:this.scale,addonStage:this.addonStage})}var t=e.prototype;return t.refresh=function(){this.addonStage.refresh()},t.addAddon=function(e){this.addonStage.drawAddon(e)},t.updateAddon=function(e,t){this.addonStage.updateAddon(e,t)},t.deleteAddon=function(e){this.addonStage.deleteAddon(e)},t.deleteAllAddons=function(){this.addonStage.deleteAllAddons()},e}()},"../spread-sheet/src/core/view/level-2/card-center/BaseCard.ts":function(e,t,n){var o=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),r=n("../spread-sheet/src/core/view/utils/base-func.ts"),i=function(){function e(){this._container=document.createElement("div"),this._container.classList.add("base-card"),this._container.setAttribute("tabindex","5"),this._container.addEventListener("keydown",r.UW),this._container.addEventListener("wheel",r.UW)}return(0,o.Z)(e,[{key:"container",get:function(){return this._container}}]),e}();t.Z=i},"../spread-sheet/src/core/view/level-2/cell-corner/const.ts":function(e,t,n){var o,r;n.d(t,{$s:function(){return o},Bq:function(){return r},N7:function(){return i},YZ:function(){return s}}),function(e){e[e.LeftTop=0]="LeftTop",e[e.RightTop=1]="RightTop"}(o||(o={})),function(e){e.Blue="#0188fb",e.Red="#ff4419",e.Gray="#81868f"}(r||(r={}));var i=6,s=1},"../spread-sheet/src/core/view/level-2/cell-corner/index.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var o=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.values.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.find-index.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../spread-sheet/src/core/view/spreadsheet-view/utils.ts")),i=n("../spread-sheet/src/core/view/level-2/cell-corner/const.ts"),s=n("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),a=n("../node_modules/lodash/set.js"),l=n.n(a),c=n("../node_modules/lodash/unset.js"),d=n.n(c),u=function(e){function t(t){var n;return(n=e.call(this,t)||this).dwtReadCellCorner=window.__DWT__recordCellCorner,n.renderAfterCell=function(e){var t,o=e.x,r=e.y,s=e.row,a=e.col,l=((t={})[i.$s.LeftTop]=null,t[i.$s.RightTop]=null,t);n.handlers.forEach((function(e){var t=e(s,a);t&&("number"!==typeof t.zIndex&&(t.zIndex=1),(!l[t.position]||l[t.position].zIndex<t.zIndex)&&(l[t.position]=t))})),n.dwtReadCellCorner&&(window.cellCornerConfigs=window.cellCornerConfigs||{},d()(window.cellCornerConfigs,[s,a])),Object.values(l).forEach((function(e){return e&&n.collectCellCorner(Object.assign({x:o,y:r,row:s,col:a},e))}))},n.rowcolAccessor=t.rowcolAccessor,n.tableView=t.tableView,n.renderPluginExtension=t.renderPluginExtension,n.handlers=[],n.coverBackgroundCollector=n.renderPluginExtension.coverBackgroundCollect,n._alloyExcel.onAfterCellRender(n.renderAfterCell),n}(0,o.Z)(t,e);var n=t.prototype;return n.addCornerHandler=function(e){this.handlers.push(e)},n.removeCornerHandler=function(e){var t=this.handlers.findIndex((function(t){return t===e}));t>=0&&this.handlers.splice(t,1)},n.collectCellCorner=function(e){var t=e.x,n=e.y,o=e.row,s=e.col,a=e.position,c=e.color,d=this.tableView.getCellViewAtPosition(o,s),u=(0,r.o)(this.rowcolAccessor,d,s)-1,p=[],h=i.N7,m=i.YZ;switch(a){case i.$s.LeftTop:p[0]=t+m,p[1]=n+m,p[2]=t+h+m,p[3]=n+m,p[4]=t+m,p[5]=n+h+m;break;case i.$s.RightTop:p[0]=t+u-h-m,p[1]=n+m,p[2]=t+u-m,p[3]=n+m,p[4]=t+u-m,p[5]=n+h+m;break;default:return}this.dwtReadCellCorner&&l()(window.cellCornerConfigs,[o,s,a],c),this.coverBackgroundCollector.collect({color:c,graphicsInfo:{path:p}})},t}(s.Z)},"../spread-sheet/src/core/view/level-2/cell-image-viewer/index.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return s}}),n("../node_modules/core-js/modules/es.object.assign.js");var o=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),r=n.n(o),i=n("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),s=function(){function e(e){var t=this;this.isReadyToZoomIn=!1,this.prevRow=-1,this.prevCol=-1,this.updateCursor=function(e){void 0===e&&(e=t.operateData);var n=e,o=n.currRow,r=n.currCol,s=t.normalSelectData.activation||{},a=s.row,l=s.col;o===a&&r===l&&t.cellContainsImage(a,l)&&!(0,i.tE)(t.spreadsheet.parent,a,l)?t.changeCursorToZoom():t.restoreCursor()},this.handleClick=function(e){var n=e.currRow,o=e.currCol;t.shouldZoomIn(n,o)&&t.shapeZoom.show({row:n,col:o}),t.prevRow=n,t.prevCol=o,t.prevTapTime=Date.now()},Object.assign(this,e);var n=e.mouseOperate,o=e.touchOperate;n.onClick(this.handleClick),n.onMousemove(this.updateCursor),o.onTap(this.handleClick)}var t=e.prototype;return t.cellContainsImage=function(e,t){return Boolean(this.spreadsheet.activeSheet.getCellImage(e,t))},t.changeCursorToZoom=function(){this.isReadyToZoomIn||(this.operateBoard.board.style.cursor="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzMnB4IiB2aWV3Qm94PSIwIDAgMzIgMzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYzLjEgKDkyNDUyKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT7liIfniYc8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0i6KeG6KeJ56i/IiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0i57yW57uELTEwIj4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgeD0iMCIgeT0iMCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj48L3JlY3Q+CiAgICAgICAgICAgIDxjaXJjbGUgaWQ9IuakreWchuW9ouWkh+S7vSIgc3Ryb2tlPSIjNDY0RDVBIiBzdHJva2Utd2lkdGg9IjIiIGN4PSIxNSIgY3k9IjE1IiByPSI4Ij48L2NpcmNsZT4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9ouWkh+S7vS0xNyIgc3Ryb2tlPSIjNDY0RDVBIiBmaWxsPSIjOTc5Nzk3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMy4zNTM1NTMsIDIyLjM1MzU1Mykgcm90YXRlKC0zMTUuMDAwMDAwKSB0cmFuc2xhdGUoLTIzLjM1MzU1MywgLTIyLjM1MzU1MykgIiB4PSIyMC4zNTM1NTM0IiB5PSIyMS44NTM1NTM0IiB3aWR0aD0iNiIgaGVpZ2h0PSIxIj48L3JlY3Q+CiAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaLlpIfku70tMjEiIHN0cm9rZT0iIzQ2NEQ1QSIgeD0iMTEuNSIgeT0iMTQuNSIgd2lkdGg9IjciIGhlaWdodD0iMSI+PC9yZWN0PgogICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2i5aSH5Lu9LTIyIiBzdHJva2U9IiM0NjRENUEiIHg9IjE0LjUiIHk9IjExLjUiIHdpZHRoPSIxIiBoZWlnaHQ9IjciPjwvcmVjdD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==) 16 16, zoom-in",this.isReadyToZoomIn=!0)},t.restoreCursor=function(){this.isReadyToZoomIn&&(this.operateBoard.board.style.removeProperty("cursor"),this.isReadyToZoomIn=!1)},t.shouldZoomIn=function(e,t){return!((r().isMobile||r().isIPad)&&this.prevTapTime&&Date.now()-this.prevTapTime>500)&&e===this.prevRow&&t===this.prevCol&&this.cellContainsImage(e,t)&&!(0,i.tE)(this.spreadsheet.parent,e,t)},e}()},"../spread-sheet/src/core/view/level-2/comment-center/CommentCenter.pc.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return St}});var o,r,i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../spread-sheet/src/base/event/event.ts")),a=n("../spread-sheet/src/core/view/spreadsheet-view/area-data/AreaData.interface.ts"),l=(n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../packages/model/src/range/SheetRangeType.ts")),c=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.array.sort.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/i18next/dist/esm/i18next.js")),d=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),u=(n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.math.imul.js"),n("../spread-sheet/src/core/data/configService/spreadConfig.ts"));function p(){return u.q.getConfig("tinyid")}function h(){return u.q.getConfig("uid")}function m(e){return e===p()}function f(){var e=u.q.getConfig("ownerId"),t=p(),n=h();return e===t||e===n}function v(e){return e&&0!==e.length?e.filter((function(e){return!!e})).length:0}n("../packages/common-utils/src/index.ts"),function(e){e[e.preview=1]="preview",e[e.focus=2]="focus"}(o||(o={})),function(e){e.none="none",e.top="top"}(r||(r={}));var g=new RegExp("("+/[-:@a-zA-Z0-9_.,~%+/\\?=&#!;()[\]$]/.source+")");new RegExp(/\b(?:(?:https?|s?ftp|ftps|file|nfs):\/\/|mailto:|tel:|www\.)/.source+g.source+"+","ig");var _=function(){var e=u.q.getConfig("privilegeAttribute").can_comment;return void 0===e||1===e};function y(e,t){void 0===t&&(t=0);for(var n,o=3735928559^t,r=1103547991^t,i=0;i<e.length;i++)n=e.charCodeAt(i),o=Math.imul(o^n,2654435761),r=Math.imul(r^n,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),4294967296*((2097151&(r=Math.imul(r^r>>>16,2246822507)^Math.imul(o^o>>>13,3266489909)))+(o>>>0))}var w=function(e,t){var o,r=n.g.SpreadsheetApp.spreadsheet.activeSheet.getCellDataAtPosition(e,t);r&&0!==(null===(o=r.getSheetRangeReferences())||void 0===o?void 0:o.filter((function(e){return e.type===l.Z.COMMENT_RANGE})).length)&&n.g.SpreadsheetApp.requestApi.deleteCommentRange()},C=n("./node_modules/axios/index.js"),E=n.n(C),I=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};function b(e,t){return I(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,r,i,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=window.location.origin+e,(r=u.q.getConfig("uid"))&&"0"!==r){n.next=4;break}return n.abrupt("return",new Error(e+": 获取的用户uin有错误"));case 4:return i=Object.assign(Object.assign({},t),{str_docid:encodeURIComponent(u.q.getConfig("globalPadId")),str_sid:u.q.getConfig("sid")}),n.prev=5,n.next=8,E()({url:o,method:"POST",data:JSON.stringify(i),headers:{"content-type":"application/json"},withCredentials:!0}).then((function(e){return e.data}));case 8:if("OK"===(s=n.sent).ActionStatus){n.next=11;break}return n.abrupt("return",{err:new Error(e+":"+JSON.stringify(s)),response:s});case 11:return n.abrupt("return",{data:s});case 14:return n.prev=14,n.t0=n.catch(5),console.error("Error:",n.t0),n.abrupt("return",n.t0);case 18:case"end":return n.stop()}}),n,null,[[5,14]])})))}function x(e){var t;return I(this,void 0,void 0,regeneratorRuntime.mark((function o(){var r,i,s,a,l,c;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(r=e.anchorid){o.next=5;break}return n.g.log.info(e,u.q.getConfig("padId")),null===(t=n.g.log)||void 0===t||t.report("anchorId_empty"),o.abrupt("return",[]);case 5:return r=r.replace(u.q.getConfig("padId")+"-",""),o.next=8,b("/v3/oidbinterface/oidb_0xbd1_0",{str_anchor:r});case 8:if(i=o.sent,s=i.data,!(a=i.err)){o.next=14;break}return T(a),o.abrupt("return",[]);case 14:if(l=s.msg_anchorcomments,c=l.rpt_comment){o.next=18;break}return o.abrupt("return",[]);case 18:return o.abrupt("return",c.map(R).sort((function(e,t){return e.times<=t.times?-1:1})));case 19:case"end":return o.stop()}}),o)})))}function S(e){return I(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i,s,a,l,c,d,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.anchorid,o=e.content,r=e.target,i=e.syncGroup,n){t.next=4;break}return t.abrupt("return",Promise.reject());case 4:return n=n.replace(u.q.getConfig("padId")+"-",""),t.next=7,b("/v3/oidbinterface/oidb_0xbca_0",{rpt_comment:[{str_anchor:n,str_content:o,str_targetid:r}],bool_sync_to_qgroup:i});case 7:if(s=t.sent,a=s.data,l=s.err,c=s.response,!l){t.next=14;break}return D(l,c),t.abrupt("return",Promise.reject());case 14:if(d=a.rpt_comment){t.next=17;break}return t.abrupt("return",Promise.reject());case 17:return p=R(d[0]),t.abrupt("return",p);case 19:case"end":return t.stop()}}),t)})))}function k(e){return I(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i,s,a,l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.anchorid,o=e.commentid,r=e.content,n&&o){t.next=4;break}return t.abrupt("return",Promise.reject("anchorId或commentId为空，anchorId: "+n+", commentId: "+o));case 4:return n=n.replace(u.q.getConfig("padId")+"-",""),t.next=7,b("/v3/oidbinterface/oidb_0xbcc_0",{rpt_comment:[{str_anchor:n,str_content:r,str_commentid:o}]});case 7:if(i=t.sent,s=i.data,a=i.err,l=i.response,!a){t.next=14;break}return L(a,l),t.abrupt("return",Promise.reject());case 14:if((c=s.rpt_comment)&&c[0]){t.next=17;break}return t.abrupt("return",Promise.reject());case 17:return t.abrupt("return",R(c[0]));case 18:case"end":return t.stop()}}),t)})))}function A(e){return I(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.anchorid,o=e.commentid,void 0!==n&&void 0!==o){t.next=4;break}return t.abrupt("return",!1);case 4:return n=n.replace(u.q.getConfig("padId")+"-",""),t.next=7,b("/v3/oidbinterface/oidb_0xbce_0",{str_anchorid:n,str_commentid:e.commentid,uint32_opr_flag:e.delAll?1:0});case 7:if(r=t.sent,i=r.err,s=r.response,!i){t.next=13;break}return P(i,s),t.abrupt("return",!1);case 13:return t.abrupt("return",!0);case 14:case"end":return t.stop()}}),t)})))}function D(e,t){var n=c.ZP.t("批注发送失败，请重试。");t&&"FAIL"===t.ActionStatus&&10010===t.ErrorCode&&(n=c.ZP.t("文档权限发生变化，批注发送失败。")),d.default.show({type:"error",message:n,autoClose:!0,style:{zIndex:10004}}),console.error(e)}function T(e){d.default.show({type:"error",message:c.ZP.t("查询批注失败"),autoClose:!0,style:{zIndex:10004}}),console.error(e)}function P(e,t){var n=c.ZP.t("批注删除失败，请重试。");t&&"FAIL"===t.ActionStatus&&10010===t.ErrorCode&&(n=c.ZP.t("文档权限发生变化，批注删除失败。")),d.default.show({type:"error",message:n,autoClose:!0,style:{zIndex:10004}}),console.error(e)}function L(e,t){var n=c.ZP.t("批注编辑失败，请重试。");t&&"FAIL"===t.ActionStatus&&10010===t.ErrorCode&&(n=c.ZP.t("文档权限发生变化，批注编辑失败。")),d.default.show({type:"error",message:n,autoClose:!0,style:{zIndex:10004}}),console.error(e)}function R(e){return{id:e.str_commentid,uin:e.str_author,nickName:e.str_author_name,times:e.uint64_time,userImg:e.str_head_url,content:e.str_content}}var M=n("../packages/report/src/index.ts"),j=n("../packages/model/src/index.ts"),N=n("../spread-sheet/src/core/view/level-2/cell-corner/const.ts");function O(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var Z=function(e){var t=this;this.handleCellCorner=function(e,n){var o=t.spreadsheet.activeSheet;if(o){var r=o.getCellDataAtPosition(e,n);if(r){var i=r.getSheetRangeReferences();if(i)for(var s,a=O(i);!(s=a()).done;)if(s.value.type===j.Range.SHEET_RANGE_TYPE.COMMENT_RANGE)return{position:N.$s.RightTop,color:N.Bq.Blue}}}},this.spreadsheet=e.spreadsheet,this.cellCornerPlugin=e.cellCornerPlugin,this.cellCornerPlugin.addCornerHandler(this.handleCellCorner)};function U(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var V,K=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},G=function(e){var t=this;this.getEditable=function(){return t.sheetStatus.canComment},this.hasCommentInCell=function(e,n){var o=t.getAnchorId(e,n);return""!==o&&t.hasComment(o)},this.hasComment=function(e){return!!t.app.spreadsheet.activeSheet.sheetRangeManager.getSheetRange(e)},this.getAnchorId=function(e,n){var o=t.app.spreadsheet.activeSheet.getCellDataAtPosition(e,n);if(o){var r=o.getSheetRangeReferences();if(!r)return"";for(var i,s=U(r);!(i=s()).done;){var a=i.value;if(a.type===l.Z.COMMENT_RANGE)return a.id}}return""},this.queryComment=function(e,n){return K(t,void 0,void 0,regeneratorRuntime.mark((function t(){var o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this.getAnchorId(e,n)){t.next=3;break}return t.abrupt("return",null);case 3:return t.next=5,x({anchorid:o});case 5:return r=t.sent,t.abrupt("return",r);case 7:case"end":return t.stop()}}),t,this)})))},this.addComment=function(e,n,o,r){return K(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S({anchorid:e,content:n,target:this.app.spreadsheet.activeSheetId,syncGroup:o});case 2:return i=t.sent,this.hasComment(e)||this.app.spreadsheet.parent.requestApi.defineCommentRange(e,r),t.abrupt("return",i);case 6:case"end":return t.stop()}}),t,this)})))},this.deleteComment=function(e,n,o,r){return K(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A({anchorid:e,commentid:n,delAll:o});case 2:return(i=t.sent)&&r&&(this.app.spreadsheet.parent.requestApi.deleteCommentRange(),M.ZP.tdwReport({module:"excel_comment",opername:"doc_cooper",action:"clear_com"})),t.abrupt("return",i);case 5:case"end":return t.stop()}}),t,this)})))},this.editComment=function(e,n,o){return K(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k({anchorid:e,content:n,commentid:o});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})))},this.app=e.app,this.sheetStatus=e.sheetStatus,this.cellCornerPlugin=e.cellCornerPlugin,this.cardCenter=e.cardCenter,this.areaData=e.areaData,this.cellCornerPlugin=e.cellCornerPlugin,this.discussRenderPlugin=new Z({spreadsheet:this.app.spreadsheet,cellCornerPlugin:this.cellCornerPlugin})},z=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),F=n("react-dom"),W=n.n(F),Y=n("../spread-sheet/src/base/index.ts"),q=n("../spread-sheet/src/core/utils/selection.ts"),Q=n("../spread-sheet/src/external/tencentMeeting/event/eventName.ts"),X=n("../spread-sheet/src/external/tencentMeeting/operation/operation.interface.ts"),J=n("../spread-sheet/src/core/view/level-2/card-center/BaseCard.ts"),$="SHOW",ee="HIDE",te="UPDATE_TYPE",ne="UPDATE_EDITOR",oe="SET_ANCHOR_ID",re="UPDATE_COMMENTS",ie="ADD_COMMENT",se="DEL_COMMENT",ae="EDIT_COMMENT",le="SET_SYNC_GROUP",ce="SET_HIGHLIGHT",de="SET_FOCUS_INPUT_CONTENT",ue="CACHE_CELL_POSITION",pe=function(){return{type:$}},he=function(){return{type:ee,payload:{focusInputContent:""}}},me=function(e){return{type:oe,payload:{anchorId:e}}},fe=function(){return{type:te,payload:{type:o.focus}}},ve=function(e,t){return void 0===t&&(t=""),{type:ne,payload:{editableId:e,textContent:t}}},ge=function(e){return{type:re,payload:{comments:e}}},_e=function(e,t){return void 0===t&&(t=!1),{type:se,payload:{commentId:e,delAll:t}}},ye=function(e){return{type:ae,payload:{newComment:e}}},we=function(e){return{type:ce,payload:{commentId:e}}},Ce=n("react"),Ee=n.n(Ce),Ie=n("../node_modules/react-redux/es/index.js"),be=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),xe=(n("../node_modules/core-js/modules/es.promise.finally.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.string.trim.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/@tencent/docs-user-agent/dist/index.js")),Se=n.n(xe),ke=n("../node_modules/classnames/index.js"),Ae=n.n(ke);n("../node_modules/core-js/modules/es.array.concat.js"),function(e){e.PC_TEXTAREA="PC_TEXTAREA",e.PC_MENTION="PC_MENTION"}(V||(V={}));var De,Te,Pe=function(e){for(var t,o,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];null===(o=n.g.log)||void 0===o||(t=o).debug.apply(t,["[CommentCenter]["+e+"]:"].concat(i))},Le=function(){var e=new CustomEvent("MentionCickedEvent",{detail:{}});document.dispatchEvent(e)},Re=function(e){return e.code?e.code.toLowerCase():e.key?e.key.toLowerCase():""},Me=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../packages/model/src/mention/MentionDetail.ts")),je=function(e){var t="";return e.forEach((function(e){t+=e.text})),t},Ne={cellDataToTextAreaData:function(e,t){if(!e)return[];var n=t||e.getEditValue()||"",o=[];o.push({text:n});var r=e.getMentionDetails();if(r){var i=0;Object.keys(r).forEach((function(e){var t=r[e],n=t.pos,s=n[0],a=n[1],l=Be.getTextFromSingleOp(o.pop());if(l){var c=l.slice(i,s-i),d=l.slice(s-i,a-i),u=l.slice(a-i,l.length);o.push({text:c}),o.push({text:d,data:Be.getMentionUserInfoFromMentionDetails(t)}),o.push({text:u}),i+=c.length+d.length}}))}return o}},Oe={textAreaDataToString:je,textAreaDataToCellDataFragment:function(e){var t=n.g.SpreadsheetApp,o=n.g.spreadConfig,r={editValue:"",mentionDetails:{}};return e.forEach((function(e){var n=e.text||"";if(e.data){var i=e.data,s=i.mentionId,a=i.mentionUserID,l=r.editValue.length,c=l+n.length;r.mentionDetails[e.data.mentionId]=new Me.Z({mentionId:s,pos:[l,c],type:0,sheetId:t.spreadsheet.getActiveSheetId(),text:n,userId:a,padId:o.getConfig("padId")})}r.editValue+=n})),r}},Be={getTextFromSingleOp:function(e){return e&&e.text?e.text:""},getMentionUserInfoFromMentionDetails:function(e){return{mentionId:e.mentionId,avatar:"",globalPadId:u.q.getConfig("globalPadId"),mentionType:0,mentionUserID:e.userId}}},Ze=(Object.assign(Object.assign(Object.assign({},Ne),Oe),Be),n("../node_modules/core-js/modules/es.string.search.js"),n("../spread-sheet/src/core/view/level-2/mention/api/MentionApi.ts")),Ue=n("../spread-sheet/src/core/view/level-2/mention/utils.ts"),He=n("../spread-sheet/src/core/view/level-2/mention/enum.ts"),Ve=function(){function e(e){var t,o,r=this;this.defaultConfig={enableInPlaceSearching:!0,enableQuickRemind:!0},this.mentionUserInfo={},this.hasMentionMenuTriggered=!1,this.hasRemindBoardTriggered=!1,this.handleAt=function(e){var t=e.textContent,n=e.delta,o=e.cursorPos,i=r.config.enableInPlaceSearching;if(!r.mentionStatus.isCommitting){var s=null===n||void 0===n?void 0:n.ops.filter((function(e){return e.insert}))[0],a=null===n||void 0===n?void 0:n.ops.filter((function(e){return e.retain}))[0];if(r.updateCursorPos(t,o),s&&"string"===typeof s.insert&&(0,Ue.Mn)(s.insert)&&!r.hasMentionMenuTriggered)return r.mentionStatus.isSearching=!0,r.mentionStatus.startIndex=(null===a||void 0===a?void 0:a.retain)||0,r.showMentionList(),void r.setTextAreaCommitStatus(Te.PENDING);i&&r.mentionStatus.isSearching&&r.triggerMentionListSearch(t)}},this.handleSelectionChange=function(e,t){r.cursorExceptionHandler(e,t)},this.handleKeyDown=function(e){if(!r.mentionStatus.isSearching)return!1;var t=!0;switch(Re(e)){case"escape":r.triggerExitMention();break;case"arrowup":case"arrowleft":Ze.Z.control("UP");break;case"arrowdown":case"arrowright":Ze.Z.control("DOWN");break;case"enter":case"tab":Ze.Z.control("SELECT");break;default:t=!1}return t&&(e.preventDefault(),e.stopPropagation()),t},this.cursorExceptionHandler=function(e,t){if(r.mentionStatus.isSearching){var n=Math.max(0,e.length-t);r.mentionStatus.isCommitting||!(t<=r.mentionStatus.startIndex||n!==r.mentionStatus.cursorDistanceToStringEnd)?(Pe(V.PC_MENTION,"startIndex",r.mentionStatus.startIndex),Pe(V.PC_MENTION,"cursorPos",t),r.updateCursorPos(e,t)):r.triggerExitMention()}},this.updateCursorPos=function(e,t){r.mentionStatus.cursorPos=t,r.mentionStatus.cursorDistanceToStringEnd=Math.max(0,e.length-t)},this.showMentionList=function(){var e=r.getCursorPosition();Ze.Z.popMentionList(e,20,r.app.spreadsheet.activeSheetId,r.addMentionCallback),r.hasMentionMenuTriggered=!0,r.dispose.areaDataUpdateOffsetDispose=r.app.view.canvas.areaData.onUpdateOffset(r.triggerExitMention)},this.triggerExitMention=function(){var e;r.initMentionStatus(),Ze.Z.search(""),Ze.Z.hideMentionList(),r.hasMentionMenuTriggered=!1,null===(e=r.dispose.areaDataUpdateOffsetDispose)||void 0===e||e.dispose(),r.afterExitMention()},this.triggerMentionListSearch=function(e){var t=r.mentionStatus,n=t.startIndex,o=t.cursorPos,i=t.cursorDistanceToStringEnd,s=n+i+1,a=o+i,l=e.substring(s,a);r.mentionStatus.searchText=l,l.length>24&&r.triggerExitMention(),Pe(V.PC_MENTION,"search",l),Ze.Z.search(l)},this.addMentionCallback=function(e){if(r.mentionStatus.isCommitting=!0,r.setTextAreaCommitStatus(Te.DELEGATE_INPUT_DONE),e.length>0){var t=u.q.getConfig("globalPadId");e.forEach((function(e){var n,o,i,s,a=e.mentionId,l=e.uin,c=e.nick,d=e.avatar;r.mentionUserInfo[a]={mentionId:a,avatar:d,globalPadId:t,mentionType:0,mentionUserID:l};var u=r.mentionStatus,p=u.cursorPos,h=u.startIndex,m=p-h;null===(n=r.inputRef.current)||void 0===n||n.deleteText(h,m),null===(o=r.inputRef.current)||void 0===o||o.insertEmbed({index:h,key:"mention",value:"@"+c,formats:{id:a,"data-avatar":d}}),null===(i=r.inputRef.current)||void 0===i||i.insertText(h+1,"\ufeff"),null===(s=r.inputRef.current)||void 0===s||s.setSelection(h+2,0),r.mentionStatus.startIndex+=1,r.mentionStatus.cursorPos=r.getCursorPos()-1}))}r.triggerExitMention()},this.getCursorPos=function(){var e,t;return(null===(t=null===(e=r.inputRef.current)||void 0===e?void 0:e.getSelection())||void 0===t?void 0:t.index)||0},this.initMentionStatus=function(){r.mentionStatus={startIndex:-1,isSearching:!1,isCommitting:!1,searchText:"",cursorPos:-1,cursorDistanceToStringEnd:0}},this.initDispose=function(){r.dispose={}},this.registerEventForQuickRemindBoard=function(){document.addEventListener("MentionCickedEvent",r.showRemindBoard)},this.showRemindBoard=function(e){if(0!==Object.keys(e.detail).length){e.stopPropagation();var t=e.detail,n=t.mentionId,o=t.node.getBoundingClientRect(),i=r.app.view.canvas.clientRect,s=o.x-i.distanceX,a=o.y+o.height-i.distanceY;Ze.Z.showRemindBoard(n,{x:s,y:a},!0,o.height),r.hasRemindBoardTriggered=!0,document.addEventListener("click",r.hideRemindBoard)}else Ze.Z.closeRemindBoard()},this.hideRemindBoard=function(){r.hasRemindBoardTriggered&&(Le(),r.hasRemindBoardTriggered=!1),document.removeEventListener("click",r.hideRemindBoard)},this.getCursorPosition=function(){var e,t,n=(0,Ue.p1)();if(n){var o=n.getClientRects(),i=r.app.view.canvas.clientRect;if(null===o||void 0===o?void 0:o.length){var s=o[0];return{x:(s.x||s.left)-i.distanceX,y:(s.y||s.top)+s.height-i.distanceY}}}var a=null===(t=null===(e=r.inputRef.current)||void 0===e?void 0:e.container)||void 0===t?void 0:t.getBoundingClientRect();return a?{x:a.x||a.left,y:(a.y||a.top)+a.height}:{x:0,y:0}},this.handleFriendSelectorModalInvisible=function(){r.triggerExitMention()},this.app=e.app,this.inputRef=e.inputRef,this.setTextAreaCommitStatus=e.setTextAreaCommitStatus,this.afterExitMention=e.afterExitMention,this.config=Object.assign(Object.assign({},this.defaultConfig),e.config),this.initMentionStatus(),this.initDispose(),this.config.enableQuickRemind&&this.registerEventForQuickRemindBoard(),null===(o=null===(t=n.g.SLR)||void 0===t?void 0:t.listen)||void 0===o||o.call(t,He.B.HIDE_FRIEND_SELECTOR,this.handleFriendSelectorModalInvisible)}var t=e.prototype;return t.deconstructor=function(){this.isSearching&&this.triggerExitMention(),Le()},t.getMentionUserInfo=function(e){return this.mentionUserInfo[e]},t.getAllMentionUserInfo=function(){return this.mentionUserInfo},(0,be.Z)(e,[{key:"isSearching",get:function(){return this.mentionStatus.isSearching}},{key:"isCommitting",get:function(){return this.mentionStatus.isCommitting}}]),e}(),Ke=Ve,Ge=["id","mention","data-avatar"];!function(e){e.CommentEditable="CommentEditable"}(De||(De={})),function(e){e.INVALID="INVALID",e.NORMAL_INPUT_DONE="NORMAL_INPUT_DONE",e.PENDING="PENDING",e.DELEGATE_INPUT_DONE="DELEGATE_INPUT_DONE"}(Te||(Te={}));var ze=function(e){function t(t){var o,r,i,s;return(r=e.call(this,t)||this).isTextAreaMounted=!1,r.historyIndex=0,r.isLoadedModule=((o={})[De.CommentEditable]=!1,o),r.isFocus=!1,r.confirm=function(e,t){var n,o;r.mentionInstance.deconstructor(),null===(o=(n=r.props).textareaConfirm)||void 0===o||o.call(n,{content:r.getContent(),commentUserInfo:r.mentionInstance.getAllMentionUserInfo(),editableId:r.props.editableId}).then((function(){var e,t;r.setContent(""),null===(t=(e=r.props).setFocusInputContent)||void 0===t||t.call(e,void 0)})).catch((function(e){r.setContent(r.props.content||""),t(e)})).finally((function(){e(),r.setState({textContent:""}),r.clearSelection(),r.isTextAreaMounted&&r.textAreaFocus()}))},r.setTextAreaCommitStatus=function(e){r.textAreaCommitStatus=e},r.clearSelection=function(){var e=document.getSelection();if(null===e||void 0===e||e.empty(),0!==(null===e||void 0===e?void 0:e.rangeCount))throw new Error("[TextArea] 无法清除选区")},r.initEditor=function(e){var t;r.inputRef.current=e,null===(t=r.inputRef.current.container)||void 0===t||t.addEventListener("keydown",r.handleKeyDown),setTimeout((function(){var e,t=r.getRawContent().length;0===t||r.props.readOnly||null===(e=r.inputRef.current)||void 0===e||e.setSelection(t,0)}),50)},r.getTextAreaCSSProperty=function(){var e,t,n=r.props.style||{},o=null===(e=r.inputRef.current)||void 0===e?void 0:e.container,i=r.textareaRef.current;i&&o||(n=Object.assign(Object.assign({},n),{overflow:"hidden"}));var s=(null===o||void 0===o?void 0:o.offsetHeight)||0,a=i?parseInt((null===(t=getComputedStyle(i).maxHeight.match(/\d+/))||void 0===t?void 0:t[0])||"0",10):0;return s<=a&&0!==a&&(n=Object.assign(Object.assign({},n),{overflow:"hidden"})),n},r.handleChange=function(){var e,t,n=r.getContent();r.setState({textContent:n}),null===(t=(e=r.props).setFocusInputContent)||void 0===t||t.call(e,n)},r.handleInput=function(e,t){setTimeout((function(){r.handleChange(),r.props.readOnly||r.textAreaCommitStatus===Te.INVALID||r.mentionInstance.handleAt({textContent:r.getRawContent(),delta:t,cursorPos:r.getCursorPos()})}))},r.getCursorPos=function(){var e,t;return(null===(t=null===(e=r.inputRef.current)||void 0===e?void 0:e.getSelection())||void 0===t?void 0:t.index)||0},r.handleChangeSelection=function(){r.hasModalVisible()?r.handleBlur():!r.props.readOnly&&r.hasFocusedOnTextArea()&&r.mentionInstance.handleSelectionChange(r.getRawContent(),r.getCursorPos())},r.handleKeyDown=function(e){var t,n;Pe(V.PC_TEXTAREA,"handleKeyDown - keyDown",Re(e)),e.isComposing&&r.setTextAreaCommitStatus(Te.PENDING),r.shouldBypassKeyDown(e)||r.mentionInstance.handleKeyDown(e)||(r.setTextAreaCommitStatus(Te.NORMAL_INPUT_DONE),null===(n=(t=r.props).onKeyDown)||void 0===n||n.call(t,e))},r.shouldBypassKeyDown=function(e){return!r.isTextAreaMounted||!r.isFocus||e.isComposing},r.handleFocus=function(){var e,t;Pe(V.PC_TEXTAREA,"handleFocus"),r.isFocus=!0,M.ZP.tdwReport({module:"excel_comment",opername:"doc_cooper",action:"input"}),null===(t=(e=r.props).onFocus)||void 0===t||t.call(e)},r.handleBlur=function(){var e,t;Te.INVALID!==r.textAreaCommitStatus&&(Te.PENDING===r.textAreaCommitStatus&&r.setTextAreaCommitStatus(Te.NORMAL_INPUT_DONE),Pe(V.PC_TEXTAREA,"handleBlur"),r.isFocus=!1,null===(t=(e=r.props).onBlur)||void 0===t||t.call(e))},r.handleReadonlyCopy=function(e){var t,o,r,i=(null===(t=n.g.getSelection())||void 0===t?void 0:t.toString().replace(/\n\n/g,"\n").trim())||"";null===(o=e.clipboardData)||void 0===o||o.setData("text/plain",i),null===(r=e.clipboardData)||void 0===r||r.setData("text/html",i),e.preventDefault(),e.stopPropagation()},r.hasModalVisible=function(){return document.getElementsByClassName("content-dialog-container").length>0},r.textAreaFocus=function(){setTimeout((function(){var e,t,n,o=null===(n=null===(t=null===(e=r.inputRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.container.getElementsByTagName("p"))||void 0===n?void 0:n[0];if(!r.props.readOnly&&o){o.focus();var i,s=document.getSelection(),a=(null===s||void 0===s?void 0:s.rangeCount)&&(null===s||void 0===s?void 0:s.rangeCount)>0?null===s||void 0===s?void 0:s.getRangeAt(0):null;a&&(null===s||void 0===s?void 0:s.anchorNode)===o?i=a:((i=document.createRange()).setStart(o,0),i.setEnd(o,0)),null===s||void 0===s||s.removeAllRanges(),null===s||void 0===s||s.addRange(i)}}))},r.hasFocusedOnTextArea=function(){var e,t,n=(null===(e=document.getSelection())||void 0===e?void 0:e.focusNode)||null,o=null===(t=r.inputRef.current)||void 0===t?void 0:t.container;return n===o||(null===o||void 0===o?void 0:o.contains(n))},r.handleEditorChange=function(){if(r.inputRef.current){var e=r.inputRef.current.getSelection();if(e){var t=e.index;r.historyIndex=t}}r.currentTextAreaCommitStatus===Te.DELEGATE_INPUT_DONE&&r.handleBlur()},r.app=t.app,r.inputRef=(0,Ce.createRef)(),r.textareaRef=(0,Ce.createRef)(),r.textAreaCommitStatus=Te.INVALID,r.mentionInstance=new Ke({app:r.app,inputRef:r.inputRef,setTextAreaCommitStatus:r.setTextAreaCommitStatus,afterExitMention:function(){return r.handleFocus()},config:null===(i=t.config)||void 0===i?void 0:i.mention}),r.state={textContent:(null===(s=t.content)||void 0===s?void 0:s.trim())||"",isLoading:!1},r.init(),r}(0,i.Z)(t,e);var o=t.prototype;return o.componentDidMount=function(){var e;this.props.readOnly&&(null===(e=this.textareaRef.current)||void 0===e||e.addEventListener("copy",this.handleReadonlyCopy,!0)),this.isTextAreaMounted=!0,this.textAreaFocus()},o.componentWillUnmount=function(){var e,t,n,o;this.props.readOnly&&(null===(e=this.textareaRef.current)||void 0===e||e.removeEventListener("copy",this.handleReadonlyCopy,!0)),this.isTextAreaMounted=!1,null===(o=null===(n=null===(t=this.inputRef)||void 0===t?void 0:t.current)||void 0===n?void 0:n.container)||void 0===o||o.removeEventListener("keydown",this.handleKeyDown),this.mentionInstance.deconstructor()},o.render=function(){var e,t=null===(e=this.commentEditable)||void 0===e?void 0:e.default,n=function(e,t){try{var n=JSON.parse(e).reduce((function(e,n){if(n.data){var o=n.data,r=o.mentionId,i=o.avatar;return t[r]=n.data,null===e||void 0===e||e.push({insert:{mention:n.text},attributes:{id:r.toString(),"data-avatar":i}},{insert:"\ufeff"}),e}return null===e||void 0===e||e.push({insert:n.text}),e}),[]);return{defaultValue:n,commentUserInfo:t}}catch(o){return{defaultValue:[{insert:e}],commentUserInfo:t}}}(this.props.content,this.mentionInstance.getAllMentionUserInfo()),o=n.defaultValue,r=this.props,i=r.readOnly,s=r.placeholder,a=this.getTextAreaCSSProperty();return Ee().createElement(Ee().Fragment,null,Ee().createElement("div",{className:Ae()("textarea",{isIE:Se().isIE,"textarea-readonly":i}),style:a,ref:this.textareaRef},void 0!==this.commentEditable&&Ee().createElement(t,{spellCheck:!1,onInput:this.handleInput,onChangeSelection:this.handleChangeSelection,onSelect:function(){},onClick:function(){},placeholder:s,defaultValue:o,onFocus:this.handleFocus,onBlur:this.handleBlur,onEditorChange:this.handleEditorChange,initEditor:this.initEditor,formats:Ge,readOnly:!!i})),Ee().createElement("div",{style:{position:"absolute",opacity:0,height:"0px"}}," "))},o.insertContent=function(e){var t=this.inputRef.current;if(t){var n=this.historyIndex;t.insertText(n,e),t.setSelection(n+e.length,0)}},o.getContent=function(){var e,t,n=this,o=null===(t=null===(e=this.inputRef.current)||void 0===e?void 0:e.getContents())||void 0===t?void 0:t.ops;if(o){var r=o.map((function(e){if(!e.insert)return e;var t="",o=/(^\s*)|(\s*$)/g,r=e.attributes,i=e.insert;if("object"===typeof i&&i.mention){t=i.mention.replace(o,"").trim();var s=r.id;return{text:t,data:n.mentionInstance.getMentionUserInfo(s.toString())}}return"string"===typeof i&&(t=e.insert.replace(o,"").trim()),{text:t}})).filter((function(e){return e.text}));if(r.length>0)return JSON.stringify(r).replace(/(\s|&nbsp;|\n|<br>)+$/g,"").replace(/^(\s|&nbsp;|\n|<br>)+/g,"")}return"[]"},o.getRawContent=function(){var e=JSON.parse(this.getContent());return je(e)},o.setContent=function(e){var t=this.inputRef.current;return!!t&&(t.setContents(e),this.handleChange(),!0)},o.init=function(){var e,t,n=this;(null===(e=window.SLR)||void 0===e?void 0:e.assetLoaded)?this.getInstance().then((function(){})):null===(t=window.SLR)||void 0===t||t.listen("SL-INIT",(function(){n.getInstance().then((function(){}))}))},o.transformModuleMapIntoLoadPromise=function(){var e=this;return Object.keys(this.moduleMap).map((function(t){return new Promise((function(n,o){try{e.isLoadedModule[t]?n(e.moduleMap[t]):e.loadModule(t,e.moduleMap[t],n)}catch(r){o(r)}}))}))},o.getInstance=function(){return Promise.all(this.transformModuleMapIntoLoadPromise())},o.loadModule=function(e,t,n){var o=this;window.SLR.load(e,function(r){o.isLoadedModule[e]=!0,t(r),null===n||void 0===n||n(r)}.bind(this))},o.commentEditableLoadedCallback=function(e){this.commentEditable=e,Pe(V.PC_TEXTAREA,"CommentEditable loaded"),this.forceUpdate()},(0,be.Z)(t,[{key:"currentTextAreaCommitStatus",get:function(){return this.textAreaCommitStatus}},{key:"moduleMap",get:function(){var e;return(e={})[De.CommentEditable]=this.commentEditableLoadedCallback.bind(this),e}}]),t}(Ce.Component),Fe=ze,We=n("../node_modules/@tencent/dui/lib/components/Checkbox/index.js"),Ye=c.ZP.t("添加批注或@他人"),qe=function(e){function t(){return e.apply(this,arguments)||this}(0,i.Z)(t,e);var n=t.prototype;return n.handleClick=function(e){this.props.enable&&this.props.onClick(e)},n.render=function(){var e=this.props.loading?Ee().createElement("i",{className:"card-center-btn-loading-icon"}):this.props.children;return Ee().createElement("a",{tabIndex:this.props.tabIndex,className:Xe(this.props),onClick:this.handleClick.bind(this)},e)},t}(Ee().Component);qe.defaultProps={enable:!0,loading:!1};var Qe=qe;function Xe(e){var t="card-center-btn",n=e.enable;return e.loading&&(n=!1),e.private&&(t+=" card-center-btn-private"),e.className&&(t=t+" "+e.className),n||(t+=" card-center-btn-disabled"),e.loading&&(t+=" card-center-btn-loading"),t}var Je,$e=Ee().memo((function(e){var t,n=e.userImg,o=e.nickName,r=e.children;return Ee().createElement("div",{className:"comment-user-info-wrap"},Ee().createElement("div",{className:"comment-user-info"},Ee().createElement("img",{className:"comment-user-info-img",src:n,alt:o}),Ee().createElement("span",{className:"comment-user-info-nickName"},(t=o).length>7?t.slice(0,7)+"...":t)),r)})),et=1e3,tt=function(e){function t(t){var o;return(o=e.call(this,t)||this).isCommitting=!1,o.hasCancelClicked=!1,o.renderPlaceholder=function(){return o.state.shouldHidePlaceholder?null:Ee().createElement("div",{className:"textarea-placeholder"},Ye)},o.renderTextArea=function(){var e=o.props,t=e.app,n=e.content,r=e.editableId,i=e.setFocusInputContent,s=e.textareaCancel,a=e.textareaConfirm,l=o.state.textFocus;return Ee().createElement(Fe,{app:t,onBlur:o.handleBlur,onFocus:o.handleFocus,focus:l,content:n||"[]",placeholder:Ye,setFocusInputContent:i,readOnly:!1,ref:o.editorRef,textareaCancel:s,textareaConfirm:a,editableId:r,onKeyDown:o.handleKeyDown})},o.renderMaxContentLengthNotification=function(){return Ee().createElement("div",{className:"error-msg"},c.ZP.t("很抱歉，批注内容不能超过"),et,c.ZP.t("个字符。"))},o.renderSyncToQQGroup=function(e,t,n,o){return Ee().createElement("div",{className:"sync-qq-group",style:{marginBottom:e?35:0}},Ee().createElement(We.default,{checked:n,hollow:!0,onChange:o},Ee().createElement("span",{className:"qq-group-name"},c.ZP.t("同步到群："),t)))},o.renderButtonGroup=function(e,t,n){return Ee().createElement("div",{className:"btn-group"+(e?" btn-group-show":"")},Ee().createElement(Qe,{className:"btn-confirm",enable:!t&&n,loading:t,private:!0,onClick:o.onConfirm},c.ZP.t("确定")),Ee().createElement(Qe,{className:"btn-cancel",enable:!t,onClick:o.onCancel},c.ZP.t("取消")))},o.handleBlur=function(){o.setState({textFocus:!1})},o.handleFocus=function(){!1===o.state.shouldHidePlaceholder&&o.setState({shouldHidePlaceholder:!0})},o.onConfirm=function(e){null===e||void 0===e||e.preventDefault(),null===e||void 0===e||e.stopPropagation(),o.confirm()},o.onCancel=function(e){var t,n;e.preventDefault(),e.stopPropagation(),o.hasCancelClicked=!0,null===(n=(t=o.props).textareaCancel)||void 0===n||n.call(t)},o.handleKeyDown=function(e){var t,r;if("enter"===Re(e)){if(e.preventDefault(),e.stopPropagation(),e.isComposing)return void(null===(t=n.g.log)||void 0===t||t.info("CommentCenter","handleKeyDown - Quit handler when composing"));if(o.isNewLineModifyKeyPressed(e))return void(null===(r=o.editorRef.current)||void 0===r||r.insertContent("\n"));o.confirm()}},o.isNewLineModifyKeyPressed=function(e){return e.metaKey||e.altKey||e.ctrlKey},o.editorRef=(0,Ce.createRef)(),o.state={shouldHidePlaceholder:!1,isLoading:!1,textFocus:!0},o}(0,i.Z)(t,e);var o=t.prototype;return o.componentWillUnmount=function(){0===this.textLength||this.hasCancelClicked||this.confirm()},o.render=function(){var e=this.props,t=e.syncGroup,n=e.setSyncGroup,o=e.userImg,r=e.nickName,i=this.state.isLoading,s=this.props.getQQGroupName(),a=this.textLength>0,l=this.textLength<=et;return Ee().createElement("div",{className:"comment-item editing"},Ee().createElement("div",{className:"comment-textarea-group"},this.isAvatarVisible&&Ee().createElement($e,{userImg:o,nickName:r}),Ee().createElement("div",{className:"comment-textarea-container"},this.renderTextArea(),this.renderPlaceholder()),a&&!l&&this.renderMaxContentLengthNotification(),s&&this.renderSyncToQQGroup(a,s,t,n),this.renderButtonGroup(a,i,l)))},o.confirm=function(){var e,t,n=this;this.isCommitting||0!==this.textLength&&(this.textLength>et||(this.isCommitting=!0,null===(t=null===(e=this.editorRef)||void 0===e?void 0:e.current)||void 0===t||t.confirm((function(){n.setState({isLoading:!1}),n.isCommitting=!1}),(function(e){throw e}))))},(0,be.Z)(t,[{key:"textLength",get:function(){var e,t,o;try{var r=this.props.content?JSON.parse(this.props.content):[];return r instanceof Object===!1?r.toString().length:(null===(e=this.editorRef.current)||void 0===e?void 0:e.getRawContent().length)||je(r).length||0}catch(i){return null===(t=n.g.log)||void 0===t||t.error("CommentCenter","textLength - "+i+" - "+this.props.content),(null===(o=this.props.content)||void 0===o?void 0:o.toString().length)||0}}},{key:"isAvatarVisible",get:function(){return void 0===this.props.avatarVisible||this.props.avatarVisible}}]),t}(Ee().Component),nt=tt;!function(e){e.PC_TEXTAREA="PC_TEXTAREA",e.PC_MENTION="PC_MENTION"}(Je||(Je={}));var ot=function(e){for(var t,o,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];null===(o=n.g.log)||void 0===o||(t=o).debug.apply(t,["[CommentCenter]["+e+"]:"].concat(i))},rt=n("../packages/utils/src/index.ts"),it=n("../packages/lib/index.ts"),st=(n("../node_modules/core-js/modules/es.array.join.js"),n("../spread-sheet/src/core/view/utils/browser-func.ts")),at=n("../node_modules/@tencent/dui/lib/components/Modal/index.js"),lt=function(e){function t(t){var n;(n=e.call(this,t)||this).getStyle=function(){return{backgroundColor:"transparent",maxHeight:"unset"}},n._handleClick=function(e){var t,n;if(null===(n=null===(t=e.target)||void 0===t?void 0:t.dataset)||void 0===n?void 0:n.href){var o=e.target.dataset.href;(0,st.Yo)(o)}},n._handleEditBtn=function(){n.props.updateEditor(n.props.id,n.props.content),M.ZP.tdwReport({module:"excel_comment",opername:"doc_cooper",action:"edit_com"})},n._handleDelBtn=function(){var e=n.props.anchorId,t=n.props.commentId;console.warn("before commentId: ",t),at.default.confirm({title:c.ZP.t("删除批注"),content:c.ZP.t("确定删除此条批注吗？"),onOk:function(){n.props.app.view.canvas.commentCenter.refreshCommentList();var o=n.props.onFetchingCommentList((function(r){var i=1===function(e){return e&&0!==e.length?e.filter((function(e){return!!e})).length:0}(r);n.props.deleteComment(e,t,!1,i,!1),M.ZP.tdwReport({module:"excel_comment",opername:"doc_cooper",action:"del_com"}),o.dispose()}))}})};var o=t.id,r=t.highlightCommentId;return n.state={highlight:o===r},n._commentRef=(0,Ce.createRef)(),n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this,t=this._commentRef.current,n=this.props,o=n.id,r=n.highlightCommentId;t&&o===r&&setTimeout((function(){t.scrollIntoView(),e._highlightTimer=setTimeout((function(){e.setState({highlight:!1})}),3300)}),0)},n.componentWillUnmount=function(){clearTimeout(this._highlightTimer)},n.render=function(){var e=this.props,t=e.id,n=e.userImg,r=e.nickName,i=e.content,s=e.times,a="comment-text "+(this.props.type===o.focus?"comment-text-expended":"comment-text-folded");return Ee().createElement("div",{className:this.getCls(),key:"comment-item-"+t+"-"+y(i),ref:this._commentRef},Ee().createElement($e,{userImg:n,nickName:r},Ee().createElement("span",{className:"comment-user-info-times"},function(e){var t=new Date(1e3*e),n=[t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes()].map((function(e){return e<10?"0"+e:e.toString()}));return n[0]+"-"+n[1]+" "+n[2]+":"+n[3]}(s)),this._renderBtnGroup()),Ee().createElement("div",{onClick:this._handleClick,className:a},Ee().createElement(Fe,{app:this.props.app,focus:!1,content:i,setFocusInputContent:this.props.setFocusInputContent,readOnly:!0,style:this.getStyle()})),Ee().createElement("div",{className:"comment-item-bottom-border"}))},n.getCls=function(){var e=["comment-item"],t=this.props.uin;return _()&&(m(t)||f())||e.push("readonly"),this.state.highlight&&e.push("highlight"),e.join(" ")},n._renderBtnGroup=function(){var e=[];return m(this.props.uin)?e=[Ee().createElement("a",{key:"edit ",className:"comment-edit comment-btn",onClick:this._handleEditBtn},c.ZP.t("编辑")),Ee().createElement("a",{key:"del",className:"comment-del comment-btn",onClick:this._handleDelBtn},c.ZP.t("删除"))]:f()&&(e=[Ee().createElement("a",{key:"del",className:"comment-del comment-btn",onClick:this._handleDelBtn},c.ZP.t("删除"))]),Ee().createElement("div",{className:"comment-btn-group"},e)},t}(Ee().Component),ct=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},dt=function(e){function t(t){var n;return(n=e.call(this,t)||this).listRef=Ce.createRef(),n.renderComment=function(e){var t=n.props.comments[e];return t?n.props.editableId===t.id?Ce.createElement(nt,Object.assign({ref:t.id},n.props,t,{textareaCancel:n.commentEditCancel,textareaConfirm:n.commentEditConfirm})):Ce.createElement(lt,Object.assign({ref:t.id,commentId:t.id,onFetchingCommentList:n.onFetchingCommentList},n.props,t)):null},n.commentEditCancel=function(){n.props.updateEditor(r.top,"")},n.commentEditConfirm=function(e){var t=e.content;return ct((0,z.Z)(n),void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.editComment(this.props.anchorId,t,this.props.editableId);case 2:case"end":return e.stop()}}),e,this)})))},n.onFetchingCommentListEmitter=new it.Q5,n.onFetchingCommentList=n.onFetchingCommentListEmitter.event,n}(0,i.Z)(t,e);var n=t.prototype;return n.componentWillReceiveProps=function(e){if(this.listRef.current){var t,n=v(this.props.comments);v(e.comments)>n&&0!==n&&(t=this.listRef.current,setTimeout((function(){t&&(t.scrollTop=t.scrollHeight)}))),this.onFetchingCommentListEmitter.fire(e.comments)}},n.componentDidUpdate=function(e){this.setScrollBar(this.props.editableId);var t=v(e.comments);v(this.props.comments)>t&&this.props.adjustPosition()},n.setScrollBar=function(e){if(this.props.type===o.focus){var t=e,n=this.refs[t];if(!n)return;var r=F.findDOMNode(n),i=this.listRef.current;if(!r||!i)return;var s=r.offsetTop,a=r.offsetHeight,l=i.scrollTop;s+a-l>i.offsetHeight&&(i.scrollTop+=150),s-l<0&&(i.scrollTop-=150)}},n.render=function(){return Ce.createElement("div",{className:"comment-list",ref:this.listRef},this.renderList())},n.renderList=function(){var e=this,t=this.props.comments,n=v(t);return n<=3||this.props.type===o.focus?null===t||void 0===t?void 0:t.map((function(t,n){return e.renderComment(n)})):[this.renderComment(0),Ce.createElement("div",{className:"folded-tips",key:"fold-tap"},Ce.createElement("div",{className:"icon"},Ce.createElement("svg",{width:"7px",height:"6px",viewBox:"0 0 7 6",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},Ce.createElement("title",null,"Group"),Ce.createElement("desc",null,"Created with Sketch."),Ce.createElement("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},Ce.createElement("g",{id:"所有弹框",transform:"translate(-1734.000000, -813.000000)"},Ce.createElement("g",{id:"Group",transform:"translate(1731.000000, 810.000000)"},Ce.createElement("g",{id:"Group-33",transform:"translate(3.000000, 4.000000)",stroke:"#979797",strokeWidth:"0.81"},Ce.createElement("polyline",{id:"Path-3-Copy-2",transform:"translate(3.167603, 3.647548) scale(1, -1) translate(-3.167603, -3.647548) ",points:"9.76996262e-15 4.4379534 3.16760254 2.85714286 6.33520508 4.4379534"}),Ce.createElement("polyline",{id:"Path-3-Copy-3",transform:"translate(3.167603, 0.790405) scale(1, -1) translate(-3.167603, -0.790405) ",points:"9.76996262e-15 1.58081055 3.16760254 3.99680289e-15 6.33520508 1.58081055"})),Ce.createElement("rect",{id:"Rectangle",x:"0",y:"0",width:"12",height:"12"}))))),c.ZP.t("已折叠"),n-3,c.ZP.t("条批注")),Ce.createElement("div",{className:"comment-item-bottom-border"})),this.renderComment(n-2),this.renderComment(n-1)]},t}(Ce.Component),ut=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).clearComments=function(){var e=t.props.anchorId;at.default.confirm({title:c.ZP.t("清空批注"),content:c.ZP.t("确定删除此单元格下的所有批注吗？"),onOk:function(){t.props.deleteComment(e,"",!0,!0),M.ZP.tdwReport({module:"excel_comment",opername:"doc_cooper",action:"clear_com"})}})},t}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.comments,n=e.type;return v(t)>0&&n===o.focus&&f()?Ce.createElement("div",{className:"comment-header"},Ce.createElement("span",{className:"clear-btn-box",onClick:this.clearComments},Ce.createElement("i",{className:"clear-icon"}),Ce.createElement("a",{className:"clear-btn"},c.ZP.t("清空批注")))):null},t}(Ce.Component),pt=ut,ht=n("../node_modules/redux/es/redux.js"),mt=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),ft={visible:!1,type:o.preview,comments:[],editableId:r.none,anchorId:"",syncGroup:!0,highlightCommentId:"",focusInputContent:void 0,cellPosition:{row:-1,col:-1}};function vt(e,t){var n,i;void 0===e&&(e=ft);var s=t.type,a=t.payload,l=void 0===a?{}:a,c=Object.assign(Object.assign({},e),{type:l.type}),d=l.delAll?[]:e.comments.map((function(e){return e&&e.id===l.commentId?null:e})),u=((n={}).SHOW=function(){return Object.assign(Object.assign({},e),{visible:!0})},n.HIDE=function(){return Object.assign(Object.assign({},e),{type:o.preview,visible:!1,focusInputContent:void 0,editableId:r.none})},n.SET_ANCHOR_ID=function(){return Object.assign(Object.assign({},e),{anchorId:l.anchorId})},n.UPDATE_TYPE=function(){return l.type===e.type?e:(l.type===o.focus&&(c.editableId=r.top),Object.assign({},c))},n.UPDATE_EDITOR=function(){return Object.assign(Object.assign({},e),{editableId:l.editableId})},n.UPDATE_COMMENTS=function(){return Object.assign(Object.assign({},e),{comments:l.comments})},n.ADD_COMMENT=function(){return Object.assign(Object.assign({},e),{comments:[].concat((0,mt.Z)(e.comments),[l.comment])})},n.DEL_COMMENT=function(){return l.delAll?Object.assign(Object.assign({},e),{comments:[],visible:!1,editableId:r.top}):Object.assign(Object.assign({},e),{comments:d})},n.EDIT_COMMENT=function(){return Object.assign(Object.assign({},e),{comments:e.comments.map((function(e){return e&&e.id===l.newComment.id?l.newComment:e})),editableId:r.top})},n.SET_SYNC_GROUP=function(){return Object.assign(Object.assign({},e),{syncGroup:l.syncGroup})},n.SET_HIGHLIGHT=function(){return Object.assign(Object.assign({},e),{highlightCommentId:l.commentId})},n.SET_FOCUS_INPUT_CONTENT=function(){return Object.assign(Object.assign({},e),{focusInputContent:l.focusInputContent})},n.CACHE_CELL_POSITION=function(){return Object.assign(Object.assign({},e),{cellPosition:l.pos})},n);return(null===(i=u[s])||void 0===i?void 0:i.call(u))||e}var gt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},_t=(0,ht.MT)(vt),yt=function(e){return{showAction:function(){return e(pe())},hideAction:function(){return e(he())},addCommentAction:function(t){return e(function(e){return{type:ie,payload:{comment:e}}}(t))},editCommentAction:function(t){return e(ye(t))},deleteCommentAction:function(t,n){return e(_e(t,n))},setPanelTypeFocus:function(){return e(fe())},updateEditor:function(t,n){return e(ve(t,n))},setAnchorId:function(t){return e(me(t))},setSyncGroup:function(t){return e(function(e){return{type:le,payload:{syncGroup:e}}}(t))},setFocusInputContent:function(t){return e(function(e){return{type:de,payload:{focusInputContent:e}}}(t))}}},wt=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._handleClick=function(){t.props.type===o.preview&&(t.props.setPanelTypeFocus(),t.props.adjustPosition())},t.add=function(e){var n=e.content;return gt((0,z.Z)(t),void 0,void 0,regeneratorRuntime.mark((function e(){var t,o,r,i,a,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.syncGroup,-1!==(o=_t.getState().cellPosition).row&&-1!==o.col){e.next=4;break}throw new Error("添加批注时pos未初始化！pos.row="+o.row+", pos.col="+o.col);case 4:return(r=this.props.getAnchorId(o.row,o.col))||(r=rt.kk.getRandomId(),this.props.setAnchorId(r)),M.ZP.tdwReport({module:"excel_comment",opername:"doc_cooper",action:"send_com"}),e.next=9,this.props.addComment(r,n,t,o);case 9:i=e.sent,this.props.addCommentAction(i),a=JSON.parse(n),l=null===a||void 0===a?void 0:a.filter((function(e){return e.data})),c=null===l||void 0===l?void 0:l.map((function(e){return{mentionId:e.data.mentionId,anchorId:r}})),s.ZP.mentionEvent.trigger("sendMentionAction",c,(function(){ot(Je.PC_MENTION,"sendMentionAction success")}));case 15:case"end":return e.stop()}}),e,this)})))},t}(0,i.Z)(t,e);var n=t.prototype;return n.getDerivedStateFromProps=function(e){var t=v(this.props.comments),n=v(e.comments);t!==n&&0===n&&this.forceUpdate()},n.render=function(){var e=this.props.visible;return Ee().createElement("div",{className:"comment-app comment-app-"+(e?"visible":"hidden"),onClick:this._handleClick},Ee().createElement("div",{className:this._getPanelTypeCls(this.props.type),"data-testid":this.props.type===o.preview?"commentPanel-preview":"commentPanel-focus"},Ee().createElement(pt,{type:this.props.type,anchorId:this.props.anchorId,comments:this.props.comments,deleteComment:this.props.deleteComment}),this.renderCommentList(),this.renderTextArea()))},n.componentDidUpdate=function(e){!e.visible&&this.props.visible&&document.body.addEventListener("contextmenu",this.handleContextMenu),e.visible&&!this.props.visible&&document.body.removeEventListener("contextmenu",this.handleContextMenu)},n.handleContextMenu=function(e){var t,n=null===(t=document.getElementsByClassName("comment-card"))||void 0===t?void 0:t[0];e.target&&(null===n||void 0===n?void 0:n.contains(e.target))&&e.stopPropagation()},n._getPanelTypeCls=function(e){var t;return"commentPanel "+(t={},t[o.preview]="commentPanel-preview",t[o.focus]="commentPanel-focus",t)[e]},n.renderCommentList=function(){var e=this.props,t=e.type,n=e.editableId,o=e.comments,r=e.highlightCommentId;return Ee().createElement(dt,{app:this.props.app,getQQGroupName:this.props.getQQGroupName,comments:o,type:t,editableId:n,anchorId:this.props.anchorId,highlightCommentId:r,updateEditor:this.props.updateEditor,editComment:this.props.editComment,deleteComment:this.props.deleteComment,setFocusInputContent:this.props.setFocusInputContent,adjustPosition:this.props.adjustPosition})},n.renderTextArea=function(){var e=this,t=this.props,n=t.type,i=t.editableId,s=t.comments,a=t.syncGroup,l=t.setSyncGroup,d=t.setFocusInputContent,p=n===o.focus,h=i===r.top;return _()?p?Ee().createElement("div",{className:"panel-textarea",style:{display:h?"block":"none"}},v(s)>0&&Ee().createElement("p",null,c.ZP.t("追加批注")),Ee().createElement(nt,{app:this.props.app,syncGroup:a,setSyncGroup:l,getQQGroupName:this.props.getQQGroupName,avatarVisible:0===v(s),setFocusInputContent:d,textareaCancel:function(){e.props.hideAction()},textareaConfirm:this.add,editableId:r.top,userImg:u.q.getConfig("userPic"),nickName:u.q.getConfig("userName")})):Ee().createElement(Ee().Fragment,null):null},t}(Ee().Component),Ct=(0,Ie.$j)((function(e){return Object.assign({},e)}),yt)(wt),Et=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},It=function(e){function t(t){var n;return(n=e.call(this)||this).wrap=document.createElement("div"),n.row=-1,n.col=-1,n.addCommentAction=function(e,t,o){return Et((0,z.Z)(n),void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.dependency.addComment(e,t,o);case 2:return r=n.sent,this.triggerChangeCardContent(Q.z.CARD_SHOW,X.UQ.COMMENT_CARD_SHOW),n.abrupt("return",r);case 5:case"end":return n.stop()}}),n,this)})))},n.deleteComment=function(e,t,o,r,i){return void 0===i&&(i=!0),Et((0,z.Z)(n),void 0,void 0,regeneratorRuntime.mark((function n(){var s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.dependency.deleteComment(e,t,o,r);case 2:return s=n.sent,i?_t.dispatch(he()):_t.dispatch(_e(t,!1)),o?this.triggerChangeCardContent(Q.z.CARD_HIDE,X.UQ.COMMENT_CARD_HIDE):this.triggerChangeCardContent(Q.z.CARD_SHOW,X.UQ.COMMENT_CARD_SHOW),n.abrupt("return",s);case 6:case"end":return n.stop()}}),n,this)})))},n.editComment=function(e,t,o){return Et((0,z.Z)(n),void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.dependency.editComment(e,t,o);case 2:return r=n.sent,_t.dispatch(ye(r)),this.triggerChangeCardContent(Q.z.CARD_SHOW,X.UQ.COMMENT_CARD_SHOW),n.abrupt("return",r);case 6:case"end":return n.stop()}}),n,this)})))},n._handleSelectCells=function(e,t){return void 0===t&&(t=a.oz.USER),Et((0,z.Z)(n),void 0,void 0,regeneratorRuntime.mark((function n(){var o,r,i,s,a,l,c,d=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((0,q.singleRange)(this.app)){n.next=2;break}return n.abrupt("return");case 2:if(e.activation){n.next=4;break}return n.abrupt("return");case 4:return o=e.activation,r=o.row,i=o.col,s=this.app.spreadsheet.activeSheet.getCellDataAtPosition(r,i),(a=null===s||void 0===s?void 0:s.getMergeReference())&&(r=a.startRowIndex,i=a.startColIndex),l=this.getAnchorId(r,i),_t.dispatch(me(l)),setTimeout((function(){d.cacheCellPosition(r,i)})),n.next=13,this.queryComment(r,i);case 13:if(!(c=n.sent)||0===c.length){n.next=19;break}return this.addInCardCenter(r,i,!0,t),_t.dispatch(ge(c)),_t.dispatch(pe()),n.abrupt("return");case 19:l&&w(r,i),_t.dispatch(he()),this.removeInCardCenter();case 22:case"end":return n.stop()}}),n,this)})))},n.cacheCellPosition=function(e,t){_t.dispatch({type:ue,payload:{pos:{row:e,col:t}}})},n.adjustPosition=function(){n.addInCardCenter(n.row,n.col,!0,a.oz.API)},n.dependency=t,n.app=t.app,n.selectCells=t.selectCells,n.getQQGroupName=t.getQQGroupName,n.queryComment=t.queryComment,n.getAnchorId=t.getAnchorId,n.cardCenter=t.cardCenter,n.areaData=t.areaData,n.wrap.className="comment-card-wrap",n.container.appendChild(n.wrap),n.container.classList.add("comment-card"),n.render(),n.initEvent(),n}(0,i.Z)(t,e);var n=t.prototype;return n.openComment=function(e,t,n){return void 0===n&&(n=a.oz.USER),Et(this,void 0,void 0,regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return this.addInCardCenter(e,t,!0,n),this.cacheCellPosition(e,t),o.next=4,this.updateComment(e,t);case 4:_t.dispatch(pe()),_t.dispatch(fe()),_t.dispatch(ve(r.top,""));case 7:case"end":return o.stop()}}),o,this)})))},n.updateComment=function(e,t){return void 0===e&&(e=this.row),void 0===t&&(t=this.col),Et(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.queryComment(e,t);case 2:(o=n.sent)?_t.dispatch(ge(o)):_t.dispatch(ge([]));case 4:case"end":return n.stop()}}),n,this)})))},n.hide=function(e){void 0===e&&(e=a.oz.USER),this.removeInCardCenter(e),_t.dispatch(he())},n.showComment=function(e,t){return void 0===t&&(t=a.oz.USER),Et(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._handleSelectCells(e,t);case 2:case"end":return n.stop()}}),n,this)})))},n.activeComment=function(e,t,n){return Et(this,void 0,void 0,regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.queryComment(e,t);case 2:r=o.sent,this.addInCardCenter(e,t,!0),this.cacheCellPosition(e,t),r&&_t.dispatch(ge(r)),n&&_t.dispatch(we(n)),_t.dispatch(fe()),_t.dispatch(pe());case 9:case"end":return o.stop()}}),o,this)})))},n.render=function(){var e;W().render((e={app:this.app,getQQGroupName:this.getQQGroupName,hasComment:this.hasComment,addComment:this.addCommentAction,deleteComment:this.deleteComment,editComment:this.editComment,adjustPosition:this.adjustPosition,getAnchorId:this.getAnchorId},Ee().createElement(Ie.zt,{store:_t},Ee().createElement(Ct,{app:e.app,getQQGroupName:e.getQQGroupName,hasComment:e.hasComment,addComment:e.addComment,deleteComment:e.deleteComment,editComment:e.editComment,adjustPosition:e.adjustPosition,getAnchorId:e.getAnchorId}))),this.wrap)},n.initEvent=function(){this.selectCells.emitter.on(this.selectCells.EVENT.END_SELECT,this._handleSelectCells)},n.addInCardCenter=function(e,t,n,o){void 0===n&&(n=!1),void 0===o&&(o=a.oz.USER),this.removeInCardCenter(o),this.row=e,this.col=t,this.col<=this.areaData.getFirstColInView()?this.wrap.classList.remove("comment-card-wrap-offset"):this.wrap.classList.add("comment-card-wrap-offset");var r=this.cardCenter.getCardGroup(e,t);r.append(this),Y.Z.event.tencentMeetingEvent.trigger(Q.z.CARD_SHOW,{cardType:X.eT.COMMENT,cardOperationType:X.UQ.COMMENT_CARD_SHOW,cardPosition:{row:e,col:t},source:o}),n&&setTimeout((function(){r.adjustPositionByDiff()}))},n.removeInCardCenter=function(e){void 0===e&&(e=a.oz.USER),this.row>=0&&this.col>=0&&(this.cardCenter.getCardGroup(this.row,this.col).remove(this),Y.Z.event.tencentMeetingEvent.trigger(Q.z.CARD_HIDE,{cardType:X.eT.COMMENT,cardOperationType:X.UQ.COMMENT_CARD_HIDE,cardPosition:{row:this.row,col:this.col},source:e})),this.row=-1,this.col=-1,this.wrap.classList.remove("comment-card-wrap-offset")},n.triggerChangeCardContent=function(e,t){Y.Z.event.tencentMeetingEvent.trigger(e,{cardType:X.eT.COMMENT,cardOperationType:t,cardPosition:{row:this.row,col:this.col},source:a.oz.USER})},t}(J.Z),bt=It,xt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},St=function(e){function t(t){var n;return(n=e.call(this,t)||this).selectCells=t.selectCells,n.selectApi=t.selectApi,n.scrollApi=t.scrollApi,n.clientRect=t.clientRect,n.card=new bt({spreadsheet:t.spreadsheet,getQQGroupName:t.getQQGroupName,cardCenter:n.cardCenter,selectCells:n.selectCells,areaData:n.areaData,app:n.app,hasComment:n.hasComment,getAnchorId:n.getAnchorId,queryComment:n.queryComment,addComment:n.addComment,deleteComment:n.deleteComment,editComment:n.editComment}),n}(0,i.Z)(t,e);var n=t.prototype;return n.openComment=function(e,t,n){return void 0===n&&(n=a.oz.USER),xt(this,void 0,void 0,regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.card.showComment({activation:{row:e,col:t}},n);case 2:return o.next=4,this.card.openComment(e,t,n);case 4:case"end":return o.stop()}}),o,this)})))},n.hideComment=function(e){this.card.hide(e)},n.refreshCommentList=function(){return xt(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.card.updateComment();case 2:case"end":return e.stop()}}),e,this)})))},n.getCard=function(){return this.card},n.jumpToComment=function(e){return xt(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i,a,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.anchorId,o=e.commentId,r=e.sheetId,i=this.app.spreadsheet.activeSheet,(a=i.getSheetId())===r){t.next=7;break}if(!i||i.getDisplayHidden()){t.next=6;break}return t.abrupt("return",new Promise((function(e,t){s.ZP.sheetsBar.trigger("switchSheet",r,a,{onSuccess:function(){l.hasComment(n)?e(l.jumpToCell.bind(l,n,o)):t(new Error("没有评论"))},onFail:function(){s.ZP.sheetsBar.trigger("switchSheet",a),t(new Error("switch sheet error"))}})})));case 6:return t.abrupt("return",Promise.reject(new Error("sheetId not exist")));case 7:return t.abrupt("return",new Promise((function(e,t){l.hasComment(n)?e(l.jumpToCell.bind(l,n,o)):t(new Error("没有评论"))})));case 8:case"end":return t.stop()}}),t,this)})))},n.jumpToCell=function(e,t){var n=this.app.spreadsheet.activeSheet.sheetRangeManager.getSheetRange(e);if(!(null===n||void 0===n?void 0:n.gridRange))throw new Error("anchorId not exist");var o=n.gridRange;this.selectApi.selectCells(this.normalSelectData,{xRange:[o.startColIndex,o.endColIndex],yRange:[o.startRowIndex,o.endRowIndex]},null),this.scrollApi.scrollToDistanceAnchor({row:o.startRowIndex,col:o.startColIndex,top:60,left:this.clientRect.width/2}),this.card.activeComment(o.startRowIndex,o.startColIndex,t)},t}(G)},"../spread-sheet/src/core/view/level-2/corner-triangle/CornerTriangleRenderPlugin.ts":function(e,t,n){n.r(t);var o=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=n("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),i=n("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/CollectEngine.ts"),s=n("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/table/corner/utils/render-path.ts"),a=n("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/table/corner/utils/render-color.ts"),l=n("../packages/model/src/filter-view/filter-view-util.ts"),c=function(e){function t(t){var n;return(n=e.call(this,t)||this).renderAfterCorner=function(){var e=n._normalSelectData.selectQueue.some((function(e){return e.selectAll})),t=l.xJ(n.spreadsheet);if(e){var o=(0,s.ns)(n._transformTable.rowHeadWidth,n._transformTable.colHeadHeight);n._coverBackgroundCollect.collect({color:a.hB.hex,graphicsInfo:{path:o}},i.h.CORNER_TRIANGLE)}else if(t){var r=(0,s.ns)(n._transformTable.rowHeadWidth,n._transformTable.colHeadHeight);n._coverBackgroundCollect.collect({color:a.zP.hex,graphicsInfo:{path:r}},i.h.CORNER_TRIANGLE)}},n._normalSelectData=t.normalSelectData,n._transformTable=t.transformTable,n._coverBackgroundCollect=t.coverBackgroundCollect,n.spreadsheet=t.spreadsheet,n._alloyExcel.onAfterCornerRender(n.renderAfterCorner),n}return(0,o.Z)(t,e),t}(r.Z);t.default=c},"../spread-sheet/src/core/view/level-2/ent-link-center/constant/file-type.ts":function(e,t,n){var o;n.d(t,{G:function(){return o}}),function(e){e[e.WEDOCS=0]="WEDOCS",e[e.WEDRIVE=1]="WEDRIVE",e[e.WEDRIVE_AND_WEDOCS=2]="WEDRIVE_AND_WEDOCS"}(o||(o={}))},"../spread-sheet/src/core/view/level-2/filter-center/util.ts":function(e,t,n){n.d(t,{B5:function(){return C},Dh:function(){return _},Gr:function(){return E},WA:function(){return g},bU:function(){return y},c5:function(){return v}});var o=n("../node_modules/i18next/dist/esm/i18next.js"),r=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),i=n("../node_modules/@tencent/dui/lib/components/Modal/index.js"),s=n("../node_modules/@tencent/dui-mobile/lib/components/Modal/index.js"),a=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),l=n.n(a),c=n("../node_modules/lodash/throttle.js"),d=n.n(c),u=n("../spread-sheet/src/base/util/appConfig.ts"),p=n("../packages/model/src/range/index.ts"),h=n("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),m=n("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),f=l().isMobile?s.default:i.default,v=d()((function(){var e=r.q.getConfig("ownerNick")||"";e&&(e="「"+e+"」"),f.confirm({title:o.ZP.t("表格权限提示"),content:o.ZP.t("当前你只能查看表格。如需操作筛选，请联系创建者{{ownerNick}}关闭“筛选对所有人可见”开关。",{ownerNick:e}),cancelText:null,okText:o.ZP.t("确定")})}),300,{leading:!0,trailing:!1}),g=function(e){var t=e.spreadsheet.activeSheet.getBasicFilter();return!!t&&t.getIsLocalView()},_=function(e){if(!1!==u.Z.getConfig("custom.viewFilter")&&!e.sheetStatus.workbookStatus.canEdit){var t=e.spreadsheet.activeSheet.filterViewManager.getActiveFilterView();if(!t&&!e.spreadsheet.activeSheet.getBasicFilterInSheet())return!0;if(!t&&g(e))return!0;if(t&&!t.getBasicFilter())return!0}return!1},y=function(e,t){var n;return e.length>0&&!t.sheetStatus.workbookStatus.canEdit&&!1!==(null===(n=t.spreadsheet.activeSheet.getBasicFilter())||void 0===n?void 0:n.getIsLocalView())};function w(e,t){var n=e.activeSheet.getBasicFilter();if(!n)return null;var o=n.range,r=o.sheetId,i=o.startRowIndex,s=o.endRowIndex;return new p.GridRange(r,i,s,t,t)}function C(e,t){var n=w(e,t);return!!n&&!r.q.getConfig("isOwner")&&(0,h.Up)(e.workbookRangeManager,[n])}function E(e,t){var n=w(e,t);return!!n&&!r.q.getConfig("isOwner")&&(0,m.Nb)(e.parent,[n])}},"../spread-sheet/src/core/view/level-2/link-center/LinkCenter.pc.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return Je}});var o,r,i,s=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),l=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),c=n("react"),d=n.n(c),u=n("react-dom"),p=n.n(u),h=n("../spread-sheet/src/core/view/level-2/card-center/BaseCard.ts"),m=n("../spread-sheet/src/core/view/utils/base-func.ts"),f=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/classnames/index.js")),v=n.n(f),g=n("../spread-sheet/src/base/index.ts"),_=n("../spread-sheet/src/core/feature/copyPaste/clipboardCopy.ui.ts"),y=n("../spread-sheet/src/core/feature/copyPaste/lib/parsers/validUrl.ts"),w=n("../spread-sheet/src/core/view/level-2/link-center/enum.ts"),C=n("../spread-sheet/src/core/view/level-2/link-center/report/hover-component.ts"),E=n("../spread-sheet/src/core/view/level-2/link-center/utils/behavior.ts"),I=n("../spread-sheet/src/core/view/level-2/link-center/utils/checker.ts"),b=n("../spread-sheet/src/core/view/level-2/link-center/utils/hyperlink.ts"),x=n("../spread-sheet/src/core/view/lib/find-position.ts"),S=n("../packages/model/src/cell/HyperlinkType.ts"),k=n("../packages/model/src/cell/LinkIconType.ts"),A=n("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),D=n("../spread-sheet/src/core/feature/copyPaste/interfaces.ts"),T=n("../spread-sheet/src/core/view/level-2/link-center/report/attachment.ts"),P=(n("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),d().memo((function(){return d().createElement("div",{className:"link-box-divider"})}))),L=n("../node_modules/i18next/dist/esm/i18next.js"),R=d().memo((function(e){var t;return d().createElement("span",{className:v()("link-content",{"link-disabled":e.disabled}),style:null!==(t=e.customStyle)&&void 0!==t?t:{},onClick:e.onClick},e.actionButtonText||L.ZP.t("打开链接"))})),M=n("../node_modules/@tencent/dui/lib/components/Tooltip/index.js"),j=d().memo((function(e){var t;return d().createElement(M.default,{title:null!==(t=e.tooltipText)&&void 0!==t?t:L.ZP.t("取消链接"),placement:"top"},d().createElement("span",{id:"link-cancel",className:"link-icon link-cancel-button",onClick:e.onClick}))})),N=d().memo((function(e){var t;return d().createElement(M.default,{title:null!==(t=e.tooltipText)&&void 0!==t?t:L.ZP.t("复制链接"),placement:"top"},d().createElement("span",{id:"link-copy",className:"link-icon link-copy-button",onClick:e.onClick}))})),O=n("../node_modules/@tencent/dui/lib/components/Dropdown/index.js"),B=n("../node_modules/@tencent/dui/lib/components/Menu/index.js"),Z=d().memo((function(e){var t=d().createElement(B.default,{className:"link-icon-visibility-dropdown"},d().createElement(B.default.Item,{className:"text-link-button",selected:!e.status,onClick:function(){return e.onClick(!1)}},d().createElement("span",{className:"link-menu-item-icon"}),d().createElement("span",null,L.ZP.t("文字链"))),d().createElement(B.default.Item,{className:"icon-text-link-button",selected:e.status,onClick:function(){return e.onClick(!0)}},d().createElement("span",{className:"link-menu-item-icon"}),d().createElement("span",null,L.ZP.t("图标+文字链"))));return d().createElement(O.default,{alignment:"left",dropContent:t},d().createElement(M.default,{title:L.ZP.t("展示样式"),placement:"top"},d().createElement("span",{id:"link-icon-visibility",className:v()("link-icon","link-icon-dropdown",e.status?"icon-text-link-button":"text-link-button")},d().createElement("span",{className:"link-menu-item-icon"}),d().createElement("span",{className:"link-menu-arrow"}))))})),U=d().memo((function(e){var t;return d().createElement(M.default,{title:null!==(t=e.tooltipText)&&void 0!==t?t:L.ZP.t("下载"),placement:"top"},d().createElement("span",{id:"link-download",className:"link-icon link-download-button",onClick:e.onClick}))})),H=d().memo((function(e){var t;return d().createElement(M.default,{title:null!==(t=e.tooltipText)&&void 0!==t?t:L.ZP.t("修改链接"),placement:"top"},d().createElement("span",{id:"link-modify",className:"link-icon link-modify-button",onClick:e.onClick}))})),V=d().memo((function(e){var t;return d().createElement(M.default,{title:null!==(t=e.tooltipText)&&void 0!==t?t:L.ZP.t("删除"),placement:"top"},d().createElement("span",{id:"link-remove",className:"link-icon link-remove-button",onClick:e.onClick}))}));!function(e){e.URL_LINK="URL_LINK",e.CELL_LINK="CELL_LINK",e.SHEET_LINK="WORKBOOK_LINK",e.TENCENT_DOCS_NO_PREVIEW="TENCENT_DOCS_NO_PREVIEW",e.ATTACHMENT_NO_PREVIEW="ATTACHMENT_NO_PREVIEW",e.ATTACHMENT_READ_ONLY="ATTACHMENT_READ_ONLY"}(o||(o={})),function(e){e.TENCENT_DOCS="TENCENT_DOCS",e.IMAGE="IMAGE"}(r||(r={})),function(e){e.INIT="INIT",e.LOADING="LOADING",e.DONE="DONE",e.ERROR="ERROR"}(i||(i={})),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js");var K,G=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).render=function(){return t.linkToolbarNormalBox},t}return(0,a.Z)(t,e),(0,l.Z)(t,[{key:"linkToolbarNormalBox",get:function(){return d().createElement("div",{className:"link-box",style:this.props.style,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave},d().createElement("div",{className:v()("flex",this.props.boxClasses.split(" "))},this.props.actionButton,this.linkToolbarButtons))}},{key:"linkToolbarButtons",get:function(){var e=0!==this.props.componentList.length,t=v()("link-icons",{"no-icon":!e});return d().createElement("span",{className:t},this.props.componentList)}}]),t}(d().Component),z=G,F=(n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../packages/model/src/cell/index.ts")),W=n("../spread-sheet/src/core/view/level-2/preview-image-icon/iconSource.tsx"),Y=d().memo((function(e){return d().createElement("div",{className:"preview-loader loader-error"},d().createElement("div",{className:"error-icon"}),d().createElement("div",{className:"error-text"},d().createElement("span",null,L.ZP.t("预览失败"))),d().createElement("div",{className:"error-action"},d().createElement("a",{onClick:e.retryHandler},L.ZP.t("重试"))))})),q=d().memo((function(){return d().createElement("div",{className:"preview-loader loader-loading"},d().createElement("div",{className:"loading-spinner"}))})),Q=function(e){function t(t){var n;return(n=e.call(this,t)||this).props.onLoading(),n}return(0,a.Z)(t,e),t.prototype.render=function(){return d().createElement("div",{className:"link-preview link-preview-image"},d().createElement("img",{src:this.props.url,onLoad:this.props.onSuccess,onError:this.props.onError}))},t}(d().Component),X=function(e){return e.split("/")[3]},J=n("./node_modules/axios/index.js"),$=n.n(J),ee=n("../node_modules/qs/lib/index.js"),te=n.n(ee),ne=n("../spread-sheet/src/base/util/appConfig.ts"),oe=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},re=function(e,t){return oe(void 0,void 0,void 0,regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,$().post("https://"+ne.Z.getConfig("runtime.domainName")+e,te().stringify(t),{responseType:"blob",withCredentials:!0});case 3:return o=n.sent,n.abrupt("return",o.data);case 7:n.prev=7,n.t0=n.catch(0),console.error(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))},ie=function(e){return new Promise((function(t,n){var o=new FileReader;e?(o.onloadend=function(){return t(o.result)},o.readAsDataURL(e)):n("Can not retrieve link snapshot!")}))},se=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},ae=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={base64Image:""},n.props.onLoading(),n}(0,a.Z)(t,e);var o=t.prototype;return o.componentDidMount=function(){var e,t=this;(e=this.props.url,oe(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){var o,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e,r=X(e),i=n.g.spreadConfig.getConfig("padId"),t.next=6,re("/sdc/previewsnap",{share_url:o,type:r,padId:i,strategy:"imageMogr2/thumbnail/!70p"});case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).then((function(e){return se(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this,t.next=3,ie(e);case 3:t.t1=t.sent,t.t2={base64Image:t.t1},t.t0.setState.call(t.t0,t.t2),this.props.onSuccess();case 7:case"end":return t.stop()}}),t,this)})))})).catch((function(e){t.props.onError(e)}))},o.render=function(){var e={backgroundImage:this.state.base64Image?"url("+this.state.base64Image+")":"unset"};return d().createElement("div",{className:"link-preview link-preview-tdocs",style:e})},t}(d().Component),le=function(e){function t(t){var n,o,s;return(s=e.call(this,t)||this).previewLoaderMap=((n={})[i.INIT]=d().createElement(d().Fragment,null),n[i.LOADING]=d().createElement(q,null),n[i.DONE]=null,n[i.ERROR]=d().createElement(Y,{retryHandler:function(){return s.retryHandler()}}),n),s.previewComponentMap=((o={})[r.TENCENT_DOCS]=d().createElement(ae,Object.assign({url:s.props.url},s.previewLoadStatusHandler)),o[r.IMAGE]=d().createElement(Q,Object.assign({url:s.props.url},s.previewLoadStatusHandler)),o),s.render=function(){return s.linkToolbarPreviewBox},s.getPreviewIcon=function(){return s.previewImageIconSource.iconSrc[s.hyperlinkType]},s.hyperlinkType=(0,b.NK)(s.props.cellData)||F.HYPERLINK_TYPE.NORMAL,s.previewImageIconSource=new W.Z,s.previewIcon=s.getPreviewIcon(),s.state={previewLoadStatus:i.INIT,previewComponentNonce:s.getPreviewComponentNonce()},s}(0,a.Z)(t,e);var o=t.prototype;return o.onLoading=function(){this.setState({previewLoadStatus:i.LOADING})},o.onSuccess=function(){this.setState({previewLoadStatus:i.DONE})},o.onError=function(e){this.setState({previewLoadStatus:i.ERROR}),n.g.log.error("link-center - toolbar-preview load error",e)},o.retryHandler=function(){this.setState({previewComponentNonce:this.getPreviewComponentNonce()})},o.getPreviewComponentNonce=function(){return Math.random().toString()},(0,l.Z)(t,[{key:"linkToolbarPreviewBox",get:function(){return d().createElement("div",{className:"link-box link-toolbar-preview-box",style:this.props.style,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave},d().createElement("div",{className:"link-toolbar-box"},d().createElement("div",{className:"link-toolbar-icon",style:this.linkToolbarIconStyle}),d().createElement("div",{className:"link-toolbar"},this.linkToolbar)),d().createElement("div",{className:v()("link-preview-box",{"preview-ready":this.isPreviewReady,"preview-not-ready":!this.isPreviewReady})},this.previewComponent))}},{key:"linkToolbar",get:function(){return d().createElement(d().Fragment,null,d().createElement("div",{className:"link-toolbar-top"},this.linkToolbarTopTitle,this.linkToolbarTopButtons),d().createElement("div",{className:"link-toolbar-bottom"},this.linkToolbarBottomLink))}},{key:"linkToolbarTopTitle",get:function(){return d().createElement("div",{className:"link-toolbar-top-title"},this.props.title)}},{key:"linkToolbarTopButtons",get:function(){return d().createElement("div",{className:"link-toolbar-top-buttons"},this.props.componentList)}},{key:"linkToolbarBottomLink",get:function(){return d().createElement("a",{className:"link-toolbar-bottom-link",onClick:this.props.onClickURL},this.props.url)}},{key:"linkToolbarIconStyle",get:function(){return{backgroundImage:"url("+this.previewIcon+")"}}},{key:"previewComponent",get:function(){var e=this.previewComponentMap[this.props.type];return d().createElement("div",{key:this.state.previewComponentNonce,onClick:this.props.onExternalPreview},this.isPreviewReady?null:this.previewLoader,e)}},{key:"previewLoader",get:function(){var e=this.previewLoaderMap[this.state.previewLoadStatus];return d().createElement("div",{className:"loader-box",onClick:function(e){return e.stopPropagation()}},e)}},{key:"previewLoadStatusHandler",get:function(){return{onLoading:this.onLoading.bind(this),onSuccess:this.onSuccess.bind(this),onError:this.onError.bind(this)}}},{key:"isPreviewReady",get:function(){return this.state.previewLoadStatus===i.DONE}}]),t}(d().Component),ce=le,de=(n("../spread-sheet/src/base/util/domain-config.ts"),n("../packages/report/src/index.ts")),ue=function(e){de.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_link",action:"excel_link_click",ver10:e})},pe=n("../spread-sheet/src/external/view/mobile/header/container/helper.ts"),he=n("../spread-sheet/src/core/login/index.ts"),me=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},fe=function(e){function t(t){var n,i;(i=e.call(this,t)||this).isMouseInHoverBox=!1,i.componentListConfig=((n={})[o.URL_LINK]=[i.toolbarDivider,i.toolbarLinkCopyButton,i.toolbarLinkModifyButton,i.toolbarDivider,i.toolbarLinkCancelButton],n[o.CELL_LINK]=[i.toolbarDivider,i.toolbarLinkModifyButton,i.toolbarDivider,i.toolbarLinkCancelButton],n[o.SHEET_LINK]=[i.toolbarDivider,i.toolbarLinkModifyButton,i.toolbarDivider,i.toolbarLinkCancelButton],n[o.TENCENT_DOCS_NO_PREVIEW]=[i.toolbarDivider,i.toolbarLinkCopyButton,i.toolbarLinkModifyButton,i.toolbarDivider,i.toolbarLinkDisplayStyleButton(i.isLinkIconVisible),i.toolbarDivider,i.toolbarLinkCancelButton],n[o.ATTACHMENT_NO_PREVIEW]=[i.toolbarDivider,i.toolbarLinkDisplayStyleButton(i.isLinkIconVisible),i.toolbarDivider,i.toolbarLinkRemoveButton],n[o.ATTACHMENT_READ_ONLY]=[],n[r.IMAGE]=[i.toolbarLinkModifyButton,i.toolbarLinkDownloadButton,i.toolbarLinkRemoveButton],n[r.TENCENT_DOCS]=[i.toolbarLinkCopyButton,i.toolbarLinkModifyButton,i.toolbarLinkDisplayStyleButton(i.isLinkIconVisible),i.toolbarDivider,i.toolbarLinkCancelButton],n),i.getHoverBoxPosition=function(){var e=i.props.areaData.getDisplayViewTopByRow(i.props.row),t=i.props.areaData.getDisplayViewLeftByCol(i.props.col),n=i.props.rowcolAccessor.getRowDisplayHeight(i.props.row)*i.props.scale.scale,o=i.props.rowcolAccessor.getColSetWidth(i.props.col)*i.props.scale.scale,r=(0,x.s)({width:200,height:35},{left:t,top:e,height:n,width:o},{minX:i.props.headSize.displayRowHeadWidth,maxX:i.props.clientRect.width,minY:i.props.headSize.displayColHeadHeight,maxY:i.props.clientRect.height},{sourceYDir:-1});return{x:r.left,y:r.top}},i.mouseMoveHandler=function(){g.Z.util.timer.erase(i.hoverHideTimer),i.isMouseInHoverBox||i.props.operateData.currCol===i.props.col&&i.props.operateData.currRow===i.props.row||(i.hoverHideTimer=g.Z.util.timer.wait(1e3).run(i.props.hideBox))},i.mouseEnterHandler=function(){i.isMouseInHoverBox=!0,g.Z.util.timer.erase(i.hoverHideTimer)},i.mouseLeaveHandler=function(){i.isMouseInHoverBox=!1},i.copyLinkHandler=function(){var e=i.props.url;(0,_.ES)({copyContent:{html:"",plain:e},type:D.GI.input}),i.props.hideBox()},i.modifyIconVisibilityHandler=function(e){var t=i.props,n=t.spreadsheet,o=t.row,r=t.col;i.props.setHyperlinkIconVisibility(e),i.props.hideBox(),(0,I.SB)(n,o,r)&&(0,T.WO)()},i.openUrlHandler=function(){return me((0,s.Z)(i),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o,r,i,s,a,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.hideBox(!0),t=this.props,n=t.type,o=t.openCellLinkUrl,r=t.openUrl,i=t.row,s=t.col,a=t.openSheetUrl,n!==w.B.CELL_LINK){e.next=6;break}o(i,s),e.next=21;break;case 6:if(n!==w.B.SHEET_LINK){e.next=10;break}a(this.url),e.next=21;break;case 10:if(n!==w.B.PHONE_NUMBER_LINK){e.next=14;break}return e.abrupt("return");case 14:if(n!==w.B.ATTACHMENT){e.next=19;break}return this.downloadAttachment(),e.abrupt("return");case 19:l=(0,b.Y_)(this.props.url),r(l);case 21:ue(n),(0,C.me)((0,b.wI)(this.cellData));case 24:case"end":return e.stop()}}),e,this)})))},i.linkCancelHandler=function(){i.props.cancelLink(),i.props.hideBox()},i.linkRemoveHandler=function(){var e=i.props,t=e.spreadsheet,n=e.row,o=e.col;i.props.clearContent(),i.props.hideBox(),(0,I.SB)(t,n,o)?(0,T.SC)():(0,I.nu)(t,n,o)&&(0,C.Xv)()},i.triggerExternalPreview=function(){i.hyperlinkPreviewType===r.IMAGE&&((0,E.X7)(i.props.spreadsheet,i.props.row,i.props.col),i.props.hideBox())},i.wrapComponentWithRef=function(e){return d().createElement("div",{ref:i.contentRef},e)},i.contentRef=d().createRef();var a=t.spreadsheet,l=t.row,c=t.col,u=a.activeSheet.getCellDataAtPosition(l,c);if(!u)throw new Error("link-center - HoverBox: CellData不存在！");return i.cellData=u,i}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e,t,n,o;this.mouseMoveDisposable=null===(e=this.props.mouseOperate)||void 0===e?void 0:e.onMousemove(this.mouseMoveHandler);var r=(null===(t=this.contentRef)||void 0===t?void 0:t.current)||{},i=r.clientWidth,s=r.clientHeight;i&&s&&(null===(o=null===(n=this.props.cardGroup)||void 0===n?void 0:n.adjustPosition)||void 0===o||o.call(n,{width:i,height:s})),(0,C.vY)((0,b.wI)(this.cellData))},n.componentDidUpdate=function(){g.Z.util.timer.erase(this.hoverHideTimer)},n.componentWillUnmount=function(){var e;g.Z.util.timer.erase(this.hoverHideTimer),null===(e=this.mouseMoveDisposable)||void 0===e||e.dispose()},n.render=function(){var e=this.props,t=e.hyperLinkText,n=e.disabled,o=e.spreadsheet,r=e.row,i=e.col,s=this.cellData,a=this.getLayoutProps(),l=a.commonNormalPreviewLayoutProps,c=a.commonPreviewLayoutProps;return!s||(0,A.xy)(o,r,i)?null:(0,I.nu)(o,r,i)?this.wrapComponentWithRef(this.renderImagePreviewHoverBox(c)):this.wrapComponentWithRef(this.renderToolbarNormalHoverBox(l,null!==n&&void 0!==n&&n,t))},n.renderImagePreviewHoverBox=function(e){return this.hyperlinkPreviewType=r.IMAGE,d().createElement(ce,Object.assign({},e,{type:this.hyperlinkPreviewType}))},n.renderTencentDocsPreviewHoverBox=function(e){return this.hyperlinkPreviewType=r.TENCENT_DOCS,d().createElement(ce,Object.assign({},e,{type:this.hyperlinkPreviewType}))},n.renderToolbarNormalHoverBox=function(e,t,n){return d().createElement(z,Object.assign({},e,{actionButton:this.toolbarLinkActionButton(t,{actionButtonText:n,customStyle:this.hoverBoxStyle})}))},n.componentList=function(e){var t=(0,b.NK)(e),n=this.props,i=n.spreadsheet,s=n.row,a=n.col;if(e.getHyperlinkRuns())return this.componentListConfig[o.CELL_LINK];if((0,I.SB)(i,s,a))return!1===this.props.canEdit?this.componentListConfig[o.ATTACHMENT_READ_ONLY]:this.componentListConfig[o.ATTACHMENT_NO_PREVIEW];switch(t){case S.ZP.IMAGE:return this.componentListConfig[r.IMAGE];case S.ZP.SHEET_LINK:return this.componentListConfig[o.SHEET_LINK]}return(0,y.D)(this.url)?(0,I.Rw)((0,b.wI)(this.cellData))?this.componentListConfig[o.TENCENT_DOCS_NO_PREVIEW]:this.componentListConfig[o.URL_LINK]:void 0},n.getLayoutProps=function(){var e,t=this.props,n=t.disabled,o=t.text,r=this.cellData,i={title:o,url:this.url,style:this.hoverBoxStyle,boxClasses:this.hoverBoxClasses,cellData:r,disabled:n,onMouseEnter:this.mouseEnterHandler,onMouseLeave:this.mouseLeaveHandler,onClickURL:this.openUrlHandler,componentList:null!==(e=this.componentList(r))&&void 0!==e?e:[]};return{commonNormalPreviewLayoutProps:Object.assign({},i),commonPreviewLayoutProps:Object.assign(Object.assign({},i),{onExternalPreview:this.triggerExternalPreview})}},n.toolbarLinkActionButton=function(e,t){var n=this;return d().createElement(R,{disabled:e,onClick:function(){var e;return(null!==(e=null===t||void 0===t?void 0:t.actionButtonClickHandler)&&void 0!==e?e:n.openUrlHandler)()},actionButtonText:null===t||void 0===t?void 0:t.actionButtonText})},n.toolbarLinkDisplayStyleButton=function(e){var t=this;return d().createElement(Z,{onClick:function(e){return t.modifyIconVisibilityHandler(e)},status:e})},n.downloadAttachment=function(){return me(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,pe.ZR)()){e.next=2;break}return e.abrupt("return",he.Z.showLoginModal());case 2:return t=(0,b.E1)(this.url),e.next=5,this.props.spreadsheet.parent.view.canvas.linkCenter.attachmentUploadingManager.getAttachmentExtension();case 5:e.sent.download(t),(0,T.jV)();case 8:case"end":return e.stop()}}),e,this)})))},(0,l.Z)(t,[{key:"url",get:function(){var e=this.props,t=e.type,n=e.url;return t===w.B.CELL_LINK||t===w.B.SHEET_LINK?n:(0,b.Y_)(n)}},{key:"hoverBoxPosition",get:function(){return this.getHoverBoxPosition()}},{key:"hoverBoxClasses",get:function(){return v()({"link-box-inner":!0})}},{key:"hoverBoxStyle",get:function(){var e=this.hoverBoxPosition;return{visibility:"visible",left:e.x+"px",top:e.y+"px"}}},{key:"toolbarLinkDownloadButton",get:function(){var e=this;return d().createElement(U,{onClick:function(){return(0,E.GN)(e.url,e.props.text)}})}},{key:"toolbarLinkCopyButton",get:function(){var e=this;return d().createElement(N,{onClick:function(){return e.copyLinkHandler()}})}},{key:"toolbarLinkModifyButton",get:function(){var e=this;return d().createElement(H,{onClick:function(){return e.props.toggleModify()}})}},{key:"toolbarDivider",get:function(){return d().createElement(P,null)}},{key:"toolbarLinkCancelButton",get:function(){var e=this;return d().createElement(j,{onClick:function(){return e.linkCancelHandler()}})}},{key:"toolbarLinkRemoveButton",get:function(){var e=this;return d().createElement(V,{onClick:function(){return e.linkRemoveHandler()}})}},{key:"isLinkIconVisible",get:function(){var e=this.props.spreadsheet.activeSheet.getCellDataAtPosition(this.props.row,this.props.col);return!!e&&e.getLinkIconStatus()!==k.Z.PLAIN_TEXT}}]),t}(d().Component),ve=(n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/@tencent/dui/lib/utils/stylusAdapter.js")),ge=n("../spread-sheet/src/base/util/phone-number.ts"),_e=n("../spread-sheet/src/base/util/url.ts"),ye=function(e){function t(t){var n;return(n=e.call(this,t)||this).openUrlHandler=n.openUrlHandler.bind((0,s.Z)(n)),n.contentRef=d().createRef(),n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e,t,n=this.contentRef.current||{},o=n.clientWidth,r=n.clientHeight;o&&r&&(null===(t=null===(e=this.props.cardGroup)||void 0===e?void 0:e.adjustPosition)||void 0===t||t.call(e,{width:o,height:r}))},n.render=function(){var e=this.props,t=e.hyperLinkText,n=e.type,o=(0,b.Y_)(this.props.url),r={visibility:"visible"},i="link-icon";switch(n){case w.B.PHONE_NUMBER_LINK:i="link-call-icon";break;case w.B.EMAIL_LINK:i="link-email-icon";break;default:i="link-icon"}return _e.vj.test(this.props.url)&&(i="link-email-icon"),d().createElement(ve.WithStylusClick,{clickHandler:this.openUrlHandler},d().createElement("div",{className:"link-box",style:r,ref:this.contentRef},d().createElement("div",{className:this.props.disabled?"link-content link-disabled":"link-content",onClick:this.openUrlHandler},d().createElement("span",{className:"icon-item "+i}),t||o)))},n.openUrlHandler=function(e){null===e||void 0===e||e.stopPropagation();var t=this.props,n=t.type,o=t.openCellLinkUrl,r=t.openUrl,i=t.row,s=t.col,a=t.openSheetUrl;if((0,t.hideBox)(),n===w.B.CELL_LINK)o(i,s);else if(n===w.B.SHEET_LINK)a(this.props.url);else if(n===w.B.PHONE_NUMBER_LINK){var l=(0,ge.un)(this.props.url),c=String(l).replace(/(\s)/g,"");(0,ge.YH)(c)}else if(n===w.B.EMAIL_LINK||_e.vj.test(this.props.url)){var d=(0,b.Y_)(this.props.url);(0,ge.E$)(d)}else r((0,b.Y_)(this.props.url));de.ZP.tdwReport({opername:"doc_sheet",module:"edit_sheet",action:"link_tips_click"}),ue(n)},t}(d().Component),we=(n("../node_modules/core-js/modules/es.string.trim.js"),n("../node_modules/core-js/modules/es.string.starts-with.js"),n("../node_modules/core-js/modules/es.string.ends-with.js"),n("../spread-sheet/src/external/view/main/panel/rangeSelectionPanel/util.ts")),Ce=n("../node_modules/lodash/debounce.js"),Ee=n.n(Ce),Ie=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),be=n.n(Ie),xe=n("../node_modules/@tencent/dui/lib/components/Button/index.js"),Se=n("../node_modules/@tencent/dui/lib/components/Select/index.js"),ke=n("../packages/model/src/cell/format/HorizontalAlign.ts"),Ae=n("../packages/model/src/range/index.ts"),De=n("../packages/model/src/range/hexRangeUtils.ts"),Te=(n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/@tencent/dui/lib/components/Radio/index.js")),Pe=function(e){var t=e.selectedValue,n=e.handleChange,o=e.linkList,r=e.scrollEl;return d().createElement(Te.default.Group,{className:"sheet-link-content-container",value:t,onChange:n,ref:r},o.map((function(e){var t=e.title,n=e.sheetId;return d().createElement(Te.default,{hollow:!1,style:{paddingBottom:"12px"},value:n,shape:"circle"},t)})))},Le=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleChange=function(e){n.props.handleChange(e)},n.scrollEl=d().createRef(),n}(0,a.Z)(t,e);var n=t.prototype;return n.getSnapshotBeforeUpdate=function(){return p().findDOMNode(this.scrollEl.current).scrollTop},n.componentDidUpdate=function(e,t,n){p().findDOMNode(this.scrollEl.current).scrollTop=n},n.render=function(){var e=this.props,t=e.selectedValue,n=e.linkList;return d().createElement(d().Fragment,null,d().createElement("div",{className:"link-modify-line",key:t},d().createElement("label",{className:"link-modify-title sheet-link-content-label"},L.ZP.t("工作表")),d().createElement(Pe,{handleChange:this.handleChange,linkList:n,selectedValue:t,scrollEl:this.scrollEl})))},t}(d().Component),Re=/^#tab=/i,Me=function(){function e(e,t){var n=this;this.handleChange=function(e){var t,o=null===(t=n.spreadsheet.sheetManager.getSheetBySheetId(e))||void 0===t?void 0:t.properties.title;n.handleSheetLinkChange("#tab="+e,o||"")},this.spreadsheet=e,this.handleSheetLinkChange=t}var t=e.prototype;return t.parseSelctedStr=function(e){return void 0===e?"":Re.test(e)?e.substr(5):e},t.generateContent=function(e){var t={linkList:this.spreadsheet.sheetManager.sheetList.map((function(e){return e.properties})),selectedValue:this.parseSelctedStr(e),handleChange:this.handleChange};return d().createElement(Le,t)},e}(),je=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},Ne=function(e){function t(t){var n;(n=e.call(this,t)||this).ref=d().createRef(),n.handleSheetLinkChange=function(e,t){var o=n.shouldDisableTextInput()||!!n.state.textValue;n.setState({urlValue:e,textValue:o?n.state.textValue:t},(function(){var e;null===(e=n.textInput)||void 0===e||e.focus()}))},n.getArrowOffset=function(){var e=n.props,t=e.rowcolAccessor,o=e.areaData,r=e.col,i=e.headSize,s=e.containerLeft;return o.getDisplayViewLeftByCol(r)+i.displayRowHeadWidth+.5*Math.min(t.getColSetWidth(n.props.col)*n.props.scale.scale,388)-s+"px"},n.keydownApply=function(e){13===e.keyCode&&n.doApply(),e.stopPropagation()},n.handleTextChange=function(e){n.setState({textValue:e.target.value}),n.getTextValue(n.state.urlValue)},n.handleTitle=function(e){de.ZP.monitor(35271163),de.ZP.tdwReport({opername:"link",module:"link_set",action:"link_tdocname_set"}),n.setState({textValue:e,isShowTitleTip:!1,isTextMultiline:!1})},n.handleUrlChange=function(e){var t=e.target.value;n.setState({urlValue:t,showWarning:t.length<0}),n.getTextValue(t)},n.getTextValue=Ee()((function(e){return je((0,s.Z)(n),void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.type!==w.B.CELL_LINK&&this.state.type!==w.B.EMAIL_LINK&&this.state.type!==w.B.PHONE_NUMBER_LINK){t.next=2;break}return t.abrupt("return");case 2:if((0,_e.KM)(e)){t.next=5;break}return this.setState({titleTip:"",isShowTitleTip:!1}),t.abrupt("return");case 5:return t.prev=5,t.next=8,(0,_e.sx)(e);case 8:n=t.sent,this.state.textValue!==n.title&&this.setState({titleTip:n.title,isShowTitleTip:!0}),de.ZP.monitor(35271154),de.ZP.tdwReport({opername:"link",module:"link_set",action:"link_tdocname_show"}),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(5),this.setState({titleTip:"",isShowTitleTip:!1});case 16:case"end":return t.stop()}}),t,this,[[5,13]])})))}),500),n.handleApplyLink=function(e,t){var o=n.props.spreadsheet.parent.view.canvas.inputManager;return n.state.type===w.B.URL&&e?(n.handleNormalUrl(t,e),void o.handleExitInput({discard:!0})):n.state.type!==w.B.SHEET_LINK?n.state.type===w.B.CELL_LINK&&(0,De.isValidHexRangeOnSpreadsheet)(t,n.props.spreadsheet)?(n.handleCellLink(t),void o.handleExitInput({discard:!0})):n.state.type===w.B.PHONE_NUMBER_LINK?(n.handlePhoneNumberLink(t),void o.handleExitInput({discard:!0})):n.state.type===w.B.EMAIL_LINK&&(n.handleEmailLink(t),void o.handleExitInput({discard:!0})):void n.handleSheetUrl(t)},n.doApply=function(){var e,t,o=n.state.urlValue;0!==o.length&&("string"===typeof o&&(o=o.trim(),t=(0,_e.Kc)(o,!0)),void 0!==n.handleApplyLink(t,o)&&(be().isIPad&&(null===(e=n.linkInput)||void 0===e||e.focus()),n.showWarning()))},n.handleNormalUrl=function(e,t){n.hideWarnning();var o=(0,_e.KM)(t),r=n.state.isTextMultiline?n.props.text:n.state.textValue;if(o)return n.props.insertHyperLink(r,e,o,ke.Z.LEFT),void n.props.hideBox();n.props.insertLink(r,e),n.props.hideBox()},n.handleSheetUrl=function(e){var t=n.props.spreadsheet,o=e.substr(5);t.sheetManager.hasSheetId(o)||console.error("sheet id invalid"),n.hideWarnning();var r=""+e;n.props.insertHyperLink(n.state.isTextMultiline?n.props.text:n.state.textValue,r,F.HYPERLINK_TYPE.SHEET_LINK),n.props.hideBox()},n.handleCellLink=function(e){var t,o,r=null===(t=e.split(",")[0])||void 0===t?void 0:t.split("!"),i=r[0],s=r[1],a=i;i.startsWith("'")&&i.endsWith("'")&&(a=i.substring(1,i.length-1));var l=null===(o=n.props.spreadsheet.sheetManager.getSheetBySheetTitle(a))||void 0===o?void 0:o.getSheetId();if(!l)return console.log("sheetId invalid");var c=(0,De.hex2Range)(s,l),d=c.startRowIndex,u=c.endRowIndex,p=c.startColIndex,h=c.endColIndex,m=new Ae.GridRange({sheetId:l,startRowIndex:d,endRowIndex:u,startColIndex:p,endColIndex:h});n.props.setHyperlinkRuns({linkValue:n.state.isTextMultiline?n.props.text:n.state.textValue,range:m}),n.props.hideBox()},n.handleEmailLink=function(e){var t=n.state.isTextMultiline?n.props.text:n.state.textValue,o=!!e&&_e.vj.test(e);if(n.state.type===w.B.EMAIL_LINK&&o)return n.props.insertHyperLink(t||e,e,F.HYPERLINK_TYPE.EMAIL_LINK),void n.props.hideBox();n.showWarning()},n.handlePhoneNumberLink=function(e){var t=n.state.isTextMultiline?n.props.text:n.state.textValue,o=(0,ge.un)(e),r=(0,ge.AI)(o);if(n.state.type===w.B.PHONE_NUMBER_LINK&&r.isValid){var i=String(e).replace(/(\s)/g,"");return n.props.insertHyperLink(t||e,i,F.HYPERLINK_TYPE.PHONE_NUMBER_LINK),void n.props.hideBox()}n.showWarning()},n.cancel=function(){n.props.cancelLink(),n.props.hideBox()},n.showModifyLinkedRange=function(){n.props.hideBox();var e=n.props.spreadsheet.parent;e.event.linkCenter.trigger("showSelectRangePanel",n.selectRangeOnOk,n.selectRangeOnCancel,{defaultValue:n.state.urlValue,enableSheetAction:!0,col:n.props.col,row:n.props.row,noRangeAuthCheck:!0,checkSheetId:!0,activeSheetId:e.spreadsheet.activeSheetId})},n.selectRangeOnOk=function(e,t,o){var r=o.activeSheetId;n.setState({urlValue:e}),n.props.switchSheet({sheetId:r}).then((function(){n.showModifyBox(e,(function(){var e,t,o;null===(e=n.textInput)||void 0===e||e.focus(),null===(t=n.textInput)||void 0===t||t.setSelectionRange(0,null===(o=n.textInput)||void 0===o?void 0:o.value.length)}))}))},n.selectRangeOnCancel=function(e){var t=e.activeSheetId;n.props.switchSheet({sheetId:t}).then((function(){n.showModifyBox(n.state.urlValue)}))},n.generateMenu=function(){var e=n.state.type;return d().createElement(Se.default,{style:{width:"232px",height:"36px",borderRadius:"4px"},defaultValue:e.toString(),onChange:n.handleMenuChange},d().createElement(Se.default.Option,{value:w.B.URL},L.ZP.t("网页")),d().createElement(Se.default.Option,{value:w.B.CELL_LINK},L.ZP.t("单元格范围")),d().createElement(Se.default.Option,{value:w.B.SHEET_LINK},L.ZP.t("工作表")),d().createElement(Se.default.Option,{value:w.B.EMAIL_LINK},L.ZP.t("电子邮件")),d().createElement(Se.default.Option,{value:w.B.PHONE_NUMBER_LINK},L.ZP.t("电话号码")))},n.handleMenuChange=function(e){e!==n.state.type&&n.setState({urlValue:"",type:e},(function(){e!==w.B.CELL_LINK||(0,De.isValidHexRangeOnSpreadsheet)(n.state.urlValue,n.props.spreadsheet)||n.showModifyLinkedRange();var t=n.ref.current.getBoundingClientRect(),o=t.width,r=t.height;n.props.cardGroup.adjustPosition({width:o,height:r})}))},n.generateLinkContent=function(){switch(n.state.type){case w.B.URL:return n.generateLinkURL();case w.B.CELL_LINK:return n.generateLinkCell();case w.B.SHEET_LINK:return n.sheetLinkController.generateContent(n.state.urlValue);case w.B.EMAIL_LINK:return n.generateLinkEmail();case w.B.PHONE_NUMBER_LINK:return n.generateLinkPhoneNumber();default:return}},n.generateLinkURL=function(){var e=v()({"link-modify-warnning":!0,show:n.state.showWarning}),t=v()({"link-modify-input":!0,"link-input":!0,"link-modify-input-warn":n.state.showWarning});return d().createElement(d().Fragment,null,d().createElement("div",{className:"link-modify-line"},d().createElement("label",{className:"link-modify-title"},L.ZP.t("ui|modifyBox address")),d().createElement("input",{ref:function(e){n.linkInput=e||n.linkInput},className:t,type:"text",placeholder:L.ZP.t("请输入链接地址"),value:n.state.urlValue,onChange:n.handleUrlChange})),n.state.showWarning?d().createElement("div",{className:e},L.ZP.t("请输入有效的链接")):"")},n.generateLinkCell=function(){var e=v()({"link-modify-warnning":!0,show:n.state.showWarning}),t=v()({"link-modify-input":!0,"link-input":!0,"link-modify-input-warn":n.state.showWarning});return d().createElement(d().Fragment,null,d().createElement("div",{className:"link-modify-line",style:{position:"relative"}},d().createElement("label",{className:"link-modify-title"},L.ZP.t("单元格范围")),d().createElement("input",{ref:function(e){n.linkInput=e||n.linkInput},className:t,type:"text",placeholder:L.ZP.t("请输入单元格范围"),value:n.state.urlValue,style:{paddingRight:"32px",width:"232px"},onChange:n.handleUrlChange}),d().createElement("button",{id:"link-modify-cell-selector",onClick:n.showModifyLinkedRange})),n.state.showWarning?d().createElement("div",{className:e},we.lo):"")},n.generateLinkEmail=function(){var e=v()({"link-modify-warnning":!0,show:n.state.showWarning}),t=v()({"link-modify-input":!0,"link-input":!0,"link-modify-input-warn":n.state.showWarning});return d().createElement(d().Fragment,null,d().createElement("div",{className:"link-modify-line"},d().createElement("label",{className:"link-modify-title"},L.ZP.t("ui|modifyBox email address")),d().createElement("input",{ref:function(e){n.linkInput=e||n.linkInput},className:t,type:"text",placeholder:L.ZP.t("ui|modifyBox enter email address"),value:n.state.urlValue,onChange:n.handleUrlChange})),n.state.showWarning?d().createElement("div",{className:e},L.ZP.t("ui|modifyBox valid email address")):"")},n.generateLinkPhoneNumber=function(){var e=v()({"link-modify-warnning":!0,show:n.state.showWarning}),t=v()({"link-modify-input":!0,"link-input":!0,"link-modify-input-warn":n.state.showWarning});return d().createElement(d().Fragment,null,d().createElement("div",{className:"link-modify-line"},d().createElement("label",{className:"link-modify-title"},L.ZP.t("电话号码")),d().createElement("input",{ref:function(e){n.linkInput=e||n.linkInput},className:t,type:"text",placeholder:L.ZP.t("请输入电话号码"),value:n.state.urlValue,onChange:n.handleUrlChange})),n.state.showWarning?d().createElement("div",{className:e},L.ZP.t("请输入有效的电话号码")):"")},n.generateDropdown=function(){return d().createElement("div",{className:"link-modify-line"},d().createElement("label",{className:"link-modify-title"},L.ZP.t("链接至")),n.generateMenu())},n.checkApplyBtnValid=function(){return(n.state.type===w.B.URL||n.state.type===w.B.CELL_LINK||n.state.type===w.B.SHEET_LINK||n.state.type===w.B.EMAIL_LINK||n.state.type===w.B.PHONE_NUMBER_LINK)&&!!n.state.urlValue&&!!n.state.textValue},n.getClass=function(){return{waringClasses:v()({"link-modify-warnning":!0,show:n.state.showWarning}),applyClasses:v()({"link-modify-confirm-button":!0,"link-modify-valid":n.checkApplyBtnValid()}),urlInputClasses:v()({"link-modify-input":!0,"link-input":!0,"link-modify-input-warn":n.state.showWarning})}},n.getPadComponent=function(){if(be().isIPad)return d().createElement(d().Fragment,null,d().createElement("div",{className:"link-modify-header"},d().createElement("div",{className:"link-modify-header-text",onClick:n.cancel},L.ZP.t("取消")),d().createElement("div",{className:"link-modify-header-btn",onClick:n.doApply},L.ZP.t("完成"))),d().createElement("div",{className:"link-modify-split"}))};var o=t.url;t.type!==w.B.CELL_LINK||(0,De.isValidHexRangeOnSpreadsheet)(t.url,n.props.spreadsheet)||(o="");var r=String.fromCharCode(10),i=(t.text||"").indexOf(r)>=0;return n.state={textValue:i?L.ZP.t("选区内涉及换行文本，修改会导致换行丢失。"):t.text,urlValue:o,showWarning:!1,titleTip:"",isShowTitleTip:!1,dropdownVisible:!1,type:t.type,isTextMultiline:i},n.handleVisibleChange=n.handleVisibleChange.bind((0,s.Z)(n)),n.sheetLinkController=new Me(t.spreadsheet,n.handleSheetLinkChange),n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e,t,n,o,r,i;""===this.state.textValue||null===this.state.textValue?null===(e=this.textInput)||void 0===e||e.focus():this.state.type===w.B.CELL_LINK?null===(t=this.linkInput)||void 0===t||t.focus():(null===(n=this.linkInput)||void 0===n||n.select(),null===(o=this.linkInput)||void 0===o||o.focus()),null===(r=this.textInput)||void 0===r||r.addEventListener("keydown",this.keydownApply),null===(i=this.linkInput)||void 0===i||i.addEventListener("keydown",this.keydownApply),this.getTextValue(this.state.urlValue)},n.hideWarnning=function(){this.setState({showWarning:!1})},n.showWarning=function(){this.setState({showWarning:!0})},n.showModifyBox=function(e,t){var n=this,o=this.props,r=o.row,i=o.col,s=o.showModifyBox;this.props.scrollToVisible((function(){setTimeout((function(){s(r,i,w.B.CELL_LINK,e,n.state.textValue),null===t||void 0===t||t()}),0)}))},n.handleVisibleChange=function(e){this.setState({dropdownVisible:e})},n.shouldDisableTextInput=function(){var e=this.props,t=e.spreadsheet,n=e.row,o=e.col;return Boolean(this.state.isTextMultiline||t.activeSheet.getCellImage(n,o))},n.render=function(){var e=this,t=this.getClass().applyClasses,n=this.shouldDisableTextInput(),o=this.state.isShowTitleTip;return d().createElement("div",{tabIndex:0,className:"link-modify-wrap "+(be().isIPad?"ipad":""),ref:this.ref},d().createElement("div",{className:"link-arrow",style:{left:this.getArrowOffset()}}),d().createElement("div",{className:"link-modify-content","data-testid":"link-modify-content"},this.getPadComponent(),d().createElement("div",{className:"link-modify-line"},d().createElement("label",{className:"link-modify-title"},L.ZP.t("ui|modifyBox display text")),d().createElement("input",{ref:function(t){e.textInput=t||e.textInput},className:"link-modify-input",type:"text",value:this.state.textValue,onChange:this.handleTextChange,disabled:n,placeholder:L.ZP.t("ui|modifyBox enter display text")})),d().createElement("div",{style:{display:o&&!n?"flex":"none"},className:"link-modify-title-tips"},d().createElement("span",{className:"link-modify-title"},L.ZP.t("文档名：《"),this.state.titleTip,"》"),d().createElement("label",{className:"link-modify-title-change-button",onClick:this.handleTitle.bind(this,this.state.titleTip)},L.ZP.t("替换文本"))),this.generateDropdown(),this.generateLinkContent(),d().createElement("div",{className:"bottom-wrap"},d().createElement(xe.default,{type:"primary",className:t+" modify-link-range-btn",onClick:this.doApply},L.ZP.t("确定")),d().createElement(xe.default,{className:"modify-link-range-btn",onClick:this.props.hideBox},L.ZP.t("取消")))))},t}(d().Component);!function(e){e[e.EMPTY=0]="EMPTY",e[e.HOVER=1]="HOVER",e[e.MODIFY=2]="MODIFY"}(K||(K={}));var Oe=function(e){function t(){return e.apply(this,arguments)||this}return(0,a.Z)(t,e),t.prototype.render=function(){var e,t=this.props,n=t.url,o=t.text,r=t.spreadsheet,i=t.showModifyBox,s=t.type,a=t.hyperLinkText,l=t.containerLeft,c=t.cardGroup,u=be().isIPad?ye:fe;switch(this.props.status){case K.MODIFY:e=d().createElement(Ne,{text:o,url:n,type:s,cancelLink:this.props.cancelLink,insertLink:this.props.insertLink,insertHyperLink:this.props.insertHyperLink,setHyperlinkRuns:this.props.setHyperlinkRuns,switchSheet:this.props.switchSheet,row:this.props.row,col:this.props.col,headSize:this.props.headSize,clientRect:this.props.clientRect,areaData:this.props.areaData,rowcolAccessor:this.props.rowcolAccessor,hideBox:this.props.hideBox,scale:this.props.scale,spreadsheet:r,showModifyBox:i,containerLeft:l,scrollToVisible:this.props.scrollToVisible,cardGroup:this.props.cardGroup,canEdit:this.props.canEdit});break;case K.HOVER:e=d().createElement(u,{spreadsheet:this.props.spreadsheet,url:n,text:o,type:s,clearContent:this.props.clearContent,setHyperlinkIconVisibility:this.props.setHyperlinkIconVisibility,cancelLink:this.props.cancelLink,toggleModify:this.props.toggleModify,openUrl:this.props.openUrl,openSheetUrl:this.props.openSheetUrl,openCellLinkUrl:this.props.openCellLinkUrl,row:this.props.row,col:this.props.col,headSize:this.props.headSize,clientRect:this.props.clientRect,areaData:this.props.areaData,rowcolAccessor:this.props.rowcolAccessor,mouseOperate:this.props.mouseOperate,operateData:this.props.operateData,hideBox:this.props.hideBox,scale:this.props.scale,hyperLinkText:a,disabled:this.props.disabled,cardGroup:c,canEdit:this.props.canEdit})}return d().createElement("div",{className:"link-card-box",onClick:m.UW,onDoubleClick:m.UW},e)},t}(d().Component),Be=Oe,Ze=n("../packages/common-utils/src/index.ts"),Ue=n("../spread-sheet/src/core/view/spreadsheet-view/table-view/utils.ts"),He=n("../packages/lib/index.ts"),Ve=n("../spread-sheet/src/core/view/level-2/link-center/constant.ts"),Ke=n("../packages/model/src/cell/metadata/CustomDataType.ts"),Ge=L.ZP.t("打开链接"),ze=L.ZP.t("链接失效"),Fe=function(){function e(e){this.spreadsheet=e}var t=e.prototype;return t.analaysisHyperLinkText=function(e,t){var n=this.spreadsheet.activeSheet.getCellDataAtPosition(e,t);if(!n)return Ge;var o=n.getMetadata(),r=n.getEditValue(),i=!!r&&_e.vj.test(r),s=null===n||void 0===n?void 0:n.getHyperlinkType(),a=n.getHyperlink();if(a&&Ve.tO.test(a))return L.ZP.t("下载文件");if((null===o||void 0===o?void 0:o.customDataType)===Ke.ZP.EMAIL||i||s===S.ZP.EMAIL_LINK)return L.ZP.t("发送邮件");if(s===S.ZP.PHONE_NUMBER_LINK)return L.ZP.t("拨打电话");if(a)return this.analaysisLink(a);var l=n.getHyperlinkRuns();return l?this.analaysisHyperLinkRuns(l):L.ZP.t("打开链接")},t.analaysisLink=function(e){var t,n=(0,_e.lS)(e);if(n){var o=null===(t=this.spreadsheet.sheetManager.getSheetBySheetId(n))||void 0===t?void 0:t.properties.title;return o?L.ZP.t("跳转至{{sheetName}}",{sheetName:o}):ze}return Ge},t.analaysisHyperLinkRuns=function(e){var t=Ge,n=(e[0]?e[0]:{linkUrl:""}).linkUrl;if(n){var o=We(n),r=this.spreadsheet.workbookRangeManager.getLinkedWorkbookRangeById(o);t=r?this.parseGridRange(r.range):ze}return t},t.parseGridRange=function(e){var t=L.ZP.t("跳转至"),n=e.sheetId,o=e.toString();return n===this.spreadsheet.activeSheetId?t+=o:t+="'"+this.spreadsheet.sheetManager.getSheetTitleBySheetId(n)+"'!"+o,t},t.canShowBox=function(){var e;return!(null===(e=this.spreadsheet.parent.view.plugins.rangeSelectionPanel)||void 0===e?void 0:e.onSelecting)},e}();function We(e){return e.substr(9)}var Ye=Fe,qe=function(){function e(e,t){this.spreadsheet=e,this.sheetStatus=t}var t=e.prototype;return t.isRangeCanEdit=function(e,t){var n=new Ae.GridRange(this.spreadsheet.activeSheetId,e,e,t,t);return this.sheetStatus.getRangeCanEdit(n)},t.getModifyBoxCardRect=function(){return{width:362,height:229}},e}(),Qe=function(e){function t(t){var n;return(n=e.call(this)||this).emitter=new He.vp,n._linkInfo=null,n._status=K.EMPTY,n._wrap=document.createElement("div"),n._showBoxCoord={row:-1,col:-1},n.disableHover=!1,n._handleMove=(0,Ze.Ds)((function(){if(n._operateData.isHoverCell()&&n.sheetStatus.canEdit&&(!n._operateData.e.target||!n._container.contains(n._operateData.e.target))){var e=(0,Ue.Fs)(n._tableView,n._operateData.currRow,n._operateData.currCol),t=e.row,o=e.col;t===n._showBoxCoord.row&&o===n._showBoxCoord.col||n._getCellLink(t,o)&&(n.disableHover||n.showHoverBox(t,o))}}),500),n.checkLinkCellDelete=(0,Ze.Ds)((function(){n._status!==K.EMPTY&&!n._getCellLink(n._showBoxCoord.row,n._showBoxCoord.col)&&n._linkInfo&&n.hide()}),200),n.hide=function(){n._status!==K.EMPTY&&(n._cardCenter.getCardGroup(n._showBoxCoord.row,n._showBoxCoord.col).remove((0,s.Z)(n)),n._hide(),n._linkInfo=null,n._showBoxCoord.row=-1,n._showBoxCoord.col=-1)},n.controlledHide=function(e){void 0===e&&(e=!1),n.hide(),e&&(n.disableHover=!0,setTimeout((function(){n.disableHover=!1}),500)),n._inputManager.switchFocusDomNode()},n._handleDown=function(){if(n._operateData.isHoverCell()){if(!n.shouldPreventEvent()){var e=(0,Ue.Fs)(n._tableView,n._operateData.currRow,n._operateData.currCol),t=e.row,o=e.col;if(n._linkInfo=n._getCellLink(t,o),n._linkInfo){var r=n._linkInfo,i=r.type,s=r.url,a=n.commonLogic.isRangeCanEdit(t,o);if(de.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_link",action:"excel_link_view"}),(0,I.SB)(n._spreadsheet,t,o)){if(be().isIPad)return;return n.showHoverBox(t,o)}return(0,I.Vo)(a)?(ue(i),n.openLink(i,t,o,s)):n.showHoverBox(t,o)}n.hide()}}else n.hide()},n.shouldPreventEvent=function(){var e=n._operateData.e;return!!(e instanceof MouseEvent&&(0!==e.button||0===e.button&&e.ctrlKey))},n._toggleModify=function(){var e,t;n.showModifyBox(n._showBoxCoord.row,n._showBoxCoord.col,(null===(e=n._linkInfo)||void 0===e?void 0:e.type)||(null===(t=n._linkInfo)||void 0===t?void 0:t.type)||w.B.URL)},n._clearContent=t.clearContent,n._cancelLink=t.cancelLink,n._insertLink=t.insertLink,n._insertHyperLink=t.insertHyperLink,n._setHyperlinkRuns=t.setHyperlinkRuns,n._openUrl=t.openUrl,n._openCellLinkUrl=t.openCellLinkUrl,n._openSheetUrl=t.openSheetUrl,n._switchSheet=t.switchSheet,n._getCellLink=t.getCellLink,n._getDefaultLinkText=t.getDefaultLinkText,n._setHyperlinkIconVisibility=t.setHyperlinkIconVisibility,n._selectCell=t.selectCell,n._spreadsheet=t.spreadsheet,n._tableView=t.tableView,n.sheetStatus=t.sheetStatus,n._headSize=t.headSize,n._clientRect=t.clientRect,n._areaData=t.areaData,n._rowcolAccessor=t.rowcolAccessor,n._touchOperate=t.touchOperate,n._mouseOperate=t.mouseOperate,n._operateData=t.operateData,n._scale=t.scale,n._cardCenter=t.cardCenter,n._scrollApi=t.scrollApi,n._inputManager=t.inputManager,n._container.classList.add("link-card"),n._container.setAttribute("data-testid","link-card"),n._wrap.classList.add("link-wrap"),n._wrap.classList.add(be().isIPad?"ipad":"pc"),n._container.appendChild(n._wrap),n._initEvent(),n.showModifyBox=n.showModifyBox.bind((0,s.Z)(n)),n.hyperLinkLogic=new Ye(t.spreadsheet),n.commonLogic=new qe(t.spreadsheet,t.sheetStatus),n}(0,a.Z)(t,e);var n=t.prototype;return n.showHoverBox=function(e,t){if(this.hyperLinkLogic.canShowBox()&&this._status!==K.MODIFY){this.hide();var n={width:0,height:be().isIPad?47:41};this._cardCenter.getCardGroup(e,t,n).append(this),this._linkInfo=this._getCellLink(e,t),this._linkInfo&&(this._show(K.HOVER,e,t,this._linkInfo.text,this._linkInfo.url,this._linkInfo.type),this._showBoxCoord.row=e,this._showBoxCoord.col=t)}},n.showModifyBox=function(e,n,o,r,i){if(this.hyperLinkLogic.canShowBox()&&!be().isIPad){this.hide(),this._selectCell(e,n);var s=this.commonLogic.getModifyBoxCardRect(),a=this._cardCenter.getCardGroup(e,n,s);a.append(this);var l=a.container.getBoundingClientRect().left,c=this._getDefaultLinkText(e,n),d="";this._linkInfo=this._getCellLink(e,n),this._linkInfo&&(c=this._linkInfo.text,d=this._linkInfo.url),c=c||i||r||"",d=r||d,this._show(K.MODIFY,e,n,c,d,o,l),this._showBoxCoord.row=e,this._showBoxCoord.col=n,this.emitter.emit(t.EVENT.SHOW_MODIFY)}},n._show=function(e,t,n,o,r,i,s){var a,l=this;this._status=e;var c=i||(null===(a=this._linkInfo)||void 0===a?void 0:a.type)||w.B.URL,u=this.hyperLinkLogic.analaysisHyperLinkText(t,n),h=this.commonLogic.isRangeCanEdit(t,n),m=!1;e===K.HOVER&&u===ze&&(m=!0),c===w.B.PHONE_NUMBER_LINK&&be().isPC&&(m=!0),this.initShowEvent();try{p().render(d().createElement(Be,{spreadsheet:this._spreadsheet,status:e,row:t,col:n,text:o,url:r,type:c,setHyperlinkIconVisibility:function(e){l._setHyperlinkIconVisibility({row:l._showBoxCoord.row,col:l._showBoxCoord.col,visibility:e})},cancelLink:function(){l._cancelLink(l._showBoxCoord.row,l._showBoxCoord.col)},insertLink:function(e,t){l._insertLink(l._showBoxCoord.row,l._showBoxCoord.col,e,t)},insertHyperLink:function(e,t,n,o){l._insertHyperLink(l._showBoxCoord.row,l._showBoxCoord.col,e,t,n,o)},setHyperlinkRuns:function(e){var t=e.linkValue,n=e.range;l._setHyperlinkRuns({row:l._showBoxCoord.row,col:l._showBoxCoord.col,linkValue:t,range:n})},scrollToVisible:function(e){l._scrollApi.scrollToVisible({row:t,col:n},!0,{onAnimationEnd:e})},showModifyBox:this.showModifyBox,clearContent:this._clearContent,toggleModify:this._toggleModify,openUrl:this._openUrl,openSheetUrl:this._openSheetUrl,openCellLinkUrl:this._openCellLinkUrl,switchSheet:this._switchSheet,headSize:this._headSize,clientRect:this._clientRect,areaData:this._areaData,rowcolAccessor:this._rowcolAccessor,mouseOperate:this._mouseOperate,hideBox:this.controlledHide,operateData:this._operateData,scale:this._scale,hyperLinkText:u,disabled:m,containerLeft:s||0,cardGroup:this._cardCenter.getCardGroup(t,n),canEdit:h}),this._wrap)}catch(f){de.ZP.monitor(34235871)}},n._hide=function(){this._status=K.EMPTY,p().unmountComponentAtNode(this._wrap),this.disposeShowEvent()},n._initEvent=function(){this._areaData.onUpdateOffset(this.hide),this.emitter.on(Je.EVENT.LINK_HIDE_COMPONENT,this.hide),this._mouseOperate&&(this._mouseOperate.onMousedown(this._handleDown),this._mouseOperate.onMousemove(this._handleMove)),this._touchOperate&&this._touchOperate.onTouchstart(this._handleDown)},n.initShowEvent=function(){this._spreadsheet.parent.mutationBehavior.emitter.on(this._spreadsheet.parent.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.checkLinkCellDelete)},n.disposeShowEvent=function(){this._spreadsheet.parent.mutationBehavior.emitter.off(this._spreadsheet.parent.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.checkLinkCellDelete)},n.openLink=function(e,t,n,o){(0,I.nu)(this._spreadsheet,t,n)?(0,E.X7)(this._spreadsheet,t,n):e===w.B.CELL_LINK?(this._operateData.stopPropagation=!0,this._openCellLinkUrl(t,n)):e===w.B.SHEET_LINK?this._openSheetUrl(o):(this._openUrl(o),(0,E.$4)())},(0,l.Z)(t,[{key:"EVENT",get:function(){return t.EVENT}}]),t}(h.Z);Qe.EVENT={SHOW_MODIFY:"showModify"};var Xe=Qe,Je=function(e){function t(t){var n;return(n=e.call(this,t)||this)._getDefaultLinkText=function(e,t){var o=n._spreadsheet.activeSheet.getCellDataAtPosition(e,t);if(!o)return"";var r=o.getMetadata();return r&&(0,Ke.Wr)(r.customDataType)?"":o.getEditValue()||""},n._clearContent=function(){n._modifyCellBroker.clearContent()},n._tableView=t.tableView,n._areaData=t.areaData,n._headSize=t.headSize,n._clientRect=t.clientRect,n.sheetStatus=t.sheetStatus,n._rowcolAccessor=t.rowcolAccessor,n._touchOperate=t.touchOperate,n._mouseOperate=t.mouseOperate,n._cardCenter=t.cardCenter,n._operateData=t.operateData,n._scale=t.scale,n._modifyCellBroker=t.modifyCellBroker,n._inputManager=t.inputManager,n._card=new Xe({cancelLink:n._cancelLink.bind((0,s.Z)(n)),insertLink:n._insertLink.bind((0,s.Z)(n)),insertHyperLink:n._insertHyperLink.bind((0,s.Z)(n)),setHyperlinkRuns:n.setHyperlinkRuns.bind((0,s.Z)(n)),openUrl:n._openUrl.bind((0,s.Z)(n)),openSheetUrl:n._openSheetUrl.bind((0,s.Z)(n)),openCellLinkUrl:n._openCellLinkUrl.bind((0,s.Z)(n)),switchSheet:n.switchSheet.bind((0,s.Z)(n)),getCellLink:n._getCellLink.bind((0,s.Z)(n)),clearContent:n._clearContent,setHyperlinkIconVisibility:n.setHyperlinkIconVisibility.bind((0,s.Z)(n)),getDefaultLinkText:n._getDefaultLinkText,selectCell:n.selectCell,spreadsheet:n._spreadsheet,scrollApi:n._scrollApi,tableView:n._tableView,sheetStatus:n.sheetStatus,operateData:n._operateData,headSize:n._headSize,clientRect:n._clientRect,areaData:n._areaData,rowcolAccessor:n._rowcolAccessor,touchOperate:n._touchOperate,mouseOperate:n._mouseOperate,scale:n._scale,cardCenter:n._cardCenter,inputManager:n._inputManager}),n}return(0,a.Z)(t,e),t}(n("../spread-sheet/src/core/view/level-2/link-center/BaseLinkCenter.ts").Z)},"../spread-sheet/src/core/view/level-2/link-center/constant.ts":function(e,t,n){n.d(t,{Sj:function(){return s},mm:function(){return r},tO:function(){return i}}),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js");var o="[a-zA-Z0-9]{32}",r=new RegExp(o),i=new RegExp("^drive:\\/\\/([a-zA-Z0-9]{32})\\/(.+)\\.([a-zA-Z0-9]+)$"),s=20},"../spread-sheet/src/core/view/level-2/link-center/report/attachment.ts":function(e,t,n){n.d(t,{SC:function(){return a},WO:function(){return s},d0:function(){return r},jV:function(){return i}});var o=n("../packages/report/src/index.ts"),r=function(){l("upload_click")},i=function(){l("download_click")},s=function(){l("toolbar_change")},a=function(){l("toolbar_delete")},l=function(e){o.ZP.tdwReport({opername:"doc_word_editor",module:"local_files",file_type:2,action:e})}},"../spread-sheet/src/core/view/level-2/link-center/utils/checker.ts":function(e,t,n){n.d(t,{Rw:function(){return l},SB:function(){return u},Vo:function(){return p},fd:function(){return d},nu:function(){return c}}),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../spread-sheet/src/base/util/appConfig.ts");var o=n("../spread-sheet/src/base/util/url.ts"),r=n("../packages/model/src/cell/index.ts"),i=n("../packages/model/src/cell/metadata/CustomDataType.ts"),s=n("../spread-sheet/src/core/view/level-2/link-center/constant.ts"),a=n("../spread-sheet/src/core/view/level-2/link-center/utils/hyperlink.ts"),l=function(e){return!!e&&!!new RegExp("https://"+(0,o.Fb)()).test(e)},c=function(e,t,n){var o=e.activeSheet.getCellDataAtPosition(t,n);return!((null===o||void 0===o?void 0:o.getHyperlinkType())!==r.HYPERLINK_TYPE.IMAGE)},d=function(e,t,n){var o,r=e.activeSheet.getCellDataAtPosition(t,n);return!((null===(o=null===r||void 0===r?void 0:r.getMetadata())||void 0===o?void 0:o.customDataType)!==i.ZP.IMAGE)},u=function(e,t,n){var o=e.activeSheet.getCellDataAtPosition(t,n),r=(0,a.wI)(o);return s.tO.test(r)},p=function(e){return!e}},"../spread-sheet/src/core/view/level-2/link-center/utils/hyperlink.ts":function(e,t,n){n.d(t,{E1:function(){return c},NK:function(){return a},Y_:function(){return l},wI:function(){return s}}),n("../node_modules/core-js/modules/es.string.trim.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js");var o=n("../spread-sheet/src/base/util/url.ts"),r=n("../packages/model/src/cell/index.ts"),i=n("../spread-sheet/src/core/view/level-2/link-center/constant.ts"),s=function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.getHyperlink())&&void 0!==t?t:""},a=function(e){return(null===e||void 0===e?void 0:e.getHyperlinkType())||(e.getHyperlinkRuns()?r.HYPERLINK_TYPE.SHEET:null)},l=function(e){return e.trim&&(e=e.trim()),e=o.vj.test(e)?"mailto:"+e:d(e)},c=function(e){var t=e.trim().match(i.mm);return t?t[0]:""},d=function(e){return/^(https?|ftp|file):\/\//i.test(e)||(e=/^(\/\/)/.test(e)?"http:"+e:"http://"+e),e}},"../spread-sheet/src/core/view/level-2/preview-image-icon/PreviewImageIcon.ts":function(e,t,n){n.r(t);var o=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),r=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),i=n("../spread-sheet/src/core/view/level-2/preview-image-icon/iconSource.tsx"),s=n("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),a=n("../spread-sheet/src/core/view/spreadsheet-view/utils.ts"),l=n("../packages/model/src/cell/LinkIconType.ts"),c=n("../packages/model/src/cell/index.ts"),d=n("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),u=n("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),p=n("../spread-sheet/src/core/view/config/default.ts"),h=n("../spread-sheet/src/core/view/level-2/render-plugin/utils.ts"),m=26,f=function(e){function t(t){var n;return(n=e.call(this,t)||this)._iconWidth=16,n._iconHeight=16,n._subscriptSize=10,n.renderAfterCell=function(e){var t,o=n._spreadsheet.activeSheet,r=e.x,i=e.y,s=e.row,m=e.col,f=o.getCellDataAtPosition(s,m),v=o.getCellImage(s,m);if(f&&!v&&f.getLinkIconStatus()===l.Z.WITH_IMAGE&&!(0,d.xy)(n._spreadsheet,s,m)&&!(0,u.tE)(n._spreadsheet.parent,s,m)){var g=(null===f||void 0===f?void 0:f.getHyperlinkType())||(f.getHyperlinkRuns()?c.HYPERLINK_TYPE.SHEET:null);if(g){var _=n._spreadsheetView,y=_.tableView,w=_.rowcolAccessor,C=_.transformTable,E=null===(t=f.getUserEnteredFormat())||void 0===t?void 0:t.getTextFormat(),I=(null===E||void 0===E?void 0:E.fontSize)||p.n5,b=y.getCellViewAtPosition(s,m),x=(0,a.o)(w,b,m),S=(0,a.E)(w,b,s),k=(0,h.jG)(I),A={width:n._iconWidth*k,height:n._iconHeight*k},D=(0,h.qp)(b,S,r,i,A),T=C.getClipInfo(s,m,r,i,x,S)||void 0;n._alloyExcel.collectEngine.bitmapCollector.collect({dx:D[0],dy:D[1],dWidth:A.width,dHeight:A.height,img:n._iconsList[g],clipInfo:T})}}},n._spreadsheet=t.spreadsheet,n._spreadsheetView=t.spreadsheetView,n._iconsList=(new i.Z).iconsList,n._alloyExcel.onAfterCellRender(n.renderAfterCell),n}return(0,r.Z)(t,e),(0,o.Z)(t,[{key:"iconWidth",get:function(){return this._iconWidth>>0}},{key:"paddingLeft",get:function(){return m>>0}},{key:"subscriptSize",get:function(){return this._subscriptSize}}]),t}(s.Z);t.default=f},"../spread-sheet/src/core/view/level-2/preview-image-icon/iconSource.tsx":function(e,t,n){n.d(t,{Z:function(){return Y}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.keys.js");var o,r=n("../packages/model/src/cell/HyperlinkType.ts"),i=n("../node_modules/@tencent/wedocs-icons-svg/src/filetype-tdoc-flowchart.svg"),s=n("../node_modules/@tencent/wedocs-icons-svg/src/filetype-tdoc-folder.svg"),a=n("../node_modules/@tencent/wedocs-icons-svg/src/filetype-tdoc-mindmap.svg"),l=n("../node_modules/@tencent/wedocs-icons-svg/src/filetype-tdoc-tdoc.svg"),c=n("../node_modules/@tencent/wedocs-icons-svg/src/filetype-tdoc-tsheet.svg"),d=n("../node_modules/@tencent/wedocs-icons-svg/src/filetype-tdoc-tslide.svg"),u=n("../node_modules/@tencent/wedocs-icons-svg/src/filetype-tdoc-tform.svg"),p=n("../node_modules/@tencent/wedocs-icons-svg/src/pdf.svg"),h=n("../node_modules/@tencent/wedocs-icons-svg/src/video.svg"),m=n("../node_modules/@tencent/wedocs-icons-svg/src/audio.svg"),f=n("../node_modules/@tencent/wedocs-icons-svg/src/font.svg"),v=n("../node_modules/@tencent/wedocs-icons-svg/src/exe.svg"),g=n("../node_modules/@tencent/wedocs-icons-svg/src/html.svg"),_=n("../node_modules/@tencent/wedocs-icons-svg/src/cad.svg"),y=n("../node_modules/@tencent/wedocs-icons-svg/src/sketch.svg"),w=n("../node_modules/@tencent/wedocs-icons-svg/src/keynote.svg"),C=n("../node_modules/@tencent/wedocs-icons-svg/src/excel.svg"),E=n("../node_modules/@tencent/wedocs-icons-svg/src/word.svg"),I=n("../node_modules/@tencent/wedocs-icons-svg/src/ppt.svg"),b=n("../node_modules/@tencent/wedocs-icons-svg/src/disk.svg"),x=n("../node_modules/@tencent/wedocs-icons-svg/src/ai.svg"),S=n("../node_modules/@tencent/wedocs-icons-svg/src/pages.svg"),k=n("../node_modules/@tencent/wedocs-icons-svg/src/cdr.svg"),A=n("../node_modules/@tencent/wedocs-icons-svg/src/psd.svg"),D=n("../node_modules/@tencent/wedocs-icons-svg/src/mail.svg"),T=n("../node_modules/@tencent/wedocs-icons-svg/src/xmind.svg"),P=n("../node_modules/@tencent/wedocs-icons-svg/src/vector.svg"),L=n("../node_modules/@tencent/wedocs-icons-svg/src/android.svg"),R=n("../node_modules/@tencent/wedocs-icons-svg/src/numbers.svg"),M=n("../node_modules/@tencent/wedocs-icons-svg/src/txt.svg"),j=n("../node_modules/@tencent/wedocs-icons-svg/src/solidworks.svg"),N=n("../node_modules/@tencent/wedocs-icons-svg/src/zip.svg"),O=n("../node_modules/@tencent/wedocs-icons-svg/src/other.svg"),B=n("../node_modules/@tencent/wedocs-icons-svg/src/blackboard.svg"),Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGcSURBVHgB7Ze/SsNQFMa/SKtQLBSsg4t0tI8gPoCbDyCKr6CzBXVxtbNOgqPWwakuioKTnYS2QqGpQx2sKBQLJhC9h5uLiebPDd5Eh3xwSc7l3ny/nHMSEg22Wq3WmmVZVU3TCohXOvPYLpfLh67ZZrPZNQzjI26RB/N6Eb5jDoZSNptF3LI9Cl4Af6IUIAXIQJGehsDBJXuf9IHZKWB9EZjOh+9TloH9C25OengGds/k9ikDaD+648GQj8QA5mbccTHPR2IAqwtfhrkJYGVebp+yJqTG21vmac+NcwgZSWWgx5rq6IZ3epgoC7Lm0gDVOlC/450tAxFFoQD0aIlupiNB9AY/13nNKQGo3bpjAdHoutdUTnim3t6hDoDS/f35Jo0MZnbOy0JrTht8vqFzkChlCgQQF/YTNSYZOiUyJAvhC0AXuL5HqEYeKSeIyrG7TJEB2n38SqJMYVn0BaiFbJQVNWgQhC9AcRLKdBVQSt9X8eYSElH6SZYC/B8A9t/4apom4pbtoYs44wDY6HQ6W+y0hBhFN8rGjog/ASYg+cfsJ/pIAAAAAElFTkSuQmCC",U=((o={}).error="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAxOCAxOCIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGNsYXNzPSJ3ZWRvY3MtaWNvbiB3ZWRvY3MtaWNvbi1tZXNzYWdlLWZpbGUtZXJyb3IiPjxjaXJjbGUgY3g9IjkiIGN5PSI5IiByPSI5IiBmaWxsPSIjRDhEOEQ4Ij48L2NpcmNsZT48cGF0aCBmaWxsPSIjOTA5MDkwIiBkPSJNOSA0YTEgMSAwIDAwLTEgLjk5VjlhMSAxIDAgMDAyIDBWNWExIDEgMCAwMC0xLTF6bTAgOWExIDEgMCAxMDAtMiAxIDEgMCAwMDAgMnoiIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIj48L3BhdGg+PC9zdmc+",o[r.ZP.IMAGE]=Z,o[r.ZP.MUSIC]=m,o[r.ZP.VIDEO]=h,o[r.ZP.DOC]=l,o[r.ZP.SHEET]=c,o[r.ZP.SLIDE]=d,o[r.ZP.FORM]=u,o[r.ZP.FOLDER]=s,o[r.ZP.PDF]=p,o[r.ZP.TENCENTDOC]="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsLXJ1bGU9Im5vbnplcm8iIGZpbGw9Im5vbmUiPjxwYXRoIGQ9Ik0xMi4zMDMgMS45ODRIMy4zM2EuMjU0LjI1NCAwIDAgMC0uMjUxLjIwOGwtMi4wNzUgMTEuNjFhLjI1My4yNTMgMCAwIDAgLjI1MS4yOTZoNC45NDZsLjM5Mi0uMTJIOC44OWwuMzIuMTJoMy44MWMuMTI0IDAgLjIzLS4wODguMjUyLS4yMDhsMS43MDctOS41NS0yLjY3Ni0yLjM1NnoiIGZpbGw9IiMyQTY1RjUiLz48cGF0aCBkPSJNMTIuMzAzIDEuOTg0bDIuNjc2IDIuMzU2aC0yLjc5M2EuMjUyLjI1MiAwIDAgMS0uMjUxLS4yOTVsLjM2OC0yLjA2MXoiIGZpbGw9IiMwMERDRkYiLz48cGF0aCBkPSJNOC4yOCAyLjQ4MWw1Ljc3OCA1LjA5LS4xMjMuMDAzSDEwLjM4bC0xLjE3IDYuNTI0SDYuMmwxLjE3LTYuNTI0SDUuMDFMMi44ODMgNS4zMDVsNC44OTUtLjAwOHoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+",o[r.ZP.FOLDER_SHARE]=s,o[r.ZP.SHEET_LINK]=c,o[r.ZP.NORMAL]=c,o[r.ZP.MIND]=a,o[r.ZP.FLOWCHART]=i,o[r.ZP.AUDIO]=m,o[r.ZP.ATTACHMENT_IMAGE]=Z,o[r.ZP.DEFAULT]=O,o[r.ZP.PLACEHOLDER_ERROR]="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjRweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8dGl0bGU+VXBsb2FkX2xvYWRpbmdfZmFpbGVkIDwvdGl0bGU+CiAgICA8ZyBpZD0i6aG16Z2iLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLotYTmupBf6ZO+5o6l5aSa5oCB5YiH5o2iIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTcuMDAwMDAwLCAtMjQwLjAwMDAwMCkiPgogICAgICAgICAgICA8ZyBpZD0i57yW57uEIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNy4wMDAwMDAsIDI0MC4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxjaXJjbGUgaWQ9IuakreWchuW9oiIgZmlsbD0iI0ZGNDc0NyIgY3g9IjEyIiBjeT0iMTIiIHI9IjkiPjwvY2lyY2xlPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTEyLDE0LjUgQzEyLjgyODQyNzEsMTQuNSAxMy41LDE1LjE3MTU3MjkgMTMuNSwxNiBDMTMuNSwxNi44Mjg0MjcxIDEyLjgyODQyNzEsMTcuNSAxMiwxNy41IEMxMS4xNzE1NzI5LDE3LjUgMTAuNSwxNi44Mjg0MjcxIDEwLjUsMTYgQzEwLjUsMTUuMTcxNTcyOSAxMS4xNzE1NzI5LDE0LjUgMTIsMTQuNSBaIE0xMy41LDYuNSBMMTMsMTMuNSBMMTEsMTMuNSBMMTAuNSw2LjUgTDEzLjUsNi41IFoiIGlkPSLlvaLnirbnu5PlkIgiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+",o[r.ZP.FONT]=f,o[r.ZP.EXE]=v,o[r.ZP.HTML]=g,o[r.ZP.CAD]=_,o[r.ZP.SKETCH]=y,o[r.ZP.KEYNOTE]=w,o[r.ZP.OFFICE_EXCEL]=C,o[r.ZP.OFFICE_WORD]=E,o[r.ZP.OFFICE_PPT]=I,o[r.ZP.MAC]=b,o[r.ZP.AI]=x,o[r.ZP.PAGES]=S,o[r.ZP.CDR]=k,o[r.ZP.PSD]=A,o[r.ZP.MAIL]=D,o[r.ZP.XMIND]=T,o[r.ZP.VECTOR]=P,o[r.ZP.ANDROID]=L,o[r.ZP.NUMBERS]=R,o[r.ZP.TXT]=M,o[r.ZP.SOLID_WORK]=j,o[r.ZP.ZIP]=N,o[r.ZP.OTHER]=O,o[r.ZP.BOARD]=B,o),H=(n("../node_modules/core-js/modules/esnext.global-this.js"),96),V=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},K=function(e){return new Promise((function(t,n){var o=new Image;o.onload=function(){return t(o)},o.onerror=function(){return n(o)},o.src=e}))},G=function(e){return V(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===globalThis.createImageBitmap){t.next=4;break}return t.next=3,z(e);case 3:return t.abrupt("return",t.sent);case 4:if(void 0===globalThis.HTMLCanvasElement){t.next=6;break}return t.abrupt("return",F(e));case 6:return t.abrupt("return",e);case 7:case"end":return t.stop()}}),t)})))},z=function(e){return V(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.createImageBitmap(e,0,0,e.naturalWidth,e.naturalHeight,{resizeWidth:H,resizeHeight:H});case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})))},F=function(e){var t=document.createElement("canvas");t.height=H,t.width=H;var n=t.getContext("2d");return null===n||void 0===n||n.drawImage(e,0,0,H,H),t},W=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},Y=function(){function e(){this.iconsList={},this.iconSrc={},this.iconSrc=U,this.loadResources()}return e.prototype.loadResources=function(){var e=this;Object.keys(this.iconSrc).forEach((function(t){return W(e,void 0,void 0,regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.iconSrc[t],e.next=3,K(n);case 3:return o=e.sent,e.next=6,G(o);case 6:this.iconsList[t]=e.sent;case 7:case"end":return e.stop()}}),e,this)})))}))},e}()},"../spread-sheet/src/core/view/level-2/shape-edit-center/ShapeEditCenter.pc.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return me}});var o,r,i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),l=function(){function e(e){var t=this;this.focusingImpl=!1,this.shapeIdImpl="",this.syncData=function(e){t.shapeIdImpl&&t.modifyShapeBroker.updateShape(t.shapeIdImpl,e)},this.modifyShapeBroker=e.modifyShapeBroker,this.sheetStatus=e.sheetStatus,this.spreadsheet=e.spreadsheet,this.autoScroll=e.autoScroll,this.dataCallView=e.dataCallView}var t=e.prototype;return t.focus=function(e){return this.shapeIdImpl=e,this.focusingImpl=!0,!0},t.blur=function(){this.shapeIdImpl="",this.focusingImpl=!1},(0,i.Z)(e,[{key:"focusing",get:function(){return this.focusingImpl}},{key:"shapeId",get:function(){return this.shapeIdImpl}}]),e}(),c=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../packages/lib/EventEmitter.ts")),d=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../spread-sheet/src/core/view/level-2/shape-edit-center/utils.ts")),u=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};!function(e){e[e.SCALE=0]="SCALE",e[e.CLIP=1]="CLIP"}(o||(o={})),function(e){e[e.MOVE=0]="MOVE",e[e.SCALE=1]="SCALE",e[e.CLIP=2]="CLIP"}(r||(r={}));var p=function(){function e(t){this._originSize={width:0,height:0},this._data=e._defaultData,this._editing=!1,this._areaData=t.areaData,this._scale=t.scale,this._propsSyncData=t.syncData,this._shapeStage=t.shapeStage,this._autoScroll=t.autoScroll,this._spreadSheet=t.spreadsheet}var t=e.prototype;return t._syncData=function(){var e=this._prepareSyncData();e&&this._propsSyncData(e)},t._resetData=function(){if(0===this._originSize.width||0===this._originSize.height)throw new Error("原图宽高获取异常，无法还原");this._data.width=this._originSize.width,this._data.height=this._originSize.height,this._data.clipLeft=0,this._data.clipTop=0,this._data.clipRight=0,this._data.clipBottom=0,this._syncData()},t._show=function(e){this._shapeId=e;var t=this._transformData();return!!t&&(Object.assign(this._data,t),this._editing=!0,this.fetchOriginSize(),!0)},t._hide=function(e,t){this._shapeId="",this._editing=!1,this._originSize.width=0,this._originSize.height=0,t&&this._areaData.updateOffsetEmitter.fire()},t.refreshData=function(){var e=this._transformData();e&&Object.assign(this._data,e)},t.fetchOriginSize=function(){return u(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.Il)(this._data.url);case 2:this._originSize=e.sent;case 3:case"end":return e.stop()}}),e,this)})))},t._prepareSyncData=function(){var e=this._shapeStage.viewShapeData.getShapeData(this._shapeId);if(!e)return n.g.log.error("prepareSyncData 图片编辑异常，可能已经被删除"),null;var t=e.shape,o=this._scale.scale,r=t.position.overlayPosition.anchorCell.rowIndex,i=t.position.overlayPosition.anchorCell.colIndex,s=(t.position.overlayPosition.offsetYpixels,t.position.overlayPosition.offsetXpixels),a=(0,d.vM)(this._areaData),l=a.left,c=a.top,u=a.right,p=a.bottom,h=Math.max(l,Math.min(this._data.left,u)),m=Math.max(c,Math.min(this._data.top,p));return i=this._areaData.getColByDisplayViewLeft(h),s=h/o-this._areaData.getViewLeftByCol(i)>>0,{y:r=this._areaData.getRowByDisplayViewTop(m),x:i,offsetX:s,offsetY:m/o-this._areaData.getViewTopByRow(r)>>0,width:this._data.width/o>>0,height:this._data.height/o>>0,clipInfo:{clipTop:this._data.clipTop/o>>0,clipRight:this._data.clipRight/o>>0,clipBottom:this._data.clipBottom/o>>0,clipLeft:this._data.clipLeft/o>>0},url:this._data.url,zIndex:this._data.zIndex}},t._transformData=function(){var e=this._shapeStage.viewShapeData.getShapeData(this._shapeId);if(!e)return n.g.log.error("transformData 图片编辑异常，可能已经被删除"),null;var t=e.shape;return{url:t.url,left:this._areaData.getDisplayViewLeftByCol(t.position.overlayPosition.anchorCell.colIndex)+t.position.overlayPosition.offsetXpixels*this._scale.scale,top:this._areaData.getDisplayViewTopByRow(t.position.overlayPosition.anchorCell.rowIndex)+t.position.overlayPosition.offsetYpixels*this._scale.scale,width:t.position.overlayPosition.widthPixels*this._scale.scale,height:t.position.overlayPosition.heightPixels*this._scale.scale,clipLeft:t.clipInfo.clipLeft*this._scale.scale,clipTop:t.clipInfo.clipTop*this._scale.scale,clipRight:t.clipInfo.clipRight*this._scale.scale,clipBottom:t.clipInfo.clipBottom*this._scale.scale,zIndex:t.position.overlayPosition.zIndex}},(0,i.Z)(e,[{key:"editing",get:function(){return this._editing}},{key:"data",get:function(){return this._data}}]),e}();p._defaultData={url:"",top:0,left:0,width:0,height:0,clipTop:0,clipRight:0,clipBottom:0,clipLeft:0,zIndex:0};var h=p,m=n("../node_modules/i18next/dist/esm/i18next.js"),f=function(){function e(e){this._tip=document.createElement("div"),this._tip.classList.add("sheet-image-scale-info","shape-active-info"),e.appendChild(this._tip)}var t=e.prototype;return t.hide=function(){this._tip.style.display="none"},t.show=function(){this._tip.style.display="block"},t.change=function(e,t,n,o){this._tip.style.left=Math.max(0,e)+"px",this._tip.style.top=t>=40?t-40+"px":t+o+10+"px",this._tip.innerText=m.ZP.t("宽: {{value0}} 高: {{value1}}",{value0:n>>0,value1:o>>0})},e}(),v=(n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/web.url.js"),n("../node_modules/core-js/modules/web.url-search-params.js"),n("../spread-sheet/src/core/utils/ImageLoader.ts")),g=n("../node_modules/lodash/throttle.js"),_=n.n(g),y=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},w=function(){function e(e,t){var o=this;this._propDisplay=!1,this._element=document.createElement("div"),this.updateBackgroundImage=_()((function(){return y(o,void 0,void 0,regeneratorRuntime.mark((function e(){var t,o,r,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._propUrl){e.next=2;break}return e.abrupt("return");case 2:return t=this._propSize,o=t.width,r=t.height,i=(0,v.AJ)(this._propUrl,{width:o*n.g.devicePixelRatio,height:r*n.g.devicePixelRatio,strategy:v.M$.COVER}),e.next=6,v.ZP.preLoadImageToBrowserCache(i);case 6:s=new URL(this._propUrl),-1!==i.indexOf(""+s.host+s.pathname)&&(Object.assign(this._element.style,{"background-image":"url("+i+")"}),this.thumbnailUrl=i);case 8:case"end":return e.stop()}}),e,this)})))}),500),this._propUrl=t.url,this._propSize=t.size,this._propTranslate=t.translate,this._propDisplay=t.display,this._element.classList.add("shape-active-back"),Object.assign(this._element.style,{"background-image":"url("+this._propUrl+")",left:this._propTranslate.x+"px",top:this._propTranslate.y+"px",width:this._propSize.width+"px",height:this._propSize.height+"px",display:this._propDisplay?"block":"none"}),e.appendChild(this._element),this.updateBackgroundImage()}return e.prototype.setProps=function(e){void 0!==e.url&&(this._propUrl=e.url),void 0!==e.display&&(this._propDisplay=e.display),void 0!==e.size&&(this._propSize=e.size),void 0!==e.translate&&(this._propTranslate=e.translate),Object.assign(this._element.style,{"background-image":"url("+(void 0!==e.url?e.url:this.thumbnailUrl)+")",left:this._propTranslate.x+"px",top:this._propTranslate.y+"px",width:this._propSize.width+"px",height:this._propSize.height+"px",display:this._propDisplay?"block":"none"})},e}(),C=n("react"),E=n.n(C),I=n("react-dom"),b=n.n(I),x=n("../spread-sheet/src/core/view/level-1/shape-stage/stage/image/FailedPlaceHolder.tsx"),S=n("../node_modules/lodash/isEqual.js"),k=n.n(S),A=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},D=function(){function e(e,t){var o=this;this._element=document.createElement("div"),this.updateBackgroundImage=_()((function(){return A(o,void 0,void 0,regeneratorRuntime.mark((function e(){var t,o,r,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.renderUrl){e.next=2;break}return e.abrupt("return");case 2:if(n.g.navigator.onLine){e.next=4;break}return e.abrupt("return");case 4:return t=this.renderSize,o=t.width,r=t.height,i=(0,v.AJ)(this.renderUrl,{width:o*n.g.devicePixelRatio,height:r*n.g.devicePixelRatio,strategy:v.M$.COVER}),e.next=8,v.ZP.preLoadImageToBrowserCache(i);case 8:s=new URL(this.renderUrl),-1!==i.indexOf(""+s.host+s.pathname)&&(Object.assign(this._element.style,{"background-image":"url("+i+")"}),this.renderUrl=i);case 10:case"end":return e.stop()}}),e,this)})))}),500),this.renderUrl=t.url,this.renderSize=t.size,this.renderTranslate=t.translate,this._element.classList.add("shape-active-font"),Object.assign(this._element.style,{"background-image":"url("+this.renderUrl+")","background-size":this.renderSize.width+"px "+this.renderSize.height+"px","background-position":this.renderTranslate.x+"px "+this.renderTranslate.y+"px"}),e.appendChild(this._element),this.updateBackgroundImage(),this.renderPlaceholderIfFailed()}var t=e.prototype;return t.setProps=function(e){var t=e.url,o=e.size,r=e.translate,i=o.width,s=o.height,a=!1,l=(0,v.AJ)(t,{width:i*n.g.devicePixelRatio,height:s*n.g.devicePixelRatio,strategy:v.M$.COVER}),c=0===this.renderSize.width&&0===this.renderSize.height,d=k()(this.renderSize,o)&&l===this.renderUrl;(c||d)&&(a=!0),!n.g.navigator.onLine&&(a=!1),this.renderUrl=a?l:e.url,this.renderSize=o,this.renderTranslate=r,Object.assign(this._element.style,{"background-image":"url("+this.renderUrl+")","background-size":i+"px "+s+"px","background-position":r.x+"px "+r.y+"px"}),this.updateBackgroundImage(),this.renderPlaceholderIfFailed()},t.renderPlaceholderIfFailed=function(){v.ZP.hasPicFailed(this.renderUrl)&&b().render(E().createElement(x.x,null),this._element)},e}(),T=n("../spread-sheet/src/core/view/lib/pointer-support.ts"),P=n("../spread-sheet/src/core/view/level-2/drag-control/BaseDragControl.ts"),L=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),R=n.n(L),M=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),j=n("../spread-sheet/src/core/view/level-1/auto-scroll/AutoScroll.ts"),N=function(){function e(e){var t=this;this._propDisplay=!1,this._board=document.createElement("div"),this._isMoving=!1,this._handleDragStart=function(){t._propBeforeUpdateCallback(t._propOperateMode===o.SCALE?r.SCALE:r.CLIP)},this._handleDragMove=function(e,n){var r=n.diffX,i=n.diffY;t._propOperateMode===o.SCALE?t._propScaleCallback(e,r,i):t._propOperateMode===o.CLIP&&t._propClipCallback(e,r,i)},this._handleDragEnd=function(){Math.abs(t._propOperateData.currX-t._propOperateData.startX)>1||Math.abs(t._propOperateData.currY-t._propOperateData.startY)>1?t._propAfterUpdateCallback():t._propInfoHide()},this._handleDown=function(e){e.stopPropagation(),e.preventDefault(),e instanceof MouseEvent&&(document.addEventListener("mousemove",t._handleMove,!0),document.addEventListener("mouseup",t._handleUp)),document.addEventListener("touchmove",t._handleMove,{capture:!0,passive:!1}),document.addEventListener("touchend",t._handleUp),t._isMoving=!0,t._propAutoScroll.ready(j.OD.ALL),t._propBeforeUpdateCallback(r.MOVE)},this._handleMove=function(e){e.stopPropagation(),e.preventDefault(),t._propMoveCallback()},this._handleUp=function(e){e.stopPropagation(),e.preventDefault(),e instanceof MouseEvent&&(document.removeEventListener("mousemove",t._handleMove,!0),document.removeEventListener("mouseup",t._handleUp)),document.removeEventListener("touchmove",t._handleMove,{capture:!0}),document.removeEventListener("touchend",t._handleUp),t._isMoving=!1,(Math.abs(t._propOperateData.currX-t._propOperateData.startX)>1||Math.abs(t._propOperateData.currY-t._propOperateData.startY)>1)&&t._propAfterUpdateCallback()},this._handleContextMenu=function(e){e.preventDefault(),t._propContextMenuCallback()},this._container=e.container,this._propBeforeUpdateCallback=e.beforeUpdateCallback,this._propAfterUpdateCallback=e.afterUpdateCallback,this._propClipCallback=e.clipCallback,this._propScaleCallback=e.scaleCallback,this._propMoveCallback=e.moveCallback,this._propContextMenuCallback=e.contextMenuCallback,this._propOperateData=e.operateData,this._propInfoHide=e.infoHide,this._propData=e.data,this._propDisplay=e.display,this._propOperateMode=e.operateMode,this._propAutoScroll=e.autoScroll,this._board.classList.add("shape-active-box"),this._board.setAttribute("data-testid","shape-active-box"),M.q.getConfig("isHistory")&&this._board.classList.add("shape-active-box-default-cursor"),this._board.addEventListener("mousedown",this._handleDown),this._board.addEventListener("contextmenu",this._handleContextMenu),(0,T.D2)(this._board),this._board.addEventListener("touchstart",this._handleDown),this._board.addEventListener("pointer",(function(e){R().isPC||t._handleContextMenu(e)})),this._back=new w(this._board,{url:this._propData.url,size:{width:this._propData.width+this._propData.clipLeft+this._propData.clipRight,height:this._propData.height+this._propData.clipTop+this._propData.clipBottom},translate:{x:-this._propData.clipLeft,y:-this._propData.clipTop},display:!1}),this._front=new D(this._board,{url:this._propData.url,size:{width:this._propData.width+this._propData.clipLeft+this._propData.clipRight,height:this._propData.height+this._propData.clipTop+this._propData.clipBottom},translate:{x:-this._propData.clipLeft,y:-this._propData.clipTop}}),this._dragControl=new P.Z({container:this._board,startCallback:this._handleDragStart,moveCallback:this._handleDragMove,endCallback:this._handleDragEnd,operateData:this._propOperateData}),this._container.appendChild(this._board)}return e.prototype.setProps=function(e){void 0!==e.data&&(this._propData=e.data),void 0!==e.display&&(this._propDisplay=e.display),void 0!==e.operateMode&&(this._propOperateMode=e.operateMode,this._propOperateMode===o.SCALE?this._board.classList.remove("shape-active-cropping"):this._board.classList.add("shape-active-cropping")),this._back.setProps({url:this._propData.url,size:{width:this._propData.width+this._propData.clipLeft+this._propData.clipRight,height:this._propData.height+this._propData.clipTop+this._propData.clipBottom},translate:{x:-this._propData.clipLeft,y:-this._propData.clipTop},display:this._propOperateMode!==o.SCALE}),this._front.setProps({url:this._propData.url,size:{width:this._propData.width+this._propData.clipLeft+this._propData.clipRight,height:this._propData.height+this._propData.clipTop+this._propData.clipBottom},translate:{x:-this._propData.clipLeft,y:-this._propData.clipTop}}),Object.assign(this._board.style,{left:this._propData.left+"px",top:this._propData.top+"px",width:this._propData.width+"px",height:this._propData.height+"px",display:this._propDisplay?"block":"none"})},(0,i.Z)(e,[{key:"dragControl",get:function(){return this._dragControl}},{key:"isMoving",get:function(){return this._isMoving}}]),e}(),O=n("../spread-sheet/src/core/ui/tooltip/index.ts"),B=n("../spread-sheet/src/core/view/utils/base-func.ts"),Z=function(){function e(e,t){var n=this;this._board=document.createElement("div"),this._crop=document.createElement("div"),this._reset=document.createElement("div"),this._propData=t.data,this._propDisplay=t.display,this._propOperateMode=t.operateMode,this._propCropCallback=t.cropCallback,this._propResetCallback=t.resetCallback,this._board.classList.add("shape-active-toolbar"),Object.assign(this._board.style,{display:this._propDisplay?"block":"none"}),this._crop.classList.add("shape-active-toolbar-btn"),this._crop.classList.add("shape-active-toolbar-btn-crop"),this._crop.dataset.tooltip=m.ZP.t("裁剪"),this._crop.addEventListener("mousedown",B.UW),this._crop.addEventListener("click",(function(){n._propCropCallback()})),this._board.appendChild(this._crop),this._reset.classList.add("shape-active-toolbar-btn"),this._reset.classList.add("shape-active-toolbar-btn-reset"),this._reset.dataset.tooltip=m.ZP.t("恢复原图"),this._reset.addEventListener("mousedown",B.UW),this._reset.addEventListener("click",(function(){n._propResetCallback()})),this._board.appendChild(this._reset),e.appendChild(this._board),(0,O.showTooltip)(".shape-active-toolbar-btn",{})}var t=e.prototype;return t.update=function(){var e=this._propData,t=e.left,n=e.top,o=e.width;this._board.style.left=Math.max(0,t+o+10)+"px",this._board.style.top=Math.max(0,n)+"px"},t.setProps=function(e){void 0!==e.data&&(this._propData=e.data),void 0!==e.display&&(this._propDisplay=e.display),void 0!==e.operateMode&&(this._propOperateMode=e.operateMode,this._propOperateMode===o.SCALE?this._crop.classList.remove("shape-active-toolbar-btn-cropping"):this._crop.classList.add("shape-active-toolbar-btn-cropping")),Object.assign(this._board.style,{left:this._propData.left+this._propData.width+10+"px",top:this._propData.top+"px",display:this._propDisplay?"block":"none"})},e}(),U=n("../packages/lib/Keyboard.ts"),H=n("../packages/report/src/index.ts"),V=function(e){var t=this;this._right=function(){return t._moveShape(10,0),!1},this._left=function(){return t._moveShape(-10,0),!1},this._down=function(){return t._moveShape(0,10),!1},this._up=function(){return t._moveShape(0,-10),!1},this._delete=function(){return t._removeShape(),H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_del"}),!1},this._esc=function(){return t._cancel(),!1},this._copy=function(){var e=window.SpreadsheetApp;if(!e.sheetStatus.canEdit)return!1;e.feature.copyPaste.doShapesCopy(e.feature.copyPasteBase.CopyType.copy);try{H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_menu_ctrl_c"})}catch(t){}return!1},this._cut=function(){var e=window.SpreadsheetApp;if(!e.sheetStatus.canEdit)return!1;e.feature.copyPaste.doShapesCopy(e.feature.copyPasteBase.CopyType.cut);try{H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_menu_ctrl_x"})}catch(t){}return!1},this._container=e.container,this._moveShape=e.moveShape,this._removeShape=e.removeShape,this._cancel=e.cancel;var n=[{key:U.ZP.KEYS.RIGHT,handler:this._right},{key:U.ZP.KEYS.LEFT,handler:this._left},{key:U.ZP.KEYS.DOWN,handler:this._down},{key:U.ZP.KEYS.UP,handler:this._up},{key:U.ZP.KEYS.DELETE,handler:this._delete},{key:U.ZP.KEYS.BACKSPACE,handler:this._delete},{key:U.ZP.KEYS.ESCAPE,handler:this._esc},{key:"c",shortKey:!0,handler:function(){return t._copy(),!1}},{key:"x",shortKey:!0,handler:function(){return t._cut(),!1}},{key:U.h1,shortKey:!0,handler:function(){return!1}}];new U.ZP({root:this._container,bindings:n})},K=n("../spread-sheet/src/core/view/level-1/shape-stage/stage/RecalculateListener.ts"),G=n("../packages/model/src/embedded/index.ts"),z=function(e){function t(n){var i;return(i=e.call(this,n)||this)._container=document.createElement("div"),i._operateMode=o.SCALE,i.handleDataUpdate=function(e){var t;e===i._shapeId&&((null===(t=i._spreadSheet.activeSheet.imageManager.getImage(e))||void 0===t?void 0:t.type)!==G.EMBEDDED_OBJECT_TYPE.CELL_IMAGE?(i.refreshData(),i._update()):i.hideDeletedShape(e))},i.hideDeletedShape=function(e){i.hide(e,!0)},i._syncData=function(){i._sheetStatus.canEdit&&(i._info.hide(),e.prototype._syncData.call((0,s.Z)(i)))},i._beforeUpdate=function(e){i._sheetStatus.canEdit&&(e!==r.CLIP&&e!==r.SCALE||(i._info.show(),i._info.change(i._data.left,i._data.top,i._data.width,i._data.height)),i.emitter.emit(t.EVENT.READY_UPDATE))},i._update=function(e){void 0===e&&(e={}),i._box.setProps(e),i._sheetStatus.canEdit&&i._toolbar.setProps(e),i.emitter.emit(t.EVENT.UPDATE)},i._handleClip=function(e,t,n){if(i._sheetStatus.canEdit){var o=i._scale.scale;(0,d.p7)(i._data,i._areaData,e,t*o,n*o),i._info.change(i._data.left,i._data.top,i._data.width,i._data.height),i._update()}},i._handleScale=function(e,t,n){if(i._sheetStatus.canEdit){var o=i._scale.scale;(0,d.p5)(i._data,i._areaData,e,t*o,n*o),i._info.change(i._data.left,i._data.top,i._data.width,i._data.height),i._update(),H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_zoom"});var r=i._originSize,s=r.width,a=r.height;s*a<i._data.width*i._data.height?H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_zoom_in"}):s*a>i._data.width*i._data.height&&H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_zoom_out"})}},i._handleMove=function(){if(i._sheetStatus.canEdit){var e=i._scale.scale;(0,d.CC)(i._data,i._areaData,i._operateData.diffX*e,i._operateData.diffY*e),i._update(),H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_move"})}},i._handleKeyboardMove=function(e,t){i._sheetStatus.canEdit&&i._operateMode!==o.CLIP&&((0,d.CC)(i._data,i._areaData,e,t),i._update(),i._syncData(),H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_move"}))},i._handleClickCrop=function(){i._sheetStatus.canEdit&&(i._operateMode===o.SCALE?i._operateMode=o.CLIP:i._operateMode=o.SCALE,i._update({operateMode:i._operateMode}),H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_size_cut"}))},i._handleClickReset=function(){i._sheetStatus.canEdit&&(i._resetData(),i._update(),H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_recovery"}))},i._handleContextMenu=function(){i._sheetStatus.canEdit&&i.emitter.emit(t.EVENT.CONTEXT_MENU)},i._handleUpdateOffset=function(){if(!i._box.isMoving){var e=i._shapeStage.viewShapeData.getShapeData(i._shapeId);if(e){var t=e.shape,n=i._areaData.getDisplayViewLeftByCol(t.position.overlayPosition.anchorCell.colIndex)+t.position.overlayPosition.offsetXpixels*i._scale.scale,o=i._areaData.getDisplayViewTopByRow(t.position.overlayPosition.anchorCell.rowIndex)+t.position.overlayPosition.offsetYpixels*i._scale.scale;Object.assign(i._data,{left:n,top:o}),i._update()}else console.error("未找到图片")}},i.emitter=new c.Z,i._sheetStatus=n.sheetStatus,i._mainBoard=n.mainBoard,i._operateData=n.operateData,i._removeShape=n.removeShape,i._cancel=n.cancel,i._dblclick=n.dblclick,i._container.classList.add("shape-active-board"),i._container.setAttribute("data-testid","shape-active-board"),i._container.setAttribute("tabindex","4"),i._container.addEventListener("dblclick",i._dblclick),i._mainBoard.element.appendChild(i._container),i._box=new N({container:i._container,data:i._data,display:!1,operateMode:i._operateMode,beforeUpdateCallback:i._beforeUpdate,afterUpdateCallback:i._syncData,clipCallback:i._handleClip,scaleCallback:i._handleScale,moveCallback:i._handleMove,contextMenuCallback:i._handleContextMenu,infoHide:function(){return i._info.hide()},operateData:i._operateData,autoScroll:i._autoScroll}),i._toolbar=new Z(i._container,{data:i._data,display:!1,operateMode:i._operateMode,cropCallback:i._handleClickCrop,resetCallback:i._handleClickReset}),i._info=new f(i._container),i._keyboardShape=new V({container:i._container,moveShape:i._handleKeyboardMove,removeShape:i._removeShape,cancel:i._cancel}),new K.Z({dataCallView:n.dataCallView,spreadsheet:n.spreadsheet,addEmbeddedObject:function(){},updateEmbeddedObject:i.handleDataUpdate,removeEmbeddedObject:i.hideDeletedShape,hideEmbeddedObject:i.hideDeletedShape,showEmbeddedObject:function(){}}),i}(0,a.Z)(t,e);var n=t.prototype;return n.show=function(n){e.prototype._show.call(this,n)&&(this._update({display:!0}),this._container.focus(),this.emitter.emit(t.EVENT.SHOW,n),this._areaDataUpdateOffsetDispose=this._areaData.onUpdateOffset(this._handleUpdateOffset))},n.hide=function(n,r){void 0===r&&(r=!1),this._editing&&n===this._shapeId&&(this._areaDataUpdateOffsetDispose.dispose(),e.prototype._hide.call(this,n,r),this._operateMode=o.SCALE,this._update({operateMode:this._operateMode,display:!1}),this.emitter.emit(t.EVENT.HIDE,n))},n.enterCrop=function(){this._operateMode=o.CLIP,this._update({operateMode:this._operateMode})},n.reset=function(){this._handleClickReset()},(0,i.Z)(t,[{key:"EVENT",get:function(){return t.EVENT}}]),t}(h);z.EVENT={SHOW:"show",HIDE:"hide",UPDATE:"update",READY_UPDATE:"readyUpdate",CONTEXT_MENU:"contextMenu"};var F=z,W=n("../node_modules/@tencent/dui/lib/components/Preview/index.js"),Y=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),q=(n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../spread-sheet/src/base/event/eventName.ts")),Q=n("../packages/model/src/range/index.ts"),X=n("../spread-sheet/src/core/data/converter/tencentdoc/utils/files.ts"),J=(n("../spread-sheet/src/base/util/domain-config.ts"),n("../spread-sheet/src/base/event/event.ts")),$=n("../spread-sheet/src/external/tencentMeeting/event/eventName.ts"),ee=n("../spread-sheet/src/core/view/spreadsheet-view/area-data/AreaData.interface.ts"),te=n("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),ne=R().isMobile?q.Xs.SHAPE_PREVIEW_M:q.Xs.SHAPE_PREVIEW_PC,oe=function(e){function t(t){var n;return(n=e.call(this,t)||this).previewComponent=W.default,n}return(0,a.Z)(t,e),t}(function(){function e(e){var t=this;this.onChange=function(e,n){var o,r=n[e],i=r.type,s=i===X.XE.ATTACHED_IMAGE?{type:i,shapeId:r.id,source:ee.oz.USER}:{type:i,shapePosition:r.cellPosition,source:ee.oz.USER};null===(o=t.preview)||void 0===o||o.update({index:e}),J.ZP.tencentMeetingEvent.trigger($.z.SHAPE_PREVIEW_UPDATE,s)},this.spreadsheet=e.spreadsheet,this.app=this.spreadsheet.parent,this.app.emitter.on(this.app.EVENT.START_DESTROY,(function(){return t.hide()}))}var t=e.prototype;return t.isShowing=function(){return Boolean(this.preview)},t.show=function(e,t,o){var r,i,s,a=this;if(void 0===t&&(t=ee.oz.USER),"string"!==typeof e&&(0,te.xy)(this.spreadsheet,e.row,e.col))return n.g.log.info("Preview image is forbidden, because the cell ("+e.row+","+e.col+") is privacy."),!1;var l=document.activeElement,c=this.getCurrentIndex(e);if(c<0)return!1;var d=this.getFileList(e);this.preview=this.previewComponent.show({initialIndex:c,onClose:function(){var e,t,n,r,i;a.preview=void 0,J.ZP.tencentMeetingEvent.trigger($.z.SHAPE_PREVIEW_HIDE,{source:ee.oz.USER}),null===(n=null===(t=null===(e=a.spreadsheet.parent)||void 0===e?void 0:e.event)||void 0===t?void 0:t.default)||void 0===n||n.trigger(q.W1.UI_HIDE,ne),null===(r=a.closeCallback)||void 0===r||r.call(a),null===o||void 0===o||o(),R().isPC&&(null===(i=null===l||void 0===l?void 0:l.focus)||void 0===i||i.call(l))},onChange:function(e){return a.onChange(e,d)},images:d,cycle:!0});var u="object"===typeof e?X.XE.CELL_IMAGE:X.XE.ATTACHED_IMAGE,p=u===X.XE.ATTACHED_IMAGE?{type:u,shapeId:e,source:t}:{type:u,shapePosition:e,source:t};return J.ZP.tencentMeetingEvent.trigger($.z.SHAPE_PREVIEW_SHOW,p),null===(s=null===(i=null===(r=this.spreadsheet.parent)||void 0===r?void 0:r.event)||void 0===i?void 0:i.default)||void 0===s||s.trigger(q.W1.UI_SHOW,ne),H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:R().isMobile?"mob_picture_menu_view":"picture_menu_view"}),!0},t.hide=function(){this.preview&&(this.preview.close(),this.preview=void 0)},t.update=function(e){var t=this.getCurrentIndex(e);t<0||(this.preview?this.preview.update({index:t}):this.show(e,ee.oz.API))},t.getFilesResult=function(e){var t=this.spreadsheet.activeSheet,n=[new Q.GridRange(t.getSheetId())],o="object"===typeof e?Object.assign({},e):null;if("object"===typeof e){var r=t.getCellDataAtPosition(e.row,e.col),i=null===r||void 0===r?void 0:r.getMergeReference();i&&o&&(o.row=i.startRowIndex,o.col=i.startColIndex)}return[(0,X.LB)(t,n,o,!0),(0,X.Ll)(t,n,"string"===typeof e?e:null)]},t.getFileList=function(e){var t=this.getFilesResult(e),n=t[0],o=t[1];return[].concat((0,Y.Z)(n.files),(0,Y.Z)(o.files))},t.getCurrentIndex=function(e){var t=this.getFilesResult(e),n=t[0],o=t[1];return"object"===typeof e?n.currentIndex:n.files.length+o.currentIndex},e}()),re=function(e){function t(t){var n;return(n=e.call(this,t)||this)._hide=function(){if(n.focusingImpl){var t=n.shapeIdImpl;e.prototype.blur.call((0,s.Z)(n)),n.editImpl.hide(t),n.scaleEventDispose.dispose()}},n.handleShapeFocus=function(e){n.focus(e),n.operateData.e.preventDefault()},n.handleDelete=function(){n.shapeIdImpl&&n.modifyShapeBroker.deleteShape(n.shapeIdImpl),n.hide()},n.cancel=function(){n.hide()},n.operateData=t.operateData,n.mainBoard=t.mainBoard,n.shapeStage=t.shapeStage,n.areaData=t.areaData,n.scale=t.scale,n.normalSelectStage=t.normalSelectStage,n.editImpl=new F({sheetStatus:n.sheetStatus,mainBoard:n.mainBoard,areaData:n.areaData,scale:n.scale,syncData:n.syncData,operateData:n.operateData,shapeStage:n.shapeStage,removeShape:n.handleDelete,autoScroll:n.autoScroll,cancel:n.cancel,spreadsheet:t.spreadsheet,dataCallView:t.dataCallView,dblclick:function(e){null===e||void 0===e||e.stopPropagation(),n.shapeZoomImpl.show(n.shapeIdImpl)}}),n.shapeZoomImpl=new oe({spreadsheet:n.spreadsheet}),n.shapeStage.onFocus(n.handleShapeFocus),n}(0,a.Z)(t,e);var n=t.prototype;return n.focus=function(t){return this.shapeIdImpl&&this.shapeIdImpl!==t&&this._hide(),e.prototype.focus.call(this,t)&&(this.editImpl.show(this.shapeIdImpl),this.scaleEventDispose=this.scale.onScale(this.hide)),this.focusingImpl},n.mutexHide=function(){this._hide()},n.hide=function(){this._hide(),this.normalSelectStage.show()},(0,i.Z)(t,[{key:"edit",get:function(){return this.editImpl}},{key:"shapeZoom",get:function(){return this.shapeZoomImpl}}]),t}(l),ie=n("../spread-sheet/src/core/view/lib/mutex-management/MutexManagement.ts"),se=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},ae=function(e,t){var n=this;this._handleShapeActiveShow=function(e){n._shapeStage.hideShape(e),n._mutexManagement.mutexShow(ie.d.SHAPE),3===n._operateData.e.which&&n._showShapeMenu()},this._handleShapeActiveHide=function(e){n._shapeStage.showShape(e)},this._showShapeMenu=function(){return se(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:H.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_menu"});case 1:case"end":return e.stop()}}),e)})))},this._shapeEdit=e,this._shapeStage=t.shapeStage,this._operateData=t.operateData,this._scale=t.scale,this._mutexManagement=t.mutexManagement,this._mutexManagement.addMutexComponent(ie.d.SHAPE,this._shapeEdit),this._shapeEdit.edit.emitter.on(this._shapeEdit.edit.EVENT.SHOW,this._handleShapeActiveShow),this._shapeEdit.edit.emitter.on(this._shapeEdit.edit.EVENT.HIDE,this._handleShapeActiveHide),this._shapeEdit.edit.emitter.on(this._shapeEdit.edit.EVENT.CONTEXT_MENU,this._showShapeMenu)},le=n("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),ce=n("../spread-sheet/src/core/view/spreadsheet-view/utils.ts"),de=n("../packages/model/src/cell/format/colorUtils.ts"),ue=n("../node_modules/lodash/isEmpty.js"),pe=n.n(ue),he=function(e){function t(t){var n;return(n=e.call(this,t)||this).highlightCellMap={},n.renderAfterCell=function(e){if(!pe()(n.highlightCellMap)){var t=e.x,o=e.y,r=e.row,i=e.col;if(void 0!==n.highlightCellMap[r]&&void 0!==n.highlightCellMap[r][i]){var s=n.tableView.getCellViewAtPosition(r,i),a=(0,ce.o)(n.rowcolAccessor,s,i),l=(0,ce.E)(n.rowcolAccessor,s,r);n.coverBackgroundCollect.collect({color:(0,de.rgba2hex)(30,111,255,.08),graphicsInfo:{path:(0,B.j9)(t,o,a,l)}})}}},n.rowcolAccessor=t.rowcolAccessor,n.tableView=t.tableView,n.coverBackgroundCollect=t.coverBackgroundCollect,n.renderApi=t.renderApi,n._alloyExcel.onAfterCellRender(n.renderAfterCell),n}(0,a.Z)(t,e);var n=t.prototype;return n.showHighlight=function(e){for(var t=0;t<e.length;t++){var n=e[t].x,o=e[t].y;void 0===this.highlightCellMap[o]&&(this.highlightCellMap[o]={}),this.highlightCellMap[o][n]=!0}this.renderApi.renderNextTick()},n.hideHighlight=function(){this.highlightCellMap={},this.renderApi.renderNextTick()},t}(le.Z),me=function(){function e(e){this.shapeToCellHighlightRenderPlugin=new he({alloyExcel:e.alloyExcel,rowcolAccessor:e.rowcolAccessor,tableView:e.tableView,coverBackgroundCollect:e.renderPluginExtension.coverBackgroundCollect,renderApi:e.renderApi}),this.shapeEditImpl=new re(e),this.feature=new ae(this.shapeEditImpl,e)}return(0,i.Z)(e,[{key:"shapeEdit",get:function(){return this.shapeEditImpl}},{key:"shapeToCellHighlightPlugin",get:function(){return this.shapeToCellHighlightRenderPlugin}}]),e}()},"../spread-sheet/src/core/view/level-2/table-keyboard/TableKeyboard.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js");var o=n("../packages/lib/Keyboard.ts"),r=n("../packages/report/src/index.ts"),i=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),s=n.n(i),a=n("../spread-sheet/src/base/event/event.ts"),l=n("../spread-sheet/src/base/util/browser.ts"),c=n("../spread-sheet/src/external/view/pc/footer/components/scalebar/scalebar.tsx"),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},u=function(){function e(e){var t=this;this._pageDown=function(){var e=t._spreadsheetApp.view.canvas.clientRect.height;t._spreadsheetApp.view.canvas.scrollApi.scrollByPixel({diffY:e,areaY:"flow"});try{r.ZP.tdwReport({module:"excel_shortcuts",opername:"doc_excel_editor",action:s().isMac||s().isIPad?"select_shortcuts_Fn+Down":"select_shortcuts_Page Down"})}catch(n){}return!1},this._pageUp=function(){var e=t._spreadsheetApp.view.canvas.clientRect.height;t._spreadsheetApp.view.canvas.scrollApi.scrollByPixel({diffY:-e,areaY:"flow"});try{r.ZP.tdwReport({module:"excel_shortcuts",opername:"doc_excel_editor",action:s().isMac||s().isIPad?"select_shortcuts_Fn+Up":"select_shortcuts_Page Up"})}catch(n){}return!1},this._scaleReset=function(){if(100===(0,l.j7)())return a.ZP.sheetsBar.trigger("changeScale",0),!1},this._scaleMore=function(){if(100===(0,l.j7)())return a.ZP.sheetsBar.trigger("changeScale",c.x),!1},this._scaleLess=function(){if(100===(0,l.j7)())return a.ZP.sheetsBar.trigger("changeScale",-1*c.x),!1},this._fullScreen=function(){return a.ZP.sheetsBar.trigger("toggleFullScreen"),!1},this._spreadsheetApp=e.spreadsheetApp,this._board=e.board,this._bindTableKeyboard(),this._bindBodyKeyboard(),this._bindForGesture()}var t=e.prototype;return t._bindTableKeyboard=function(){new o.ZP({root:this._board,bindings:[{key:o.ZP.KEYS.PAGE_DOWN,handler:this._pageDown},{key:o.ZP.KEYS.PAGE_UP,handler:this._pageUp}]})},t._bindBodyKeyboard=function(){var e=this,t=[{key:"0",shortKey:!0,handler:this._scaleReset},{key:o.ZP.KEYS.NUMPAD0,shortKey:!0,handler:this._scaleReset},{key:"=",shortKey:!0,handler:this._scaleMore},{key:o.ZP.KEYS.NUMPAD_ADD,shortKey:!0,handler:this._scaleMore},{key:"-",shortKey:!0,handler:this._scaleLess},{key:o.ZP.KEYS.NUMPAD_SUBTRACT,shortKey:!0,handler:this._scaleLess},{key:"s",shortKey:!0,handler:function(){return!1}},{key:"p",shortKey:!0,handler:function(){return d(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._spreadsheetApp.spreadsheet.isExternalSheet()){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this._spreadsheetApp.view.canvas.getTablePrintCenter();case 4:return e.sent.startPrint(),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,this)})))}}];s().isMac?t.push({key:"f",shortKey:!0,ctrlKey:!0,handler:this._fullScreen}):t.push({key:o.ZP.KEYS.F11,handler:this._fullScreen}),new o.ZP({root:document.body,bindings:t})},t._bindForGesture=function(){s().isSafari&&document.addEventListener("gesturestart",(function(e){e.preventDefault()}))},e}(),p=(n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../spread-sheet/src/core/utils/cell.ts")),h=n("../packages/model/src/index.ts"),m=n("../spread-sheet/src/core/utils/selection.ts"),f=n("../packages/model/src/cell/format/HorizontalAlign.ts"),v=n("../node_modules/@tencent/txdoc_dayjs/dayjs.min.js"),g=n.n(v),_=n("../packages/model/src/range/DimensionRange.ts"),y=n("../packages/model/src/dimension/DimensionType.ts"),w=n("../spread-sheet/src/core/view/level-2/filter-center/util.ts"),C=n("../spread-sheet/src/core/view/level-2/ent-link-center/constant/file-type.ts"),E=n("../spread-sheet/src/core/feature/relateFormEnt/enterpriseStatus.ts");function I(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var x=0,S=[C.G.WEDOCS,C.G.WEDRIVE_AND_WEDOCS,void 0];function k(e){var t=e.spreadsheet.properties,n=(0,m.getActiveCell)(e);if(!n)return null;var o=n.getUserEnteredFormat();if(!o)return null;var r=o.getFontSize();return r||t.defaultFormat.textFormat.fontSize}var A=function(e){var t=this;this._undo=function(){return(0,w.bU)(t._spreadsheetApp.undoredoStack.undoStack,t._spreadsheetApp)||t._spreadsheetApp.sheetStatus.canEdit?(t._spreadsheetApp.requestApi.undo(),!1):void 0},this._redo=function(){return(0,w.bU)(t._spreadsheetApp.undoredoStack.redoStack,t._spreadsheetApp)||t._spreadsheetApp.sheetStatus.canEdit?(t._spreadsheetApp.requestApi.redo(),!1):void 0},this._fontBold=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.fontBold(!(0,p.cellIsBold)(t._spreadsheetApp)),!1},this._fontItalics=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.fontItalics(!(0,p.cellIsItalic)(t._spreadsheetApp)),!1},this._fontUnderLine=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return(0,p.cellIsUnderline)(t._spreadsheetApp)?t._spreadsheetApp.requestApi.fontUnderLine(null):t._spreadsheetApp.requestApi.fontUnderLine(h.Cell.Format.UNDERLINE_TYPE.SINGLE_LINE),!1},this._fontStrike=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.fontStrike(!(0,p.cellIsStrikethrough)(t._spreadsheetApp)),r.ZP.tdwReport({module:"excel_shortcuts",opername:"doc_excel_editor",action:s().isMac||s().isIPad?"select_shortcuts_Control+5":"select_shortcuts_Ctrl+5"}),!1},this._fill=function(){var e=t._spreadsheetApp.feature.copyPaste;if(!t._spreadsheetApp.sheetStatus.canEdit)return!1;if(void 0===e||void 0===e.copyPasteCache)return!1;var n=e.copyPasteCache,o=t._spreadsheetApp.view.getSelection();if(1!==o.rangeSelections.length)return!1;var i=o.rangeSelections[0],a=i.clone();return i.startRowIndex===i.endRowIndex&&(i.startRowIndex-=1,i.endRowIndex-=1),n.onCopy({from:{xRange:[i.startColIndex,i.endColIndex],yRange:[i.startRowIndex,i.startRowIndex]},copyType:t._spreadsheetApp.feature.copyPasteBase.CopyType.copy,hotInstance:t._spreadsheetApp}),n.onPaste({to:{xRange:[a.startColIndex,a.endColIndex],yRange:[a.startRowIndex,a.endRowIndex]},hotInstance:t._spreadsheetApp,pasteData:void 0}),r.ZP.tdwReport({module:"excel_shortcuts",opername:"doc_excel_editor",action:s().isMac||s().isIPad?"select_shortcuts_Control+D":"select_shortcuts_Ctrl+D"}),!1},this._deleteContent=function(){t._spreadsheetApp.sheetStatus.canEdit&&t._spreadsheetApp.requestApi.clearContent()},this._insertDateFormat=function(e){if(t._spreadsheetApp.sheetStatus.canEdit){var n=g()().format(e),o=t._spreadsheetApp.view.getSelection(),i=o.activeCell.colIndex,a=o.activeCell.rowIndex;return t._spreadsheetApp.view.canvas.inputManager.handleExitInput(),t._spreadsheetApp.requestApi.userEnter({text:n,colIndex:i,rowIndex:a}),r.ZP.tdwReport({module:"excel_shortcuts",opername:"doc_excel_editor",action:s().isMac||s().isIPad?"select_shortcuts_Control+;":"select_shortcuts_Ctrl+;"}),!1}},this._insertDate=function(){return t._insertDateFormat("YYYY/M/D")},this._insertTime=function(){return t._insertDateFormat("H:mm")},this._insertDateTime=function(){return t._insertDateFormat("YYYY/M/D H:mm")},this._insertRow=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.insertRows(),!1},this._deleteRow=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.deleteRows(),!1},this._fontSizeBigger=function(){if(t._spreadsheetApp.sheetStatus.canEdit){var e=k(t._spreadsheetApp);if(null!==e)return t._spreadsheetApp.requestApi.setFontSize(e+2),!1}},this._fontSizeSmaller=function(){if(t._spreadsheetApp.sheetStatus.canEdit){var e=k(t._spreadsheetApp);if(null!==e)return t._spreadsheetApp.requestApi.setFontSize(e-2),!1}},this._leftAlign=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.setHorizontalAlign(f.Z.LEFT),!1},this._rightAlign=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.setHorizontalAlign(f.Z.RIGHT),!1},this._centerAlign=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.setHorizontalAlign(f.Z.CENTER),!1},this._getValidRange=function(){if(!t._spreadsheetApp.sheetStatus.canEdit)return null;var e=t._spreadsheetApp.view.canvas.normalSelectData.activeCol,n=t._spreadsheetApp.view.canvas.normalSelectData.activeRow,o=t._spreadsheetApp.spreadsheet.getActiveSheetId();if(e<0||n<0)throw new Error("选区状态异常，无法插入链接");return{col:e,row:n,sheetId:o}},this._insertLink=function(){var e=t._getValidRange();if(e)return t._spreadsheetApp.view.canvas.linkCenter.addLink(e.row,e.col),r.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_link",action:"excel_link_click",ver10:"quick_set"}),!1},this._insertFile=function(){var e=t._getValidRange();if(e&&E.JY.get().wedoc){var n=S[x%S.length];return x+=1,void 0!==n?t._spreadsheetApp.view.canvas.fileSelector.showAndApply(e.sheetId,e.row,e.col,n,(function(){return x=0})):t._spreadsheetApp.view.canvas.fileSelector.hide(),!1}},this._enterInputStatus=function(){t._spreadsheetApp.sheetStatus.canEdit&&(t._spreadsheetApp.view.canvas.inputManager.isInputtingState()||t._spreadsheetApp.view.canvas.inputManager.handleEnterInput())},this._insertComment=function(){var e,n=t._spreadsheetApp.view.canvas.normalSelectData.activeRow,o=t._spreadsheetApp.view.canvas.normalSelectData.activeCol;n<0||o<0||t._spreadsheetApp.sheetStatus.canComment&&(0,m.singleRange)(t._spreadsheetApp)&&(null===(e=t._spreadsheetApp.view.canvas.commentCenter)||void 0===e||e.openComment(n,o))},this._mergeCells=function(){if(t._spreadsheetApp.sheetStatus.canEdit&&!(0,m.isSelectedAll)(t._spreadsheetApp)){var e=t._spreadsheetApp.view.getSelection(),n=(0,m.isMergeCell)(t._spreadsheetApp);if(!(0,m.singleRange)(t._spreadsheetApp)||n){var o=(0,m.hasMergeCell)(t._spreadsheetApp),r=e.rangeSelections,i=void 0===r?[]:r;n||o?t._spreadsheetApp.requestApi.unmergeCells(i):t._spreadsheetApp.requestApi.mergeCells(i)}}},this._insertLeftCol=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.insertColumns(),!1},this._deleteCol=function(){if(t._spreadsheetApp.sheetStatus.canEdit)return t._spreadsheetApp.requestApi.deleteColumns(),!1},this._filter=function(){if(t._spreadsheetApp.sheetStatus.canEdit&&!t._spreadsheetApp.view.canvas.inputManager.isInputtingState())return(0,p.hasBasicFilter)(t._spreadsheetApp)?t._spreadsheetApp.requestApi.clearBasicFilter():t._spreadsheetApp.requestApi.setBasicFilter(),!1},this._hideRow=function(){if(t._spreadsheetApp.sheetStatus.canEdit){for(var e,n=[],o=I(t._spreadsheetApp.view.canvas.normalSelectData.selectQueue);!(e=o()).done;){var r=e.value;if(r.selectRow||r.selectCell){var i=r.yRange;n.push(new _.Z(t._spreadsheetApp.spreadsheet.activeSheetId,i[0],i[1],y.Z.ROWS))}}return t._spreadsheetApp.requestApi.hideRows(n),!1}},this._hideCol=function(){if(t._spreadsheetApp.sheetStatus.canEdit){for(var e,n=[],o=I(t._spreadsheetApp.view.canvas.normalSelectData.selectQueue);!(e=o()).done;){var r=e.value;if(r.selectCol||r.selectCell){var i=r.xRange;n.push(new _.Z(t._spreadsheetApp.spreadsheet.activeSheetId,i[0],i[1],y.Z.COLUMNS))}}return t._spreadsheetApp.requestApi.hideColumns(n),!1}},this._showRow=function(){if(t._spreadsheetApp.sheetStatus.canEdit){for(var e,n=[],o=I(t._spreadsheetApp.view.canvas.normalSelectData.selectQueue);!(e=o()).done;){var r=e.value;if(r.selectRow||r.selectCell){var i=r.yRange;n.push(new _.Z(t._spreadsheetApp.spreadsheet.activeSheetId,i[0],i[1],y.Z.ROWS))}}return t._spreadsheetApp.requestApi.showRows(n),!1}},this._showCol=function(){if(t._spreadsheetApp.sheetStatus.canEdit){for(var e,n=[],o=I(t._spreadsheetApp.view.canvas.normalSelectData.selectQueue);!(e=o()).done;){var r=e.value;if(r.selectCol||r.selectCell){var i=r.xRange;n.push(new _.Z(t._spreadsheetApp.spreadsheet.activeSheetId,i[0],i[1],y.Z.COLUMNS))}}return t._spreadsheetApp.requestApi.showColumns(n),!1}},this.toggleA11y=function(){return t._spreadsheetApp.view.canvas.accessibility.toggleA11Y(!0),!1},this._spreadsheetApp=e.spreadsheetApp,this.board=e.board,new o.ZP({root:this.board,bindings:[{key:"z",shortKey:!0,handler:this._undo},{key:"z",shortKey:!0,shiftKey:!0,handler:this._redo},{key:"y",shortKey:!0,handler:this._redo},{key:"b",shortKey:!0,handler:this._fontBold},{key:"i",shortKey:!0,handler:this._fontItalics},{key:"u",shortKey:!0,handler:this._fontUnderLine},{key:"5",ctrlKey:!0,handler:this._fontStrike},{key:"d",ctrlKey:!0,handler:this._fill},{key:o.ZP.KEYS.EQUAL,altKey:!0,shiftKey:!0,handler:this._insertRow},{key:o.ZP.KEYS.EQUAL_FIREFOX,altKey:!0,shiftKey:!0,handler:this._insertRow},{key:o.ZP.KEYS.MINUS,altKey:!0,shiftKey:!0,handler:this._deleteRow},{key:o.ZP.KEYS.MINUS_FIREFOX,altKey:!0,shiftKey:!0,handler:this._deleteRow},{key:o.ZP.KEYS.PERIOD,shortKey:!0,shiftKey:!0,handler:this._fontSizeBigger},{key:o.ZP.KEYS.COMMA,shortKey:!0,shiftKey:!0,handler:this._fontSizeSmaller},{key:"l",ctrlKey:!0,handler:this._leftAlign},{key:"r",ctrlKey:!0,handler:this._rightAlign},{key:"e",ctrlKey:!0,handler:this._centerAlign},{key:o.ZP.KEYS.DELETE,handler:this._deleteContent},{key:o.ZP.KEYS.BACKSPACE,handler:this._deleteContent},{key:"k",shortKey:!0,handler:this._insertLink},{key:"k",shortKey:!0,shiftKey:!0,handler:this._insertFile},{key:o.ZP.KEYS.F2,handler:this._enterInputStatus},{key:o.ZP.KEYS.F2,shiftKey:!0,handler:this._insertComment},{key:o.ZP.KEYS.SEMICOLON,ctrlKey:!0,handler:this._insertDate},{key:o.ZP.KEYS.SEMICOLON,metaKey:!0,handler:this._insertDate},{key:o.ZP.KEYS.SEMICOLON,shortKey:!0,shiftKey:!0,handler:this._insertTime},{key:o.ZP.KEYS.SEMICOLON,shortKey:!0,altKey:!0,handler:this._insertDateTime},{key:o.ZP.KEYS.SEMICOLON_FIREFOX,ctrlKey:!0,handler:this._insertDate},{key:o.ZP.KEYS.SEMICOLON_FIREFOX,metaKey:!0,handler:this._insertDate},{key:o.ZP.KEYS.SEMICOLON_FIREFOX,shortKey:!0,shiftKey:!0,handler:this._insertTime},{key:o.ZP.KEYS.SEMICOLON_FIREFOX,shortKey:!0,altKey:!0,handler:this._insertDateTime},{key:"d",altKey:!0,shiftKey:!0,handler:this._mergeCells},{key:o.ZP.KEYS.EQUAL,shortKey:!0,altKey:!0,handler:this._insertLeftCol},{key:o.ZP.KEYS.EQUAL_FIREFOX,shortKey:!0,altKey:!0,handler:this._insertLeftCol},{key:o.ZP.KEYS.MINUS,shortKey:!0,altKey:!0,handler:this._deleteCol},{key:o.ZP.KEYS.MINUS_FIREFOX,shortKey:!0,altKey:!0,handler:this._deleteCol},{key:"l",shiftKey:!0,ctrlKey:s().isMac,altKey:!s().isMac,handler:this._filter},{key:"9",shortKey:!0,altKey:!0,handler:this._hideRow},{key:o.ZP.KEYS.NUMPAD9,shortKey:!0,altKey:!0,handler:this._hideRow},{key:"0",shortKey:!0,altKey:!0,handler:this._hideCol},{key:o.ZP.KEYS.NUMPAD0,shortKey:!0,altKey:!0,handler:this._hideCol},{key:"9",altKey:!0,shiftKey:!0,handler:this._showRow},{key:o.ZP.KEYS.NUMPAD9,altKey:!0,shiftKey:!0,handler:this._showRow},{key:"0",altKey:!0,shiftKey:!0,handler:this._showCol},{key:o.ZP.KEYS.NUMPAD0,altKey:!0,shiftKey:!0,handler:this._showCol},{key:o.ZP.KEYS.BACK_QUOTE,shortKey:!s().isMac,ctrlKey:s().isMac,handler:this.toggleA11y}]})},D=n("../node_modules/i18next/dist/esm/i18next.js"),T=n("../spread-sheet/src/core/ui/toast/index.ts"),P=n("../spread-sheet/src/core/view/level-2/todo-ent/utils.ts"),L=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},R=function(e){var t=this;this._copy=function(){return L(t,void 0,void 0,regeneratorRuntime.mark((function e(){var t,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._spreadsheetApp.sheetStatus.canCopy||(null===(t=n.g.clientVars)||void 0===t?void 0:t.hotDocs)){e.next=3;break}return(0,T.showToast)(D.ZP.t("文档作者限制了查看者的操作权限，无法复制内容。"),{},{showCloseBtn:!0}),e.abrupt("return");case 3:if(!this.isFeatureNotLoad()){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this._spreadsheetApp.feature.getCopyPaste();case 7:return o=e.sent,e.next=10,this._spreadsheetApp.feature.getCopyPasteBase();case 10:i=e.sent,o.doCopy({copyType:i.CopyType.copy}),r.ZP.tdwReport({module:"cut_copy_paste",opername:"doc_excel_editor",action:"cut_copy_paste_copy_click",ver10:"quick_click"});case 13:case"end":return e.stop()}}),e,this)})))},this._cut=function(){return L(t,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._spreadsheetApp.sheetStatus.canCopy){e.next=2;break}return e.abrupt("return");case 2:if(!this.isFeatureNotLoad()){e.next=4;break}return e.abrupt("return");case 4:if(!(0,P.TQ)(this._spreadsheetApp)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this._spreadsheetApp.feature.getCopyPaste();case 8:return t=e.sent,e.next=11,this._spreadsheetApp.feature.getCopyPasteBase();case 11:n=e.sent,t.doCopy({copyType:n.CopyType.cut}),r.ZP.tdwReport({module:"cut_copy_paste",opername:"doc_excel_editor",action:"cut_copy_paste_cut_click",ver10:"quick_click"});case 14:case"end":return e.stop()}}),e,this)})))},this._paste=function(){return L(t,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,P.TQ)(this._spreadsheetApp)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._spreadsheetApp.feature.getCopyPasteBase();case 4:this._spreadsheetApp.requestApi.doPaste(this._spreadsheetApp);case 5:case"end":return e.stop()}}),e,this)})))},this.isFeatureNotLoad=function(){return!t._spreadsheetApp.feature&&(n.g.snackLoading.showWithAutoHide(1e3),!0)},this._spreadsheetApp=e.spreadsheetApp,this._board=e.board,new o.ZP({root:this._board,bindings:[{key:"c",shortKey:!0,handler:function(){var e;if(!(null===(e=t._spreadsheetApp.view.canvas.inputManager)||void 0===e?void 0:e.isInputtingState()))return t._copy(),!1}},{key:"c",ctrlKey:!0,handler:function(){var e;if(!(null===(e=t._spreadsheetApp.view.canvas.inputManager)||void 0===e?void 0:e.isInputtingState()))return t._copy(),!1}},{key:"x",shortKey:!0,handler:function(){var e;if(!(null===(e=t._spreadsheetApp.view.canvas.inputManager)||void 0===e?void 0:e.isInputtingState()))return t._cut(),!1}},{key:"x",ctrlKey:!0,handler:function(){var e;if(!(null===(e=t._spreadsheetApp.view.canvas.inputManager)||void 0===e?void 0:e.isInputtingState()))return t._cut(),!1}},{key:"v",shortKey:!0,handler:function(){var e;if(s().isIPad&&!(null===(e=t._spreadsheetApp.view.canvas.inputManager)||void 0===e?void 0:e.isInputtingState()))return t._paste(),!1}},{key:"v",ctrlKey:!0,handler:function(){var e;if(s().isIPad&&!(null===(e=t._spreadsheetApp.view.canvas.inputManager)||void 0===e?void 0:e.isInputtingState()))return t._paste(),!1}},{key:o.ZP.KEYS.ESCAPE,handler:function(){if(!t._spreadsheetApp.view.canvas.inputManager.isInputtingState()){var e=t._spreadsheetApp.view.canvas.copyFrame;e&&e.isCopy()&&e.closeCopy()}}}]})},M=n("../spread-sheet/src/core/ui/loading/index.ts"),j=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(t){i(t)}}function a(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},N=function(e){var t=this;this.cancelUpload=function(){return j(t,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o,r,i,s,a,l,c,d,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.spreadsheetApp,i=r.spreadsheet,s=r.view,a=s.canvas.normalSelectData.activeCol,l=s.canvas.normalSelectData.activeRow,c=i.getActiveSheetId(),(null===(d=M.ZP.getInstance(l,a,c))||void 0===d?void 0:d.isVisible)&&d.cancelUpload(),u=s.getSelection().rangeSelections,null===(n=null===(t=s.canvas)||void 0===t?void 0:t.weworkComponentCenter)||void 0===n||n.hidePanelWhenClearContent(u),i.activeSheet.todoManager.getTodoRange(l,a)&&(null===(o=s.canvas)||void 0===o||o.todoCenter.hideTodoDetailPanel());case 10:case"end":return e.stop()}}),e,this)})))},this.spreadsheetApp=e.spreadsheetApp,this.board=e.board,new o.ZP({root:this.board,bindings:[{key:o.ZP.KEYS.BACKSPACE,handler:function(){t.cancelUpload()}},{key:o.ZP.KEYS.DELETE,handler:function(){t.cancelUpload()}}]})},O=(n("../node_modules/core-js/modules/es.array.find-index.js"),n("../spread-sheet/src/base/index.ts")),B=function(e){var t=this;this._nextSheet=function(){for(var e=t.spreadsheetApp.spreadsheet,n=e.activeSheetId,o=e.sheetManager.sheetList,r=o.findIndex((function(e){return e.properties.sheetId===n}))+1;r<o.length;r++){var i=o[r].properties;if(!0!==i.hidden)return O.Z.event.sheetsBar.trigger("switchSheet",i.sheetId,n),!1}return!1},this._prevSheet=function(){for(var e=t.spreadsheetApp.spreadsheet,n=e.activeSheetId,o=e.sheetManager.sheetList,r=o.findIndex((function(e){return e.properties.sheetId===n}))-1;r>=0;r--){var i=o[r].properties;if(!0!==i.hidden)return O.Z.event.sheetsBar.trigger("switchSheet",i.sheetId,n),!1}return!1},this.toggleShortcutPanel=function(){O.Z.event.keyboard.trigger("toggleShortcutPanel")},this.spreadsheetApp=e.spreadsheetApp,this.board=document.getElementById("workbenchContainer")||e.board,new o.ZP({root:this.board,bindings:[{key:o.ZP.KEYS.RIGHT,altKey:!0,handler:this._nextSheet},{key:o.ZP.KEYS.LEFT,altKey:!0,handler:this._prevSheet},{key:"/",shortKey:!0,handler:this.toggleShortcutPanel}]})},Z=function(e){var t=e.config;t.base&&(this.baseKeyboard=new u(e)),t.edit&&(this.editKeyboard=new A(e)),t.copyPaste&&(this.copyPasteKeyboard=new R(e)),t.loadingImg&&(this.loadingImgKeyboard=new N(e)),t.sheet&&new B(e)}},"../spread-sheet/src/core/view/level-2/todo-ent/utils.ts":function(e,t,n){n.d(t,{AE:function(){return a},HE:function(){return p},Lj:function(){return d},TQ:function(){return c},cV:function(){return l},xZ:function(){return u}}),n("../node_modules/core-js/modules/es.array.find.js"),n("../node_modules/dayjs/dayjs.min.js"),n("../packages/model/src/cell/metadata/CustomDataType.ts"),n("../packages/model/src/cell/metadata/date-time/DateTimeTemplateType.ts");var o,r=n("../packages/model/src/range/index.ts"),i=n("../spread-sheet/src/core/behavior/request/range/config.ts"),s=n("../spread-sheet/src/core/view/level-2/wework-component-ent/utils.ts");function a(e){var t=e.view.getSelection().activeCell,n=t.rowIndex,o=t.colIndex,r=e.spreadsheet.activeSheet.getCellDataAtPosition(n,o);return(null===r||void 0===r?void 0:r.isWeworkComponent())||!1}function l(e,t,n){var o=e.spreadsheet.activeSheet.todoManager.crossTodoCell(n,t);return o&&(0,s.CF)("该操作涉及待办单元格，请取消待办后重试"),o}function c(e,t){void 0===t&&(t=!0);var n=!!(e.view.getSelection().rangeSelections||[]).find((function(t){return e.spreadsheet.activeSheet.todoManager.containTodoCell(t)}));return n&&t&&(0,s.CF)("该操作涉及待办单元格，请取消待办后重试"),n}function d(e,t){void 0===t&&(t=!0);var n=function(e){var t=e.view.getSelection().rangeSelections;if(1!==t.length)return null;var n=t[0],o=n.startRowIndex,r=n.startColIndex,i=n.endRowIndex,s=n.endColIndex,a=e.spreadsheet.activeSheet.todoManager.getTodoRange(o,r);return o===i&&r===s&&(null===a||void 0===a?void 0:a.rowIndex)===o&&(null===a||void 0===a?void 0:a.colIndex)===r?a:null}(e);if(null===n||void 0===n?void 0:n.todoId){var o=n.todoId,r=n.rowIndex,i=n.colIndex;return e.view.canvas.todoCenter.deleteTodo(o,r,i),{isTodoMasterCell:!0,isRelatedTodoBindCell:!1}}return{isTodoMasterCell:!1,isRelatedTodoBindCell:c(e,t)}}function u(e,t){var n=t.direction,o=t.range,a=o.sheetId,l=o.startRowIndex,c=o.startColIndex,d=o.endRowIndex,u=o.endColIndex,p=e.spreadsheet.activeSheet.getColCount(),h=e.spreadsheet.activeSheet.getRowCount(),m=n===i.ai.RIGHT||n===i._z.LEFT?new r.GridRange(a,l,d,c,p-1):new r.GridRange(a,l,h-1,c,u),f=e.spreadsheet.activeSheet.todoManager.containTodoCell(m);return f&&(0,s.CF)("该操作涉及待办单元格，请取消待办后重试"),f}function p(e,t){var n=t.toRange,o=t.fromRange,r=e.spreadsheet.activeSheet.todoManager;return!(!r.containTodoCell(n)&&!r.containTodoCell(o))&&((0,s.CF)("该操作涉及待办单元格，请取消待办后重试"),!0)}!function(e){e[e.ALLOW=0]="ALLOW",e[e.CANNOT_EDIT=1]="CANNOT_EDIT",e[e.NON_SINGLE_CELL=2]="NON_SINGLE_CELL",e[e.RIGHT_SIDE_NOT_ENOUGH_CELL=3]="RIGHT_SIDE_NOT_ENOUGH_CELL",e[e.RIGHT_SIDE_CONTAIN_TODO=4]="RIGHT_SIDE_CONTAIN_TODO",e[e.RIGHT_SIDE_CONTAIN_STAFF_CARD=5]="RIGHT_SIDE_CONTAIN_STAFF_CARD",e[e.RIGHT_SIDE_CONTAIN_GROUP_CARD=6]="RIGHT_SIDE_CONTAIN_GROUP_CARD",e[e.RIGHT_SIDE_CONTAIN_SCHEDULE=7]="RIGHT_SIDE_CONTAIN_SCHEDULE",e[e.RIGHT_SIDE_CONTAIN_COLUMN_VALIDATION=8]="RIGHT_SIDE_CONTAIN_COLUMN_VALIDATION",e[e.INSERT_IN_FILTER_AREA=9]="INSERT_IN_FILTER_AREA"}(o||(o={}))},"../spread-sheet/src/core/view/level-2/wework-component-ent/utils.ts":function(e,t,n){n.d(t,{CF:function(){return r}}),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../packages/model/src/cell/ref-data/group-card.ts"),n("../packages/model/src/cell/ref-data/staff-card.ts"),n("../packages/model/src/cell/ref-data/schedule.ts"),n("../packages/model/src/cell/ref-data/third-party-app.ts"),n("../packages/model/src/cell/ref-data/mini-app.ts");var o=n("../spread-sheet/src/core/ui/toast/toast.tsx");function r(e){(0,o.showToast)(e,{},{showCloseBtn:!0,toolToastCloseTime:3e3})}},"../spread-sheet/src/external/view/main/panel/rangeSelectionPanel/util.ts":function(e,t,n){n.d(t,{AM:function(){return s},iK:function(){return l},lo:function(){return a},uQ:function(){return c}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.array.map.js");var o=n("../node_modules/i18next/dist/esm/i18next.js"),r=n("../packages/model/src/range/hexRangeUtils.ts"),i=(n("../packages/model/src/sheet/sheetUtils.ts"),n("../spread-sheet/src/core/utils/range.ts")),s=o.ZP.t("请输入正确的单元格范围，比如A1:C8"),a=o.ZP.t("请输入正确的单元格范围，比如'工作表1'!A1:C8"),l=function(e,t,n){return void 0===n&&(n=!1),""!==e&&e.split(",").every((function(e){return n&&(0,r.isValidHexRangeOnSpreadsheet)(e,t)||(0,r.isValidHexRangeOnSheet)(e,t.activeSheet)}))},c=function(e,t,n){var o=n.appendEqual,r=n.absolute,s=n.multiSheet,a=t.canvas.normalSelectData.selectQueue,l=e.activeSheet.getSheetId();return a.map((function(t){var n=(o?"=":"")+(r?(0,i.select2AbsoluteHex)(e.activeSheet,t):(0,i.select2RelativeHex)(e.activeSheet,t)),a=e.sheetManager.getSheetTitleBySheetId(l);return s?"'"+a+"'!"+n:n}))}},"../spread-sheet/src/external/view/mobile/header/container/config.ts":function(e,t,n){n.d(t,{$M:function(){return m},IX:function(){return c},KN:function(){return i},Mg:function(){return a},cT:function(){return u},iV:function(){return d},j:function(){return v},kd:function(){return f},mC:function(){return l},tn:function(){return p},vI:function(){return s},vP:function(){return r},zc:function(){return h}});var o=n("../spread-sheet/src/base/util/appConfig.ts"),r=(n("../spread-sheet/src/base/util/domain-config.ts"),n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),"preview_edit"),i="m-guide-rename",s="m-guide-apply",a="m-guide-home",l=5e3,c="m_readonly",d="edited_url",u="2.2.0",p="2.4.0",h=!!o.Z.getConfig("titlebar.logo"),m=!!o.Z.getConfig("titlebar.logo.badge"),f=o.Z.getConfig("titlebar.logo.logoUrl")||"",v=!!o.Z.getConfig("titlebar.logo.clickable")},"../spread-sheet/src/external/view/mobile/header/container/helper.ts":function(e,t,n){n.d(t,{As:function(){return g},Ed:function(){return w},Gl:function(){return I},JF:function(){return T},QU:function(){return A},T2:function(){return b},Ud:function(){return S},Y7:function(){return x},ZR:function(){return k},aV:function(){return D},hZ:function(){return v},sX:function(){return C},ym:function(){return E},zn:function(){return P}});var o=n("../node_modules/i18next/dist/esm/i18next.js"),r=n("../spread-sheet/src/external/view/mobile/header/container/config.ts"),i=n("../node_modules/@tencent/doc-contribute/dist/contributes.js"),s=n.n(i),a=n("../packages/common-utils/src/index.ts"),l=n("../packages/report/src/index.ts"),c=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),d=n.n(c),u=n("../node_modules/@tencent/tencent_doc_open_url/dist/index.js"),p=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),h=n("../spread-sheet/src/external/view/mobile/header/utils.ts"),m=n("../node_modules/@tencent/dui-mobile/lib/components/Snackbar/index.js"),f=n("../node_modules/@tencent/dui-mobile/lib/components/Modal/index.js"),v=(n("../spread-sheet/src/base/util/domain-config.ts"),n("../spread-sheet/src/base/util/appConfig.ts"),(0,a.ol)(window.location.href));function g(){var e,t,n,o,i,a,c=s().getContribute("mobile.header").home.urls;String(v[r.vP]||"")&&l.ZP.tdwReport({opername:"doc_non_edit",module:"online",action:"entry_page"}),l.ZP.tdwReport({opername:"non_edit",module:"document",action:"mobile_click"});var p=c.mqq.url;switch(!0){case d().isMiniProgram:null===(n=null===(t=null===(e=null===window||void 0===window?void 0:window.wx)||void 0===e?void 0:e.miniProgram)||void 0===t?void 0:t.navigateTo)||void 0===n||n.call(t,{url:c.isMiniProgram.url});break;case w:null===(i=null===(o=null===window||void 0===window?void 0:window.mqq)||void 0===o?void 0:o.invoke)||void 0===i||i.call(o,"docx","back",{from:"excel"},(function(){}));break;default:d().isTencentDocsApp&&(p=(null===(a=window.mqq)||void 0===a?void 0:a.iOS)?c.mqq.isTencentDocsApp.iOS.url:c.mqq.isTencentDocsApp.other.url),(0,u.tencentDocOpenUrlForAll)({url:p,style:3})}}var _=d().isTencentDocsApp&&d().isIPad&&d().isTencentDocsAppVersionAboveOrEqual("1.4.3"),y=d().isTencentDocsApp&&d().isAndroidPad&&d().isTencentDocsAppVersionAboveOrEqual(r.cT),w=_||y,C=d().isTencentDocsApp&&d().isTencentDocsAppVersionAboveOrEqual(r.cT),E=d().isTencentDocsApp&&d().isTencentDocsAppVersionAboveOrEqual(r.tn),I=(d().isIPad||d().isAndroidPad)&&C,b=(d().isIPad||d().isAndroidPad)&&E,x=C&&d().isAndroidPad,S=!1;function k(){return p.q.getConfig("isLogin")}function A(){return"1"===String(v[r.IX])&&(d().isMobilePhone||d().isAndroidPad)}function D(){(0,h.ip)(r.vI)}function T(){var e=(0,a.ol)(window.location.href);return"1"===String(e.preview)}function P(){m.default.show({message:o.ZP.t("网络异常，文档将在联网后同步"),action:[{text:o.ZP.t("详情"),onClick:function(){f.default.confirm({title:null,content:o.ZP.t("离线状态下可以编辑最近打开过的文档或创建新文档，内容将在联网后同步到云端，也可以将文档手动缓存到本地使用。"),cancelText:null})}}]})}},"../spread-sheet/src/external/view/mobile/header/utils.ts":function(e,t,n){n.d(t,{SL:function(){return l},bs:function(){return a},eS:function(){return d},ip:function(){return c}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.array.slice.js");var o=n("../node_modules/i18next/dist/esm/i18next.js"),r=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),i=/[\\\/:*?"<>|]/g;function s(e){return e+"-"+r.q.getConfig("uid")}function a(e){return""+n.g.localStorage.getItem(s(e))==="1"}function l(e){n.g.localStorage.setItem(s(e),"1")}function c(e){n.g.localStorage.removeItem(s(e))}function d(e){var t=function(e){return i.test(e)?{legalityTips:o.ZP.t("文档名不能包含下列任何字符：")+'\\ / : * ? " < > |',legalityTitle:e.replace(i,"")}:{legalityTips:"",legalityTitle:e}}(e),n=t.legalityTips,r=t.legalityTitle;if(n)return{newTips:n,newTitle:r};var s=function(e){if(!e||!e.length)return{lengthTips:"",lengthTitle:e};var t,n,r=0,i=0;for(i=0,n=e.length;i<n;i++)if((r+=(t=e.charCodeAt(i))<=127?1:t<=2047?2:t<=65535?3:4)>128)return{lengthTips:o.ZP.t("文档名不能超过128个字符。"),lengthTitle:e.slice(0,i)};return{lengthTips:"",lengthTitle:e}}(e);return{newTips:s.lengthTips,newTitle:s.lengthTitle}}},"../spread-sheet/src/external/view/native/native-toolbar/utils.ts":function(e,t,n){n.d(t,{KK:function(){return s},M4:function(){return a},Rx:function(){return u},fG:function(){return c},w2:function(){return l}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.object.entries.js");var o=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),r=n.n(o),i=null,s=function(){return null===i&&(i=location.href.indexOf("nativetoolbar")>-1||!!(r().isTencentDocsApp&&window.mqq&&(r().isAndroid&&r().isTencentDocsAppVersionAboveOrEqual("2.1.8")||(r().isIOS||r().isIPad)&&r().isTencentDocsAppVersionAboveOrEqual("2.1.8")))),i};function a(){if(!s())return!1;var e=navigator.userAgent.match(/TencentDocs\/(\S*)/),t="0";return e&&e.length>1&&(t=-1!==e[1].indexOf(".tencentdocs")?e[1].split(".tencentdocs")[0]:e[1]),t>="99.99.99"}function l(){var e=window.location.href.match("/sheet/([a-zA-Z0-9]*).*"),t="sheet";return e&&(t=e[1]),t}function c(){return!!(r().isTencentDocsApp&&window.mqq&&(r().isAndroid&&r().isTencentDocsAppVersionAboveOrEqual("2.2.4")||(r().isIOS||r().isIPad)&&r().isTencentDocsAppVersionAboveOrEqual("2.2.4")))}var d=new Map(Object.entries({"quick-fill":"quick-fill-row","font-style":"font-tab","cell-property":"cell-tab",formula:"formula-tab",strikethrough:"strike-through","vertical-align-top":"verticalalign-top","vertical-align-middle":"verticalalign-middle","vertical-align-bottom":"verticalalign-bottom","horizontal-align-left":"align-left","horizontal-align-center":"align-center","horizontal-align-right":"align-right",decimal:"number-digit"}));function u(e){return d.get(e)||e}}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/bundle_view_level2_readyonly_lazy_module0.b0081985e2464ad739cc.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=bundle_view_level2_readyonly_lazy_module0.b0081985e2464ad739cc.js.map