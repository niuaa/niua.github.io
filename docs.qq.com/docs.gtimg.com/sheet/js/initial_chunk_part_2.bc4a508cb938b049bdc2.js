self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["initial_chunk_part_2"],{"../packages/common-utils/src/client/file.ts":function(e,t,n){"use strict";function i(e,t){var n,i=0;return navigator.userAgent.indexOf("MSIE")>0&&(n=!0),i=n?new(0,window.ActiveXObject)("Scripting.FileSystemObject").GetFile(e).Size:e.size,t?i<t:i}n.d(t,{i:function(){return i}})},"../packages/common-utils/src/client/safe.ts":function(e,t,n){"use strict";function i(e){if("string"!==typeof e)return"";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};return e.replace(/[&<>'"]/g,(function(e){return t[e]}))}n.d(t,{r:function(){return i}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js")},"../packages/common-utils/src/client/url.ts":function(e,t,n){"use strict";function i(e,t){var i,s;!t&&(null===(i=null===n.g||void 0===n.g?void 0:n.g.clientVars)||void 0===i?void 0:i.originalUrl)&&(t=n.g.clientVars.originalUrl);var o=null,r=(t?"?"+(t.split("?")[1]||""):null===(s=n.g.location)||void 0===s?void 0:s.search)||"";return r&&(o=r.match(new RegExp("(\\?|&)"+e+"=([^&]*)(&|$)"))),o?decodeURIComponent(o[2].replace(/%/g,"%25")):""}function s(e,t){var n=i(e,null!==t&&void 0!==t?t:location.href);if(""!==n){var s=Number(n);if(!isNaN(s))return s}}function o(e){void 0===e&&(e="");for(var t={},n=(e.split("?")[1]||"").split("&"),i=0,s=n.length;i<s;i++)if(n[i]){var o=n[i].split("=");if(o.length>1){var r=o[0],a=o[1];t[r]=decodeURIComponent(a)}}return t}function r(e,t){var n=e.split("?"),i=n[0],s=n[1],o=Array.isArray(t)?t:[t];if(n.length>=2){for(var r=s.split(/[&;]/g),a=0,d=o.length;a<d;a++)for(var u=encodeURIComponent(o[a])+"=",l=r.length-1;l>=0;l--)-1!==r[l].lastIndexOf(u,0)&&r.splice(l,1);return i+(r.length>0?"?"+r.join("&"):"")}return e}function a(e,t){var n=e;return Object.keys(t).forEach((function(e){var i=new RegExp("([?&#])"+e+"=?.*?(&|#|$)","i"),s=t[e],o=-1!==n.indexOf("?")?"&":"?";n=n.match(i)?n.replace(i,"$1"+e+"="+encodeURIComponent(s)+"$2"):n+o+e+"="+encodeURIComponent(s)})),n}n.d(t,{DC:function(){return s},IZ:function(){return i},XK:function(){return a},oW:function(){return r},ol:function(){return o}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.string.search.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.keys.js")},"../packages/common-utils/src/common/image.ts":function(e,t,n){"use strict";function i(e){try{return(e||"").replace(/^(http:)|(https:)/g,"")}catch(t){console.error(t)}return e}n.d(t,{k:function(){return i}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js")},"../packages/common-utils/src/common/index.ts":function(e,t,n){"use strict";function i(e,t,n){var i,s,o;void 0===n&&(n={});var r=null,a=0,d=function(){a=!1===(null===n||void 0===n?void 0:n.leading)?0:Number(new Date),r=null,o=e.apply(i,s)};return function(){var u=Number(new Date);a||!1!==(null===n||void 0===n?void 0:n.leading)||(a=u);var l=t-(u-a);i=this;for(var h=arguments.length,c=new Array(h),I=0;I<h;I++)c[I]=arguments[I];return s=c,l<=0?(clearTimeout(r),r=null,a=u,o=e.apply(i,s)):r||!1===(null===n||void 0===n?void 0:n.trailing)||(r=window.setTimeout(d,l)),o}}function s(e,t){var n=null;return function(){var i=this,s=arguments;n&&(clearTimeout(n),n=null),n=window.setTimeout((function(){e.apply(i,s)}),t)}}n.d(t,{Ds:function(){return s},nE:function(){return o.n},hj:function(){return r},Kn:function(){return d},HD:function(){return a},o8:function(){return u},P2:function(){return i}}),n("../node_modules/core-js/modules/es.number.constructor.js");var o=n("../packages/common-utils/src/common/string.ts");function r(e){return"[object Number]"===Object.prototype.toString.call(e)&&!isNaN(e)}function a(e){return"[object String]"===Object.prototype.toString.call(e)}function d(e){return"[object Object]"===Object.prototype.toString.call(e)}function u(e){return"[object Undefined]"===Object.prototype.toString.call(e)}n("../node_modules/core-js/modules/es.object.to-string.js"),n("../packages/common-utils/src/common/image.ts")},"../packages/common-utils/src/common/string.ts":function(e,t,n){"use strict";function i(e,t,n){void 0===n&&(n="..");for(var i=e.length,s="",o=0,r=0;r<i;){var a=e.charCodeAt(r),d=e[r];if(s+=a>=55296&&a<=56319?d+e[r+=1]:d,r+=1,(o+=1)>=t)break}return r<i&&(s+=n),s}n.d(t,{n:function(){return i}})},"../packages/common-utils/src/index.ts":function(e,t,n){"use strict";function i(e){var t=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),i="";return n.g.document&&(i=n.g.document.cookie.match(t)),i?decodeURIComponent(i[1]):""}function s(e,t,i,s,o){var r=new Date;r.setTime(r.getTime()+(i?36e5*i:2592e6)),n.g.document&&(document.cookie=e+"="+t+";expires="+r.toGMTString()+";path="+(o||"/")+";"+(s?"domain="+s+";":""))}function o(e,t,i){var s=new Date(0);n.g.document&&(document.cookie=e+"=;expires="+s.toUTCString()+";path="+(i||"/")+";"+(t?"domain="+t+";":""))}if(n.d(t,{ii:function(){return r.i},Ds:function(){return c.Ds},A0:function(){return o},nE:function(){return c.nE},r:function(){return d.r},R5:function(){return l},ej:function(){return i},DC:function(){return h.DC},IZ:function(){return h.IZ},ol:function(){return h.ol},hj:function(){return c.hj},Kn:function(){return c.Kn},gr:function(){return u},HD:function(){return c.HD},o8:function(){return c.o8},ve:function(){return a},oW:function(){return h.oW},d8:function(){return s},P2:function(){return c.P2},XK:function(){return h.XK}}),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.match.js"),"page-editor"==n.j)var r=n("../packages/common-utils/src/client/file.ts");n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js");var a=function(e,t){return new Promise((function(n,i){var s=document.createElement("script");s.src=e,s.onload=function(){null===t||void 0===t||t(),n()},s.onerror=function(e){i(e)},document.head.appendChild(s)}))},d=n("../packages/common-utils/src/client/safe.ts");function u(){var e;if("number"===typeof n.g.orientation)return n.g.orientation/90%2===0;if("undefined"===typeof n.g.screen.orientation)return!0;try{var t=n.g.screen.orientation.angle;if("number"===typeof t)return t/90%2===0}catch(i){null===(e=n.g.log)||void 0===e||e.error(i)}return!0}function l(){var e,t;null===(t=null===(e=n.g.mqq)||void 0===e?void 0:e.ui)||void 0===t||t.setWebViewBehavior({orientation:0})}n("../node_modules/@tencent/docs-user-agent/dist/index.js"),n("../packages/common-utils/src/time/timer.ts");var h=n("../packages/common-utils/src/client/url.ts"),c=n("../packages/common-utils/src/common/index.ts");n("../packages/common-utils/src/time/date.ts")},"../packages/common-utils/src/time/date.ts":function(e,t,n){"use strict";function i(e,t){void 0===t&&(t="yyyy/MM/dd hh:mm:ss");var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()},i=t;return/(y+)/.test(i)&&(i=i.replace(RegExp.$1,String(e.getFullYear()).substr(4-RegExp.$1.length))),Object.keys(n).forEach((function(e){new RegExp("("+e+")").test(i)&&(i=i.replace(RegExp.$1,1===RegExp.$1.length?n[e]:("00"+n[e]).substr(String(n[e]).length)))})),i}n.d(t,{W:function(){return i}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.keys.js")},"../packages/common-utils/src/time/timer.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),s=(n("../node_modules/core-js/modules/es.number.is-integer.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.array.splice.js"),function(){function e(e,t){this.timer=e,this.done=!1,this.callback=function(){},this.frames=t/e.interval|0}var t=e.prototype;return t.setFrame=function(e){this.frames=e,0!==this.frames&&(this.frames=Number.isInteger(this.frames)?this.frames:1+(0|this.frames))},t.run=function(e){return this.callback=e,this.setFrame(this.frames+this.timer.currFrame),this.timer.push(this),this},t.stop=function(){this.timer.erase(this)},e}()),o=function(){function e(){this.zeroFrameDone=!1,this.times=0,this.started=!1,this.interval=500,this.t=null,this.cache={},this.currFrame=0,this.maxFrame=0}var t=e.prototype;return t.pause=function(){clearInterval(this.t)},t.restart=function(){this.started=!1,this.start()},t.clear=function(){this.cache={},this.started=!1,this.currFrame=0,this.maxFrame=0,clearInterval(this.t),this.t=null},t.execNextFrame=function(){if(this.currFrame>this.maxFrame)return this.clear();var e=this.cache[this.currFrame];if(e){e.forEach((function(e){var t;if(e){e.done=!0;try{null===e||void 0===e||e.callback()}catch(i){console.error(i),null===(t=n.g.log)||void 0===t||t.error(i.stack)}}e=null}));var t,s=e.filter((function(e){return!e.done}));s.length&&(this.cache[this.currFrame+1]||(this.cache[this.currFrame+1]=[]),(t=this.cache[this.currFrame+1]).push.apply(t,(0,i.Z)(s)),this.maxFrame+=1),delete this.cache[this.currFrame]}},t.push=function(e){this.cache[e.frames]||(this.cache[e.frames]=[]),this.cache[e.frames].push(e),this.maxFrame=Math.max(this.maxFrame,e.frames),this.start()},t.erase=function(e){if(e){var t=e.frames;if(void 0!==this.cache[t]){var n=this.cache[t].indexOf(e);n>-1&&this.cache[t].splice(n,1)}}},t.wait=function(e){return new s(this,e)},t.start=function(){var e=this;if(!this.started){if(this.started=!0,this.cache[0]&&!this.zeroFrameDone)return this.zeroFrameDone=!0,setTimeout((function(){try{e.execNextFrame()}catch(t){console.error(t)}}),0),this.started=!1;this.t=setInterval((function(){try{e.execNextFrame()}catch(t){console.error(t)}e.currFrame+=1}),this.interval)}},e}();t.Z=new o},"../packages/editor/src/AlloyBaseTextEditor.ts":function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../packages/lib/EventEmitter.ts")),o=n("../packages/lib/Keyboard.ts"),r=n("../packages/editor/src/helper/Env.ts"),a=function(){function e(e){this._inputDom=e.inputDom,this._emitter=e.emitter,this._editorInterface=e.editorInterface,this.handleCopy(),this.handlePaste()}var t=e.prototype;return t.handleCopy=function(){var e=this;r.Z.ie&&!r.Z.edge&&this._inputDom.addEventListener("copy",(function(t){var n,i;null===(i=null===(n=window.clipboardData)||void 0===n?void 0:n.setData)||void 0===i||i.call(n,"Text",e._editorInterface.getSelectedText()),t.preventDefault()}))},t.handlePaste=function(){var e=this;this._inputDom.addEventListener("paste",(function(t){var n;if(e._editorInterface.active){t.preventDefault(),t.stopImmediatePropagation();var i="",s=!1;if((null===t||void 0===t?void 0:t.clipboardData)||(null===(n=null===t||void 0===t?void 0:t.originalEvent)||void 0===n?void 0:n.clipboardData)){i=(t.originalEvent||t).clipboardData.getData("text/plain");var o=t.clipboardData.files;s=1===o.length&&o.item(0).type.indexOf("image")>=0}else window.clipboardData&&(i=window.clipboardData.getData("Text"));if(i){var r=document.createTextNode(i),a=document.getSelection();if(null===a||void 0===a?void 0:a.rangeCount){var d=a.getRangeAt(0);d.deleteContents(),d.insertNode(r),(d=d.cloneRange()).setStartAfter(r),d.setEndAfter(r),a.removeAllRanges(),a.addRange(d)}e._emitter.emit(p.EVENT.VALUE_CHANGE,{source:p.SOURCE.USER}),e._emitter.emit(p.EVENT.ON_PASTE,i,t)}else s&&e._emitter.emit(p.EVENT.ON_PASTE_OUTER,t)}}))},e}(),d=(n("../node_modules/core-js/modules/es.array.splice.js"),n("../packages/editor/src/helper/utils.ts")),u=function(){function e(e,t,n){void 0===e&&(e=-1),this.index=e,this.content=t,this.selection=n}var t=e.prototype;return t.equalsContent=function(e){return!!e&&(0,d.E7)(this.content,!1)===(0,d.E7)(e.content,!1)},t.equalsSelection=function(e){return!!(this.selection&&e&&e.selection&&this.selection.start===e.selection.start&&this.selection.end===e.selection.end)},t.equals=function(e){return this.equalsContent(e)&&this.equalsSelection(e)},e}(),l=n("../packages/editor/src/interface.ts"),h=function(){function e(e){this.hasUndo=!1,this.hasRedo=!1,this.snapShots=[],this.index=-1,this.currState=null,this.locked=!1,this.composing=!1,this.typing=!1,this.previousKeyGroup=-1,this.lastRecorded=0,this.inputDom=e.inputDom,this.emitter=e.emitter,this.editorInterface=e.editorInterface,this.clear(),this.setupNativeEditingHandler()}var t=e.prototype;return t.clear=function(){this.hasUndo=!1,this.hasRedo=!1,this.snapShots=[],this.index=-1,this.currState=null,this.locked=!1,this.resetTypingStatus(),this.refreshState()},t.lock=function(){this.locked=!0},t.unlock=function(){this.locked=!1},t.canUndo=function(){return this.hasUndo},t.canRedo=function(){return this.hasRedo},t.isComposing=function(){return this.composing},t.undo=function(){if(this.hasUndo){this.save(!0);var e=this.getNextHistoryState(!0);e&&(this.restoreHistoryState(e),this.emitter.emit(p.EVENT.VALUE_CHANGE,{source:p.SOURCE.USER}))}},t.redo=function(){if(this.hasRedo){this.save(!0);var e=this.getNextHistoryState(!1);e&&(this.restoreHistoryState(e),this.emitter.emit(p.EVENT.VALUE_CHANGE,{source:p.SOURCE.USER}))}},t.save=function(t){if(void 0===t&&(t=!0),!this.locked){var n=this.getCurrentHistoryState();if(this.currState&&n.equalsContent(this.currState)){if(t)return!1;if(n.equalsSelection(this.currState))return!1}return this.snapShots.splice(this.index+1,this.snapShots.length-this.index-1),this.snapShots.length==e.DEFAULTS.maxStack&&this.snapShots.shift(),this.index=this.snapShots.push(n)-1,n.index=this.index,this.currState=n,!0}},t.refreshState=function(){this.hasUndo=!!this.getNextHistoryState(!0),this.hasRedo=!!this.getNextHistoryState(!1),this.resetTypingStatus(),this.onChange()},t.setupNativeEditingHandler=function(){var e=this,t=this.inputDom;t.addEventListener("keydown",this.handleKeydown.bind(this)),t.addEventListener(r.Z.ie&&!r.Z.edge?"keypress":"input",this.handleInput.bind(this)),t.addEventListener("keyup",this.handleKeyup.bind(this)),t.addEventListener("compositionstart",(function(){e.composing=!0,e.typing||e.onTypingStart()})),t.addEventListener("compositionend",(function(){e.composing=!1,e.editorInterface.removeFillingCharNode(),e.emitter.emit(p.EVENT.VALUE_CHANGE,{source:p.SOURCE.USER})})),t.addEventListener(r.Z.mobile?"touchend":"click",this.onClick.bind(this)),t.addEventListener("paste",this.handlePasteAndDrop.bind(this)),t.addEventListener("drop",this.handlePasteAndDrop.bind(this)),r.Z.mobile&&window.document.addEventListener("selectionchange",(function(){window.document.activeElement===t&&(e.updateSelection(),e.emitter.emit(p.EVENT.SELECTION_CHANGE))}))},t.onClick=function(){var e=this;setTimeout((function(){e.typing?(e.save(!0)||e.updateSelection(),e.resetTypingStatus()):e.updateSelection(),e.emitter.emit(p.EVENT.SELECTION_CHANGE)}),0)},t.handlePasteAndDrop=function(){var e=this;setTimeout((function(){e.save(!0),e.refreshState()}),0)},t.handleKeydown=function(e){var t=e.keyCode,n=this.getKeyGroup(t);this.emitter.emit(p.EVENT.ON_KEY_DOWN,e),e[d.So]&&("z"===e.key||90===e.keyCode)||e[d.So]&&("y"===e.key||89===e.keyCode)||e[d.So]&&e.shiftKey&&("z"===e.key||90===e.keyCode)?e.preventDefault():this.handleKeyGroup(n,e)},t.handleKeyGroup=function(e,t){if(!this.composing&&(t[d.So]||t.altKey||t.ctrlKey||t.shiftKey))this.save(!0),this.previousKeyGroup=e;else if(e===l._J.PRINTABLE_KEYS)this.handlePrintableKeys(e);else if(e===l._J.NAVIGATION_KEYS)this.handleNavigationKeys(e);else{if(this.editorInterface.removeFillingCharNode(),this.composing)return;this.typing?this.typing&&this.previousKeyGroup===l._J.PRINTABLE_KEYS&&(this.save(!0),this.resetTypingStatus()):this.onTypingStart()}},t.handleNavigationKeys=function(e){this.editorInterface.removeFillingCharNode(),this.typing&&(this.save(!0),this.resetTypingStatus()),this.previousKeyGroup=e},t.handlePrintableKeys=function(e){this.previousKeyGroup===l._J.DELETE_KEYS&&(this.save(!0),this.resetTypingStatus()),this.typing||this.onTypingStart(),this.previousKeyGroup=e},t.updateSelection=function(e){if(!this.snapShots.length||this.composing)return!1;e||(e=this.getCurrentHistoryState());var t=this.snapShots[this.index];return!(!(null===t||void 0===t?void 0:t.equalsContent(e))||t.equalsSelection(e))&&this.save(!1)},t.onTypingStart=function(){this.typing=!0,this.hasUndo=!0,this.hasRedo=!1,this.onChange()},t.handleInput=function(){var e=this;this.composing||this.editorInterface.removeFillingCharNode(),r.Z.ie?setTimeout((function(){e.emitter.emit(p.EVENT.VALUE_CHANGE,{source:p.SOURCE.USER})}),0):this.emitter.emit(p.EVENT.VALUE_CHANGE,{source:p.SOURCE.USER})},t.handleKeyup=function(t){var n=t.keyCode,i=this.getKeyGroup(n),s=Date.now();if(i===l._J.DELETE_KEYS){if(this.composing)return;s-this.lastRecorded>=e.DEFAULTS.delay&&this.save(!0),this.previousKeyGroup=i,this.emitter.emit(p.EVENT.SELECTION_CHANGE)}i===l._J.NAVIGATION_KEYS&&(this.updateSelection(),this.emitter.emit(p.EVENT.SELECTION_CHANGE)),this.lastRecorded=s},t.getKeyGroup=function(e){if("number"!==typeof e)throw new Error("keyCode should be number!");return d.nP[e]?l._J.DELETE_KEYS:d.VS[e]?l._J.NAVIGATION_KEYS:l._J.PRINTABLE_KEYS},t.onChange=function(){this.emitter.emit(p.EVENT.UNDO_REDO_CHANGE,{canUndo:this.hasUndo,canRedo:this.hasRedo})},t.getNextHistoryState=function(e){if(this.snapShots.length<=0)return null;var t,n;if(this.currState)if(e){for(t=this.index-1;t>=0;t--)if(!(n=this.snapShots[t]).equalsContent(this.currState))return n.index=t,n}else for(t=this.index+1;t<this.snapShots.length;t++)if(!(n=this.snapShots[t]).equalsContent(this.currState))return n.index=t,n;return null},t.restoreHistoryState=function(e){e&&(this.index=e.index,this.currState=this.snapShots[this.index],this.editorInterface.setContent(e.content),this.editorInterface.setSelection(e.selection),this.refreshState())},t.resetTypingStatus=function(){this.composing=!1,this.typing=!1,this.previousKeyGroup=-1,this.lastRecorded=0},t.getCurrentHistoryState=function(){var e=this.editorInterface.getContent(),t=this.editorInterface.getSelection();return new u(-1,e,t)},e}();h.DEFAULTS={delay:1200,maxStack:100};var c=h,I=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.string.trim.js"),n("../packages/editor/src/blocks/mention-block/MentionBlock.ts")),f=function(){function e(e){this._rootDom=e.rootDom,this._inputDom=e.inputDom,this._platform=e.platform,this._editorInterface=e.editorInterface}var t=e.prototype;return t.getInputDom=function(e){void 0===e&&(e=!1);var t=this._inputDom.cloneNode(!0),n=t.querySelectorAll("br.extra");return Array.from(n).forEach((function(e){var t;null===(t=null===e||void 0===e?void 0:e.parentNode)||void 0===t||t.removeChild(e)})),e||this._recursiveRemoveHelpingChar(t),t},t.getSelectedText=function(){var e=this._editorInterface.getSelection(),t=this.getData(!0),n="";return e&&!e.isCollapsed()&&(n=null===t||void 0===t?void 0:t.substring(e.start,e.end),n=(n=(0,d.E7)(n)).replace(I.o,"")),n},t.setData=function(e){this._inputDom.innerText=e||"";var t=document.createElement("br");t.className="extra",this._inputDom.appendChild(t)},t.deleteText=function(){return document.execCommand("delete")},t.insertText=function(e){document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,e):document.execCommand("paste",!1,e)},t.getData=function(e){void 0===e&&(e=!1);var t=this.getInputDom(e);return this._polyfillGetData(t)},t.getHTMLContent=function(){return this._inputDom.innerHTML},t.setHTMLContent=function(e){this._inputDom.innerHTML=e},t.getTextContent=function(){return this._inputDom.innerText},t.setTextContent=function(e){this._inputDom.innerText=e},t.doLineBreak=function(){var e,t;if(window.getSelection&&(null===(e=window.getSelection())||void 0===e?void 0:e.getRangeAt)&&(null===e||void 0===e?void 0:e.rangeCount)){(t=e.getRangeAt(0)).deleteContents();var n=document.createElement("div");n.innerHTML="<br>";for(var i,s,o=document.createDocumentFragment();i=n.firstChild;)s=o.appendChild(i);t.insertNode(o),s&&((t=t.cloneRange()).setStartAfter(s),t.collapse(!0),e.removeAllRanges(),e.addRange(t),this._platform!==l.t4.PC||r.Z.ie?this._platform!==l.t4.PC&&this.scrollToBottom():s.scrollIntoViewIfNeeded?s.scrollIntoViewIfNeeded():s.scrollIntoView&&(s.scrollIntoView(),document.body.scrollTop=0))}},t.scrollToBottom=function(){this._rootDom.scrollTop=this._rootDom.scrollHeight},t._recursiveRemoveHelpingChar=function(e){if(e.nodeType===Node.TEXT_NODE)e.textContent=(0,d.E7)(e.textContent||""),e.textContent=e.textContent.replace(I.o,"");else for(var t,n=0;n<e.childNodes.length;n++)t=e.childNodes[n],this._recursiveRemoveHelpingChar(t)},t._polyfillGetData=function(e){return this._recursiveParseNodeInnerTextString(e)},t._recursiveParseNodeInnerTextString=function(e){if(e.nodeType===Node.TEXT_NODE)return e.textContent||"";if(e.nodeName&&"BR"===e.nodeName.toUpperCase())return String.fromCharCode(10);if(e&&e.className===l.QP)return(e.textContent||"").trim();for(var t="",n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];t+=this._recursiveParseNodeInnerTextString(i)}return t},e}(),m=n("../packages/editor/src/core/Selection.ts"),g=function(){function e(e){var t=this;this.updateSelectionCache=function(){var e,n=t.getSelection();n&&((null===(e=t.currSelection)||void 0===e?void 0:e.equals(n))||(t.currSelection=n))},this.rootDom=e.parent,this.platform=e.platform||l.t4.PC,this.editable=!1!==e.editable,this.canCopy=!1!==e.cancopy,this.emitter=new s.Z}var t=e.prototype;return t.setEditable=function(e){void 0===e&&(e=!0),e!==this.editable&&(this.editable=e,this.input.setAttribute("contenteditable",this.editable.toString()))},t.setCanCopy=function(e){this.canCopy=e},t.on=function(e,t,n){this.emitter.on(e,t,n)},t.off=function(e,t,n){this.emitter.off(e,t,n)},t.setActive=function(e){this.active=e},t.setContent=function(t,n){void 0===t&&(t=""),void 0===n&&(n=e.SOURCE.API),this.textService.setHTMLContent(t),n!==e.SOURCE.SILENT&&(this.emitter.emit(e.EVENT.VALUE_CHANGE,{source:n}),this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:n}))},t.getContent=function(){return this.textService.getHTMLContent()},t.getText=function(e){return void 0===e&&(e=!1),this.textService.getData(e)},t.setText=function(t,n,i){void 0===n&&(n=e.SOURCE.API),void 0===i&&(i=!1),this.textService.setData(t||""),i&&this.collapseToEnd(),n!==e.SOURCE.SILENT&&(this.emitter.emit(e.EVENT.VALUE_CHANGE,{source:n}),this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:n}))},t.deleteText=function(t){void 0===t&&(t=e.SOURCE.API),this.textService.deleteText(),this.emitTextChangeEvent(t)},t.insertText=function(t,n){void 0===n&&(n=e.SOURCE.API),this.textService.insertText(t),this.emitTextChangeEvent(n)},t.emitTextChangeEvent=function(t){void 0===t&&(t=e.SOURCE.API),t!==e.SOURCE.SILENT&&(this.emitter.emit(e.EVENT.VALUE_CHANGE,{source:t}),this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:t}))},t.getSelectedText=function(){return this.textService.getSelectedText()},t.getRawText=function(){return this.textService.getData(!0)},t.insertNewLine=function(t){void 0===t&&(t=e.SOURCE.API),this.selection.removeFillingCharNode();var n=this.input.lastChild;if(!n||"BR"!==n.nodeName){var i=document.createElement("br");i.className="extra",this.input.appendChild(i)}this.textService.doLineBreak(),this.history.save(!0),this.history.refreshState(),t!==e.SOURCE.SILENT&&(this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:t}),this.emitter.emit(e.EVENT.VALUE_CHANGE,{source:t}))},t.getInputDom=function(){return this.textService.getInputDom()},t.isComposing=function(){return this.history.isComposing()},t.getSelection=function(){return this.selection.getRange()},t.setSelection=function(t,n){void 0===n&&(n=e.SOURCE.API),this.selection.setRange(t),n!==e.SOURCE.SILENT&&this.emitter.emit(e.EVENT.SELECTION_CHANGE,{source:n})},t.isCollapsed=function(){return this.selection.isCollapsed()},t.collapseToEnd=function(){this.selection.collapseToEnd()},t.hasFocus=function(){return this.selection.hasFocus()},t.focus=function(){this.selection.focus()},t.blur=function(){this.selection.blur()},t.removeFillingCharNode=function(){this.selection.removeFillingCharNode()},t.createFillingCharNode=function(){return this.selection.createFillingCharNode()},t.save=function(e){void 0===e&&(e=!0),this.history.save(e)},t.undo=function(){this.history.undo()},t.redo=function(){this.history.redo()},t.canUndo=function(){return this.history.canUndo()},t.canRedo=function(){return this.history.canRedo()},t.refreshUndoRedoState=function(){this.history.refreshState()},t.lock=function(){this.history.lock()},t.unlock=function(){this.history.unlock()},t.addBinding=function(e){this.keyboard.addBinding(e)},t.removeBinding=function(e){this.keyboard.removeBinding(e)},t.attachEventToInput=function(e,t){this.input.addEventListener(e,t)},t.clear=function(){this.textService.setData(""),this.history.clear()},t.initEditorCores=function(){this.clipboard=new a({inputDom:this.input,emitter:this.emitter,editorInterface:this}),this.selection=new m.ZP({inputDom:this.input,platform:l.t4.PC,editorInterface:this}),this.textService=new f({rootDom:this.rootDom,inputDom:this.input,platform:l.t4.PC,editorInterface:this}),this.keyboard=new o.ZP({root:this.input}),this.history=new c({inputDom:this.input,emitter:this.emitter,editorInterface:this})},t.initEditorEvents=function(){this.emitter.on(e.EVENT.SELECTION_CHANGE,this.updateSelectionCache),this.emitter.on(e.EVENT.VALUE_CHANGE,this.updateSelectionCache)},(0,i.Z)(e,[{key:"EVENT",get:function(){return e.EVENT}},{key:"SOURCE",get:function(){return e.SOURCE}},{key:"isActive",get:function(){return this.active}}]),e}();g.EVENT={FOCUS:"FOCUS",BLUR:"BLUR",VALUE_CHANGE:"VALUE_CHANGE",SELECTION_CHANGE:"SELECTION_CHANGE",FORMAT_CHANGE:"FORMAT_CHANGE",UNDO_REDO_CHANGE:"UNDO_REDO_CHANGE",ON_PASTE:"ON_PASTE",ON_PASTE_OUTER:"ON_PASTE_OUTER",ON_KEY_DOWN:"ON_KEY_DOWN",TOOLBAR_INSERT:"TOOLBAR_INSERT"},g.SOURCE={USER:"USER",API:"API",SILENT:"SILENT"};var p=g},"../packages/editor/src/AlloyRichTextEditor.ts":function(e,t,n){"use strict";n.d(t,{Z:function(){return I}});var i=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.string.bold.js"),n("../node_modules/core-js/modules/es.string.italics.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/editor/src/helper/utils.ts")),r=n("../packages/editor/src/helper/Env.ts"),a=["bold","fontName","fontSize","foreColor","italic","strikeThrough","underline"];function d(e,t,n,i){if(e&&n&&i)for(var s=e.firstElementChild;s;){if(s===n.parentNode||s===i.parentNode||t){if(t=!0,s.nodeType===Node.ELEMENT_NODE&&s.removeAttribute(o.IH),i.nodeType===Node.TEXT_NODE&&s===i.parentNode||i.nodeType!==Node.TEXT_NODE&&s===i)return;d(s,!0,n,i)}else d(s,t,n,i);s=s.nextElementSibling}}var u=function(){function e(e){this.inputDom=e.inputDom,this.emitter=e.emitter,this.editorInterface=e.editorInterface}var t=e.prototype;return t.format=function(e,t){void 0===t&&(t=""),"fontName"===e&&"Microsoft YaHei"===t&&(t+=",微软雅黑");var n=this.checkSelectedAll(e);if(-1!==a.indexOf(e)){if("fontSize"===e)this.fontSize(t);else if(r.Z.ie&&this.editorInterface.isCollapsed())this.polyfillFormatForIEWhenCollapsed(e,t);else{r.Z.ie&&"foreColor"===e&&(t=(0,o.s)(t)),document.execCommand("styleWithCSS",!1,"true"),document.execCommand(e,!1,t);var i=document.getSelection();if(i&&"foreColor"===e){var s=i.getRangeAt(0);d(this.inputDom,!1,null===s||void 0===s?void 0:s.startContainer,null===s||void 0===s?void 0:s.endContainer)}this.polyfillFormatForIE(n,e,t)}return this.editorInterface.save(!0),this.editorInterface.focus(),this.editorInterface.refreshUndoRedoState(),this.emitter.emit(I.EVENT.FORMAT_CHANGE,{source:I.SOURCE.API}),!0}},t.queryFormats=function(){var e=this,t={};return a.forEach((function(n){var i=e.queryCommand(n);null!==i&&(t[n]=i)})),t},t.checkSelectedAll=function(e){r.Z.ie&&!this.editorInterface.hasFocus()&&this.editorInterface.currSelection&&(this.editorInterface.focus(),this.editorInterface.setSelection(this.editorInterface.currSelection,I.SOURCE.SILENT));var t=!1;if(r.Z.firefox||r.Z.ie){var n=this.editorInterface.getSelection(),i=this.editorInterface.getText().length;n&&i<=n.end-n.start&&(t=!0,this.editorInterface.setSelection(n,I.SOURCE.SILENT),"fontSize"===e&&this.removeChildrenStyle(this.inputDom,"font-size"))}return t},t.polyfillFormatForIE=function(e,t,n){var i=this;if(e&&r.Z.ie){var s=document.getSelection(),o=null;s&&s.rangeCount>0&&(o=s.getRangeAt(0));var a=null===o||void 0===o?void 0:o.commonAncestorContainer;if(a&&"bold"===t&&this.removeChildrenStyle(a,"font-weight"),a&&"italic"===t&&this.removeChildrenStyle(a,"font-style"),"foreColor"===t){var d=this.inputDom.querySelectorAll('font[color="'+n.replace(/ /g,"")+'"]');Array.from(d).forEach((function(e){i.removeChildrenStyle(e,"color","color")}))}a&&"fontName"===t&&this.removeChildrenStyle(a,"font-family","face")}},t.fontSize=function(e){this.editorInterface.isCollapsed()?this.setFontSizeForCaret(e):this.setFontSizeForRange(e)},t.setFontSizeForCaret=function(e){var t=this.queryFormats(),n=(t.strikeThrough?"line-through ":"")+(t.underline?"underline":""),i=(0,o.Fd)({"font-size":e+"pt","font-weight":t.bold?"bold":"normal","font-style":t.italic?"italic":"normal",color:t.foreColor,"font-family":t.fontName,"text-decoration":""===n?"none":n},this.editorInterface.createFillingCharNode()),s=document.getSelection();if(s&&s.rangeCount>0){var r=s.getRangeAt(0);r.insertNode(i),r.setStartAfter(i),r.setStart(i,1),r.setEnd(i,1),r.collapse(!0),s.removeAllRanges(),s.addRange(r),this.emitter.emit(I.EVENT.SELECTION_CHANGE,{source:I.SOURCE.SILENT})}},t.setFontSizeForRange=function(e){var t=this;document.execCommand("styleWithCSS",!1,"false"),document.execCommand("fontSize",!1,"1"),[].slice.call(this.inputDom.querySelectorAll('FONT[size="1"]')).forEach((function(n){n.removeAttribute("size"),n.style.fontSize=e+"pt",(r.Z.ie||r.Z.firefox)&&t.removeChildrenStyle(n,"font-size")}))},t.removeChildrenStyle=function(e,t,n){e&&["span","font"].forEach((function(i){var s=e.querySelectorAll(i);Array.from(s).forEach((function(e){t&&""!==e.style[t]&&(e.style[t]=""),n&&e.hasAttribute(n)&&e.removeAttribute(n)}))}))},t.parseFormatStyleObj=function(e,t){var n={},i=this.queryCommand(e);switch(e){case"bold":n={"font-weight":i?"normal":"bold"};break;case"italic":n={"font-style":i?"normal":"italic"};break;case"fontName":n={"font-family":t};break;case"foreColor":n={color:t};break;case"underline":n=i?{}:{"text-decoration":"underline"};break;case"strikeThrough":n=i?{}:{"text-decoration":"line-through"}}return n},t.polyfillFormatForIEWhenCollapsed=function(e,t){var n=(0,o.Fd)(this.parseFormatStyleObj(e,t),this.editorInterface.createFillingCharNode()),i=document.getSelection();if(i&&i.rangeCount>0){var s=i.getRangeAt(0);s.insertNode(n),s.setStartAfter(n),s.setStart(n,1),s.setEnd(n,1),s.collapse(!0),i.removeAllRanges(),i.addRange(s),this.emitter.emit(I.EVENT.SELECTION_CHANGE)}},t.queryCommand=function(e){if("fontSize"===e)return this.prepareFontSize();var t;if(r.Z.firefox){if(!this.editorInterface.hasFocus()){if(this.editorInterface.focus(),!this.editorInterface.currSelection)return null;this.editorInterface.setSelection(this.editorInterface.currSelection,I.SOURCE.SILENT)}var n=document.queryCommandState(e);if("foreColor"===e||"fontName"===e){var i=this.editorInterface.defaultCellStyle.color,s=this.editorInterface.defaultCellStyle["font-family"];t=(t=document.queryCommandValue(e))||("foreColor"===e?i:s)}else t=n}else"string"===typeof(t=document.queryCommandValue(e))?"true"===t.toLocaleLowerCase()?t=!0:"false"===t.toLocaleLowerCase()&&(t=!1):"number"===typeof t&&(t=(0,o.V)(t));return t},t.prepareFontSize=function(){var e=this.editorInterface.getSelection();e&&!e.isCollapsed()&&r.Z.ie&&this.editorInterface.setSelection(e,I.SOURCE.SILENT);var t=document.getSelection(),n=(null===t||void 0===t?void 0:t.rangeCount)?t.getRangeAt(0):null;if(!n)return null;var i=n.endContainer||n.startContainer;if(e&&!e.isCollapsed()){var s=this.editorInterface.getSelectedText(),a=(0,o.E7)(n.startContainer.textContent||n.startContainer.innerText),d=(0,o.E7)(n.endContainer.textContent||n.endContainer.innerText);s===a?i=n.startContainer:s===d&&(i=n.endContainer)}return i&&i.nodeType===Node.TEXT_NODE&&(i=i.parentNode),this.queryFontSize(i)},t.queryFontSize=function(e){if(e&&e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),!e||!(e instanceof Element))return 10;var t=null;window.getComputedStyle?t=window.getComputedStyle(e,null):e.currentStyle&&(t=e.currentStyle);var n=null===t||void 0===t?void 0:t["font-size"];return this.parseFontsize(n)},t.extractNumberFromString=function(e){var t=/[+-]?\d+(?:\.\d+)?/g.exec(e);return(null===t||void 0===t?void 0:t.length)&&Number(t[0])||10},t.parseFontsize=function(e){var t=10;return/pt$/i.test(e)?t=this.extractNumberFromString(e):/px$/i.test(e)&&(t=Math.round(3*this.extractNumberFromString(e)/4)),t},e}(),l=n("../packages/editor/src/blocks/mention-block/MentionBlock.ts"),h=n("../packages/editor/src/interface.ts"),c=n("../packages/editor/src/AlloyBaseTextEditor.ts"),I=function(e){function t(t){var n;return(n=e.call(this,t)||this).defaultCellStyle=t.defaultCellStyle,n.defaultTextStyle=t.defaultTextStyle,n.initEditorComponents(n.rootDom,t.className),n.initEditorCores(),n.initMentionBlock(t.mentionHooks),n.initEditorEvents(),n}(0,s.Z)(t,e);var n=t.prototype;return n.show=function(e,t){var n=this;"string"===typeof(null===t||void 0===t?void 0:t.inputMode)&&(this.input.inputMode=t.inputMode),this.setEditorInputStyles(e.cellStyles),this.setEditorContent(e.editValue,e.textStyleRuns,e.mentionDetails||[]),this.save(!0),setTimeout((function(){n.currSelection=n.getSelection(),n.emitter.emit(c.Z.EVENT.FORMAT_CHANGE,{source:c.Z.SOURCE.SILENT})})),this.mentionBlock.resetVars()},n.setEditorContainerStyles=function(e){(0,o.tt)(this.rootDom,e)},n.setEditorInputStyles=function(e){(0,o.tt)(this.input,e)},n.getEditorContainer=function(){return this.rootDom},n.setEditorContent=function(e,t,n){var i=this;for(void 0===n&&(n=[]);this.input.firstChild;)this.input.removeChild(this.input.firstChild);var s=this.createFillingCharNode();if(e&&e.length)this.createEditorContent(e,t,n).forEach((function(e){var t=document.createDocumentFragment();t.appendChild(e.cloneNode(!0)),i.input.appendChild(t.cloneNode(!0))}));else{var a=(0,o.Fd)(t[0].format,r.Z.iOS||r.Z.safari?"":s);this.input.appendChild(a)}var d=this.input.lastChild;if(!d||"BR"!==d.tagName){var u=document.createElement("br");u.className="extra",this.input.appendChild(u)}},n.createMention=function(e){return this.mentionBlock.create(e)},n.setContent=function(e,n){void 0===n&&(n=c.Z.SOURCE.API),this.textService.setHTMLContent(e);var i=this.findFillingCharNode(this.input);i&&this.selection.initFillingCharNode(i),this.emitter.emit(t.EVENT.VALUE_CHANGE,{source:n})},n.format=function(e,t){return this.formats.format(e,t),!0},n.getFormat=function(){return this.formats.queryFormats()},n.initEditorComponents=function(e,t){this.rootDom=document.createElement("div"),this.rootDom.classList.add(t),this.rootDom.setAttribute("spellcheck","false"),this.rootDom.style.overflowY="auto",this.rootDom.style.overflowX="hidden",this.input=document.createElement("div"),this.input.setAttribute("id",h.al),this.input.setAttribute("contenteditable",this.editable.toString()),this.input.style.boxSizing="border-box",this.input.style.padding="0px 4px",this.input.style.display="table-cell",this.input.style.whiteSpace="pre-wrap",this.input.setAttribute("tabindex","0"),this.input.setAttribute("role","combobox"),this.input.style.wordBreak="break-word",this.input.style.wordWrap="break-word",this.rootDom.appendChild(this.input),e.appendChild(this.rootDom)},n.initEditorCores=function(){e.prototype.initEditorCores.call(this),this.formats=new u({inputDom:this.input,emitter:this.emitter,editorInterface:this})},n.initMentionBlock=function(e){this.mentionBlock=new l.Z({rootDom:this.rootDom,inputDom:this.input,blockInterface:this,emitter:this.emitter,platform:this.platform},{hooks:e||{}})},n.initEditorEvents=function(){e.prototype.initEditorEvents.call(this),this.initInputEvent()},n.initInputEvent=function(){var e=this;this.input.addEventListener("input",(function(t){"deleteContentBackward"!==t.inputType&&"deleteContentForward"!==t.inputType||e.input.hasChildNodes()||e.addExtraBr()})),this.input.addEventListener("compositionend",(function(){e.input.hasChildNodes()||e.addExtraBr()}))},n.addExtraBr=function(){var e=document.createElement("br");e.className="extra",this.input.appendChild(e)},n.createEditorContent=function(e,t,n){for(var s="",r=null,a=null,d=0,u=0,l=[],h=0;h<t.length;h++){r=t[h],a=h+1<t.length?t[h+1]:null,d=r.startIndex,u=a?a.startIndex:e.length;for(var c=this.splitTextStyleRunByMentionDetails([d,u],n),I=0;I<c.length;I++){var f=c[I];s=e.substring(f.pos[0],f.pos[1]),f.mention?l.push.apply(l,(0,i.Z)(this.createMention(f.mention))):l.push((0,o.Fd)(r.format,s))}}return l},n.splitTextStyleRunByMentionDetails=function(e,t){var n=(t||[]).filter((function(t){return e[0]<=t.pos[0]&&t.pos[1]<=e[1]}));if(!n.length)return[{pos:e}];for(var i,s=[],o=e[0],r=0;r<n.length;r++)o<(i=n[r]).pos[0]&&s.push({pos:[o,i.pos[0]]}),s.push({pos:i.pos,mention:i}),o=i.pos[1];return o<e[1]&&s.push({pos:[o,e[1]]}),s},n.findFillingCharNode=function(e){if(!e)return null;if(e&&e.nodeType===Node.TEXT_NODE){if((e.nodeValue||"").indexOf(o.pI)>=0)return e}else for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];return this.findFillingCharNode(n)}return null},t}(c.Z)},"../packages/editor/src/AlloySimpleTextEditor.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../packages/editor/src/interface.ts")),o=function(e){function t(t){var n;return(n=e.call(this,t)||this).initEditorComponents(n.rootDom,t.className),n.initEditorCores(),n.initEditorEvents(),n}(0,i.Z)(t,e);var n=t.prototype;return n.setCanCopy=function(t){t!==this.canCopy&&(e.prototype.setCanCopy.call(this,t),t?(this.input.setAttribute("contenteditable",this.editable.toString()),this.input.style.userSelect=""):(this.input.setAttribute("contenteditable","false"),this.input.style.userSelect="none"))},n.setEditable=function(t){t!==this.editable&&(e.prototype.setEditable.call(this,t),this.editable||this.canCopy||this.input.setAttribute("contenteditable","false"))},n.initEditorComponents=function(e,t){this.input=document.createElement("div"),this.input.classList.add(t),this.input.setAttribute("contenteditable",this.editable.toString()),this.input.style.whiteSpace="pre-wrap",this.input.setAttribute("tabindex","1"),this.input.setAttribute("id",s.T6),this.canCopy||(this.input.setAttribute("contenteditable","false"),this.input.style.userSelect="none"),e.appendChild(this.input)},t}(n("../packages/editor/src/AlloyBaseTextEditor.ts").Z);t.Z=o},"../packages/editor/src/blocks/mention-block/MentionBlock.ts":function(e,t,n){"use strict";n.d(t,{o:function(){return l},Z:function(){return h}});var i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=(n("../node_modules/core-js/modules/es.string.trim.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.string.search.js"),n("../packages/editor/src/helper/Env.ts")),r=n("../packages/editor/src/core/Selection.ts"),a=function(){function e(e){this._rootDom=e.rootDom,this._inputDom=e.inputDom,this._blockInterface=e.blockInterface,this._emitter=e.emitter}return e.prototype.createElementFromHTML=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},e}(),d=n("../packages/editor/src/interface.ts"),u=n("../packages/editor/src/AlloyBaseTextEditor.ts"),l=(n("../spread-sheet/src/base/util/domain-config.ts"),String.fromCharCode(8203)),h=function(e){function t(t,n){var i;return(i=e.call(this,t)||this)._enteringMention=!1,i._mentionStartIndex=0,i._isComposing=!1,i._platform=t.platform,i._hooks=n.hooks,i.polyfillForClosest(),i.initCssStyle(),i.initEvents(),i}(0,s.Z)(t,e);var a=t.prototype;return a.initEvents=function(){this._initKeydownEvent()},a._initKeydownEvent=function(){var e=this;this._blockInterface.attachEventToInput("keydown",(function(t){var n=e._blockInterface.getRawText(),i=e._blockInterface.getSelection();if(!t||8!==t.keyCode&&46!==t.keyCode){if(37===t.keyCode){if(i&&i.start>0){var s=n[i.start-1],o=n[i.end-1];if(s===l){var a=e.findMentionBlockBeforePos(i.start);if(a){var d=i.start-(a.innerText.trim().length+2),u=t.shiftKey?i.end:d,h=new r.e6(d,u);e._blockInterface.setSelection(h),t.preventDefault(),t.stopImmediatePropagation()}}else if(o===l&&t.shiftKey){var c=e.findMentionBlockBeforePos(i.end);c&&(e._blockInterface.setSelection(new r.e6(i.start,i.end-(c.innerText.trim().length+2))),t.preventDefault(),t.stopImmediatePropagation())}}}else if(39===t.keyCode&&i&&i.end<n.length){var I=n[i.end],f=n[i.start];if(I===l){var m=e.findMentionBlockAfterPos(i.end);if(m){var g=i.end+(m.innerText.trim().length+2),p=t.shiftKey?i.start:g,R=new r.e6(p,g);e._blockInterface.setSelection(R),t.preventDefault(),t.stopImmediatePropagation()}}else if(f===l&&t.shiftKey){var x=e.findMentionBlockAfterPos(i.start);x&&(e._blockInterface.setSelection(new r.e6(i.start+(x.innerText.trim().length+2),i.end)),t.preventDefault(),t.stopImmediatePropagation())}}}else if(i&&i.start===i.end){var E=null;8===t.keyCode?n[i.start-1]===l&&(E=e.findMentionBlockBeforePos(i.start)):n[i.start]===l&&(E=e.findMentionBlockAfterPos(i.start)),E&&(E.previousSibling&&E.previousSibling.remove(),E.nextSibling&&E.nextSibling.remove(),E.remove(),t.preventDefault())}}))},a.ensureFakeTextSpanFine=function(){var e=!1,t=document.querySelectorAll("."+d.QP);return Array.from(t).forEach((function(t){var n,i,s=t.previousSibling,o=t.nextSibling;if(s){var r=s.innerText.trim();if(r&&r.length>1){s.innerText=r.replace(l,""),s.removeAttribute("fake-text");var a=document.createElement("span");a.setAttribute("fake-text","start"),a.innerText=l,null===(n=null===t||void 0===t?void 0:t.parentNode)||void 0===n||n.insertBefore(a,t),e=!0}}if(o){var d=o.innerText.trim();if(d&&d.length>1){o.innerText=d.replace(l,""),o.removeAttribute("fake-text");var u=document.createElement("span");u.setAttribute("fake-text","end"),u.innerText=l,null===(i=null===t||void 0===t?void 0:t.parentNode)||void 0===i||i.insertBefore(u,o),e=!0}}})),e},a.findMentionBlockBeforePos=function(e){var t=0,n=null;return function e(i,s){if(i.nodeType===Node.TEXT_NODE||"BR"===i.tagName)i.nodeType===Node.TEXT_NODE?t+=(i.textContent||"").length:t+=1;else if(i&&i.className===d.QP){var o=(i.textContent||"").trim().length;t+o+1===s&&(n=i),t+=o}else for(var r=0;r<i.childNodes.length;r++)e(i.childNodes[r],s)}(this._inputDom,e),n},a.findMentionBlockAfterPos=function(e){var t=0,n=null;return function e(i,s){if(i.nodeType===Node.TEXT_NODE||"BR"===i.tagName)i.nodeType===Node.TEXT_NODE?t+=i.length:t+=1;else if(i&&i.className===d.QP){var o=(i.textContent||"").trim().length;s+1===t&&(n=i),t+=o}else for(var r=0;r<i.childNodes.length;r++)e(i.childNodes[r],s)}(this._inputDom,e),n},a.getMentionListPosition=function(){var e=this.getNativeRange();if(e){var t=e.getClientRects();if(null===t||void 0===t?void 0:t.length){var n=t[0];return{x:n.x||n.left,y:(n.y||n.top)+n.height}}}var i=this._rootDom.getBoundingClientRect();return{x:i.x||i.left,y:(i.y||i.top)+i.height}},a.getNativeRange=function(){var e=document.getSelection();return(null===e||void 0===e?void 0:e.rangeCount)?e.getRangeAt(0):null},a.prepareForInsertMention=function(){var e=null,t=this._blockInterface.getSelection();if(t){var n=t.start;this._mentionStartIndex<=n&&(this._blockInterface.setSelection(new r.e6(Math.max(0,this._mentionStartIndex-1),n)),null===(e=this.getNativeRange())||void 0===e||e.deleteContents())}},a.insertMention=function(e){var t=this.getNativeRange();if(t){var n=this.create(e);if(n.forEach((function(e){t.insertNode(e),t.collapse(!1)})),o.Z.safari){var i=document.createRange(),s=n[n.length-1];i.setStartAfter(s),i.setEndAfter(s);var r=document.getSelection();r&&(r.removeAllRanges(),r.addRange(i))}this._emitter.emit(u.Z.EVENT.VALUE_CHANGE,{source:u.Z.SOURCE.API})}},a.triggerMentionListSearch=function(){var e=this;this._platform===d.t4.MOBILE||this._isComposing||setTimeout((function(){var t,n,i=e._blockInterface.getRawText(),s=e._blockInterface.getSelection();if(s){var o=i.substring(e._mentionStartIndex,s.end);o.length>24&&e.triggerEndMention(),null===(n=(t=e._hooks).search)||void 0===n||n.call(t,o)}}))},a.triggerEndMention=function(){var e,t;this.resetVars(),this._blockInterface.unlock(),this._blockInterface.removeFillingCharNode(),null===(t=(e=this._hooks).hideMentionList)||void 0===t||t.call(e)},a.resetVars=function(){this._enteringMention=!1,this._mentionStartIndex=0,this._isComposing=!1},a.create=function(e){return[this.createFakeText("start"),this.createMentionBlock(e),this.createFakeText("end")]},a.createFakeText=function(e){var t=document.createElement("span");t.setAttribute("fake-text",e);var n=document.createTextNode(l);return t.appendChild(n),t},a.createMentionBlock=function(e){var t=e.text||"",n=null,i="\n            <span class="+d.QP+'>\n                <div class="mention-block-content" contenteditable="false">\n                    <span>'+t+"</span>\n                </div>\n            </span>";return(n=this.createElementFromHTML(i)).setAttribute("data-mention-detail",JSON.stringify(e)),n},a.polyfillForClosest=function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})},a.initCssStyle=function(){n("../packages/editor/src/blocks/mention-block/MentionBlock.less")},(0,i.Z)(t,[{key:"enteringMention",get:function(){return this._enteringMention}}]),t}(a)},"../packages/editor/src/core/Selection.ts":function(e,t,n){"use strict";n.d(t,{e6:function(){return a}});var i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(n("../node_modules/core-js/modules/es.string.trim.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../packages/editor/src/interface.ts")),o=n("../packages/editor/src/helper/utils.ts"),r=n("../packages/editor/src/AlloyBaseTextEditor.ts"),a=function(){function e(e,t){e=Math.max(0,e),t=Math.max(0,t),this._start=Math.min(e,t),this._end=Math.max(e,t)}var t=e.prototype;return t.equals=function(e){return"number"===typeof e._start&&e._start===this._start&&"number"===typeof e._end&&e._end===this._end},t.isCollapsed=function(){return this._start===this._end},(0,i.Z)(e,[{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}}]),e}(),d="\ufeff",u=function(){function e(e){var t=this;this._inputDom=e.inputDom,this._platform=e.platform,this._editorInterface=e.editorInterface,this._currentFillingCharNode=null,this._polyfillIfNeed(),this._inputDom.addEventListener("focus",(function(e){t._editorInterface.emitter.emit(r.Z.EVENT.FOCUS,e)})),this._inputDom.addEventListener("blur",(function(e){t._editorInterface.emitter.emit(r.Z.EVENT.BLUR,e)}))}var t=e.prototype;return t.initFillingCharNode=function(e){this._currentFillingCharNode=e},t.createFillingCharNode=function(){return this.removeFillingCharNode(),this._currentFillingCharNode=document.createTextNode(d)},t.removeFillingCharNode=function(){var e;if((!(null===(e=this._editorInterface.mentionBlock)||void 0===e?void 0:e.enteringMention)||this._platform!==s.t4.PC)&&this._currentFillingCharNode){var t=this._currentFillingCharNode;this._currentFillingCharNode=null;var n=document.getSelection();if(!n)return;this._checkSelection(n);var i=(null===n||void 0===n?void 0:n.rangeCount)?n.getRangeAt(0):null,r=(t.nodeValue||"").indexOf(d);if(-1===r)return;var a=null;t.length>d.length&&i&&i.intersectsNode(t)&&(a=[{node:n.anchorNode,offset:n.anchorOffset},{node:n.focusNode,offset:n.focusOffset}],n&&n.anchorNode==t&&n.anchorOffset>r&&(a[0].offset-=d.length),n&&n.focusNode==t&&n.focusOffset>r&&(a[1].offset-=d.length));try{t.nodeValue=(0,o.E7)(t.nodeValue||"",!0)}catch(u){console.error("AlloyRTE selection error: ",u)}a&&this.moveNativeSelectionToBookmark(a)}},t.moveNativeSelectionToBookmark=function(e){var t=document.getSelection();if(t){var n=document.createRange();n.setStart(e[0].node,e[0].offset),t.extend||n.setEnd(e[1].node,e[1].offset),n.collapse(!0),t.removeAllRanges(),t.addRange(n),t.extend&&t.extend(e[1].node,e[1].offset)}},t.isCollapsed=function(){var e=document.getSelection();return!(!e||e.rangeCount<=0)&&(this._checkSelection(e),e.getRangeAt(0).collapsed)},t.hasFocus=function(){var e=document.activeElement===this._inputDom||l(this._inputDom,document.activeElement),t=document.getSelection(),n=!!(t&&t.rangeCount>0);return e&&n},t.focus=function(){if(!this.hasFocus()){this._inputDom.focus();var e=document.getSelection();e&&!e.rangeCount&&e.selectAllChildren(this._inputDom)}},t.blur=function(){this._inputDom.blur()},t.collapseToEnd=function(e){"undefined"===typeof e&&(e=this._editorInterface.getRawText().length),this.setRange(new a(e,e))},t.collapseToPoint=function(e){var t=this._editorInterface.getText().length;e<0&&(e=0),e>t&&(e=t),this.setRange(new a(e,e))},t.setRange=function(e){if(e){var t=document.createRange();if(0===e.start&&0===e.end)return t.setStart(this._inputDom,0),t.setEnd(this._inputDom,0),void this.setNativeRange(t);var n={},i=0,o=!1;try{!function r(a){if(a&&e)if(a.nodeType===Node.TEXT_NODE||"BR"===a.tagName){var d="BR"===a.tagName?1:a.length,u=i+d;if(!o&&e.start>=i&&e.start<=u&&("BR"===a.tagName?t.setStartAfter(a):t.setStart(a,e.start-i),o=!0),o&&e.end>=i&&e.end<=u)throw"BR"===a.tagName?t.setEndAfter(a):t.setEnd(a,e.end-i),n;i=u}else if(a&&a.className===s.QP){var l=(a.textContent||"").trim().length;if(!o&&i<e.start&&e.start<i+l&&(e.start<i+l/2?t.setStart(a,0):t.setStart(a,l),o=!0),o&&i<e.end&&e.end<i+l)throw e.end<i+l/2?t.setEnd(a,0):t.setEnd(a,l),n;i+=l}else for(var h=0;h<a.childNodes.length;h++)r(a.childNodes[h])}(this._inputDom)}catch(r){if(r!==n)throw this.collapseToEnd(),r;this.setNativeRange(t)}}},t.getRange=function(){var e=document.getSelection();if(!e||e.rangeCount<=0)return null;var t=0,n=0,i=0,o=!1,r={};if(e.rangeCount>0){this._checkSelection(e);var d=e.getRangeAt(0),u=this.normalizeNativeRange(d);try{!function e(a,d){if(a&&d)if(a.nodeType===Node.TEXT_NODE||"BR"===a.tagName){if(o||a!=d.start.node||(n=t+d.start.offset,o=!0),o&&a==d.end.node)throw i=t+d.end.offset,r;a.nodeType===Node.TEXT_NODE?t+=a.length:t+=1}else if(a&&a.className===s.QP){var u=(a.textContent||"").trim().length;if(o||a!==d.start.node||(n=t+(d.start.offset<u/2?0:u),o=!0),o&&a===d.end.node)throw i=t+(d.end.offset<u/2?0:u),r;t+=u}else for(var l=0;l<a.childNodes.length;l++)e(a.childNodes[l],d)}(this._inputDom,u)}catch(l){if(l!=r)throw l}}return new a(n,i)},t.setNativeRange=function(e){if(e){var t=document.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},t.normalizeNativeRange=function(e){if(!l(this._inputDom,e.startContainer)||!e.collapsed&&!l(this._inputDom,e.endContainer))return null;var t={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[t.start,t.end].forEach((function(e){var t=e.node,n=e.offset;if(t&&t.className===s.QP);else for(;!(t instanceof Text)&&t.childNodes.length>0;)if(t.childNodes.length>n)t=t.childNodes[n],n=0;else{if(t.childNodes.length!==n)break;n=(t=t.lastChild)instanceof Text?t.data.length:t.childNodes.length>0?t.childNodes.length:t.childNodes.length+1}e.node=t,e.offset=n})),t},t._polyfillIfNeed=function(){window.Range.prototype.intersectsNode||(window.Range.prototype.intersectsNode=function(e){var t=document.createRange();t.selectNode(e);var n=!1;try{n=0>this.compareBoundaryPoints(window.Range.END_TO_START,t)&&0<this.compareBoundaryPoints(window.Range.START_TO_END,t)}catch(i){console.warn("IE polyfill intersectsNode error: ",i)}return n})},t._checkSelection=function(e){if(e&&e.rangeCount)try{e.getRangeAt(0)}catch(t){e.removeAllRanges(),this.setRange(this._editorInterface.currSelection)}},e}();function l(e,t){try{t.parentNode}catch(n){return!1}return function(e,t){for(var n=t;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}(e,t)}t.ZP=u},"../packages/editor/src/helper/Env.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),navigator.userAgent.toLowerCase()),o=s.match(/edge[ /](\d+.?\d*)/),r=s.indexOf("trident/")>-1,a=!(!o&&!r),d=function(){function e(){}return(0,i.Z)(e,null,[{key:"ie",get:function(){return a}},{key:"edge",get:function(){return!!o}},{key:"webkit",get:function(){return!a&&s.indexOf(" applewebkit/")>-1}},{key:"mac",get:function(){return s.indexOf("macintosh")>-1}},{key:"mobile",get:function(){return s.indexOf("mobile")>-1}},{key:"iOS",get:function(){return/(ipad|iphone|ipod)/.test(s)}},{key:"isPcTencentDocApp",get:function(){return"undefined"!==typeof external&&"undefined"!==typeof external.nativeCall}},{key:"gecko",get:function(){return"Gecko"==navigator.product&&!e.webkit&&!e.ie}},{key:"firefox",get:function(){return e.gecko||s.indexOf("firefox")>-1}},{key:"chrome",get:function(){return e.webkit&&s.indexOf("chrome")>-1}},{key:"safari",get:function(){return e.webkit&&!e.chrome}}]),e}();t.Z=d},"../packages/editor/src/helper/utils.ts":function(e,t,n){"use strict";n.d(t,{E7:function(){return d},Fd:function(){return h},IH:function(){return c},So:function(){return i},V:function(){return u},VS:function(){return a},nP:function(){return r},pI:function(){return s},s:function(){return l},tt:function(){return I}}),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.object.get-own-property-names.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.object.to-string.js");var i=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",s="\ufeff",o=new RegExp(s+"( )?","g"),r={8:1,46:1},a={37:1,38:1,39:1,40:1,36:1,35:1,33:1,34:1};function d(e,t){return void 0===t&&(t=!1),e=e||"",t?e.replace(o,(function(e,t){return t?" ":""})):e.replace(s,"")}function u(e){var t=function(e){return[255&e,(65280&e)>>8,(16711680&e)>>16]}(e);return"rgb("+t[0]+","+t[1]+","+t[2]+")"}function l(e){if("string"!==typeof e)return e;var t,n,i,s=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return s&&4===s.length?(t=parseInt(s[1],10),n=parseInt(s[2],10),i=parseInt(s[3],10),"#"+((1<<24)+(t<<16)+(n<<8)+i).toString(16).slice(1)):e}function h(e,t){var n=document.createElement("span");return"string"===typeof t?n.innerText=t:t.nodeType===Node.TEXT_NODE&&n.appendChild(t),e&&I(n,e),n}var c="data-theme-color";function I(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=t[c];n===c&&i?e.setAttribute(c,i):e.style[n]=t[n]}}},"../packages/editor/src/interface.ts":function(e,t,n){"use strict";n.d(t,{QP:function(){return u},T6:function(){return a},_J:function(){return r},al:function(){return d},t4:function(){return i}});var i,s,o,r,a="alloy-simple-text-editor",d="alloy-rich-text-editor",u="alloy-mention-block";!function(e){e[e.PC=0]="PC",e[e.PAD=1]="PAD",e[e.MOBILE=2]="MOBILE"}(i||(i={})),function(e){e[e.EXIT=0]="EXIT",e[e.DETECTION=1]="DETECTION"}(s||(s={})),function(e){e[e.ORIGIN=0]="ORIGIN",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.UP=3]="UP",e[e.DOWN=4]="DOWN"}(o||(o={})),function(e){e[e.PRINTABLE_KEYS=0]="PRINTABLE_KEYS",e[e.NAVIGATION_KEYS=1]="NAVIGATION_KEYS",e[e.DELETE_KEYS=2]="DELETE_KEYS"}(r||(r={}))},"../packages/flyweight/Factory.ts":function(e,t,n){"use strict";n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var i=function(){function e(e){this.ctor=e,this.maxPoolSize=1e4,this.pools=new Map}var t=e.prototype;return t.createInstance=function(e){var t,n;void 0===e&&(e={});var i=(null===(n=(t=this.ctor).preHandleOptions)||void 0===n?void 0:n.call(t,e))||e,s=this.ctor.generateKey(i),o=this.pools.get(s);return o||(o=new this.ctor(i,s),this.set(s,o)),o},t.isTargetType=function(e){return e instanceof this.ctor},t.releasePools=function(){this.pools.clear()},t.set=function(e,t){this.pools.size>=this.maxPoolSize&&this.releasePools(),this.pools.set(e,t)},e}();t.Z=i},"../packages/lib/EventEmitter.ts":function(e,t,n){"use strict";n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.filter.js");var i=function(){function e(e,t){this.handler=e,this.context=t.context,this.once=t.once,this.priority=t.priority}return e.prototype.isEqual=function(e){return this.handler===e.handler&&this.context===e.context&&this.once===e.once&&this.priority===e.priority},e}(),s=function(){function e(){this.events={}}var t=e.prototype;return t.on=function(e,t,n){var s=new i(t,Object.assign({context:this},n));return this.events[e]?(this.events[e].filter((function(e){return e.isEqual(s)})).length||(s.priority?this.events[e].unshift(s):this.events[e].push(s)),this):(this.events[e]=[s],this)},t.addListener=function(e,t,n){return this.on(e,t,n)},t.once=function(e,t,n){return this.on(e,t,Object.assign(Object.assign({},n),{once:!0}))},t.off=function(e,t,n){if(!e)return this.events={},this;if(!t)return this.events[e]=void 0,this;if(!this.events[e])return this;var s=new i(t,Object.assign({context:this},n));return this.events[e]=this.events[e].filter((function(e){return!e.isEqual(s)})),this},t.removeListener=function(e,t,n){return this.off(e,t,n)},t.emit=function(e){var t=this.events[e];if(!t)return!1;for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];for(var o=0;o<t.length;o++)t[o].once&&this.off(e,t[o].handler,{once:t[o].once,priority:t[o].priority,context:t[o].context}),t[o].handler.apply(t[o].context,i);return!0},t.destroy=function(){this.events={}},e}();t.Z=s},"../packages/lib/Keyboard.ts":function(e,t,n){"use strict";n.d(t,{ZP:function(){return d},h1:function(){return o},jQ:function(){return s},rW:function(){return r}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../packages/lib/global.ts");var i=/Mac|iPad/i.test(n.g.navigator.platform),s=i?"metaKey":"ctrlKey",o=i?"Meta":"Control",r={BACKSPACE:8,TAB:9,RETURN:13,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESCAPE:27,SPACE:32,SPACE_SAFARI:160,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META:91,META_LEFT:91,META_RIGHT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SEMICOLON:186,SEMICOLON_FIREFOX:59,EQUAL:187,EQUAL_FIREFOX:61,COMMA:188,MINUS:189,MINUS_FIREFOX:173,PERIOD:190,SLASH:191,BACK_QUOTE:192,LEFT_BRACKETS:219,BACKSLASH:220,RIGHT_BRACKETS:221,QUOTE:222},a={DIGIT0:48,DIGIT9:57},d=function(){function e(e){this.options=e,this.bindings={},this.onKeyDown=this.onKeyDown.bind(this),this.listen();var t=e.bindings;t&&(Array.isArray(t)?this.addBindings(t):this.addBinding(t))}e.match=function(t,n){if(!n.ignore&&["altKey","ctrlKey","metaKey","shiftKey"].some((function(e){return!!n[e]!==t[e]})))return!1;var i=e.getKeyCodeByEvent(t);return n.key===i||n.key===t.key},e.isEqual=function(e,t){return["altKey","ctrlKey","metaKey","shiftKey","ignore"].every((function(n){return e[n]===t[n]}))},e.normalize=function(t){var n=t;if("string"===typeof n.key){var i=n.key.toUpperCase();e.isCommonChar(i)&&(n.key=i.charCodeAt(0))}return n.shortKey&&(n[s]=n.shortKey,n.shortKey=void 0),n},e.isCommonChar=function(e){return void 0===e&&(e=""),1===e.length&&(e<="9"&&e>="0"||e<="Z"&&e>="A"||e<="z"&&e>="a"||" "===e)},e.getKeyCodeByEvent=function(t){var n,i=t.which||t.keyCode,s=null===(n=null===t||void 0===t?void 0:t.code)||void 0===n?void 0:n.toUpperCase();return 229===i&&e.isCommonChar(t.key)?i=t.key.toUpperCase().charCodeAt(0):229===i&&s in a&&(i=a[s]),i};var t=e.prototype;return t.addBinding=function(t){var n=e.normalize(t),i=n.key;this.bindings[i]=this.bindings[i]||[],t.override&&(this.bindings[i]=this.bindings[i].filter((function(t){return!e.isEqual(t,n)}))),n.priority?this.bindings[i].unshift(n):this.bindings[i].push(n)},t.addBindings=function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){t.addBinding(e)}))},t.removeBinding=function(t){var n=e.normalize(t),i=n.key,s=this.bindings[i];s&&s.length&&(this.bindings[i]=s.filter((function(e){return!(n.key===e.key&&n.handler===e.handler&&n.metaKey===e.metaKey&&n.ctrlKey===e.ctrlKey&&n.shiftKey===e.shiftKey&&n.priority===e.priority)})))},t.removeBindings=function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){t.removeBinding(e)}))},t.destroy=function(){this.bindings={},this.options.root.removeEventListener("keydown",this.onKeyDown)},t.listen=function(){this.options.root.addEventListener("keydown",this.onKeyDown)},t.onKeyDown=function(t){var n,i,s=this;if(!(null===(i=(n=this.options).shouldDisable)||void 0===i?void 0:i.call(n))){var o=e.getKeyCodeByEvent(t),r=(this.bindings[t.key]||[]).concat(this.bindings[o]||[]).filter((function(n){return e.match(t,n)}));0!==r.length&&r.some((function(e){return!1===e.handler.call(s,t,e)}))&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation())}},e}();d.KEYS=r},"../packages/lib/dom.ts":function(e,t,n){"use strict";n.d(t,{L:function(){return o}});var i=n("../node_modules/@tencent/containerized/build/main/index.js"),s=function(){function e(e,t,n,s){(0,i.wi)(this),this._node=e,this._type=t,this._handler=n,this._options=s||!1,this._node.addEventListener(this._type,this._handler,this._options),this.disposableId=t+" DOMListener"}return e.prototype.dispose=function(){(0,i.jz)(this),this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)},e}();function o(e,t,n,i){return new s(e,t,n,i)}},"../packages/lib/event/index.ts":function(e,t,n){"use strict";n.d(t,{Q:function(){return l},j:function(){return u}}),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/regenerator-runtime/runtime.js"),function e(t){this.element=t,this.next=e.Undefined,this.prev=e.Undefined});s.Undefined=new s(void 0);var o=function(e){function t(){this._first=s.Undefined,this._last=s.Undefined,this._size=0}var n=t.prototype;return n.isEmpty=function(){return this._first===s.Undefined},n.clear=function(){this._first=s.Undefined,this._last=s.Undefined,this._size=0},n.unshift=function(e){return this._insert(e,!1)},n.push=function(e){return this._insert(e,!0)},n.shift=function(){if(this._first!==s.Undefined){var e=this._first.element;return this._remove(this._first),e}},n.pop=function(){if(this._last!==s.Undefined){var e=this._last.element;return this._remove(this._last),e}},n[e]=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this._first;case 1:if(t===s.Undefined){e.next=7;break}return e.next=4,t.element;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)})),n.toArray=function(){for(var e=[],t=this._first;t!==s.Undefined;t=t.next)e.push(t.element);return e},n._insert=function(e,t){var n=this,i=new s(e);if(this._first===s.Undefined)this._first=i,this._last=i;else if(t){var o=this._last;this._last=i,i.prev=o,o.next=i}else{var r=this._first;this._first=i,i.next=r,r.prev=i}this._size+=1;var a=!1;return function(){a||(a=!0,n._remove(i))}},n._remove=function(e){if(e.prev!==s.Undefined&&e.next!==s.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===s.Undefined&&e.next===s.Undefined?(this._first=s.Undefined,this._last=s.Undefined):e.next===s.Undefined?(this._last=this._last.prev,this._last.next=s.Undefined):e.prev===s.Undefined&&(this._first=this._first.next,this._first.prev=s.Undefined);this._size-=1},(0,i.Z)(t,[{key:"size",get:function(){return this._size}}]),t}(Symbol.iterator),r=n("../node_modules/@tencent/containerized/build/main/index.js");function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var u,l=function(){function e(e){this._disposed=!1,this._options=e}var t=e.prototype;return t.fire=function(e){if(this._listeners){this._deliveryQueue||(this._deliveryQueue=new o);for(var t,n=a(this._listeners);!(t=n()).done;){var i=t.value;this._deliveryQueue.push([i,e])}for(;this._deliveryQueue.size>0;){var s=this._deliveryQueue.shift(),r=s[0],d=s[1];try{"function"===typeof r?r.call(void 0,d):r[0].call(r[1],d)}catch(u){console.error(u)}}}},t.dispose=function(){this._listeners&&this._listeners.clear(),this._deliveryQueue&&this._deliveryQueue.clear(),this._disposed=!0},(0,i.Z)(e,[{key:"event",get:function(){var e=this;return this._event||(this._event=function(t,n,i){var s,a,d;e._listeners||(e._listeners=new o);var u=e._listeners.isEmpty();u&&(null===(s=e._options)||void 0===s?void 0:s.onFirstListenerAdd)&&e._options.onFirstListenerAdd(e);var l=e._listeners.push(n?[t,n]:t);u&&(null===(a=e._options)||void 0===a?void 0:a.onFirstListenerDidAdd)&&e._options.onFirstListenerDidAdd(e),(null===(d=e._options)||void 0===d?void 0:d.onListenerDidAdd)&&e._options.onListenerDidAdd(e,t,n);var h={dispose:function(){var t;e._disposed||(l(),(null===(t=e._options)||void 0===t?void 0:t.onLastListenerRemove)&&(e._listeners&&!e._listeners.isEmpty()||e._options.onLastListenerRemove(e))),(0,r.jz)(h)},disposableId:"event"};return Array.isArray(i)&&i.push(h),(0,r.wi)(h),h}),this._event}}]),e}();!function(e){function t(e){return function(t,n,i){void 0===n&&(n=null);var s=!1,o=e((function(e){if(!s)return o?o.dispose():s=!0,t.call(n,e)}),null,i);return s&&o.dispose(),o}}e.once=t,e.signal=function(e){return e},e.buffer=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=[]);var i=n.slice(),s=e((function(e){i?i.push(e):r.fire(e)})),o=function(){i&&i.forEach((function(e){return r.fire(e)})),i=null},r=new l({onFirstListenerAdd:function(){s||(s=e((function(e){return r.fire(e)})))},onFirstListenerDidAdd:function(){i&&(t?setTimeout(o):o())},onLastListenerRemove:function(){s&&s.dispose(),s=null}});return r.event},e.fromPromise=function(e){var t=new l,n=!1;return e.then(void 0,(function(){return null})).then((function(){n?t.fire(void 0):setTimeout((function(){return t.fire(void 0)}),0)})),n=!0,t.event},e.toPromise=function(e){return new Promise((function(n){return t(e)(n)}))}}(u||(u={}))},"../packages/lib/global.ts":function(e,t,n){"object"!==typeof n.g&&(Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.global=__magic__,Object.prototype.__magic__=void 0)},"../packages/lib/index.ts":function(e,t,n){"use strict";n.d(t,{Q5:function(){return s.Q},ju:function(){return s.j},vp:function(){return i.Z}}),n("../packages/lib/global.ts"),n("../packages/lib/Keyboard.ts");var i=n("../packages/lib/EventEmitter.ts"),s=n("../packages/lib/event/index.ts");n("../packages/lib/dom.ts"),n("../node_modules/@tencent/containerized/build/main/index.js")},"../packages/model/src/filter-view/utils/formula-util.ts":function(e,t,n){"use strict";n.d(t,{o:function(){return a}}),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var i=n("../node_modules/i18next/dist/esm/i18next.js"),s=n("../packages/model/src/range/index.ts");function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(e,t,n,r){if(!function(e,t,n,i){var o=e.activeSheet;if(!o)return!1;var r=o.filterViewManager.getActiveFilterView(),a=i.getFormula();if(!r||!a)return!1;var d=r.getBasicFilter();if(!d||!d.sortSpecs.length)return!1;var u=o.getSheetId(),l=new s.GridRange(u,t,t,n,n);return!!d.range.isCross(l)}(e,t,n,r))return null;for(var a,d=r.getFormula().getAllCellRangeWithFixedInfo(),u=e.activeSheet,l=u.getSheetId(),h=u.filterViewManager.getActiveFilterView().getBasicFilter(),c=o(d);!(a=c()).done;){var I=a.value,f=I.getAbsoluteStartRow(t),m=I.getAbsoluteEndRow(t),g=I.getAbsoluteStartCol(n),p=I.getAbsoluteEndCol(n),R=I.isStartRowRelative||I.isEndRowRelative||I.isStartColRelative||I.isEndColRelative,x=new s.GridRange(l,f,m,g,p);if(R&&!h.range.isCross(x))return{title:i.ZP.t("提示"),message:i.ZP.t("排序后, 函数引用位置会随相对位置变化")}}return null}},"../packages/model/src/filter-view/utils/protect-range-util.ts":function(e,t,n){"use strict";n.d(t,{J:function(){return o},z:function(){return s}}),n("../node_modules/core-js/modules/web.dom-collections.for-each.js");var i=n("../packages/model/src/filter-view/filter-view-util.ts");function s(e,t){var n=e.activeSheet.getFilterViewsInSheet(),i=[];return n.forEach((function(e){var n,s,o=null===(n=e.getBasicFilter())||void 0===n?void 0:n.range,r=null===(s=e.getBasicFilter())||void 0===s?void 0:s.sortSpecs;r&&r.length>0&&(null===o||void 0===o?void 0:o.isCross(t))&&i.push(e.getFilterViewName())})),i}var o=function(e){var t,n=e.activeSheetId,s=(0,i.xJ)(e),o=[];if(!s)return o.length>0;var r=null===(t=e.activeSheet.getBasicFilter())||void 0===t?void 0:t.range;return r?(e.workbookRangeManager.protectedRangeMap.forEach((function(e){if(e.range.sheetId===n){var t=e.range.clone();t.isCross(r)&&o.push(t)}})),o.length>0):o.length>0}},"../packages/model/src/filter/condition-utils.ts":function(e,t,n){"use strict";n.d(t,{NP:function(){return l},Zf:function(){return c},cL:function(){return I},l9:function(){return h}}),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var i=n("../node_modules/i18next/dist/esm/i18next.js"),s=n("../node_modules/@tencent/dui/lib/components/Modal/index.js"),o=n("../node_modules/@tencent/dui-mobile/lib/components/Snackbar/index.js"),r=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),a=n.n(r),d=n("../packages/model/src/rule/index.ts"),u=n("../spread-sheet/src/core/view/level-2/condition-format-center/condition-type-data/ConditionTypeMap.ts"),l="NONE_OPTION_KEY";function h(e){var t=[],n=e.conditionType,i=e.inputOne,s=e.inputTwo;return i&&t.push(new d.ConditionValue({type:d.ARG_TOKEN_TYPE.VALUE_TOKEN,userEnteredValue:i})),s&&t.push(new d.ConditionValue({type:d.ARG_TOKEN_TYPE.VALUE_TOKEN,userEnteredValue:s})),new d.BooleanCondition({type:n,values:t})}function c(e){var t,n,i,s=e.type,o=e.values;return(null===(t=u.Z[s])||void 0===t?void 0:t.hasInputOne())?{conditionType:s,inputOne:(null===(n=o[0])||void 0===n?void 0:n.userEnteredValue)||"",inputTwo:(null===(i=o[1])||void 0===i?void 0:i.userEnteredValue)||null}:{conditionType:s,inputOne:null,inputTwo:null}}function I(e){var t=e.inputOne,n=e.inputTwo,r=e.conditionType;if(r===l)return!0;var d=u.Z[r].checkInputValid(t,n);return!d||(a().isMobilePhone?o.default.show({type:"error",message:d,duration:3e3}):s.default.confirm({title:i.ZP.t("条件筛选提示"),className:"conditiona-filter-error-dialog",content:d}),!1)}},"../packages/model/src/new-embedded/chart/TickPosition.ts":function(e,t){"use strict";var n;!function(e){e[e.NONE=0]="NONE",e[e.OUT=1]="OUT",e[e.IN=2]="IN"}(n||(n={})),t.Z=n},"../packages/mutation/src/Mutation.ts":function(e,t,n){"use strict";n("../node_modules/core-js/modules/esnext.global-this.js");var i=n("../packages/report/src/index.ts"),s=n("../packages/model/src/sheet/BaseSheet.ts"),o=n("../packages/model/src/index.ts"),r=n("../packages/mutation/src/config/report.ts"),a=n("../packages/mutation/src/config/version.ts"),d=n("../packages/common-utils/src/index.ts"),u=n("../packages/mutation/src/MutationId.ts"),l=n("../packages/mutation/src/MutationOperationType.ts"),h=n("../spread-sheet/src/base/config/report.ts"),c=function(){function e(e,t){void 0===t&&(t={}),this.id=e,this.version=(0,d.hj)(t.requestId)?t.version:a.Z.MUTATION_VER,this.requestId=(0,d.hj)(t.requestId)?t.requestId:-1,this.operationType=(0,d.hj)(t.operationType)?t.operationType:l.Z.LOCAL}var t=e.prototype;return t.setAffectedSheetId=function(e){},t.runOnWorkbook=function(e){},t.runOnFormulaModel=function(e){},t.checkSheetId=function(e){var t=this.getAffectedSheetId();if(t){var n=e.getSheetId()===t,i=n?void 0:"SheetId 不一致 "+e.getSheetId()+" != "+t;return n||this.runOnFormulaLayer(e),{isValid:n,errorMessage:i}}return{isValid:!0}},t.runOnFormulaLayer=function(e){},t.check=function(e){return{isValid:!0}},t.isMultiSheetMutation=function(){return!1},t.getAffectedGridRanges=function(){return[]},t.getSizeEstimate=function(){return 1},t.isNonPersistedLocalChange=function(){return!1},t.run=function(e,t){var n,i=[],s={isValid:!0};if(e instanceof o.Spreadsheet.Spreadsheet){this.checkAndRunOnWorkbook(e,t)&&(n=this.getAffectedSheetId());var r,a,d,u=this.getAffectedSheets(e);for(a=0,d=u.length;a<d&&(r=u[a],(s=this.checkAndRunOnSheet(r,t)).isValid);a++)i.push([r,t]);this.checkAndRunOnFormulaModel(e)}else s=this.checkAndRunOnSheet(e,t),i.push([e,t]);return{runResult:s,runCache:i,workbookWithSheetId:n,isMultiSheet:!1}},t.checkAndRunOnSheet=function(e,t){var o,a,d;if(!(e instanceof s.Z))return{isValid:!1,errorMessage:"sheet类型不是Model.Spreadsheet.Spreadsheet"};new Date;var l={isValid:!1,errorMessage:"默认错误"},c=!1;try{l=this.check(e)}catch(I){null===(o=n.g.log)||void 0===o||o.error("mutation",this,I),i.ZP.run(r.mz.CHECK_MUTATION_ERROR,this,I,l)}if(!(l=l.isValid?this.checkSheetId(e):l).isValid&&!t.ignoreCheck)return i.ZP.run(r.mz.CHECK_MUTATION_RESULT_ERROR,this,l),i.ZP.zzsStatus({attrid:h.ZZS_REPORT_ATTR.MUTATION_APPLY_TO_MODEL_ERROR,status:1,dimensions:t.isOffline?"offlineMsg":"onlineMsg"}),[u.ZP.SET_CELL_PROPERTIES_MUTATION,u.ZP.SET_RANGE_MUTATION].indexOf(this.id)>-1&&(null===(a=globalThis.log)||void 0===a||a.report(r.mz.CHECK_MUTATION_RESULT_ERROR)),l;try{this.runOnSheet(e)}catch(I){null===(d=n.g.log)||void 0===d||d.error("mutation","run mutation error",this.id,this.requestId,I),i.ZP.run(r.mz.RUN_MUTATION_ERROR,I,this),I.message&&0===I.message.indexOf("ApiCheckError")||(c=!0),i.ZP.zzsStatus({attrid:h.ZZS_REPORT_ATTR.MUTATION_APPLY_TO_MODEL_ERROR,status:1,dimensions:t.isOffline?"offlineMsg":"onlineMsg"})}return{isValid:!c,errorMessage:c?"有遇到mutation运行错误":void 0}},t.checkAndRunOnWorkbook=function(e,t){return this.runOnWorkbook(e)},t.checkAndRunOnFormulaModel=function(e){return this.runOnFormulaModel(e)},t.transform=function(e,t){var n,i=((n={})[u.ZP.INSERT_DIMENSION_MUTATION]="transformWithInsertDimensionMutation",n[u.ZP.DELETE_DIMENSION_MUTATION]="transformWithDeleteDimensionMutation",n[u.ZP.SET_DIMENSION_PROPERTIES_MUTATION]="transformWithSetDimensionPropertiesMutation",n[u.ZP.SET_RANGE_MUTATION]="transformWithSetRangeMutation",n[u.ZP.SET_CELL_PROPERTIES_MUTATION]="transformWithSetCellPropertiesMutation",n[u.ZP.MERGE_CELLS_MUTATION]="transformWithMergeCellsMutation",n[u.ZP.UNMERGE_CELLS_MUTATION]="transformWithUnmergeCellsMutation",n[u.ZP.DEFINE_FILTER_MUTATION]="transformWithDefineFilterMutation",n[u.ZP.DELETE_FILTER_MUTATION]="transformWithDeleteFilterMutation",n[u.ZP.UPDATE_FILTER_MUTATION]="transformWithUpdateFilterMutation",n[u.ZP.SWITCH_FILTER_SYNC_MUTATION]="transformWithSwitchFilterSyncMutation",n[u.ZP.ADD_EMBEDDED_OBJECT_MUTATION]="transformWithAddEmbeddedObjectMutation",n[u.ZP.DELETE_EMBEDDED_OBJECT_MUTATION]="transformWithDeleteEmbeddedObjectMutation",n[u.ZP.UPDATE_EMBEDDED_OBJECT_MUTATION]="transformWithUpdateEmbeddedObjectMutation",n[u.ZP.INSERT_SHEET_MUTATION]="transformWithInsertSheetMutation",n[u.ZP.DELETE_SHEET_MUTATION]="transformWithDeleteSheetMutation",n[u.ZP.MOVE_SHEET_MUTATION]="transformWithMoveSheetMutation",n[u.ZP.SET_SHEET_PROPERTIES_MUTATION]="transformWithSetSheetPropertiesMutation",n[u.ZP.UPDATE_ALL_SHEETS_MUTATION]="transformWithUpdateAllSheetsMutation",n[u.ZP.DEFINE_SHEET_RANGE_MUTATION]="transformWithDefineSheetRangeMutation",n[u.ZP.DELETE_SHEET_RANGE_MUTATION]="transformWithDeleteSheetRangeMutation",n[u.ZP.UPDATE_SHEET_RANGE_MUTATION]="transformWithUpdateSheetRangeMutation",n[u.ZP.SET_WORKBOOK_PROPERTIES_MUTATION]="transformWithSetWorkbookPropertiesMutation",n[u.ZP.COPY_PASTE_MUTATION]="transformWithCopyPasteMutation",n[u.ZP.REORDER_RANGE_MUTATION]="transformWithReorderRangeMutation",n[u.ZP.MAP_RANGE_MUTATION]="transformWithMapRangeMutation",n[u.ZP.EMPTY_MUTATION]="transformWithEmptyMutation",n[u.ZP.ADD_CONDITIONAL_FORMAT_MUTATION]="transformWithAddConditionalFormatMutation",n[u.ZP.DELETE_CONDITIONAL_FORMAT_MUTATION]="transformWithDeleteConditionalFormatMutation",n[u.ZP.UPDATE_CONDITIONAL_FORMAT_MUTATION]="transformWithUpdateConditionalFormatMutation",n[u.ZP.DEFINE_WORKBOOK_RANGE_MUTATION]="transformWithDefineWorkbookRangeMutation",n[u.ZP.UPDATE_WORKBOOK_RANGE_MUTATION]="transformWithUpdateWorkbookRangeMutation",n[u.ZP.DELETE_WORKBOOK_RANGE_MUTATION]="transformWithDeleteWorkbookRangeMutation",n[u.ZP.NEW_ADD_EMBEDDED_OBJECT_MUTATION]="transformWithNewAddEmbeddedObjectMutation",n[u.ZP.NEW_DELETE_EMBEDDED_OBJECT_MUTATION]="transformWithNewDeleteEmbeddedObjectMutation",n[u.ZP.NEW_UPDATE_EMBEDDED_OBJECT_MUTATION]="transformWithNewUpdateEmbeddedObjectMutation",n[u.ZP.ADD_FILTER_VIEW_MUTATION]="transformWithAddFilterViewMutation",n[u.ZP.DELETE_FILTER_VIEW_MUTATION]="transformWithDeleteFilterViewMutation",n[u.ZP.UPDATE_FILTER_VIEW_MUTATION]="transformWithUpdateFilterViewMutation",n[u.ZP.ACTIVE_FILTER_VIEW_MUTATION]="transformWithActiveFilterViewMutation",n);if(i[e.id])return this[i[e.id]](e,t);throw new Error("Should not have tried transforming the two mutations: "+this.id+","+e.id)},t.transformWithInsertDimensionMutation=function(e,t){return[this]},t.transformWithDeleteDimensionMutation=function(e,t){return[this]},t.transformWithSetDimensionPropertiesMutation=function(e,t){return[this]},t.transformWithSetRangeMutation=function(e,t){return[this]},t.transformWithSetCellPropertiesMutation=function(e,t){return[this]},t.transformWithMergeCellsMutation=function(e,t){return[this]},t.transformWithUnmergeCellsMutation=function(e,t){return[this]},t.transformWithDefineFilterMutation=function(e,t){return[this]},t.transformWithDeleteFilterMutation=function(e,t){return[this]},t.transformWithUpdateFilterMutation=function(e,t){return[this]},t.transformWithSwitchFilterSyncMutation=function(e,t){return[this]},t.transformWithAddEmbeddedObjectMutation=function(e,t){return[this]},t.transformWithDeleteEmbeddedObjectMutation=function(e,t){return[this]},t.transformWithUpdateEmbeddedObjectMutation=function(e,t){return[this]},t.transformWithInsertSheetMutation=function(e,t){return[this]},t.transformWithDeleteSheetMutation=function(e,t){return[this]},t.transformWithMoveSheetMutation=function(e,t){return[this]},t.transformWithSetSheetPropertiesMutation=function(e,t){return[this]},t.transformWithUpdateAllSheetsMutation=function(e,t){return[this]},t.transformWithDefineSheetRangeMutation=function(e,t){return[this]},t.transformWithDeleteSheetRangeMutation=function(e,t){return[this]},t.transformWithUpdateSheetRangeMutation=function(e,t){return[this]},t.transformWithSetWorkbookPropertiesMutation=function(e,t){return[this]},t.transformWithCopyPasteMutation=function(e,t){return[this]},t.transformWithReorderRangeMutation=function(e,t){return[this]},t.transformWithMapRangeMutation=function(e,t){return[this]},t.transformWithEmptyMutation=function(e,t){return[this]},t.transformWithAddConditionalFormatMutation=function(e,t){return[this]},t.transformWithDeleteConditionalFormatMutation=function(e,t){return[this]},t.transformWithUpdateConditionalFormatMutation=function(e,t){return[this]},t.transformWithDefineWorkbookRangeMutation=function(e,t){return[this]},t.transformWithUpdateWorkbookRangeMutation=function(e,t){return[this]},t.transformWithDeleteWorkbookRangeMutation=function(e,t){return[this]},t.transformWithNewAddEmbeddedObjectMutation=function(e,t){return[this]},t.transformWithNewDeleteEmbeddedObjectMutation=function(e,t){return[this]},t.transformWithNewUpdateEmbeddedObjectMutation=function(e,t){return[this]},t.transformWithAddFilterViewMutation=function(e,t){return[this]},t.transformWithDeleteFilterViewMutation=function(e,t){return[this]},t.transformWithUpdateFilterViewMutation=function(e,t){return[this]},t.transformWithActiveFilterViewMutation=function(e,t){return[this]},e}();t.Z=c},"../packages/mutation/src/MutationId.ts":function(e,t,n){"use strict";var i;n.d(t,{$z:function(){return s},p0:function(){return o}}),function(e){e[e.INSERT_DIMENSION_MUTATION=0]="INSERT_DIMENSION_MUTATION",e[e.DELETE_DIMENSION_MUTATION=1]="DELETE_DIMENSION_MUTATION",e[e.SET_DIMENSION_PROPERTIES_MUTATION=2]="SET_DIMENSION_PROPERTIES_MUTATION",e[e.SET_RANGE_MUTATION=3]="SET_RANGE_MUTATION",e[e.SET_CELL_PROPERTIES_MUTATION=4]="SET_CELL_PROPERTIES_MUTATION",e[e.MERGE_CELLS_MUTATION=5]="MERGE_CELLS_MUTATION",e[e.UNMERGE_CELLS_MUTATION=6]="UNMERGE_CELLS_MUTATION",e[e.UPDATE_FILTERS_MODEL_MUTATION=7]="UPDATE_FILTERS_MODEL_MUTATION",e[e.ADD_EMBEDDED_OBJECT_MUTATION=8]="ADD_EMBEDDED_OBJECT_MUTATION",e[e.DELETE_EMBEDDED_OBJECT_MUTATION=9]="DELETE_EMBEDDED_OBJECT_MUTATION",e[e.UPDATE_EMBEDDED_OBJECT_MUTATION=10]="UPDATE_EMBEDDED_OBJECT_MUTATION",e[e.INSERT_SHEET_MUTATION=11]="INSERT_SHEET_MUTATION",e[e.DELETE_SHEET_MUTATION=12]="DELETE_SHEET_MUTATION",e[e.MOVE_SHEET_MUTATION=13]="MOVE_SHEET_MUTATION",e[e.SET_SHEET_PROPERTIES_MUTATION=14]="SET_SHEET_PROPERTIES_MUTATION",e[e.UPDATE_ALL_SHEETS_MUTATION=15]="UPDATE_ALL_SHEETS_MUTATION",e[e.DEFINE_SHEET_RANGE_MUTATION=16]="DEFINE_SHEET_RANGE_MUTATION",e[e.DELETE_SHEET_RANGE_MUTATION=17]="DELETE_SHEET_RANGE_MUTATION",e[e.UPDATE_SHEET_RANGE_MUTATION=18]="UPDATE_SHEET_RANGE_MUTATION",e[e.SET_WORKBOOK_PROPERTIES_MUTATION=19]="SET_WORKBOOK_PROPERTIES_MUTATION",e[e.INIT_DATA_MUTATION=20]="INIT_DATA_MUTATION",e[e.COPY_PASTE_MUTATION=21]="COPY_PASTE_MUTATION",e[e.REORDER_RANGE_MUTATION=22]="REORDER_RANGE_MUTATION",e[e.MAP_RANGE_MUTATION=23]="MAP_RANGE_MUTATION",e[e.DEFINE_FILTER_MUTATION=24]="DEFINE_FILTER_MUTATION",e[e.DELETE_FILTER_MUTATION=25]="DELETE_FILTER_MUTATION",e[e.UPDATE_FILTER_MUTATION=26]="UPDATE_FILTER_MUTATION",e[e.EMPTY_MUTATION=27]="EMPTY_MUTATION",e[e.ADD_CONDITIONAL_FORMAT_MUTATION=28]="ADD_CONDITIONAL_FORMAT_MUTATION",e[e.DELETE_CONDITIONAL_FORMAT_MUTATION=29]="DELETE_CONDITIONAL_FORMAT_MUTATION",e[e.UPDATE_CONDITIONAL_FORMAT_MUTATION=30]="UPDATE_CONDITIONAL_FORMAT_MUTATION",e[e.DEFINE_WORKBOOK_RANGE_MUTATION=31]="DEFINE_WORKBOOK_RANGE_MUTATION",e[e.UPDATE_WORKBOOK_RANGE_MUTATION=32]="UPDATE_WORKBOOK_RANGE_MUTATION",e[e.DELETE_WORKBOOK_RANGE_MUTATION=33]="DELETE_WORKBOOK_RANGE_MUTATION",e[e.NEW_ADD_EMBEDDED_OBJECT_MUTATION=34]="NEW_ADD_EMBEDDED_OBJECT_MUTATION",e[e.NEW_DELETE_EMBEDDED_OBJECT_MUTATION=35]="NEW_DELETE_EMBEDDED_OBJECT_MUTATION",e[e.NEW_UPDATE_EMBEDDED_OBJECT_MUTATION=36]="NEW_UPDATE_EMBEDDED_OBJECT_MUTATION",e[e.SWITCH_FILTER_SYNC_MUTATION=37]="SWITCH_FILTER_SYNC_MUTATION",e[e.ADD_FILTER_VIEW_MUTATION=38]="ADD_FILTER_VIEW_MUTATION",e[e.DELETE_FILTER_VIEW_MUTATION=39]="DELETE_FILTER_VIEW_MUTATION",e[e.UPDATE_FILTER_VIEW_MUTATION=40]="UPDATE_FILTER_VIEW_MUTATION",e[e.ACTIVE_FILTER_VIEW_MUTATION=41]="ACTIVE_FILTER_VIEW_MUTATION",e[e.Sheet_Max_MUTATION_Id=999]="Sheet_Max_MUTATION_Id"}(i||(i={}));var s=[i.SWITCH_FILTER_SYNC_MUTATION,i.DEFINE_WORKBOOK_RANGE_MUTATION,i.UPDATE_WORKBOOK_RANGE_MUTATION,i.DELETE_WORKBOOK_RANGE_MUTATION,i.EMPTY_MUTATION,i.INIT_DATA_MUTATION,i.DEFINE_SHEET_RANGE_MUTATION,i.DELETE_SHEET_RANGE_MUTATION,i.UPDATE_SHEET_RANGE_MUTATION,i.SET_WORKBOOK_PROPERTIES_MUTATION,i.INSERT_SHEET_MUTATION,i.DELETE_SHEET_MUTATION,i.MOVE_SHEET_MUTATION,i.UPDATE_ALL_SHEETS_MUTATION],o=[i.DEFINE_SHEET_RANGE_MUTATION,i.DELETE_SHEET_RANGE_MUTATION,i.UPDATE_SHEET_RANGE_MUTATION,i.SET_WORKBOOK_PROPERTIES_MUTATION,i.ADD_CONDITIONAL_FORMAT_MUTATION,i.DELETE_CONDITIONAL_FORMAT_MUTATION,i.UPDATE_CONDITIONAL_FORMAT_MUTATION,i.DEFINE_WORKBOOK_RANGE_MUTATION,i.UPDATE_WORKBOOK_RANGE_MUTATION,i.DELETE_WORKBOOK_RANGE_MUTATION,i.NEW_ADD_EMBEDDED_OBJECT_MUTATION,i.NEW_DELETE_EMBEDDED_OBJECT_MUTATION,i.NEW_UPDATE_EMBEDDED_OBJECT_MUTATION,i.SET_DIMENSION_PROPERTIES_MUTATION];t.ZP=i},"../packages/mutation/src/MutationOperationType.ts":function(e,t){"use strict";var n;!function(e){e[e.HISTORY=-1]="HISTORY",e[e.LOCAL=0]="LOCAL",e[e.UNDO=1]="UNDO",e[e.REDO=2]="REDO",e[e.COLLAB=3]="COLLAB"}(n||(n={})),t.Z=n},"../packages/mutation/src/SlotOperation.ts":function(e,t){"use strict";var n;!function(e){e[e.SET_SLOT=0]="SET_SLOT",e[e.CLEAR_SLOT=1]="CLEAR_SLOT",e[e.ADD_SLOT=2]="ADD_SLOT",e[e.REMOVE_SLOT=3]="REMOVE_SLOT"}(n||(n={})),t.Z=n},"../packages/mutation/src/api.interface.ts":function(e,t,n){"use strict";n.d(t,{D:function(){return i}});var i=(0,n("../node_modules/@tencent/containerized/build/main/index.js").yh)("IMutationBehavior")},"../packages/mutation/src/api.ts":function(e,t,n){"use strict";n.d(t,{Z:function(){return se}});var i,s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../packages/lib/EventEmitter.ts")),r=n("../packages/report/src/index.ts"),a=n("../packages/model/src/index.ts"),d=n("../packages/mutation/src/config/report.ts"),u=n("../packages/mutation/src/config/version.ts"),l=n("../packages/mutation/src/utils/index.ts"),h=n("../packages/mutation/src/MutationId.ts"),c=[{verLowestSupport:3,verTarget:6,convert:function(e){return e}}],I=function(e,t){var n,i,s;for(void 0===t&&(t=u.Z.MUTATION_VER),n=0,i=c.length;n<i&&(s=c[n],!(e.v>=t));n++)e.v>=s.verLowestSupport&&e.v<s.verTarget&&(e=s.convert(e));return e},f=n("../packages/mutation/src/transform.ts"),m=n("../packages/mutation/src/dimension/InsertDimensionMutation.ts"),g=n("../packages/mutation/src/dimension/DeleteDimensionMutation.ts"),p=n("../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts"),R=n("../packages/mutation/src/cell/SetRangeMutation.ts"),x=n("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),E=n("../packages/mutation/src/merge/MergeCellsMutation.ts"),T=n("../packages/mutation/src/merge/UnmergeCellsMutation.ts"),S=n("../packages/mutation/src/embedded/AddEmbeddedObjectMutation.ts"),_=n("../packages/mutation/src/embedded/DeleteEmbeddedObjectMutation.ts"),w=n("../packages/mutation/src/embedded/UpdateEmbeddedObjectMutation.ts"),v=n("../packages/mutation/src/sheet/InsertSheetMutation.ts"),M=n("../packages/mutation/src/sheet/DeleteSheetMutation.ts"),D=n("../packages/mutation/src/sheet/MoveSheetMutation.ts"),O=n("../packages/mutation/src/sheet/SetSheetPropertiesMutation.ts"),C=n("../packages/mutation/src/sheet/DefineSheetRangeMutation.ts"),y=n("../packages/mutation/src/sheet/DeleteSheetRangeMutation.ts"),k=n("../packages/mutation/src/sheet/UpdateSheetRangeMutation.ts"),A=n("../packages/mutation/src/other/InitDataMutation.ts"),b=n("../packages/mutation/src/other/CopyPasteMutation.ts"),N=n("../packages/mutation/src/other/ReorderRangeMutation.ts"),j=n("../packages/mutation/src/other/MapRangeMutation.ts"),P=n("../packages/mutation/src/filter/DefineFilterMutation.ts"),L=n("../packages/mutation/src/filter/DeleteFilterMutation.ts"),U=n("../packages/mutation/src/filter/UpdateFilterMutation.ts"),F=n("../packages/mutation/src/filter/SwitchFilterSyncMutation.ts"),W=n("../packages/mutation/src/other/EmptyMutation.ts"),Z=n("../packages/mutation/src/conditionalFormat/AddConditionalFormatMutation.ts"),V=n("../packages/mutation/src/conditionalFormat/DeleteConditionalFormatMutation.ts"),B=n("../packages/mutation/src/conditionalFormat/UpdateConditionalFormatMutation.ts"),z=n("../packages/mutation/src/workbook/workbookRange/DefineWorkbookRangeMutation.ts"),G=n("../packages/mutation/src/workbook/workbookRange/UpdateWorkbookRangeMutation.ts"),H=n("../packages/mutation/src/workbook/workbookRange/DeleteWorkbookRangeMutation.ts"),K=n("../packages/mutation/src/workbook/SetWorkbookPropertiesMutation.ts"),Y=n("../packages/mutation/src/new-embedded/NewAddEmbeddedObjectMutation.ts"),J=n("../packages/mutation/src/new-embedded/NewDeleteEmbeddedObjectMutation.ts"),q=n("../packages/mutation/src/new-embedded/NewUpdateEmbeddedObjectMutation.ts"),X=n("../packages/mutation/src/filter-view/add-filter-view-mutation.ts"),Q=n("../packages/mutation/src/filter-view/delete-filter-view-mutation.ts"),$=n("../packages/mutation/src/filter-view/update-filter-view-mutation.ts"),ee=n("../packages/mutation/src/filter-view/active-filter-view-mutation.ts"),te=n("../spread-sheet/src/core/behavior/multi-type-follow.ts"),ne=a.Utils.serializeUtils;!function(e){e[e.Workbook=1]="Workbook",e[e.Sheet=2]="Sheet"}(i||(i={}));var ie=function(){function e(){this.emitter=new o.Z}var t=e.prototype;return t.serializeMutation=function(e){var t,i={t:e.id,v:e.version,c:[],r:e.requestId,o:e.operationType};try{e.version<5&&(i.v=u.Z.MUTATION_VER_LOWEST_SUPPORT),i.c=this._serializeMutation(e)}catch(s){null===(t=n.g.log)||void 0===t||t.error("mutation","serialize error",e,s),r.ZP.run(d.mz.SERIALIZE_MUTATION,[e],s)}return i},t.deserializeMutation=function(t){var n;if(t.v>u.Z.MUTATION_VER)return this.emitter.emit(e.EVENT.DATA_VERSION_TOO_LOW,t.v),null;if(t.v<u.Z.MUTATION_VER_LOWEST_SUPPORT)return console.error("mutation version is lower than support",t),r.ZP.monitor(d.lv.MUTATION_VER_LOWER_THAN_SUPPORT),null;if(t.v<u.Z.MUTATION_VER&&t.v>=5)try{t=I(t)}catch(o){return console.error("convert mutation error: ",t,o),r.ZP.monitor(d.lv.CONVERT_MUTATION_ERROR),null}var i=((n={})[h.ZP.INSERT_DIMENSION_MUTATION]=m.Z,n[h.ZP.DELETE_DIMENSION_MUTATION]=g.Z,n[h.ZP.SET_DIMENSION_PROPERTIES_MUTATION]=p.ZP,n[h.ZP.SET_RANGE_MUTATION]=R.Z,n[h.ZP.SET_CELL_PROPERTIES_MUTATION]=x.Z,n[h.ZP.MERGE_CELLS_MUTATION]=E.Z,n[h.ZP.UNMERGE_CELLS_MUTATION]=T.Z,n[h.ZP.UPDATE_FILTERS_MODEL_MUTATION]=W.Z,n[h.ZP.ADD_EMBEDDED_OBJECT_MUTATION]=S.Z,n[h.ZP.DELETE_EMBEDDED_OBJECT_MUTATION]=_.Z,n[h.ZP.UPDATE_EMBEDDED_OBJECT_MUTATION]=w.Z,n[h.ZP.INSERT_SHEET_MUTATION]=v.Z,n[h.ZP.DELETE_SHEET_MUTATION]=M.Z,n[h.ZP.MOVE_SHEET_MUTATION]=D.Z,n[h.ZP.SET_SHEET_PROPERTIES_MUTATION]=O.Z,n[h.ZP.UPDATE_ALL_SHEETS_MUTATION]=W.Z,n[h.ZP.DEFINE_SHEET_RANGE_MUTATION]=C.Z,n[h.ZP.DELETE_SHEET_RANGE_MUTATION]=y.Z,n[h.ZP.UPDATE_SHEET_RANGE_MUTATION]=k.Z,n[h.ZP.SET_WORKBOOK_PROPERTIES_MUTATION]=K.Z,n[h.ZP.INIT_DATA_MUTATION]=A.Z,n[h.ZP.COPY_PASTE_MUTATION]=b.Z,n[h.ZP.REORDER_RANGE_MUTATION]=N.Z,n[h.ZP.MAP_RANGE_MUTATION]=j.Z,n[h.ZP.DEFINE_FILTER_MUTATION]=P.ZP,n[h.ZP.DELETE_FILTER_MUTATION]=L.Z,n[h.ZP.UPDATE_FILTER_MUTATION]=U.ZP,n[h.ZP.SWITCH_FILTER_SYNC_MUTATION]=F.Z,n[h.ZP.EMPTY_MUTATION]=W.Z,n[h.ZP.ADD_CONDITIONAL_FORMAT_MUTATION]=Z.Z,n[h.ZP.DELETE_CONDITIONAL_FORMAT_MUTATION]=V.Z,n[h.ZP.UPDATE_CONDITIONAL_FORMAT_MUTATION]=B.Z,n[h.ZP.DEFINE_WORKBOOK_RANGE_MUTATION]=z.Z,n[h.ZP.UPDATE_WORKBOOK_RANGE_MUTATION]=G.Z,n[h.ZP.DELETE_WORKBOOK_RANGE_MUTATION]=H.Z,n[h.ZP.NEW_ADD_EMBEDDED_OBJECT_MUTATION]=Y.Z,n[h.ZP.NEW_DELETE_EMBEDDED_OBJECT_MUTATION]=J.Z,n[h.ZP.NEW_UPDATE_EMBEDDED_OBJECT_MUTATION]=q.Z,n[h.ZP.ADD_FILTER_VIEW_MUTATION]=X.Z,n[h.ZP.DELETE_FILTER_VIEW_MUTATION]=Q.Z,n[h.ZP.UPDATE_FILTER_VIEW_MUTATION]=$.Z,n[h.ZP.ACTIVE_FILTER_VIEW_MUTATION]=ee.Z,n),s=null;try{i[t.t]?s=this._deserializeMutation(t,i[t.t]):(console.error("deserialize mutation fail: ",t),r.ZP.run(d.mz.DESERIALIZE_MUTATION_FAIL,[t,u.Z.MUTATION_VER_LOWEST_SUPPORT,u.Z.MUTATION_VER])),(s=s||new W.Z({sheetId:""})).version=t.v,s.requestId=t.r,s.operationType=t.o}catch(o){console.error(o),t.v>5?r.ZP.run(d.mz.DESERIALIZE_MUTATION_CATCH_ERROR,[t,u.Z.MUTATION_VER_LOWEST_SUPPORT,u.Z.MUTATION_VER],o):r.ZP.run(d.mz.DESERIALIZE_MUTATION_CATCH_ERROR_OLD,[t,u.Z.MUTATION_VER],o)}return s},t.getMutationDataSize=function(e){var t=this;try{var n=[];return null===e||void 0===e||e.forEach((function(e){var i=t.serializeMutation(e);n.push(i)})),JSON.stringify(n).length}catch(i){return console.error(i),-1}},t.getCollabMutations=function(e){var t=this;if("string"===typeof e)try{e=JSON.parse(e)}catch(i){throw r.ZP.run(d.mz.GET_COLLAB_MUTATIONS,[e,i]),i}var n=[];return Array.isArray(e)&&e.forEach((function(e){if(e&&e.v){var i=t.deserializeMutation(e);i&&n.push(i)}})),n},t.follow=function(e,t){var n,i,s,o,r=[],a=[],d=[];for(n=0,i=e.length;n<i;n++)(s=this.deserializeMutation(e[n]))&&a.push(s);for(n=0,i=t.length;n<i;n++)(o=this.deserializeMutation(t[n]))&&d.push(o);for(d=(0,f.v)(d,a,!0),n=0,i=t.length;n<i;n++)r.push(this.serializeMutation(d[n]));return r},t.followRequestMutations=function(e,t,n){void 0===n&&(n=!1);try{var i,s,o,a,u,l,h,c;for(i=0,a=e.length;i<a;i++){for(u=e[i],h=[],s=0,o=t.length;s<o;s++)l=t[s],c=(0,f.v)(l,u,!n),s<o-1&&(u=(0,f.v)(u,l,n)),h.push(c);t=h}return r.ZP.monitor(33641616),t}catch(I){throw r.ZP.run(d.mz.FOLLOW_REQUEST_MUTATIONS,[e,t,n,null===I||void 0===I?void 0:I.stack]),I}},t.followRequests=function(e,t,n){var i,s,o,a;void 0===n&&(n=!1);var d,u,h,c,I,f=!1;if(!(0,l.Ep)(e)||!(0,l.Ep)(t))return t;var m=[];for(i=0,a=e.length;i<a;i++){for(c=[],s=0,o=e[i].length;s<o;s++)(u=this.deserializeMutation(e[i][s]))?c.push(u):f=!0;m.push(c)}var g=[];for(i=0,a=t.length;i<a;i++){for(I=[],s=0,o=t[i].length;s<o;s++)(h=this.deserializeMutation(t[i][s]))?I.push(h):f=!0;g.push(I)}var p=this.followRequestMutations(m,g,n);return d=this.serializeRequests(p),f&&r.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_core",action:"followRequests",obj3:"requestsA: "+JSON.stringify(e||"")+"  requestsB: "+JSON.stringify(t||"")}),d},t.followChangeset=function(e,t,n){var i=this,s=JSON.parse(e).map((function(e){return e.map((function(e){return i.deserializeMutation(e)}))})),o=JSON.parse(t).map((function(e){return e.map((function(e){return i.deserializeMutation(e)}))})),r=this.followRequestMutations(s,o,n),a=[];return r.forEach((function(e){var t=[];e.forEach((function(e){var n=i.serializeMutation(e);t.push(n)})),a.push(t)})),JSON.stringify(a)},t.multiTypeFollowMutations=function(e,t,n){return(0,te.Xz)(e,t,n)},t.multiTypeFollowChangeset=function(e,t,n){return(0,te.hh)(e,t,n)},t.serializeRequests=function(e){for(var t,n,i=[],s=0,o=e.length;s<o;s++){n=e[s],i[s]=[];for(var r=0,a=n.length;r<a;r++)t=n[r],i[s].push(this.serializeMutation(t))}return i},t.deSerializeRequests=function(e){var t,n,i,s,o,r=[],a=[];for(t=0,s=e.length;t<s;t++){for(r=[],n=0,i=e[t].length;n<i;n++)(o=this.deserializeMutation(e[t][n]))&&a.push(o);r.push(a)}return r},t.applyMutation=function(t,s,o){var r;o||(o=n.g.SpreadsheetApp.spreadsheet);try{this.emitter.emit(e.EVENT.BEFORE_MUTATION_RUN,{mutation:t,isLocal:s.isLocal,isFromFormula:s.isFromFormula,isCollab:s.isCollab,isReplay:s.isReplay})}catch(g){null===(r=n.g.log)||void 0===r||r.error("mutation","BEFORE_MUTATION_RUN error.",null===g||void 0===g?void 0:g.stack)}var a=t.run(o,s),d=a.runResult,u=a.runCache,l=a.workbookWithSheetId,h=a.isMultiSheet;if(s.isIgnoreRender)return d;if(h)this.triggerRender(t,o,s,i.Workbook);else if(d.isValid){for(var c=!1,I=0,f=u.length;I<f;I++){var m=u[I][0];this.triggerRender(t,m,u[I][1],i.Sheet),l&&m.getSheetId()!==l||(c=!0)}c||this.triggerRender(t,o,s,i.Workbook)}return this.triggerDataChange(t),d},t.triggerRender=function(t,s,o,a){var u,l,h;a===i.Workbook?(l=s.type,h=t.getAffectedSheetId()):(l=s.spreadsheetReference.type,h=s.getSheetId());try{this.emitter.emit(e.EVENT.AFTER_MUTATION_RUN,{sheetId:h,mutation:t,sType:l,isLocal:o.isLocal,isFromFormula:o.isFromFormula,isCollab:o.isCollab,isReplay:o.isReplay,isIgnoreDataCallView:o.isIgnoreDataCallView})}catch(c){r.ZP.run(d.mz.AFTER_MUTATION_RUN_CATCH_ERROR,c,t),null===(u=n.g.log)||void 0===u||u.error("mutation","triggerRender AFTER_MUTATION_RUN error.",null===c||void 0===c?void 0:c.stack)}},t.triggerDataChange=function(t){var i;try{this.emitter.emit(e.EVENT.DATA_CHANGE,{type:"afterMutationRun"})}catch(s){return null===(i=n.g.log)||void 0===i||i.error("mutation","triggerDataChange DATA_CHANGE error.",null===s||void 0===s?void 0:s.stack),r.ZP.run(d.mz.AFTER_MUTATION_RUN_DATA_CHANGE_CATCH_ERROR,s,t),!1}},t._serializeMutation=function(e){return e.version>=5?e.serialize():ne.serialize(e,null,{notReplaceSheetId:!0})},t._deserializeMutation=function(e,t){return e.v>=5?t.deserialize(e.c):ne.deserialize(e.c,t,{notReplaceSheetId:!0})},(0,s.Z)(e,[{key:"EVENT",get:function(){return e.EVENT}}]),e}();ie.EVENT={DATA_VERSION_TOO_LOW:"DATA_VERSION_TOO_LOW",DATA_CHANGE:"DATA_CHANGE",BEFORE_MUTATION_RUN:"BEFORE_MUTATION_RUN",AFTER_MUTATION_RUN:"AFTER_MUTATION_RUN"};var se=ie},"../packages/mutation/src/cell/SetCellPropertiesMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.find.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/common-utils/src/index.ts"),r=n("../packages/mutation/src/MutationId.ts"),a=n("../packages/mutation/src/Mutation.ts"),d=n("../packages/mutation/src/cell/cellMutationUtils.ts"),u=n("../packages/mutation/src/cell/SetRangeMutation.ts"),l=n("../packages/mutation/src/merge/UnmergeCellsMutation.ts"),h=n("../packages/model/src/cell/cellDataUtils.ts"),c=(n("../spread-sheet/src/base/util/domain-config.ts"),n("../packages/model/src/cell/CellDataDelta.ts")),I=n("../packages/model/src/cell/CellDataDeltaPropertiesMap.ts"),f=n("../packages/model/src/cell/index.ts"),m=s.Dimension.DIMENSION_TYPE,g=s.Range.GridRange,p=s.Range.gridRangeUtils,R=function(e){function t(t){var n;return(n=e.call(this,r.ZP.SET_CELL_PROPERTIES_MUTATION,t)||this).gridRange=t.gridRange,n.cellDataDelta=t.cellDataDelta,n}(0,i.Z)(t,e),t.deserialize=function(e){var n=g.deserialize(e[0]),i=I.ZP.createPropertiesMap(e[2],n);return new t({gridRange:n,cellDataDelta:c.Z.deserialize(e[1],i)})};var n=t.prototype;return n.serialize=function(){var e=new I.ZP;return[this.gridRange.serialize(),this.cellDataDelta.serialize(e),e.serializedPropertiesMap]},n.getAffectedSheetId=function(){return this.gridRange.sheetId},n.setAffectedSheetId=function(e){this.gridRange.sheetId=e},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.gridRange.sheetId);return t?[t]:[]},n.check=function(t){var n=e.prototype.check.call(this,t);if(!n.isValid)return n;if(!this.gridRange||!this.cellDataDelta)return{isValid:!1,errorMessage:"GridRange为空 或者 cellDataDelta为空 gridRange="+JSON.stringify(this.gridRange)+" cellDataDelta="+JSON.stringify(this.cellDataDelta)};var i=this.gridRange,s=t.properties.gridProperties;return(0,o.hj)(i.startRowIndex)&&(0,o.hj)(i.endRowIndex)&&(0,o.hj)(i.startColIndex)&&(0,o.hj)(i.endColIndex)?i.startRowIndex<0||i.endRowIndex>=s.rowCount||i.startColIndex<0||i.endColIndex>=s.colCount?{isValid:!1,errorMessage:"gridRange 范围不正确。 gridRange="+JSON.stringify(i)+" gridProperties="+JSON.stringify(s)}:{isValid:!0}:{isValid:!1,errorMessage:"gridRange index类型不是数字 girdRange="+JSON.stringify(i)}},n.run=function(t,n){return this.runMutationOptions={isLocal:!1},Object.assign(this.runMutationOptions,n),e.prototype.run.call(this,t,n)},n.runOnSheet=function(e){var t,n;if(!this.cellDataDelta.isEmpty()){var i,s,o,r,a,d,u=this.cellDataDelta,l=this.gridRange,h=l.startRowIndex,c=l.endRowIndex,I=l.startColIndex,m=l.endColIndex;for(i=h,o=c;i<=o;i++)for(s=I,r=m;s<=r;s++)if((a=e.getCellDataAtPosition(i,s,{isIgnoreFilterView:!0}))&&0!==a.setSlots||0!==u.setSlots){var g=null===a||void 0===a?void 0:a.cloneMentionDetails(),p=null===a||void 0===a?void 0:a.getHyperlink();d=f.cellDataUtils.mergeDeltaToCellData(a,u),e.setCellDataAtPosition(i,s,d),e.mentionManager.updateMentions(g,(null===d||void 0===d?void 0:d.getMentionDetails())||void 0,i,s,{isReplay:null===(t=this.runMutationOptions)||void 0===t?void 0:t.isReplay,isCollab:null===(n=this.runMutationOptions)||void 0===n?void 0:n.isCollab}),e.hyperlinkManager.updateHyperlink(p?{rowIndex:i,colIndex:s}:null,(null===d||void 0===d?void 0:d.getHyperlink())?{rowIndex:i,colIndex:s,cellData:d}:null),e.dateReminderManager.updateDateReminder(a,d,i,s,this.runMutationOptions),e.todoManager.updateTodoRange(a,d,i,s)}}},n.runOnFormulaModel=function(e){if(!this.cellDataDelta.isEmpty()){for(var t=this.cellDataDelta,n=e.formulaModelManager,i=this.gridRange,s=i.startRowIndex,o=i.endRowIndex,r=i.startColIndex,a=i.endColIndex,d=this.getAffectedSheetId(),u=s,l=o;u<=l;u++)for(var h=r,c=a;h<=c;h++)0===t.setSlots&&0===t.clearSlots||(n.addFormulaData({row:u,col:h,sheetId:d},t),n.addDataValidationData({row:u,col:h,sheetId:d},t));n.updateFormulaModelManagerDataFinish()}},n.invert=function(e){var t,n,i,s,o,r,a,d,l,h=e.sheetManager.getSheetBySheetId(this.gridRange.sheetId),c=this.cellDataDelta,I=[],m=this.gridRange;if(!h)return[];var g=h.data;for(r=m.startRowIndex<0?g.startRow:m.startRowIndex,a=m.endRowIndex<0?h.getRowCount()-1:m.endRowIndex,d=m.startColIndex<0?g.startCol:m.startColIndex,l=m.endColIndex<0?h.getColCount()-1:m.endColIndex,t=r,i=a;t<=i;t++)for(n=d,s=l;n<=s;n++)o=h.getCellDataAtPosition(t,n,{isIgnoreFilterView:!0}),I.push({rowIndex:t,colIndex:n,cellDataDelta:f.cellDataUtils.invertCellDataDelta(o,c)});return[new u.Z({gridRange:this.gridRange,cellDataDeltaAtPositions:I})]},n.transformWithInsertDimensionMutation=function(e,n){if(this.gridRange.sheetId!==e.sheetId)return[this];var i,s,o=[];e.type===m.ROWS?e.index>this.gridRange.startRowIndex&&e.index<=this.gridRange.endRowIndex?(o.push(new g(this.gridRange.sheetId,this.gridRange.startRowIndex,e.index-1,this.gridRange.startColIndex,this.gridRange.endColIndex)),o.push(new g(this.gridRange.sheetId,e.index,this.gridRange.endRowIndex,this.gridRange.startColIndex,this.gridRange.endColIndex))):o.push(this.gridRange):e.index>this.gridRange.startColIndex&&e.index<=this.gridRange.endColIndex?(o.push(new g(this.gridRange.sheetId,this.gridRange.startRowIndex,this.gridRange.endRowIndex,this.gridRange.startColIndex,e.index-1)),o.push(new g(this.gridRange.sheetId,this.gridRange.startRowIndex,this.gridRange.endRowIndex,e.index,this.gridRange.endColIndex))):o.push(this.gridRange);var r=[],a=(0,d.M)(this.cellDataDelta,e);for(i=0,s=o.length;i<s;i++)o[i].insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),r.push(new t({gridRange:o[i],cellDataDelta:a}));return r},n.transformWithDeleteDimensionMutation=function(e,n){if(this.gridRange.sheetId!==e.sheetId)return[this];var i=this.gridRange.clone();return i.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),i.endRowIndex<i.startRowIndex||i.endColIndex<i.startColIndex?[]:[new t({gridRange:i,cellDataDelta:(0,d.M)(this.cellDataDelta,e)})]},n.transformWithSetRangeMutation=function(e,n){if(this.gridRange.sheetId!==e.gridRange.sheetId)return[this];var i,s;if(!this.gridRange.isCross(e.gridRange))return[this];var o,r,a=e.getTotalSlots();if(0===((this.cellDataDelta.setSlots|this.cellDataDelta.clearSlots)&(a.cellDataSetSlots|a.cellDataClearSlots)))return[this];var d,u=[],l=[];for(i=0,s=e.cellDataDeltaAtPositions.length;i<s;i++)o=e.cellDataDeltaAtPositions[i],this.gridRange.containCell(o.rowIndex,o.colIndex)&&(r=f.cellDataUtils.transformTwoCellDataDelta(this.cellDataDelta,o.cellDataDelta,n),d=new g(this.gridRange.sheetId,o.rowIndex,o.rowIndex,o.colIndex,o.colIndex),r.isEmpty()||u.push(new t({gridRange:d,cellDataDelta:r})),l.push(d));for(i=0,s=(l=p.divideGridRangeByCells(this.gridRange,l)).length;i<s;i++)u.push(new t({gridRange:l[i],cellDataDelta:this.cellDataDelta}));return u},n.transformWithSetCellPropertiesMutation=function(e,n){if(this.gridRange.sheetId!==e.gridRange.sheetId)return[this];var i,s;if(!this.gridRange.isCross(e.gridRange))return[this];if(0===((this.cellDataDelta.setSlots|this.cellDataDelta.clearSlots)&(e.cellDataDelta.setSlots|e.cellDataDelta.clearSlots)))return[this];var o=f.cellDataUtils.transformTwoCellDataDelta(this.cellDataDelta,e.cellDataDelta,n);if(e.gridRange.contain(this.gridRange))return o.isEmpty()?[]:[new t({gridRange:this.gridRange,cellDataDelta:o})];var r=this.gridRange.getCross(e.gridRange),a=[];o.isEmpty()||a.push(new t({gridRange:r,cellDataDelta:o}));var d=p.divideGridRangeByCells(this.gridRange,[r]);for(i=0,s=d.length;i<s;i++)a.push(new t({gridRange:d[i],cellDataDelta:this.cellDataDelta}));return a},n.transformWithMergeCellsMutation=function(e,n){if(this.gridRange.sheetId!==e.sheetId)return[this];var i,s;if(0===this.cellDataDelta.setSlots)return[this];var o,r=[];r.push(new g(e.sheetId,e.startRowIndex+1,e.endRowIndex,e.startColIndex,e.endColIndex)),r.push(new g(e.sheetId,e.startRowIndex,e.startRowIndex,e.startColIndex+1,e.endColIndex));var a=[];for(i=0,s=r.length;i<s;i++)(o=this.gridRange.getCross(r[i]))&&a.push(o);if(0===a.length)return[this];if(n)return[new l.Z({sheetId:e.sheetId,startRowIndex:e.startRowIndex,endRowIndex:e.endRowIndex,startColIndex:e.startColIndex,endColIndex:e.endColIndex})];var d=[];for(i=0,s=(a=p.divideGridRangeByCells(this.gridRange,a)).length;i<s;i++)d.push(new t({gridRange:a[i],cellDataDelta:this.cellDataDelta}));return d},n.transformWithDeleteSheetMutation=function(e,t){return this.gridRange.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithCopyPasteMutation=function(e,t){var n=this;if(this.gridRange.sheetId!==e.sheetId)return[this];if(t)return[this];var i=e.getAffectedGridRanges(),s=!1,o=[];if(i.forEach((function(e){e.isCross(n.gridRange)&&(s=!0,o.push(e.getCross(n.gridRange)))})),!s)return[this];var r=[],a=[],d=e.cellMask;o.forEach((function(e){e.each((function(e,t){var i={rowIndex:e,colIndex:t,cellDataDelta:(0,h.removeCrossSlotByMask)(n.cellDataDelta,d)};a.push(i)}))})),this.gridRange.each((function(e,t){a.find((function(n){return n.rowIndex===e&&n.colIndex===t}))||a.push({rowIndex:e,colIndex:t,cellDataDelta:n.cellDataDelta})}));var l=new u.Z({gridRange:this.gridRange,cellDataDeltaAtPositions:a});return r.push(l),r},n.transformWithReorderRangeMutation=function(e,n){if(this.gridRange.sheetId!==e.sheetId)return[this];var i,s,o=this.gridRange.getCross(e.range);if(!o)return[this];var r,a=p.divideGridRangeByCells(this.gridRange,[o]),u=[];for(i=0,s=a.length;i<s;i++)u.push(new t({gridRange:a[i],cellDataDelta:this.cellDataDelta}));var l=(0,d.M)(this.cellDataDelta,e),h=(0,d.L)(l);for(i=o.startRowIndex,s=o.endRowIndex;i<=s;i++)(r=e.getOrderResult(i))?(h.borders&&!h.borders.isEmpty()&&u.push(new t({gridRange:new g(o.sheetId,i,i,o.startColIndex,o.endColIndex),cellDataDelta:h.borders})),h.other&&!h.other.isEmpty()&&u.push(new t({gridRange:new g(o.sheetId,r,r,o.startColIndex,o.endColIndex),cellDataDelta:h.other}))):u.push(new t({gridRange:new g(o.sheetId,i,i,o.startColIndex,o.endColIndex),cellDataDelta:this.cellDataDelta}));return u},n.transformWithMapRangeMutation=function(e,n){if(this.gridRange.sheetId!==e.sourceSheetId)return[this];var i,s,o=(0,d.M)(this.cellDataDelta,e),r=this.gridRange.getCross(new g(e.sourceSheetId,-1===e.row.from.startIndex?0:e.row.from.startIndex,-1===e.row.from.endIndex?Number.MAX_VALUE:e.row.from.endIndex,-1===e.column.from.startIndex?0:e.column.from.startIndex,-1===e.column.from.endIndex?Number.MAX_VALUE:e.column.from.endIndex));if(!r)return[new t({gridRange:this.gridRange,cellDataDelta:o})];var a=[];a.push(new t({gridRange:r,cellDataDelta:new c.Z({clearSlots:f.CELL_DATA_SLOT_COMPOSE.ALL})}));var u=new g(this.gridRange.sheetId,-1===e.row.from.startIndex?r.startRowIndex:r.startRowIndex-e.row.from.startIndex+e.row.to,-1===e.row.from.startIndex?r.endRowIndex:r.endRowIndex-e.row.from.startIndex+e.row.to,-1===e.column.from.startIndex?r.startColIndex:r.startColIndex-e.column.from.startIndex+e.column.to,-1===e.column.from.startIndex?r.endColIndex:r.endColIndex-e.column.from.startIndex+e.column.to);a.push(new t({gridRange:u,cellDataDelta:o}));var l=p.divideGridRangeByCells(this.gridRange,[r]);for(i=0,s=l.length;i<s;i++)a.push(new t({gridRange:l[i],cellDataDelta:this.cellDataDelta}));return a},t}(a.Z);R.protoMap={0:{name:"gridRange",dataType:g},1:{name:"cellDataDelta",dataType:c.Z}},t.Z=R},"../packages/mutation/src/cell/SetRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../packages/common-utils/src/index.ts")),o=n("../packages/mutation/src/utils/index.ts"),r=n("../packages/mutation/src/MutationId.ts"),a=n("../packages/mutation/src/Mutation.ts"),d=n("../packages/mutation/src/cell/cellMutationUtils.ts"),u=n("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),l=n("../packages/mutation/src/merge/UnmergeCellsMutation.ts"),h=n("../packages/model/src/cell/cellDataUtils.ts"),c=n("../packages/model/src/range/GridRange.ts"),I=n("../packages/model/src/cell/CellDataDelta.ts"),f=n("../packages/model/src/cell/CellDataDeltaPropertiesMap.ts"),m=n("../packages/model/src/cell/index.ts"),g=n("../packages/model/src/range/index.ts"),p=(n("../spread-sheet/src/base/util/domain-config.ts"),{0:{name:"rowIndex",dataType:Number},1:{name:"colIndex",dataType:Number},2:{name:"cellDataDelta",dataType:I.Z}}),R=function(e){function t(t){var n;return(n=e.call(this,r.ZP.SET_RANGE_MUTATION,t)||this).gridRange=t.gridRange,n.cellDataDeltaAtPositions=t.cellDataDeltaAtPositions,n}(0,i.Z)(t,e),t.deserialize=function(e){var n,i,s,o,r,a=c.Z.deserialize(e[0]),d=Object.keys(e[1]),u=f.ZP.createPropertiesMap(e[2],a),l=a.endColIndex-a.startColIndex+1,h=[];for(o=0,r=d.length;o<r;o++)i=(n=+d[o])%l+a.startColIndex,s=Math.floor(n/l)+a.startRowIndex,h.push({rowIndex:s,colIndex:i,cellDataDelta:I.Z.deserialize(e[1][n],u)});return d=null,u=null,new t({gridRange:a,cellDataDeltaAtPositions:h})};var n=t.prototype;return n.serialize=function(){var e,t,n,i={},s=new f.ZP,o=this.gridRange.endColIndex-this.gridRange.startColIndex+1;for(t=0,n=this.cellDataDeltaAtPositions.length;t<n;t++)i[((e=this.cellDataDeltaAtPositions[t]).rowIndex-this.gridRange.startRowIndex)*o+(e.colIndex-this.gridRange.startColIndex)]=e.cellDataDelta.serialize(s);return[this.gridRange.serialize(),i,s.serializedPropertiesMap]},n.getSizeEstimate=function(){return this.cellDataDeltaAtPositions.length},n.getAffectedSheetId=function(){return this.gridRange.sheetId},n.setAffectedSheetId=function(e){this.gridRange.sheetId=e},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.gridRange.sheetId);return t?[t]:[]},n.check=function(t){var n=e.prototype.check.call(this,t);if(!n.isValid)return n;if(!this.gridRange||!this.cellDataDeltaAtPositions)return{isValid:!1,errorMessage:"GridRange为空 或者 cellDataDeltaAtPositions为空 gridRange="+JSON.stringify(this.gridRange)+" cellDataDeltaAtPositions="+JSON.stringify(this.cellDataDeltaAtPositions)};var i=this.gridRange,o=t.properties.gridProperties;return(0,s.hj)(i.startRowIndex)&&(0,s.hj)(i.endRowIndex)&&(0,s.hj)(i.startColIndex)&&(0,s.hj)(i.endColIndex)?i.startRowIndex<0||i.endRowIndex>=o.rowCount||i.startColIndex<0||i.endColIndex>=o.colCount?{isValid:!1,errorMessage:"gridRange 范围不正确。 gridRange="+JSON.stringify(i)+" gridProperties="+JSON.stringify(o)}:{isValid:!0}:{isValid:!1,errorMessage:"gridRange index类型不是数字 girdRange="+JSON.stringify(i)}},n.run=function(t,n){return this.runMutationOptions={isLocal:!1},Object.assign(this.runMutationOptions,n),e.prototype.run.call(this,t,n)},n.runOnSheet=function(e){var t,n,i,s,o,r,a,d,u;for(i=0,s=this.cellDataDeltaAtPositions.length;i<s;i++)if(o=this.cellDataDeltaAtPositions[i].rowIndex,r=this.cellDataDeltaAtPositions[i].colIndex,d=this.cellDataDeltaAtPositions[i].cellDataDelta,(a=e.getCellDataAtPosition(o,r,{isIgnoreFilterView:!0}))&&0!==a.setSlots||0!==d.setSlots){var l=null===a||void 0===a?void 0:a.cloneMentionDetails(),h=null===a||void 0===a?void 0:a.getHyperlink();u=m.cellDataUtils.mergeDeltaToCellData(a,d),e.setCellDataAtPosition(o,r,u),e.mentionManager.updateMentions(l,(null===u||void 0===u?void 0:u.getMentionDetails())||void 0,o,r,{isReplay:null===(t=this.runMutationOptions)||void 0===t?void 0:t.isReplay,isCollab:null===(n=this.runMutationOptions)||void 0===n?void 0:n.isCollab}),e.hyperlinkManager.updateHyperlink(h?{rowIndex:o,colIndex:r}:null,(null===u||void 0===u?void 0:u.getHyperlink())?{rowIndex:o,colIndex:r,cellData:u}:null),e.dateReminderManager.updateDateReminder(a,u,o,r,this.runMutationOptions),e.todoManager.updateTodoRange(a,u,o,r)}},n.runOnFormulaModel=function(e){for(var t=e.formulaModelManager,n=0,i=this.cellDataDeltaAtPositions.length;n<i;n++){var s=this.cellDataDeltaAtPositions[n],o=s.rowIndex,r=s.colIndex,a=s.cellDataDelta,d=this.getAffectedSheetId();0===a.setSlots&&0===a.clearSlots||(t.addFormulaData({row:o,col:r,sheetId:d},a),t.addDataValidationData({row:o,col:r,sheetId:d},a))}t.updateFormulaModelManagerDataFinish()},n.invert=function(e){var n,i,s,o,r,a,d=e.sheetManager.getSheetBySheetId(this.gridRange.sheetId),u=[];if(!d)return[];for(n=0,i=this.cellDataDeltaAtPositions.length;n<i;n++)s=this.cellDataDeltaAtPositions[n].rowIndex,o=this.cellDataDeltaAtPositions[n].colIndex,a=this.cellDataDeltaAtPositions[n].cellDataDelta,r=d.getCellDataAtPosition(s,o,{isIgnoreFilterView:!0}),u.push({rowIndex:s,colIndex:o,cellDataDelta:m.cellDataUtils.invertCellDataDelta(r,a)});return[new t({gridRange:this.gridRange,cellDataDeltaAtPositions:u})]},n.transformWithInsertDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n,i,s=this.gridRange.clone();s.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount});var o,r,a=[];for(n=0,i=this.cellDataDeltaAtPositions.length;n<i;n++)o=this.cellDataDeltaAtPositions[n],(r=new c.Z(this.gridRange.sheetId,o.rowIndex,o.rowIndex,o.colIndex,o.colIndex)).insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),r.endRowIndex===r.startRowIndex&&r.endColIndex===r.startColIndex&&a.push({rowIndex:r.startRowIndex,colIndex:r.startColIndex,cellDataDelta:(0,d.M)(o.cellDataDelta,e)});return 0===a.length?[]:[new t({gridRange:s,cellDataDeltaAtPositions:a})]},n.transformWithDeleteDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n,i,s=this.gridRange.clone();if(s.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),s.endRowIndex<s.startRowIndex||s.endColIndex<s.startColIndex)return[];var o,r,a=[];for(n=0,i=this.cellDataDeltaAtPositions.length;n<i;n++)o=this.cellDataDeltaAtPositions[n],(r=new c.Z(this.gridRange.sheetId,o.rowIndex,o.rowIndex,o.colIndex,o.colIndex)).deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),r.endRowIndex===r.startRowIndex&&r.endColIndex===r.startColIndex&&a.push({rowIndex:r.startRowIndex,colIndex:r.startColIndex,cellDataDelta:(0,d.M)(o.cellDataDelta,e)});return 0===a.length?[]:[new t({gridRange:s,cellDataDeltaAtPositions:a})]},n.transformWithSetRangeMutation=function(e,n){if(this.gridRange.sheetId!==e.gridRange.sheetId)return[this];var i,s;if(!this.gridRange.isCross(e.gridRange))return[this];var r=this.getTotalSlots(),a=e.getTotalSlots();if(0===((r.cellDataSetSlots|r.cellDataClearSlots)&(a.cellDataSetSlots|a.cellDataClearSlots)))return[this];if((0,o.fS)(this,e))return n?[this]:[];var d,u,l,h=[],c={};for(i=0,s=e.cellDataDeltaAtPositions.length;i<s;i++)c[u=(d=e.cellDataDeltaAtPositions[i]).rowIndex+","+d.colIndex]=d.cellDataDelta;for(i=0,s=this.cellDataDeltaAtPositions.length;i<s;i++)if(c[u=(d=this.cellDataDeltaAtPositions[i]).rowIndex+","+d.colIndex]){if((l=m.cellDataUtils.transformTwoCellDataDelta(d.cellDataDelta,c[u],n)).isEmpty())continue;h.push({rowIndex:d.rowIndex,colIndex:d.colIndex,cellDataDelta:l})}else h.push(d);return 0===h.length?[]:[new t({gridRange:this.gridRange,cellDataDeltaAtPositions:h})]},n.transformWithSetCellPropertiesMutation=function(e,n){if(this.gridRange.sheetId!==e.gridRange.sheetId)return[this];var i,s;if(!this.gridRange.isCross(e.gridRange))return[this];var o=this.getTotalSlots();if(0===((o.cellDataSetSlots|o.cellDataClearSlots)&(e.cellDataDelta.setSlots|e.cellDataDelta.clearSlots)))return[this];var r,a,d=[];for(i=0,s=this.cellDataDeltaAtPositions.length;i<s;i++)if(r=this.cellDataDeltaAtPositions[i],e.gridRange.containCell(r.rowIndex,r.colIndex)){if((a=m.cellDataUtils.transformTwoCellDataDelta(r.cellDataDelta,e.cellDataDelta,n)).isEmpty())continue;d.push({rowIndex:r.rowIndex,colIndex:r.colIndex,cellDataDelta:a})}else d.push(r);return 0===d.length?[]:[new t({gridRange:this.gridRange,cellDataDeltaAtPositions:d})]},n.transformWithMergeCellsMutation=function(e,n){if(this.gridRange.sheetId!==e.sheetId)return[this];var i,s,o=new c.Z(e.sheetId,e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex);if(!this.gridRange.isCross(o))return[this];var r,a=[];for(i=0,s=this.cellDataDeltaAtPositions.length;i<s;i++){var d=r=this.cellDataDeltaAtPositions[i],u=d.rowIndex,h=d.colIndex;if(!o.containCell(u,h)||u===o.startRowIndex&&h===o.startColIndex)a.push(r);else if(n&&r.cellDataDelta.setSlots>0)return[new l.Z(o),this]}return 0===a.length?[]:[new t({gridRange:this.gridRange,cellDataDeltaAtPositions:a})]},n.transformWithDeleteSheetMutation=function(e,t){return this.gridRange.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithCopyPasteMutation=function(e,t){var n=this;if(this.gridRange.sheetId!==e.sheetId)return[this];var i=[];if(t)i.push(this);else if(e.sheetId!==this.gridRange.sheetId)i.push(this);else{var s=e.getAffectedGridRanges(),o=!1,r=[];if(s.forEach((function(e){e.isCross(n.gridRange)&&(o=!0,r.push(e.getCross(n.gridRange)))})),o){var a=e.cellMask;r.forEach((function(e){e.each((function(e,t){n.cellDataDeltaAtPositions.forEach((function(i,s){var o=i.rowIndex,r=i.colIndex,d=i.cellDataDelta;if(o===e&&r===t){var u=Object.assign(Object.assign({},i),{cellDataDelta:(0,h.removeCrossSlotByMask)(d,a)});n.cellDataDeltaAtPositions[s]=u}}))}))})),i.push(this)}else i.push(this)}return i},n.transformWithReorderRangeMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n,i,s=this.gridRange.getCross(e.range);if(!s)return[this];var o,r,a,u=[];for(n=0,i=this.cellDataDeltaAtPositions.length;n<i;n++)if(o=this.cellDataDeltaAtPositions[n],s.containCell(o.rowIndex,o.colIndex)){if(null===(r=e.getOrderResult(o.rowIndex))){u.push(o);continue}a=(0,d.M)(o.cellDataDelta,e);var l=(0,d.L)(a);l.other&&!l.other.isEmpty()&&u.push({rowIndex:r,colIndex:o.colIndex,cellDataDelta:l.other}),l.borders&&!l.borders.isEmpty()&&u.push({rowIndex:o.rowIndex,colIndex:o.colIndex,cellDataDelta:l.borders})}else u.push(o);return 0===u.length?[]:[new t({gridRange:g.gridRangeUtils.getMinContainGridRange(this.gridRange,e.range),cellDataDeltaAtPositions:u})]},n.transformWithMapRangeMutation=function(e){if(this.gridRange.sheetId!==e.sourceSheetId)return[this];var n,i,s,o,r,a=this.gridRange.getCross(new c.Z(e.sourceSheetId,-1===e.row.from.startIndex?0:e.row.from.startIndex,-1===e.row.from.endIndex?Number.MAX_VALUE:e.row.from.endIndex,-1===e.column.from.startIndex?0:e.column.from.startIndex,-1===e.column.from.endIndex?Number.MAX_VALUE:e.column.from.endIndex)),l=[],h=[];if(!a){for(n=0,i=this.cellDataDeltaAtPositions.length;n<i;n++)s=this.cellDataDeltaAtPositions[n],l.push({rowIndex:s.rowIndex,colIndex:s.colIndex,cellDataDelta:(0,d.M)(s.cellDataDelta,e)});return 0===l.length?[]:[new t({gridRange:this.gridRange,cellDataDeltaAtPositions:l})]}for(h.push(new u.Z({gridRange:a,cellDataDelta:new I.Z({clearSlots:m.CELL_DATA_SLOT_COMPOSE.ALL})})),n=0,i=this.cellDataDeltaAtPositions.length;n<i;n++)if(s=this.cellDataDeltaAtPositions[n],a.containCell(s.rowIndex,s.colIndex)){var f=e.row,g=e.column;o=-1===f.from.startIndex?s.rowIndex:s.rowIndex-f.from.startIndex+f.to,r=-1===g.from.startIndex?s.colIndex:s.colIndex-g.from.startIndex+g.to,h.push(new u.Z({gridRange:new c.Z(this.gridRange.sheetId,o,o,r,r),cellDataDelta:(0,d.M)(s.cellDataDelta,e)}))}else l.push({rowIndex:s.rowIndex,colIndex:s.colIndex,cellDataDelta:(0,d.M)(s.cellDataDelta,e)});return 0===l.length?h:[new t({gridRange:this.gridRange,cellDataDeltaAtPositions:l})].concat(h)},n.getTotalSlots=function(){var e,t,n,i={cellDataSetSlots:0,cellDataClearSlots:0,cellFormatSetSlots:0,cellFormatClearSlots:0};for(e=0,t=this.cellDataDeltaAtPositions.length;e<t;e++){n=this.cellDataDeltaAtPositions[e],i.cellDataSetSlots|=n.cellDataDelta.setSlots,i.cellDataSetSlots|=n.cellDataDelta.clearSlots;var s=n.cellDataDelta.delta.userEnteredFormatDelta;s&&(i.cellFormatSetSlots|=s.setSlots,i.cellFormatClearSlots|=s.clearSlots)}return i},t}(a.Z);R.protoMap={0:{name:"gridRange",dataType:c.Z},1:{name:"cellDataDeltaAtPositions",dataType:{type:Array,subType:{type:Object,protoMap:p}}}},t.Z=R},"../packages/mutation/src/cell/cellMutationUtils.ts":function(e,t,n){"use strict";n.d(t,{L:function(){return l},M:function(){return u}});var i=n("../packages/model/src/index.ts"),s=n("../packages/model/src/cell/CellDataDelta.ts"),o=i.Cell.CELL_DATA_SLOT,r=i.Cell.CellFormatDelta,a=i.Cell.CELL_FORMAT_SLOT,d=i.Cell.CELL_FORMAT_SLOT_COMPOSE;function u(e,t){return e}function l(e){var t,n,i=new s.Z,u=e,l=function(e,t,n,i){var s=e,o=1<<n;(e.setSlots&o)>0?t.setSlot(n,i):(e.clearSlots&o)>0&&t.clearSlot(n),s.removeSlot(n)};if((e.setSlots&1<<o.SLOT_USER_ENTERED_FORMAT_DELTA)>0){t=new r;var h=e.delta.userEnteredFormatDelta;n=h,l(h,t,a.BORDER_TOP,h.delta.getBorderTop()),l(h,t,a.BORDER_RIGHT,h.delta.getBorderRight()),l(h,t,a.BORDER_BOTTOM,h.delta.getBorderBottom()),l(h,t,a.BORDER_LEFT,h.delta.getBorderLeft()),i.setSlot(o.SLOT_USER_ENTERED_FORMAT_DELTA,t)}else(e.clearSlots&1<<o.SLOT_USER_ENTERED_FORMAT_DELTA)>0?(t=new r({clearSlots:d.BORDERS}),n=new r({clearSlots:d.ALL&~d.BORDERS}),i.setSlot(o.SLOT_USER_ENTERED_FORMAT_DELTA,t),u.setSlot(o.SLOT_USER_ENTERED_FORMAT_DELTA,n)):i=null;return{borders:i,other:u}}},"../packages/mutation/src/conditionalFormat/AddConditionalFormatMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.sort.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/conditionalFormat/DeleteConditionalFormatMutation.ts"),d=s.Rule.ConditionalFormatRule,u=s.Range.GridRange,l=function(e){function t(t){var n;return(n=e.call(this,o.ZP.ADD_CONDITIONAL_FORMAT_MUTATION,t)||this).sheetId=t.sheetId,n.ruleIndex=t.ruleIndex,n.rule=t.rule,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],ruleIndex:e[1],rule:d.deserialize(e[2])})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.ruleIndex,this.rule.serialize()]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){var t;this.sheetId=e,null===(t=this.rule.ruleRanges)||void 0===t||t.forEach((function(t){t.sheetId=e}))},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){var t=e.conditionalFormatRuleManager.addConditionalFormatRule(this.ruleIndex,this.rule).id;e.spreadsheetReference.formulaModelManager.addConditionalFormatData(t,{id:t,rule:this.rule,index:this.ruleIndex})},n.invert=function(){return[new a.Z({sheetId:this.sheetId,ruleIndex:this.ruleIndex,oldRuleRanges:this.rule.ruleRanges})]},n.transformWithInsertDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=[];return this.rule.ruleRanges.forEach((function(t){(t=t.clone()).sheetId===e.sheetId&&(t.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),t.isValid()&&n.push(t))})),n.length>0?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new d({ruleRanges:n,booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat})})]:[]},n.transformWithDeleteDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=[];return this.rule.ruleRanges.forEach((function(t){(t=t.clone()).sheetId===e.sheetId&&(t.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),t.isValid()&&n.push(t))})),n.length>0?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new d({ruleRanges:n,booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat})})]:[]},n.transformWithMergeCellsMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=new u(e.sheetId,e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex);if(this.rule.ruleRanges.some((function(e){return e.isCross(n)}))){var i=new u(e.sheetId,e.startRowIndex,e.startRowIndex,e.startColIndex,e.startColIndex);if(this.rule.ruleRanges.some((function(e){return e.contain(i)})))return[this];var s=[];return this.rule.ruleRanges.forEach((function(e){if(e.sheetId===n.sheetId&&e.isCross(n)){var t=e.startRowIndex,i=e.endRowIndex;e.startRowIndex<n.startRowIndex&&(s.push(new u(e.sheetId,e.startRowIndex,n.startRowIndex,e.startColIndex,e.endColIndex)),t=n.startRowIndex),n.endRowIndex<e.endRowIndex&&(s.push(new u(e.sheetId,n.endRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex)),i=n.endRowIndex),e.startColIndex<n.startColIndex&&s.push(new u(e.sheetId,t,i,e.startColIndex,n.endColIndex)),n.endColIndex<e.endColIndex&&s.push(new u(e.sheetId,t,i,n.endColIndex,e.endColIndex))}else s.push(e)})),0===s.length?[]:(s.sort((function(e,t){return e.startRowIndex<t.startRowIndex||e.startColIndex<t.startColIndex||e.endRowIndex<t.endRowIndex?-1:e.endColIndex-t.endColIndex})),[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new d({ruleRanges:s,booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat})})])}return[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithMapRangeMutation=function(e){if(this.sheetId!==e.sourceSheetId)return[this];var n=[],i=[],s=[],o=[];return this.rule.ruleRanges.forEach((function(t){if(t.sheetId===e.sourceSheetId){var r=[],a=new u(e.sourceSheetId,-1===e.row.to?t.startRowIndex:e.row.from.startIndex,-1===e.row.to?t.endRowIndex:e.row.from.endIndex,-1===e.column.to?t.startColIndex:e.column.from.startIndex,-1===e.column.to?t.endColIndex:e.column.from.endIndex),d=t.getCross(a);d&&(r.push(d),i.push(d),o.push(new u(e.sourceSheetId,-1===e.row.to?d.startRowIndex:d.startRowIndex-e.row.from.startIndex+e.row.to,-1===e.row.to?d.endRowIndex:d.endRowIndex-e.row.from.startIndex+e.row.to,-1===e.column.to?d.startColIndex:d.startColIndex-e.column.from.startIndex+e.column.to,-1===e.column.to?d.endColIndex:d.endColIndex-e.column.from.startIndex+e.column.to)));var l=new u(e.sourceSheetId,-1===e.row.to?t.startRowIndex:e.row.to,-1===e.row.to?t.endRowIndex:e.row.to+e.row.from.endIndex-e.row.from.startIndex,-1===e.column.to?t.startColIndex:e.column.to,-1===e.column.to?t.endColIndex:e.column.to+e.column.from.endIndex-e.column.from.startIndex),h=t.getCross(l);h&&(r.push(h),s.push(h)),d||h?r.forEach((function(e){var i=t.startRowIndex,s=t.endRowIndex;t.startRowIndex<e.startRowIndex&&(n.push(new u(t.sheetId,t.startRowIndex,e.startRowIndex,t.startColIndex,t.endColIndex)),i=e.startRowIndex),e.endRowIndex<t.endRowIndex&&(n.push(new u(t.sheetId,e.endRowIndex,t.endRowIndex,t.startColIndex,t.endColIndex)),s=e.endRowIndex),t.startColIndex<e.startColIndex&&n.push(new u(t.sheetId,i,s,t.startColIndex,e.endColIndex)),e.endColIndex<t.endColIndex&&n.push(new u(t.sheetId,i,s,e.endColIndex,t.endColIndex))})):n.push(t)}})),n.length>0||o.length>0?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new d({ruleRanges:[].concat(n,o),booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat})})]:[]},n.transformWithAddConditionalFormatMutation=function(e,n){return this.sheetId!==e.sheetId?[this]:this.ruleIndex>e.ruleIndex||this.ruleIndex===e.ruleIndex&&n?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex+1,rule:this.rule})]:[this]},n.transformWithDeleteConditionalFormatMutation=function(e,n){return this.sheetId!==e.sheetId?[this]:this.ruleIndex>e.ruleIndex?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex-1,rule:this.rule})]:[this]},t}(r.Z);l.protoMap={0:{name:"sheetId",dataType:String},1:{name:"ruleIndex",dataType:Number},2:{name:"rule",dataType:s.Rule.ConditionalFormatRule}},t.Z=l},"../packages/mutation/src/conditionalFormat/DeleteConditionalFormatMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/conditionalFormat/AddConditionalFormatMutation.ts"),d=s.Range.GridRange,u=function(e){function t(t){var n;return(n=e.call(this,o.ZP.DELETE_CONDITIONAL_FORMAT_MUTATION,t)||this).sheetId=t.sheetId,n.ruleIndex=t.ruleIndex,n.oldRuleRanges=t.oldRuleRanges,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],ruleIndex:e[1],oldRuleRanges:e[2].map((function(e){return d.deserialize(e)}))})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.ruleIndex,this.oldRuleRanges.map((function(e){return e.serialize()}))]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){var t;this.sheetId=e,null===(t=this.oldRuleRanges)||void 0===t||t.forEach((function(t){t.sheetId=e}))},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){var t=e.spreadsheetReference.formulaModelManager,n=e.conditionalFormatRuleManager.getRuleByRuleIndex(this.ruleIndex);void 0!==(null===n||void 0===n?void 0:n.id)&&t.removeConditionalFormatData(n.id,this.oldRuleRanges),e.conditionalFormatRuleManager.deleteConditionalFormatRule(this.ruleIndex)},n.invert=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId).conditionalFormatRuleManager.getConditionalFormatRuleByRuleIndex(this.ruleIndex);return t?[new a.Z({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:t})]:[]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithAddConditionalFormatMutation=function(e,n){return this.sheetId!==e.sheetId?[this]:this.ruleIndex>=e.ruleIndex?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex+1,oldRuleRanges:this.oldRuleRanges})]:[this]},n.transformWithDeleteConditionalFormatMutation=function(e){return this.sheetId!==e.sheetId?[this]:this.ruleIndex===e.ruleIndex?[]:this.ruleIndex>e.ruleIndex?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex-1,oldRuleRanges:this.oldRuleRanges})]:[this]},n.transformWithUpdateConditionalFormatMutation=function(e){return this.sheetId!==e.sheetId?[this]:this.ruleIndex===e.ruleIndex?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,oldRuleRanges:this.oldRuleRanges})]:[this]},t}(r.Z);u.protoMap={0:{name:"sheetId",dataType:String},1:{name:"ruleIndex",dataType:Number},2:{name:"oldRuleRanges",dataType:{type:Array,subType:d}}},t.Z=u},"../packages/mutation/src/conditionalFormat/UpdateConditionalFormatMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.sort.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=s.Rule.ConditionalFormatRule,d=s.Range.GridRange,u=function(e){function t(t){var n;return(n=e.call(this,o.ZP.UPDATE_CONDITIONAL_FORMAT_MUTATION,t)||this).sheetId=t.sheetId,n.ruleIndex=t.ruleIndex,n.rule=t.rule,n.oldRuleRanges=t.oldRuleRanges,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],ruleIndex:e[1],rule:a.deserialize(e[2]),oldRuleRanges:e[3].map((function(e){return d.deserialize(e)}))})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.ruleIndex,this.rule.serialize(),this.oldRuleRanges.map((function(e){return e.serialize()}))]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){var t,n;this.sheetId=e,null===(t=this.rule.ruleRanges)||void 0===t||t.forEach((function(t){t.sheetId=e})),null===(n=this.oldRuleRanges)||void 0===n||n.forEach((function(t){t.sheetId=e}))},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(e){return{isValid:!0}},n.runOnSheet=function(e){var t=e.conditionalFormatRuleManager;t.updateConditionalFormatRule(this.ruleIndex,this.rule);var n=e.spreadsheetReference.formulaModelManager,i=t.getRuleByRuleIndex(this.ruleIndex);void 0!==(null===i||void 0===i?void 0:i.id)&&(n.removeConditionalFormatData(i.id,this.rule.ruleRanges),n.addConditionalFormatData(i.id,i))},n.invert=function(e){var n=e.sheetManager.getSheetBySheetId(this.sheetId).conditionalFormatRuleManager.getConditionalFormatRuleByRuleIndex(this.ruleIndex);return n?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:n,oldRuleRanges:this.rule.ruleRanges})]:[]},n.transformWithInsertDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=[];return this.rule.ruleRanges.forEach((function(t){(t=t.clone()).sheetId===e.sheetId&&(t.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),t.isValid()&&n.push(t))})),n.length>0?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new a({ruleRanges:n,booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat}),oldRuleRanges:this.oldRuleRanges})]:[]},n.transformWithDeleteDimensionMutation=function(e,n){if(this.sheetId!==e.sheetId)return[this];var i=[];return this.rule.ruleRanges.forEach((function(t){(t=t.clone()).sheetId===e.sheetId&&(t.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),t.isValid()&&i.push(t))})),i.length>0?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new a({ruleRanges:i,booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat}),oldRuleRanges:this.oldRuleRanges})]:[]},n.transformWithMergeCellsMutation=function(e,n){if(this.sheetId!==e.sheetId)return[this];var i=new d(e.sheetId,e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex);if(this.rule.ruleRanges.some((function(e){return e.isCross(i)}))){var s=new d(e.sheetId,e.startRowIndex,e.startRowIndex,e.startColIndex,e.startColIndex);if(this.rule.ruleRanges.some((function(e){return e.contain(s)})))return[this];var o=[];return this.rule.ruleRanges.forEach((function(e){if(e.sheetId===i.sheetId&&e.isCross(i)){var t=e.startRowIndex,n=e.endRowIndex;e.startRowIndex<i.startRowIndex&&(o.push(new d(e.sheetId,e.startRowIndex,i.startRowIndex,e.startColIndex,e.endColIndex)),t=i.startRowIndex),i.endRowIndex<e.endRowIndex&&(o.push(new d(e.sheetId,i.endRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex)),n=i.endRowIndex),e.startColIndex<i.startColIndex&&o.push(new d(e.sheetId,t,n,e.startColIndex,i.endColIndex)),i.endColIndex<e.endColIndex&&o.push(new d(e.sheetId,t,n,i.endColIndex,e.endColIndex))}else o.push(e)})),0===o.length?[]:(o.sort((function(e,t){return e.startRowIndex<t.startRowIndex||e.startColIndex<t.startColIndex||e.endRowIndex<t.endRowIndex?-1:e.endColIndex-t.endColIndex})),[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new a({ruleRanges:o,booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat}),oldRuleRanges:this.oldRuleRanges})])}return[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithMapRangeMutation=function(e){if(this.sheetId!==e.sourceSheetId)return[this];var n=[],i=[],s=[],o=[];return this.rule.ruleRanges.forEach((function(t){if(t.sheetId===e.sourceSheetId){var r=[],a=new d(e.sourceSheetId,-1===e.row.to?t.startRowIndex:e.row.from.startIndex,-1===e.row.to?t.endRowIndex:e.row.from.endIndex,-1===e.column.to?t.startColIndex:e.column.from.startIndex,-1===e.column.to?t.endColIndex:e.column.from.endIndex),u=t.getCross(a);u&&(r.push(u),i.push(u),o.push(new d(e.sourceSheetId,-1===e.row.to?u.startRowIndex:u.startRowIndex-e.row.from.startIndex+e.row.to,-1===e.row.to?u.endRowIndex:u.endRowIndex-e.row.from.startIndex+e.row.to,-1===e.column.to?u.startColIndex:u.startColIndex-e.column.from.startIndex+e.column.to,-1===e.column.to?u.endColIndex:u.endColIndex-e.column.from.startIndex+e.column.to)));var l=new d(e.sourceSheetId,-1===e.row.to?t.startRowIndex:e.row.to,-1===e.row.to?t.endRowIndex:e.row.to+e.row.from.endIndex-e.row.from.startIndex,-1===e.column.to?t.startColIndex:e.column.to,-1===e.column.to?t.endColIndex:e.column.to+e.column.from.endIndex-e.column.from.startIndex),h=t.getCross(l);h&&(r.push(h),s.push(h)),u||h?r.forEach((function(e){var i=t.startRowIndex,s=t.endRowIndex;t.startRowIndex<e.startRowIndex&&(n.push(new d(t.sheetId,t.startRowIndex,e.startRowIndex,t.startColIndex,t.endColIndex)),i=e.startRowIndex),e.endRowIndex<t.endRowIndex&&(n.push(new d(t.sheetId,e.endRowIndex,t.endRowIndex,t.startColIndex,t.endColIndex)),s=e.endRowIndex),t.startColIndex<e.startColIndex&&n.push(new d(t.sheetId,i,s,t.startColIndex,e.endColIndex)),e.endColIndex<t.endColIndex&&n.push(new d(t.sheetId,i,s,e.endColIndex,t.endColIndex))})):n.push(t)}})),n.length>0||o.length>0?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex,rule:new a({ruleRanges:[].concat(n,o),booleanConditionalFormat:this.rule.booleanConditionalFormat,gradientConditionalFormat:this.rule.gradientConditionalFormat,dataBarConditionalFormat:this.rule.dataBarConditionalFormat}),oldRuleRanges:this.oldRuleRanges})]:[]},n.transformWithAddConditionalFormatMutation=function(e,n){return this.sheetId!==e.sheetId?[this]:this.ruleIndex>=e.ruleIndex?[new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex+1,rule:this.rule,oldRuleRanges:this.oldRuleRanges})]:[this]},n.transformWithDeleteConditionalFormatMutation=function(e,n){return this.sheetId!==e.sheetId?[this]:this.ruleIndex===e.ruleIndex?[]:(this.ruleIndex>e.ruleIndex&&new t({sheetId:this.sheetId,ruleIndex:this.ruleIndex-1,rule:this.rule,oldRuleRanges:this.oldRuleRanges}),[this])},n.transformWithUpdateConditionalFormatMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:this.ruleIndex===e.ruleIndex?t?[this]:[]:[this]},t}(r.Z);u.protoMap={0:{name:"sheetId",dataType:String},1:{name:"ruleIndex",dataType:Number},2:{name:"rule",dataType:a},3:{name:"oldRuleRanges",dataType:{type:Array,subType:d}}},t.Z=u},"../packages/mutation/src/config/report.ts":function(e,t,n){"use strict";n.d(t,{lv:function(){return s},mz:function(){return o}});var i,s={MUTATION_VER_LOWER_THAN_SUPPORT:33910951,CONVERT_MUTATION_ERROR:33910952},o={SERIALIZE_MUTATION:"SERIALIZE_MUTATION",DESERIALIZE_MUTATION_FAIL:"DESERIALIZE_MUTATION_FAIL",DESERIALIZE_MUTATION_CATCH_ERROR:"DESERIALIZE_MUTATION_CATCH_ERROR",DESERIALIZE_MUTATION_CATCH_ERROR_OLD:"DESERIALIZE_MUTATION_CATCH_ERROR_OLD",GET_COLLAB_MUTATIONS:"GET_COLLAB_MUTATIONS",FOLLOW_REQUEST_MUTATIONS:"FOLLOW_REQUEST_MUTATIONS",CHECK_MUTATION_ERROR:"CHECK_MUTATION_ERROR",CHECK_MUTATION_RESULT_ERROR:"CHECK_MUTATION_RESULT_ERROR",RUN_MUTATION_ERROR:"RUN_MUTATION_ERROR",AFTER_MUTATION_RUN_DATA_CHANGE_CATCH_ERROR:"AFTER_MUTATION_RUN_DATA_CHANGE_CATCH_ERROR",AFTER_MUTATION_RUN_CATCH_ERROR:"AFTER_MUTATION_RUN_CATCH_ERROR"};!function(e){e.MUTATIONS_RUN="mutations_run",e.AFTER_MUTATIONS_RUN="after_mutations_run"}(i||(i={}))},"../packages/mutation/src/config/version.ts":function(e,t){"use strict";t.Z={MUTATION_VER:5,MUTATION_VER_LOWEST_SUPPORT:3}},"../packages/mutation/src/dimension/DeleteDimensionMutation.ts":function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/model/src/cell/index.ts"),r=n("../packages/model/src/cell/data-validation/data-validation-rule.ts"),a=n("../packages/model/src/rule/index.ts"),d=n("../packages/common-utils/src/index.ts"),u=n("../packages/mutation/src/MutationId.ts"),l=n("../packages/mutation/src/Mutation.ts"),h=n("../packages/mutation/src/dimension/InsertDimensionMutation.ts"),c=n("../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts"),I=n("../packages/mutation/src/cell/SetRangeMutation.ts"),f=n("../packages/mutation/src/merge/MergeCellsMutation.ts"),m=n("../packages/mutation/src/embedded/UpdateEmbeddedObjectMutation.ts"),g=n("../packages/mutation/src/sheet/SetSheetPropertiesMutation.ts"),p=n("../packages/mutation/src/sheet/DefineSheetRangeMutation.ts"),R=n("../packages/model/src/range/sheet-range-delta.ts"),x=n("../packages/model/src/range/comment-sheet-range/comment-sheet-range-properties.ts"),E=n("../packages/mutation/src/cell/SetCellPropertiesMutation.ts");n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var T=n("../spread-sheet/src/core/behavior/request/other/formula-model-service/UpdateFormulaModelServiceForMutation.ts"),S=s.Dimension.DIMENSION_TYPE,_=s.Range.DimensionRange,w=s.Range.GridRange,v=s.Sheet.SheetPropertiesDelta,M=s.Sheet.NEW_SHEET_PROPERTIES_SLOT_OPERATION,D=s.Cell.cellDataUtils,O=function(e){function t(t){var n;return(n=e.call(this,u.ZP.DELETE_DIMENSION_MUTATION,t)||this).index=t.index,n.amount=t.amount,n.type=t.type,n.sheetId=t.sheetId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({index:e[0],amount:e[1],sheetId:e[2],type:e[3]})};var n=t.prototype;return n.serialize=function(){return[this.index,this.amount,this.sheetId,this.type]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t,n=[];return(t=e.sheetManager.getSheetBySheetId(this.sheetId))&&n.push(t),n},n.check=function(e){if(this.type!==S.ROWS&&this.type!==S.COLUMNS)return{isValid:!1,errorMessage:"type不是行也不是列。 "+this.type};var t=e.properties.gridProperties,n=this.type===S.ROWS?t.rowCount:t.colCount;return!(0,d.hj)(this.index)||this.index<0||this.index>=n?{isValid:!1,errorMessage:"index值不规范 index="+this.index+" dimensionCount="+n}:!(0,d.hj)(this.amount)||this.amount<=0||this.index+this.amount>n?{isValid:!1,errorMessage:"amount值不规范 amount="+this.amount+" index="+this.index+"  dimensionCount="+n}:{isValid:!0}},n.runOnSheet=function(e){e.deleteDimension({sheetId:this.sheetId,index:this.index,amount:this.amount,type:this.type})},n.runOnWorkbook=function(e){return e.deleteDimension({sheetId:this.sheetId,type:this.type,index:this.index,amount:this.amount}),!0},n.runOnFormulaModel=function(e){e.deleteDimensionForFormulaModel({sheetId:this.sheetId,type:this.type,index:this.index,amount:this.amount})},n.invert=function(e){var t,n,i=e.sheetManager.getSheetBySheetId(this.sheetId),s=[];if(null===i)return s;if(this.type!==S.ROWS&&this.type!==S.COLUMNS)return console.warn("DIMENSION_TYPE error"),s;s.push(new h.Z({index:this.index,amount:this.amount,type:this.type,sheetId:this.sheetId})),t=new _(this.sheetId,this.index,this.index+this.amount-1,this.type),s=s.concat((0,c.OR)({sheet:i,type:this.type,ranges:[t]},Object.assign(Object.assign({},c.Sb),{needDefaultProperties:!0}))),n=this.type===S.ROWS?new w(this.sheetId,this.index,this.index+this.amount-1,0,i.getColCount()-1):new w(this.sheetId,0,i.getRowCount()-1,this.index,this.index+this.amount-1);var o=this.getSetRangeMutation(i,n);if(o&&s.push(o),this.type===S.ROWS){var r=i.getFrozenRowCount();this.index<r&&this.index+this.amount>=r&&s.push(new g.Z({sheetId:this.sheetId,sheetDelta:new v({operation:M.SET_PROPERTIES,delta:{frozenRowCount:r}})}))}else if(this.type===S.COLUMNS){var a=i.getFrozenColCount();this.index<a&&this.index+this.amount>=a&&s.push(new g.Z({sheetId:this.sheetId,sheetDelta:new v({operation:M.SET_PROPERTIES,delta:{frozenColCount:a}})}))}this.invertOnMerges(s,i,t);var d=this.getUpdateFormulaModelServiceInstance(e).getInvertMutationsForDeleteDimensionMutation(this);return s=s.concat(d),this.invertOnImages(s,i),this.invertOnDataValidation(s,e),s},n.invertOnMerges=function(e,t,n){var i=this;t.mergeManager.each((function(t){(i.type===S.ROWS&&n.isCross(new _(t.sheetId,t.startRowIndex,t.endRowIndex,S.ROWS))||i.type===S.COLUMNS&&n.isCross(new _(t.sheetId,t.startColIndex,t.endColIndex,S.COLUMNS)))&&e.push(new f.Z(t.clone()))})),t.sheetRangeManager.each((function(t,n){(i.type===S.ROWS&&t.gridRange.startRowIndex>=i.index&&t.gridRange.endRowIndex<=i.index+i.amount-1||i.type===S.COLUMNS&&t.gridRange.startColIndex>=i.index&&t.gridRange.endColIndex<=i.index+i.amount-1)&&e.push(new p.Z({sheetId:t.sheetId,sheetRangeId:n,sheetRangeType:t.sheetRangeType,padId:t.padId,gridRange:t.gridRange.clone(),sheetRangeDelta:new R.Z({commentSheetRangeProperties:new x.Z({isArchived:t.properties.isArchived})})}))}))},n.invertOnImages=function(e,t){var n=this.index,i=this.amount;this.type===S.ROWS?t.imageManager.each((function(t){var s=t.position.overlayPosition.anchorCell.rowIndex;s>=n&&s<n+i&&e.push(new m.Z({data:t.toObject()}))})):this.type===S.COLUMNS&&t.imageManager.each((function(t){var s=t.position.overlayPosition.anchorCell.colIndex;s>=n&&s<n+i&&e.push(new m.Z({data:t.toObject()}))}))},n.invertOnDataValidation=function(e,t){var n=this;!function(e,t){e.sheetManager.getSheetIdList().forEach((function(n){e.sheetManager.getSheetBySheetId(n)&&function(e,t,n){var i=t.sheetManager.getSheetBySheetId(e);i&&i.data.rowData.forEach((function(t,i){t&&t.values.forEach((function(t,s){t&&n({row:i,col:s,sheetId:e,cellData:t})}))}))}(n,e,t)}))}(t,(function(t){var i,d,u=t.row,l=t.col,h=t.sheetId,c=t.cellData.getDataValidation();if(c&&c.ruleType===o.DATA_VALIDATION_RULE_TYPE.LIST&&(null===(d=null===(i=c.argTokens)||void 0===i?void 0:i[0])||void 0===d?void 0:d.type)===a.ARG_TOKEN_TYPE.FORMULA_TOKEN){var I=c.argTokens[0].formula;if(!I)return;if(!I.isAffectedByRowColDel({index:n.index,amount:n.amount,isRow:n.type===s.Dimension.DIMENSION_TYPE.ROWS,sheetId:n.sheetId,nodeSheetId:h,row:u,col:l}))return;var f=new o.CellDataDelta;f.setSlot(o.CELL_DATA_SLOT.SLOT_DATA_VALIDATION_RULE,r.Z.createInstance(Object.assign({},c.getOptions())));var m=new E.Z({gridRange:new w(h,u,u,l,l),cellDataDelta:f});e.push(m)}}))},n.getSetRangeMutation=function(e,t){for(var n=[],i=t.startRowIndex;i<=t.endRowIndex;i++)for(var s=t.startColIndex;s<=t.endColIndex;s++){var o=e.getCellDataAtPosition(i,s),r=D.createCellDataDelta(null,o);r.isEmpty()||n.push({rowIndex:i,colIndex:s,cellDataDelta:r})}return n.length>0?new I.Z({gridRange:t,cellDataDeltaAtPositions:n}):null},n.isConflict=function(e){return this.sheetId===e.sheetId&&this.type===e.type},n.transformWithInsertDimensionMutation=function(e){if(!this.isConflict(e))return[this];var n,i,s=[],o=new _(this.sheetId,this.index,this.index+this.amount-1,this.type);o.insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type});var r=o.toDimensionData();return n=r.index,i=r.amount,s.push(new t({index:n,amount:i,sheetId:this.sheetId,type:this.type})),s},n.transformWithDeleteDimensionMutation=function(e){if(!this.isConflict(e))return[this];var n,i,s=[],o=new _(this.sheetId,this.index,this.index+this.amount-1,this.type);o.deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type});var r=o.toDimensionData();return n=r.index,0===(i=r.amount)||s.push(new t({index:n,amount:i,sheetId:this.sheetId,type:this.type})),s},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.getUpdateFormulaModelServiceInstance=function(e){return(0,T.lO)({getSheetBySheetId:e.sheetManager.getSheetBySheetId.bind(e.sheetManager),getSheetIdList:e.sheetManager.getSheetIdList.bind(e.sheetManager),isSheetAmongTwoSheets:e.sheetManager.isSheetAmongTwoSheets.bind(e.sheetManager),getSheetIdBySheetIndex:e.sheetManager.getSheetIdBySheetIndex.bind(e.sheetManager),getSheetIndexBySheetId:e.sheetManager.getSheetIndexBySheetId.bind(e.sheetManager),getSheetTitleBySheetId:e.sheetManager.getSheetTitleBySheetId.bind(e.sheetManager)},e.workbookRangeManager,e.embeddedObjectManager,e.formulaModelManager)},t}(l.Z);O.protoMap={0:{name:"index",dataType:Number},1:{name:"amount",dataType:Number},2:{name:"sheetId",dataType:String},3:{name:"type",dataType:String}};var C=O},"../packages/mutation/src/dimension/InsertDimensionMutation.ts":function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var i,s=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=(n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),a=n("../packages/mutation/src/MutationId.ts"),d=n("../packages/mutation/src/Mutation.ts"),u=n("../packages/common-utils/src/index.ts"),l=n("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),h=n("../packages/mutation/src/merge/MergeCellsMutation.ts"),c=r.Dimension.DIMENSION_TYPE,I=r.Range.DimensionRange,f=r.Range.GridRange,m=r.Cell.CellDataDelta,g=r.Cell.CELL_DATA_SLOT,p=r.Cell.cellFormatUtils;function R(e,t,n,i){var s=function(e,t,n){var i,s,o=[];return e.mergeManager.each((function(r){i=!1,t===c.ROWS?n>r.startRowIndex&&n<=r.endRowIndex&&(i=!0):t===c.COLUMNS&&n>r.startColIndex&&n<=r.endColIndex&&(i=!0),i&&(s=e.getCellDataAtPosition(r.startRowIndex,r.startColIndex),o.push({userEnterFormat:(null===s||void 0===s?void 0:s.getUserEnteredFormat())||null,gridRange:r}))})),o}(e,n,i);return{mergeData:s}}function x(e,t,n,i,s){var o=[],r=[];switch(e.id){case a.ZP.SET_RANGE_MUTATION:case a.ZP.SET_CELL_PROPERTIES_MUTATION:break;case a.ZP.MERGE_CELLS_MUTATION:o=function(e,t,n,i){var s=!1;return t===e.sheetId&&(n===c.ROWS?i>e.startRowIndex&&i<=e.endRowIndex&&(s=!0):n===c.COLUMNS&&i>e.startColIndex&&i<=e.endColIndex&&(s=!0)),s?[{userEnterFormat:null,gridRange:new f(e.sheetId,e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex)}]:[]}(e,n,i,s);break;case a.ZP.UPDATE_FILTERS_MODEL_MUTATION:case a.ZP.ADD_EMBEDDED_OBJECT_MUTATION:case a.ZP.UPDATE_EMBEDDED_OBJECT_MUTATION:case a.ZP.COPY_PASTE_MUTATION:case a.ZP.REORDER_RANGE_MUTATION:break;case a.ZP.DEFINE_WORKBOOK_RANGE_MUTATION:r=function(e,t,n,i){var s=!1;return t!==e.gridRange.sheetId||e.gridRange.isSheet||(n===c.ROWS?i>e.gridRange.startRowIndex&&i<=e.gridRange.endRowIndex&&(s=!0):n===c.COLUMNS&&i>e.gridRange.startColIndex&&i<=e.gridRange.endColIndex&&(s=!0)),s?[e.clone()]:[]}(e,n,i,s)}return{mergeData:o,workbookRange:r}}function E(e,t,n,s,o){var r=[];return function(e,t,n,s,o,r){var a,d,u,I,R;for(a=0,d=e.mergeData.length;a<d;a++)(I=T(t,(u=e.mergeData[a]).gridRange,n,s,o)).isValid()&&!I.isSingle()&&r.push(new h.Z({sheetId:I.sheetId,startRowIndex:I.startRowIndex,endRowIndex:I.endRowIndex,startColIndex:I.startColIndex,endColIndex:I.endColIndex})),R=n===c.ROWS?u.gridRange.startRowIndex:u.gridRange.startColIndex,t===i.DELETE&&u.userEnterFormat&&I.isValid()&&R>=s&&R<=s+o&&r.push(new l.Z({gridRange:new f(I.sheetId,I.startRowIndex,I.startRowIndex,I.startColIndex,I.startColIndex),cellDataDelta:new m({setSlots:1<<g.SLOT_USER_ENTERED_FORMAT_DELTA,delta:{userEnteredFormatDelta:p.createCellFormatDelta(null,u.userEnterFormat)}})}))}(e,t,n,s,o,r),function(e,t,n,i,s,o){var r,a,d=e.workbookRange;if(void 0!==d)for(r=0;r<d.length;r++)(a=T(t,d[r].gridRange,n,i,s)).isValid()&&(d[r].gridRange=a,o.push(d[r]))}(e,t,n,s,o,r),r}function T(e,t,n,s,o){var r;switch(e){case 0:return(r=n===c.ROWS?new I(t.sheetId,t.startRowIndex,t.endRowIndex,c.ROWS):new I(t.sheetId,t.startColIndex,t.endColIndex,c.COLUMNS)).insertDimension({sheetId:t.sheetId,index:s,amount:o,type:n}),n===c.ROWS?new f(t.sheetId,r.startIndex,r.endIndex,t.startColIndex,t.endColIndex):new f(t.sheetId,t.startRowIndex,t.endRowIndex,r.startIndex,r.endIndex);case 1:return(r=n===c.ROWS?new I(t.sheetId,t.startRowIndex,t.endRowIndex,c.ROWS):new I(t.sheetId,t.startColIndex,t.endColIndex,c.COLUMNS)).deleteDimension({sheetId:t.sheetId,index:s,amount:o,type:n}),n===c.ROWS?new f(t.sheetId,r.startIndex,r.endIndex,t.startColIndex,t.endColIndex):new f(t.sheetId,t.startRowIndex,t.endRowIndex,r.startIndex,r.endIndex);case i.UNDO_INSERT:case i.UNDO_DELETE:return t}return t}!function(e){e[e.INSERT=0]="INSERT",e[e.DELETE=1]="DELETE",e[e.UNDO_INSERT=2]="UNDO_INSERT",e[e.UNDO_DELETE=3]="UNDO_DELETE"}(i||(i={}));var S=n("../packages/mutation/src/dimension/DeleteDimensionMutation.ts"),_=r.Dimension.DIMENSION_TYPE,w=function(e){function t(t){var n;return(n=e.call(this,a.ZP.INSERT_DIMENSION_MUTATION,t)||this).index=t.index,n.amount=t.amount,n.type=t.type,n.sheetId=t.sheetId,n}(0,o.Z)(t,e),t.deserialize=function(e){return new t({index:e[0],amount:e[1],sheetId:e[2],type:e[3]})};var n=t.prototype;return n.serialize=function(){return[this.index,this.amount,this.sheetId,this.type]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(e){if(this.type!==_.ROWS&&this.type!==_.COLUMNS)return{isValid:!1,errorMessage:"type不是行也不是列。 "+this.type};var t=e.properties.gridProperties,n=this.type===_.ROWS?t.rowCount:t.colCount;return!(0,u.hj)(this.index)||this.index<0||this.index>n?{isValid:!1,errorMessage:"index值不规范 index="+this.index+" dimensionCount="+n}:!(0,u.hj)(this.amount)||this.amount<=0?{isValid:!1,errorMessage:"amount值不规范 amount="+this.amount+" index="+this.index+"  dimensionCount="+n}:{isValid:!0}},n.runOnSheet=function(e){e.insertDimension({sheetId:this.sheetId,index:this.index,amount:this.amount,type:this.type})},n.runOnWorkbook=function(e){return e.insertDimension({sheetId:this.sheetId,type:this.type,index:this.index,amount:this.amount}),!0},n.runOnFormulaModel=function(e){e.insertDimensionForFormulaModel({sheetId:this.sheetId,type:this.type,index:this.index,amount:this.amount})},n.invert=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId),n=[];if(n.push(new S.Z({index:this.index,amount:this.amount,type:this.type,sheetId:this.sheetId})),!t)return n;var o=E(R(t,i.INSERT,this.type,this.index),i.UNDO_INSERT,this.type,this.index,this.amount);return n=[].concat((0,s.Z)(n),(0,s.Z)(o))},n.transform=function(t,n){var o=x(t,i.INSERT,this.sheetId,this.type,this.index),r=e.prototype.transform.call(this,t,n),a=E(o,i.INSERT,this.type,this.index,this.amount);return[].concat((0,s.Z)(r),(0,s.Z)(a))},n.isConflictWithCollabMutation=function(e){return this.sheetId===e.sheetId&&this.type===e.type},n.transformWithInsertDimensionMutation=function(e,n){if(!this.isConflictWithCollabMutation(e))return[this];var i=this.index;return(this.index>e.index||n&&this.index===e.index)&&(i=this.index+e.amount),[new t({index:i,amount:this.amount,type:this.type,sheetId:this.sheetId})]},n.transformWithDeleteDimensionMutation=function(e){return this.isConflictWithCollabMutation(e)?this.index<=e.index?[this]:this.index>=e.index+e.amount?[new t({index:this.index-e.amount,amount:this.amount,type:this.type,sheetId:this.sheetId})]:[]:[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},t}(d.Z);w.protoMap={0:{name:"index",dataType:Number},1:{name:"amount",dataType:Number},2:{name:"sheetId",dataType:String},3:{name:"type",dataType:String}};var v=w},"../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts":function(e,t,n){"use strict";n.d(t,{Dk:function(){return M},OR:function(){return w},P8:function(){return I},Sb:function(){return R}}),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.object.freeze.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/SlotOperation.ts"),d=n("../packages/mutation/src/other/mapRangeMutationUtil.ts"),u=n("../packages/model/src/cell/metadata/Metadata.ts"),l=n("../packages/model/src/cell/data-validation/data-validation-rule.ts");function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var I,f=s.Dimension.DimensionFormData,m=s.Dimension.DIMENSION_TYPE,g=s.Dimension.DimensionPropertiesFactory,p=s.Range.DimensionRange,R=Object.freeze({needDefaultProperties:!1,hiddenByUser:!0,pixelSize:!0,ignoreDefaultHidden:!0,ignoreDefaultSize:!0,formData:!0,columnTypeMetadata:!0,ignoreValidateRows:!0,ignoreInvalidError:!0,dataValidation:!0});!function(e){e[e.SLOT_SIZE=1]="SLOT_SIZE",e[e.SLOT_HIDDEN=2]="SLOT_HIDDEN",e[e.SLOT_FORMDATA=3]="SLOT_FORMDATA",e[e.SLOT_COLUMN_TYPE_METADATA=7]="SLOT_COLUMN_TYPE_METADATA",e[e.SLOT_IGNORE_VALIDATE_ROWS=8]="SLOT_IGNORE_VALIDATE_ROWS",e[e.SLOT_IGNORE_INVALID_ERROR=9]="SLOT_IGNORE_INVALID_ERROR",e[e.SLOT_DATA_VALIDATION=10]="SLOT_DATA_VALIDATION"}(I||(I={}));var x={0:{name:"slot",dataType:Number},1:{name:"size",dataType:Number},2:{name:"hidden",dataType:Number},3:{name:"formData",dataType:f}},E=function(e){var t,n,i=[e.slot,null!==e.slotOperation?e.slotOperation:a.Z.SET_SLOT];switch(e.slot){case I.SLOT_SIZE:i[2]=e.size;break;case I.SLOT_HIDDEN:i[2]=e.hidden;break;case I.SLOT_FORMDATA:i[2]=e.formData?e.formData.serialize():null;break;case I.SLOT_COLUMN_TYPE_METADATA:i[2]=(null===(t=e.columnTypeMetadata)||void 0===t?void 0:t.serialize())||null;break;case I.SLOT_IGNORE_VALIDATE_ROWS:i[2]=e.ignoreValidateRows;break;case I.SLOT_IGNORE_INVALID_ERROR:i[2]=e.ignoreInvalidError;break;case I.SLOT_DATA_VALIDATION:i[2]=(null===(n=e.dataValidation)||void 0===n?void 0:n.serialize())||null}return i},T=function(e){var t={slot:e[0],slotOperation:e[1]};switch(e[0]){case I.SLOT_SIZE:t.size=e[2];break;case I.SLOT_HIDDEN:t.hidden=e[2];break;case I.SLOT_FORMDATA:t.formData=e[2]?f.deserialize(e[2]):null;break;case I.SLOT_COLUMN_TYPE_METADATA:t.columnTypeMetadata=e[2]?(0,u.F)(e[2]):null;break;case I.SLOT_IGNORE_VALIDATE_ROWS:t.ignoreValidateRows=e[2];break;case I.SLOT_IGNORE_INVALID_ERROR:t.ignoreInvalidError=e[2];break;case I.SLOT_DATA_VALIDATION:t.dataValidation=e[2]?(0,l.D)(e[2]):null}return t},S=function(e){function t(t){var n;(n=e.call(this,o.ZP.SET_DIMENSION_PROPERTIES_MUTATION,t)||this).ranges=[];for(var i=0;i<t.ranges.length;i++)t.ranges[i].endIndex>=t.ranges[i].startIndex&&n.ranges.push(t.ranges[i]);return n.operation=t.operation,n.type=t.type,n.sheetId=t.sheetId,n.filterViewId=t.filterViewId,n}(0,i.Z)(t,e),t.deserialize=function(e){var n,i,s=[],o=[];for(n=0,i=e[1].length;n<i;n++)s.push(new p(e[0],e[1][n][0],e[1][n][1],e[3]));for(n=0,i=e[2].length;n<i;n++)o.push(T(e[2][n]));return new t({sheetId:e[0],ranges:s,operation:o,type:e[3],filterViewId:e[4]})};var n=t.prototype;return n.serialize=function(){var e,t,n=[],i=[];for(e=0,t=this.ranges.length;e<t;e++)n.push([this.ranges[e].startIndex,this.ranges[e].endIndex]);for(e=0,t=this.operation.length;e<t;e++)i.push(E(this.operation[e]));return[this.sheetId,n,i,this.type,this.filterViewId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e,this.ranges.forEach((function(t){t.sheetId=e}))},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.check=function(e){if(!this.ranges||!this.operation)return{isValid:!1,errorMessage:"ranges为空 或者 operation为空 ranges="+JSON.stringify(this.ranges)+" operation="+JSON.stringify(this.operation)};var t,n,i,s=this.ranges,o=e.properties.gridProperties;if(this.type!==m.ROWS&&this.type!==m.COLUMNS)return{isValid:!1,errorMessage:"type不是行也不是列。 "+this.type};for(t=0,n=s.length;t<n;t++){if(!(i=s[t]).isValid())return{isValid:!1,errorMessage:"dimensionRange值非法 "+JSON.stringify(i)};if(this.type===m.ROWS){if(i.endIndex>=o.rowCount)return{isValid:!1,errorMessage:"dimensionRange超出rowCount范围 dimensionRange="+JSON.stringify(i)+" gridPreperties="+JSON.stringify(o)}}else if(this.type===m.COLUMNS&&i.endIndex>=o.colCount)return{isValid:!1,errorMessage:"dimensionRange超出colCount范围 dimensionRange="+JSON.stringify(i)+" gridPreperties="+JSON.stringify(o)}}return{isValid:!0}},n.runOnSheet=function(e){for(var t=0,n=e.filterViewManager.getFilterViewByViewId(this.filterViewId);t<this.operation.length;t++)switch(this.operation[t].slot){case I.SLOT_SIZE:this.setDimensionSize(e,this.operation[t]);break;case I.SLOT_HIDDEN:n?this.setDimensionHiddenOnFilterView(n,this.operation[t]):this.setDimensionHidden(e,this.operation[t]);break;case I.SLOT_FORMDATA:this.setDimensionFormData(e,this.operation[t]);break;case I.SLOT_COLUMN_TYPE_METADATA:this.setColumnTypeMetadata(e,this.operation[t]);break;case I.SLOT_IGNORE_VALIDATE_ROWS:this.setIgnoreValidateRows(e,this.operation[t]);break;case I.SLOT_IGNORE_INVALID_ERROR:this.setIgnoreInvalidError(e,this.operation[t]);break;case I.SLOT_DATA_VALIDATION:this.setDataValidation(e,this.operation[t])}},n.setColumnTypeMetadata=function(e,t){var n=this;this.ranges.forEach((function(i){var s=i.startIndex,o=i.endIndex;n.type===m.COLUMNS&&e.data.setColsTypeMetadata(s,o,t.columnTypeMetadata||null)}))},n.setIgnoreValidateRows=function(e,t){var n=this;this.ranges.forEach((function(i){var s=i.startIndex,o=i.endIndex;n.type===m.COLUMNS&&e.data.setColsIgnoreValidateRows(s,o,t.ignoreValidateRows)}))},n.setIgnoreInvalidError=function(e,t){var n=this;this.ranges.forEach((function(i){var s=i.startIndex,o=i.endIndex;n.type===m.COLUMNS&&e.data.setColsIgnoreInvalidError(s,o,t.ignoreInvalidError)}))},n.setDataValidation=function(e,t){var n=this;this.ranges.forEach((function(i){var s=i.startIndex,o=i.endIndex;n.type===m.COLUMNS&&e.data.setColsDataValidation(s,o,t.dataValidation||null)}))},n.setDimensionFormData=function(e,t){var n,i,s=this;this.ranges.forEach((function(o){n=o.startIndex,i=o.endIndex,s.type===m.ROWS?e.data.setRowsFormData(n,i,t.formData):s.type===m.COLUMNS&&e.data.setColsFormData(n,i,t.formData)}))},n.setDimensionSize=function(e,t){var n=this;this.ranges.forEach((function(i){n.type===m.ROWS?e.setRowsHeight(i,t.size,n.filterViewId):n.type===m.COLUMNS&&e.setColsWidth(i,t.size,n.filterViewId)}))},n.setDimensionHidden=function(e,t){for(var n,i=0;i<this.ranges.length;i++)n=this.ranges[i],this.type===m.ROWS?t.hidden?e.data.hideRows(n.startIndex,n.endIndex):e.data.showRows(n.startIndex,n.endIndex):this.type===m.COLUMNS&&(t.hidden?e.data.hideCols(n.startIndex,n.endIndex):e.data.showCols(n.startIndex,n.endIndex))},n.setDimensionHiddenOnFilterView=function(e,t){for(var n,i=h(this.ranges);!(n=i()).done;){var s=n.value;this.type===m.ROWS?t.hidden?e.hideRows(s.startIndex,s.endIndex):e.showRows(s.startIndex,s.endIndex):this.type===m.COLUMNS&&(t.hidden?e.hideCols(s.startIndex,s.endIndex):e.showCols(s.startIndex,s.endIndex))}},n.invert=function(e){for(var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId),i=n.filterViewManager.getFilterViewByViewId(this.filterViewId),s=this.type,o=this.ranges,r=0;r<this.operation.length;r++){var a=[];switch(this.operation[r].slot){case I.SLOT_SIZE:a=w({sheet:n,type:s,ranges:o},{needDefaultProperties:!0,pixelSize:!0,ignoreDefaultSize:!1});break;case I.SLOT_HIDDEN:a=w({sheet:n,type:s,ranges:o,filterView:i},{needDefaultProperties:!0,hiddenByUser:!0});break;case I.SLOT_FORMDATA:a=w({sheet:n,type:s,ranges:o},{needDefaultProperties:!0,formData:!0});break;case I.SLOT_COLUMN_TYPE_METADATA:a=w({sheet:n,type:s,ranges:o},{needDefaultProperties:!0,columnTypeMetadata:!0});break;case I.SLOT_IGNORE_VALIDATE_ROWS:a=w({sheet:n,type:s,ranges:o},{ignoreValidateRows:!0});break;case I.SLOT_IGNORE_INVALID_ERROR:a=w({sheet:n,type:s,ranges:o},{ignoreInvalidError:!0});break;case I.SLOT_DATA_VALIDATION:a=w({sheet:n,type:s,ranges:o},{dataValidation:!0})}Array.prototype.push.apply(t,a)}return t},n.isConflict=function(e){return this.sheetId===e.sheetId&&this.type===e.type},n.transformWithInsertDimensionMutation=function(e){if(!this.isConflict(e))return[this];for(var n,i=[],s=0,o=[];s<this.ranges.length;s++)(n=this.ranges[s].clone()).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),o.push(n);return i.push(new t({ranges:o,operation:this.operation,type:this.type,sheetId:this.sheetId,filterViewId:this.filterViewId})),i},n.transformWithDeleteDimensionMutation=function(e){if(!this.isConflict(e))return[this];for(var n,i=[],s=0,o=[];s<this.ranges.length;s++)(n=this.ranges[s].clone()).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),n.endIndex<n.startIndex||o.push(n);return 0===o.length||i.push(new t({ranges:o,operation:this.operation,type:this.type,sheetId:this.sheetId,filterViewId:this.filterViewId})),i},n.transformWithSetDimensionPropertiesMutation=function(e,n){if(!this.isConflict(e))return[this];var i,s=0,o=0,r=0,a=[],d=[];for(s=0;s<this.operation.length;s++){for(o=0;o<e.operation.length;o++)if(this.operation[s].slot===e.operation[o].slot){for(i=_(this.ranges,e.ranges,n),r=0;r<i.length;r++)d=i[r],a.push(new t({ranges:d,operation:[this.operation[s]],type:this.type,sheetId:this.sheetId,filterViewId:this.filterViewId}));o=0;break}0!==o&&a.push(new t({ranges:this.ranges,operation:[this.operation[s]],type:this.type,sheetId:this.sheetId,filterViewId:this.filterViewId}))}return a},n.transformWithMapRangeMutation=function(e){if(this.sheetId!==e.sourceSheetId)return[this];var n,i,s=[],o=0,r=[];if((0,d.O)(this.type,e)){if(this.type===m.ROWS)n=e.row;else{if(this.type!==m.COLUMNS)return console.warn("DIMENSION_TYPE error"),s;n=e.column}for(;o<this.ranges.length;o++)i=this.ranges[o].clone(),Array.prototype.push.apply(r,i.move({from:n.from,to:n.to}));s.push(new t({ranges:r,operation:this.operation,type:this.type,sheetId:this.sheetId,filterViewId:this.filterViewId}))}else s.push(this);return s},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDeleteFilterViewMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:this.filterViewId&&t&&this.filterViewId===e.filterViewId?[]:[this]},t}(r.Z);function _(e,t,n){var i,s=0,o=0,r=0,a=[];for(s=0;s<e.length;s++)for(o=0;o<t.length;o++){for(i=e[s].divideByCross(t[o]),r=0;r<i.ranges.length;r++)i.ranges[r].endIndex<i.ranges[r].startIndex&&(i.ranges.splice(r,1),r-=1);i.ranges.length&&a.push(i.ranges),n&&i.cross&&a.push([i.cross])}return a}function w(e,t){void 0===t&&(t=R);for(var n=[],i=e.sheet,s=e.type,o=e.ranges,r=e.filterView,a=0;a<o.length;a++)for(var d=o[a],u=d.startIndex,l=d.endIndex,h=u;h<=l;){var c=v({sheet:i,type:s,config:t,startIndex:h,maxIndex:l,filterView:r}),I=c.startIndex,f=c.endIndex,m=c.dimensionProperties;if(h=f+1,m){var g=M(m,t);g.length&&n.push(new S({ranges:[new p(d.sheetId,I,f,s)],operation:g,type:s,sheetId:d.sheetId,filterViewId:null===r||void 0===r?void 0:r.filterViewId}))}}return n}function v(e){var t=e.sheet,n=e.type,i=e.config,s=e.startIndex,o=e.maxIndex,r=null,a=e.filterView||t,d=a.getDimensionProperties(s,n);d||(d=r=i.needDefaultProperties?g.createInstance():null);for(var u=s+1;u<=o;u++){var l=a.getDimensionProperties(u,n)||r;if(!(d===l||d&&l&&d.equal(l,i)))break}return{startIndex:s,endIndex:u-1,dimensionProperties:d}}function M(e,t){var n=[];return t.pixelSize&&(e.pixelSize?n.push({slot:I.SLOT_SIZE,size:e.pixelSize}):t.clearDefaultSize?n.push({slot:I.SLOT_SIZE,size:null}):t.ignoreDefaultSize||n.push({slot:I.SLOT_SIZE,size:null})),t.hiddenByUser&&(e.hiddenByUser?n.push({slot:I.SLOT_HIDDEN,hidden:1}):t.ignoreDefaultHidden||n.push({slot:I.SLOT_HIDDEN,hidden:0})),t.formData&&(e.formData?n.push({slot:I.SLOT_FORMDATA,formData:e.formData}):n.push({slot:I.SLOT_FORMDATA,formData:null})),t.columnTypeMetadata&&n.push({slot:I.SLOT_COLUMN_TYPE_METADATA,columnTypeMetadata:e.columnTypeMetadata}),t.ignoreValidateRows&&void 0!==e.ignoreValidateRows&&n.push({slot:I.SLOT_IGNORE_VALIDATE_ROWS,ignoreValidateRows:e.ignoreValidateRows}),t.ignoreInvalidError&&void 0!==e.ignoreInvalidError&&n.push({slot:I.SLOT_IGNORE_INVALID_ERROR,ignoreInvalidError:e.ignoreInvalidError}),t.dataValidation&&n.push({slot:I.SLOT_DATA_VALIDATION,dataValidation:e.dataValidation}),n}S.protoMap={0:{name:"sheetId",dataType:String},1:{name:"ranges",dataType:{type:Array,subType:p}},2:{name:"operation",dataType:{type:Array,subType:{type:Object,protoMap:x}}},3:{name:"type",dataType:String}},t.ZP=S},"../packages/mutation/src/embedded/AddEmbeddedObjectMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/model/src/index.ts"),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/embedded/embeddedImageDataProtoMap.ts"),d=n("../packages/mutation/src/embedded/DeleteEmbeddedObjectMutation.ts"),u=s.Dimension.DIMENSION_TYPE,l=s.Range.DimensionRange,h=function(e){function t(t){var n;return(n=e.call(this,o.ZP.ADD_EMBEDDED_OBJECT_MUTATION,t)||this).data=t.data,n}(0,i.Z)(t,e),t.deserialize=function(e){var n={data:{type:e[0],sheetId:e[1],id:e[2],url:e[3],width:e[4],height:e[5],x:e[6],y:e[7],offsetX:e[8],offsetY:e[9],zIndex:e[10]}};return e[11]&&(n.data.clipInfo={clipTop:e[11][0],clipLeft:e[11][1],clipRight:e[11][2],clipBottom:e[11][3]}),new t(n)};var n=t.prototype;return n.serialize=function(){var e=[this.data.type,this.data.sheetId,this.data.id,this.data.url,this.data.width,this.data.height,this.data.x,this.data.y,this.data.offsetX,this.data.offsetY,this.data.zIndex];return this.data.clipInfo?e.push([this.data.clipInfo.clipTop,this.data.clipInfo.clipLeft,this.data.clipInfo.clipRight,this.data.clipInfo.clipBottom]):e.push(null),e},n.getAffectedSheetId=function(){return this.data.sheetId},n.setAffectedSheetId=function(e){this.data.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.data.sheetId);return n&&t.push(n),t},n.check=function(e){return e.imageManager.getImage(this.data.id)?{isValid:!1,errorMessage:"图片ID已经存在了 "+this.data.id}:{isValid:!0}},n.runOnSheet=function(e){e.imageManager.addImage(this.data)},n.invert=function(){var e=[];return e.push(new d.Z({key:this.data.id,sheetId:this.data.sheetId})),e},n.transformWithInsertDimensionMutation=function(e){if(this.data.sheetId!==e.sheetId)return[this];var n,i=[],s=this.data.sheetId;(n=e.type===u.ROWS?new l(s,this.data.y,this.data.y,e.type):new l(s,this.data.x,this.data.x,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type});var o=JSON.parse(JSON.stringify(this.data));return e.type===u.ROWS?o.y=n.startIndex:o.x=n.startIndex,i.push(new t({data:o})),i},n.transformWithDeleteDimensionMutation=function(e){if(this.data.sheetId!==e.sheetId)return[this];var n,i=[],s=this.data.sheetId;(n=e.type===u.ROWS?new l(s,this.data.y,this.data.y,e.type):new l(s,this.data.x,this.data.x,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type});var o=JSON.parse(JSON.stringify(this.data));return e.type===u.ROWS?o.y=n.startIndex:o.x=n.startIndex,i.push(new t({data:o})),i},n.transformWithAddEmbeddedObjectMutation=function(e,t){return this.data.sheetId,e.data.sheetId,[this]},n.transformWithDeleteEmbeddedObjectMutation=function(e){return this.data.sheetId,e.sheetId,[this]},n.transformWithUpdateEmbeddedObjectMutation=function(e){return this.data.sheetId,e.data.sheetId,[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.data.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDefineSheetRangeMutation=function(e){return this.data.sheetId,e.sheetId,[this]},n.transformWithUpdateSheetRangeMutation=function(e){return this.data.sheetId,e.sheetId,[this]},t}(r.Z);h.protoMap={0:{name:"data",dataType:{type:Object,protoMap:a.E}}},t.Z=h},"../packages/mutation/src/embedded/DeleteEmbeddedObjectMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/mutation/src/embedded/AddEmbeddedObjectMutation.ts"),a=function(e){function t(t){var n;return(n=e.call(this,s.ZP.DELETE_EMBEDDED_OBJECT_MUTATION,t)||this).key=t.key,n.sheetId=t.sheetId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({key:e[0],sheetId:e[1]})};var n=t.prototype;return n.serialize=function(){return[this.key,this.sheetId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.check=function(e){return e.imageManager.getImage(this.key)?{isValid:!0}:{isValid:!1,errorMessage:"图片key不存在 "+this.key}},n.runOnSheet=function(e){e.imageManager.deleteImage(this.key)},n.invert=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);if(null===n)return t;var i=n.imageManager.getImage(this.key);return i&&t.push(new r.Z({data:i.toObject()})),t},n.transformWithAddEmbeddedObjectMutation=function(e){return this.sheetId,e.data.sheetId,[this]},n.transformWithDeleteEmbeddedObjectMutation=function(e,t){if(this.sheetId!==e.sheetId)return[this];var n=[];return e.key!==this.key&&n.push(this),n},n.transformWithUpdateEmbeddedObjectMutation=function(e){return this.sheetId,e.data.sheetId,[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDefineSheetRangeMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=[];return t.push(this),t},n.transformWithUpdateSheetRangeMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=[];return t.push(this),t},t}(o.Z);a.protoMap={0:{name:"key",dataType:String},1:{name:"sheetId",dataType:String}},t.Z=a},"../packages/mutation/src/embedded/UpdateEmbeddedObjectMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/model/src/index.ts"),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/embedded/embeddedImageDataProtoMap.ts"),d=s.Dimension.DIMENSION_TYPE,u=s.Range.DimensionRange,l=function(e){function t(t){var n;return(n=e.call(this,o.ZP.UPDATE_EMBEDDED_OBJECT_MUTATION,t)||this).data=t.data,n}(0,i.Z)(t,e),t.deserialize=function(e){var n={data:{type:e[0],sheetId:e[1],id:e[2],url:e[3],width:e[4],height:e[5],x:e[6],y:e[7],offsetX:e[8],offsetY:e[9],zIndex:e[10]}};return e[11]&&(n.data.clipInfo={clipTop:e[11][0],clipLeft:e[11][1],clipRight:e[11][2],clipBottom:e[11][3]}),new t(n)};var n=t.prototype;return n.serialize=function(){var e=[this.data.type,this.data.sheetId,this.data.id,this.data.url,this.data.width,this.data.height,this.data.x,this.data.y,this.data.offsetX,this.data.offsetY,this.data.zIndex];return this.data.clipInfo?e.push([this.data.clipInfo.clipTop,this.data.clipInfo.clipLeft,this.data.clipInfo.clipRight,this.data.clipInfo.clipBottom]):e.push(null),e},n.getAffectedSheetId=function(){return this.data.sheetId},n.setAffectedSheetId=function(e){this.data.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.data.sheetId);return n&&t.push(n),t},n.check=function(e){return e.imageManager.getImage(this.data.id)?{isValid:!0}:{isValid:!1,errorMessage:"图片ID已经存在了 "+this.data.id}},n.runOnSheet=function(e){e.imageManager.updateImage(this.data)},n.invert=function(e){var n=[],i=e.sheetManager.getSheetBySheetId(this.data.sheetId);if(null===i)return n;var s=i.imageManager.getImage(this.data.id);return s&&n.push(new t({data:s.toObject()})),n},n.transformWithInsertDimensionMutation=function(e){if(this.data.sheetId!==e.sheetId)return[this];var n,i=[],s=this.data.sheetId;(n=e.type===d.ROWS?new u(s,this.data.y,this.data.y,e.type):new u(s,this.data.x,this.data.x,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type});var o=JSON.parse(JSON.stringify(this.data));return e.type===d.ROWS?o.y=n.startIndex:o.x=n.startIndex,i.push(new t({data:o})),i},n.transformWithDeleteDimensionMutation=function(e){if(this.data.sheetId!==e.sheetId)return[this];var n,i=[],s=this.data.sheetId;(n=e.type===d.ROWS?new u(s,this.data.y,this.data.y,e.type):new u(s,this.data.x,this.data.x,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type});var o=JSON.parse(JSON.stringify(this.data));return e.type===d.ROWS?o.y=n.startIndex:o.x=n.startIndex,i.push(new t({data:o})),i},n.transformWithAddEmbeddedObjectMutation=function(e){return this.data.sheetId,e.data.sheetId,[this]},n.transformWithDeleteEmbeddedObjectMutation=function(e){if(this.data.sheetId!==e.sheetId)return[this];var t=[];return e.key!==this.data.id&&t.push(this),t},n.transformWithUpdateEmbeddedObjectMutation=function(e,t){if(this.data.sheetId!==e.data.sheetId)return[this];var n=[];return(e.data.id!==this.data.id||t)&&n.push(this),n},n.transformWithDeleteSheetMutation=function(e,t){return this.data.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDefineSheetRangeMutation=function(e){return this.data.sheetId,e.sheetId,[this]},n.transformWithUpdateSheetRangeMutation=function(e){return this.data.sheetId,e.sheetId,[this]},t}(r.Z);l.protoMap={0:{name:"data",dataType:{type:Object,protoMap:a.E}}},t.Z=l},"../packages/mutation/src/embedded/embeddedImageDataProtoMap.ts":function(e,t,n){"use strict";n.d(t,{E:function(){return s}}),n("../node_modules/core-js/modules/es.number.constructor.js");var i=n("../packages/model/src/index.ts").Embedded.EmbeddedImageClip,s={0:{name:"type",dataType:String},1:{name:"sheetId",dataType:"sheetId"},2:{name:"id",dataType:String},3:{name:"url",dataType:String},4:{name:"width",dataType:Number},5:{name:"height",dataType:Number},6:{name:"x",dataType:Number},7:{name:"y",dataType:Number},8:{name:"offsetX",dataType:Number},9:{name:"offsetY",dataType:Number},10:{name:"zIndex",dataType:Number},11:{name:"clipInfo",dataType:i}}},"../packages/mutation/src/filter-view/active-filter-view-mutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=function(e){function t(t){var n;return(n=e.call(this,s.ZP.ACTIVE_FILTER_VIEW_MUTATION,t)||this).sheetId=t.sheetId,n.filterViewId=t.filterViewId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],filterViewId:e[1]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.filterViewId]},n.isNonPersistedLocalChange=function(){return!0},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){this.filterViewId&&!e.filterViewManager.getFilterViewByViewId(this.filterViewId)||e.filterViewManager.setActiveFilterViewId(this.filterViewId)},n.invert=function(e){var n=e.sheetManager.getSheetBySheetId(this.sheetId);return this.originFilterViewId=n?n.filterViewManager.getActiveFilterViewId():"",[new t({sheetId:this.sheetId,filterViewId:this.originFilterViewId})]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId===e.sheetId&&t?[]:[this]},n.transformWithDeleteFilterViewMutation=function(e,t){return this.sheetId===e.sheetId&&this.filterViewId===e.filterViewId&&t?[]:[this]},t}(n("../packages/mutation/src/Mutation.ts").Z);t.Z=o},"../packages/mutation/src/filter-view/add-filter-view-mutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/model/src/filter-view/filter-view.ts"),a=n("../packages/model/src/filter-view/filter-view-delta.ts"),d=n("../packages/mutation/src/filter-view/delete-filter-view-mutation.ts"),u=function(e){function t(t){var n;return(n=e.call(this,s.ZP.ADD_FILTER_VIEW_MUTATION,t)||this).sheetId=t.sheetId,n.filterViewId=t.filterViewId,n.creatorId=t.creatorId,n.filterViewDelta=t.filterViewDelta,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],filterViewId:e[1],filterViewDelta:e[2]?a.Z.deserialize(e[2]):void 0,creatorId:e[3]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.filterViewId,this.filterViewDelta?this.filterViewDelta.serialize():void 0,this.creatorId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){var t,n=(null===(t=this.filterViewDelta)||void 0===t?void 0:t.getName())||"",i=new r.Z({sheetId:this.sheetId,filterViewId:this.filterViewId,creatorId:this.creatorId,filterViewName:n,sheetReference:e,basicFilter:null});this.filterViewDelta&&this.filterViewDelta.applyToFilterView(i),e.filterViewManager.addOrUpdateFilterView(i)},n.invert=function(){var e=[],t=new d.Z({filterViewId:this.filterViewId,sheetId:this.sheetId});return e.push(t),e},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId===e.sheetId&&t?[]:[this]},t}(o.Z);t.Z=u},"../packages/mutation/src/filter-view/delete-filter-view-mutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/model/src/filter-view/filter-view-delta.ts"),a=n("../packages/mutation/src/filter-view/utils.ts"),d=n("../packages/mutation/src/filter-view/add-filter-view-mutation.ts"),u=function(e){function t(t){var n;return(n=e.call(this,s.ZP.DELETE_FILTER_VIEW_MUTATION,t)||this).sheetId=t.sheetId,n.filterViewId=t.filterViewId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],filterViewId:e[1]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.filterViewId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){e.filterViewManager.deleteFilterView(this.filterViewId)},n.invert=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);if(!n)return t;var i=n.filterViewManager.getFilterViewByViewId(this.filterViewId);if(!i)return t;var s=new r.Z({sheetId:this.sheetId,filterViewId:this.filterViewId}),o=i.getBasicFilter();o&&s.setBasicFilter((0,a.F)(o));var u=i.getFilterViewName();u&&s.setName(u);var l=new d.Z({sheetId:this.sheetId,filterViewId:this.filterViewId,creatorId:i.creatorId,filterViewDelta:s});return t.push(l),t},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId===e.sheetId&&t?[]:[this]},t}(o.Z);t.Z=u},"../packages/mutation/src/filter-view/update-filter-view-mutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/model/src/filter-view/filter-view-delta.ts"),a=n("../packages/mutation/src/filter-view/utils.ts"),d=function(e){function t(t){var n;return(n=e.call(this,s.ZP.UPDATE_FILTER_VIEW_MUTATION,t)||this).sheetId=t.sheetId,n.filterViewId=t.filterViewId,n.filterViewDelta=t.filterViewDelta,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],filterViewId:e[1],filterViewDelta:r.Z.deserialize(e[2])})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.filterViewId,this.filterViewDelta.serialize()]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){var t=e.filterViewManager.getFilterViewByViewId(this.filterViewId);t&&this.filterViewDelta.applyToFilterView(t)},n.invert=function(e){var n=[],i=e.sheetManager.getSheetBySheetId(this.sheetId);if(!i)return n;var s=i.filterViewManager.getFilterViewByViewId(this.filterViewId);if(!s)return n;var o=new r.Z({sheetId:this.sheetId,filterViewId:this.filterViewId,filterViewName:s.getFilterViewName()}),d=s.getBasicFilter();d&&o.setBasicFilter((0,a.F)(d));var u=new t({sheetId:this.sheetId,filterViewId:this.filterViewId,filterViewDelta:o});return n.push(u),n},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId===e.sheetId&&t?[]:[this]},t}(o.Z);t.Z=d},"../packages/mutation/src/filter-view/utils.ts":function(e,t,n){"use strict";function i(e){return{range:e.range,workbookRangeId:e.workbookRangeId,criteriaMap:e.criteriaMap,hiddenRows:e.getHiddenRows(),sortSpecs:e.sortSpecs,filterViewId:e.filterViewReference.filterViewId}}n.d(t,{F:function(){return i}})},"../packages/mutation/src/filter/DefineFilterMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=(n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../packages/model/src/index.ts")),r=n("../packages/mutation/src/MutationId.ts"),a=n("../packages/mutation/src/Mutation.ts"),d=n("../packages/common-utils/src/index.ts"),u=n("../packages/mutation/src/utils/index.ts"),l=n("../packages/mutation/src/filter/DeleteFilterMutation.ts"),h=n("../packages/model/src/filter/utils.ts"),c=n("../packages/mutation/src/filter/utils.ts"),I=o.Dimension.DIMENSION_TYPE,f=o.Filter.BasicFilter,m=o.Range.GridRange;function g(e){var t=e.gridRange,n=e.workbookRangeId,i=e.criteriaDelta,s=e.hiddenRows,o=e.sortSpecs,r=e.sheet,a=e.filterView,d=i?function(e){var t=new Map;return Object.keys(e).forEach((function(n){var i=parseInt(n,10),s=e[n];t.set(i,(0,h.b)(s))})),t}(i):void 0;return new f({range:t,hiddenRows:s,workbookRangeId:n,criteriaMap:d,sortSpecs:o,sheetReference:r,filterViewReference:a})}var p=function(e){var t=[e.defaultFilterId||"",e.hiddenRows||[],e.oldFilterViewId||""],n=Object.keys(e.criteriaDelta||{}),i={};return n.forEach((function(t){var n=e.criteriaDelta[t];i[t]=[!1===n.visibleByDefault?0:1].concat((0,s.Z)((0,h.b)(n).serialize()))})),t.push(i),t},R=function(e){var t={defaultFilterId:e[0],hiddenRows:e[1],oldFilterViewId:e[2]},n=e[3],i=Object.keys(n),s={};return i.forEach((function(e){var t=n[e];s[e]=Object.assign({visibleByDefault:!!t[0]},(0,h.z)(t.slice(1)))})),t.criteriaDelta=s,t},x=function(e){function t(t){var n;return(n=e.call(this,r.ZP.DEFINE_FILTER_MUTATION,t)||this).sheetId=t.sheetId,n.delta=t.delta,n.gridRange=t.gridRange,n.sortSpecs=t.sortSpecs||[],n.nonPersistingLocalChange=!!t.nonPersistingLocalChange,n.filterViewId=t.filterViewId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],gridRange:m.deserialize(e[1]),delta:R(e[2]),sortSpecs:c.j.deserialize(e[3])||[],filterViewId:e[4]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.gridRange.serialize(),p(this.delta),c.j.serialize(this.sortSpecs),this.filterViewId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e,this.gridRange.sheetId=e},n.getAffectedSheets=function(e){var t=this.sheetId,n=e.sheetManager.getSheetBySheetId(t);return n?[n]:[]},n.check=function(t){var n=e.prototype.check.call(this,t);if(!n.isValid)return n;var i=this.gridRange;if(!(0,d.hj)(i.startRowIndex)||!(0,d.hj)(i.endRowIndex)||!(0,d.hj)(i.startColIndex)||!(0,d.hj)(i.endColIndex))return{isValid:!1,errorMessage:"gridRange index类型不是数字 girdRange="+JSON.stringify(i)};var s=t.properties.gridProperties;return i.startRowIndex<0||i.startRowIndex>=s.rowCount||i.endRowIndex>=s.rowCount||i.startColIndex<0||i.startColIndex>=s.colCount||i.endColIndex>=s.colCount?{isValid:!1,errorMessage:"gridRange 范围不正确。 gridRange="+JSON.stringify(i)+" gridProperties="+JSON.stringify(s)}:{isValid:!0}},n.runOnSheet=function(e){var t=this.delta.defaultFilterId;if(t){var n=this.delta,i=n.criteriaDelta,s=n.hiddenRows,o=this.gridRange,r=this.sortSpecs,a=g({gridRange:o.clone(),workbookRangeId:t,criteriaDelta:i,hiddenRows:s,sortSpecs:r,sheet:e,filterView:e.filterViewManager.getFilterViewByViewId(this.filterViewId)}),d=this.isNonPersistedLocalChange();a.setIsLocalView(d),e.setBasicFilter(a,this.filterViewId)}},n.invert=function(){var e=this.sheetId,t=this.filterViewId,n=this.delta.defaultFilterId;return n?[new l.Z({sheetId:e,filterViewId:t,delta:{defaultFilterId:n},nonPersistingLocalChange:this.isNonPersistedLocalChange()})]:[]},n.transformWithInsertDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n=e.type,i=e.index,s=e.amount,o=e.sheetId,r=this.gridRange.clone();r.insertDimension({sheetId:o,type:n,index:i,amount:s});var a=function(e,t){var n=e.type,i=e.index,s=e.amount,o=!1;if(n===I.COLUMNS&&null!=t.criteriaDelta){o=!1;var r=t.criteriaDelta;if(r&&Object.keys(r).length>0){var a=Object.keys(r),d=a.filter((function(e){return parseInt(e,10)>i})).length>0;if(o=o||d,d){var u=a.reduce((function(e,t){return e[parseInt(t,10)>i?parseInt(t,10)+s:t]=r[parseInt(t,10)],e}),{});t.criteriaDelta=u}}if(o)return t.hiddenRows=[],t}return t}({type:n,index:i,amount:s},this.delta);return[new t({gridRange:r,delta:a,sheetId:o,filterViewId:this.filterViewId})]},n.transformWithDeleteDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n=e.type,i=e.index,s=e.amount,o=e.sheetId,r=this.gridRange.clone();r.deleteDimension({sheetId:o,type:n,index:i,amount:s});var a=function(e,t){var n=e.type,i=e.index,s=e.amount,o=!1;if(n===I.COLUMNS&&null!=t.criteriaDelta){o=!1;var r=t.criteriaDelta;if(r&&Object.keys(r).length>0){var a=Object.keys(r),d=a.filter((function(e){return parseInt(e,10)>i})).length>0;if(o=o||d,d){var u=a.reduce((function(e,t){return e[parseInt(t,10)>i?parseInt(t,10)-s:t]=r[parseInt(t,10)],e}),{});t.criteriaDelta=u,t.hiddenRows=[]}}if(o)return t}return t}({type:n,index:i,amount:s},this.delta);return[new t({gridRange:r,delta:a,sheetId:o,filterViewId:this.filterViewId})]},n.transformWithMergeCellsMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var t=e.startColIndex,n=e.startRowIndex,i=e.endColIndex,s=e.endRowIndex,o=e.sheetId;return new m(o,n,s,t,i).isCross(this.gridRange)?[]:[this]},n.transformWithDefineFilterMutation=function(e,t){return this.gridRange.sheetId!==e.sheetId?[this]:(0,u.ZG)(e.delta.defaultFilterId||e.delta.oldFilterViewId,this.delta.defaultFilterId||this.delta.oldFilterViewId)?[]:t?[this]:[]},n.transformWithDeleteFilterMutation=function(e){return this.gridRange.sheetId!==e.sheetId?[this]:(0,u.ZG)(e.delta.defaultFilterId||e.delta.oldFilterViewId,this.delta.defaultFilterId||this.delta.oldFilterViewId)?[]:[this]},n.transformWithUpdateFilterMutation=function(e){return this.gridRange.sheetId,e.sheetId,[this]},n.transformWithReorderRangeMutation=function(e){return this.gridRange.sheetId,e.sheetId,[this]},n.transformWithMapRangeMutation=function(e){return this.gridRange.sheetId,e.sourceSheetId,[this]},n.transformWithDeleteFilterViewMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:this.filterViewId&&t&&this.filterViewId===e.filterViewId?[]:[this]},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},t}(a.Z);t.ZP=x},"../packages/mutation/src/filter/DeleteFilterMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/model/src/sheet/sheetTransToMutationsUtils.ts"),a=function(e){function t(t){var n;return(n=e.call(this,s.ZP.DELETE_FILTER_MUTATION,t)||this).sheetId=t.sheetId,n.delta=t.delta,n.nonPersistingLocalChange=!!t.nonPersistingLocalChange,n.filterViewId=t.filterViewId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],delta:{defaultFilterId:e[1][0]},filterViewId:e[2]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,[this.delta.defaultFilterId||""],this.filterViewId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=this.sheetId,n=e.sheetManager.getSheetBySheetId(t);return n?[n]:[]},n.runOnSheet=function(e){this.delta.defaultFilterId&&e.clearBasicFilter(this.filterViewId)},n.invert=function(e){var t=this.delta.defaultFilterId,n=this.sheetId,i=this.filterViewId,s=e.sheetManager.getSheetBySheetId(n);return s&&t?(0,r.QT)(s,!1,{nonPersistingLocalChange:this.isNonPersistedLocalChange()},i):[]},n.transformWithDefineFilterMutation=function(e){return this.sheetId,e.gridRange.sheetId,[this]},n.transformWithDeleteFilterMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateFilterMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithDeleteFilterViewMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:this.filterViewId&&t&&this.filterViewId===e.filterViewId?[]:[this]},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},t}(o.Z);t.Z=a},"../packages/mutation/src/filter/SwitchFilterSyncMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/Mutation.ts"),o=n("../packages/mutation/src/MutationId.ts"),r=function(e){function t(t){var n;return(n=e.call(this,o.ZP.SWITCH_FILTER_SYNC_MUTATION,t)||this).isOn=t.isOn,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({isOn:e[0]})};var n=t.prototype;return n.getAffectedSheetId=function(){return"WORKBOOK"},n.getAffectedSheets=function(){return[]},n.invert=function(){return[new t({isOn:!this.isOn})]},n.runOnSheet=function(){},n.runOnWorkbook=function(e){return e.isFilterSync=this.isOn,!0},n.serialize=function(){return[this.isOn]},n.transformWithSwitchFilterSyncMutation=function(e,t){return t?[this]:[]},t}(s.Z);t.Z=r},"../packages/mutation/src/filter/UpdateFilterMutation.ts":function(e,t,n){"use strict";n.d(t,{Jl:function(){return I},Qn:function(){return i}});var i,s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),r=(n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.array.sort.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../packages/model/src/index.ts")),a=n("../packages/mutation/src/MutationId.ts"),d=n("../packages/mutation/src/Mutation.ts"),u=n("../packages/mutation/src/utils/index.ts"),l=n("../packages/model/src/filter/utils.ts"),h=n("../packages/mutation/src/filter/utils.ts"),c=r.Range.GridRange;function I(e,t){var n=e.criteria,i=e.columnIndex;return e.clear?(t.deleteColFilterCriteria(i),t):(n&&t.setColFilterCriteria(i,(0,l.b)(n)),t)}!function(e){e[e.UPDATE=1]="UPDATE",e[e.RECAL=2]="RECAL"}(i||(i={}));var f=function(e){var t;return[e.defaultFilterId||"",e.hiddenRows||null,e.range?e.range.serialize():null,(null===(t=e.updateColumnCriteriaDelta)||void 0===t?void 0:t.length)?e.updateColumnCriteriaDelta.map((function(e){var t=e.columnIndex,n=e.clear,i=e.criteria;return[t,n?1:0,i?[!1===i.visibleByDefault?0:1].concat((0,o.Z)((0,l.b)(i).serialize())):null]})):null]},m=function(e){var t,n={defaultFilterId:e[0]};return e[1]&&(n.hiddenRows=e[1]),e[2]&&(n.range=c.deserialize(e[2])),e[3]&&(t=(0,u.kJ)(e[3][0])?e[3]:[e[3]],n.updateColumnCriteriaDelta=t.map((function(e){return{columnIndex:e[0],clear:!!e[1],criteria:e[2]?Object.assign({visibleByDefault:!!e[2][0]},(0,l.z)(e[2].slice(1))):void 0}}))),n},g=function(e){function t(t){var n;(n=e.call(this,a.ZP.UPDATE_FILTER_MUTATION,t)||this).workbookRangeId=t.workbookRangeId,n.updateType=t.updateType,n.sheetId=t.sheetId,n.filterViewId=t.filterViewId;var i=t.delta.updateColumnCriteriaDelta;return i&&!(0,u.kJ)(i)?n.delta=Object.assign(Object.assign({},t.delta),{updateColumnCriteriaDelta:[i]}):n.delta=Object.assign(Object.assign({},t.delta),{updateColumnCriteriaDelta:i}),n.delta.hiddenRows&&n.delta.hiddenRows.sort((function(e,t){return e-t})),n.sortSpecs=t.sortSpecs||null,n.nonPersistingLocalChange=!!t.nonPersistingLocalChange,n}(0,s.Z)(t,e),t.deserialize=function(e){return new t({workbookRangeId:e[0],updateType:e[1],sheetId:e[2],delta:m(e[3]),sortSpecs:h.j.deserialize(e[4]),filterViewId:e[5]})};var n=t.prototype;return n.serialize=function(){return[this.workbookRangeId,this.updateType,this.sheetId,f(this.delta),h.j.serialize(this.sortSpecs),this.filterViewId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=this.sheetId,n=e.sheetManager.getSheetBySheetId(t);return n?[n]:[]},n.runOnSheet=function(e){this.updateType!==i.UPDATE&&this.updateType!==i.RECAL||this.delta.defaultFilterId&&this.updateBasicFilter(this.delta,e)},n.updateBasicFilter=function(e,t){var n=e.hiddenRows,i=e.updateColumnCriteriaDelta,s=e.defaultFilterId,o=e.range,r=this.filterViewId?t.getBasicFilterInFilterView(this.filterViewId):t.getBasicFilterInSheet(!1);s&&r&&(i&&(((0,u.kJ)(i)?i:[i]).forEach((function(e){I(e,r)})),this.nonPersistingLocalChange||r.updateCacheCriteria(),t.setBasicFilter(r,this.filterViewId)),n&&(r.setHiddenRows(n),this.nonPersistingLocalChange||r.updateCacheHiddenRows(),t.setBasicFilter(r,this.filterViewId)),o&&(o.endRowIndex>=t.getRowCount()&&(o.endRowIndex=t.getRowCount()-1),o.endColIndex>=t.getColCount()&&(o.endColIndex=t.getColCount()-1),r.range=o.clone()),null!==this.sortSpecs&&(r.sortSpecs=this.sortSpecs,t.setBasicFilter(r,this.filterViewId)))},n.invert=function(e){if(this.updateType!==i.UPDATE&&this.updateType!==i.RECAL)return[];var t=this.sheetId,n=this.workbookRangeId,s=this.updateType,o=this.nonPersistingLocalChange,r=this.delta,a=this.filterViewId,d=r.defaultFilterId,u=e.sheetManager.getSheetBySheetId(t);if(!function(e,t,n){if(!e)return!1;var i=e.getBasicFilter(!1,t);return!(!n||!i)}(u,a,d))return[];var l=u.getBasicFilter(!1,a),h={workbookRangeId:n,sheetId:t,filterViewId:a,updateType:s,nonPersistingLocalChange:o,sortSpecs:l.sortSpecs,delta:{defaultFilterId:d}};return this.getInvertResult(l,h)},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},n.transformWithInsertDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=e.sheetId,n=e.type,i=e.index,s=e.amount,o=this.delta.range;if(o){var r=o.clone();r.insertDimension({sheetId:t,type:n,index:i,amount:s})}return[this]},n.transformWithDeleteDimensionMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithMergeCellsMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithDefineFilterMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithDeleteFilterMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateFilterMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithReorderRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithMapRangeMutation=function(e){return this.sheetId,e.sourceSheetId,[this]},n.transformWithDeleteFilterViewMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:this.filterViewId&&t&&this.filterViewId===e.filterViewId?[]:[this]},n.getInvertResult=function(e,n){var i=this.delta,s=i.hiddenRows,o=i.updateColumnCriteriaDelta,r=i.range,a=!1;if(o){var d=o.map((function(t){var n=t.columnIndex,i=e.getColFilterCriteria(n),s={columnIndex:n};return i?s.criteria=i:s.clear=!0,s}));n.delta.updateColumnCriteriaDelta=d,n.delta.range=e.range.clone(),a=!0}if(s){var u=e.getHiddenRows();n.delta.hiddenRows=u,n.delta.range=e.range.clone(),a=!0}if(r){var l=e.range;n.delta.range=l,a=!0}return this.sortSpecs&&(a=!0),a?[new t(n)]:[]},t}(d.Z);t.ZP=g},"../packages/mutation/src/filter/utils.ts":function(e,t,n){"use strict";n.d(t,{j:function(){return i}}),n("../node_modules/core-js/modules/es.array.map.js");var i={serialize:function(e){return e?e.map((function(e){return[e.dimensionIndex,e.sortOrder]})):null},deserialize:function(e){return e?e.map((function(e){return{dimensionIndex:e[0],sortOrder:e[1]}})):null}}},"../packages/mutation/src/index.ts":function(e,t,n){"use strict";n.d(t,{Dm:function(){return s.D},G1:function(){return I.Z},MC:function(){return m.ZP},OZ:function(){return E.Z},XS:function(){return u.Z},Xd:function(){return T.Z},Y0:function(){return c.Z},dc:function(){return f.Z},eU:function(){return x.Z},fN:function(){return l.ZP},ff:function(){return g.Z},g8:function(){return r.Z},jZ:function(){return R.Z},kP:function(){return p.Z},kS:function(){return o.Z},mm:function(){return a.Z},qi:function(){return h.Z},uU:function(){return d.Z},xF:function(){return i.ZP}});var i=n("../packages/mutation/src/MutationId.ts"),s=n("../packages/mutation/src/api.interface.ts"),o=n("../packages/mutation/src/api.ts"),r=n("../packages/mutation/src/MutationOperationType.ts"),a=n("../packages/mutation/src/Mutation.ts"),d=n("../packages/mutation/src/dimension/InsertDimensionMutation.ts"),u=n("../packages/mutation/src/dimension/DeleteDimensionMutation.ts"),l=n("../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts"),h=n("../packages/mutation/src/cell/SetRangeMutation.ts"),c=n("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),I=(n("../packages/mutation/src/merge/MergeCellsMutation.ts"),n("../packages/mutation/src/merge/UnmergeCellsMutation.ts"),n("../packages/mutation/src/embedded/AddEmbeddedObjectMutation.ts"),n("../packages/mutation/src/embedded/DeleteEmbeddedObjectMutation.ts")),f=(n("../packages/mutation/src/embedded/UpdateEmbeddedObjectMutation.ts"),n("../packages/mutation/src/sheet/InsertSheetMutation.ts"),n("../packages/mutation/src/sheet/DeleteSheetMutation.ts"),n("../packages/mutation/src/sheet/MoveSheetMutation.ts"),n("../packages/mutation/src/sheet/SetSheetPropertiesMutation.ts")),m=(n("../packages/mutation/src/sheet/UpdateAllSheetsMutation.ts"),n("../packages/mutation/src/sheet/DefineSheetRangeMutation.ts"),n("../packages/mutation/src/sheet/DeleteSheetRangeMutation.ts"),n("../packages/mutation/src/sheet/UpdateSheetRangeMutation.ts"),n("../packages/mutation/src/workbook/SetWorkbookPropertiesMutation.ts"),n("../packages/mutation/src/other/InitDataMutation.ts"),n("../packages/mutation/src/other/CopyPasteMutation.ts"),n("../packages/mutation/src/other/ReorderRangeMutation.ts"),n("../packages/mutation/src/other/MapRangeMutation.ts"),n("../packages/mutation/src/filter/DefineFilterMutation.ts"),n("../packages/mutation/src/filter/DeleteFilterMutation.ts"),n("../packages/mutation/src/filter/UpdateFilterMutation.ts")),g=n("../packages/mutation/src/filter/SwitchFilterSyncMutation.ts"),p=(n("../packages/mutation/src/other/EmptyMutation.ts"),n("../packages/mutation/src/conditionalFormat/AddConditionalFormatMutation.ts")),R=n("../packages/mutation/src/conditionalFormat/DeleteConditionalFormatMutation.ts"),x=n("../packages/mutation/src/conditionalFormat/UpdateConditionalFormatMutation.ts"),E=n("../packages/mutation/src/workbook/workbookRange/DefineWorkbookRangeMutation.ts"),T=(n("../packages/mutation/src/workbook/workbookRange/UpdateWorkbookRangeMutation.ts"),n("../packages/mutation/src/workbook/workbookRange/DeleteWorkbookRangeMutation.ts"));n("../packages/mutation/src/new-embedded/NewAddEmbeddedObjectMutation.ts"),n("../packages/mutation/src/new-embedded/NewDeleteEmbeddedObjectMutation.ts"),n("../packages/mutation/src/new-embedded/NewUpdateEmbeddedObjectMutation.ts"),n("../packages/mutation/src/filter-view/add-filter-view-mutation.ts"),n("../packages/mutation/src/filter-view/delete-filter-view-mutation.ts"),n("../packages/mutation/src/filter-view/update-filter-view-mutation.ts"),n("../packages/mutation/src/filter-view/active-filter-view-mutation.ts")},"../packages/mutation/src/merge/MergeCellsMutation.ts":function(e,t,n){"use strict";n.d(t,{g:function(){return R}});var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.sort.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/other/mapRangeMutationUtil.ts"),d=n("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),u=n("../packages/mutation/src/merge/UnmergeCellsMutation.ts"),l=n("../packages/mutation/src/filter/DeleteFilterMutation.ts"),h=n("../packages/mutation/src/conditionalFormat/UpdateConditionalFormatMutation.ts"),c=s.Range.GridRange,I=s.Dimension.DIMENSION_TYPE,f=s.Cell.CellDataDelta,m=s.Cell.CELL_DATA_SLOT_COMPOSE,g=s.Rule.ConditionalFormatRule,p=function(e){function t(t){var n;return(n=e.call(this,o.ZP.MERGE_CELLS_MUTATION,t)||this).sheetId=t.sheetId,n.startRowIndex=t.startRowIndex,n.endRowIndex=t.endRowIndex,n.startColIndex=t.startColIndex,n.endColIndex=t.endColIndex,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],startRowIndex:e[1],endRowIndex:e[2],startColIndex:e[3],endColIndex:e[4]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.check=function(e){var t=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex);if(!t.isValid())return{isValid:!1,errorMessage:"GridRange值非法 gridRange="+JSON.stringify(t)};var n=e.properties.gridProperties;return this.endRowIndex>=n.rowCount||this.endColIndex>=n.colCount?{isValid:!1,errorMessage:"行列范围不正确。 endRowIndex="+this.endRowIndex+"  endRowIndex="+this.endColIndex+" gridProperties="+JSON.stringify(n)}:{isValid:!0}},n.runOnSheet=function(e){e.mergeManager.addMerge(new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex))},n.invert=function(e){return[new u.Z({startRowIndex:this.startRowIndex,endRowIndex:this.endRowIndex,startColIndex:this.startColIndex,endColIndex:this.endColIndex,sheetId:this.sheetId})]},n.transformWithInsertDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex);return n.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({startRowIndex:n.startRowIndex,endRowIndex:n.endRowIndex,startColIndex:n.startColIndex,endColIndex:n.endColIndex,sheetId:this.sheetId})]},n.transformWithDeleteDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex);return n.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),!n.isValid()||n.isSingle()?[]:[new t({startRowIndex:n.startRowIndex,endRowIndex:n.endRowIndex,startColIndex:n.startColIndex,endColIndex:n.endColIndex,sheetId:this.sheetId})]},n.transformWithSetRangeMutation=function(e,t){if(this.sheetId!==e.gridRange.sheetId)return[this];var n,i,s,o=[],r=e.cellDataDeltaAtPositions,a=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex);if(a.isCross(e.gridRange)){if(t){for(n=0;n<r.length;n++)0!==(i=r[n]).cellDataDelta.setSlots&&(s=new c(this.sheetId,i.rowIndex,i.rowIndex,i.colIndex,i.colIndex),a.isCross(s)&&o.push(new d.Z({gridRange:s,cellDataDelta:new f({setSlots:0,clearSlots:m.ALL})})));o.push(this)}}else o.push(this);return o},n.transformWithSetCellPropertiesMutation=function(e,t){if(this.sheetId!==e.gridRange.sheetId)return[this];var n,i,s=[],o=[],r=[];if(0===e.cellDataDelta.setSlots)s.push(this);else{for(o=R(new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex)),n=0;n<o.length;n++)(i=o[n].getCross(e.gridRange))&&r.push(i);if(r.length>0){if(t){for(n=0;n<r.length;n++)s.push(new d.Z({gridRange:r[n],cellDataDelta:new f({setSlots:0,clearSlots:m.ALL})}));s.push(this)}}else s.push(this)}return s},n.transformWithMergeCellsMutation=function(e,t){if(this.sheetId!==e.sheetId)return[this];var n=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex),i=new c(e.sheetId,e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex);return n.isCross(i)?t?[new u.Z({startRowIndex:e.startRowIndex,endRowIndex:e.endRowIndex,startColIndex:e.startColIndex,endColIndex:e.endColIndex,sheetId:e.sheetId}),this]:[]:[this]},n.transformWithUnmergeCellsMutation=function(e,t){if(this.sheetId!==e.sheetId)return[this];var n=[],i=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex),s=new c(e.sheetId,e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex);return i.isCross(s)?t&&n.push(e,this):n.push(this),n},n.transformWithDefineFilterMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=[];return new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex).isCross(e.gridRange)&&t.push(new l.Z({sheetId:e.sheetId,delta:{defaultFilterId:e.delta.defaultFilterId,oldFilterViewId:e.delta.oldFilterViewId}})),t.push(this),t},n.transformWithCopyPasteMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=[];return t.push(this),t},n.transformWithReorderRangeMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=[];return new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex).isCross(e.range)||t.push(this),t},n.transformWithMapRangeMutation=function(e){if(this.sheetId!==e.sourceSheetId)return[this];var t=[];return(0,a.O)(I.ROWS,e)||(0,a.O)(I.COLUMNS,e)||t.push(this),t},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDefineSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithAddConditionalFormatMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex),n=e.rule.ruleRanges;if(n.some((function(e){return e.isCross(t)}))){var i=new c(this.sheetId,this.startRowIndex,this.startRowIndex,this.startColIndex,this.startColIndex);if(n.some((function(e){return e.contain(i)})))return[this];var s=[];return e.rule.ruleRanges.forEach((function(e){if(e.sheetId===t.sheetId&&e.isCross(t)){var n=e.startRowIndex,i=e.endRowIndex;e.startRowIndex<t.startRowIndex&&(s.push(new c(e.sheetId,e.startRowIndex,t.startRowIndex,e.startColIndex,e.endColIndex)),n=t.startRowIndex),t.endRowIndex<e.endRowIndex&&(s.push(new c(e.sheetId,t.endRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex)),i=t.endRowIndex),e.startColIndex<t.startColIndex&&s.push(new c(e.sheetId,n,i,e.startColIndex,t.endColIndex)),t.endColIndex<e.endColIndex&&s.push(new c(e.sheetId,n,i,t.endColIndex,e.endColIndex))}else s.push(e)})),0===s.length?[this]:(s.sort((function(e,t){return e.startRowIndex<t.startRowIndex||e.startColIndex<t.startColIndex||e.endRowIndex<t.endRowIndex?-1:e.endColIndex-t.endColIndex})),[this,new h.Z({sheetId:e.sheetId,ruleIndex:e.ruleIndex,rule:new g({ruleRanges:s,booleanConditionalFormat:e.rule.booleanConditionalFormat,gradientConditionalFormat:e.rule.gradientConditionalFormat,dataBarConditionalFormat:e.rule.dataBarConditionalFormat}),oldRuleRanges:e.rule.ruleRanges})])}return[this]},n.transformWithUpdateConditionalFormatMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=new c(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex),n=e.rule.ruleRanges;if(n.some((function(e){return e.isCross(t)}))){var i=new c(this.sheetId,this.startRowIndex,this.startRowIndex,this.startColIndex,this.startColIndex);if(n.some((function(e){return e.contain(i)})))return[this];var s=[];return e.rule.ruleRanges.forEach((function(e){if(e.sheetId===t.sheetId&&e.isCross(t)){var n=e.startRowIndex,i=e.endRowIndex;e.startRowIndex<t.startRowIndex&&(s.push(new c(e.sheetId,e.startRowIndex,t.startRowIndex,e.startColIndex,e.endColIndex)),n=t.startRowIndex),t.endRowIndex<e.endRowIndex&&(s.push(new c(e.sheetId,t.endRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex)),i=t.endRowIndex),e.startColIndex<t.startColIndex&&s.push(new c(e.sheetId,n,i,e.startColIndex,t.endColIndex)),t.endColIndex<e.endColIndex&&s.push(new c(e.sheetId,n,i,t.endColIndex,e.endColIndex))}else s.push(e)})),0===s.length?[this]:(s.sort((function(e,t){return e.startRowIndex<t.startRowIndex||e.startColIndex<t.startColIndex||e.endRowIndex<t.endRowIndex?-1:e.endColIndex-t.endColIndex})),[this,new h.Z({sheetId:e.sheetId,ruleIndex:e.ruleIndex,rule:new g({ruleRanges:s,booleanConditionalFormat:e.rule.booleanConditionalFormat,gradientConditionalFormat:e.rule.gradientConditionalFormat,dataBarConditionalFormat:e.rule.dataBarConditionalFormat}),oldRuleRanges:e.rule.ruleRanges})])}return[this]},t}(r.Z);function R(e){var t=[],n=e.sheetId,i=e.startRowIndex,s=e.endRowIndex,o=e.startColIndex,r=e.endColIndex;return s>i&&t.push(new c(n,i+1,s,o,r)),r>o&&t.push(new c(n,i,i,o+1,r)),t}p.protoMap={0:{name:"sheetId",dataType:String},1:{name:"startRowIndex",dataType:Number},2:{name:"endRowIndex",dataType:Number},3:{name:"startColIndex",dataType:Number},4:{name:"endColIndex",dataType:Number}},t.Z=p},"../packages/mutation/src/merge/UnmergeCellsMutation.ts":function(e,t,n){"use strict";n.d(t,{N:function(){return g}});var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/merge/MergeCellsMutation.ts"),d=n("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),u=s.Range.GridRange,l=s.Cell.CELL_DATA_SLOT,h=s.Cell.CellDataDelta,c=s.Cell.CELL_FORMAT_SLOT,I=s.Cell.CELL_FORMAT_SLOT_COMPOSE,f=s.Cell.cellFormatUtils,m=function(e){function t(t){var n;return(n=e.call(this,o.ZP.UNMERGE_CELLS_MUTATION,t)||this).sheetId=t.sheetId,n.startRowIndex=t.startRowIndex,n.endRowIndex=t.endRowIndex,n.startColIndex=t.startColIndex,n.endColIndex=t.endColIndex,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],startRowIndex:e[1],endRowIndex:e[2],startColIndex:e[3],endColIndex:e[4]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.check=function(e){var t=new u(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex);if(!t.isValid())return{isValid:!1,errorMessage:"GridRange值非法 gridRange="+JSON.stringify(t)};var n=e.properties.gridProperties;return this.endRowIndex>=n.rowCount||this.endColIndex>=n.colCount?{isValid:!1,errorMessage:"行列范围不正确。 endRowIndex="+this.endRowIndex+"  endRowIndex="+this.endColIndex+" gridProperties="+JSON.stringify(n)}:{isValid:!0}},n.runOnSheet=function(e){e.mergeManager.deleteMerge(new u(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex))},n.invert=function(){return[new a.Z({startRowIndex:this.startRowIndex,endRowIndex:this.endRowIndex,startColIndex:this.startColIndex,endColIndex:this.endColIndex,sheetId:this.sheetId})]},n.transformWithInsertDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=new u(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex);return n.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({startRowIndex:n.startRowIndex,endRowIndex:n.endRowIndex,startColIndex:n.startColIndex,endColIndex:n.endColIndex,sheetId:this.sheetId})]},n.transformWithDeleteDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=new u(this.sheetId,this.startRowIndex,this.endRowIndex,this.startColIndex,this.endColIndex);return n.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),!n.isValid()||n.isSingle()?[]:[new t({startRowIndex:n.startRowIndex,endRowIndex:n.endRowIndex,startColIndex:n.startColIndex,endColIndex:n.endColIndex,sheetId:this.sheetId})]},n.transformWithUnmergeCellsMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var t=[];return this.sheetId===e.sheetId&&this.startRowIndex===e.startRowIndex&&this.endRowIndex===e.endRowIndex&&this.startColIndex===e.startColIndex&&this.endColIndex===e.endColIndex||t.push(this),t},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},t}(r.Z);function g(e,t){var n,i,s,o,r,a=[];return t.mergeManager.each((function(g){e.isCross(g)&&(a.push(new m({startRowIndex:g.startRowIndex,endRowIndex:g.endRowIndex,startColIndex:g.startColIndex,endColIndex:g.endColIndex,sheetId:g.sheetId})),s=t.getCellDataAtPosition(g.startRowIndex,g.startColIndex),r=null!==s?f.createCellFormatDelta(null,s.getUserEnteredFormat(),I.ALL):null,(o=new h).setSlot(l.SLOT_USER_ENTERED_FORMAT_DELTA,r),n=new d.Z({cellDataDelta:o,gridRange:new u(g.sheetId,g.startRowIndex,g.endRowIndex,g.startColIndex,g.endColIndex)}),(null===(i=n.cellDataDelta.delta.userEnteredFormatDelta)||void 0===i?void 0:i.delta.getBorders())&&(i.clearSlot(c.BORDER_TOP),i.clearSlot(c.BORDER_BOTTOM),i.clearSlot(c.BORDER_LEFT),i.clearSlot(c.BORDER_RIGHT),i.clearSlot(c.BORDER_DIAGUP),i.clearSlot(c.BORDER_DIAGDOWN)),a.push(n))})),a}m.protoMap={0:{name:"sheetId",dataType:String},1:{name:"startRowIndex",dataType:Number},2:{name:"endRowIndex",dataType:Number},3:{name:"startColIndex",dataType:Number},4:{name:"endColIndex",dataType:Number}},t.Z=m},"../packages/mutation/src/new-embedded/NewAddEmbeddedObjectMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/workbook/workbookRange/DeleteWorkbookRangeMutation.ts"),d=n("../packages/mutation/src/new-embedded/NewDeleteEmbeddedObjectMutation.ts"),u=n("../packages/mutation/src/new-embedded/NewUpdateEmbeddedObjectMutation.ts"),l=s.NewEmbedded.EmbeddedObject,h=s.Dimension.DIMENSION_TYPE,c=s.Range.DimensionRange,I=function(e){function t(t){var n;return(n=e.call(this,o.ZP.NEW_ADD_EMBEDDED_OBJECT_MUTATION,t)||this).object=t.object,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({object:l.deserialize(e[0])})};var n=t.prototype;return n.serialize=function(){return[this.object.serialize()]},n.getAffectedSheetId=function(){return"WORKBOOK"},n.getAffectedSheets=function(){return[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(){},n.runOnWorkbook=function(e){return!this.checkEmbeddedObject(e,this.object)||(e.embeddedObjectManager.addEmbeddedObject(this.object),!0)},n.checkEmbeddedObject=function(e,t){var n,i=!0;return null===(n=t.properties.chart)||void 0===n||n.workbookRangeId.forEach((function(t){e.workbookRangeManager.getChartWorkbookRangeById(t)||(i=!1)})),i},n.invert=function(){return[new d.Z({objectId:this.object.objectId,sheetId:this.object.location.sheetId})]},n.transformWithInsertDimensionMutation=function(e){var n=this.object.location;if(n.sheetId!==e.sheetId)return[this];var i,s=n.position,o=s.rowIndex,r=s.colIndex,a=!1;if(e.type===h.ROWS?((i=new c(e.sheetId,o,o,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==o||i.endIndex!==o):((i=new c(e.sheetId,r,r,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==r||i.endIndex!==r),a){var d=this.object.clone();return d.location.position={rowIndex:e.type===h.ROWS?i.startIndex:o,colIndex:e.type===h.ROWS?r:i.startIndex},[new t({object:d})]}return[this]},n.transformWithDeleteDimensionMutation=function(e){var n=this.object.location;if(n.sheetId!==e.sheetId)return[this];var i,s=n.position,o=s.rowIndex,r=s.colIndex,a=!1;if(e.type===h.ROWS?((i=new c(e.sheetId,o,o,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==o||i.endIndex!==o):((i=new c(e.sheetId,r,r,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==r||i.endIndex!==r),a){var d=this.object.clone();return d.location.position={rowIndex:e.type===h.ROWS?i.startIndex:o,colIndex:e.type===h.ROWS?r:i.startIndex},[new t({object:d})]}return[this]},n.transformWithDeleteSheetMutation=function(e){return this.object.location.sheetId!==e.sheetId?[this]:[]},n.transformWithDefineWorkbookRangeMutation=function(e,t){return this.object.objectId===e.workbookRangePropertiesDelta.getEmbeddedObjectId()&&t?[new a.Z({workbookRangeId:e.workbookRangeId,workbookRangeType:e.workbookRangeType}),this]:[this]},n.transformWithUpdateWorkbookRangeMutation=function(e,t){return this.object.objectId===e.workbookRangePropertiesDelta.getEmbeddedObjectId()&&t?[new a.Z({workbookRangeId:e.workbookRangeId,workbookRangeType:e.workbookRangeType}),this]:[this]},n.transformWithNewAddEmbeddedObjectMutation=function(e,t){return this.object.objectId===e.object.objectId?t?[new u.Z({object:this.object.clone()})]:[]:[this]},n.transformWithNewDeleteEmbeddedObjectMutation=function(e){return this.object.objectId===e.objectId?[]:[this]},n.transformWithNewUpdateEmbeddedObjectMutation=function(e,t){return this.object.objectId===e.object.objectId?t?[new u.Z({object:this.object.clone()})]:[]:[this]},t}(r.Z);t.Z=I},"../packages/mutation/src/new-embedded/NewDeleteEmbeddedObjectMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/mutation/src/workbook/workbookRange/DeleteWorkbookRangeMutation.ts"),a=n("../packages/mutation/src/new-embedded/NewAddEmbeddedObjectMutation.ts"),d=function(e){function t(t){var n;return(n=e.call(this,s.ZP.NEW_DELETE_EMBEDDED_OBJECT_MUTATION,t)||this).objectId=t.objectId,n.sheetId=t.sheetId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({objectId:e[0],sheetId:e[1]})};var n=t.prototype;return n.serialize=function(){return[this.objectId,this.sheetId]},n.getAffectedSheetId=function(){return"WORKBOOK"},n.getAffectedSheets=function(){return[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(){},n.runOnWorkbook=function(e){return e.embeddedObjectManager.deleteEmbeddedObject(this.objectId),!0},n.invert=function(e){return[new a.Z({object:e.embeddedObjectManager.getEmbeddedObject(this.objectId).clone()})]},n.transformWithDeleteSheetMutation=function(e){return this.sheetId!==e.sheetId?[this]:[]},n.transformWithDefineWorkbookRangeMutation=function(e,t){return this.objectId===e.workbookRangePropertiesDelta.getEmbeddedObjectId()&&t?[new r.Z({workbookRangeId:e.workbookRangeId,workbookRangeType:e.workbookRangeType}),this]:[this]},n.transformWithUpdateWorkbookRangeMutation=function(e,t){return this.objectId===e.workbookRangePropertiesDelta.getEmbeddedObjectId()&&t?[new r.Z({workbookRangeId:e.workbookRangeId,workbookRangeType:e.workbookRangeType}),this]:[this]},n.transformWithNewDeleteEmbeddedObjectMutation=function(e){return this.objectId===e.objectId?[]:[this]},t}(o.Z);t.Z=d},"../packages/mutation/src/new-embedded/NewUpdateEmbeddedObjectMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/model/src/index.ts"),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/workbook/workbookRange/DeleteWorkbookRangeMutation.ts"),d=s.NewEmbedded.EmbeddedObject,u=s.Dimension.DIMENSION_TYPE,l=s.Range.DimensionRange,h=function(e){function t(t){var n;return(n=e.call(this,o.ZP.NEW_UPDATE_EMBEDDED_OBJECT_MUTATION,t)||this).object=t.object,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({object:d.deserialize(e[0])})};var n=t.prototype;return n.serialize=function(){return[this.object.serialize()]},n.getAffectedSheetId=function(){return"WORKBOOK"},n.getAffectedSheets=function(){return[]},n.check=function(){return{isValid:!0}},n.runOnSheet=function(){},n.runOnWorkbook=function(e){return e.embeddedObjectManager.updateEmbeddedObject(this.object),!0},n.invert=function(e){return[new t({object:e.embeddedObjectManager.getEmbeddedObject(this.object.objectId).clone()})]},n.transformWithInsertDimensionMutation=function(e){var n=this.object.location;if(n.sheetId!==e.sheetId)return[this];var i,s=n.position,o=s.rowIndex,r=s.colIndex,a=!1;if(e.type===u.ROWS?((i=new l(e.sheetId,o,o,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==o||i.endIndex!==o):((i=new l(e.sheetId,r,r,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==r||i.endIndex!==r),a){var d=this.object.clone();return d.location.position={rowIndex:e.type===u.ROWS?i.startIndex:o,colIndex:e.type===u.ROWS?r:i.startIndex},[new t({object:d})]}return[this]},n.transformWithDeleteDimensionMutation=function(e){var n=this.object.location;if(n.sheetId!==e.sheetId)return[this];var i,s=n.position,o=s.rowIndex,r=s.colIndex,a=!1;if(e.type===u.ROWS?((i=new l(e.sheetId,o,o,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==o||i.endIndex!==o):((i=new l(e.sheetId,r,r,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),a=i.startIndex!==r||i.endIndex!==r),a){var d=this.object.clone();return d.location.position={rowIndex:e.type===u.ROWS?i.startIndex:o,colIndex:e.type===u.ROWS?r:i.startIndex},[new t({object:d})]}return[this]},n.transformWithDeleteSheetMutation=function(e){return this.object.location.sheetId!==e.sheetId?[this]:[]},n.transformWithDefineWorkbookRangeMutation=function(e,t){return this.object.objectId===e.workbookRangePropertiesDelta.getEmbeddedObjectId()&&t?[new a.Z({workbookRangeId:e.workbookRangeId,workbookRangeType:e.workbookRangeType}),this]:[this]},n.transformWithUpdateWorkbookRangeMutation=function(e,t){return this.object.objectId===e.workbookRangePropertiesDelta.getEmbeddedObjectId()&&t?[new a.Z({workbookRangeId:e.workbookRangeId,workbookRangeType:e.workbookRangeType}),this]:[this]},n.transformWithNewAddEmbeddedObjectMutation=function(e,n){return this.object.objectId===e.object.objectId?n?[new t({object:this.object.clone()})]:[]:[this]},n.transformWithNewDeleteEmbeddedObjectMutation=function(e){return this.object.objectId===e.objectId?[]:[this]},n.transformWithNewUpdateEmbeddedObjectMutation=function(e,n){return this.object.objectId===e.object.objectId?n?[new t({object:this.object.clone()})]:[]:[this]},t}(r.Z);t.Z=h},"../packages/mutation/src/other/CopyPasteMutation.ts":function(e,t,n){"use strict";n.d(t,{S:function(){return m}});var i=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=(n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),r=n("../packages/mutation/src/MutationId.ts"),a=n("../packages/mutation/src/Mutation.ts"),d=n("../packages/mutation/src/cell/SetRangeMutation.ts"),u=n("../packages/model/src/cell/index.ts"),l=n("../packages/model/src/cell/metadata/CustomDataType.ts"),h=o.Range.GridRange,c=o.Range.DimensionRange,I=o.Cell.cellDataUtils,f=o.Dimension.DIMENSION_TYPE,m=function(e){this.source=e.source,this.destination=e.destination};function g(e,t){if(e.isRow){if(!t.isRow)return!1}else{if(t.isRow)return!1;if(e.endRowIndex-e.startRowIndex!==t.endRowIndex-t.startRowIndex)return!1}if(e.isCol){if(!t.isCol)return!1}else{if(t.isCol)return!1;if(e.endColIndex-e.startColIndex!==t.endColIndex-t.startColIndex)return!1}return!0}m.protoMap={0:{name:"source",dataType:h},1:{name:"destination",dataType:h}};var p=function(e){function t(t){var n;(n=e.call(this,r.ZP.COPY_PASTE_MUTATION,t)||this).sheetId=t.sheetId,n.cellMask=t.cellMask,n.formatMask=t.formatMask;var i=t.pasteMappings;return n.checkPasteMappings(i)?n.pasteMappings=t.pasteMappings:(console.warn("pasteMapping must be same rowLen and colLen"),n.pasteMappings=n.filterPasteMappings(i)),n}(0,s.Z)(t,e),t.deserialize=function(e){var n,i,s={sheetId:e[0],cellMask:e[1],formatMask:e[2],pasteMappings:[]};for(n=0,i=e[3].length;n<i;n++)s.pasteMappings.push({source:h.deserialize(e[3][n][0]),destination:h.deserialize(e[3][n][1])});return new t(s)};var n=t.prototype;return n.serialize=function(){var e,t,n=[this.sheetId,this.cellMask,this.formatMask],i=[];for(e=0,t=this.pasteMappings.length;e<t;e++)i.push([this.pasteMappings[e].source.serialize(),this.pasteMappings[e].destination.serialize()]);return n.push(i),n},n.getAffectedGridRanges=function(){return this.pasteMappings.map((function(e){return e.destination}))},n.checkPasteMappings=function(e){var t=!0;return e.forEach((function(e){var n=e.source,i=e.destination;t&&(t=g(n,i))})),t},n.filterPasteMappings=function(e){return e.filter((function(e){return g(e.source,e.destination)}))},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=[];return function(e){var t=new Map;return e.filter((function(e){return!t.has(e)&&t.set(e,1)}))}(this.pasteMappings.map((function(e){return e.source.sheetId}))).forEach((function(n){var i=e.sheetManager.getSheetBySheetId(n);i&&t.push(i)})),t},n.generateSetRangeMutations=function(e){var t=this.cellMask,n=this.formatMask;return this.pasteMappings.map((function(i){for(var s=i.source,o=i.destination,r=s.startColIndex,a=s.startRowIndex,h=o.startColIndex,c=o.endColIndex,f=o.startRowIndex,m=o.endRowIndex,g=h-r,p=f-a,R=[],x=f;x<=m;x++)for(var E=h;E<=c;E++){var T=e.getCellDataAtPosition(x-p,E-g,{isIgnoreFilterView:!0}),S=e.getCellDataAtPosition(x,E,{isIgnoreFilterView:!0}),_=I.createCellDataDelta(S,T,t,n);(null===T||void 0===T?void 0:T.getCellType())===l.ZP.TODO&&(_.clearSlot(u.CELL_DATA_SLOT.SLOT_METADATA),_.clearSlot(u.CELL_DATA_SLOT.SLOT_REF_IDS)),_.isEmpty()||R.push({rowIndex:x,colIndex:E,cellDataDelta:_})}return new d.Z({gridRange:o,cellDataDeltaAtPositions:R})}))},n.runOnSheet=function(e){this.generateSetRangeMutations(e).forEach((function(t){return e.spreadsheetReference.parent.mutationBehavior.applyMutation(t,{isLocal:!0,isMapping:!0},e)}))},n.invert=function(e){var t=[],n=this.cellMask,s=this.formatMask;return this.pasteMappings.forEach((function(o){var r=o.source,a=o.destination,u=r.sheetId,l=r.startColIndex,h=r.startRowIndex,c=a.startColIndex,f=a.endColIndex,m=a.startRowIndex,g=a.endRowIndex,p=c-l,R=m-h,x=e.sheetManager.getSheetBySheetId(u);if(x){for(var E=[],T=m;T<=g;T++)for(var S=c;S<=f;S++){var _=x.getCellDataAtPosition(T-R,S-p),w=x.getCellDataAtPosition(T,S),v=I.createCellDataDelta(w,_,n,s);v.isEmpty()||E.push({rowIndex:T,colIndex:S,cellDataDelta:v})}var M=new d.Z({gridRange:a,cellDataDeltaAtPositions:E}).invert(e);t=[].concat((0,i.Z)(t),(0,i.Z)(M))}})),t},n.transformWithInsertDimensionMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithDeleteDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=-2147483647;function i(e,t){return e==n?e:e+t}function s(e){return e!=n?e:2147483647}function o(e,t){return e.startIndex==e.endIndex&&e.startIndex!=n&&e.endIndex!=n&&t.startIndex==t.endIndex&&t.startIndex!=n&&t.endIndex!=n?e.endIndex<t.startIndex:s(e.endIndex)<=t.startIndex}function r(e,t){return t.startIndex==t.endIndex&&t.startIndex!=n&&t.endIndex!=n?e.startIndex==e.endIndex&&e.startIndex!=n&&e.endIndex!=n&&e.startIndex==t.startIndex:e.startIndex==e.endIndex&&e.startIndex!=n&&e.endIndex!=n?e.startIndex>=t.startIndex&&e.startIndex<s(t.endIndex):e.startIndex>=t.startIndex&&s(e.endIndex)<=s(t.endIndex)}function a(e,t){var n,a,d,u,l=t.endIndex-t.startIndex;if(0==l)return e;if(o(e,t))return e;if(r(e,t))return u=t.startIndex,new p(u,u);d=e.startIndex,n=e.endIndex;var h=s(e.endIndex);return e.startIndex<t.startIndex&&h>t.startIndex&&h<s(t.endIndex)?n=t.startIndex:r(t,e)?n=i(n,-l):(a=s(t.endIndex),t.startIndex<e.startIndex&&a>e.startIndex&&a<s(e.endIndex)?(d=t.startIndex,n=i(n,-l)):o(t,e)&&(d=i(d,-l),n=i(n,-l))),new p(d,n)}function d(e,t,n,i){if(!l(t,e.sheetId))return e;var s=n==f.ROWS,o=g(e,n),r=a(o,i);return r==o||r.startIndex==o.startIndex&&r.endIndex==o.endIndex?e:s?function(e,t){return new h(e.sheetId,e.startRowIndex,e.endRowIndex,t.startIndex,t.endIndex)}(e,r):function(e,t){return new h(e.sheetId,t.startIndex,t.endIndex,e.startColIndex,e.endColIndex)}(e,r)}function u(e){return null==e?null:e}function l(e,t){return u(e)===u(t)}var I=h;function g(e,t){var n=e.startRowIndex,i=e.endRowIndex,s=e.startColIndex,o=e.endColIndex;return t===f.ROWS?new p(n,i):new p(s,o)}var p=function(e,t){this.startIndex=e,this.endIndex=t};function R(e,t,n){return function(e,t,n,i){return t==f.ROWS?new I(e.sheetId,n,e.endRowIndex,i,e.endColIndex):new I(e.sheetId,e.startRowIndex,n,e.startColIndex,i)}(e,n,t.startIndex,t.endIndex)}function x(e,t,n){var i=g(e.source,n),s=g(e.destination,n),o=R(e.source,new p(i.startIndex,i.startIndex+t),n),r=R(e.source,new p(i.startIndex+t,i.endIndex),n),a=R(e.destination,new p(s.startIndex,s.startIndex+t),n),d=R(e.destination,new p(s.startIndex+t,s.endIndex),n);return{a:new m({source:o,destination:a}),c:new m({source:r,destination:d})}}function E(e,t,n,i){return i>e&&t>n||e==n&&t==i}function T(t,n,i){var s,o,r;if(e.type){var a=n.type==f.ROWS?f.ROWS:f.COLUMNS,u=new c(n.sheetId,n.index,n.index+n.amount,e.type),h=g(t.source,a),I=g(t.destination,a),p=n.sheetId;E(h.startIndex,h.endIndex,u.startIndex,u.endIndex)&&p===t.source.sheetId?u.startIndex>h.startIndex?(T((r=x(t,u.startIndex-h.startIndex,a)).a,n,i),T(r.c,n,i)):u.endIndex<h.endIndex&&(T((r=x(t,u.endIndex-h.startIndex,a)).a,n,i),T(r.c,n,i)):E(I.startIndex,I.endIndex,u.startIndex,u.endIndex)&&p===t.destination.sheetId?u.startIndex>I.startIndex?(T((r=x(t,u.startIndex-I.startIndex,a)).a,n,i),T(r.c,n,i)):u.endIndex<I.endIndex&&(T((r=x(t,u.endIndex-I.startIndex,a)).a,n,i),T(r.c,n,i)):(o=l(p,t.source.sheetId)?d(t.source,p,a,u):t.source,s=l(p,t.destination.sheetId)?d(t.destination,p,a,u):t.destination,i.push(new m({source:o,destination:s})))}else console.warn("copy paste mutation transform with dimensionMutation that is without dimension type")}var S=[];this.pasteMappings.forEach((function(t){var n=t.source,i=t.destination;(n=n.clone()).deleteDimension(e),(i=i.clone()).deleteDimension(e),T(t,e,S)}));var _=0==S.length?null:new t({sheetId:this.sheetId,pasteMappings:S,cellMask:this.cellMask,formatMask:this.formatMask});return _?[_]:[]},n.transformWithSetRangeMutation=function(e,t){if(this.sheetId!==e.gridRange.sheetId)return[this];var n=[];if(t)n.push(this);else if(this.sheetId!==e.gridRange.sheetId)n.push(this);else{for(var i=this.getAffectedGridRanges(),s=!1,o=0;o<i.length;o++)if(i[o].isCross(e.gridRange)){s=!0;break}s?(n.push(this),n.push(e)):n.push(this)}return n},n.transformWithSetCellPropertiesMutation=function(e){return this.sheetId,e.gridRange.sheetId,[this]},n.transformWithMergeCellsMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithCopyPasteMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithReorderRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},t}(a.Z);p.protoMap={0:{name:"cellMask",dataType:Number},1:{name:"formatMask",dataType:Number},2:{name:"pasteMappings",dataType:{type:Array,subType:m}},3:{name:"sheetId",dataType:String}},t.Z=p},"../packages/mutation/src/other/EmptyMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=function(e){function t(t){var n;return(n=e.call(this,s.ZP.EMPTY_MUTATION,t)||this).sheetId=t.sheetId,n}(0,i.Z)(t,e),t.deserialize=function(){return new t({sheetId:""})};var n=t.prototype;return n.serialize=function(){return[]},n.getAffectedSheets=function(){return[]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.check=function(){return{isValid:!0}},n.runOnSheet=function(){},n.invert=function(){return[]},t}(n("../packages/mutation/src/Mutation.ts").Z);t.Z=o},"../packages/mutation/src/other/InitDataMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=function(e){function t(t){var n;return(n=e.call(this,s.ZP.INIT_DATA_MUTATION,t)||this).sheetId=t.sheetId,n.lastRow=t.lastRow,n.lastCol=t.lastCol,n}(0,i.Z)(t,e),t.deserialize=function(e){if("string"!==typeof e[0])throw new TypeError("sheetid type error");if("number"!==typeof e[1]||"number"!==typeof e[2])throw new TypeError("lastRow or lastCol type error");return new t({sheetId:e[0],lastRow:e[1],lastCol:e[2]})};var n=t.prototype;return n.serialize=function(){return[]},n.getAffectedSheets=function(){return[]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.runOnSheet=function(){},n.invert=function(){return[]},t}(n("../packages/mutation/src/Mutation.ts").Z);t.Z=o},"../packages/mutation/src/other/MapRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts"),d=n("../packages/mutation/src/merge/UnmergeCellsMutation.ts"),u=n("../packages/mutation/src/conditionalFormat/UpdateConditionalFormatMutation.ts"),l=s.Dimension.DIMENSION_TYPE,h=s.Range.DimensionRange,c=s.Range.GridRange,I=s.Rule.ConditionalFormatRule,f={0:{name:"from",dataType:{type:Object,protoMap:{0:{name:"startIndex",dataType:Number},1:{name:"endIndex",dataType:Number}}}},1:{name:"to",dataType:Number},2:{name:"sourceSheetId",dataType:String},3:{name:"destinationSheetId",dataType:String}},m=function(e){function t(t){var n;return(n=e.call(this,o.ZP.MAP_RANGE_MUTATION,t)||this).sourceSheetId=t.sourceSheetId,n.destinationSheetId=t.destinationSheetId,n.row=t.row,n.column=t.column,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sourceSheetId:e[0],destinationSheetId:e[1],row:{from:{startIndex:e[2][0][0],endIndex:e[2][0][1]},to:e[2][1],sourceSheetId:e[2][2],destinationSheetId:e[2][3]},column:{from:{startIndex:e[3][0][0],endIndex:e[3][0][1]},to:e[3][1],sourceSheetId:e[3][2],destinationSheetId:e[3][3]}})};var n=t.prototype;return n.serialize=function(){return[this.sourceSheetId,this.destinationSheetId,[[this.row.from.startIndex,this.row.from.endIndex],this.row.to,this.row.sourceSheetId,this.row.destinationSheetId],[[this.column.from.startIndex,this.column.from.endIndex],this.column.to,this.column.sourceSheetId,this.column.destinationSheetId]]},n.getAffectedSheetId=function(){return this.destinationSheetId},n.setAffectedSheetId=function(e){this.destinationSheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sourceSheetId);n&&t.push(n);var i=e.sheetManager.getSheetBySheetId(this.destinationSheetId);return i&&i!==n&&t.push(i),t},n.runOnSheet=function(){},n.runOnFormulaModel=function(e){e.mapRangeForFormulaModel(this)},n.invert=function(){var e=[];return e.push(new t({sourceSheetId:this.destinationSheetId,destinationSheetId:this.sourceSheetId,row:g(this.row),column:g(this.column)})),e},n.transformWithInsertDimensionMutation=function(e){if(this.sourceSheetId!==e.sheetId)return[this];var n,i,s=[];if(n=e.type===l.ROWS?{from:{startIndex:this.row.from.startIndex,endIndex:this.row.from.endIndex},to:this.row.to,sourceSheetId:this.row.sourceSheetId,destinationSheetId:this.row.destinationSheetId}:{from:{startIndex:this.column.from.startIndex,endIndex:this.column.from.endIndex},to:this.column.to,sourceSheetId:this.column.sourceSheetId,destinationSheetId:this.column.destinationSheetId},e.sheetId===n.sourceSheetId&&((i=new h(n.sourceSheetId,n.from.startIndex,n.from.endIndex,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),n.from.startIndex=i.startIndex,n.from.endIndex=i.endIndex),e.sheetId===n.destinationSheetId){var o=n.to+(e.index<=n.from.startIndex?Math.max(e.index+e.amount-n.from.startIndex,0):0);(i=new h(n.destinationSheetId,o,o,e.type)).insertDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),n.to=i.startIndex}return s.push(new t({sourceSheetId:this.sourceSheetId,destinationSheetId:this.destinationSheetId,row:e.type===l.ROWS?n:this.row,column:e.type===l.COLUMNS?n:this.column})),s},n.transformWithDeleteDimensionMutation=function(e){if(this.sourceSheetId!==e.sheetId)return[this];var n,i,s=[];if(n=e.type===l.ROWS?{from:{startIndex:this.row.from.startIndex,endIndex:this.row.from.endIndex},to:this.row.to,sourceSheetId:this.row.sourceSheetId,destinationSheetId:this.row.destinationSheetId}:{from:{startIndex:this.column.from.startIndex,endIndex:this.column.from.endIndex},to:this.column.to,sourceSheetId:this.column.sourceSheetId,destinationSheetId:this.column.destinationSheetId},e.sheetId===n.sourceSheetId&&((i=new h(n.sourceSheetId,n.from.startIndex,n.from.endIndex,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),n.from.startIndex=i.startIndex,n.from.endIndex=i.endIndex),e.sheetId===n.destinationSheetId){var o=n.to+(e.index<=n.from.startIndex?Math.max(e.index+e.amount-n.from.startIndex,0):0);(i=new h(n.destinationSheetId,o,o,e.type)).deleteDimension({sheetId:e.sheetId,index:e.index,amount:e.amount,type:e.type}),n.to=i.startIndex}return s.push(new t({sourceSheetId:this.sourceSheetId,destinationSheetId:this.destinationSheetId,row:e.type===l.ROWS?n:this.row,column:e.type===l.COLUMNS?n:this.column})),s},n.transformWithSetDimensionPropertiesMutation=function(e,t){if(this.sourceSheetId!==e.sheetId)return[this];var n,i,s,o,r,d,u=[],c=e.ranges,I=[];if(u.push(this),e.sheetId!==this.sourceSheetId)return u;for(e.type===l.ROWS?(i=new h(this.sourceSheetId,this.row.from.startIndex,this.row.from.endIndex,l.ROWS),r=this.row.to):(i=new h(this.sourceSheetId,this.column.from.startIndex,this.column.from.endIndex,l.COLUMNS),r=this.column.to),s=0;s<c.length;s++)(n=c[s]).isCross(i)&&(o=n.divideByCross(i)).cross&&(d=o.cross.move({from:{startIndex:i.startIndex,endIndex:i.endIndex},to:r}),Array.prototype.push.apply(I,d));return I.length>0&&u.push(new a.ZP({operation:e.operation,ranges:I,type:e.type,sheetId:e.sheetId})),u},n.transformWithSetRangeMutation=function(e){return this.sourceSheetId,e.gridRange.sheetId,[this]},n.transformWithSetCellPropertiesMutation=function(e,t){return this.sourceSheetId,e.gridRange.sheetId,[this]},n.transformWithMergeCellsMutation=function(e){if(this.sourceSheetId!==e.sheetId)return[this];var t=[],n=this.destinationSheetId;if(n!==e.sheetId)return[this];var i=new c(n,this.row.to,this.row.to,this.column.to,this.column.to);return new c(e.sheetId,e.startRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex).isCross(i)&&(this.row.from.startIndex===this.row.from.endIndex&&this.column.from.startIndex===this.column.from.endIndex&&this.row.to===e.startRowIndex&&this.column.to===e.endRowIndex||t.push(new d.Z({sheetId:e.sheetId,startRowIndex:e.startRowIndex,endRowIndex:e.endRowIndex,startColIndex:e.startColIndex,endColIndex:e.endColIndex}))),t.push(this),t},n.transformWithDeleteSheetMutation=function(e,t){return this.sourceSheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDefineSheetRangeMutation=function(e){return this.sourceSheetId,e.sheetId,[this]},n.transformWithUpdateSheetRangeMutation=function(e){return this.sourceSheetId,e.sheetId,[this]},n.transformWithAddConditionalFormatMutation=function(e){var t=this;if(this.sourceSheetId!==e.sheetId)return[this];if(this.sourceSheetId===e.sheetId||this.destinationSheetId===e.sheetId){var n=[],i=[],s=[],o=[];return e.rule.ruleRanges.forEach((function(e){if(e.sheetId===t.sourceSheetId){var r=[],a=new c(t.sourceSheetId,-1===t.row.to?e.startRowIndex:t.row.from.startIndex,-1===t.row.to?e.endRowIndex:t.row.from.endIndex,-1===t.column.to?e.startColIndex:t.column.from.startIndex,-1===t.column.to?e.endColIndex:t.column.from.endIndex),d=e.getCross(a);d&&(r.push(d),i.push(d),o.push(new c(t.sourceSheetId,-1===t.row.to?d.startRowIndex:d.startRowIndex-t.row.from.startIndex+t.row.to,-1===t.row.to?d.endRowIndex:d.endRowIndex-t.row.from.startIndex+t.row.to,-1===t.column.to?d.startColIndex:d.startColIndex-t.column.from.startIndex+t.column.to,-1===t.column.to?d.endColIndex:d.endColIndex-t.column.from.startIndex+t.column.to)));var u=new c(t.sourceSheetId,-1===t.row.to?e.startRowIndex:t.row.to,-1===t.row.to?e.endRowIndex:t.row.to+t.row.from.endIndex-t.row.from.startIndex,-1===t.column.to?e.startColIndex:t.column.to,-1===t.column.to?e.endColIndex:t.column.to+t.column.from.endIndex-t.column.from.startIndex),l=e.getCross(u);l&&(r.push(l),s.push(l)),d||l?r.forEach((function(t){var i=e.startRowIndex,s=e.endRowIndex;e.startRowIndex<t.startRowIndex&&(n.push(new c(e.sheetId,e.startRowIndex,t.startRowIndex,e.startColIndex,e.endColIndex)),i=t.startRowIndex),t.endRowIndex<e.endRowIndex&&(n.push(new c(e.sheetId,t.endRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex)),s=t.endRowIndex),e.startColIndex<t.startColIndex&&n.push(new c(e.sheetId,i,s,e.startColIndex,t.endColIndex)),t.endColIndex<e.endColIndex&&n.push(new c(e.sheetId,i,s,t.endColIndex,e.endColIndex))})):n.push(e)}})),n.length>0||o.length>0?[this,new u.Z({sheetId:e.sheetId,ruleIndex:e.ruleIndex,rule:new I({ruleRanges:[].concat(n,o),booleanConditionalFormat:e.rule.booleanConditionalFormat,gradientConditionalFormat:e.rule.gradientConditionalFormat,dataBarConditionalFormat:e.rule.dataBarConditionalFormat}),oldRuleRanges:e.rule.ruleRanges})]:[this]}return[this]},n.transformWithUpdateConditionalFormatMutation=function(e,t){var n=this;if(this.sourceSheetId!==e.sheetId)return[this];if(this.sourceSheetId===e.sheetId||this.destinationSheetId===e.sheetId){var i=[],s=[],o=[],r=[];return e.rule.ruleRanges.forEach((function(e){if(e.sheetId===n.sourceSheetId){var t=[],a=new c(n.sourceSheetId,-1===n.row.to?e.startRowIndex:n.row.from.startIndex,-1===n.row.to?e.endRowIndex:n.row.from.endIndex,-1===n.column.to?e.startColIndex:n.column.from.startIndex,-1===n.column.to?e.endColIndex:n.column.from.endIndex),d=e.getCross(a);d&&(t.push(d),s.push(d),r.push(new c(n.sourceSheetId,-1===n.row.to?d.startRowIndex:d.startRowIndex-n.row.from.startIndex+n.row.to,-1===n.row.to?d.endRowIndex:d.endRowIndex-n.row.from.startIndex+n.row.to,-1===n.column.to?d.startColIndex:d.startColIndex-n.column.from.startIndex+n.column.to,-1===n.column.to?d.endColIndex:d.endColIndex-n.column.from.startIndex+n.column.to)));var u=new c(n.sourceSheetId,-1===n.row.to?e.startRowIndex:n.row.to,-1===n.row.to?e.endRowIndex:n.row.to+n.row.from.endIndex-n.row.from.startIndex,-1===n.column.to?e.startColIndex:n.column.to,-1===n.column.to?e.endColIndex:n.column.to+n.column.from.endIndex-n.column.from.startIndex),l=e.getCross(u);l&&(t.push(l),o.push(l)),d||l?t.forEach((function(t){var n=e.startRowIndex,s=e.endRowIndex;e.startRowIndex<t.startRowIndex&&(i.push(new c(e.sheetId,e.startRowIndex,t.startRowIndex,e.startColIndex,e.endColIndex)),n=t.startRowIndex),t.endRowIndex<e.endRowIndex&&(i.push(new c(e.sheetId,t.endRowIndex,e.endRowIndex,e.startColIndex,e.endColIndex)),s=t.endRowIndex),e.startColIndex<t.startColIndex&&i.push(new c(e.sheetId,n,s,e.startColIndex,t.endColIndex)),t.endColIndex<e.endColIndex&&i.push(new c(e.sheetId,n,s,t.endColIndex,e.endColIndex))})):i.push(e)}})),i.length>0||r.length>0?[this,new u.Z({sheetId:e.sheetId,ruleIndex:e.ruleIndex,rule:new I({ruleRanges:[].concat(i,r),booleanConditionalFormat:e.rule.booleanConditionalFormat,gradientConditionalFormat:e.rule.gradientConditionalFormat,dataBarConditionalFormat:e.rule.dataBarConditionalFormat}),oldRuleRanges:e.rule.ruleRanges})]:[this]}return[this]},t}(r.Z);function g(e){var t={from:{startIndex:0,endIndex:0},to:0,sourceSheetId:e.destinationSheetId,destinationSheetId:e.sourceSheetId};return t.from.startIndex=e.to,t.from.endIndex=e.to+(e.from.endIndex-e.from.startIndex),t.to=e.from.startIndex,t}m.protoMap={0:{name:"sourceSheetId",dataType:String},1:{name:"destinationSheetId",dataType:String},2:{name:"row",dataType:{type:Object,protoMap:f}},3:{name:"column",dataType:{type:Object,protoMap:f}}},t.Z=m},"../packages/mutation/src/other/ReorderRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/merge/UnmergeCellsMutation.ts"),d=n("../packages/model/src/sheet/sheetUtils.ts"),u=n("../spread-sheet/src/core/behavior/request/other/formula-model-service/UpdateFormulaModelServiceForMutation.ts"),l=s.Dimension.DIMENSION_TYPE,h=s.Range.GridRange,c={0:{name:"queue",dataType:{type:Array,subType:String}},1:{name:"rules",dataType:{type:Object,subType:{type:Object,protoMap:{0:{name:"from",dataType:Number},1:{name:"to",dataType:Number}}}}}},I=function(e){function t(t){var n;return(n=e.call(this,o.ZP.REORDER_RANGE_MUTATION,t)||this).sheetId=t.sheetId,n.range=t.range,n.operation=t.operation,n}(0,i.Z)(t,e),t.deserialize=function(e){var n,i,s={sheetId:e[0],range:h.deserialize(e[1]),operation:{queue:e[2][0],rules:{}}},o=Object.keys(e[2][1]);for(n=0,i=o.length;n<i;n++)s.operation.rules[o[n]]={from:e[2][1][o[n]][0],to:e[2][1][o[n]][1]};return new t(s)};var n=t.prototype;return n.serialize=function(){var e,t,n=[this.sheetId,this.range.serialize()],i=[];i.push(this.operation.queue),i.push({});var s=Object.keys(this.operation.rules);for(e=0,t=s.length;e<t;e++)i[1][s[e]]=[this.operation.rules[s[e]].from,this.operation.rules[s[e]].to];return n.push(i),n},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e,this.range.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.runOnSheet=function(e){for(var t=[],n=0;n<this.operation.queue.length;n++)t.push(this.operation.rules[this.operation.queue[n]]);(0,d.moveRange)(e,this.range,t),this.reorderFilterView(e)},n.runOnFormulaModel=function(e){e.reorderRangeForFormulaModel(this)},n.invert=function(e){var t=[];t=t.concat(this.reset());var n=this.getUpdateFormulaModelServiceInstance(e).getInvertMutationsForRowReorderMutation(this);return t=t.concat(n)},n.reset=function(){var e,n,i=[],s={queue:[],rules:{}},o=this.operation.queue,r=this.operation.rules;for(e=0;e<o.length;e++)n=r[o[e]],s.queue.push(""+n.to),s.rules[""+n.to]={from:n.to,to:n.from};return i.push(new t({range:this.range,sheetId:this.sheetId,operation:s})),i},n.getOrderResult=function(e){var t,n;for(t=0,n=this.operation.queue.length;t<n;t++)if(e===Number(this.operation.queue[t]))return this.operation.rules[e].to;return null},n.transformWithInsertDimensionMutation=function(e,n){if(this.sheetId!==e.sheetId)return[this];var i,s,o=[],r=JSON.parse(JSON.stringify(this.operation)),a=r.queue,d=r.rules,u=this.range.clone();if(u.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),e.type===l.ROWS)for(s=0;s<a.length;s++)(i=d[a[s]]).from>=e.index&&(i.from+=e.amount,delete d[a[s]],a[s]=""+i.from,d[a[s]]=i),i.to>=e.index&&(i.to+=e.amount);return o.push(new t({range:u,sheetId:this.sheetId,operation:r})),o},n.transformWithDeleteDimensionMutation=function(e,n){if(this.sheetId!==e.sheetId)return[this];var i,s,o=[],r=JSON.parse(JSON.stringify(this.operation)),a=r.queue,d=r.rules,u=this.range.clone();if(u.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),e.type===l.COLUMNS){if(!u.isValid())return o}else for(s=0;s<a.length;s++)(i=d[a[s]]).from>=e.index&&(i.from<=e.index+e.amount-1?(delete d[a[s]],a.splice(s,1)):i.from-=e.amount);return o.push(new t({range:u,sheetId:this.sheetId,operation:r})),o},n.transformWithSetRangeMutation=function(e,t){return this.sheetId,e.gridRange.sheetId,[this]},n.transformWithSetCellPropertiesMutation=function(e,t){return this.sheetId,e.gridRange.sheetId,[this]},n.transformWithCopyPasteMutation=function(e,t){return this.sheetId,e.sheetId,[this]},n.transformWithMergeCellsMutation=function(e,t){if(this.sheetId!==e.sheetId)return[this];var n=[],i=e.startRowIndex,s=e.endRowIndex,o=e.startColIndex,r=e.endColIndex,d=e.sheetId,u=new h(d,i,s,o,r);return d===this.sheetId&&u.isCross(this.range)&&n.push(new a.Z({sheetId:d,startRowIndex:i,endRowIndex:s,startColIndex:o,endColIndex:r})),n.push(this),n},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDefineSheetRangeMutation=function(e,t){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateSheetRangeMutation=function(e,t){return this.sheetId,e.sheetId,[this]},n.transformWithReorderRangeMutation=function(e,t){if(this.sheetId!==e.sheetId)return[this];var n=[];return this.range.isCross(e.range)?t&&(n=n.concat(e.reset())).push(this):n.push(this),n},n.reorderFilterView=function(e){if(e){var t=e.filterViewManager.getActiveFilterView();t&&t.reactivate()}},n.getUpdateFormulaModelServiceInstance=function(e){return(0,u.lO)({getSheetBySheetId:e.sheetManager.getSheetBySheetId.bind(e.sheetManager),getSheetIdList:e.sheetManager.getSheetIdList.bind(e.sheetManager),isSheetAmongTwoSheets:e.sheetManager.isSheetAmongTwoSheets.bind(e.sheetManager),getSheetIdBySheetIndex:e.sheetManager.getSheetIdBySheetIndex.bind(e.sheetManager),getSheetIndexBySheetId:e.sheetManager.getSheetIndexBySheetId.bind(e.sheetManager),getSheetTitleBySheetId:e.sheetManager.getSheetTitleBySheetId.bind(e.sheetManager)},e.workbookRangeManager,e.embeddedObjectManager,e.formulaModelManager)},t}(r.Z);I.protoMap={0:{name:"sheetId",dataType:String},1:{name:"range",dataType:h},2:{name:"operation",dataType:{type:Object,protoMap:c}}},t.Z=I},"../packages/mutation/src/other/mapRangeMutationUtil.ts":function(e,t,n){"use strict";n.d(t,{O:function(){return s}});var i=n("../packages/model/src/index.ts").Dimension.DIMENSION_TYPE;function s(e,t){var n,s=!1;return-1!==(n=e===i.ROWS?t.row:t.column).from.startIndex&&-1!==n.from.endIndex&&(s=!0),s}},"../packages/mutation/src/sheet/BaseMultiSheetMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/report/src/index.ts"),o=n("../packages/mutation/src/config/report.ts"),r=function(e){function t(t,n){return void 0===n&&(n={}),e.call(this,t,n)||this}(0,i.Z)(t,e);var n=t.prototype;return n.serialize=function(){return[]},n.isMultiSheetMutation=function(){return!0},n.getAffectedSheets=function(e){return[]},n.getAffectedSheetId=function(){return""},n.invert=function(e){return[]},n.run=function(e,t){var n={isValid:!1,errorMessage:"默认错误"};return"undefined"!==typeof e.getSpreadsheetId&&(this.runOnWorkbook(e),n=this.checkAndRunOnSheet(e,t)),{runResult:n,runCache:[],workbookWithSheetId:void 0,isMultiSheet:!0}},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){},n.checkAndRunOnSheet=function(e,t){var n={isValid:!1,errorMessage:"默认错误"},i=!1;try{n=this.check()}catch(r){s.ZP.run(o.mz.CHECK_MUTATION_ERROR,this,r,n)}if(!n.isValid&&(s.ZP.run(o.mz.CHECK_MUTATION_RESULT_ERROR,this,n),!t.ignoreCheck))return n;try{this.runOnSheet(e)}catch(r){console.error("Run mutation error: ",this,r),s.ZP.run(o.mz.RUN_MUTATION_ERROR,r,this),r.message&&0===r.message.indexOf("ApiCheckError")||(i=!0)}return{isValid:!i,errorMessage:i?"有遇到mutation运行错误":void 0}},t}(n("../packages/mutation/src/Mutation.ts").Z);t.Z=r},"../packages/mutation/src/sheet/DefineSheetRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/sheet/DeleteSheetRangeMutation.ts"),d=n("../packages/model/src/range/index.ts"),u=n("../packages/model/src/range/comment-sheet-range/comment-sheet-range.ts"),l=n("../packages/model/src/range/sheet-range-delta.ts"),h=n("../packages/model/src/range/comment-sheet-range/comment-sheet-range-properties.ts"),c=s.Range.GridRange,I=function(e){function t(t){var n;return(n=e.call(this,o.ZP.DEFINE_SHEET_RANGE_MUTATION,t)||this).sheetId=t.sheetId,n.sheetRangeId=t.sheetRangeId,n.gridRange=t.gridRange,n.sheetRangeType=t.sheetRangeType,n.nonPersistingLocalChange=t.nonPersistingLocalChange||!1,n.padId=t.padId,n.sheetRangeDelta=t.sheetRangeDelta,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],sheetRangeId:e[1],gridRange:c.deserialize(e[2]),sheetRangeType:e[3],padId:e[4],sheetRangeDelta:l.Z.deserialize(e[5])})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.sheetRangeId,this.gridRange.serialize(),this.sheetRangeType,this.padId,this.sheetRangeDelta.serialize()]},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},n.getAffectedSheetId=function(){return this.gridRange.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e,this.gridRange.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.check=function(e){return{isValid:!0}},n.runOnSheet=function(e){var t,n;this.sheetRangeType===d.SHEET_RANGE_TYPE.COMMENT_RANGE&&(n=new u.Z({sheetId:this.sheetId,gridRange:this.gridRange,sheetRangeType:this.sheetRangeType,padId:this.padId,properties:new h.Z({isArchived:null===(t=this.sheetRangeDelta.getCommentSheetRangeProperties())||void 0===t?void 0:t.isArchived})})),e.sheetRangeManager.addSheetRange(this.sheetRangeId,n)},n.invert=function(){return[new a.Z({sheetId:this.sheetId,sheetRangeId:this.sheetRangeId,nonPersistingLocalChange:this.nonPersistingLocalChange})]},n.transformWithInsertDimensionMutation=function(e){if(this.sheetId!==e.sheetId)return[this];var n=this.gridRange;return n.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({sheetRangeId:this.sheetRangeId,gridRange:n,sheetRangeType:this.sheetRangeType,nonPersistingLocalChange:this.nonPersistingLocalChange,sheetId:this.sheetId,padId:this.padId,sheetRangeDelta:this.sheetRangeDelta})]},n.transformWithDeleteDimensionMutation=function(e,n){if(this.sheetId!==e.sheetId)return[this];var i=this.gridRange;return i.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({sheetRangeId:this.sheetRangeId,gridRange:i,sheetRangeType:this.sheetRangeType,nonPersistingLocalChange:this.nonPersistingLocalChange,sheetId:this.sheetId,padId:this.padId,sheetRangeDelta:this.sheetRangeDelta})]},n.transformWithMergeCellsMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithAddEmbeddedObjectMutation=function(e){return this.sheetId,e.data.sheetId,[this]},n.transformWithDeleteEmbeddedObjectMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateEmbeddedObjectMutation=function(e){return this.sheetId,e.data.sheetId,[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDefineSheetRangeMutation=function(e,t){if(this.sheetId!==e.sheetId)return[this];if(t){var n=e.gridRange;if(this.gridRange.isCross(n)&&this.sheetRangeType===e.sheetRangeType)return[]}return[this]},n.transformWithDeleteSheetRangeMutation=function(e,t){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateSheetRangeMutation=function(e,t){return this.sheetId,e.sheetId,[this]},n.transformWithReorderRangeMutation=function(e,t){return this.sheetId,e.sheetId,[this]},n.transformWithMapRangeMutation=function(e,t){return this.sheetId,e.sourceSheetId,[this]},t}(r.Z);I.protoMap={0:{name:"sheetId",dataType:String},1:{name:"sheetRangeId",dataType:String},2:{name:"gridRange",dataType:c},3:{name:"sheetRangeType",dataType:Number},5:{name:"padId",dataType:String}},t.Z=I},"../packages/mutation/src/sheet/DeleteSheetMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/model/src/index.ts"),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/sheet/BaseMultiSheetMutation.ts"),a=n("../packages/mutation/src/sheet/InsertSheetMutation.ts"),d=s.Sheet.SheetPropertiesDelta,u=s.Sheet.NEW_SHEET_PROPERTIES_SLOT_OPERATION,l=function(e){function t(t){var n;return(n=e.call(this,o.ZP.DELETE_SHEET_MUTATION,t)||this).sheetId=t.sheetId,n.sheetIndex=t.sheetIndex,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],sheetIndex:e[1]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.sheetIndex]},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.getAffectedSheetId=function(){return this.sheetId},n.check=function(){return{isValid:!0}},n.transformWithInsertSheetMutation=function(e,n){if(this.sheetIndex>=e.sheetIndex&&n){var i=this.sheetIndex+1;return[new t({sheetId:this.sheetId,sheetIndex:i})]}return[this]},n.transformWithMoveSheetMutation=function(e,n){var i;return e.fromIndex===this.sheetIndex&&n?(i=e.toIndex,[new t({sheetId:this.sheetId,sheetIndex:i})]):e.fromIndex<this.sheetIndex&&e.toIndex>this.sheetIndex&&n?(i=this.sheetIndex-1,[new t({sheetId:this.sheetId,sheetIndex:i})]):e.fromIndex>this.sheetIndex&&e.toIndex<=this.sheetIndex&&n?(i=this.sheetIndex+1,[new t({sheetId:this.sheetId,sheetIndex:i})]):[this]},n.transformWithDeleteSheetMutation=function(e,n){if(this.sheetIndex>e.sheetIndex){var i=this.sheetIndex-1;return[new t({sheetId:this.sheetId,sheetIndex:i})]}return n&&this.sheetIndex===e.sheetIndex?[]:[this]},n.runOnSheet=function(e){e.sheetManager.deleteSheetBySheetId(this.sheetId),e.updateFormulaModelServiceForModel.updateFormulaModelFromMutation({sheetId:this.sheetId,sheetIndex:this.sheetIndex,id:o.ZP.DELETE_SHEET_MUTATION}),e.formulaModelManager.deleteSheet(this.sheetIndex,this.sheetId)},n.invert=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[new a.Z({sheetId:this.sheetId,sheetIndex:this.sheetIndex,sheetType:t.getSheetType(),rowCount:t.getRowCount(),colCount:t.getColCount(),sheetDelta:new d({operation:u.INSERT_SHEET,delta:{name:t.getTitle(),rightToLeft:t.getIsRtl(),hideGridline:t.getHideGridlines(),frozenColCount:t.getFrozenColCount(),frozenRowCount:t.getFrozenRowCount(),hidden:t.getDisplayHidden()}})})]:[]},t}(r.Z);t.Z=l},"../packages/mutation/src/sheet/DeleteSheetRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/mutation/src/sheet/DefineSheetRangeMutation.ts"),a=n("../packages/mutation/src/sheet/DeleteSheetRangeMutation.ts"),d=n("../packages/model/src/range/index.ts"),u=n("../packages/model/src/range/sheet-range-delta.ts"),l=n("../packages/model/src/range/comment-sheet-range/comment-sheet-range-properties.ts"),h=function(e){function t(t){var n;return(n=e.call(this,s.ZP.DELETE_SHEET_RANGE_MUTATION,t)||this).sheetId=t.sheetId,n.sheetRangeId=t.sheetRangeId,n.nonPersistingLocalChange=t.nonPersistingLocalChange||!1,n}(0,i.Z)(t,e),t.deserialize=function(e){return new a.Z({sheetId:e[0],sheetRangeId:e[1]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.sheetRangeId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){e.sheetRangeManager.deleteSheetRange(this.sheetRangeId)},n.invert=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId),n=[];if(null===t)return n;var i=t.sheetRangeManager.getSheetRange(this.sheetRangeId);if(!i)return n;if(i.sheetRangeType===d.SHEET_RANGE_TYPE.COMMENT_RANGE){var s=new u.Z({commentSheetRangeProperties:new l.Z({isArchived:i.properties.isArchived})});n.push(new r.Z({sheetId:this.sheetId,sheetRangeId:this.sheetRangeId,gridRange:i.gridRange,sheetRangeType:i.sheetRangeType,nonPersistingLocalChange:this.nonPersistingLocalChange,padId:i.padId,sheetRangeDelta:s}))}return n},n.transformWithUpdateFilterMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithDefineSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithDeleteSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},t}(o.Z);h.protoMap={0:{name:"sheetId",dataType:String},1:{name:"sheetRangeId",dataType:String}},t.Z=h},"../packages/mutation/src/sheet/InsertSheetMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/sheet/BaseMultiSheetMutation.ts"),a=n("../packages/mutation/src/sheet/DeleteSheetMutation.ts"),d=n("../packages/mutation/src/sheet/SetSheetPropertiesMutation.ts"),u=n("../packages/mutation/src/utils/sheetMutationUtil.ts"),l=n("../node_modules/i18next/dist/esm/i18next.js"),h=s.Sheet.SheetPropertiesDelta,c=s.Sheet.sheetPropertiesDeltaUtils,I=s.Sheet.NEW_SHEET_PROPERTIES_SLOT,f=s.Sheet.NEW_SHEET_PROPERTIES_SLOT_OPERATION,m=function(e){function t(t){var n;return(n=e.call(this,o.ZP.INSERT_SHEET_MUTATION,t)||this).sheetId=t.sheetId,n.sheetIndex=t.sheetIndex,n.sheetType=t.sheetType,n.rowCount=t.rowCount,n.colCount=t.colCount,n.sheetDelta=t.sheetDelta,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],sheetIndex:e[1],sheetType:e[2],sheetDelta:h.deserialize(e[3]),rowCount:e[4],colCount:e[5]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.sheetIndex,this.sheetType,this.sheetDelta.serialize(),this.rowCount,this.colCount]},n.getAffectedSheets=function(e){var t=e.sheetManager.getSheetBySheetId(this.sheetId);return t?[t]:[]},n.getAffectedSheetId=function(){return this.sheetId},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){var t=e.sheetManager.createSheet({id:this.sheetId,type:this.sheetType});t.setIndex(this.sheetIndex),c.mergeDeltaToSheetProperties(t.properties,this.sheetDelta),e.sheetManager.insertSheet(t,this.sheetIndex),e.formulaModelManager.insertSheet(this.sheetIndex,this.sheetId)},n.transformWithInsertSheetMutation=function(e,n){var i,s=this,o=this.sheetIndex,r=[];return this.sheetDelta.deltas.forEach((function(a){e.sheetDelta.deltas.forEach((function(l){a.slotName===I.SLOT_NAME&&l.slotName===I.SLOT_NAME&&a.value===l.value&&(n?(i=(0,u.t)(s,e),s.sheetIndex>=e.sheetIndex&&(o=s.sheetIndex+1),r.push(new t(Object.assign(Object.assign({},s),{sheetIndex:o,sheetDelta:i})))):(i=(0,u.t)(e,s),e.sheetIndex>=s.sheetIndex&&(o=e.sheetIndex+1),r.push(new d.Z(Object.assign(Object.assign({},e),{sheetIndex:o,sheetDelta:i})),s)))}))})),r.length?r:[this]},n.transformWithMoveSheetMutation=function(e,n){var i;return e.fromIndex<this.sheetIndex&&e.toIndex>this.sheetIndex&&n?(i=this.sheetIndex-1,[new t({sheetId:this.sheetId,sheetIndex:i,sheetType:this.sheetType,sheetDelta:this.sheetDelta,rowCount:this.rowCount,colCount:this.colCount})]):e.fromIndex>this.sheetIndex&&e.toIndex<this.sheetIndex&&n?(i=this.sheetIndex+1,[new t({sheetId:this.sheetId,sheetIndex:i,sheetType:this.sheetType,sheetDelta:this.sheetDelta,rowCount:this.rowCount,colCount:this.colCount})]):[this]},n.transformWithDeleteSheetMutation=function(e,n){if(this.sheetIndex>e.sheetIndex){var i=this.sheetIndex-1;return[new t({sheetId:this.sheetId,sheetIndex:i,sheetType:this.sheetType,sheetDelta:this.sheetDelta,rowCount:this.rowCount,colCount:this.colCount})]}return[this]},n.transformWithSetSheetPropertiesMutation=function(e,n){var i=this,s=[];return e.sheetDelta&&e.sheetDelta.deltas.forEach((function(o){i.sheetDelta.deltas.forEach((function(r){if(r.slotName===I.SLOT_NAME&&o.slotName===I.SLOT_NAME&&r.value===o.value)if(n){var a=(0,u.t)(i,e);s.push(new t(Object.assign(Object.assign({},i),{sheetDelta:a})))}else{var c=l.ZP.t("{{value0}}_自动重命名{{value1}}",{value0:o.value,value1:e.sheetId});s.push(new d.Z({sheetId:e.sheetId,sheetDelta:new h({operation:f.SET_PROPERTIES,delta:{name:c}})}),i)}}))})),s.length?s:[this]},n.invert=function(){return[new a.Z({sheetId:this.sheetId,sheetIndex:this.sheetIndex})]},t}(r.Z);t.Z=m},"../packages/mutation/src/sheet/MoveSheetMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=function(e){function t(t){var n;return(n=e.call(this,s.ZP.MOVE_SHEET_MUTATION,t)||this).fromIndex=t.fromIndex,n.toIndex=t.toIndex,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({fromIndex:e[0],toIndex:e[1]})};var n=t.prototype;return n.serialize=function(){return[this.fromIndex,this.toIndex]},n.getAffectedSheets=function(e){return[]},n.getAffectedSheetId=function(){return""},n.check=function(){return{isValid:!0}},n.transformWithInsertSheetMutation=function(e,n){var i;if(n){if(e.sheetIndex<=this.fromIndex&&this.fromIndex<this.toIndex||e.sheetIndex<=this.toIndex&&this.fromIndex>this.toIndex)return[new t({fromIndex:this.fromIndex+1,toIndex:i=this.toIndex+1})];if(e.sheetIndex<=this.toIndex&&e.sheetIndex>this.fromIndex)return i=this.toIndex+1,[new t({fromIndex:this.fromIndex,toIndex:i})];if(e.sheetIndex<this.fromIndex&&e.sheetIndex>this.toIndex)return[new t({fromIndex:this.fromIndex+1,toIndex:this.toIndex})]}return[this]},n.transformWithMoveSheetMutation=function(e,n){return this.fromIndex===e.fromIndex&&this.toIndex!=e.toIndex?n?[new t({fromIndex:e.toIndex,toIndex:this.toIndex})]:[]:this.fromIndex===e.fromIndex&&this.toIndex===e.toIndex?[]:this.fromIndex<this.toIndex?e.fromIndex<e.toIndex?this.transformWithMoveSheetMutationScenes1(e):this.transformWithMoveSheetMutationScenes2(e):this.fromIndex>this.toIndex?e.fromIndex>e.toIndex?this.transformWithMoveSheetMutationScenes3(e):this.transformWithMoveSheetMutationScenes4(e):[this]},n.transformWithMoveSheetMutationScenes1=function(e){var n;return e.toIndex<this.fromIndex||e.fromIndex>this.toIndex||this.fromIndex<e.fromIndex&&e.toIndex<this.toIndex?[this]:e.fromIndex<this.fromIndex&&this.toIndex<=e.toIndex?[new t({fromIndex:this.fromIndex-1,toIndex:n=this.toIndex-1})]:e.fromIndex<this.fromIndex&&this.fromIndex<e.toIndex&&e.toIndex<this.toIndex?[new t({fromIndex:this.fromIndex-1,toIndex:this.toIndex})]:this.fromIndex<e.fromIndex&&e.fromIndex<this.toIndex&&this.toIndex<=e.toIndex?(n=this.toIndex-1,[new t({fromIndex:this.fromIndex,toIndex:n})]):[this]},n.transformWithMoveSheetMutationScenes2=function(e){var n;return e.fromIndex<this.fromIndex||e.toIndex>this.toIndex||this.fromIndex<e.toIndex&&e.fromIndex<this.toIndex?[this]:e.toIndex<=this.fromIndex&&this.toIndex<e.fromIndex?[new t({fromIndex:this.fromIndex+1,toIndex:n=this.toIndex+1})]:e.toIndex<this.fromIndex&&this.fromIndex<e.fromIndex&&e.fromIndex<this.fromIndex||this.fromIndex===e.toIndex&&this.toIndex===e.fromIndex?[new t({fromIndex:this.fromIndex+1,toIndex:this.toIndex})]:this.fromIndex<=e.toIndex&&e.toIndex<this.toIndex&&this.fromIndex<e.toIndex?(n=this.toIndex+1,[new t({fromIndex:this.fromIndex,toIndex:n})]):[this]},n.transformWithMoveSheetMutationScenes3=function(e){var n;return e.toIndex>this.fromIndex||e.fromIndex<this.toIndex||this.toIndex<e.toIndex&&e.fromIndex<this.fromIndex?[this]:e.toIndex<=this.toIndex&&this.fromIndex<e.fromIndex?[new t({fromIndex:this.fromIndex+1,toIndex:n=this.toIndex+1})]:this.toIndex<e.toIndex&&e.toIndex<this.fromIndex&&this.fromIndex<=e.fromIndex?[new t({fromIndex:this.fromIndex+1,toIndex:this.toIndex})]:e.toIndex<=this.toIndex&&this.toIndex<e.fromIndex&&e.fromIndex<this.fromIndex?(n=this.toIndex+1,[new t({fromIndex:this.fromIndex,toIndex:n})]):[this]},n.transformWithMoveSheetMutationScenes4=function(e){var n;return e.fromIndex>this.fromIndex||e.toIndex<this.toIndex||this.toIndex<e.fromIndex&&e.toIndex<this.fromIndex?[this]:e.fromIndex<this.toIndex&&this.fromIndex<e.toIndex?[new t({fromIndex:this.fromIndex-1,toIndex:n=this.toIndex-1})]:e.fromIndex<this.toIndex&&e.toIndex<this.fromIndex?(n=this.toIndex-1,[new t({fromIndex:this.fromIndex,toIndex:n})]):this.toIndex<e.fromIndex&&e.fromIndex<this.fromIndex&&this.fromIndex<=e.toIndex||this.fromIndex===e.toIndex&&this.toIndex===e.fromIndex?[new t({fromIndex:this.fromIndex-1,toIndex:this.toIndex})]:[this]},n.transformWithDeleteSheetMutation=function(e,n){var i;if(n){if(this.fromIndex===e.sheetIndex)return[];if(e.sheetIndex<this.fromIndex&&this.fromIndex<this.toIndex||e.sheetIndex<this.toIndex&&this.fromIndex>this.toIndex)return[new t({fromIndex:this.fromIndex-1,toIndex:i=this.toIndex-1})];if(e.sheetIndex<=this.toIndex&&e.sheetIndex>this.fromIndex)return i=this.toIndex-1,[new t({fromIndex:this.fromIndex,toIndex:i})];if(e.sheetIndex<this.fromIndex&&e.sheetIndex>=this.toIndex)return[new t({fromIndex:this.fromIndex-1,toIndex:this.toIndex})]}return[this]},n.runOnSheet=function(e){e.sheetManager.moveSheet(this.fromIndex,this.toIndex),e.formulaModelManager.moveSheet(this.toIndex,this.getAffectedSheetId())},n.invert=function(){return[new t({fromIndex:this.toIndex,toIndex:this.fromIndex})]},t}(n("../packages/mutation/src/sheet/BaseMultiSheetMutation.ts").Z);t.Z=o},"../packages/mutation/src/sheet/SetSheetPropertiesMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.string.includes.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/model/src/cell/format/Color.ts"),r=n("../packages/mutation/src/MutationId.ts"),a=n("../packages/mutation/src/Mutation.ts"),d=n("../packages/mutation/src/SlotOperation.ts"),u=n("../packages/mutation/src/utils/sheetMutationUtil.ts"),l=n("../node_modules/i18next/dist/esm/i18next.js"),h=n("../packages/model/src/filter-view/utils/filter-view-properties-util.ts"),c=s.Sheet.SheetPropertiesDelta,I=s.Sheet.NEW_SHEET_PROPERTIES_SLOT_OPERATION,f=s.Sheet.OLD_SHEET_PROPERTIES_SLOT,m=s.Sheet.NEW_SHEET_PROPERTIES_SLOT,g=s.Sheet.sheetPropertiesDeltaUtils,p=s.Dimension.DIMENSION_TYPE,R=s.Range.DimensionRange,x=function(e){function t(t){var n;return(n=e.call(this,r.ZP.SET_SHEET_PROPERTIES_MUTATION,t)||this).type=t.type,n.slotOperation=null!=t.slotOperation?t.slotOperation:d.Z.SET_SLOT,n.value=t.value,n.sheetId=t.sheetId,n.sheetDelta=t.sheetDelta,n.filterViewId=t.filterViewId,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],type:e[1],slotOperation:e[2],value:e[3],sheetDelta:e[4]?c.deserialize(e[4]):void 0,filterViewId:e[5]})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.type,,,this.sheetDelta?this.sheetDelta.serialize():null,this.filterViewId]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.sheetId);return n&&t.push(n),t},n.runOnSheet=function(e){if(this.sheetDelta)this.handleRunOnSheetWithSheetDelta(e);else if(this.type)switch(this.type){case f.SLOT_FROZEN_ROWS:e.setFrozenRowCount(this.value,this.filterViewId);break;case f.SLOT_FROZEN_COLUMNS:e.setFrozenColCount(this.value,this.filterViewId);break;case f.SLOT_HIDE_GRIDLINES:e.setHideGridlines(this.value);break;case f.SLOT_NAME:e.setTitle(this.value);break;case f.SLOT_NUMBER_OF_COLUMNS:e.setColCount(this.value);break;case f.SLOT_NUMBER_OF_ROWS:e.setRowCount(this.value)}},n.handleRunOnSheetWithSheetDelta=function(e){if(this.filterViewId&&e.filterViewManager.getFilterViewByViewId(this.filterViewId)){var t=e.filterViewManager.getFilterViewByViewId(this.filterViewId);(0,h.g)(this.sheetDelta,t)}else g.mergeDeltaToSheetProperties(e.properties,this.sheetDelta)},n.invert=function(e){var n=[],i=e.sheetManager.getSheetBySheetId(this.sheetId);if(null===i)return n;if(!this.sheetDelta){switch(this.type){case f.SLOT_FROZEN_ROWS:n.push(new t({type:f.SLOT_FROZEN_ROWS,value:i.getFrozenRowCount(),sheetId:this.sheetId,filterViewId:this.filterViewId}));break;case f.SLOT_FROZEN_COLUMNS:n.push(new t({type:f.SLOT_FROZEN_COLUMNS,value:i.getFrozenColCount(),sheetId:this.sheetId,filterViewId:this.filterViewId}));break;case f.SLOT_HIDE_GRIDLINES:n.push(new t({type:f.SLOT_HIDE_GRIDLINES,value:i.getHideGridlines(),sheetId:this.sheetId}));break;case f.SLOT_NAME:n.push(new t({type:f.SLOT_NAME,value:i.getTitle(),sheetId:this.sheetId}))}return n}var s=i.filterViewManager.getFilterViewByViewId(this.filterViewId),o=this.getSetSheetPropertiesMutation(this.sheetDelta.deltas,i,s);return n.push(o),n},n.getSetSheetPropertiesMutation=function(e,n,i){var s={};return e.forEach((function(e){switch(e.slotName){case m.SLOT_NAME:s.name=n.getTitle();break;case m.SLOT_RIGHT_TO_LEFT:s.rightToLeft=n.getIsRtl();break;case m.SLOT_ROW_COUNT:s.rowCount=n.getRowCount();break;case m.SLOT_COL_COUNT:s.colCount=n.getColCount();break;case m.SLOT_FROZEN_ROW_COUNT:s.frozenRowCount=i?i.getFrozenRowCount():n.properties.gridProperties.frozenRowCount;break;case m.SLOT_FROZEN_COL_COUNT:s.frozenColCount=i?i.getFrozenColCount():n.properties.gridProperties.frozenColCount;break;case m.SLOT_HIDE_GRID_LINE:s.hideGridline=n.getHideGridlines();break;case m.SLOT_HIDE:s.hidden=n.getDisplayHidden();break;case m.SLOT_TAB_COLOR:s.tabColor=o.Z.getColorHexCode(n.getTabColor(),n.spreadsheetReference);break;case m.SLOT_COLUMN_DV_IGNORE_ROWS:s.columnDvIgnoreRows=n.getColumnDvIgnoreRows()}})),new t({sheetId:this.sheetId,filterViewId:this.filterViewId,sheetDelta:new c({operation:I.SET_PROPERTIES,delta:s})})},n.transformWithInsertDimensionMutation=function(e,n){if(this.sheetId!==e.sheetId)return[this];if(this.sheetDelta){for(var i=this.sheetDelta.clone(),s=0,o=i.deltas.length;s<o;s++)if(i.deltas[s].slotName===m.SLOT_FROZEN_COL_COUNT&&e.type===p.COLUMNS){var r=i.deltas[s].value,a=new R(this.sheetId,r,r,p.COLUMNS);a.insertDimension({sheetId:e.sheetId,type:p.COLUMNS,index:e.index,amount:e.amount}),i.deltas[s].value=a.startIndex}else if(i.deltas[s].slotName===m.SLOT_FROZEN_ROW_COUNT&&e.type===p.ROWS){var d=i.deltas[s].value,u=new R(this.sheetId,d,d,p.ROWS);u.insertDimension({sheetId:e.sheetId,type:p.ROWS,index:e.index,amount:e.amount}),i.deltas[s].value=u.startIndex}return[new t({sheetDelta:i,sheetId:this.sheetId,filterViewId:this.filterViewId})]}var l=this.value;if(this.type===f.SLOT_FROZEN_COLUMNS&&e.type===p.COLUMNS){if(!(l>=e.index))return[this];var h=new R(this.sheetId,l,l,p.COLUMNS);h.insertDimension({sheetId:e.sheetId,type:p.COLUMNS,index:e.index,amount:e.amount}),l=h.startIndex}else{if(this.type!==f.SLOT_FROZEN_ROWS||e.type!==p.ROWS)return[this];if(!(l>=e.index))return[this];var c=new R(this.sheetId,l,l,p.ROWS);c.insertDimension({sheetId:e.sheetId,type:p.ROWS,index:e.index,amount:e.amount}),l=c.startIndex}return[new t({type:this.type,value:l,sheetId:this.sheetId,filterViewId:this.filterViewId})]},n.transformWithDeleteDimensionMutation=function(e,n){if(this.sheetId!==e.sheetId)return[this];if(this.sheetDelta){for(var i=this.sheetDelta.clone(),s=0,o=i.deltas.length;s<o;s++)if(i.deltas[s].slotName===m.SLOT_FROZEN_COL_COUNT&&e.type===p.COLUMNS){var r=i.deltas[s].value,a=new R(this.sheetId,r,r,p.COLUMNS);a.deleteDimension({sheetId:e.sheetId,type:p.COLUMNS,index:e.index,amount:e.amount}),i.deltas[s].value=a.startIndex}else if(i.deltas[s].slotName===m.SLOT_FROZEN_ROW_COUNT&&e.type===p.ROWS){var d=i.deltas[s].value,u=new R(this.sheetId,d,d,p.ROWS);u.deleteDimension({sheetId:e.sheetId,type:p.ROWS,index:e.index,amount:e.amount}),i.deltas[s].value=u.startIndex}return[new t({sheetDelta:i,sheetId:this.sheetId,filterViewId:this.filterViewId})]}var l=this.value;if(this.type===f.SLOT_FROZEN_COLUMNS&&e.type===p.COLUMNS){var h=new R(this.sheetId,l,l,p.COLUMNS);h.deleteDimension({sheetId:e.sheetId,type:p.COLUMNS,index:e.index,amount:e.amount}),l=h.startIndex}else{if(this.type!==f.SLOT_FROZEN_ROWS||e.type!==p.ROWS)return[this];var c=new R(this.sheetId,l,l,p.ROWS);c.deleteDimension({sheetId:e.sheetId,type:p.ROWS,index:e.index,amount:e.amount}),l=c.startIndex}return[new t({type:this.type,value:l,sheetId:this.sheetId,filterViewId:this.filterViewId})]},n.transformWithSetSheetPropertiesMutation=function(e,n){var i=[];if(this.sheetDelta)if(this.isConflict(e))for(var s=0;s<this.sheetDelta.deltas.length;s++)for(var o=this.sheetDelta.deltas[s],r=0;r<e.sheetDelta.deltas.length;r++){var a=e.sheetDelta.deltas[r];if(o.slotOperation===a.slotOperation)if(o.slotName===m.SLOT_NAME)if(e.sheetId===this.sheetId)n&&i.push(this);else if(n){var d=(0,u.t)(this,e);i.push(new t(Object.assign(Object.assign({},this),{sheetDelta:d})))}else{var l=(0,u.t)(e,this);i.push(this,new t(Object.assign(Object.assign({},e),{sheetDelta:l})))}else e.sheetId===this.sheetId&&n&&i.push(this)}else i.push(this);else(e.type!==this.type||n)&&i.push(this);return i},n.isConflict=function(e){if(e.sheetDelta&&this.sheetDelta){var t=e.sheetDelta.deltas.map((function(e){return e.slotOperation})),n=this.sheetDelta.deltas.map((function(e){return e.slotOperation}));return t.every((function(e){return n.includes(e)}))}return!1},n.transformWithInsertSheetMutation=function(e,n){var i=[];if(this.sheetDelta)for(var s=0;s<this.sheetDelta.deltas.length;s++)for(var o=this.sheetDelta.deltas[s],r=0;r<e.sheetDelta.deltas.length;r++){var a=e.sheetDelta.deltas[r];if(o.slotName===m.SLOT_NAME&&o.value===a.value)if(n){var d=(0,u.t)(this,e);i.push(new t(Object.assign(Object.assign({},this),{sheetDelta:d})))}else{var h=l.ZP.t("{{value0}}_自动重命名{{value1}}",{value0:a.value,value1:e.sheetId});i.push(new t({sheetId:e.sheetId,sheetDelta:new c({operation:I.SET_PROPERTIES,delta:{name:h}})}),this)}}return i.length?i:[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformWithDeleteFilterViewMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:this.filterViewId&&t&&this.filterViewId===e.filterViewId?[]:[this]},t}(a.Z);x.protoMap={0:{name:"sheetId",dataType:String},1:{name:"type",dataType:Number},2:{name:"value",dataType:String},3:{name:"sheetDelta",dataType:c}},t.Z=x},"../packages/mutation/src/sheet/UpdateAllSheetsMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/mutation/src/MutationId.ts"),o=function(e){function t(t){var n;return(n=e.call(this,s.ZP.UPDATE_ALL_SHEETS_MUTATION,t)||this).sheetId=t.sheetId,n.data=t.data,n}(0,i.Z)(t,e);var n=t.prototype;return n.serialize=function(){return[]},n.getAffectedSheets=function(e){return[]},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e},n.check=function(e){return{isValid:!0}},n.runOnSheet=function(e){},n.invert=function(){return[]},t}(n("../packages/mutation/src/Mutation.ts").Z);t.Z=o},"../packages/mutation/src/sheet/UpdateSheetRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/model/src/range/index.ts"),d=n("../packages/model/src/range/comment-sheet-range/comment-sheet-range.ts"),u=n("../packages/model/src/range/sheet-range-delta.ts"),l=n("../packages/model/src/range/comment-sheet-range/comment-sheet-range-properties.ts"),h=s.Range.GridRange,c=function(e){function t(t){var n;return(n=e.call(this,o.ZP.UPDATE_SHEET_RANGE_MUTATION,t)||this).sheetId=t.sheetId,n.sheetRangeId=t.sheetRangeId,n.gridRange=t.gridRange,n.sheetRangeType=t.sheetRangeType,n.nonPersistingLocalChange=t.nonPersistingLocalChange||!1,n.padId=t.padId,n.sheetRangeDelta=t.sheetRangeDelta,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({sheetId:e[0],sheetRangeId:e[1],gridRange:h.deserialize(e[2]),sheetRangeType:e[3],padId:e[4],sheetRangeDelta:u.Z.deserialize(e[5])})};var n=t.prototype;return n.serialize=function(){return[this.sheetId,this.sheetRangeId,this.gridRange.serialize(),this.sheetRangeType,this.padId,this.sheetRangeDelta.serialize()]},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},n.getAffectedSheetId=function(){return this.sheetId},n.setAffectedSheetId=function(e){this.sheetId=e,this.gridRange.sheetId=e},n.getAffectedSheets=function(e){var t=[],n=e.sheetManager.getSheetBySheetId(this.gridRange.sheetId);return n&&t.push(n),t},n.check=function(e){return{isValid:!0}},n.runOnSheet=function(e){var t,n,i=this.gridRange.clone();this.sheetRangeType===a.SHEET_RANGE_TYPE.COMMENT_RANGE&&(n=new d.Z({sheetId:this.sheetId,gridRange:i,sheetRangeType:this.sheetRangeType,padId:this.padId,properties:new l.Z({isArchived:null===(t=this.sheetRangeDelta.getCommentSheetRangeProperties())||void 0===t?void 0:t.isArchived})})),e.sheetRangeManager.updateSheetRange(this.sheetRangeId,n)},n.invert=function(e){var n=e.sheetManager.getSheetBySheetId(this.sheetId),i=[];if(null===n)return i;var s=n.sheetRangeManager.getSheetRange(this.sheetRangeId);if(!s)return i;if(this.sheetRangeType===a.SHEET_RANGE_TYPE.COMMENT_RANGE){var o=new u.Z({commentSheetRangeProperties:new l.Z({isArchived:s.properties.isArchived})});i.push(new t({sheetId:this.sheetId,sheetRangeId:this.sheetRangeId,gridRange:s.gridRange,sheetRangeType:this.sheetRangeType,nonPersistingLocalChange:this.nonPersistingLocalChange,padId:this.padId,sheetRangeDelta:o}))}return i},n.transformWithInsertDimensionMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithDeleteDimensionMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithMergeCellsMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateFilterMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithAddEmbeddedObjectMutation=function(e){return this.sheetId,e.data.sheetId,[this]},n.transformWithDeleteEmbeddedObjectMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithUpdateEmbeddedObjectMutation=function(e){return this.sheetId,e.data.sheetId,[this]},n.transformWithDeleteSheetMutation=function(e,t){return this.sheetId!==e.sheetId?[this]:t?[]:[this]},n.transformDefineSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformDeleteSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformUpdateSheetRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithReorderRangeMutation=function(e){return this.sheetId,e.sheetId,[this]},n.transformWithMapRangeMutation=function(e){return this.sheetId,e.sourceSheetId,[this]},t}(r.Z);c.protoMap={0:{name:"sheetId",dataType:String},1:{name:"sheetRangeId",dataType:String},2:{name:"gridRange",dataType:h},3:{name:"sheetRangeType",dataType:Number},5:{name:"padId",dataType:String}},t.Z=c},"../packages/mutation/src/transform.ts":function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var i=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../packages/mutation/src/config/version.ts"));function o(e,t,n){var r,a,d,u,l,h,c,I,f,m=e;try{for(r=0,u=t.length;r<u;r++)if(h=[t[r]],c=[],0!==h.length){for(a=0,d=e.length;a<d;a++)l=e[a],h.length>1?(I=o([l],h,n),a<d-1&&(f=o(h,[l],!n))):1===h.length?(I=l.transform(h[0],n),l.version===s.Z.MUTATION_VER_LOWEST_SUPPORT&&h[0].version===s.Z.MUTATION_VER_LOWEST_SUPPORT&&I.forEach((function(e){e.version=s.Z.MUTATION_VER_LOWEST_SUPPORT})),a<d-1&&(f=h[0].transform(l,!n),l.version===s.Z.MUTATION_VER_LOWEST_SUPPORT&&h[0].version===s.Z.MUTATION_VER_LOWEST_SUPPORT&&f.forEach((function(e){e.version=s.Z.MUTATION_VER_LOWEST_SUPPORT})))):(I=[l],f=[]),a<d-1&&(h=f),c=[].concat((0,i.Z)(c),(0,i.Z)(I));e=c}}catch(g){return console.error("transform two mutation array error: ",g),m}return m=e}},"../packages/mutation/src/utils/index.ts":function(e,t,n){"use strict";function i(e,t){if(e===t)return!0;if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return e===(t=null==t?null:t);if((Array.isArray(e)||null==e)&&(Array.isArray(t)||null==t)){if(null==e||0===e.length)return null==t||0===t.length;if(null==t||e.length!==t.length)return!1;for(var n=0,s=e.length;n<s;n++)if(!i(e[n],t[n]))return!1;return!0}return null!=e&&"function"===typeof e.equals?e.equals(t):void 0}function s(e){return null==e?null:e}function o(e,t){return s(e)===s(t)}function r(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)if(!Array.isArray(e[t]))return!1;return!0}return!1}function a(e){return"[object Array]"===Object.prototype.toString.call(e)}n.d(t,{Ep:function(){return r},ZG:function(){return o},fS:function(){return i},kJ:function(){return a}}),n("../node_modules/core-js/modules/es.object.to-string.js")},"../packages/mutation/src/utils/sheetMutationUtil.ts":function(e,t,n){"use strict";n.d(t,{t:function(){return a}}),n("../node_modules/core-js/modules/web.dom-collections.for-each.js");var i=n("../packages/model/src/index.ts"),s=n("../node_modules/i18next/dist/esm/i18next.js"),o=i.Sheet.SheetPropertiesDelta,r=i.Sheet.NEW_SHEET_PROPERTIES_SLOT;function a(e,t){var n,i,a=(null===(n=e.sheetDelta)||void 0===n?void 0:n.clone())||new o,d=(null===(i=t.sheetDelta)||void 0===i?void 0:i.clone())||new o;return a.deltas.forEach((function(t){d.deltas.forEach((function(n){if(t.slotName===r.SLOT_NAME&&n.slotName===r.SLOT_NAME&&t.value===n.value){var i=s.ZP.t("{{value0}}_自动重命名{{value1}}",{value0:t.value,value1:e.sheetId});t.value=i}}))})),a}},"../packages/mutation/src/workbook/SetWorkbookPropertiesMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=n("../packages/model/src/properties/index.ts"),o=n("../packages/mutation/src/MutationId.ts"),r=function(e){function t(t){var n;return(n=e.call(this,o.ZP.SET_WORKBOOK_PROPERTIES_MUTATION,t)||this).theme=t.theme,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({theme:e[0]})};var n=t.prototype;return n.serialize=function(){return[this.theme]},n.getAffectedSheets=function(){return[]},n.getAffectedSheetId=function(){return"WORKBOOK"},n.check=function(){return{isValid:!0}},n.runOnSheet=function(){},n.runOnWorkbook=function(e){var t,n=s.vCY.deserialize(((t={})[s.LK6.theme]=this.theme,t));return e.setTheme(n),!0},n.invert=function(){return[new t({theme:null})]},t}(n("../packages/mutation/src/Mutation.ts").Z);t.Z=r},"../packages/mutation/src/workbook/workbookRange/DefineWorkbookRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/model/src/index.ts")),o=n("../packages/mutation/src/MutationId.ts"),r=n("../packages/mutation/src/Mutation.ts"),a=n("../packages/mutation/src/workbook/workbookRange/DeleteWorkbookRangeMutation.ts"),d=n("../packages/model/src/workbookRange/PrivateRange.ts"),u=s.WorkbookRange.WorkbookRangeDelta,l=s.WorkbookRange.WORKBOOK_RANGE_TYPE,h=s.WorkbookRange.ChartWorkbookRange,c=s.WorkbookRange.ProtectedRange,I=s.WorkbookRange.LinkedRange,f=s.WorkbookRange.NotifyRange,m=s.Range.GridRange,g=function(e){function t(t){var n;return(n=e.call(this,o.ZP.DEFINE_WORKBOOK_RANGE_MUTATION,t)||this).workbookRangeId=t.workbookRangeId,n.gridRange=t.gridRange,n.workbookRangeType=t.workbookRangeType,n.workbookRangePropertiesDelta=t.workbookRangePropertiesDelta,n.nonPersistingLocalChange=!!t.nonPersistingLocalChange,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({workbookRangeId:e[0],gridRange:m.deserialize(e[1]),workbookRangeType:e[2],workbookRangePropertiesDelta:u.deserialize(e[3]),nonPersistingLocalChange:e[4]})};var n=t.prototype;return n.serialize=function(){return[this.workbookRangeId,this.gridRange.serialize(),this.workbookRangeType,this.workbookRangePropertiesDelta.serialize()]},n.clone=function(){return t.deserialize(this.serialize())},n.getAffectedSheetId=function(){return"WORKBOOK"},n.getAffectedSheets=function(){return[]},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},n.check=function(){return{isValid:!0}},n.runOnSheet=function(){},n.runOnWorkbook=function(e){var t=null;if(!e.sheetManager.getSheetBySheetId(this.gridRange.sheetId))return!0;var n={id:this.workbookRangeId,range:this.gridRange,type:this.workbookRangeType};switch(this.workbookRangeType){case l.PROTECTED_RANGE:this.workbookRangePropertiesDelta.getProtectionProperties()&&(t=new c(Object.assign(Object.assign({},n),{properties:this.workbookRangePropertiesDelta.getProtectionProperties()})));break;case l.CHART:this.workbookRangePropertiesDelta.getEmbeddedObjectId()&&(t=new h(Object.assign(Object.assign({},n),{embeddedObjectId:this.workbookRangePropertiesDelta.getEmbeddedObjectId()})));break;case l.LINKED_RANGE:t=new I(Object.assign(Object.assign({},n),{properties:this.workbookRangePropertiesDelta.getLinkedRangeProperties()}));break;case l.PRIVATE_RANGE:t=new d.Z(n);break;case l.NOTIFY_RANGE:t=new f(Object.assign({},n))}return t&&e.workbookRangeManager.addWorkbookRange(t),!0},n.invert=function(){return[new a.Z({workbookRangeId:this.workbookRangeId,workbookRangeType:this.workbookRangeType})]},n.transformWithInsertDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n=this.gridRange.clone();return n.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({workbookRangeId:this.workbookRangeId,workbookRangeType:this.workbookRangeType,gridRange:n,workbookRangePropertiesDelta:this.workbookRangePropertiesDelta})]},n.transformWithDeleteDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n=this.gridRange.clone();return n.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({workbookRangeId:this.workbookRangeId,workbookRangeType:this.workbookRangeType,gridRange:n,workbookRangePropertiesDelta:this.workbookRangePropertiesDelta})]},n.transformWithNewAddEmbeddedObjectMutation=function(e,t){return t||this.workbookRangePropertiesDelta.getEmbeddedObjectId()!==e.object.objectId?[this]:[]},n.transformWithNewDeleteEmbeddedObjectMutation=function(e){return this.workbookRangePropertiesDelta.getEmbeddedObjectId()===e.objectId?[]:[this]},n.transformWithNewUpdateEmbeddedObjectMutation=function(e,t){return t||this.workbookRangePropertiesDelta.getEmbeddedObjectId()!==e.object.objectId?[this]:[]},t}(r.Z);g.protoMap={0:{name:"workbookRangeId",dataType:String},1:{name:"gridRange",dataType:m},2:{name:"workbookRangeType",dataType:Number},3:{name:"workbookRangePropertiesDelta",dataType:u},4:{name:"nonPersistingLocalChange",dataType:Boolean}},t.Z=g},"../packages/mutation/src/workbook/workbookRange/DeleteWorkbookRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/mutation/src/MutationId.ts")),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/mutation/src/workbook/workbookRange/DefineWorkbookRangeMutation.ts"),a=n("../packages/mutation/src/workbook/workbookRange/util.ts"),d=function(e){function t(t){var n;return(n=e.call(this,s.ZP.DELETE_WORKBOOK_RANGE_MUTATION)||this).workbookRangeId=t.workbookRangeId,n.workbookRangeType=t.workbookRangeType,n.nonPersistingLocalChange=!!t.nonPersistingLocalChange,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({workbookRangeId:e[0],workbookRangeType:e[1],nonPersistingLocalChange:e[2]})};var n=t.prototype;return n.serialize=function(){return[this.workbookRangeId,this.workbookRangeType]},n.getAffectedSheetId=function(){return"WORKBOOK"},n.getAffectedSheets=function(){return[]},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},n.check=function(){return{isValid:!0}},n.runOnSheet=function(){},n.runOnWorkbook=function(e){return e.workbookRangeManager.deleteWorkbookRange(this.workbookRangeId),!0},n.invert=function(e){var t=(0,a.D)(e,this.workbookRangeType,this.workbookRangeId);return t?[new r.Z(t)]:[]},n.transformWithDeleteWorkbookRangeMutation=function(e,t){return this.workbookRangeId===e.workbookRangeId&&t?[]:[this]},t}(o.Z);d.protoMap={0:{name:"workbookRangeId",dataType:String},1:{name:"workbookRangeType",dataType:Number},2:{name:"nonPersistingLocalChange",dataType:Boolean}},t.Z=d},"../packages/mutation/src/workbook/workbookRange/UpdateWorkbookRangeMutation.ts":function(e,t,n){"use strict";var i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../packages/mutation/src/MutationId.ts")),o=n("../packages/mutation/src/Mutation.ts"),r=n("../packages/model/src/workbookRange/index.ts"),a=n("../packages/model/src/workbookRange/PrivateRange.ts"),d=n("../packages/mutation/src/workbook/workbookRange/util.ts"),u=n("../packages/model/src/range/GridRange.ts"),l=function(e){function t(t){var n;return(n=e.call(this,s.ZP.UPDATE_WORKBOOK_RANGE_MUTATION,t)||this).workbookRangeId=t.workbookRangeId,n.gridRange=t.gridRange,n.workbookRangeType=t.workbookRangeType,n.workbookRangePropertiesDelta=t.workbookRangePropertiesDelta,n.nonPersistingLocalChange=!!t.nonPersistingLocalChange,n}(0,i.Z)(t,e),t.deserialize=function(e){return new t({workbookRangeId:e[0],gridRange:u.Z.deserialize(e[1]),workbookRangeType:e[2],workbookRangePropertiesDelta:r.WorkbookRangeDelta.deserialize(e[3]),nonPersistingLocalChange:e[4]})};var n=t.prototype;return n.serialize=function(){return[this.workbookRangeId,this.gridRange.serialize(),this.workbookRangeType,this.workbookRangePropertiesDelta.serialize()]},n.getAffectedSheetId=function(){return"WORKBOOK"},n.getAffectedSheets=function(){return[]},n.isNonPersistedLocalChange=function(){return this.nonPersistingLocalChange},n.check=function(){return{isValid:!0}},n.runOnSheet=function(e){},n.runOnWorkbook=function(e){var t=null,n={id:this.workbookRangeId,range:this.gridRange.clone(),type:this.workbookRangeType};switch(this.workbookRangeType){case r.WORKBOOK_RANGE_TYPE.PROTECTED_RANGE:this.workbookRangePropertiesDelta.getProtectionProperties()&&(t=new r.ProtectedRange(Object.assign(Object.assign({},n),{properties:this.workbookRangePropertiesDelta.getProtectionProperties()})));break;case r.WORKBOOK_RANGE_TYPE.CHART:this.workbookRangePropertiesDelta.getEmbeddedObjectId()&&(t=new r.ChartWorkbookRange(Object.assign(Object.assign({},n),{embeddedObjectId:this.workbookRangePropertiesDelta.getEmbeddedObjectId()})));break;case r.WORKBOOK_RANGE_TYPE.LINKED_RANGE:this.workbookRangePropertiesDelta.getLinkedRangeProperties()&&(t=new r.LinkedRange(Object.assign(Object.assign({},n),{properties:this.workbookRangePropertiesDelta.getLinkedRangeProperties()})));break;case r.WORKBOOK_RANGE_TYPE.PRIVATE_RANGE:t=new a.Z(n)}return t&&e.workbookRangeManager.updateWorkbookRange(this.workbookRangeId,t),!0},n.invert=function(e){var n=(0,d.D)(e,this.workbookRangeType,this.workbookRangeId);return n?[new t(n)]:[]},n.transformWithInsertDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n=this.gridRange.clone();return n.insertDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({workbookRangeId:this.workbookRangeId,workbookRangeType:this.workbookRangeType,gridRange:n,workbookRangePropertiesDelta:this.workbookRangePropertiesDelta})]},n.transformWithDeleteDimensionMutation=function(e){if(this.gridRange.sheetId!==e.sheetId)return[this];var n=this.gridRange.clone();return n.deleteDimension({sheetId:e.sheetId,type:e.type,index:e.index,amount:e.amount}),[new t({workbookRangeId:this.workbookRangeId,workbookRangeType:this.workbookRangeType,gridRange:n,workbookRangePropertiesDelta:this.workbookRangePropertiesDelta})]},n.transformWithNewAddEmbeddedObjectMutation=function(e,t){return t||this.workbookRangePropertiesDelta.getEmbeddedObjectId()!==e.object.objectId?[this]:[]},n.transformWithNewDeleteEmbeddedObjectMutation=function(e){return this.workbookRangePropertiesDelta.getEmbeddedObjectId()===e.objectId?[]:[this]},n.transformWithNewUpdateEmbeddedObjectMutation=function(e,t){return t||this.workbookRangePropertiesDelta.getEmbeddedObjectId()!==e.object.objectId?[this]:[]},t}(o.Z);l.protoMap={0:{name:"workbookRangeId",dataType:String},1:{name:"gridRange",dataType:u.Z},2:{name:"workbookRangeType",dataType:Number},3:{name:"workbookRangePropertiesDelta",dataType:r.WorkbookRangeDelta},4:{name:"nonPersistingLocalChange",dataType:Boolean}},t.Z=l},"../packages/mutation/src/workbook/workbookRange/util.ts":function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var i,s=n("../packages/model/src/workbookRange/index.ts"),o=((i={})[s.WORKBOOK_RANGE_TYPE.PROTECTED_RANGE]=function(e,t){var n=e.getProtectedRangeById(t);if(!n)return null;var i=new s.WorkbookRangeDelta;return i.setProtectionProperties(n.properties),{workbookRangeId:t,gridRange:n.range.clone(),workbookRangeType:n.type,workbookRangePropertiesDelta:i}},i[s.WORKBOOK_RANGE_TYPE.CHART]=function(e,t){var n=e.getChartWorkbookRangeById(t);if(!n)return null;var i=new s.WorkbookRangeDelta;return i.setEmbeddedObjectId(n.embeddedObjectId),{workbookRangeId:t,gridRange:n.range.clone(),workbookRangeType:n.type,workbookRangePropertiesDelta:i}},i[s.WORKBOOK_RANGE_TYPE.LINKED_RANGE]=function(e,t){var n=e.getLinkedWorkbookRangeById(t);if(!n)return null;var i=new s.WorkbookRangeDelta,o=n.properties;return o&&i.setLinkedRangeProperties(o),{workbookRangeId:t,gridRange:n.range.clone(),workbookRangeType:n.type,workbookRangePropertiesDelta:i}},i[s.WORKBOOK_RANGE_TYPE.PRIVATE_RANGE]=function(e,t){var n=e.getPrivateWorkbookRangeById(t);if(!n)return null;var i=new s.WorkbookRangeDelta;return{workbookRangeId:t,gridRange:n.range.clone(),workbookRangeType:n.type,workbookRangePropertiesDelta:i}},i);function r(e,t,n){var i=e.workbookRangeManager,s=o[t];return(null===s||void 0===s?void 0:s(i,n))||null}},"../packages/report/src/index.ts":function(e,t,n){"use strict";n.d(t,{O8:function(){return i.O},iV:function(){return s.i}});var i=n("../packages/report/src/proxy.ts"),s=n("../packages/report/src/utils/env.ts");t.ZP=i.Z},"../packages/report/src/proxy.ts":function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var i=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../packages/report/src/index.ts")),o=function(){function e(t){this.cache=[],this.functionName=t,e.stack.push(this)}e.eachLoad=function(t,n){void 0===n&&(n=!1),s.iV&&e.stack.forEach((function(e){e.initLoad(t,n)}))};var t=e.prototype;return t.getProxyFunction=function(e){var t=this;return void 0===e&&(e=!1),function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];if(t.module)return t.execute.apply(t,i);e||t.cache.push((function(){return t.execute.apply(t,i)}))}},t.execute=function(){var e=this.functionName.split("."),t=this.getExecuteFunction(this.module,e),n=t.func;if(!n)return!1;for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return n.apply(t.self,s),!0},t.getExecuteFunction=function(e,t){var n=t.shift();return n?0===t.length?{self:e,func:null===e||void 0===e?void 0:e[n]}:this.getExecuteFunction(e[n],t):e},t.initLoad=function(e,t){void 0===t&&(t=!1),this.module=e,this.cache.forEach((function(e,t,n){(null===e||void 0===e?void 0:e())&&(n[t]=null)})),this.cache=this.cache.filter((function(e){return null!==e})),t&&(this.module=null)},(0,i.Z)(e,null,[{key:"isStackEmpty",get:function(){return!this.stack.some((function(e){return e.cache.length}))}}]),e}();o.stack=[];var r={run:new o("run").getProxyFunction(),speed:{runReport:new o("speed.runReport").getProxyFunction(),hasDonePagePerformanceReport:new o("speed.hasDonePagePerformanceReport").getProxyFunction()},jank:{log:new o("jank.log").getProxyFunction(!0),startMonitor:new o("jank.startMonitor").getProxyFunction(),closeMonitor:new o("jank.closeMonitor").getProxyFunction(),stopReport:new o("jank.stopReport").getProxyFunction(!0),restartReport:new o("jank.restartReport").getProxyFunction(!0)},tdwReport:new o("tdwReport").getProxyFunction(),tdwSingleReport:new o("tdwSingleReport").getProxyFunction(),flowlog:new o("flowlog").getProxyFunction(),monitor:new o("monitor").getProxyFunction(),huatuo:new o("huatuo").getProxyFunction(),retcode:new o("retcode").getProxyFunction(),tam:{reportT:new o("tam.reportT").getProxyFunction(),reportEvent:new o("tam.reportEvent").getProxyFunction()},zzsStatus:new o("zzsStatus").getProxyFunction(),zzsValue:new o("zzsValue").getProxyFunction(),tipReport:new o("tipReport").getProxyFunction(),resetDefaultTdwData:new o("resetDefaultTdwData").getProxyFunction(),getSource1:new o("getSource1").getProxyFunction(),kvrOss:new o("kvrOss").getProxyFunction(),idkey:new o("idkey").getProxyFunction()};t.Z=r},"../packages/report/src/utils/env.ts":function(e,t,n){"use strict";n.d(t,{i:function(){return s}});var i=n("../packages/common-utils/src/index.ts"),s=!(0,i.ej)("env_name")&&!(0,i.IZ)("devMode")&&!0},"../packages/undoRedoStack/src/index.ts":function(e,t,n){"use strict";n.d(t,{vT:function(){return a},gp:function(){return d}});var i,s=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=(n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),function(){function e(e){this.runMutation=e.runMutation,this.invertMutation=e.invertMutation,this.redoMutations=e.redoMutations||[],this.undoMutations=e.undoMutations||[],this.isLocal=!!e.isLocal,this.sheetId=e.sheetId,this.docType=e.docType,this.fromMultiSheetRequest=e.fromMultiSheetRequest}var t=e.prototype;return t.add=function(e){var t=this;this.redoMutations=this.redoMutations.concat(e);try{this.isLocal&&e.forEach((function(e){var n=e.requestId,i=t.invertMutation(e);i.forEach((function(e){e.requestId=n})),t.undoMutations=i.concat(t.undoMutations)}))}catch(n){console.error(n)}},t.run=function(e){var t=this;void 0===e&&(e=!1),e&&(this.redoMutations=[]),this.undoMutations.forEach((function(n){e&&(t.redoMutations=[].concat((0,s.Z)(t.invertMutation(n)),(0,s.Z)(t.redoMutations))),t.runMutation(n)}))},t.reverse=function(){return new e({sheetId:this.sheetId,docType:this.docType,redoMutations:this.undoMutations,undoMutations:this.redoMutations,isLocal:this.isLocal,runMutation:this.runMutation,invertMutation:this.invertMutation})},e}()),r=(n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/@tencent/containerized/build/main/index.js"));!function(e){e[e.UNDO=1]="UNDO",e[e.REDO=2]="REDO"}(i||(i={}));var a=(0,r.yh)("IUndoRedoStack"),d=function(){function e(){this.undoStack=[],this.redoStack=[],this.docTypeMutationFuncMap=new Map,this.onUndoRedoStackChangeFunMap=[],this.localUndoSize=0}var t=e.prototype;return t.canUndo=function(){return!!this.undoStack.length},t.canRedo=function(){return!!this.redoStack.length},t.registerDocType=function(e,t){var i,s=t.runMutation,o=t.invertMutation,r=t.follow,a=t.onUndoRedoStackChange;s&&o&&r||null===(i=n.g.log)||void 0===i||i.error("品类在 UndoRedoStack 注册相关依赖参数缺失"),this.getDocTypeDependency(e)||(this.docTypeMutationFuncMap.set(e,t),a&&this.onUndoRedoStackChangeFunMap.push(a))},t.createUndoRedoMutations=function(e){var t,i=e.docType,s=this.getDocTypeDependency(i);if(!s)return null===(t=n.g.log)||void 0===t||t.error("mutation 对应的品类未在 UndoRedoStack 正确注册相关依赖，请确认在此之前使用 registerDocType 注册品类"),{};var r=s.runMutation,a=s.invertMutation;return new o(Object.assign(Object.assign({},e),{runMutation:r,invertMutation:a}))},t.pushLocal=function(e){this.clearRedoStack(),this.pushUndoStack(e),this.onUndoRedoStackChangeFunMap.forEach((function(e){return e()}))},t.undo=function(e){var t,s,o=this.getLocalMutations(this.undoStack);if(!o)return null===(t=n.g.log)||void 0===t?void 0:t.info("undo stack is empty");this.localUndoSize-=1;var r=o.mutations,a=o.index,d=!1;a>=1&&(r=this.transform(r,{stack:this.undoStack,pointer:a-1}),a===this.undoStack.length&&(d=!0)),r.undoMutations.forEach((function(e){e.operationType=i.UNDO})),r.run(a>=1);var u=r.reverse();this.redoStack.unshift(u),d&&this.clearUndoStack();var l=this.getDocTypeDependency(r.docType);return null===(s=null===l||void 0===l?void 0:l.afterUndo)||void 0===s||s.call(l,r,e),this.onUndoRedoStackChangeFunMap.forEach((function(e){return e()})),r},t.redo=function(e){var t,s,o=this.getLocalMutations(this.redoStack);if(!o)return null===(t=n.g.log)||void 0===t?void 0:t.info("redo stack is empty");var r=o.mutations,a=o.index,d=!1;a>=1&&(r=this.transform(r,{stack:this.redoStack,pointer:a-1}),a===this.redoStack.length&&(d=!0)),r.undoMutations.forEach((function(e){e.operationType=i.REDO})),r.run(a>=1);var u=r.reverse();this.pushUndoStack(u),d&&this.clearRedoStack();var l=this.getDocTypeDependency(r.docType);return null===(s=null===l||void 0===l?void 0:l.afterRedo)||void 0===s||s.call(l,r,e),this.onUndoRedoStackChangeFunMap.forEach((function(e){return e()})),r},t.pushCollab=function(e){this.undoStack.length>0&&this.undoStack.unshift(e),this.redoStack.length>0&&this.redoStack.unshift(e)},t.destroy=function(){this.clearUndoStack(),this.clearRedoStack()},t.transform=function(e,t){for(var n,i=t.stack,s=t.pointer;s>=0;)if(n=i[s],e.docType===n.docType){var o=this.getDocTypeDependency(e.docType);if(o){var r=o.follow,a=r([e.undoMutations],[n.redoMutations],!0)[0],d=r([n.redoMutations],[e.undoMutations],!1)[0];e.undoMutations=d,e.redoMutations=[],i[s].redoMutations=a,s-=1}else console.error("对应的品类未在 UndoRedoStack 正确注册冲突处理方法，请确认在此之前使用 registerDocType 注册品类")}else s-=1;return e},t.clearUndoStack=function(){this.localUndoSize=0,this.undoStack.length=0},t.clearRedoStack=function(){this.redoStack.length=0},t.pushUndoStack=function(t){if(this.undoStack.unshift(t),this.localUndoSize+=1,!(this.localUndoSize<=e.MAX_STACK_SIZE))for(var n=this.undoStack.length-1,i=0;;n--){if(this.undoStack[n].isLocal&&2===(i+=1)){this.localUndoSize-=1;break}this.undoStack.pop()}},t.getLocalMutations=function(e){var t,n;for(t=0;t<e.length;t++)if((n=e[t]).isLocal)return e.splice(t,1),{mutations:n,index:t};return null},t.getDocTypeDependency=function(e){return this.docTypeMutationFuncMap.get(e)},e}();d.MAX_STACK_SIZE=100},"../packages/utils/src/client.ts":function(e,t,n){"use strict";n.d(t,{i:function(){return s}});var i=n("../packages/common-utils/src/index.ts");function s(){var e=(0,i.IZ)("client"),t=(0,i.ej)("open_theme_id"),n=(0,i.ej)("third_appid");return e||t||n||""}},"../packages/utils/src/index.ts":function(e,t,n){"use strict";n.d(t,{kk:function(){return i}});var i=n("../packages/utils/src/random.ts");n("../packages/utils/src/url.ts"),n("../packages/utils/src/safe.ts"),n("../packages/utils/src/client.ts")},"../packages/utils/src/random.ts":function(e,t,n){"use strict";function i(e,t){void 0===e&&(e=1e9),void 0===t&&(t=9999999999);var n=Math.floor(Math.random()*(t-e+1))+e;return String(n)}n.r(t),n.d(t,{getRandomId:function(){return i}})},"../packages/utils/src/safe.ts":function(e,t,n){"use strict";n.d(t,{G:function(){return s},f:function(){return o}});var i=n("../packages/common-utils/src/index.ts");function s(){var e=(0,i.ej)("skey"),t=5381;if(e){for(var n=0,s=e.length;n<s;n++)t+=(t<<5)+e.charAt(n).charCodeAt(0);return 2147483647&t}}function o(){return(0,i.ej)("TOK")||""}},"../packages/utils/src/url.ts":function(e,t,n){"use strict";n.d(t,{q:function(){return s}});var i=n("../packages/common-utils/src/index.ts");function s(e){var t=(0,i.IZ)("uid"),n=(0,i.IZ)("uid_key"),s=t?"uid="+t+"&uid_key="+n:"";if(!s)return e;var o=-1!==e.indexOf("?")?"&":"?";return""+e+o+s}},"../packages/editor/src/blocks/mention-block/MentionBlock.less":function(e,t,n){"use strict";n.r(t)}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/initial_chunk_part_2.bc4a508cb938b049bdc2.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=initial_chunk_part_2.bc4a508cb938b049bdc2.js.map