self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["bundle_plugin_init","bundle_plugin_resetlocation"],{"../spread-sheet/src/base/storage/storage.ts":function(e,t,n){function o(e,t){t.createdDate=+new Date;var n="docs_actions",o=function(e){if("undefined"!==typeof window.Storage)return localStorage.getItem(e)}(n);o=o&&JSON.parse(o)||[];var r={};o.forEach((function(e,t){var n=e.data;r[n.localPadId+"$"+n.domainId]={index:t,type:e.type,value:n}}));var a=r[t.localPadId+"$"+t.domainId];if(a){for(var i=0,s=Object.keys(t);i<s.length;i++){var d=s[i];a.value[d]=t[d]}o[a.index]={type:"ADD"===a.type&&"MODIFY"===e?"ADD":e,data:a.value}}else o.push({type:e,data:t});!function(e,t){"undefined"!==typeof window.Storage&&localStorage.setItem(e,t)}(n,JSON.stringify(o))}n.d(t,{G:function(){return o}}),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.keys.js")},"../spread-sheet/src/external/badgeServiceExcelAdapter/badgeServiceExcelAdapter.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return b}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.regexp.exec.js");var o=n("../spread-sheet/src/external/badgeServiceExcelAdapter/config.ts");function r(e,t){return e+"-"+t}function a(e){if(!e)return[];var t=[];return Object.keys(e).forEach((function(n){if(!function(e){return["version","groupId"].includes(e)}(n)){var o=e[n];t.push({key:o,position:n})}})),t}function i(e){if(e){var t={};return e.forEach((function(e){var n=e.position,o=e.key;t[n]=o})),t}}n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.array.includes.js");var s=function(){function e(){this.mainSubBadgeRelationMap={},this.badgeGroupList=[]}var t=e.prototype;return t.getAffectSubBadgeMapByUiKey=function(e,t){var n=r(e,t);return this.mainSubBadgeRelationMap[n]},t.addMainBadgeAndGenerateSubBadges=function(e){var t=this,n=e.info,o=n.position,a=n.key,i=r(o,a);e.relatedBadges.forEach((function(e){var n=e.position,o=e.key;t.setMainSubBadgeRelation(i,n,o)}));var s=this.getBadgeGroup(o,a);s&&this.singleGroupShareSubBadges(s)},t.addBadgeGroupData=function(e){var t=-1;if(this.badgeGroupList.some((function(n,o){if(n.groupId===e.groupId)return t=o,!0}))&&!e.version){var n=this.badgeGroupList[t];Object.assign(n,e),e=n}else this.badgeGroupList.push(e);this.singleGroupShareSubBadges(e)},t.getBadgeGroup=function(e,t){var n=void 0;return this.badgeGroupList.some((function(o){return o[e]===t&&(n=o,!0)})),n},t.relatedTo=function(e,t){var n=r(e.position,e.key);this.setMainSubBadgeRelation(n,t.position,t.key);var o=this.getBadgeGroup(e.position,e.key);o&&this.singleGroupShareSubBadges(o)},t.removeRelatedBadge=function(e,t){var n=this,o=r(e.position,e.key),i=r(t.position,t.key);this.mainSubBadgeRelationMap[o].delete(i),a(this.getBadgeGroup(e.position,e.key)).forEach((function(e){var t=r(e.position,e.key);n.mainSubBadgeRelationMap[t].delete(i)}))},t.singleGroupShareSubBadges=function(e){var t=this,n=new Map,o=[],i=!1;a(e).forEach((function(e){var a=e.position,s=e.key,d=t.getAffectSubBadgeMapByUiKey(a,s),c=r(a,s);o.push(c),d&&(i=!0,d.forEach((function(e){var t=e.key,o=e.position,a=r(o,t);n.set(a,{key:t,position:o})})))})),i&&o.forEach((function(e){t.mainSubBadgeRelationMap[e]=n}))},t.setMainSubBadgeRelation=function(e,t,n){this.mainSubBadgeRelationMap[e]||(this.mainSubBadgeRelationMap[e]=new Map);var o=r(t,n);this.mainSubBadgeRelationMap[e].set(o,{position:t,key:n})},e}(),d=function(){function e(){this.badgeInfoMap={}}var t=e.prototype;return t.isBadgeOn=function(e,t){var n=r(e,t);return!!this.badgeInfoMap[n]},t.updateBadgeDataMap=function(e,t){var n=this;e&&Object.keys(e).forEach((function(o){var a=r(o,e[o]);n.updateBadgeData(a,t)}))},t.getBadgeInfoMap=function(){return this.badgeInfoMap},t.loadBadgeDataList=function(e){var t=this;e&&0!==e.length&&e.forEach((function(e){a(e).forEach((function(e){var n=r(e.position,e.key);t.updateBadgeData(n,!0)}))}))},t.updateBadgeData=function(e,t){t?this.badgeInfoMap[e]=t:delete this.badgeInfoMap[e]},e}(),c=1,l=function(){function e(){this.mainSubBadgeRelationModel=new s,this.badgeDataModel=new d}var t=e.prototype;return t.init=function(e){var t=e.mainBadgeList,n=e.badgeGroupDataList,o=e.persistentStorageService,r=e.registerAfterUpdateBadgeInfoCallBack;this.persistentStorageService=o,this.registerAfterUpdateBadgeInfoCallBack=r,this.addMainBadgeList(t),this.addBadgeGroupDataList(n),this.badgeDataModel.loadBadgeDataList(n),this.saveSubBadgeInBadgeModeByBadgeGroupData(n),this.notifyUpdateCallBack()},t.getBadgeData=function(){return this.badgeDataModel.getBadgeInfoMap()},t.isBadgeOn=function(e,t){return this.badgeDataModel.isBadgeOn(e,t)},t.showBadgeOn=function(e,t){var n,o,r=t.key,a=t.expire,i=a&&a<=Date.now(),s=Object.assign(Object.assign({},t),{position:e}),d=this.persistentStorageService.isRemoved(s);if(!i&&!d){var l=c+1;c+=1;var u=((n={groupId:String(l)})[e]=r,n),g=((o={})[e]=r,o);return this.mainSubBadgeRelationModel.addBadgeGroupData(u),this.badgeDataModel.updateBadgeDataMap(g,!0),this.updateBadgeDataFromDB(u,!0,t),this.notifyUpdateCallBack(),u}},t.removeBadgeOn=function(e,t){var n,o=this.badgeDataModel.isBadgeOn(e,t);o&&this.badgeDataModel.updateBadgeDataMap(((n={})[e]=t,n),!1);var r=this.mainSubBadgeRelationModel.getAffectSubBadgeMapByUiKey(e,t),a=this.mainSubBadgeRelationModel.getBadgeGroup(e,t),s=i(r);this.badgeDataModel.updateBadgeDataMap(s,!1),this.badgeDataModel.updateBadgeDataMap(a,!1),o&&(this.updateBadgeDataFromDB(a,!1),this.notifyUpdateCallBack())},t.addMainBadgeList=function(e){var t=this;e.forEach((function(e){return t.mainSubBadgeRelationModel.addMainBadgeAndGenerateSubBadges(e)}))},t.addBadgeGroupDataList=function(e){e.forEach(this.mainSubBadgeRelationModel.addBadgeGroupData.bind(this.mainSubBadgeRelationModel))},t.relatedTo=function(e,t){this.mainSubBadgeRelationModel.relatedTo(e,t)},t.removeRelatedBadge=function(e,t){this.mainSubBadgeRelationModel.removeRelatedBadge(e,t)},t.saveSubBadgeInBadgeModeByBadgeGroupData=function(e){var t=this;e.forEach((function(e){var n=void 0;Object.keys(e).some((function(o){var r=e[o];return n=t.mainSubBadgeRelationModel.getAffectSubBadgeMapByUiKey(o,r)}));var o=i(n);t.badgeDataModel.updateBadgeDataMap(o,!0)}))},t.notifyUpdateCallBack=function(){var e=this.badgeDataModel.getBadgeInfoMap();this.registerAfterUpdateBadgeInfoCallBack(e)},t.updateBadgeDataFromDB=function(e,t,n){e&&this.persistentStorageService.updateBadgeData(e,t,n)},e}(),u=n("../node_modules/@tencent/docs-universal-config-sdk/build/index.js");function g(e){if(t=e,"[object Object]"!==Object.prototype.toString.call(t))return!1;var t,n=Object.keys(e).every((function(t){return function(e){return"[object String]"===Object.prototype.toString.call(e)}(e[t])}));return n}var p=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(t){a(t)}}function s(e){try{d(o.throw(e))}catch(t){a(t)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))},f=u.TianShu.reportAdClick,h=u.TianShu.getAd,m=function(){function e(){}var t=e.prototype;return t.getBadgeData=function(){return p(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h({posId:718,timeOut:2e3}).catch((function(e){}));case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",{mainBadgeList:[],badgeGroupDataList:[]});case 5:return n=[],o=[],t.lst.forEach((function(e){try{var t=JSON.parse(e.argList.key),r=t.mainBadgeList,a=t.badgeGroupData;g(a)&&(a.groupId=String(e.iAdId),n.push(a)),Array.prototype.push.apply(o,r)}catch(i){console.error(i)}})),e.abrupt("return",{mainBadgeList:o,badgeGroupDataList:n});case 9:case"end":return e.stop()}}),e)})))},t.updateBadgeData=function(e,t){return p(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,f({iAdId:e.groupId});case 4:return o=n.sent,r=o.err_code,a=0===r,n.abrupt("return",a);case 8:case"end":return n.stop()}}),n)})))},t.isRemoved=function(){return!1},e}(),v=n("../spread-sheet/src/base/event/event.ts"),S=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(t){a(t)}}function s(e){try{d(o.throw(e))}catch(t){a(t)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))},b=function(){function e(){}var t=e.prototype;return t.init=function(){return S(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.badgeService=new l,this.tianShuStorageService=new m,e.next=4,this.getBadgeDataFromStorage();case 4:t=e.sent,n=t.mainBadgeList,o=t.badgeGroupDataList,this.badgeService.init({mainBadgeList:n,persistentStorageService:this.tianShuStorageService,badgeGroupDataList:o,registerAfterUpdateBadgeInfoCallBack:this.registerAfterUpdateBadgeInfoCallBack.bind(this)});case 8:case"end":return e.stop()}}),e,this)})))},t.isBadgeOn=function(e,t){return this.badgeService.isBadgeOn(e,t)},t.getBadgeData=function(){return this.badgeService.getBadgeData()},t.showBadgeOn=function(e,t){return this.badgeService.showBadgeOn(e,t)},t.removeBadgeOn=function(e,t){return this.badgeService.removeBadgeOn(e,t)},t.getBadgeDataFromStorage=function(){return S(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tianShuStorageService.getBadgeData();case 2:return t=e.sent,n=t.mainBadgeList,o=t.badgeGroupDataList,r=this.cleanAndValidate(o),e.abrupt("return",{mainBadgeList:n,badgeGroupDataList:r});case 7:case"end":return e.stop()}}),e,this)})))},t.cleanAndValidate=function(e){var t=this;return e.filter((function(e){return t.registerIsBadgeDataValid(e)}))},t.registerIsBadgeDataValid=function(e){var t=/^(\d+\.\d+)\.(\d+)/i,n=t.exec(e.version||""),o=t.exec(window._grayVersion);return!n||!o||n[2]<=o[2]},t.registerAfterUpdateBadgeInfoCallBack=function(e){v.ZP.badge.trigger(o.K.VALUE_CHANGE,e)},e}()},"../spread-sheet/src/external/badgeServiceExcelAdapter/config.ts":function(e,t,n){var o;n.d(t,{K:function(){return o}}),function(e){e[e.VALUE_CHANGE=0]="VALUE_CHANGE"}(o||(o={}))},"../spread-sheet/src/external/resetLocation/index.ts":function(e,t,n){n.r(t);var o,r,a,i=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),d=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/esnext.reflect.metadata.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/i18next/dist/esm/i18next.js")),c=n("../node_modules/lodash/throttle.js"),l=n.n(c),u=n("../spread-sheet/src/base/util/timer.ts"),g=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),p=n.n(g),f=n("./node_modules/axios/index.js"),h=n.n(f),m=n("../packages/common-utils/src/index.ts"),v=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),S=n("../spread-sheet/src/external/resetLocation/utils.ts"),b=n("../packages/utils/src/safe.ts"),y=n("../spread-sheet/src/base/index.ts"),w=n("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),j=n("../packages/model/src/spreadsheet/Spreadsheet.interface.ts"),_=n("../node_modules/@tencent/containerized/build/main/index.js"),x=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),I=n("../packages/report/src/index.ts"),T=(n("../spread-sheet/src/base/util/domain-config.ts"),function(e,t,n,o){var r,a=arguments.length,i=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(a<3?r(i):a>3?r(t,n,i):r(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}),B=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},C=function(e,t){return function(n,o){t(n,o,e)}},R=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(t){a(t)}}function s(e){try{d(o.throw(e))}catch(t){a(t)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))},D=n.g.tdocs;!function(e){e[e.AT=0]="AT",e[e.DATE_REMDINER=1]="DATE_REMDINER",e[e.COMMENT=2]="COMMENT",e[e.RANGE=3]="RANGE"}(a||(a={}));var k=!(p().isMobilePhone||p().isAndroidPad)&&!p().isIPad,L=function(e){function t(t,o){var r;return(r=e.call(this)||this).app=t,r.spreadsheet=o,r.scrollTimer=0,r.initFeatureJumpCell=function(e){return R((0,i.Z)(r),void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i,s,c,l,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.parseUrlParam(e)){t.next=3;break}return t.abrupt("return");case 3:if(o=n.result.sheetId,r=this.app.spreadsheet.activeSheetId,!o||o===r){t.next=8;break}return t.next=8,this.switchSheet(o);case 8:i=n.result,s=i.rangeId,c=i.fromExcelId,l=this.app.view.canvas.spreadsheet.workbookRangeManager.getLinkedWorkbookRangeById(s),u=v.q.getConfig("padId"),t.t0=n.type,t.next=t.t0===a.AT?14:t.t0===a.DATE_REMDINER?16:t.t0===a.COMMENT?18:t.t0===a.RANGE?20:30;break;case 14:return this.jumpToMentionCell(n.result),t.abrupt("break",31);case 16:return this.jumpToReminderCell(n.result),t.abrupt("break",31);case 18:return this.jumpToComment(n.result),t.abrupt("break",31);case 20:l?this.app.view.canvas.positionApi.switchToRangeAndSelectAndCheckAuth(l.range):x.default.show({type:"info",message:d.ZP.t("链接的范围不存在或已隐藏"),autoClose:p().isMobile,duration:3e3,closable:!0}),t.t1=!0,t.next=t.t1===!c?24:t.t1===(c===u)?26:t.t1===(c!==u)?28:30;break;case 24:return I.ZP.kvrOss({itemname:"xls_rangelink_open"}),t.abrupt("break",30);case 26:return I.ZP.kvrOss({itemname:"xls_rangelink_go_samefile"}),t.abrupt("break",30);case 28:return I.ZP.kvrOss({itemname:"xls_rangelink_go_difffile"}),t.abrupt("break",30);case 30:return t.abrupt("break",31);case 31:case"end":return t.stop()}}),t,this)})))},r.handleScroll=function(){r.scrollTimer&&n.g.clearTimeout(r.scrollTimer),r.scrollTimer=n.g.setTimeout((function(){r.updateLocation(),y.Z.event.default.trigger("syncLoc")}),3e3)},r.updateLocation=function(){var e=r.app.view,t=e.getSheetLocation(),n=e.getCurrentPosition();if(n){var o=r.spreadsheet.activeSheetId,a={selectRange:t,sheetId:o,rowIndex:n.rowIndex,colIndex:n.colIndex};r.locCache.set(o,a)}},r._register((0,_.OF)((function(){r.destroy()}),"destroyResetLocation")),r}(0,s.Z)(t,e);var o=t.prototype;return o.init=function(e){var t;return R(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.originSheetId=e||(null===(t=this.getActiveSheetFromStorage())||void 0===t?void 0:t.localSheetId)||"",this.isOriginSheetLoaded=!1,this.locCache=new Map,this.initEvent(),n.next=8;break;case 8:return n.next=10,this.locate(this.originSheetId);case 10:case"end":return n.stop()}}),n,this)})))},o.saveChangeToLocation=function(){var e=this.spreadsheet.activeSheetId,t=this.locCache.get(e);if(t){var n=t.sheetId,o=(new Date).getTime(),r=[];this.locCache.forEach((function(e){var t=(0,S.gl)(!0,e.selectRange,e.rowIndex,e.colIndex);r.push([e.sheetId,t])}));var a=v.q.getConfig("padId"),i=v.q.getConfig("uid");this.syncToStorage(JSON.stringify(r),n,a,i,o)}},o.saveChangeToServer=function(){var e=this.spreadsheet.activeSheetId,t=this.locCache.get(e),n=v.q.getConfig("isLogin");if(t&&n){var o=t.selectRange,r=t.sheetId,a=t.rowIndex,i=t.colIndex,s=(new Date).getTime(),d=(0,S.gl)(!1,o,a,i);this.syncToServer(d,r,s)}},o.initEvent=function(){var e,t=this;this.app.emitter.on(this.app.EVENT.PAGE_LOAD_FINISHED,(function(){t.initFeatureJumpCell()})),this.app.view.canvas.normalSelectData.onUpdateSelectData(l()((function(){t.updateLocation(),y.Z.event.default.trigger("syncLoc")}),500,{trailing:!0})),this.app.view.canvas.areaData.onUpdateOffset(this.handleScroll),y.Z.event.sheetsBar.listen("switchSheetEnd",(function(){t.updateLocation(),t.saveChangeToServer(),t.saveChangeToLocation()})),null===(e=null===D||void 0===D?void 0:D.onUrlChange)||void 0===e||e.call(D,(function(e){var n=e.url;t.initFeatureJumpCell(n)})),y.Z.event.default.listen("syncLoc",l()((function(){t.saveChangeToLocation()}),5e3,{trailing:!0})),y.Z.event.default.listen("syncLoc",l()((function(){t.saveChangeToServer()}),12e4,{trailing:!0}))},o.switchSheet=function(e){return R(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.app.spreadsheet.activeSheetId,t.next=3,new Promise((function(t,r){y.Z.event.sheetsBar.trigger("switchSheet",e,n,{onSuccess:function(){return R(o,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t();case 1:case"end":return e.stop()}}),e)})))},onFail:function(){r()}})}));case 3:case"end":return t.stop()}}),t,this)})))},o.syncToStorage=function(e,t,o,r,a){var i;if(null===(i=n.g.log)||void 0===i||i.info("[locate] syncToStorage",{locData:e,padId:o,sheetId:t,updateTime:a,uid:r}),localStorage&&r&&o&&t)try{localStorage.setItem("user_"+r+"_"+o+"_location",e+"_"+a),localStorage.setItem("user_"+r+"_"+o+"_activeSheet",t+"_"+a)}catch(s){console.error(s)}},o.getActiveSheetFromStorage=function(){var e,t=v.q.getConfig("padId"),n=v.q.getConfig("uid");if(localStorage)try{e=localStorage.getItem("user_"+n+"_"+t+"_activeSheet")}catch(r){console.error(r)}if(e){var o=e.split("_");return{localSheetId:o[0],localUpdateTime:o[1]}}},o.getUrlParam=function(){var e=(0,m.IZ)("c")||(0,m.IZ)("coord"),t=(0,m.IZ)("tab");if((0,m.IZ)("coord")){var o=(0,m.oW)(n.g.location.href,"coord");try{n.g.history.replaceState({},"",o)}catch(a){console.error(a)}}if(e){var r=(0,m.oW)(n.g.location.href,"c");n.g.history.replaceState({},"",r)}return{coord:e,sheetId:t}},o.syncToServer=function(e,t,o){var r,a=v.q.getConfig("globalPadId");return null===(r=n.g.log)||void 0===r||r.info("[locate] syncToServer",{loc:e,sheetId:t,updateTime:o,globalPadId:a}),h()({url:"/sdc/updatebrowselocation",method:"POST",responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:"padid="+a+"&location="+JSON.stringify({updateTime:o,coord:e,sheetId:t,isopen:1})+"&xsrf="+(0,b.f)()}).then((function(e){})).catch((function(e){console.error("saveAsServer Error",e)}))},o.getServer=function(){return R(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.q.getConfig("globalPadId"),n=(0,b.f)(),o="/sdc/getbrowselocation?padid="+t+"&xsrf="+n,e.next=5,h().get(o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))},o.locateDefault=function(){var e=this;if(v.q.getConfig("isLogin")){var t=this.spreadsheet.sheetManager.getSheetOptionsList();this.applyStorageData(t,(function(t,n){e.saveSelectionCache(t,n)})),this.app.view.setFirstCellFocus()}},o.saveSelectionCache=function(e,t){e!==this.originSheetId||this.isOriginSheetLoaded||(this.isOriginSheetLoaded=!1,t&&(t.needCheckScrollBySize=!0)),(null===t||void 0===t?void 0:t.updateTime)&&Date.now()-t.updateTime>1296e6||this.app.view.saveSelectionCache(e,t)},o.locate=function(e){var t;return R(this,void 0,void 0,regeneratorRuntime.mark((function o(){var r,a,i,s,d,c,l=this;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(null===(t=n.g.log)||void 0===t||t.info("[locate] locate",{originSheetId:e}),v.q.getConfig("isLogin")){o.next=4;break}return o.abrupt("return");case 4:if(r=!1,a=this.spreadsheet.sheetManager.getSheetOptionsList(),this.applyStorageData(a,(function(e,t){l.saveSelectionCache(e,t)})),!(null===(i=this.getUrlParam())||void 0===i?void 0:i.coord)){o.next=10;break}return o.abrupt("return",this.applyUrlData(e,i));case 10:return s=u.Z.wait(3e3).run((function(){r=!0,l.setLocationWithLocal(e)})),o.prev=11,o.next=14,this.getServer();case 14:200===(d=o.sent).status&&(0!==(null===(c=d.data)||void 0===c?void 0:c.retcode)||r?this.setLocationWithLocal(e):(u.Z.erase(s),r=!1,this.handleResponse(c.result,e))),o.next=22;break;case 18:o.prev=18,o.t0=o.catch(11),console.error(o.t0),this.setLocationWithLocal(e);case 22:case"end":return o.stop()}}),o,this,[[11,18]])})))},o.handleResponse=function(e,t){e.sheetId?this.applyServerData(t,e):this.setLocationWithLocal(t)},o.setLocationWithServer=function(e){var t,o=this.app.view.getSheetLocation(),r=v.q.getConfig("isLogin"),a=o.row.flow;null===(t=n.g.log)||void 0===t||t.info("[locate] setLocationWithServer",{sheetId:e,selectRange:o,rowflow:a}),0===a&&void 0===o.xRange[0]?(k&&r?this.app.view.setSelection(e):this.app.view.setFirstCellFocus(),this.app.view.setSheetScroll(e)):void 0===o.xRange[0]&&k&&r&&this.app.view.setFirstCellFocus(),this.updateLocation()},o.setLocationWithLocal=function(e){var t,o=this.app.view.getSheetLocation(),r=o.row.flow;null===(t=n.g.log)||void 0===t||t.info("[locate] setLocationWithLocal",{sheetId:e,selectRange:o,rowflow:r}),0===r&&void 0===o.xRange[0]?(k?this.app.view.setSelection(e):this.app.view.setFirstCellFocus(),this.app.view.setSheetScroll(e)):void 0===o.xRange[0]&&k&&this.app.view.setFirstCellFocus(),this.updateLocation()},o.applyUrlData=function(e,t){if(void 0===t&&(t=this.getUrlParam()),t.coord){var n=t,o=n.coord,r=n.sheetId,a=(0,S.fe)(!1,o).selectRange;r&&r===e?(this.saveSelectionCache(r,a),this.setLocationWithServer(r)):this.setLocationWithLocal(r)}else this.setLocationWithLocal(e)},o.applyServerData=function(e,t){t||this.setLocationWithLocal(e);var n=t.coord,o=t.updateTime,r=t.sheetId,a=(0,S.fe)(!1,n).selectRange,i=this.getActiveSheetFromStorage(),s=r;if(i){var d=i.localSheetId;o<+i.localUpdateTime&&(s=d)}if(e)if(e!==r)this.setLocationWithLocal(e);else{var c=this.app.view.getSelectionCache(r);(null===c||void 0===c?void 0:c.updateTime)?o>c.updateTime?(this.saveSelectionCache(r,a),this.setLocationWithServer(r)):this.setLocationWithLocal(r):(this.saveSelectionCache(r,a),this.setLocationWithServer(r))}else this.setLocationWithLocal(s)},o.applyStorageData=function(e,t){var n=this,o=this.getTotalDataFromStorage();if(o){var r=o.split("_"),a=r[0],i=r[1];JSON.parse(a).forEach((function(e){var o=e[0],r=e[1],a=(0,S.fe)(!0,r),s=a.selectRange,d=a.rowIndex,c=a.colIndex;s.updateTime=+i,n.locCache.set(o,{sheetId:o,selectRange:s,rowIndex:d,colIndex:c}),null===t||void 0===t||t(o,s)}))}else for(var s=0;s<e.length;s++){var d=e[s].id,c=this.getSheetDataFromStorage(d);if(c){var l=c.split("_"),u=l[0],g=l[1],p=(0,S.fe)(!0,u).selectRange;p.updateTime=+g,null===t||void 0===t||t(d,p),this.removeSheetDataFromStorage(d)}}},o.getSheetDataFromStorage=function(e){var t,o=v.q.getConfig("globalPadId"),r=v.q.getConfig("uid");if(n.g.localStorage)try{t=n.g.localStorage.getItem("user_"+r+"_"+o+"_"+e)}catch(a){console.error(a)}return t},o.removeSheetDataFromStorage=function(e){var t=v.q.getConfig("globalPadId"),o=v.q.getConfig("uid");if(n.g.localStorage)try{n.g.localStorage.removeItem("user_"+o+"_"+t+"_"+e),n.g.localStorage.removeItem("user_"+o+"_"+t+"_activeSheet")}catch(r){console.error(r)}},o.parseUrlParam=function(e){var t=(0,m.IZ)("mainid",e),n=(0,m.IZ)("reminderid",e),o=(0,m.IZ)("group_id",e),r=(0,m.IZ)("rangeid",e);if(t){var i=t.split("|");if(3==i.length)return{type:a.AT,result:{sheetId:i[0],coord:i[1],mentionId:i[2]}}}else{if(n){var s=n.split("|");return{type:a.DATE_REMDINER,result:{reminderId:s[0],sheetId:s[1]}}}if(o){var d=(0,m.IZ)("comment_id",e),c=(0,m.IZ)("subid",e);return{type:a.COMMENT,result:{anchorId:o,commentId:d,sheetId:c}}}}if(r){var l=(0,m.IZ)("tab",e),u=(0,m.IZ)("fromexcelid",e);return{type:a.RANGE,result:{sheetId:l,rangeId:r,fromExcelId:u}}}return null},o.getTotalDataFromStorage=function(){var e,t=v.q.getConfig("padId"),o=v.q.getConfig("uid");if(n.g.localStorage)try{e=n.g.localStorage.getItem("user_"+o+"_"+t+"_location")}catch(r){console.error(r)}return e},o.jumpToMentionCell=function(e){var t=e.mentionId,n=e.coord,o=(0,S.fe)(!1,n),r=o.rowIndex,i=o.colIndex,s=this.getElementPos(r,i,{type:a.AT,id:t});s&&this.needScrollIntoView(r,i,s)&&this.app.view.canvas.scrollApi.scrollToRenderFrom({row:r,col:i})},o.jumpToReminderCell=function(e){var t=e.reminderId,n=this.app.spreadsheet.activeSheet.dateReminderManager.getDateReminder(t);if(n){var o=n.rowIndex,r=n.colIndex,i=this.getElementPos(o,r,{type:a.DATE_REMDINER,id:t});i&&this.needScrollIntoView(o,r,i)&&this.app.view.canvas.scrollApi.scrollToRenderFrom({row:o,col:r}),this.reportOpenFromDateReminderNotify()}else console.error("Error: can not find date reminder!!!")},o.jumpToComment=function(e){var t=e.anchorId;this.app.view.canvas.commentCenter.showComment(t)},o.getElementPos=function(e,t,n){var o,r,i=this.app.view.canvas.areaData,s=i.getDisplayViewLeftByCol(t),d=i.getDisplayViewTopByRow(e);if(n.type===a.DATE_REMDINER)return{x:s,y:d};if(n.type===a.AT){var c=this.app.view.canvas.transformTable.getCellDataAtPosition(e,t);if(null===(o=null===c||void 0===c?void 0:c.lines)||void 0===o?void 0:o.length)for(var l,u,g,p=0,f=0,h=0;h<c.lines.length;h++){u=(l=c.lines[h]).segments,p=l.offsetX,f=l.offsetY-3*l.height/4>>0;for(var m=0;m<u.length;m++){if((null===(r=null===(g=u[m])||void 0===g?void 0:g.mention)||void 0===r?void 0:r.mentionId)===n.id)return{x:s+p,y:d+f};p+=g.size.width}}}return null},o.needScrollIntoView=function(e,t,n){var o=this.app.view.canvas.areaData,r=0,a=0;return!(!o.inFlowColArea(t)||(a=(r=o.col.flow.displayOffsetSize)+o.col.flow.displayViewSize,r<=n.x&&n.x<a))||!(!o.inFlowRowArea(e)||(a=(r=o.row.flow.displayOffsetSize)+o.row.flow.displayViewSize,r<=n.y&&n.y<a))},o.destroy=function(){this.originSheetId=null,this.locCache=new Map},o.reportOpenFromDateReminderNotify=function(){I.ZP.kvrOss({itemname:"n_xls_alarm_from_notif",biz:"personal",Channel1:p().isPC?"pc":"m"})},t}(_.JT);L=T([C(0,w.m),C(1,j.V),B("design:paramtypes",["function"===typeof(o="undefined"!==typeof w.m&&w.m)?o:Object,"function"===typeof(r="undefined"!==typeof j.V&&j.V)?r:Object])],L),t.default=L},"../spread-sheet/src/external/sync-guide/cgi.ts":function(e,t,n){n.d(t,{Ll:function(){return s},Qe:function(){return d}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js");var o=n("./node_modules/axios/index.js"),r=n.n(o),a=n("../spread-sheet/src/external/sync-guide/common.ts"),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(t){a(t)}}function s(e){try{d(o.throw(e))}catch(t){a(t)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))};function s(e){var t,o,s,d;return i(this,void 0,void 0,regeneratorRuntime.mark((function i(){var c,l,u,g;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r().post("/v2/enterprise/communication/get",{toggle_type:e.toggleType,file_id:e.fileId});case 3:if(c=i.sent,0!==(null===(t=null===c||void 0===c?void 0:c.data)||void 0===t?void 0:t.retcode)){i.next=13;break}if(l=c.data.result,u=l.toggleOn,g=l.toggleScope,!1!==u){i.next=9;break}return i.abrupt("return",a.wR.OFF);case 9:if(!0!==u||g!==a.wR.ALL){i.next=11;break}return i.abrupt("return",a.wR.ALL);case 11:if(!0!==u||g!==a.wR.SINGLE){i.next=13;break}return i.abrupt("return",a.wR.SINGLE);case 13:return null===(o=n.g.log)||void 0===o||o.info("getEntCommunicationToggle sync fail("+(null===(s=null===c||void 0===c?void 0:c.data)||void 0===s?void 0:s.retcode)+")"),i.abrupt("return",a.wR.OFF);case 17:return i.prev=17,i.t0=i.catch(0),null===(d=n.g.log)||void 0===d||d.info("getEntCommunicationToggle sync error("+i.t0+")"),i.abrupt("return",a.wR.OFF);case 21:case"end":return i.stop()}}),i,null,[[0,17]])})))}function d(e){var t=this;return new Promise((function(o,a){return i(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i,s,d,c,l,u,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r().post("/v2/enterprise/communication/set",{toggle_type:e.toggleType,toggle_scope:e.toggleScope,toggle_on:e.toggleOn,file_id:e.fileId||""});case 3:if(g=t.sent,0===(null===(i=null===g||void 0===g?void 0:g.data)||void 0===i?void 0:i.retcode)){t.next=7;break}return null===(s=n.g.log)||void 0===s||s.info("setEntCommunicationToggle sync fail("+(null===(d=null===g||void 0===g?void 0:g.data)||void 0===d?void 0:d.retcode)+")"),t.abrupt("return",a(null===(c=null===g||void 0===g?void 0:g.data)||void 0===c?void 0:c.retcode));case 7:return t.abrupt("return",o(null===(l=null===g||void 0===g?void 0:g.data)||void 0===l?void 0:l.retcode));case 10:return t.prev=10,t.t0=t.catch(0),null===(u=n.g.log)||void 0===u||u.info("setEntCommunicationToggle sync error("+t.t0+")"),t.abrupt("return",a(-1));case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))}))}},"../spread-sheet/src/external/sync-guide/common.ts":function(e,t,n){n.d(t,{Vy:function(){return i},YQ:function(){return a},_S:function(){return r},wR:function(){return o}});var o,r,a,i="IS_SYNC_TO_C_LIST";!function(e){e[e.ALL=0]="ALL",e[e.SINGLE=1]="SINGLE",e[e.OFF=2]="OFF"}(o||(o={})),function(e){e[e.RECENT=0]="RECENT"}(r||(r={})),function(e){e[e.ALL=0]="ALL",e[e.SINGLE=1]="SINGLE"}(a||(a={}))},"../spread-sheet/src/external/sync-guide/sync-guide.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var o=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/i18next/dist/esm/i18next.js")),a=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),i=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),s=n("../spread-sheet/src/external/sync-guide/cgi.ts"),d=n("../node_modules/@tencent/containerized/build/main/index.js"),c=n("../spread-sheet/src/external/sync-guide/common.ts"),l=(n("../spread-sheet/src/base/util/domain-config.ts"),function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(t){a(t)}}function s(e){try{d(o.throw(e))}catch(t){a(t)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))}),u=function(e){function t(){var t;return(t=e.call(this)||this)._register((0,d.OF)((function(){}),"destroySyncGuide")),t}(0,o.Z)(t,e);var n=t.prototype;return n.init=function(){return l(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.getItem(c.Vy),e.abrupt("return");case 3:return localStorage.setItem(c.Vy,"1"),e.next=7,(0,s.Ll)({toggleType:c._S.RECENT,fileId:i.q.getConfig("padId")});case 7:if(e.sent===c.wR.OFF){e.next=10;break}return e.abrupt("return");case 10:case 11:case"end":return e.stop()}}),e)})))},n.showSingleToggle=function(e){var t=this,n=(null===e||void 0===e?void 0:e.singleText)||r.ZP.t("这是一篇企业文档，是否添加到腾讯文档列表？");a.default.show({id:"sync-guide-tips",type:"info",message:n,action:[{text:r.ZP.t("暂不"),onClick:function(){var n;t.handleUnSyncDoc(),null===(n=null===e||void 0===e?void 0:e.fail)||void 0===n||n.call(e)}},{text:r.ZP.t("添加"),onClick:function(){t.handleSyncSingleDoc(null===e||void 0===e?void 0:e.allText,null===e||void 0===e?void 0:e.success)}}],autoClose:!1})},n.showAllToggle=function(e,t){var n=this,o=e||r.ZP.t("添加成功，以后打开企业微信文档都默认添加。");a.default.show({id:"sync-guide-tips",type:"success",message:o,action:[{text:r.ZP.t("暂不"),onClick:function(){}},{text:r.ZP.t("确定"),onClick:function(){n.handleSyncAllDoc()}}],onClose:function(){setTimeout((function(){null===t||void 0===t||t()}),10)},autoClose:!1})},n.handleUnSyncDoc=function(){(0,s.Qe)({toggleType:c._S.RECENT,toggleOn:!1,fileId:i.q.getConfig("padId")})},n.handleSyncSingleDoc=function(e,t){var n=this;(0,s.Qe)({toggleType:c._S.RECENT,toggleScope:c.YQ.SINGLE,toggleOn:!0,fileId:i.q.getConfig("padId")}).then((function(){n.showAllToggle(e,t)}))},n.handleSyncAllDoc=function(){(0,s.Qe)({toggleType:c._S.RECENT,toggleScope:c.YQ.ALL,toggleOn:!0})},t}(d.JT)},"../spread-sheet/src/external/titleSync/titleSync.ts":function(e,t,n){n.r(t);var o,r,a=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),i=n("../node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js"),s=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/esnext.reflect.metadata.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/i18next/dist/esm/i18next.js")),d=n("../spread-sheet/src/base/event/eventName.ts"),c=n("../spread-sheet/src/base/storage/storage.ts"),l=n("../packages/common-utils/src/index.ts"),u=n("../packages/report/src/index.ts"),g=n("../spread-sheet/src/core/ui/toast/index.ts"),p=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),f=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),h=n.n(f),m=n("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),v=n("../spread-sheet/src/core/utils/config.ts"),S=n("../node_modules/@tencent/containerized/build/main/index.js"),b=n("../spread-sheet/src/external/share/share-controller.interface.ts"),y=n("../spread-sheet/src/base/util/appConfig.ts"),w=function(e,t,n,o){var r,a=arguments.length,i=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(a<3?r(i):a>3?r(t,n,i):r(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i},j=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e,t){return function(n,o){t(n,o,e)}},x=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(t){a(t)}}function s(e){try{d(o.throw(e))}catch(t){a(t)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}d((o=o.apply(e,t||[])).next())}))},I=function(e){function t(){return e.call(this,"Title is illegal")||this}return(0,a.Z)(t,e),t}((0,i.Z)(Error)),T=function(){function e(e,t){var o=this;this.app=e,this.shareController=t,this.disposables=new S.SL,this.checkTitle=function(e){return e.replace(/[\\\/:*?"<>|]/g,"").slice(0,128)||s.ZP.t("无标题表格")},this._handleUpdateTitleServer=function(e){o.titleEffect(e)},this._handleTitleAutoChange=function(){o.titleUpdateTips()},this._handleUpdateTitleLocal=function(e,t){var r;null===(r=n.g.log)||void 0===r||r.log(s.ZP.t("本地变更标题:"),e,t),(0,v.q)()||o.setDocumentTitleToServer(t).catch((function(){return o.app.spreadsheet.setTitle(e,!0)})),o.titleEffect(t)}}var t=e.prototype;return t.init=function(){this.bindEvents(),this.app.spreadsheet.setTitle(p.q.getConfig("title"),!0)},t.destroy=function(){this.disposables.dispose(),this.app.event.spreadsheetEvent.remove(d.W1.TITLE_AUTO_CHANGE,this._handleTitleAutoChange),(0,g.hideToast)()},t.bindEvents=function(){var e=this;this.disposables.add(this.app.spreadsheet.onUpdateTitle((function(t){t.isServer?e._handleUpdateTitleServer(t.newTitle):e._handleUpdateTitleLocal(t.oldTitle,t.newTitle)}))),this.app.event.spreadsheetEvent.listen(d.W1.TITLE_AUTO_CHANGE,this._handleTitleAutoChange)},t.titleUpdateTips=function(){var e=this;if(localStorage){var t=Number(localStorage.getItem("titleAutoSyncTipsTime"))||0;if(t<=2){if(h().isMobile||h().isIPad){var n={isNeedBtn:!0,btnText:s.ZP.t("点击修改"),btnCallBack:function(){e.app.view.header.component.showRenameDialog()}};(0,g.showToast)(s.ZP.t("已自动同步标题，"),void 0,Object.assign({toolToastCloseTime:5e3,supportMobile:!0},n))}else(0,g.showToast)(s.ZP.t("已自动生成标题，点击标题可进行修改。"),void 0,{toolToastCloseTime:5e3,supportMobile:!0});t+=1,localStorage.setItem("titleAutoSyncTipsTime",String(t))}}},t.setOfflineStoreTitle=function(e){"undefined"!==typeof window.Storage&&(e?localStorage.setItem("offline_title_"+p.q.getConfig("padId"),e):localStorage.removeItem("offline_title_"+p.q.getConfig("padId")))},t.setDocumentTitleToServer=function(e){var t,o,r;return x(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,s,d,g,f,h;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e=this.checkTitle(e),i=p.q.getConfig("creatorDomain"),s=p.q.getConfig("domainId"),d=p.q.getConfig("padId"),this.setOfflineStoreTitle(e),(0,c.G)("MODIFY",{domainId:s,localPadId:d,title:e,actiontoserver:1}),g=(0,l.XK)("//"+y.Z.getConfig("runtime.domainName")+"/cgi-bin/redirect/"+i+"/ep/api/changetitle",{localPadId:d,newTitle:e}),a.prev=7,a.next=10,$.post(g,{});case 10:if(0===(f=a.sent).retcode||"0"===f.retcode){p.q.setConfig({isUserChangeTitle:1,title:e});try{(0,c.G)("MODIFY",{domainId:s,localPadId:d,title:e,title_sort_priority:f.doc_info.title_sort_priority,title_sort_value:f.doc_info.title_sort_value}),h=localStorage.getItem("tdsourcetag"),u.ZP.tdwReport({opername:"doc_core",module:"edit",action:"modify_title",source3:h||""})}catch(m){null===(t=n.g.log)||void 0===t||t.error("tdsourcetag error:",m,f)}this.setOfflineStoreTitle("")}else null===(o=n.g.log)||void 0===o||o.warn("request changetitle response. retcode = "+f.retcode+" cgicode = "+f.cgicode),this.checkTitleSecurity(f);a.next=19;break;case 14:throw a.prev=14,a.t0=a.catch(7),null===(r=n.g.log)||void 0===r||r.error("标题修改失败",null===a.t0||void 0===a.t0?void 0:a.t0.stack),this.showSecurityToast(a.t0),a.t0;case 19:case"end":return a.stop()}}),a,this,[[7,14]])})))},t.checkTitleSecurity=function(e){throw 12e3===parseInt(e.retcode,10)||12e3===parseInt(e.cgicode,10)?new I:Error("Set title failed")},t.showSecurityToast=function(e){e instanceof I?(0,g.showToast)(s.ZP.t("标题不合规，请重新命名。"),void 0,{toolToastCloseTime:5e3,supportMobile:!0}):(0,g.showToast)(s.ZP.t("修改标题失败，请重试。"),void 0,{toolToastCloseTime:5e3,supportMobile:!0})},t.titleEffect=function(e){var t,o,r,a,i,d,c;return x(this,void 0,void 0,regeneratorRuntime.mark((function l(){return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.checkMobikeAndIPad()){l.next=15;break}return l.next=3,this.shareController.getInstance();case 3:l.sent.setShareInfo(),null===(t=n.g.log)||void 0===t||t.log(s.ZP.t("share模块 getInstance success")),h().isTencentDocsApp&&(null===(o=n.g.mqq)||void 0===o||o.invoke("ui","setWebviewNaviTitle",{title:e,url:window.location.href})),document.title=e,h().isIOS&&(null===(r=n.g.mqq)||void 0===r||r.invoke("ui","setWebviewNaviTitle",{title:e,refreshDocList:"true"})),h().isIOS||this.setSharedDocNativeKeyboardEnable(),h().isMiniProgram&&(null===(a=n.g.wx)||void 0===a||a.miniProgram.postMessage({data:{title:e}}),null===(i=n.g.log)||void 0===i||i.log(s.ZP.t("更新小程序标题:"),e)),p.q.setConfig({padTitle:e}),this.app.event.default.trigger("title-update-m",e),l.next=17;break;case 15:try{document.title=e,p.q.setConfig({padTitle:e}),h().isWxDrive&&(null===(d=null===window||void 0===window?void 0:window.settings)||void 0===d?void 0:d.fileName)&&(window.settings.fileName=e)}catch(u){null===(c=n.g.log)||void 0===c||c.error("titleEffect error:",u)}this.app.event.default.trigger("title-update-pc",{title:e});case 17:case"end":return l.stop()}}),l,this)})))},t.checkMobikeAndIPad=function(){return h().isMobilePhone||h().isAndroidPad||h().isIPad},t.setSharedDocNativeKeyboardEnable=function(){var e,t;try{null===(e=n.g.mqq)||void 0===e||e.invoke("ui","setSharedDocNativeKeyboardEnable",{enable:0,source:0},(function(){}))}catch(o){null===(t=n.g.log)||void 0===t||t.error("setSharedDocNativeKeyboardEnable error:",o)}},e}();T=w([_(0,m.m),_(1,b.N),j("design:paramtypes",["function"===typeof(o="undefined"!==typeof m.m&&m.m)?o:Object,"function"===typeof(r="undefined"!==typeof S.RU&&S.RU)?r:Object])],T),t.default=T}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/bundle_plugin_init.8937d1083e7e44001662.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=bundle_plugin_init.8937d1083e7e44001662.js.map