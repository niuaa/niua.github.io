self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["bundle_module_behavior_api"],{"../spread-sheet/src/core/behavior/api.ts":function(e,t,r){r.r(t),r.d(t,{default:function(){return je}});var a={};r.r(a);var s,n,o,i,d,l,c,u,p,h,I,E=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),f=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/esnext.reflect.metadata.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.slice.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.symbol.description.js"),r("../node_modules/core-js/modules/es.symbol.iterator.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/i18next/dist/esm/i18next.js")),v=r("../packages/utils/src/index.ts"),T=r("../spread-sheet/src/core/behavior/request/Type.ts"),_=r("../packages/model/src/dimension/DimensionType.ts"),m=r("../packages/model/src/range/DimensionRange.ts"),g=r("../spread-sheet/src/core/behavior/request/enum/FormatItem.ts"),S=r("../packages/model/src/range/GridRange.ts"),y=r("../packages/model/src/cell/format/HorizontalAlign.ts"),R=r("../packages/model/src/range/gridRangeUtils.ts"),A=r("../packages/model/src/cell/CellDataSlot.ts"),O=r("../spread-sheet/src/core/feature/formula/utils.ts"),N=r("../spread-sheet/src/core/feature/formula/autofix.ts"),D=r("../packages/model/src/cell/CellData.ts"),w=r("../packages/model/src/range/SheetRangeType.ts"),C=r("../packages/model/src/config/index.ts"),b=r("../node_modules/@tencent/tdocs-format-render/lib/index.js"),Z=r("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),L=r("../packages/report/src/index.ts"),P=r("../spread-sheet/src/core/ui/dialog/index.ts"),M=r("../packages/model/src/cell/format/BorderType.ts"),U=r("../spread-sheet/src/core/behavior/utils.ts"),j=r("../packages/model/src/cell/index.ts"),k=r("../spread-sheet/src/core/ui/toast/toast.tsx"),x=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),V=r.n(x),F=r("../spread-sheet/src/core/behavior/request/cell/SetMetadataRequest.ts"),q=r("../packages/model/src/cell/metadata/CustomDataType.ts"),G=r("../spread-sheet/src/core/feature/relateForm/seeker-util.ts"),Q=r("../node_modules/lodash/flattenDeep.js"),H=r.n(Q),B=(0,r("../node_modules/@tencent/containerized/build/main/index.js").yh)("IBehavior"),W=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.string.includes.js"),r("../node_modules/core-js/modules/es.string.repeat.js"),r("../packages/model/src/grid/Selection.ts")),Y=r("../spread-sheet/src/core/app/dataCallCore.ts"),K=r("../spread-sheet/src/base/event/event.ts"),z=r("../spread-sheet/src/core/behavior/requests.ts"),J=r("../spread-sheet/src/core/behavior/request/Request.ts"),X=r("../spread-sheet/src/base/util/timer.ts"),$=r("../spread-sheet/src/base/config/report.ts"),ee=r("../node_modules/@tencent/jank-sdk/lib/index.js"),te=r("../spread-sheet/src/base/event/eventName.ts"),re=r("../spread-sheet/src/base/error/index.ts"),ae=r("../packages/undoRedoStack/src/index.ts"),se=r("../spread-sheet/src/core/network/message-center/model/userChange-helper.ts"),ne=r("../spread-sheet/src/core/view/layout/interface/pc-view.ts"),oe=r("../spread-sheet/src/core/behavior/constants.ts"),ie=r("../spread-sheet/src/external/view/workbench/service/create-new-doc.ts"),de=function(e,t,r,a){var s,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,r,a);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o},le=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},ce=function(e,t){return function(r,a){t(r,a,e)}},ue=function(){function e(e,t,r){this.parent=e,this.undoredoStack=t,this.selectionParent=r}var t=e.prototype;return t.apply=function(e){var t,a=this;if(this.parent.getDidEditable&&!this.parent.getDidEditable()&&"local"===e.type&&!(null===(t=this.parent.spreadsheet.sheetManager.getSheetBySheetId(e.sheetId))||void 0===t?void 0:t.isExternalSheet()))return Promise.resolve(null);if("undo"!==e.type&&"redo"!==e.type&&"local"!==e.type||L.ZP.monitor(33638269),this.isNeedPermissionCheck(e)&&!1===this.checkPermission(e))return Promise.reject("checkPermissionFail");var s,n=function(t){return function(a,s){var n;try{t(a,s)}catch(o){null===(n=r.g.log)||void 0===n||n.error("behavior","apply error",e,o),L.ZP.run($.CONFIG.APPLY_BEHAVIOR_CATCH_SCRIPT_ERROR,[],o,e.type)}}};switch(K.ZP.spreadsheetEvent.trigger("applyBehaviorStart",e.sheetId),e.type){case"undo":s=new Promise(n((function(t){a.applyUndo(e.sheetId,t)})));break;case"redo":s=new Promise(n((function(t){a.applyRedo(e.sheetId,t)})));break;case"collab":s=new Promise(n((function(t,r){a.applyCollabMutations(e.opt.changeInfo,e.opt.changes,t,r)})));break;case"offline":s=new Promise(n((function(t){a.applyOfflineMutations(e.opt,t)})));break;case"local":s=new Promise(n((function(t,r){void 0===e.canUndoRedo&&(e.canUndoRedo=!0),a.applyLocalRequest(e.type,e.sheetId,e.requestId,e.opt,e.canUndoRedo,t,r)})));break;default:s=new Promise((function(e,t){t()}))}return s},t.isNeedPermissionCheck=function(e){return![T.Z.UPDATE_FILTER_CRITERIA_REQUEST,T.Z.SET_BASIC_FILTER_REQUEST,T.Z.CLEAR_BASIC_FILTER_REQUEST].includes(e.requestId)},t.checkPermission=function(e){return!!("undo"!==e.type&&"redo"!==e.type&&"local"!==e.type||this.parent.sheetStatus.workbookStatus.canEdit||this.parent.sheetStatus.canComment)},t.applyUndo=function(e,t){L.ZP.jank.log({moduleValue:"applyMutation",actionValue:"undo"}),this.parent.sheetStatus.frozenStatus.checkFrozenStatus()||t(),this.undoredoStack.undo();var r=this.parent.spreadsheet.sheetManager.getSheetBySheetId(e);r&&L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_INFO,[e,r.getRowCount(),r.getColCount()]),t()},t.applyRedo=function(e,t){L.ZP.jank.log({moduleValue:"applyMutation",actionValue:"redo"}),this.parent.sheetStatus.frozenStatus.checkFrozenStatus()||t(),this.undoredoStack.redo();var r=this.parent.spreadsheet.sheetManager.getSheetBySheetId(e);r&&L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_INFO,[e,r.getRowCount(),r.getColCount()]),t()},t.applyCollabMutations=function(e,t,a,s){var n,o,i;try{var d=-1;t.length>0&&t[0]&&t[0].length>0&&t[0][0]&&(d=t[0][0].r),L.ZP.jank.log({moduleValue:"applyMutation",actionValue:"collab_"+d});var l=null===(o=null===(n=this.parent)||void 0===n?void 0:n.feature)||void 0===o?void 0:o.relateForm;(null===l||void 0===l?void 0:l.isRelated(e.sheetId))&&l.updateFromSyncMutations(t,e.sheetId,e.changesetType),e.revert&&this.parent.messageCenterAdapter.socketAdapter.handleRevert(),this.parent.messageCenterAdapter.receiveMessageCenterAdapter.onApplyNewChanges({changeInfo:e,mutations:t}),a(t),K.ZP.spreadsheetEvent.trigger(te.W1.DATA_CHANGE,{type:"syncndoredoStack"})}catch(c){null===(i=r.g.log)||void 0===i||i.error("behavior","applyCollabMutations error",c),L.ZP.run($.CONFIG.APPLY_NEW_CHANGES_ERROR,[null===c||void 0===c?void 0:c.stack]),s()}},t.applyOfflineMutations=function(e,t){var a,s;null===(a=r.g.log)||void 0===a||a.info("applyOfflineMutations",e.mutations.length);try{(0,se.PL)(this.parent,e)}catch(n){null===(s=r.g.log)||void 0===s||s.error("behavior","applyOfflineMutations error",n)}t()},t.applyLocalRequest=function(e,t,a,s,n,o,i){var d;void 0===n&&(n=!0),L.ZP.jank.log({moduleValue:"applyMutation",actionValue:"local_"+a});var l=this.selectionParent.getSelection();if(l){var c;L.ZP.run($.CONFIG.LOAD_REQUEST,[a]);try{c=this.loadRequest(a,s,l)}catch(re){return null===(d=r.g.log)||void 0===d||d.error("behavior","applyLocalRequest error",re),L.ZP.run($.CONFIG.APPLY_BEHAVIOR_ERROR,[t,l],re),void i()}if(!this.checkRange(c))return L.ZP.run($.CONFIG.APPLY_BEHAVIOR_NOT_LOADED,[t,l]),void i();if(this.parent.sheetStatus.frozenStatus.checkFrozenStatus()){var u=c.check(this.parent.spreadsheet);if(null===u)return L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LOCAL,[t,l]),this.applyLocal(t,c,a,n,s)&&L.ZP.monitor(33686607),void o();if(u.ignore)return L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_INFO,[t,l]),void i(u);u.isWarningOnly?this.applyLocalRequestWithConfirm({type:e,sheetId:t,requestId:a,opt:s,canUndoRedo:n,resolve:o,reject:i,selection:l,request:c,checkResult:u}):this.notApplyLocalRequestWithConfirm({sheetId:t,reject:i,selection:l,checkResult:u})}else i()}},t.notApplyLocalRequestWithConfirm=function(e){var t=e.sheetId,r=e.reject,a=e.selection,s=e.checkResult;L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_IMPORTANT,[t,a],"4");var n=function(e){e.preventDefault(),e.stopPropagation()};window.addEventListener("mousedown",n),P.dialog.info({title:s.error.title,content:s.error.content,onOk:function(e){null===e||void 0===e||e.preventDefault(),window.removeEventListener("mousedown",n)},onClose:function(e){null===e||void 0===e||e.preventDefault(),window.removeEventListener("mousedown",n)}}),K.ZP.spreadsheetEvent.trigger(te.W1.DATA_CHANGE,{type:"requestcheckError"}),r(s)},t.applyLocalRequestWithConfirm=function(e){var t=this,r=e.type,a=e.sheetId,s=e.requestId,n=e.opt,o=e.canUndoRedo,i=e.resolve,d=e.reject,l=e.selection,c=e.request,u=e.checkResult;X.Z.wait(300).run((function(){P.dialog.confirm({title:u.warning.title,content:u.warning.content,cancelText:u.warning.cancelText,duiModalType:u.warning.duiModalType,onOk:function(e){if(null===e||void 0===e||e.preventDefault(),u.warning.repeat)t.applyLocalRequest(r,a,s,n,o,i,d);else{if(!t.applyLocal(a,c,s,o,n))return void L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_IMPORTANT,[a,l],"9");K.ZP.spreadsheetEvent.trigger(te.W1.DATA_CHANGE,{type:"requestcheckConfirm"}),L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_IMPORTANT,[a,l],"6"),L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_IMPORTANT_MONITOR),i()}},onCancel:function(e){null===e||void 0===e||e.preventDefault(),K.ZP.spreadsheetEvent.trigger(te.W1.DATA_CHANGE,{type:"requestcheckCancle"}),L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_IMPORTANT,[a],"7"),d()},onClose:function(){K.ZP.spreadsheetEvent.trigger(te.W1.DATA_CHANGE,{type:"requestcheckCancle"}),L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_IMPORTANT,[a],"8"),d()}})}))},t.applyLocal=function(e,t,r,a,s){var n=this,o=this.undoredoStack.createUndoRedoMutations({docType:ie.Jz[ie.$e.sheet],sheetId:e,isLocal:!0,fromMultiSheetRequest:t.isMultiSheetRequest()});if(t.predictRequestSize(this.parent.spreadsheet)>oe.k)return this.parent.event.errorCode.trigger("errorCode",{type:"front",code:re.B.REQUEST_SIZE_LIMIT,data:{message:t.requestSizeOverLimitTips()}}),L.ZP.run($.CONFIG.REQUEST_SIZE_OVER_LIMIT,[e,r]),!1;t.run(this.parent.spreadsheet,(function(e){o.add([e]),n.parent.mutationBehavior.applyMutation(e,{isLocal:!0})})),a&&this.undoredoStack.pushLocal(o);var i=this.parent.spreadsheet.sheetManager.getSheetBySheetId(e);return i&&L.ZP.run($.CONFIG.APPLY_BEHAVIOR_LEVEL_INFO,[e,i.getRowCount(),i.getColCount()]),(0,Y.oh)(this.parent,e,o.redoMutations,r,s,t.isMultiSheetRequest()),!0},t.checkRangesIsLoaded=function(e){var t,r,a,s;for(t=0,r=e.length;t<r;t++){if(a=e[t],!(s=this.parent.spreadsheet.sheetManager.getSheetBySheetId(a.sheetId)))return!1;if(a.startRowIndex<0)return!1;if(a.endRowIndex>=s.getRowCount())return!1;if(a.startColIndex<0)return!1;if(a.endColIndex>=s.getColCount())return!1}return!0},t.loadRequest=function(e,t,r){return(0,z.h)(e,t,r)},t.checkRange=function(e){var t=e.getRanges(this.parent.spreadsheet);return this.checkRangesIsLoaded(t)},e}();de([(0,ee.M4)(ue),le("design:type",Function),le("design:paramtypes",[String,String,"function"===typeof(s="undefined"!==typeof T.Z&&T.Z)?s:Object,Object,Object,"function"===typeof(n="undefined"!==typeof Function&&Function)?n:Object,"function"===typeof(o="undefined"!==typeof Function&&Function)?o:Object]),le("design:returntype",void 0)],ue.prototype,"applyLocalRequest",null),de([(0,ee.M4)(ue),le("design:type",Function),le("design:paramtypes",[String,"function"===typeof(i="undefined"!==typeof J.Z&&J.Z)?i:Object,"function"===typeof(d="undefined"!==typeof T.Z&&T.Z)?d:Object,Boolean,Object]),le("design:returntype",Boolean)],ue.prototype,"applyLocal",null),de([(0,ee.M4)(ue),le("design:type",Function),le("design:paramtypes",["function"===typeof(l="undefined"!==typeof T.Z&&T.Z)?l:Object,Object,"function"===typeof(c="undefined"!==typeof W.Z&&W.Z)?c:Object]),le("design:returntype","function"===typeof(u="undefined"!==typeof J.Z&&J.Z)?u:Object)],ue.prototype,"loadRequest",null);var pe=ue=de([ce(0,Z.m),ce(1,ae.vT),ce(2,ne.w),le("design:paramtypes",["function"===typeof(p="undefined"!==typeof Z.m&&Z.m)?p:Object,"function"===typeof(h="undefined"!==typeof ae.vT&&ae.vT)?h:Object,"function"===typeof(I="undefined"!==typeof a.SelectionFactoryInterface&&a.SelectionFactoryInterface)?I:Object])],ue),he=r("../spread-sheet/src/flow/common/initialization.ts"),Ie=r("../packages/model/src/embedded/index.ts"),Ee=r("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/table/body/cell-renders/impl/image-cell-render.ts"),fe=r("../spread-sheet/src/core/behavior/request/embedded/utils.ts"),ve=r("../packages/model/src/cell/LinkIconType.ts"),Te=r("../spread-sheet/src/core/view/level-2/cell-editors/editors/util.ts"),_e=r("../spread-sheet/src/core/view/config/default.ts"),me=r("../spread-sheet/src/core/feature/copyPaste/lib/parsers/automaticIdentifyLink.ts"),ge=r("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),Se=(r("../spread-sheet/src/base/util/domain-config.ts"),r("../spread-sheet/src/core/view/spreadsheet-view/table-view/utils.ts")),ye=r("../spread-sheet/src/core/view/level-2/todo-ent/utils.ts"),Re=r("../spread-sheet/src/core/feature/dataValidation/api/DataValidationUtils.ts"),Ae=r("../packages/model/src/rule/index.ts"),Oe=r("../spread-sheet/src/core/utils/index.ts");function Ne(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"===typeof e)return De(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?De(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function De(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var we,Ce,be=function(e,t,r,a){var s,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,r,a);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o},Ze=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Le=function(e,t){return function(r,a){t(r,a,e)}},Pe=function(e,t,r,a){return new(r||(r=Promise))((function(s,n){function o(e){try{d(a.next(e))}catch(t){n(t)}}function i(e){try{d(a.throw(e))}catch(t){n(t)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}d((a=a.apply(e,t||[])).next())}))};(0,he.Ch)(B,pe);var Me={cache:null,copyPasteCache:null,aSetSlot:0|1<<A.Z.SLOT_USER_ENTERED_FORMAT_DELTA},Ue=function(){function e(e,t){this.app=e,this.behavior=t}var t=e.prototype;return t.undo=function(){return this.behavior.apply({type:"undo",sheetId:this.app.spreadsheet.activeSheetId,requestId:-1})},t.redo=function(){return this.behavior.apply({type:"redo",sheetId:this.app.spreadsheet.activeSheetId,requestId:-1})},t.applyCollab=function(e){return this.behavior.apply(Object.assign({type:"collab"},e))},t.applyOffline=function(e){return this.behavior.apply(Object.assign({type:"offline"},e))},t.mergeCells=function(e){if((0,ye.TQ)(this.app))return Promise.resolve();var t=this.app.view.canvas,r=this.app.spreadsheet.activeSheetId;function a(e,r,a){for(var s=[],n=r;n<=a;n++){var o=t.rowcolAccessor.getRowDisplayHeight(n),i=t.rowcolAccessor.getRowSetHeight(n);(null===i||void 0===i)&&o>C.DEFAULT_ROW_HEIGHT&&s.push({dimensionRange:new m.Z(e,n,n,_.Z.ROWS),size:o})}return s}var s=[];if(null===e||void 0===e?void 0:e.length)s=e.map((function(e){return a(e.sheetId,e.startRowIndex,e.endRowIndex)})).reduce((function(e,t){return e.concat(t)}));else{var n=this.app.view.getSelection().rangeSelections[0];s=a(r,n.startRowIndex,n.endRowIndex)}var o=[],i=Oe.Z.selection,d=i.rangeHasMergeCell,l=i.hasMergeCell,c=e&&d(this.app,e[0]),u=!e&&l(this.app);return(c||u)&&o.push({requestId:T.Z.UNMERGE_CELLS_REQUEST,opt:{sheetId:r,gridRanges:e}}),o.push({requestId:T.Z.MERGE_CELLS_REQUEST,opt:{sheetId:r,gridRanges:e}}),s.length&&o.push({requestId:T.Z.SET_DIMENSION_SIZE_REQUEST,opt:{sheetId:r,dimensionModifiers:s}}),this.behavior.apply({type:"local",sheetId:r,requestId:T.Z.MULTI_REQUEST,opt:{sheetId:r,gridRanges:e,requests:o}})},t.setHyperlinkIconVisibility=function(e){var t=e.row,r=e.col,a=e.visibility,s=this.app.spreadsheet.activeSheet.getCellDataAtPosition(t,r),n=null===s||void 0===s?void 0:s.getHyperlink(),o=null===s||void 0===s?void 0:s.getEditValue(),i=null===s||void 0===s?void 0:s.getHyperlinkRuns(),d=null===s||void 0===s?void 0:s.getHyperlinkType();if(!n&&!i)throw new Error("超链接地址为空，无法修改链接icon状态");if(!o)throw new Error("超链接名称为空，无法修改链接icon状态");return n?(L.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_link",action:"excel_link_set",ver10:"cell",ver11:"set",ver12:a?"word_type":"icon_type"}),this.setDoclinkIconVisibility(t,r,a,o,n,d)):this.setHyperLinkRunsVisibility(t,r,a,o,i)},t.setDoclinkIconVisibility=function(e,t,r,a,s,n){var o={type:"local",sheetId:this.app.spreadsheet.getActiveSheetId(),requestId:T.Z.SET_LINK_REQUEST,opt:{rowIndex:e,colIndex:t,userEnterValue:a,linkUrl:s,linkIconStatus:ve.Z.PLAIN_TEXT,hyperlinkType:n}};return r&&(o.opt.linkIconStatus=ve.Z.WITH_IMAGE),this.behavior.apply(o)},t.setHyperLinkRunsVisibility=function(e,t,r,a,s){var n=this.app.spreadsheet.getActiveSheetId();return this.behavior.apply({type:"local",sheetId:n,requestId:T.Z.SET_HYPERLINK_RUNS_REQUEST,opt:{rowIndex:e,colIndex:t,userEnterValue:a,isChanged:!0,linkUrl:null,textFormatRuns:[],isTextFormatRunsChanged:!0,hyperlinkRuns:s,linkIconStatus:r?ve.Z.WITH_IMAGE:ve.Z.PLAIN_TEXT}})},t.setHyperlinkRuns=function(e){var t=e.row,r=e.col,a=e.linkValue,s=e.range,n=e.linkIconStatus,o=e.linkUrl;if(!s&&!o)throw new Error("Must pass range or linkUrl.");if(s&&o)throw new Error("Dont pass range and linkUrl together.");var i=this.app.spreadsheet.getActiveSheetId(),d=v.kk.getRandomId(),l=s?{workbookRangeId:d,range:s}:null,c={rowIndex:t,colIndex:r,userEnterValue:a,textFormatRuns:null,isTextFormatRunsChanged:!0,isChanged:!0,hyperlinkRuns:[{startIndex:0,linkUrl:o||"#rangeid="+d}],linkIconStatus:n},u=[].concat((0,E.Z)(l?[{requestId:T.Z.ADD_LINKED_RANGE_REQUEST,opt:l}]:[]),[{requestId:T.Z.SET_HYPERLINK_RUNS_REQUEST,opt:c}]);return L.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_link",action:"excel_link_set",ver10:"cell",ver11:"set",ver12:-1===n?"word_type":"icon_type"}),this.behavior.apply({type:"local",sheetId:i,requestId:T.Z.MULTI_REQUEST,opt:{sheetId:i,requests:u}})},t.unmergeCells=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.UNMERGE_CELLS_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,gridRanges:e}})},t.insertRows=function(e){var t=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.INSERT_DIMENSION_REQUEST,opt:{type:_.Z.ROWS,sheet:this.app.spreadsheet.activeSheet,insertInfo:e,filterViewId:t}})},t.insertColumns=function(e){var t=this,r=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId(),a=this.app.spreadsheet,s=a.activeSheet,n=a.activeSheetId;return(e||[]).find((function(e){return(0,ye.cV)(t.app,"insert",e.index)}))?Promise.resolve():this.behavior.apply({type:"local",sheetId:n,requestId:T.Z.INSERT_DIMENSION_REQUEST,opt:{type:_.Z.COLUMNS,sheet:s,insertInfo:e,filterViewId:r}})},t.hideRows=function(e){var t=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_DIMENSION_HIDE_REQUEST,opt:{type:_.Z.ROWS,sheetId:this.app.spreadsheet.activeSheetId,dimensionRanges:e,filterViewId:t}})},t.hideColumns=function(e){var t=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_DIMENSION_HIDE_REQUEST,opt:{type:_.Z.COLUMNS,sheetId:this.app.spreadsheet.activeSheetId,dimensionRanges:e,filterViewId:t}})},t.showRows=function(e){var t=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_DIMENSION_SHOW_REQUEST,opt:{type:_.Z.ROWS,sheetId:this.app.spreadsheet.activeSheetId,dimensionRanges:e,filterViewId:t}})},t.showColumns=function(e){var t=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_DIMENSION_SHOW_REQUEST,opt:{type:_.Z.COLUMNS,sheetId:this.app.spreadsheet.activeSheetId,dimensionRanges:e,filterViewId:t}})},t.deleteRows=function(){var e=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.DELETE_DIMENSION_REQUEST,opt:{type:_.Z.ROWS,sheet:this.app.spreadsheet.activeSheet,filterViewId:e}})},t.deleteColumns=function(){for(var e=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId(),t=this.app.spreadsheet,r=t.activeSheet,a=t.activeSheetId,s=this.app.view.getSelection().getCols(),n=!1,o=0;o<s.length;o++)if((0,ye.cV)(this.app,"delete",s[o])){n=!0;break}return n?Promise.resolve():this.behavior.apply({type:"local",sheetId:a,requestId:T.Z.DELETE_DIMENSION_REQUEST,opt:{type:_.Z.COLUMNS,filterViewId:e,sheet:r}})},t.resizeRows=function(e,t){var r=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId(),a=e.map((function(e,r){var a=function(e){if(t instanceof Array){var r=Math.min(e,t.length-1);return t[r]}return t}(r);return{dimensionRange:e,size:a}}));return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_DIMENSION_SIZE_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,dimensionModifiers:a,filterViewId:r}})},t.resizeColumns=function(e,t){var r=this,a=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId(),s=e.map((function(e,r){var a=function(e){if("number"===typeof t)return t;if(t instanceof Array&&t.length>0){var r=Math.min(e,t.length-1);return t[r]}return C.DEFAULT_COL_WIDTH}(r);return{dimensionRange:e,size:a}}));return t instanceof Array&&(s=s.filter((function(e){var t=e.dimensionRange.startIndex;return t!==e.dimensionRange.endIndex||e.size!==r.app.view.canvas.rowcolAccessor.getColSetWidth(t)}))),s&&s.length?this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_DIMENSION_SIZE_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,dimensionModifiers:s,filterViewId:a}}):Promise.resolve()},t.resizeRowsColumns=function(e){var t=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return e&&e.length?this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_DIMENSION_SIZE_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,dimensionModifiers:e,filterViewId:t}}):Promise.resolve()},t.moveRows=function(e,t){var r=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.MOVE_DIMENSION_REQUEST,opt:{type:_.Z.ROWS,sheetId:this.app.spreadsheet.activeSheetId,to:t,from:e,filterViewId:r}})},t.moveColumns=function(e,t){var r=this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.MOVE_DIMENSION_REQUEST,opt:{type:_.Z.COLUMNS,sheetId:this.app.spreadsheet.activeSheetId,to:t,from:e,filterViewId:r}})},t.setRowFormData=function(e,t){var r=this.app.spreadsheet.activeSheetId;return this.behavior.apply({type:"local",sheetId:r,requestId:T.Z.SET_DIMENSION_FORMDATA_REQUEST,opt:{type:_.Z.ROWS,sheetId:r,dimensionRanges:e,formDatas:t}})},t.setColFormData=function(e,t){var r=this.app.spreadsheet.activeSheetId;return this.behavior.apply({type:"local",sheetId:r,requestId:T.Z.SET_DIMENSION_FORMDATA_REQUEST,opt:{type:_.Z.COLUMNS,sheetId:r,dimensionRanges:e,formDatas:t}})},t.reorder=function(e,t,r){return(0,ye.TQ)(this.app)?Promise.resolve():this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.REORDER_RANGE_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,hasTitle:t,reorderInfos:e,gridRange:r,sheetStatus:this.app.sheetStatus}})},t.freeze=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.FREEZE_REQUEST,opt:Object.assign({sheetId:this.app.spreadsheet.activeSheetId,filterViewId:this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId()},e)})},t.userEnter=function(e){var t,r;return Pe(this,void 0,void 0,regeneratorRuntime.mark((function a(){var s,n,o,i,d,l,c,u,p,h,I,E,f,v,_,m,g,S,y,R,A,D,w,C,Z,P,M,j,k,x=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=e.colIndex,n=e.rowIndex,o=e.isChanged,i=void 0===o?void 0===e.isTextChanged||e.isTextChanged:o,d=e.isTextFormatRunsChanged,l=void 0===d||d,c=e.textFormatRuns,u=void 0===c?null:c,p=e.mentionDetailsMap,h=e.sheetId,I=void 0===h?this.app.spreadsheet.getActiveSheetId():h,E=e.isFromQuickFill,f=e.ignoreLinkUrl,v=e.text,_=void 0,m=void 0,(0,U.MN)(s)&&(0,U.MN)(n)){a.next=7;break}return L.ZP.monitor(33651147),a.abrupt("return",Promise.reject());case 7:if(g=this.app.spreadsheet.sheetManager.getSheetBySheetId(I),S=null===g||void 0===g?void 0:g.getCellDataAtPosition(n,s),(y=null===(t=null===S||void 0===S?void 0:S.getUserEnteredFormat())||void 0===t?void 0:t.getNumberFormat())&&(0,b.isTextCell)(y)||!(0,O.jr)(v)){a.next=16;break}if(R=[].slice.call(this.app.spreadsheet.sheetManager.sheetList,0).map((function(e){return e.getTitle()})),v=(0,N.wh)(v,R),!(A=null===S||void 0===S?void 0:S.getFormula())||A.toString(n,s,this.app.spreadsheet.sheetManager)!==v){a.next=16;break}return a.abrupt("return",Promise.resolve());case 16:if((D=null===(r=null===S||void 0===S?void 0:S.getMetadata())||void 0===r?void 0:r.customDataType)&&((0,Te.Nn)(D,E),w=/^[-+]?[\d\\.]+$/.test(v),D===q.ZP.PROGRESS&&w&&(v+="%"),D===q.ZP.TEMPERATURE&&(v=v.replace(/℃$/,""))),!i){a.next=33;break}if(!(C=(0,me.fN)(v)).hyperlink||!C.hyperlinkType){a.next=33;break}return a.next=23,(0,me.en)({url:v,sheetList:this.app.spreadsheet.sheetManager.getDisplayedSheetList().map((function(e){return{name:e.getTitle(),id:e.getSheetId()}})),getLinkedWorkbookRangeById:function(e){return x.app.spreadsheet.workbookRangeManager.getLinkedWorkbookRangeById(e)}});case 23:if(Z=a.sent,P=Z.hyperlinkRuns,M=Z.value,j=Z.hyperlink,k=Z.hyperlinkType,!(null===P||void 0===P?void 0:P.length)){a.next=30;break}return a.abrupt("return",this.setHyperlinkRuns({row:n,col:s,linkValue:M,linkUrl:P[0].linkUrl}));case 30:k&&(_=k),M&&(v=M),j&&(m=j);case 33:return a.abrupt("return",this.behavior.apply({type:"local",sheetId:I,requestId:T.Z.SET_SINGLE_VALUE_REQUEST,opt:{rowIndex:n,colIndex:s,userEnterValue:v,ignoreLinkUrl:f,isChanged:i,textFormatRuns:u,isTextFormatRunsChanged:l,sheetId:I,mentionDetailsMap:p,hyperlinkType:_,linkUrl:m}}));case 34:case"end":return a.stop()}}),a,this)})))},t.userEnterToSheetId=function(e,t,r,a){return this.userEnter({text:e,colIndex:r,rowIndex:t,isChanged:!0,sheetId:a})},t.userRangeEnter=function(e){var t=this.app.spreadsheet.activeSheetId;return this.app.toggle&&(t=this.app.toggle.from),this.behavior.apply({type:"local",sheetId:t,requestId:T.Z.SET_RANGE_VALUE_REQUEST,opt:{data:e,sheetId:t}})},t.addImage=function(e,t){void 0===t&&(t=!1);var r=e.id,a=e.url,s=e.width,n=e.height,o=e.sheetId,i=e.x,d=e.y,l={type:t?Ie.EMBEDDED_OBJECT_TYPE.CELL_IMAGE:Ie.EMBEDDED_OBJECT_TYPE.IMAGE,id:r,url:a,width:s,height:n,sheetId:o,x:i,y:d,offsetX:0,offsetY:0,clipInfo:e.clipInfo},c=[{requestId:T.Z.ADD_IMAGE_REQUEST,opt:l}];if(t){var u=(0,fe.P)(this.app.spreadsheet.sheetManager.getSheetBySheetId(o),d);if(u){var p={sheetId:o,dimensionModifiers:[u],filterViewId:this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId()};c.push({requestId:T.Z.SET_DIMENSION_SIZE_REQUEST,opt:p})}}var h={requests:c};return this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.MULTI_REQUEST,opt:h})},t.updateImage=function(e){return this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.UPDATE_IMAGE_REQUEST,opt:e})},t.convertImageType=function(e,t){var r=this.app.spreadsheet.activeSheet,a=r.getSheetId(),s=[];if(t===Ie.EMBEDDED_OBJECT_TYPE.IMAGE){var n=this.app.view.getSelection().rangeSelections,o=this.app.sheetStatus;n.forEach((function(e){e.each((function(e,n){var i=r.getCellImage(e,n),d=(0,Ee.f_)(r,e,n);if(i&&d&&o.isRangeCanEditByHighWater(new S.Z(a,e,e,n,n))&&o.getRangeCanEdit(new S.Z(a,e,e,n,n))){var l=d.clipInfo,c=d.overlayPosition,u={x:n,y:e,offsetX:c.offsetXpixels,offsetY:c.offsetYpixels,clipInfo:l,width:c.widthPixels,height:c.heightPixels},p=i.toObject();Object.assign(p,u),p.type=t,p.changeType=!0,s.push(p)}}))}))}else(Array.isArray(e)?e:[e]).forEach((function(e){var a=r.imageManager.getImage(e);if(a){var n=a.toObject();n.type=t,n.changeType=!0,s.push(n)}}));return L.ZP.kvrOss({itemname:"n_excel_convert_pic",Channel1:t===Ie.EMBEDDED_OBJECT_TYPE.IMAGE?"float":"inline",biz:"personal"}),this.behavior.apply({type:"local",sheetId:a,requestId:T.Z.UPDATE_IMAGE_REQUEST,opt:s})},t.deleteImage=function(e){var t=this.app.spreadsheet.getActiveSheetId();return Array.isArray(e)&&e.length>0&&e[0]&&e[0].sheetId?t=e[0].sheetId:!Array.isArray(e)&&e&&e.sheetId&&(t=e.sheetId),this.behavior.apply({type:"local",sheetId:t,requestId:T.Z.DELETE_IMAGE_REQUEST,opt:e})},t.insertLink=function(){var e=this,t=this.app.view.canvas.normalSelectData.activeCol,r=this.app.view.canvas.normalSelectData.activeRow;if(isNaN(t)||isNaN(r))throw new Error("没有定位到单元格");return new Promise((function(a){a(null),e.app.view.canvas.linkCenter.addLink(r,t)}))},t.addLinkedRange=function(e){return Pe(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.app.spreadsheet.workbookRangeManager.generateWorkbookRangeId(),a={workbookRangeId:r,range:e},t.next=4,this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.ADD_LINKED_RANGE_REQUEST,opt:a});case 4:return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},t.setAttachment=function(e,t,r,a,s){return this.setHyperLink(e,t,r,a,s,y.Z.CENTER,ve.Z.WITH_IMAGE)},t.fontBold=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.BOLD,formatValue:e}})},t.autoWrap=function(e,t){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.WRAP_STRATEGY,formatValue:e,gridRange:t||null}})},t.fontItalics=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.ITALIC,formatValue:e}})},t.fontUnderLine=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.UNDERLINE,formatValue:e}})},t.fontStrike=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.STRIKE_THROUGH,formatValue:e}})},t.setFontFamliy=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.FONT_FAMINY,formatValue:e}})},t.setFontFamily=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.FONT_FAMINY,formatValue:e}})},t.setWrapStrategy=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.getActiveSheetId(),requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.WRAP_STRATEGY,formatValue:e}})},t.setFontSize=function(e){var t=e;return t<=0&&(t=_e.n5),this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.FONT_SIZE,formatValue:t}})},t.setFontColor=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.COLOR,formatValue:e}})},t.setBorder=function(e,t,r){var a={};switch(t){case"all":a[M.Z.TOP]=!0,a[M.Z.LEFT]=!0,a[M.Z.RIGHT]=!0,a[M.Z.BOTTOM]=!0,a[M.Z.MIDDLE]=!0,a[M.Z.CENTER]=!0;break;case"top":a[M.Z.TOP]=!0;break;case"left":a[M.Z.LEFT]=!0;break;case"bottom":a[M.Z.BOTTOM]=!0;break;case"right":a[M.Z.RIGHT]=!0;break;case"outer":a[M.Z.TOP]=!0,a[M.Z.RIGHT]=!0,a[M.Z.BOTTOM]=!0,a[M.Z.LEFT]=!0;break;case"inner":a[M.Z.MIDDLE]=!0,a[M.Z.CENTER]=!0;break;case"diagUp":a[M.Z.DIAG_UP]=!0;break;case"diagDown":a[M.Z.DIAG_DOWN]=!0;break;case"vertical":a[M.Z.LEFT]=!0,a[M.Z.CENTER]=!0,a[M.Z.RIGHT]=!0;break;case"horizontal":a[M.Z.TOP]=!0,a[M.Z.MIDDLE]=!0,a[M.Z.BOTTOM]=!0;break;case"clear":case"none":e.color=null,e.style=null,a[M.Z.TOP]=!0,a[M.Z.RIGHT]=!0,a[M.Z.BOTTOM]=!0,a[M.Z.LEFT]=!0,a[M.Z.MIDDLE]=!0,a[M.Z.CENTER]=!0,a[M.Z.DIAG_DOWN]=!0,a[M.Z.DIAG_UP]=!0;break;case"custom":r&&Object.keys(r.group).forEach((function(e){a[e]=r.group[e]}))}return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_BORDERS_REQUEST,opt:{type:a,props:e}})},t.setHideGridlines=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_HIDE_GRIDLINES_REQUEST,opt:{hideGridlines:e,sheetId:this.app.spreadsheet.activeSheetId}})},t.setBackgroundColor=function(e){var t=this.app.view.getSelection().rangeSelections,r=(0,U.IA)(this.app.spreadsheet.activeSheet,j.CELL_FORMAT_SLOT.BACKGROUND_COLOR,t);return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.BACKGROUND_COLOR,formatValue:e}}).then((function(){r&&V().isPC&&(0,k.showToast)(f.ZP.t("当前单元格含有条件格式，将会覆盖填充颜色。"))}))},t.setVerticalAlign=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.VERTICAL_ALIGN,formatValue:e}})},t.setHorizontalAlign=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_FORMAT_REQUEST,opt:{formatItem:g.Z.HORIZONTAL_ALIGN,formatValue:e}})},t.clearFormat=function(e){return void 0===e&&(e={}),(0,ye.TQ)(this.app)?Promise.resolve():this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.CLEAR_FORMAT_REQUEST,opt:e})},t.clearContent=function(e){var t=this;void 0===e&&(e={});var r=(0,ye.Lj)(this.app),a=r.isTodoMasterCell;return r.isRelatedTodoBindCell?Promise.resolve():(setTimeout((function(){var e;null===(e=t.app.view.canvas.cellImageViewer)||void 0===e||e.updateCursor()}),0),this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.CLEAR_RANGE_REQUEST,opt:e,canUndoRedo:!a}))},t.setLink=function(e,t,r,a){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_LINK_REQUEST,opt:{rowIndex:r,colIndex:a,userEnterValue:e,linkUrl:t}})},t.setHyperLink=function(e,t,r,a,s,n,o,i){var d=i||this.app.spreadsheet.activeSheetId,l="web";r===j.HYPERLINK_TYPE.SHEET_LINK&&(l="sheet"),L.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_link",action:"excel_link_set",ver10:l,ver11:"set",ver12:-1===o?"word_type":"icon_type"});var c=n?{formatItem:g.Z.HORIZONTAL_ALIGN,formatValue:n}:{};return this.behavior.apply({type:"local",sheetId:d,requestId:T.Z.SET_LINK_REQUEST,opt:Object.assign({rowIndex:a,colIndex:s,userEnterValue:e,linkUrl:t,hyperlinkType:r,linkIconStatus:o,sheetId:d},c)})},t.clearLink=function(e,t){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.CLEAR_LINK_REQUEST,opt:{rowIndex:e,colIndex:t}})},t.formatPainterSetCache=function(e,t){var r=e.startRowIndex,a=e.endRowIndex,s=e.startColIndex,n=e.endColIndex;return Me.copyPasteCache=new t.feature.CopyPasteCache({spreadsheetApp:t,config:{setSlots:Me.aSetSlot,tile:!1,isFormatPainter:!0}}),Me.copyPasteCache.onCopy({from:(0,R.convertGridRangeToXYRange)(e),copyType:t.feature.copyPasteBase.CopyType.copy,hotInstance:t}),Me.cache=new S.Z(this.app.spreadsheet.getActiveSheetId(),r,a,s,n)},t.formatPainterApply=function(){if(Me.cache&&Me.copyPasteCache){var e=Me.copyPasteCache.spreadsheetApp,t=Me.copyPasteCache.getCacheData();t.cellMask=Me.aSetSlot;var r=(0,R.convertGridRangeToXYRange)(e.view.getSelection().rangeSelections[0]);Me.copyPasteCache.onPaste({to:r,hotInstance:e,pasteData:t})}},t.formatPainterClear=function(){Me.cache=null},t.numberFormat=function(e){var t,a=this.app.view.getSelection().rangeSelections,s=void 0===a?[]:a;if(s.length>0){var n=s.map((function(e){return e.serialize()}));null===(t=r.g.log)||void 0===t||t.info("behavior::number_format",e,n)}return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_NUMBER_FORMAT_REQUEST,opt:"string"===typeof e?{pattern:e}:e})},t.decreaceDecimal=function(){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.ADJUST_DECIMALS_REQUEST,opt:{decimalsDelta:-1}})},t.increaceDecimal=function(){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.ADJUST_DECIMALS_REQUEST,opt:{decimalsDelta:1}})},t.replace=function(e){var t,r=e.map((function(e){return e.celldata=e.celldata.map((function(e){return(0,O.jr)(e.value)?Object.assign(Object.assign({},e),{value:(0,N.wh)(e.value,[])}):e})),e})),a=this.app.spreadsheet.activeSheetId;return(null===(t=null===r||void 0===r?void 0:r[0])||void 0===t?void 0:t.sheetId)&&(a=r[0].sheetId),this.behavior.apply({type:"local",sheetId:a,requestId:T.Z.REPLACE_ALL_REQUEST,opt:r})},t.smartSelection=function(e){var t=e.changes,r=e.mergeCells,a=e.range,s=e.originCell,n=e.unMergeCells,o=!1;if(s)for(var i,d=Ne(s);!(i=d()).done;){var l=i.value;if((0,Se.Tk)(this.app.spreadsheet.activeSheet,l[1],l[0])){o=!0;break}}return o&&L.ZP.kvrOss({itemname:"xls_dropdown_draw"}),this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.AUTO_FILL_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,changes:t,mergeCells:r,range:a,originCell:s,unMergeCells:n}})},t.setBasicFilter=function(){return(0,ye.TQ)(this.app)?Promise.resolve():this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SET_BASIC_FILTER_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,filterViewId:this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId()}})},t.clearBasicFilter=function(){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.CLEAR_BASIC_FILTER_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,filterViewId:this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId()}})},t.updateFilterCriteria=function(e){return this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.UPDATE_FILTER_CRITERIA_REQUEST,opt:e})},t.switchFilterSync=function(e){return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.SWITCH_FILTER_SYNC_REQUEST,opt:e})},t.applyPasteData=function(e){return(0,ye.TQ)(this.app)?Promise.resolve():this.app&&this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.PASTE_DATA_REQUEST,opt:e})},t.reorderWithFilter=function(e){return this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.REORDER_FILTER_REQUEST,opt:e})},t.insideSheetCopyPaste=function(e){return this.app&&this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.PASTE_DATA_REQUEST,opt:e})},t.defineFormRange=function(){var e=this.app.view.canvas.normalSelectData.activeCol,t=this.app.view.canvas.normalSelectData.activeRow;if(isNaN(e)||isNaN(t))throw new Error("没有定位到单元格");var r=this.app.spreadsheet.activeSheet.getCellDataAtPosition(t,e);if(r||(r=new D.Z),!r.getSheetRangeReferences()){var a=v.kk.getRandomId();return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.DEFINE_COMMENT_RANGE_REQUEST,opt:{id:a},canUndoRedo:!1})}},t.insertImage=function(e){if(void 0===e&&(e={}),!this.app.view.canvas.shapeUpload)throw new Error("上传模块尚未准备好");var t=this.app.view.canvas.normalSelectData.activeRow,r=this.app.view.canvas.normalSelectData.activeCol;if(isNaN(t)||isNaN(r)||t<0||r<0)throw new Error("没有定位到单元格");var a=this.app.spreadsheet.activeSheetId;this.app.view.canvas.shapeUpload.insertShape(a,t,r,e)},t.defineCommentRange=function(e,t){var r=t?t.row:this.app.view.canvas.normalSelectData.activeRow,a=t?t.col:this.app.view.canvas.normalSelectData.activeCol;if(isNaN(r)||isNaN(a)||r<0||a<0)throw new Error("没有定位到单元格");if(!e)throw new Error("没有输入 sheetRangeId");var s=(null===t||void 0===t?void 0:t.sheetId)?this.app.spreadsheet.sheetManager.getSheetBySheetId(t.sheetId):this.app.spreadsheet.activeSheet,n=s.getCellDataAtPosition(r,a);n||(n=new D.Z);for(var o,i=n.getSheetRangeReferences()||[],d=0;o=i[d];d++)if(o.type===w.Z.COMMENT_RANGE)return;return this.behavior.apply({type:"local",sheetId:s.getSheetId(),requestId:T.Z.DEFINE_COMMENT_RANGE_REQUEST,opt:{sheetId:s.getSheetId(),sheetRangeId:e,sheetRangeType:w.Z.COMMENT_RANGE,pos:t},canUndoRedo:!1})},t.updateCommentRange=function(e,t){if(!e)throw new Error("没有输入 sheetRangeId");var r=this.app.spreadsheet.activeSheet.sheetRangeManager.getSheetRange(e);if(!r)throw new Error("非法的 sheetRangeId");if(r.sheetRangeType!==w.Z.COMMENT_RANGE)throw new Error("sheetRangeId="+e+"对应的类型不正确。");return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.UPDATE_COMMENT_RANGE_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,sheetRangeId:e,sheetRangeType:w.Z.COMMENT_RANGE,isArchived:t,gridRange:r.gridRange},canUndoRedo:!1})},t.deleteCommentRange=function(e,t){if(e)return this.behavior.apply({type:"local",sheetId:t||this.app.spreadsheet.activeSheetId,requestId:T.Z.DELETE_COMMENT_RANGE_REQUEST,opt:{sheetId:t||this.app.spreadsheet.activeSheetId,sheetRangeId:e},canUndoRedo:!1});var r=this.app.view.canvas.normalSelectData.activeCol,a=this.app.view.canvas.normalSelectData.activeRow;if(isNaN(r)||isNaN(a))throw new Error("没有定位到单元格");var s=this.app.spreadsheet.activeSheet.getCellDataAtPosition(a,r);if(s)for(var n,o=s.getSheetRangeReferences()||[],i=0;n=o[i];i++)if(n.type===w.Z.COMMENT_RANGE)return this.behavior.apply({type:"local",sheetId:this.app.spreadsheet.activeSheetId,requestId:T.Z.DELETE_COMMENT_RANGE_REQUEST,opt:{sheetId:this.app.spreadsheet.activeSheetId,sheetRangeId:n.id},canUndoRedo:!1})},t.dataValidation=function(e){var t,r=this,a=this.app.feature.dataValidation.getDataValidationConfig(e,this.app.spreadsheet);if(null===a)return null;L.ZP.tdwReport({opername:"doc_edit",module:"excel",action:"data_validation",obj3:a.ruleType});var s=(null===(t=e.selection)||void 0===t?void 0:t.sheetId)||this.app.spreadsheet.getActiveSheetId(),n=null;e.selection&&((n=e.selection.clone()).sheetId=n.sheetId||s);var o=n&&[n]||this.app.view.getSelection().rangeSelections,i=[{requestId:T.Z.SET_DATA_VALIDATION_REQUEST,opt:{dataValidation:a,gridRanges:o}}];return this.behavior.apply({type:"local",requestId:T.Z.MULTI_REQUEST,sheetId:s,opt:{requests:i}}).then((function(e){var t;return null===(t=r.app.view.canvas.cellEditorManager)||void 0===t||t.updateActiveCellEditor(),e}))},t.clearDataValidation=function(e){var t=[{requestId:T.Z.SET_METADATA,opt:{metadata:null,ranges:[e]}},{requestId:T.Z.SET_DATA_VALIDATION_REQUEST,opt:{dataValidation:null,gridRanges:[e]}}];return this.behavior.apply({type:"local",requestId:T.Z.MULTI_REQUEST,sheetId:this.app.spreadsheet.getActiveSheetId(),opt:{requests:t}})},t.doPaste=function(e){if((0,ye.TQ)(this.app))return Promise.resolve();this.app.feature.copyPasteBase.apiDoPaste(e)},t.insertRowWithLogic=function(e,t){void 0===t&&(t=!1);var r,a=this.app.spreadsheet.activeSheet.getRowCount(),s=this.app.spreadsheet.activeSheet.getColCount(),n=this.app.view.getSelection().rangeSelections[0],o=n.startRowIndex,i=n.endRowIndex,d=this.app.view.canvas.normalSelectData.selectQueue[0].selectRow,l=this.app.spreadsheet.activeSheet.data.rowMetadata,c=0;for(r=o;r<o+e;r++)if(void 0===l[r]||null===l[r])c+=1;else{if(l[r]&&(l[r].hiddenByFilter||l[r].hiddenByUser))continue;c+=1}(a+c)*s<C.MAX_CELL_COUNT?t?this.insertRows([{index:o+c,amount:c}]):this.insertRows([{index:o,amount:c}]):P.dialog.confirm({title:f.ZP.t("插入行列失败"),content:f.ZP.t("已达最大行列限制，建议删除无用行列或新建一个工作表。")});try{if(d&&i-o===0){var u=c>1?"more":"one";L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"insert_"+u+"_row"})}else d&&i-o>0?L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"select_insert_more_row"}):L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"select_cell_insert_row"});e!==i-o+1&&L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"type_insert_col"})}catch(p){}},t.insertColWithLogic=function(e,t){void 0===t&&(t=!1);var r,a=this.app.spreadsheet.activeSheet.getRowCount(),s=this.app.spreadsheet.activeSheet.getColCount(),n=this.app.view.getSelection().rangeSelections[0],o=n.startColIndex,i=n.endColIndex,d=this.app.view.canvas.normalSelectData.selectQueue[0].selectCol,l=this.app.spreadsheet.activeSheet.data.colMetadata,c=0;for(r=o;r<o+e;r++)if(void 0===l[r]||null===l[r])c+=1;else{if(l[r]&&(l[r].hiddenByFilter||l[r].hiddenByUser))continue;c+=1}a*(s+c)<C.MAX_CELL_COUNT?t?this.insertColumns([{index:o+c,amount:c}]):this.insertColumns([{index:o,amount:c}]):P.dialog.confirm({title:f.ZP.t("插入行列失败"),content:f.ZP.t("已达最大行列限制，建议删除无用行列或新建一个工作表。")});try{if(d&&i-o===0){var u=c>1?"more":"one";L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"insert_"+u+"_col"})}else d&&i-o>0?L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"select_insert_more_col"}):L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"select_cell_insert_col"});e!==i-o+1&&L.ZP.tdwReport({module:"excel_menu",opername:"doc_excel_editor",action:"type_insert_row"})}catch(p){}},t.freezePreview=function(e){this.app.view.canvas.freezePreview.preview(e)},t.cancelFreezePreview=function(){this.app.view.canvas.freezePreview.cancelPreview()},t.addConditionFormat=function(e){var t=this.app.spreadsheet.activeSheetId;return this.behavior.apply({type:"local",requestId:T.Z.ADD_CONDITIONAL_FORMAT_REQUEST,sheetId:t,opt:e})},t.deleteConditionFormat=function(e){var t=this.app.spreadsheet.activeSheetId;return this.behavior.apply({type:"local",requestId:T.Z.DELETE_CONDITIONAL_FORMAT_REQUEST,sheetId:t,opt:e})},t.updateConditionFormat=function(e){var t=this.app.spreadsheet.activeSheetId;return this.behavior.apply({type:"local",requestId:T.Z.UPDATE_CONDITIONAL_FORMAT_REQUEST,sheetId:t,opt:e})},t.updateConditionFormatIndex=function(e){var t=this.app.spreadsheet.getActiveSheetId();return this.behavior.apply({type:"local",requestId:T.Z.UPDATE_CONDITIONAL_FORMAT_REQUEST_INDEX,sheetId:t,opt:e})},t.setSheet=function(e){return this.behavior.apply({type:"local",requestId:T.Z.SET_SHEETS_REQUEST,sheetId:e.sheetId,opt:e,canUndoRedo:!1})},t.addProtectionRange=function(e){return this.behavior.apply({type:"local",requestId:T.Z.ADD_PROTECTED_RANGE_REQUEST,sheetId:e.range.sheetId,opt:e})},t.updateProtectionRange=function(e){return this.behavior.apply({type:"local",requestId:T.Z.UPDATE_PROTECTED_RANGE_REQUEST,sheetId:e.range.sheetId,opt:e})},t.deleteProtectionRange=function(e){return this.behavior.apply({type:"local",requestId:T.Z.DELETE_PROTECTED_RANGE_REQUEST,sheetId:this.app.spreadsheet.activeSheetId,opt:e})},t.insertSheet=function(e){var t=e.sheetId,r=e.sheetIndex,a=e.sheetName,s=e.sheetType,n=e.isHidden;if("string"!==typeof t)throw new Error("Warning: sheetId must be a string.");if("undefined"!==typeof r&&"number"!==typeof r)throw new Error("Warning: sheetIndex must be a number.");if(a&&"string"!==typeof a)throw new Error("Warning: sheetName must be a string.");if(s&&"string"!==typeof s)throw new Error("Warning: sheetType must be a string.");if("undefined"!==typeof n&&"boolean"!==typeof n)throw new Error("Warning: isHidden must be a boolean.");return this.behavior.apply({type:"local",requestId:T.Z.INSERT_SHEET_REQUEST,sheetId:t,opt:[e],canUndoRedo:!1})},t.delSheet=function(e){var t=e.sheetId,r=e.sheetIndex;if("string"!==typeof t)throw new Error("Warning: sheetId must be a string.");if("number"!==typeof r)throw new Error("Warning: sheetIndex must be a number.");return this.behavior.apply({type:"local",requestId:T.Z.DELETE_SHEET_REQUEST,sheetId:this.app.spreadsheet.activeSheetId,opt:[e],canUndoRedo:!1})},t.moveSheet=function(e){var t=e.fromIndex,r=e.toIndex;if("number"!==typeof t)throw new Error("Warning: fromIndex must be a number.");if("number"!==typeof r)throw new Error("Warning: toIndex must be a number.");return this.behavior.apply({type:"local",requestId:T.Z.MOVE_SHEET_REQUEST,sheetId:this.app.spreadsheet.activeSheetId,opt:[e]})},t.hideSheet=function(e){var t=e.sheetId,r=e.hidden;if("string"!==typeof t)throw new Error("Warning: sheetId must be a string.");if("boolean"!==typeof r)throw new Error("Warning: hidden must ba a boolean.");return this.behavior.apply({type:"local",requestId:T.Z.HIDE_SHEET_REQUEST,sheetId:t,opt:[e]})},t.showSheet=function(e){var t=e.sheetId,r=e.hidden;if("string"!==typeof t)throw new Error("Warning: sheetId must be a string.");if("boolean"!==typeof r)throw new Error("Warning: hidden must ba a boolean.");return this.behavior.apply({type:"local",requestId:T.Z.HIDE_SHEET_REQUEST,sheetId:t,opt:[e]})},t.renameSheet=function(e){var t=e.sheetId,r=e.sheetName;if("string"!==typeof t)throw new Error("Warning: sheetId must be a string.");if("string"!==typeof r)throw new Error("Warning: sheetId must be a string.");return this.behavior.apply({type:"local",requestId:T.Z.RENAME_SHEET_REQUEST,sheetId:t,opt:[e],canUndoRedo:!1})},t.copySheet=function(e){var t=e.sheetId,r=e.newSheetId,a=e.newSheetName;if("string"!==typeof t)throw new Error("Warning: sheetId must be a string.");if("string"!==typeof r)throw new Error("Warning: newSheetId must be a string.");if("string"!==typeof a)throw new Error("Warning: newSheetName must be a string.");return this.behavior.apply({type:"local",requestId:T.Z.COPY_SHEET_REQUEST,sheetId:t,opt:[e],canUndoRedo:!1})},t.addEmbeddedObject=function(e){return this.behavior.apply({type:"local",requestId:T.Z.ADD_EMBEDDED_OBJECT,sheetId:e.objects[0].location.sheetId,opt:[e],canUndoRedo:!0})},t.updateEmbeddedObject=function(e){return this.behavior.apply({type:"local",requestId:T.Z.UPDATE_EMBEDDED_OBJECT,sheetId:e.objects[0].location.sheetId,opt:[e],canUndoRedo:!0})},t.deleteEmbeddedObject=function(e){return this.behavior.apply({type:"local",requestId:T.Z.DELETE_EMBEDDED_OBJECT,sheetId:this.app.spreadsheet.activeSheetId,opt:[e],canUndoRedo:!0})},t.moveEmbeddedObjectToSheet=function(e){var t=e.sheetId;return this.behavior.apply({type:"local",requestId:T.Z.MOVE_EMBEDDED_OBJECT_TO_SHEET,sheetId:t,opt:[e],canUndoRedo:!0})},t.setIgnoredErrorFlags=function(e){var t=this.app.spreadsheet.getActiveSheetId();return this.behavior.apply({type:"local",requestId:T.Z.SET_IGNORED_ERROR_FLAGS,sheetId:t,opt:e,canUndoRedo:!0})},t.setMetadata=function(e){var t,r,a,s=this,n=!1;void 0===e.colIndexes&&void 0===e.effectiveRanges&&(n=!0);var o=this.app.spreadsheet.getActiveSheetId(),i=this.app.view.getSelection(),d=i.rangeSelections,l=i.selectQueue,c=e.metadata,u=e.ignoreValidateRows,p=n?[]:e.colIndexes||[],h=[],I=n?d:e.effectiveRanges||[],E=(0,G.LH)(this.app.spreadsheet.activeSheet),f=H()(I.map((function(e,t){if(n){var r=l[t],a=r.selectAll;if(r.selectCol&&!a&&(p.push({start:e.startColIndex,end:e.endColIndex}),E&&c&&void 0===u))return e.getExcept(E,s.app.spreadsheet.activeSheet)}if(!c)return e;var o=e.startRowIndex,i=e.startColIndex,d=e.endRowIndex,I=e.endColIndex,f=e.sheetId,v=u||0;return o<v&&h.push(new S.Z(f,o,Math.min(v-1,d),i,I)),d>=v?new S.Z(f,Math.max(v,o),d,i,I):[]}))),v=null!==(t=e.dataValidation)&&void 0!==t?t:null,_=[{requestId:T.Z.SET_METADATA,opt:{metadata:c,ranges:f,colIndexes:p,ignoreValidateRows:u,dataValidation:v}}];if(c){if(v)if(v.ruleType===j.DATA_VALIDATION_RULE_TYPE.LIST&&(null===(r=v.argTokens)||void 0===r?void 0:r.length)){var m=(0,Re.aW)(v.ruleType||""),g=m.validType,y=m.dataType,R=v;(null===(a=v.argTokens)||void 0===a?void 0:a[0].type)!==Ae.ARG_TOKEN_TYPE.FORMULA_TOKEN&&(R=this.app.feature.dataValidation.getDataValidationConfig(Object.assign(Object.assign({},v),{selection:f[0],validType:g,dataType:y}),this.app.spreadsheet)),_[0].opt.dataValidation=R,_.push({requestId:T.Z.SET_DATA_VALIDATION_REQUEST,opt:{dataValidation:R,gridRanges:f}})}else _.push({requestId:T.Z.SET_DATA_VALIDATION_REQUEST,opt:{dataValidation:v,gridRanges:f}});else _.push({requestId:T.Z.SET_DATA_VALIDATION_REQUEST,opt:{gridRanges:f,dataValidation:null}});if(c.customDataType===q.ZP.STAR){var A=(0,F.yH)(this.app.spreadsheet.sheetManager.getSheetBySheetId(o),f);if(A){var O={sheetId:o,dimensionModifiers:A,filterViewId:this.app.spreadsheet.activeSheet.filterViewManager.getActiveFilterViewId()};_.push({requestId:T.Z.SET_DIMENSION_SIZE_REQUEST,opt:O})}}}else c||_.push({requestId:T.Z.SET_DATA_VALIDATION_REQUEST,opt:{dataValidation:null,gridRanges:f}});return h.length>0&&_.push({requestId:T.Z.SET_METADATA,opt:{metadata:null,ranges:h,colIndexes:[],ignoreValidateRows:0,dataValidation:null}},{requestId:T.Z.SET_DATA_VALIDATION_REQUEST,opt:{dataValidation:null,gridRanges:h}}),this.behavior.apply({type:"local",requestId:T.Z.MULTI_REQUEST,sheetId:o,opt:{requests:_},canUndoRedo:!0}).then((function(e){var t;return null===(t=s.app.view.canvas.cellEditorManager)||void 0===t||t.updateActiveCellEditor(),e}))},t.setIgnoreColumnError=function(e){var t=e.colIndex,r=e.ignoreInvalidError,a=this.app.spreadsheet.activeSheetId;return this.behavior.apply({type:"local",requestId:T.Z.SET_COLUMN_IGNORE_ERROR,sheetId:a,opt:{ignoreInvalidError:r,colIndex:t,sheetId:a},canUndoRedo:!0})},t.setRefIds=function(e){var t=this.app.spreadsheet.getActiveSheetId();return this.behavior.apply({type:"local",requestId:T.Z.SET_REF_IDS,sheetId:t,opt:e,canUndoRedo:!0})},t.insertRange=function(e){if((0,ye.xZ)(this.app,e))return Promise.resolve();var t=this.app.spreadsheet.getActiveSheetId();return this.behavior.apply({type:"local",requestId:T.Z.INSERT_RANGE_REQUEST,sheetId:t,canUndoRedo:!0,opt:e})},t.deleteRange=function(e){if((0,ye.xZ)(this.app,e))return Promise.resolve();var t=this.app.spreadsheet.getActiveSheetId();return this.behavior.apply({type:"local",requestId:T.Z.DELETE_RANGE_REQUEST,sheetId:t,canUndoRedo:!0,opt:e})},t.moveRange=function(e){return(0,ye.HE)(this.app,e)?Promise.resolve():this.behavior.apply({type:"local",requestId:T.Z.MOVE_RANGE_REQUEST,sheetId:e.sheetId,canUndoRedo:!0,opt:e})},t.setPrivateRange=function(e){var t=this;void 0===e&&(e={});var r=this.app.view.getSelection(),a=r.rangeSelections,s=r.selectQueue,n=e,o=n.isUnset,i=n.ignoreUnsetConfirm,d=n.disableAutoTitleSeek,l=n.ranges;if(!l&&!o&&!d){var c=(0,G.LH)(this.app.spreadsheet.activeSheet);l=H()(a.map((function(e,r){var a=s[r],n=a.selectAll;return a.selectCol&&!n&&c?e.getExcept(c,t.app.spreadsheet.activeSheet):e}))),ge.default.show({message:f.ZP.t("column-type|已开启列填写内容隐藏"),type:"success"})}return this.behavior.apply({type:"local",requestId:T.Z.SET_PRIVATE_RANGE,sheetId:this.app.spreadsheet.activeSheetId,canUndoRedo:!0,opt:{isUnset:o,ignoreUnsetConfirm:i,ranges:l}})},t.addDateReminder=function(e){return this.behavior.apply({type:"local",requestId:T.Z.ADD_DATE_REMINDER_REQUEST,sheetId:e.sheetId,canUndoRedo:!0,opt:e})},t.deleteDateReminder=function(e){return this.behavior.apply({type:"local",requestId:T.Z.DELETE_DATE_REMINDER_REQUEST,sheetId:e.sheetId,canUndoRedo:!1,opt:e})},t.addFilterView=function(e){return this.behavior.apply({type:"local",requestId:T.Z.ADD_FILTER_VIEW,sheetId:this.app.spreadsheet.activeSheetId,canUndoRedo:!0,opt:e})},t.deleteFilterView=function(e){return this.behavior.apply({type:"local",requestId:T.Z.DELETE_FILTER_VIEW,sheetId:this.app.spreadsheet.activeSheetId,canUndoRedo:!0,opt:e})},t.updateFilterView=function(e){return this.behavior.apply({type:"local",requestId:T.Z.UPDATE_FILTER_VIEW,sheetId:this.app.spreadsheet.activeSheetId,canUndoRedo:!0,opt:e})},t.activeFilterView=function(e){return this.behavior.apply({type:"local",requestId:T.Z.ACTIVE_FILTER_VIEW,sheetId:this.app.spreadsheet.activeSheetId,canUndoRedo:!0,opt:e})},t.updateFilterRange=function(e){return this.behavior.apply({type:"local",requestId:T.Z.UPDATE_FILTER_RANGE_REQUEST,sheetId:this.app.spreadsheet.activeSheetId,canUndoRedo:!0,opt:e})},t.addWeworkComponent=function(e){return this.behavior.apply({type:"local",requestId:T.Z.ADD_WEWORK_COMPONENT_REQUEST,sheetId:e.sheetId,canUndoRedo:!0,opt:e})},t.addTodo=function(e){var t=e.needInsertColumns,r=e.colIndex;if("number"===typeof t&&t>0){var a=[];a.push({requestId:T.Z.INSERT_DIMENSION_REQUEST,opt:{type:_.Z.COLUMNS,sheet:this.app.spreadsheet.activeSheet,insertInfo:[{index:r,amount:t}]}}),a.push({requestId:T.Z.ADD_TODO_REQUEST,opt:e});var s={requests:a};return this.behavior.apply({type:"local",sheetId:e.sheetId,requestId:T.Z.MULTI_REQUEST,opt:s,canUndoRedo:!1})}return this.behavior.apply({type:"local",requestId:T.Z.ADD_TODO_REQUEST,sheetId:e.sheetId,canUndoRedo:!1,opt:e})},t.deleteTodo=function(e){return this.behavior.apply({type:"local",requestId:T.Z.DELETE_TODO_REQUEST,sheetId:e.sheetId,canUndoRedo:!1,opt:e})},t.modifyTodo=function(e){return this.behavior.apply({type:"local",requestId:T.Z.MODIFY_TODO_REQUEST,sheetId:e.sheetId,canUndoRedo:!1,opt:e})},t.addNotifyRange=function(e,t){var r={workbookRangeId:e,range:t};return this.behavior.apply({type:"local",sheetId:t.sheetId,requestId:T.Z.ADD_NOTIFY_RANGE_REQUEST,opt:r,canUndoRedo:!1})},t.coverSheet=function(e){return this.behavior.apply({type:"local",requestId:T.Z.COVER_SHEET_REQUEST,sheetId:e.sheetId,canUndoRedo:!0,opt:e})},e}(),je=Ue=be([Le(0,Z.m),Le(1,B),Ze("design:paramtypes",["function"===typeof(we="undefined"!==typeof Z.m&&Z.m)?we:Object,"function"===typeof(Ce="undefined"!==typeof B&&B)?Ce:Object])],Ue)},"../spread-sheet/src/core/feature/dataValidation/DVInterface.ts":function(e,t,r){r.d(t,{Bb:function(){return i},Ju:function(){return l},UD:function(){return d},c1:function(){return c},h6:function(){return n.h6},ob:function(){return n.ob},y3:function(){return o}}),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var a=r("../node_modules/i18next/dist/esm/i18next.js"),s=r("../packages/model/src/index.ts"),n=r("../spread-sheet/src/core/feature/dataValidation/type.ts"),o=new Map([[s.Cell.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,a.ZP.t("介于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,a.ZP.t("不介于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.EQUAL,a.ZP.t("等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,a.ZP.t("不等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS,a.ZP.t("早于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,a.ZP.t("不晚于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT,a.ZP.t("晚于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,a.ZP.t("不早于")]]),i=new Map([[s.Cell.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,a.ZP.t("介于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,a.ZP.t("不介于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.EQUAL,a.ZP.t("等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,a.ZP.t("不等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS,a.ZP.t("小于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,a.ZP.t("小于或等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT,a.ZP.t("大于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,a.ZP.t("大于或等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.INCLUDE,a.ZP.t("包括")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_INCLUDE,a.ZP.t("不包括")]]),d=new Map([[s.Cell.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,a.ZP.t("介于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,a.ZP.t("不介于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.EQUAL,a.ZP.t("等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,a.ZP.t("不等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS,a.ZP.t("小于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,a.ZP.t("小于或等于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT,a.ZP.t("大于")],[s.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,a.ZP.t("大于或等于")]]),l=new Map([[n.h6.NONE,a.ZP.t("数值")],[n.h6.INT,a.ZP.t("整数")],[n.h6.FLOAT,a.ZP.t("小数")]]),c=new Map([[n.h6.ID_CARD,a.ZP.t("身份证号")],[n.h6.MAIL,a.ZP.t("邮箱")],[n.h6.PHONE,a.ZP.t("手机号")],[n.h6.TELEPHONE,a.ZP.t("电话号码")]])},"../spread-sheet/src/core/feature/dataValidation/api/DataValidationConfig.ts":function(e,t,r){r.d(t,{N:function(){return d}}),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.array.filter.js");var a=r("../packages/model/src/cell/data-validation/data-validation-utils.ts"),s=r("../packages/model/src/cell/data-validation/data-validation-rule-type.ts"),n=r("../spread-sheet/src/core/feature/formula/utils.ts"),o=r("../packages/model/src/range/hexRangeUtils.ts"),i=r("../spread-sheet/src/core/feature/dataValidation/DVInterface.ts");function d(e,t){var r,d=function(e){var t=e.validType,r=e.dataType;switch(t){case i.ob.LIST:return s.Z.LIST;case i.ob.NUMBER:switch(r){case i.h6.FLOAT:return s.Z.CUSTOM_MUST_FLOAT;case i.h6.INT:return s.Z.NUMBER_INT;case i.h6.NONE:return s.Z.NUMBER_FLOAT_AND_INT;case i.h6.TEMPERATURE:return s.Z.CUSTOM_NUMBER_TEMPERATURE;case i.h6.PROGRESS:return s.Z.CUSTOM_PROGRESS}break;case i.ob.TEXT:switch(r){case i.h6.CONTENT:return s.Z.CUSTOM_TEXT_CONTAINS;case i.h6.LENGTH:default:return s.Z.TEXT_LENGTH}case i.ob.DATE:return s.Z.DATE;case i.ob.AVAILABLE:switch(r){case i.h6.ID_CARD:return s.Z.CUSTOM_ID_CARD;case i.h6.PHONE:return s.Z.CUSTOM_NUM_PHONE;case i.h6.TELEPHONE:return s.Z.CUSTOM_NUM_TEL;case i.h6.MAIL:return s.Z.CUSTOM_TEXT_MAIL}break;case i.ob.CHECKBOX:return s.Z.CUSTOM_CHECKBOX;case i.ob.STAR:return s.Z.CUSTOM_STAR;case i.ob.ATTACHMENT:return s.Z.CUSTOM_ATTACHMENT;case i.ob.CONTACT:return s.Z.CUSTOM_CONTACT}return console.warn("数据验证：传入数据不符合规则"),s.Z.CUSTOM}({validType:e.validType,dataType:e.dataType}),l=(null===(r=e.argTokens)||void 0===r?void 0:r.filter((function(e){return Boolean(e.userEnteredValue)})).map((function(r){var i=r.userEnteredValue,l=e.selection;if(l&&d===s.Z.LIST&&(0,n.jr)(i)){var c=(0,o.getRangeInfoFormHexRange)(t,i),u=c.rangeString,p={sheetId:c.sheetId,rowIndex:l.startRowIndex,colIndex:l.startColIndex};return(0,a.G8)("="+u,{ruleType:d,positionInfo:p})}return(0,a.G8)(i)})))||null;return{ruleType:d,inputMessage:e.inputMessage||null,isStrict:e.isStrict||!1,showDropDown:e.showDropDown||!1,operator:e.operator,argTokens:l}}},"../spread-sheet/src/core/feature/dataValidation/api/DataValidationUtils.ts":function(e,t,r){r.d(t,{AJ:function(){return P},Dq:function(){return q},Ex:function(){return y},JU:function(){return x},KN:function(){return M},Np:function(){return U},Sc:function(){return T.Sc},Sv:function(){return Z},Wj:function(){return L},ZK:function(){return D},aW:function(){return T.aW},gZ:function(){return j},jY:function(){return S},ko:function(){return g},uU:function(){return F},v1:function(){return k},zk:function(){return R}}),r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.string.trim.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.array.from.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.set.js"),r("../node_modules/core-js/modules/esnext.set.add-all.js"),r("../node_modules/core-js/modules/esnext.set.delete-all.js"),r("../node_modules/core-js/modules/esnext.set.difference.js"),r("../node_modules/core-js/modules/esnext.set.every.js"),r("../node_modules/core-js/modules/esnext.set.filter.js"),r("../node_modules/core-js/modules/esnext.set.find.js"),r("../node_modules/core-js/modules/esnext.set.intersection.js"),r("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),r("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),r("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),r("../node_modules/core-js/modules/esnext.set.join.js"),r("../node_modules/core-js/modules/esnext.set.map.js"),r("../node_modules/core-js/modules/esnext.set.reduce.js"),r("../node_modules/core-js/modules/esnext.set.some.js"),r("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),r("../node_modules/core-js/modules/esnext.set.union.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.string.ends-with.js");var a,s=r("../node_modules/i18next/dist/esm/i18next.js"),n=r("../packages/model/src/index.ts"),o=r("../node_modules/@tencent/txdoc_dayjs/dayjs.min.js"),i=r.n(o),d=r("../spread-sheet/src/core/utils/cell.ts"),l=r("../spread-sheet/src/core/utils/formula.ts"),c=r("../spread-sheet/src/core/utils/numberFromat.ts"),u=r("../packages/model/src/range/hexRangeUtils.ts"),p=r("../packages/model/src/cell/data-validation/data-validation-rule-type.ts"),h=r("../packages/model/src/rule/index.ts"),I=r("../packages/model/src/cell/data-validation/data-validation-utils.ts"),E=r("../spread-sheet/src/core/feature/formula/utils.ts"),f=r("../node_modules/@tencent/sheet-formula-sdk/lib/index.js"),v=r("../packages/model/src/cell/metadata/CustomDataType.ts"),T=r("../spread-sheet/src/core/feature/dataValidation/api/DataValidationUIUtils.ts"),_=r("../packages/model/src/cell/format/NumberFormatType.ts"),m=(r("../spread-sheet/src/core/feature/dataValidation/api/DataValidationConfig.ts"),function(e,t,r,a){return new(r||(r=Promise))((function(s,n){function o(e){try{d(a.next(e))}catch(t){n(t)}}function i(e){try{d(a.throw(e))}catch(t){n(t)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}d((a=a.apply(e,t||[])).next())}))}),g=function(e,t,r){return e?e.split(t).join(r):""},S=function(e){switch(e.ruleType){case p.Z.LIST:case p.Z.NUMBER_INT:case p.Z.NUMBER_FLOAT_AND_INT:case p.Z.CUSTOM_MUST_FLOAT:case p.Z.CUSTOM_NUMBER_TEMPERATURE:case p.Z.TEXT_LENGTH:case p.Z.DATE:return!0}return!1},y=function(e,t,r){return g(e,"$SLOT",f.Pz.toCellId(t,r))},R=function(e){var t;return t=(t=(t=e.split(",")).map((function(e){return e.trim()}))).filter((function(e){return e})),Array.from(new Set(t))};function A(e){var t,r=null===(t=null===e||void 0===e?void 0:e.argTokens)||void 0===t?void 0:t[0];if(!r)return!0;var a=r.type,s=r.formula,n=r.userEnteredValue;if(a===h.ARG_TOKEN_TYPE.VALUE_TOKEN&&null===n)return!0;if(a===h.ARG_TOKEN_TYPE.FORMULA_TOKEN){if(null===s)return!0;if(!0===(null===s||void 0===s?void 0:s.hasReferenceError))return!0}return!1}function O(e){return null!=e&&null!=e.argTokens&&e.ruleType===p.Z.LIST||(console.warn("数据验证：类型不为list或者用户输入为空，不能获取下拉列表信息"),!1)}function N(e,t,s,n){var o,i,d;return m(this,void 0,void 0,regeneratorRuntime.mark((function l(){var c,p,h,E,f,v,T,_,m,g;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(c=w(t),p=t.argTokens[0],c!==a.RANGE_LIST){l.next=16;break}if(h=(0,I.o5)(p,{rowIndex:s,colIndex:n,options:e.spreadsheet.sheetManager}),E=(0,u.getRangeInfoFormHexRange)(e.spreadsheet,h),f=E.sheetId,v=E.rangeString,T=f||e.spreadsheet.getActiveSheetId(),null===(d=null===(i=null===(o=e.spreadsheet)||void 0===o?void 0:o.sheetManager)||void 0===i?void 0:i.getSheetBySheetId(T))||void 0===d?void 0:d.isLoaded){l.next=10;break}return l.next=10,new Promise((function(t){e.dataCenter.loadSheetData({sheetId:f,ignoreChunk:!0,onFinished:function(){t(!0)},onFail:function(e){var a;t(!1),null===(a=r.g.log)||void 0===a||a.error("获取数据验证引用子表("+f+")失败",e)}})}));case 10:if(_=b(e,v,f),null!==(m=C(e,_))){l.next=14;break}return l.abrupt("return",[]);case 14:return m=m.filter((function(e){return e})),l.abrupt("return",Array.from(new Set(m)));case 16:if(g=p.userEnteredValue,c!==a.ITEM_LIST||null===g){l.next=19;break}return l.abrupt("return",R(g));case 19:return l.abrupt("return",null);case 20:case"end":return l.stop()}}),l)})))}function D(e,t,r){return m(this,void 0,void 0,regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,O(s=(0,T.Ii)(e.spreadsheet.activeSheet,t,r))&&!A(s)){a.next=5;break}return a.abrupt("return",null);case 5:return a.next=7,N(e,s,t,r);case 7:return n=a.sent,a.abrupt("return",n);case 11:return a.prev=11,a.t0=a.catch(0),console.warn("数据验证获取下拉列表错误",a.t0),a.abrupt("return",null);case 15:case"end":return a.stop()}}),a,null,[[0,11]])})))}function w(e){var t,r;if(e.ruleType!==p.Z.LIST)return"";var s=null===(t=null===e||void 0===e?void 0:e.argTokens)||void 0===t?void 0:t[0].type;if(s===h.ARG_TOKEN_TYPE.FORMULA_TOKEN)return a.RANGE_LIST;var n=null===(r=null===e||void 0===e?void 0:e.argTokens)||void 0===r?void 0:r[0].userEnteredValue;return n&&s===h.ARG_TOKEN_TYPE.VALUE_TOKEN&&0!==n.length?a.ITEM_LIST:""}function C(e,t){if(null==t)return null;var r=t.sheetId,a=e.spreadsheet.sheetManager.getSheetBySheetId(r),s=[];if(a){var n=a.data.getCellDatasAtRange(t);null===n||void 0===n||n.forEach((function(e){return e.forEach((function(e){null!=e&&s.push((0,d.getMergedValue)(e))}))}))}return s}!function(e){e.RANGE_LIST="range-list",e.ITEM_LIST="item-list"}(a||(a={}));var b=function(e,t,r){if(!t)return null;if(!r&&e){r=e.spreadsheet.activeSheetId;var a=(0,l.moveEqualChar)(t).split("!")[0];'"'===a[0]&&'"'===a[a.length-1]&&(a=a.substring(1,a.length-1));var s=e.spreadsheet.sheetManager.getSheetBySheetTitle(a);s&&s.getSheetId()!==r&&(r=s.getSheetId())}return r?(0,u.hex2Range)(t,r):null},Z=function(e){return-1===["between","notBetween","equal","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual"].indexOf(e)},L=function(e){return-1===["contains","notContains","equal"].indexOf(e)};function P(e,t,r){void 0===t&&(t="YYYY-MM-DD"),void 0===r&&(r="date");var a=i()(e).format(t);return"date"==r&&(a+="T00:00:00"),n.Utils.numberFormatUtils.formatParseEngine.datetime2Numeric(a)}var M=function(e){if(e){var t=n.Utils.numberFormatUtils.formatParseEngine.parseValueWithStyle(e);return null==t?e:t.value}return e},U=function(e){var t,r=(0,E.jr)(e);if("string"===typeof e)if('""'===e)t=e;else{if(r)return(0,l.moveEqualChar)(e);t='"'+e+'"'}else{if("number"===typeof e||"boolean"===typeof e)return t=""+e;t='""'}return t},j=function(e,t,r){for(var a=t,s=t.sheetId,n=e.sheetManager.getSheetBySheetId(t.sheetId),o=a.isCol?0:a.startRowIndex,i=a.isCol?n.getRowCount()-1:a.endRowIndex,d=a.isRow?0:a.startColIndex,l=a.isRow?n.getColCount()-1:a.endColIndex,c=o;c<=i;c++)for(var u=d;u<=l;u++)r(c,u,s)},k=function(e){var t=e.view.getSelection();if(!t)return!1;var r=t.activeCell,a=r.rowIndex,s=r.colIndex;return!!(0,T.Sc)(e.spreadsheet.activeSheet,a,s)};function x(e,t,r,a){var o=(void 0===a?{}:a).fractionFirst,i=void 0!==o&&o,d=e.inputOne,u=e.inputTwo,p=e.operate;if(!e.inputTwoShow)return null;if(p!==n.Cell.DATA_VALIDATION_CONDITION_TYPE.BETWEEN&&p!==n.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN)return null;if(""===d.trim()||""===u.trim())return null;if((0,l.isFormulaString)(d)||(0,l.isFormulaString)(u))return null;var h=(0,c.stringToNumber)(d,{fractionFirst:i}),I=(0,c.stringToNumber)(u,{fractionFirst:i});if(!h||!I)return null;var E=h.numericValue,f=I.numericValue;return"number"!==typeof E||"number"!==typeof f?null:f-E<0?1===t?{inputOneIsError:!0,inputOneErrorTip:s.ZP.t("请输入小于最大值的{{inputType}}",{inputType:r}),inputTwoIsError:!1}:{inputOneIsError:!1,inputTwoIsError:!0,inputTwoErrorTip:s.ZP.t("请输入大于最小值的{{inputType}}",{inputType:r})}:null}var V=function(e){var t=n.Utils.numberFormatUtils.formatParseEngine.parseValue(e,"");return(null===t||void 0===t?void 0:t.type)===_.Z.DATE_TIME||(null===t||void 0===t?void 0:t.type)===_.Z.DATE||(null===t||void 0===t?void 0:t.type)===_.Z.TIME},F=function(e,t){switch(t.ruleType){case p.Z.DATE:return V(e);case p.Z.NUMBER_INT:case p.Z.CUSTOM_MUST_FLOAT:case p.Z.NUMBER_FLOAT_AND_INT:return!V(e)}return!0};function q(e,t,r){var a;return r&&!r.endsWith("%")||(null===(a=null===t||void 0===t?void 0:t.getMetadata())||void 0===a?void 0:a.customDataType)!==v.ZP.PROGRESS?e:"("+e+" * 100)"}},"../spread-sheet/src/core/network/message-center/model/UserChange.ts":function(e,t,r){r.d(t,{t:function(){return a}});var a,s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),n=(r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../packages/report/src/index.ts")),o=r("../spread-sheet/src/base/config/report.ts"),i=r("../spread-sheet/src/core/behavior/multi-type-follow.ts");!function(e){e[e.WATING=0]="WATING",e[e.COMMITING=1]="COMMITING",e[e.ACCEPT=2]="ACCEPT"}(a||(a={}));var d=function(){function e(e){var t,s,d=this;this.head=!1,this.isWorkbook=!1,this.status=a.WATING,this.taskId=0,this.isOfflineMessage=!1,this.allowAutoMerge=!1,this.commitTimes=0,this.createMessageSeq=function(){return Math.ceil(2147483648*Math.random())},this.globalPadId=e.globalPadId,this.baseVersion=e.baseVersion,this.sheetId=e.sheetId,this.mutations=[],e.data&&(null===(s=null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.mutations)||void 0===s||s.forEach((function(t){if(t&&Array.isArray(t)){var r=[];t.forEach((function(t){var a,s=(0,i.Xe)(t,null===(a=e.data)||void 0===a?void 0:a.changesetType);s&&r.push(s)})),d.mutations.push(r)}else n.ZP.run(o.CONFIG.INIT_DATA_ERROR,[e.data.mutations])})),this.changesetType=e.data.changesetType,this.changeData=e.data.changedata||e.data.changeData||null,this.keyData=e.data.keyData||null,this.head=e.data.head||!1,this.isWorkbook=e.data.isWorkbook||!1,this.originSheetId=e.data.oSubId||null,this.taskId=e.data.taskId||this.createMessageSeq()),this.isOfflineMessage=e.isOfflineMessage||!1,this.allowAutoMerge=e.allowAutoMerge||!1,this.time=e.time||(new Date).getTime(),this.status=e.status||a.WATING,this.dver=e.dver||r.g.__globalCodeVersion}var t=e.prototype;return t.isMutationChange=function(){return!this.changeData},t.setChangeData=function(e){this.changeData=e},t.setOrAppendMutations=function(e){this.mutations.push(e)},t.setKeyData=function(e){this.keyData=e},t.isWithKeyData=function(){return!!this.keyData},(0,s.Z)(e,[{key:"requestCount",get:function(){return this.isMutationChange()?(null===this||void 0===this?void 0:this.mutations.length)||0:1}},{key:"isEmpty",get:function(){return(!this.mutations||0===this.mutations.length)&&!this.changeData||0===this.taskId}},{key:"key",get:function(){return this.globalPadId+"_"+this.sheetId+"_"+this.time}}]),e}();t.Z=d},"../spread-sheet/src/core/network/message-center/model/userChange-helper.ts":function(e,t,r){r.d(t,{HJ:function(){return c},Jv:function(){return l},PL:function(){return h},bR:function(){return p},rg:function(){return u}}),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.array.concat.js");var a=r("../spread-sheet/src/core/network/message-center/model/UserChange.ts"),s=r("../packages/report/src/index.ts"),n=r("../spread-sheet/src/base/config/report.ts"),o=r("../spread-sheet/src/core/behavior/multi-type-follow.ts"),i=r("../spread-sheet/src/core/network/message-center/model/changeset-type.ts");function d(e){if(e.changeData)return JSON.stringify(e.changeData);if(e.mutations){var t=[];return e.mutations.forEach((function(e){var r=[];e.forEach((function(e){var t=window.SpreadsheetApp.mutationBehavior.serializeMutation(e);r.push(t)})),t.push(r)})),JSON.stringify(t)}return JSON.stringify([])}function l(e){var t,r={};r.baseVersion=e.baseVersion,r.sheetId=e.sheetId;var a=[];null===(t=e.mutations)||void 0===t||t.forEach((function(t){var r=[];t.forEach((function(t){var a=window.SpreadsheetApp.mutationBehavior.serializeMutation(t);a?r.push(a):s.ZP.run(n.CONFIG.STORE_DATA_ERROR,[e.mutations])})),a.push(r)}));var o=e.changeData||null,i={type:"USER_CHANGES",taskId:e.taskId,baseRev:e.baseVersion,mutations:a,changeData:o,keyData:e.keyData,head:e.head,subId:e.sheetId,oSubId:e.originSheetId||!1,pver:1,changesetType:e.changesetType};return r.isOfflineMessage=!0,r.data=i,r.time=e.time,r.status=e.status,r.dver=e.dver,r}function c(e){var t={type:"USER_CHANGES",baseRev:e.baseVersion,changeset:d(e),changesetType:e.changesetType,keydata:e.keyData||!1,head:e.head,isWorkbook:e.isWorkbook,subId:e.sheetId,oSubId:e.originSheetId||!1,changeSetCount:e.requestCount,offlineMsg:e.isOfflineMessage,taskId:e.taskId,pver:1};return t.changeset=t.changeset+"\n",t.keydata&&(t.keydata=t.keydata+"\n"),JSON.stringify(t)}function u(e){var t={globalPadId:e.globalPadId,baseVersion:e.baseVersion,sheetId:e.sheetId,status:e.status,data:{}};if(e.mutations){var r=[];e.mutations.forEach((function(e){var t=[];e.forEach((function(e){var r=window.SpreadsheetApp.mutationBehavior.serializeMutation(e);t.push(r)})),r.push(t)})),t.data.mutations=JSON.stringify(r),t.data.changesetType=e.changesetType}return e.changeData&&(t.data.changeData=JSON.stringify(e.changeData)),void 0!==e.head&&(t.data.head=e.head),void 0!==e.originSheetId&&(t.data.oSubId=e.originSheetId),void 0!==e.taskId&&(t.data.taskId=e.taskId),void 0!==e.isWorkbook&&(t.data.isWorkbook=e.isWorkbook),t}function p(e){var t,r,s,n=e;if("smartsheet"===(null===(t=n.data)||void 0===t?void 0:t.changesetType)&&(n.data.mutations=[]),null===(r=n.data)||void 0===r?void 0:r.mutations)try{n.data.mutations=JSON.parse(n.data.mutations)}catch(o){}return(null===(s=n.data)||void 0===s?void 0:s.changeData)&&(n.data.changeData=JSON.parse(n.data.changeData)),new a.Z(n)}function h(e,t){var r=e.spreadsheet.sheetManager.getSheetBySheetId(t.sheetId),a=t.changesetType,s=[];t.mutations.forEach((function(e){s=s.concat(e)})),(t.head||t.isWorkbook||(null===r||void 0===r?void 0:r.isLoaded)||(null===r||void 0===r?void 0:r.getSheetId())===e.spreadsheet.activeSheetId&&a!==i.G.SMARTSHEET)&&(0,o.d)(s,a)}},"../spread-sheet/src/core/utils/config.ts":function(e,t,r){r.d(t,{q:function(){return s}});var a=r("../spread-sheet/src/core/data/configService/spreadConfig.ts");function s(){return-1!==["local","new"].indexOf(a.q.getConfig("padStatus"))}},"../spread-sheet/src/core/utils/offline-env.ts":function(e,t,r){r.d(t,{j:function(){return a}});var a=function(){return!!window.__SUPPORT_FULL_OFFLINE_MODE}},"../spread-sheet/src/core/view/level-2/cell-editors/editors/util.ts":function(e,t,r){r.d(t,{Cv:function(){return y},Ks:function(){return T},NM:function(){return N},Nn:function(){return R},St:function(){return O},Y3:function(){return m},qz:function(){return _},rs:function(){return g},sk:function(){return D}}),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.string.repeat.js");var a,s,n,o=r("../packages/model/src/cell/format/index.ts"),i=r("../packages/model/src/cell/metadata/CustomDataType.ts"),d=r("../packages/model/src/range/GridRange.ts"),l=r("../spread-sheet/src/core/view/spreadsheet-view/transform-table/cell.ts"),c=r("../spread-sheet/src/core/view/level-2/render-plugin/utils.ts"),u=r("../packages/report/src/index.ts"),p=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),h=r.n(p),I=r("../packages/model/src/cell/metadata/date-time/DateTimeTemplateType.ts"),E=r("../node_modules/dayjs/dayjs.min.js"),f=r.n(E),v=r("../packages/model/src/cell/index.ts");function T(e,t,r,a){var s,n;void 0===t&&(t=[]);var o=e.requestApi,i=e.spreadsheet.activeSheet,l=i.getSheetId(),c=null===(n=null===(s=i.getCellDataAtPosition(r,a))||void 0===s?void 0:s.getMetadata())||void 0===n?void 0:n.config;if(c){var u=c.getSelectedTextValue(t);o.setRefIds({sheetId:l,range:new d.Z(l,r,r,a,a),refIds:t,cellValue:u})}}function _(e){var t,r,a=(0,l.PE)(e).value,s=(0,l.YW)(e).value,n=((t={})[o.VERTICAL_ALIGN.TOP]={alignItems:"flex-start",top:c.Xf+"px"},t[o.VERTICAL_ALIGN.MIDDLE]={alignItems:"center",top:"50%",transform:"translateY(-50%)"},t[o.VERTICAL_ALIGN.BOTTOM]={alignItems:"flex-end",bottom:c.Xf+"px"},t),i=((r={})[o.HORIZONTAL_ALIGN.LEFT]={justifyContent:"flex-start"},r[o.HORIZONTAL_ALIGN.CENTER]={justifyContent:"center"},r[o.HORIZONTAL_ALIGN.RIGHT]={justifyContent:"flex-end"},r);return Object.assign(Object.assign({},n[s]),i[a])}function m(e,t,r,a){e.requestApi.userEnter({text:i.KH.repeat(t)+i.E.repeat(i.XZ-t),colIndex:a,rowIndex:r})}function g(e){var t,r=null===(t=null===e||void 0===e?void 0:e.getEffectiveValue())||void 0===t?void 0:t.value;return"string"!==typeof r?"":r}var S=((a={})[I.KS.YEAR_MONTH_DAY]="y_m_d",a[I.KS.YEAR_MONTH]="y_m",a[I.KS.MONTH_DAY]="m_d",a[I.KS.DATE_TIME]="d_c",a[I.KS.HOUR_MINUTE]="clock",a);function y(e,t,r){void 0===t&&(t=!1);var a=h().isMobilePhone?"Mobile_Excel":"PC_Excel",s={opername:"doc_excel_editor",module:"data_validation",action:"validation_fillin",ver10:e,ver11:a=t?"Mobile_row":a};r&&(s.ver13=S[r]),u.ZP.tdwReport(s)}function R(e,t){var r;void 0===t&&(t=!1);var a=((r={})[i.ZP.PROGRESS]=!h().isMobilePhone&&"progress",r[i.ZP.ID]="ID",r[i.ZP.PHONE_NUM]="phone",r[i.ZP.EMAIL]="mail",r[i.ZP.TEMPERATURE]="temperature",r)[e];a&&y(a,t)}var A=(null===(n=window.TouchEvent)||void 0===n?void 0:n.prototype.preventDefault)||function(){};function O(e){(h().isIPad||h().isAndroidPad)&&(TouchEvent.prototype.preventDefault=function(){e.contains(this.target)||A.call(this)})}function N(){(h().isIPad||h().isAndroidPad)&&(TouchEvent.prototype.preventDefault=A)}var D=function(e){return function(t){var r=e.ruleType,a=e.operator,s=e.argTokens;if(r!==v.DATA_VALIDATION_RULE_TYPE.DATE||!a||a===v.DATA_VALIDATION_CONDITION_TYPE.INCLUDE||a===v.DATA_VALIDATION_CONDITION_TYPE.NOT_INCLUDE||!(null===s||void 0===s?void 0:s.length))return!0;var n=s[0].userEnteredValue,o=s[1].userEnteredValue;if(!n)return!0;var i=f()(n),d=o?f()(o):void 0;return w[a](t,i,d)}},w=((s={})[v.DATA_VALIDATION_CONDITION_TYPE.BETWEEN]=function(e,t,r){return(e.isAfter(t,"day")||e.isSame(t,"day"))&&(e.isBefore(r,"day")||e.isSame(r,"day"))},s[v.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN]=function(e,t,r){return e.isBefore(t,"day")||e.isAfter(r,"day")},s[v.DATA_VALIDATION_CONDITION_TYPE.GREAT]=function(e,t){return e.isAfter(t,"day")},s[v.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL]=function(e,t){return e.isAfter(t,"day")||e.isSame(t,"day")},s[v.DATA_VALIDATION_CONDITION_TYPE.LESS]=function(e,t){return e.isBefore(t,"day")},s[v.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL]=function(e,t){return e.isBefore(t,"day")||e.isSame(t,"day")},s[v.DATA_VALIDATION_CONDITION_TYPE.EQUAL]=function(e,t){return e.isSame(t,"day")},s[v.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL]=function(e,t){return!e.isSame(t,"day")},s)},"../spread-sheet/src/core/view/level-2/render-plugin/utils.ts":function(e,t,r){r.d(t,{VD:function(){return i},Xf:function(){return n},jG:function(){return d},qp:function(){return l},t9:function(){return o}}),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js");var a=r("../spread-sheet/src/core/view/spreadsheet-view/model/VerticalAlign.ts"),s=r("../spread-sheet/src/core/view/config/default.ts"),n=2;function o(e,t,r,s,o){var i=e.getCellViewAtPosition(t,r);if(null===i)throw new Error("获取单元格异常");var d=0;switch(i.style.verticalAlign.value){case a.o.MIDDLE:d=(s-o)/2;break;case a.o.TOP:d=n;break;case a.o.BOTTOM:d=s-n-o}return d}function i(e,t){return t[0]<=e[0]&&e[0]<=t[0]+t[2]&&t[1]<=e[1]&&e[1]<=t[1]+t[3]}function d(e,t){return void 0===t&&(t=.8),t*((e||s.n5)/s.n5)}function l(e,t,r,s,n){if(!e)throw new Error("获取单元格异常");var o=n.width,i=n.height,d=(e.paddingLeft-o)/2,l=0;switch(e.style.verticalAlign.value){case a.o.MIDDLE:l=(t-i)/2;break;case a.o.TOP:l+i>t&&(l=1);break;case a.o.BOTTOM:l=t-i-1;break;default:console.error("Error")}return[r+d,s+l]}},"../spread-sheet/src/core/view/level-2/todo-ent/utils.ts":function(e,t,r){r.d(t,{AE:function(){return i},HE:function(){return p},Lj:function(){return c},TQ:function(){return l},cV:function(){return d},xZ:function(){return u}}),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/dayjs/dayjs.min.js"),r("../packages/model/src/cell/metadata/CustomDataType.ts"),r("../packages/model/src/cell/metadata/date-time/DateTimeTemplateType.ts");var a,s=r("../packages/model/src/range/index.ts"),n=r("../spread-sheet/src/core/behavior/request/range/config.ts"),o=r("../spread-sheet/src/core/view/level-2/wework-component-ent/utils.ts");function i(e){var t=e.view.getSelection().activeCell,r=t.rowIndex,a=t.colIndex,s=e.spreadsheet.activeSheet.getCellDataAtPosition(r,a);return(null===s||void 0===s?void 0:s.isWeworkComponent())||!1}function d(e,t,r){var a=e.spreadsheet.activeSheet.todoManager.crossTodoCell(r,t);return a&&(0,o.CF)("该操作涉及待办单元格，请取消待办后重试"),a}function l(e,t){void 0===t&&(t=!0);var r=!!(e.view.getSelection().rangeSelections||[]).find((function(t){return e.spreadsheet.activeSheet.todoManager.containTodoCell(t)}));return r&&t&&(0,o.CF)("该操作涉及待办单元格，请取消待办后重试"),r}function c(e,t){void 0===t&&(t=!0);var r=function(e){var t=e.view.getSelection().rangeSelections;if(1!==t.length)return null;var r=t[0],a=r.startRowIndex,s=r.startColIndex,n=r.endRowIndex,o=r.endColIndex,i=e.spreadsheet.activeSheet.todoManager.getTodoRange(a,s);return a===n&&s===o&&(null===i||void 0===i?void 0:i.rowIndex)===a&&(null===i||void 0===i?void 0:i.colIndex)===s?i:null}(e);if(null===r||void 0===r?void 0:r.todoId){var a=r.todoId,s=r.rowIndex,n=r.colIndex;return e.view.canvas.todoCenter.deleteTodo(a,s,n),{isTodoMasterCell:!0,isRelatedTodoBindCell:!1}}return{isTodoMasterCell:!1,isRelatedTodoBindCell:l(e,t)}}function u(e,t){var r=t.direction,a=t.range,i=a.sheetId,d=a.startRowIndex,l=a.startColIndex,c=a.endRowIndex,u=a.endColIndex,p=e.spreadsheet.activeSheet.getColCount(),h=e.spreadsheet.activeSheet.getRowCount(),I=r===n.ai.RIGHT||r===n._z.LEFT?new s.GridRange(i,d,c,l,p-1):new s.GridRange(i,d,h-1,l,u),E=e.spreadsheet.activeSheet.todoManager.containTodoCell(I);return E&&(0,o.CF)("该操作涉及待办单元格，请取消待办后重试"),E}function p(e,t){var r=t.toRange,a=t.fromRange,s=e.spreadsheet.activeSheet.todoManager;return!(!s.containTodoCell(r)&&!s.containTodoCell(a))&&((0,o.CF)("该操作涉及待办单元格，请取消待办后重试"),!0)}!function(e){e[e.ALLOW=0]="ALLOW",e[e.CANNOT_EDIT=1]="CANNOT_EDIT",e[e.NON_SINGLE_CELL=2]="NON_SINGLE_CELL",e[e.RIGHT_SIDE_NOT_ENOUGH_CELL=3]="RIGHT_SIDE_NOT_ENOUGH_CELL",e[e.RIGHT_SIDE_CONTAIN_TODO=4]="RIGHT_SIDE_CONTAIN_TODO",e[e.RIGHT_SIDE_CONTAIN_STAFF_CARD=5]="RIGHT_SIDE_CONTAIN_STAFF_CARD",e[e.RIGHT_SIDE_CONTAIN_GROUP_CARD=6]="RIGHT_SIDE_CONTAIN_GROUP_CARD",e[e.RIGHT_SIDE_CONTAIN_SCHEDULE=7]="RIGHT_SIDE_CONTAIN_SCHEDULE",e[e.RIGHT_SIDE_CONTAIN_COLUMN_VALIDATION=8]="RIGHT_SIDE_CONTAIN_COLUMN_VALIDATION",e[e.INSERT_IN_FILTER_AREA=9]="INSERT_IN_FILTER_AREA"}(a||(a={}))},"../spread-sheet/src/core/view/level-2/wework-component-ent/utils.ts":function(e,t,r){r.d(t,{CF:function(){return s}}),r("../node_modules/core-js/modules/es.function.name.js"),r("../node_modules/core-js/modules/es.number.constructor.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../packages/model/src/cell/ref-data/group-card.ts"),r("../packages/model/src/cell/ref-data/staff-card.ts"),r("../packages/model/src/cell/ref-data/schedule.ts"),r("../packages/model/src/cell/ref-data/third-party-app.ts"),r("../packages/model/src/cell/ref-data/mini-app.ts");var a=r("../spread-sheet/src/core/ui/toast/toast.tsx");function s(e){(0,a.showToast)(e,{},{showCloseBtn:!0,toolToastCloseTime:3e3})}}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/bundle_module_behavior_api.a6ee58aba83a31481903.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=bundle_module_behavior_api.a6ee58aba83a31481903.js.map