!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Aegis=t()}(this,(function(){"use strict";var e,t;function n(t){this.name="__st"+(1e9*Math.random()>>>0)+e+"__",null==t||t.forEach(this.add,this),e+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],o=0;o<n;){var r=t[o];if(e.call(i,r,o,t))return r;o+=1}}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),window.WeakSet||(e=Date.now()%1e9,n.prototype.add=function(e){var t=this.name;return e[t]||Object.defineProperty(e,t,{value:!0,writable:!0}),this},n.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},n.prototype.has=function(e){return!!e[this.name]},t=n,Object.defineProperty(window,"WeakSet",{value:function(e){return new t(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(i=arguments[n]))for(var i=Object(i),o=Object.keys(Object(i)),r=0,s=o.length;r<s;r++){var a=o[r],u=Object.getOwnPropertyDescriptor(i,a);null!=u&&u.enumerable&&(t[a]=i[a])}return t}});var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function r(e){try{return encodeURIComponent(decodeURIComponent(e))}catch(n){return e}}var s,a=(c.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},c.prototype.on=function(e,t,n){if(void 0===n&&(n=0),this){var i=this.eventsList[e];return i||(this.eventsList[e]=[],i=this.eventsList[e]),-1!==this.indexOf(i,t)||i.push({name:e,type:n||0,callback:t}),this}},c.prototype.one=function(e,t){this.on(e,t,1)},c.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(!n)return null;if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}return null}},c.prototype.clear=function(){this.eventsList={}},c),u=function(e){return(e=Array.isArray(e)?e:[e]).map((function(e,t){return Object.getOwnPropertyNames(e).map((function(n){return r(n)+"["+t+"]="+(void 0===e[n]?"":r(e[n]))})).join("&")})).join("&")+(e.length?"&count="+e.length:"")};function c(){var e=this;this.emit=function(t,n){if(e){var i;if(null!=(o=e.eventsList[t])&&o.length)for(var o=o.slice(),r=0;r<o.length;r++){i=o[r];try{var s=i.callback.apply(e,[n]);if(1===i.type&&e.remove(t,i.callback),!1===s)break}catch(t){throw t}}return e}},this.eventsList={}}function l(e,t){return"number"==typeof e||"string"==typeof e?e:t?s.string:s.number}function f(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function d(e){return"string"==typeof e&&e.startsWith("//")?"undefined"!=typeof location&&"https:"===location.protocol:/^https/.test(e)}function p(e){return y.some((function(t){return-1!==e.indexOf(t)}))}function h(e,t){var n;try{"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null===(n=null==t?void 0:t.ret)||void 0===n?void 0:n.join)&&(w=[].concat(t.ret.map((function(e){return e.toLowerCase()}))));var i=Object.getOwnPropertyNames(e).filter((function(e){return-1!==w.indexOf(e.toLowerCase())}));return i.length?""+e[i[0]]:"unknown"}catch(e){return"unknown"}}function g(e,t){void 0===t&&(t=3);var n,i,o,r="";return Array.isArray(e)?(r+="[",n=e.length,e.forEach((function(e,i){var o,s;r+="object"==typeof e&&1<t?g(e,t-1):(s="",s+="undefined"==(e=typeof(o=e))||"symbol"==e||"function"==e?"null":"string"==e||"object"==e?'"'+o+'"':o),r+=i===n-1?"":","})),r+="]"):e instanceof Object?(r="{",i=Object.keys(e),o=i.length,i.forEach((function(n,s){var a,u,c;"object"==typeof e[n]&&1<t?r+='"'+n+'":'+g(e[n],t-1):r+=(c="","string"==(n=typeof(u=e[a=n]))||"object"==n?c+='"'+a+'":"'+u+'"':"function"==typeof u?c+='"'+a+'":"function '+u.name+'"':"symbol"==typeof u?c+='"'+a+'":"symbol"':"number"!=typeof u&&"boolean"!=n||(c+='"'+a+'": '+u),c),r+=s===o-1||s<o-1&&void 0===e[i[s+1]]?"":","})),r+="}"):r+=e,r}(V=s=s||{})[V.number=-1]="number",V.string="";var m,v,y=["application/octet-stream","application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/ogg","text/html","text/css","text/javascript","image","audio","video"],w=["ret","retcode","code"],b=function(e){if("string"==typeof e)return e;try{return(JSON.stringify(e,(t=[],n=[],function(e,i){if(i instanceof Error)return"Error.message: "+i.message+" \n  Error.stack: "+i.stack;if("object"==typeof i&&null!==i){var o=t.indexOf(i);if(-1!==o)return"[Circular "+n[o]+"]";t.push(i),n.push(e||"root")}return i}),4)||"undefined").replace(/"/gim,"")}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}var t,n},E=(L.prototype.sourceURL=function(){return this.data.responseURL},L.prototype.status=function(){return Number(this.data.status)},L.prototype.headers=function(){var e=this.data.getAllResponseHeaders().split("\n"),t={};return e.forEach((function(e){var n;e&&(e=(n=e.split(": "))[0],n=n[1].trim(),t[e]=n)})),t},L),O=(R.prototype.sourceURL=function(){return this.data.url},R.prototype.status=function(){return Number(this.data.status)},R.prototype.headers=function(){var e={};return this.data.headers.forEach((function(t,n){e[n]=t})),e},R);function R(e,t){this.type="fetch",this.data=e||{},this.data.response=t}function L(e){this.type="xhr",this.data=e}function S(e,t){var n,i=[],o=e.config;return e.lifeCycle.on("destroy",(function(){i.length=0})),function(e,r){if(i.push(e),t&&i.length>=t)return i=_(i),r(i.splice(0,i.length)),void(n&&clearTimeout(n));n&&clearTimeout(n),n=setTimeout((function(){n=null,0<(i=_(i)).length&&r(i.splice(0,i.length))}),o.delay)}}function T(e,t){return Array.isArray(e)?t(e.map((function(e){return o(o({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(b).join(" ")})}))):t(o(o({},e),{msg:"string"==typeof e.msg?e.msg:b(e.msg)}))}function x(e){if(!e||!e.reduce||!e.length)throw new TypeError("createPipeline need at least one function param");return 1===e.length?function(t,n){e[0](t,n||F)}:e.reduce((function(e,t){return function(n,i){return void 0===i&&(i=F),e(n,(function(e){return null==t?void 0:t(e,i)}))}}))}function P(e,t){Object.getOwnPropertyNames(e).forEach((function(n){"function"==typeof e[n]&&"constructor"!==n&&(t?t[n]=function(){}:e[n]=function(){})}))}function C(){return void 0!==window.performance&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function I(e){if(W.find((function(t){return t.name===e.name})))throw new Error("name '"+e.name+"' is already in hackXHR option list");var t,n;W.push(e),!X&&window.XMLHttpRequest&&(X=!0,t=window.XMLHttpRequest.prototype.send,n=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(){if(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1],this.aegisXhrStartTime=Date.now(),!this.sendByAegis)for(var e=0;e<W.length;e++){var t=W[e];try{"function"==typeof t.open&&t.open(this)}catch(e){}}return n.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<W.length;e++){var n=W[e];try{"function"==typeof n.send&&n.send(this,arguments[0])}catch(e){}}return t.apply(this,arguments)})}function A(e){var t=W.findIndex((function(t){return t.name===e.name}));-1!==t&&W.splice(t,1)}($=m=m||{}).INFO_ALL="-1",$.API_RESPONSE="1",$.INFO="2",$.ERROR="4",$.PROMISE_ERROR="8",$.AJAX_ERROR="16",$.SCRIPT_ERROR="32",$.IMAGE_ERROR="64",$.CSS_ERROR="128",$.CONSOLE_ERROR="256",$.MEDIA_ERROR="512",$.RET_ERROR="1024",$.REPORT="2048",$.PV="4096",$.EVENT="8192",(Ae=xe=xe||{})[Ae.android=1]="android",Ae[Ae.ios=2]="ios",Ae[Ae.windows=3]="windows",Ae[Ae.macos=4]="macos",Ae[Ae.linux=5]="linux",Ae[Ae.devtools=6]="devtools",Ae[Ae.other=100]="other",(ce=se=se||{})[ce.unknown=100]="unknown",ce[ce.wifi=1]="wifi",ce[ce.net2g=2]="net2g",ce[ce.net3g=3]="net3g",ce[ce.net4g=4]="net4g",ce[ce.net5g=5]="net5g",ce[ce.net6g=6]="net6g",(fe=v=v||{}).LOG="log",fe.SPEED="speed",fe.PERFORMANCE="performance",fe.OFFLINE="offline",fe.WHITE_LIST="whiteList",fe.VITALS="vitals",fe.PV="pv",fe.CUSTOM_PV="customPV",fe.EVENT="event",fe.CUSTOM="custom",fe.SDK_ERROR="sdkError";var N,k,_=function(e){return e.filter((function(t,n){return"static"!==t.type||!e.find((function(e,i){return n!==i&&t.url===e.url&&200===t.status}))}))},j=function(e){e.level===m.INFO_ALL&&(e.level=m.INFO)},U=function(e){return function(t,n){return e.send({url:e.config.url||"",data:u(t),method:"post",contentType:"application/x-www-form-urlencoded",type:v.LOG,log:t},(function(){var i=e.config.onReport;"function"==typeof i&&t.forEach((function(e){i(e)})),"function"==typeof n&&n([])}),(function(t){"403 forbidden"===t&&e.destroy()}))}},F=function(){},q=(K.prototype.init=function(e){this.setConfig(e);for(var t=0;t<K.installedPlugins.length;t++)try{K.installedPlugins[t].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},K.prototype.setConfig=function(e){Object.assign(this.config,e);var t=(a=this.config).id,n=a.uin,i=a.version,o=a.ext1,r=a.ext2,s=a.ext3,a=(e=a.aid,this.bean.id!==t||this.bean.uin!==n||this.bean.aid!==e);return this.bean.id=t||"",this.bean.uin=n||"",this.bean.version=i||"1.34.60",this.bean.aid=e||"",o&&(this.bean.ext1=o),r&&(this.bean.ext2=r),s&&(this.bean.ext3=s),a&&this.lifeCycle.emit("onConfigChange",this.config),this.config},K.use=function(e){-1===K.installedPlugins.indexOf(e)&&e.aegisPlugin&&K.installedPlugins.push(e)},K.unuse=function(e){-1!==(e=K.installedPlugins.indexOf(e))&&K.installedPlugins.splice(e,1)},K.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:m.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:m.INFO}),this.normalLogPipeline(n)},K.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:m.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:m.INFO_ALL}),this.normalLogPipeline(n)},K.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:m.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0])),this.normalLogPipeline(n)},K.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:m.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:m.ERROR}),this.normalLogPipeline(n)},K.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},K.prototype.reportPv=function(e){var t,n=this;e&&(console.warn("reportPv is deprecated, please use reportEvent"),t=""+Object.getOwnPropertyNames(this.bean).filter((function(e){return"id"!==e})).map((function(e){return e+"="+n.bean[e]})).join("&"),this.send({url:this.config.url+"/"+e+"?"+t,addBean:!1,type:v.CUSTOM_PV},(function(){}),(function(e){"403 forbidden"===e&&n.destroy()})))},K.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},K.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},K.prototype.reportT=function(e){var t=e.name,n=e.duration,i=void 0===(o=e.ext1)?"":o,o=void 0===(r=e.ext2)?"":r,r=void 0===(r=e.ext3)?"":r;e=e.from;if("string"==typeof t&&"number"==typeof n&&"string"==typeof i&&"string"==typeof o&&"string"==typeof r){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,i,o,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},K.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},K.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},K.prototype.submitCustomTime=function(e,t,n,i,o,r){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:i||this.config.ext2,ext3:o||this.config.ext3,from:r||void 0})},K.prototype.extendBean=function(e,t){this.bean[e]=t},K.prototype.send=function(e,t,n){var i,o,r,s=this;x([(o=e.type,function(e,t){if(!e)return t(e);e=Array.isArray(e)?e:[e],i.lifeCycle.emit("beforeRequest",e);var n=i.config.beforeRequest;(e="function"==typeof n?e.filter((function(e){return!1!==n({logs:e,logType:o})})):e).length&&t(e)}),function(i,o){s.request(e,(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];o({isErr:!1,result:n,logType:e.type,logs:i}),null==t||t.apply(void 0,n)}),(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];o({isErr:!0,result:t,logType:e.type,logs:i}),null==n||n(t)}))},(r=i=this,function(e,t){r.lifeCycle.emit("afterRequest",e);var n=r.config.afterRequest;"function"==typeof n&&!1===n(e)||t(e)})])(e.log)},K.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},K.prototype.sendSDKError=function(e){this.send({url:this.config.url+"?id=1085&msg[0]="+encodeURIComponent(b(e))+"&level[0]=2&from="+this.config.id+"&count=1&version="+this.config.id+"(1.34.60)",addBean:!1,method:"get",type:v.SDK_ERROR})},K.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,i=K.instances.indexOf(this);-1!==i&&K.instances.splice(i,1);for(var o=K.installedPlugins.length-1;0<=o;o--)try{var r=K.installedPlugins[o];r.unpatch(this),0===r.countInstance()&&(r.uninstall(),K.unuse(r),r=null)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach((function(e){n[e].writable&&(t[e]=null)})),Object.setPrototypeOf(this,null);else{for(var s=this;s.constructor!==Object&&P(s,this),s=Object.getPrototypeOf(s););0===K.instances.length&&(P(e=Object.getPrototypeOf(this).constructor),P(K))}},K.instances=[],K.LOG_TYPE=m,K.installedPlugins=[],K),D=(Q.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},Q.prototype.unpatch=function(e){-1!==(e=this.instances.indexOf(e))&&this.instances.splice(e,1)},Q.prototype.countInstance=function(){return this.instances.length},Q.prototype.uninstall=function(){var e;null===(e=null===(e=this.option)||void 0===e?void 0:e.destroy)||void 0===e||e.apply(this)},Q.prototype.walk=function(e){var t=this;this.instances.forEach((function(n){var i=t.canUse(n);i&&e(n,i)}))},Q.prototype.canUse=function(e){return!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},Q.prototype.getConfig=function(e){return null===(e=e.config)||void 0===e?void 0:e[this.name]},Q.prototype.exist=function(e){return-1===this.instances.indexOf(e)},Q.prototype.triggerInit=function(e){var t;this.inited||(this.inited=!0,null===(t=null===(t=this.option)||void 0===t?void 0:t.init)||void 0===t||t.call(this.option,this.getConfig(e)))},Q.prototype.triggerOnNewAegis=function(e){var t;null===(t=null===(t=this.option)||void 0===t?void 0:t.onNewAegis)||void 0===t||t.call(this.option,e,this.getConfig(e))},Q),H=new D({name:"aid",aid:"",init:function(e){try{var t=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),window.localStorage.setItem("AEGIS_ID",t)),this.aid=t}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),M=function(e){if(e.payload){var t={};return Object.keys(e).forEach((function(n){"payload"!==n&&(t[n]=e[n])})),t}return e},B=new D({name:"reportAssetSpeed"}),V=B=new D({name:"reportAssetSpeed",collectCur:0,ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],onNewAegis:function(e){var t=this;C()&&(this.collectSuccLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){t.collectCur=0,performance.clearResourceTimings()})},publish:function(e){this.$walk((function(t){t.speedLogPipeline(e)}))},collectSuccLog:function(e){function t(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];-1!==o.ASSETS_INITIATOR_TYPE.indexOf(i.initiatorType)&&-1===i.name.indexOf("cdn-go.cn/aegis/aegis-sdk")&&o.publish(o.generateLog(i,r))}}var n,i,o=this,r=e.config;"function"==typeof window.PerformanceObserver?(t(performance.getEntriesByType("resource")),(n=new window.PerformanceObserver((function(e){t(e.getEntries())}))).observe({entryTypes:["resource"]}),e.lifeCycle.on("destroy",(function(){0===B.countInstance()&&n.disconnect()}))):(i=setInterval((function(){var e=performance.getEntriesByType("resource"),n=e.slice(o.collectCur);o.collectCur=e.length,t(n)}),3e3),e.lifeCycle.on("destroy",(function(){0===B.countInstance()&&clearInterval(i)})))},collectFailLog:function(e){function t(e){var t,o;e&&(e=e.target||e.srcElement,t=(null==e?void 0:e.src)||(null==e?void 0:e.href),e=null==e?void 0:e.tagName,t&&"string"==typeof t&&("IMG"===e&&-1<window.location.href.indexOf(t)||(e="function"==typeof(null===(e=i.api)||void 0===e?void 0:e.resourceTypeHandler)?null===(o=i.api)||void 0===o?void 0:o.resourceTypeHandler(t):"",o=performance.getEntriesByType("resource").find((function(e){return e.name===t})),e={url:f(t),status:400,duration:Number(((null==o?void 0:o.duration)||0).toFixed(2)),method:"get",type:e||"static",isHttps:d(t),urlQuery:f(t,!0),domainLookup:0,connectTime:0},n.publish(e))))}var n=this,i=e.config;window.document.addEventListener("error",t,!0),e.lifeCycle.on("destroy",(function(){0===B.countInstance()&&window.document.removeEventListener("error",t,!0)}))},generateLog:function(e,t){var n,i="function"==typeof(null===(n=t.api)||void 0===n?void 0:n.resourceTypeHandler)?null===(i=t.api)||void 0===i?void 0:i.resourceTypeHandler(e.name):"";return{url:f(e.name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:i||"static",isHttps:d(e.name),urlQuery:f(e.name,!0),domainLookup:l(e.domainLookupEnd-e.domainLookupStart),connectTime:l(e.connectEnd-e.connectStart)}},destroy:function(){this.option.publish=function(){}}}),X=!1,W=[],G=!1,J=[],$=(new D({name:"reportApiSpeed"}),new D({name:"reportApiSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideFetch(e.config),this.overrideXhr(e.config))},overrideFetch:function(e){var t=this,n={name:this.name,then:function(n,i,o,r){var a,u,c,l={url:n.url,isHttps:d(n.url),method:(null==r?void 0:r.method)||"get",duration:i,type:"fetch",status:n.status||0};"fetch"!==(c="function"==typeof(null===(a=e.api)||void 0===a?void 0:a.resourceTypeHandler)?null===(u=e.api)||void 0===u?void 0:u.resourceTypeHandler(n.url):c)&&"static"!==c&&(u=n.headers?n.headers.get("content-type"):"",c=n.ok&&"string"==typeof u&&p(u)?"static":"fetch"),"fetch"===c?n.clone().text().then((function(s){var a,u,c,f,d="req url: "+o+" \n                                \nreq method: "+((null==r?void 0:r.method)||"get")+" \n                                \nreq param: "+g(null==r?void 0:r.body)+" \n                                \nres duration: "+i+" \n                                \nres status: "+(n.status||0)+" \n                                \nres data: "+s;t.publishNormalLog({msg:d,level:m.API_RESPONSE}),l.payload=new O(n,s),("function"==typeof(null===(a=e.api)||void 0===a?void 0:a.retCodeHandler)?(f=(c=e.api.retCodeHandler(s,n.url,n)||{}).code,u=c.isErr,l.ret=f,u):(c=h(s,e.api),l.ret=c,s=(s=null===(u=e.api)||void 0===u?void 0:u.errCode)&&[].concat(s),f=(f=null===(u=e.api)||void 0===u?void 0:u.code)&&[].concat(f),s&&-1!==s.indexOf(c)||f&&-1===f.indexOf(c)||!s&&!f&&"0"!==c&&"unknown"!==c))&&t.publishNormalLog({msg:d,level:m.RET_ERROR})})):Object.assign(l,{type:"static",urlQuery:f(n.url,!0),domainLookup:s.number,connectTime:s.number}),t.publishSpeed(l)},catch:function(e,n,i,o){var r={url:i,isHttps:d(i),method:(null==o?void 0:o.method)||"get",duration:n,type:"fetch",status:0};throw t.publishSpeed(r),o="AJAX_ERROR: "+e+"\n                          \nres status: 0\n                          \nres duration: "+n+"\n                          \nreq url: "+i+"\n                          \nreq method: "+((null==o?void 0:o.method)||"get")+"\n                          \nreq param: "+g(null==o?void 0:o.body),t.publishNormalLog({msg:o,level:m.AJAX_ERROR}),e}};this.hackFetchOptions=n,function(e){if(J.find((function(t){return t.name===e.name})))throw new Error("name '"+e.name+"' is already in hackFetch option list");var t;J.push(e),!G&&window.fetch&&(G=!0,t=window.fetch,window.fetch=function(e,n){void 0===n&&(n={});for(var i="string"==typeof e?e:e.url,o=0;o<J.length;o++){var r=J[o];try{"function"==typeof r.beforeFetch&&r.beforeFetch(i,n)}catch(e){}}var s=Date.now();return t(e,n).then((function(e){for(var t=0;t<J.length;t++){var o=J[t];try{"function"==typeof o.then&&o.then(e,Date.now()-s,i,n)}catch(e){}}return e})).catch((function(e){for(var t=0;t<J.length;t++){var o=J[t];try{"function"==typeof o.catch&&o.catch(e,Date.now()-s,i,n)}catch(e){}}throw e}))})}(this.hackFetchOptions)},getRequestType:function(e,t,n){var i,o="function"==typeof(null===(i=e.api)||void 0===i?void 0:i.resourceTypeHandler)?null===(o=e.api)||void 0===o?void 0:o.resourceTypeHandler(n):"";return"fetch"!==o&&"static"!==o&&(n=t.getResponseHeader("content-type"),o=400<=t.status||"string"!=typeof n||!p(n)?"fetch":"static"),o},overrideXhr:function(e){var t=this,n={name:this.name,send:function(n,i){var o=Date.now();n.addEventListener("loadend",(function(){var r,a,u,c=n.aegisUrl;if(c){var l=Date.now()-o,p={url:c,isHttps:d(c),status:n.status||0,method:n.aegisMethod||"get",type:"fetch",duration:l,payload:new E(n)};if("fetch"===t.getRequestType(e,n,c))try{var v,y,w,b,O,R="req url: "+c+" \n                                \nreq method: "+p.method+" \n                                \nreq param: "+g(i)+" \n                                \nres duration: "+l+" \n                                \nres status: "+p.status+" \n                                \nres data: "+g(n.response);t.publishNormalLog({msg:R,level:m.API_RESPONSE,trace:n.aegisTjgTrace}),("function"==typeof(null===(r=e.api)||void 0===r?void 0:r.retCodeHandler)?(O=(v=e.api.retCodeHandler(n.response,c,n)||{}).code,y=v.isErr,p.ret=O,y):(w=h(n.response,e.api),p.ret=w,b=(b=null===(a=e.api)||void 0===a?void 0:a.errCode)&&[].concat(b),O=(O=null===(u=e.api)||void 0===u?void 0:u.code)&&[].concat(O),b&&-1!==b.indexOf(w)||O&&-1===O.indexOf(w)||!b&&!O&&"0"!==w&&"unknown"!==w))&&t.publishNormalLog({msg:R,level:m.RET_ERROR})}catch(r){p.ret="unknown"}else Object.assign(p,{type:"static",urlQuery:f(c,!0),domainLookup:s.number,connectTime:s.number});t.publishSpeed(p)}}))}};this.hackXHROptions=n,I(this.hackXHROptions)},publishSpeed:function(e){var t=this;e.url=f(e.url),this.$walk((function(n){var i=t.$getConfig(n);"fetch"===e.type&&i&&"function"==typeof i.urlHandler?n.speedLogPipeline(o(o({},e),{url:encodeURIComponent(i.urlHandler(e.url,e.payload))})):n.speedLogPipeline(e)}))},publishNormalLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},destroy:function(){var e,t;this.option.publishSpeed=function(){},this.option.publishNormalLog=function(){},this.option.hackXHROptions&&A(this.option.hackXHROptions),this.option.hackFetchOptions&&(e=this.option.hackFetchOptions,-1!==(t=J.findIndex((function(t){return t.name===e.name})))&&J.splice(t,1))}}));function Q(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function K(e){var t,n,i,o,r,s,u,c,l,f,d,p,h,g=this;this.config={version:0,delay:1e3,onError:!0,repeat:5,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,hostUrl:"https://aegis.qq.com",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:""},this.isWhiteList=!1,this.lifeCycle=new a,this.bean={},this.normalLogPipeline=x([S(this,5),T,function(e,n){if("number"!=typeof t.config.random&&(console.warn("random must in [0, 1], default is 1."),t.config.random=1),Math.random()<t.config.random)return n(e)},(p=(t=this).config,h={},function(e,t){var n="number"==typeof p.repeat?p.repeat:5;if(0===n)return t(e);t(e.filter((function(e){return e.level!==m.ERROR&&e.level!==m.PROMISE_ERROR&&e.level!==m.AJAX_ERROR&&e.level!==m.SCRIPT_ERROR&&e.level!==m.IMAGE_ERROR&&e.level!==m.CSS_ERROR&&e.level!==m.MEDIA_ERROR||(h[e.msg]=h[e.msg]||0,h[e.msg]+=1,!(h[e.msg]>n))})))}),(f=this.lifeCycle.emit,d=this.config,function(e,t){var n=d.logCreated;return"function"!=typeof n?(f("beforeWrite",e),t(e)):(e=e.filter((function(e){return!1!==n(e)})),f("beforeWrite",e),t(e))}),(l=this,setTimeout((function(){var e;(e=void 0===(e=l.config.pvUrl)?"":e)&&l.send({url:e,type:v.PV},(function(){}),(function(e){"403 forbidden"===e&&l.destroy()}))}),100),function(e,t){t(e)}),(u=s=r=!1,c=[],(i=this).lifeCycle.on("onConfigChange",(function(){o&&clearTimeout(o),o=setTimeout((function(){var e;!u&&i.config&&(u=!0,(e=void 0===(e=i.config.whiteListUrl)?"":e)&&i.send({url:e,type:v.WHITE_LIST},(function(e){s=!0;try{var t=e.data||JSON.parse(e),n=t.retcode,o=t.result,a=void 0===o?{}:o;if(0===n){if(r=a.is_in_white_list,i.isWhiteList=r,a.shutdown)return void i.destroy();0<=a.rate&&a.rate<=1&&(i.config.random=a.rate)}i.isWhiteList&&c.length?U(i)(c.splice(0),(function(){})):!i.isWhiteList&&c.length&&(c.length=0);var u=i.config.onWhitelist;"function"==typeof u&&u(r)}catch(e){}}),(function(e){"403 forbidden"===e&&i.destroy(),s=!0})),u=!1)}),i.config.uin?50:500)})),i.lifeCycle.on("destroy",(function(){c.length=0})),function(e,t){r?t(e.concat(c.splice(0)).map((function(e){return j(e),e}))):(e=e.filter((function(e){return e.level!==m.INFO&&e.level!==m.API_RESPONSE?(j(e),!0):(s||(c.push(e),200<=c.length&&(c.length=200)),!1)}))).length&&t(e)}),function(e,t){var n=JSON.parse(JSON.stringify(e));g.lifeCycle.emit("beforeReport",n);var i=g.config.beforeReport;(e="function"==typeof i?e.filter((function(e){return!1!==i(e)})):e).length&&t(e)},U(this)]),this.eventPipeline=x([S(this,5),function(e){var t=e.map((function(e){return{name:e.name,ext1:e.ext1||g.config.ext1||"",ext2:e.ext2||g.config.ext2||"",ext3:e.ext3||g.config.ext3||""}}));return g.send({url:g.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(t)),type:v.EVENT,log:e},(function(){}),(function(e){"403 forbidden"===e&&g.destroy()}))}]),this.timeMap={},this.customTimePipeline=x([S(this,5),function(e){return g.send({url:g.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:v.CUSTOM,log:e},(function(){}),(function(e){"403 forbidden"===e&&g.destroy()}))}]),this.config=(n=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),n.url=n.url||e+"/collect",n.offlineUrl=n.offlineUrl||e+"/offline",n.whiteListUrl=n.whiteListUrl||e+"/collect/whitelist",n.pvUrl=n.pvUrl||e+"/collect/pv",n.eventUrl=n.eventUrl||e+"/collect/events",n.speedUrl=n.speedUrl||e+"/speed",n.customTimeUrl=n.customTimeUrl||e+"/speed/custom",n.performanceUrl=n.performanceUrl||e+"/speed/performance",n.webVitalsUrl=n.webVitalsUrl||e+"/speed/webvitals",n),K.instances.push(this)}(xe=N=N||{})[xe.unknown=100]="unknown",xe[xe.wifi=1]="wifi",xe[xe.net2g=2]="net2g",xe[xe.net3g=3]="net3g",xe[xe.net4g=4]="net4g",xe[xe.net5g=5]="net5g",xe[xe.net6g=6]="net6g",(Ae=k=k||{})[Ae.android=1]="android",Ae[Ae.ios=2]="ios",Ae[Ae.windows=3]="windows",Ae[Ae.macos=4]="macos",Ae[Ae.linux=5]="linux",Ae[Ae.other=100]="other";var Y,Z,z,ee,te,ne,ie,oe,re,se=new D({name:"device",onNewAegis:function(e){e.extendBean("platform",this.getPlatform()),e.extendBean("netType",N.unknown),this.refreshNetworkTypeToBean(e)},getPlatform:function(){var e={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT)/,macos:/\b(Mac OS)/,linux:/\b(Linux)/i},t=Object.keys(e).find((function(t){return e[t].test(navigator.userAgent)}));return t?k[t]:k.other},refreshNetworkTypeToBean:function(e){var t=this,n=e.config;n&&("function"==typeof n.getNetworkType?n.getNetworkType:ae)((function(n){N[n]||(n=N.unknown),e.extendBean("netType",n),t.NetworkRefreshTimer=setTimeout((function(){t.refreshNetworkTypeToBean(e),clearTimeout(t.NetworkRefreshTimer)}),1e4)}))}}),ae=function(e){var t="",n=navigator.userAgent.match(/NetType\/(\w+)/);n?t=n[1]:navigator.connection&&(t=navigator.connection.effectiveType||navigator.connection.type),e((t=t=t||"unknown",0<=(t=String(t).toLowerCase()).indexOf("4g")?N.net4g:0<=t.indexOf("wifi")?N.wifi:0<=t.indexOf("5g")?N.net5g:0<=t.indexOf("6g")?N.net6g:0<=t.indexOf("3g")?N.net3g:0<=t.indexOf("2g")?N.net2g:N.unknown))},ue=new D({name:"onError"}),ce=ue=new D({name:"onError",onNewAegis:function(e){this.startListen(e)},startListen:function(e){var t=this,n=window.onerror;function i(e){e=e&&b(e.reason),t.publishErrorLog({msg:"PROMISE_ERROR: "+e,level:m.PROMISE_ERROR})}function o(e){if(e=(null==e?void 0:e.target)||(null==e?void 0:e.srcElement)){var n=e.src||e.href;e=e.tagName;if("string"==typeof n&&e){var i={msg:e+" load fail: "+n,level:m.INFO};switch(e.toLowerCase()){case"script":i.level=m.SCRIPT_ERROR;break;case"link":i.level=m.CSS_ERROR;break;case"img":if(-1<window.location.href.indexOf(n))return;i.level=m.IMAGE_ERROR;break;case"audio":case"video":i.level=m.MEDIA_ERROR;break;default:return}t.publishErrorLog(i)}}}window.onerror=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.publishErrorLog({msg:(b(e[0])||"")+" @ ("+(b(e[1])||"")+":"+(e[2]||0)+":"+(e[3]||0)+")\n          \n"+b(e[4]||""),level:m.ERROR}),null==n||n.call.apply(n,function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)i[o]=r[s];return i}([window],e))},window.addEventListener("unhandledrejection",i),window.document.addEventListener("error",o,!0),e.lifeCycle.on("destroy",(function(){0===ue.countInstance()&&(window.document.removeEventListener("unhandledrejection",i),window.document.removeEventListener("error",o,!0))}));var r=this;e={name:this.name,send:function(e,t){e.addEventListener("loadend",(function(){var n="";this.aegisTimeout?n="timeout":this.status?400<=this.status&&(n="error"):n="failed",n&&r.publishErrorLog({msg:"AJAX_ERROR: request "+n+"\n                      \nres status: "+(this.status||0)+"\n                      \nres duration: "+(Date.now()-e.aegisXhrStartTime)+"\n                      \nreq url: "+this.aegisUrl+"\n                      \nreq method: "+this.aegisMethod+"\n                      \nreq param: "+g(t)+"\n                      \nres data: "+(null===(n=(n=e).responseType&&"text"!==n.responseType?"":n.responseText)||void 0===n?void 0:n.slice(0,1e3)),level:m.AJAX_ERROR})})),e.addEventListener("timeout",(function(){e.aegisTimeout=!0}))}};this.hackXHROptions=e,I(this.hackXHROptions)},publishErrorLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},destroy:function(){this.option.publishErrorLog=function(){},this.option.hackXHROptions&&A(this.option.hackXHROptions)}}),le=(new D({name:"pagePerformance"}),1),fe=new D({name:"pagePerformance",onNewAegis:function(e){var t=this;if(C())if(Y)this.publish(Y,e);else try{this.getFirstScreenTiming(e,(function(n){var i,o=performance.timing;o&&(i=o.loadEventStart-o.domInteractive,Y={dnsLookup:o.domainLookupEnd-o.domainLookupStart,tcp:o.connectEnd-o.connectStart,ssl:0===o.secureConnectionStart?0:o.requestStart-o.secureConnectionStart,ttfb:o.responseStart-o.requestStart,contentDownload:o.responseEnd-o.responseStart,domParse:o.domInteractive-o.domLoading,resourceDownload:i=i<0?1070:i,firstScreenTiming:Math.floor(n)},t.publish(Y,e))}))}catch(e){}},publish:function(e,t){var n,i=[];for(n in e)i.push(n+"="+e[n]);var o=this.$getConfig(t);if(o){var r=-1===t.config.performanceUrl.indexOf("?")?"?":"&";return"function"==typeof o.urlHandler?t.send({url:t.config.performanceUrl+r+i.join("&")+"&from="+(encodeURIComponent(o.urlHandler())||window.location.href),beanFilter:["from"],type:v.PERFORMANCE,log:e}):t.send({url:t.config.performanceUrl+r+i.join("&"),type:v.PERFORMANCE,log:e})}},getFirstScreenTiming:function(e,t){var n=["script","style","link","br"],i=[],o=this,r={},s=new MutationObserver((function(e){var t={roots:[],rootsDomNum:[],time:performance.now()};e.forEach((function(e){e&&e.addedNodes&&e.addedNodes.forEach&&e.addedNodes.forEach((function(e){1===e.nodeType&&(e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")||e.querySelector("[AEGIS-FIRST-SCREEN-TIMING]"))?(Object.prototype.hasOwnProperty.apply(r,[t.time])||(r[t.time]=[]),r[t.time].push(e)):1!==e.nodeType||-1!==n.indexOf(e.nodeName.toLocaleLowerCase())||o.isEleInArray(e,t.roots)||e.hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(t.roots.push(e),t.rootsDomNum.push(o.walkAndCount(e)||0))}))})),t.roots.length&&i.push(t)}));s.observe(document,{childList:!0,subtree:!0});var a=function(){var n=0,u=0,c=Object.keys(r).filter((function(e){return r[+e].find((function(e){return o.isInFirstScreen(e)}))}));c.length?(u=Math.max.apply(null,c),e.firstScreenInfo={element:null===(c=r[u])||void 0===c?void 0:c[0],timing:u,markDoms:r}):i.forEach((function(t){for(var i=0;i<t.roots.length;i++)t.rootsDomNum[i]>n&&o.isInFirstScreen(t.roots[i])&&(n=t.rootsDomNum[i],u=t.time,e.firstScreenInfo={element:t.roots[i],timing:u})})),!u&&le?setTimeout((function(){return a()}),3e3):(s.disconnect(),null==t||t(u)),--le};setTimeout((function(){return a()}),3e3)},isEleInArray:function(e,t){return!(!e||e===document.documentElement)&&(-1!==t.indexOf(e)||this.isEleInArray(e.parentElement,t))},isInFirstScreen:function(e){if(!e||"function"!=typeof e.getBoundingClientRect)return!1;var t=e.getBoundingClientRect(),n=window.innerHeight;e=window.innerWidth;return 0<=t.left&&t.left<e&&0<=t.top&&t.top<n&&0<t.width&&0<t.height},walkAndCount:function(e){var t=0;if(e&&1===e.nodeType){t+=1;var n=e.children;if(null!=n&&n.length)for(var i=0;i<n.length;i++)t+=this.walkAndCount(n[i])}return t}});function de(){te=[],z=-1,Z=null,ge(addEventListener)}function pe(e,t){Z||(Z=t,z=e,ee=new Date,ge(removeEventListener),he())}function he(){var e;0<=z&&z<ee-ie&&(e={entryType:"first-input",name:Z.type,target:Z.target,cancelable:Z.cancelable,startTime:Z.timeStamp,processingStart:Z.timeStamp+z},te.forEach((function(t){t(e)})),te=[])}function ge(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,oe,ne)}))}function me(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v1-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}}function ve(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}}function ye(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)}function we(e,t,n){var i;return function(){0<=t.value&&(n||Se.has(t)||"hidden"===document.visibilityState)&&(t.delta=t.value-(i||0),!t.delta&&void 0!==i||(i=t.value,e(t)))}}function be(){Le((function(e){e=e.timeStamp,Te=e}),!0)}function Ee(){return Te<0&&((Te=self.webVitals.firstHiddenTime)===1/0&&be(),ye((function(){setTimeout((function(){Te="hidden"===document.visibilityState?0:1/0,be()}),0)}))),{get timeStamp(){return Te}}}ne={passive:!0,capture:!0},ie=new Date,oe=function(e){var t,n,i,o;function r(){pe(n,i),o()}function s(){o()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,i=e,o=function(){removeEventListener("pointerup",r,ne),removeEventListener("pointercancel",s,ne)},addEventListener("pointerup",r,ne),addEventListener("pointercancel",s,ne)):pe(t,e))},re="hidden"===document.visibilityState?0:1/0,addEventListener("visibilitychange",(function e(t){"hidden"===document.visibilityState&&(re=t.timeStamp,removeEventListener("visibilitychange",e,!0))}),!0),de(),self.webVitals={firstInputPolyfill:function(e){te.push(e),he()},resetFirstInputPolyfill:de,get firstHiddenTime(){return re}};var Oe,Re,Le=function(e,t){function n(i){"pagehide"!==i.type&&"hidden"!==document.visibilityState||(e(i),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))}addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},Se=new("function"==typeof WeakSet?WeakSet:Set),Te=-1,xe=(new D({name:"webVitals"}),new D({name:"webVitals",onNewAegis:function(e){if(C()&&"function"==typeof window.PerformanceObserver)try{v=this.publish.bind(this,e),w=Ee(),b=me("FCP"),E=performance.getEntriesByName("first-contentful-paint")[0],O=E?null:ve("paint",S),(E||O)&&(y=we(v,b,void 0),E&&S(E),ye((function(e){b=me("FCP"),y=we(v,b,void 0),requestAnimationFrame((function(){requestAnimationFrame((function(){b.value=performance.now()-e.timeStamp,Se.add(b),y()}))}))}))),f=this.publish.bind(this,e),h=Ee(),g=me("LCP"),(m=ve("largest-contentful-paint",L))&&(d=we(f,g,void 0),p=function(){Se.has(g)||(m.takeRecords().map(L),m.disconnect(),Se.add(g),d())},["keydown","click"].forEach((function(e){addEventListener(e,p,{once:!0,capture:!0})})),Le(p,!0),ye((function(e){g=me("LCP"),d=we(f,g,void 0),requestAnimationFrame((function(){requestAnimationFrame((function(){g.value=performance.now()-e.timeStamp,Se.add(g),d()}))}))}))),s=this.publish.bind(this,e),a=Ee(),u=me("FID"),c=ve("first-input",R),l=we(s,u,void 0),c&&Le((function(){c.takeRecords().map(R),c.disconnect()}),!0),c||window.webVitals.firstInputPolyfill(R),ye((function(){u=me("FID"),l=we(s,u,void 0),window.webVitals.resetFirstInputPolyfill(),window.webVitals.firstInputPolyfill(R)})),n=this.publish.bind(this,e),o=me("CLS",0),(r=ve("layout-shift",t))&&(i=we(n,o,void 0),Le((function(){r.takeRecords().map(t),i()})),ye((function(){o=me("CLS",0),i=we(n,o,void 0)})))}catch(e){}function t(e){e.hadRecentInput||(o.value+=e.value,o.entries.push(e),i())}var n,i,o,r,s,a,u,c,l,f,d,p,h,g,m,v,y,w,b,E,O;function R(e){e.startTime<a.timeStamp&&(u.value=e.processingStart-e.startTime,u.entries.push(e),Se.add(u),l())}function L(e){var t=e.startTime;t<h.timeStamp&&(g.value=t,g.entries.push(e)),d()}function S(e){"first-contentful-paint"===e.name&&(O&&O.disconnect(),e.startTime<w.timeStamp&&(b.value=e.startTime,b.entries.push(e),Se.add(b),y()))}},publish:function(e,t){var n,i={FCP:-1,LCP:-1,FID:-1,CLS:-1},o=t.name,r=t.value,s=[];for(n in i)s.push(n+"="+(n===o?r:i[n]));var a=-1===e.config.performanceUrl.indexOf("?")?"?":"&";setTimeout((function(){e.send({url:e.config.webVitalsUrl+a+s.join("&"),type:v.VITALS,log:t})}))},destroy:function(){this.option.publish=function(){}}})),Pe=0,Ce=(i(Re=Ne,Ae=Oe=q),Re.prototype=null===Ae?Object.create(Ae):(ke.prototype=Ae.prototype,new ke),Ne.prototype.getBean=function(e){var t=this;return void 0===e&&(e=[]),""+Object.getOwnPropertyNames(this.bean).filter((function(t){return-1===e.indexOf(t)})).map((function(e){return e+"="+t.bean[e]})).join("&")},Ne.prototype.request=function(e,t,n){var i=this;if(e&&"string"==typeof e.url&&""!==e.url&&this.bean.id)if(this.requesting)this.requestQueue.push({options:e,success:t,fail:n});else{this.requesting=!0;var o=e.url;!1!==e.addBean&&(o=o+(-1===o.indexOf("?")?"?":"&")+this.getBean(e.beanFilter)),e.url=o;var r=e.method||"get";if(!(e=(o=this.config.onBeforeRequest)?o(e,this):e))return console.log("Sending request blocked");if(!e.url)return console.warn("Please handle the parameters reasonably, options.url is necessary");var s=new XMLHttpRequest;s.sendByAegis=!0,s.addEventListener("readystatechange",(function(){var e;4===s.readyState&&(i.requesting=!1,i.requestQueue&&((e=i.requestQueue.shift())&&i.request(e.options,e.success,e.fail),400<=s.status||0===s.status?null==n||n(s.response):null==t||t(s.response)))})),"get"===r.toLocaleLowerCase()?(s.open("get",function(e,t){if("string"!=typeof e)return"";if("object"==typeof t&&t){var n=Object.getOwnPropertyNames(t).map((function(e){var n=t[e];return e+"="+("string"==typeof n?encodeURIComponent(n):encodeURIComponent(JSON.stringify(n)))})).join("&").replace(/eval/gi,"evaI");return e+(-1===e.indexOf("?")?"?":"&")+n}return e}(e.url,e.data)),s.send()):(s.open("post",e.url),e.contentType&&s.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),s.send(e.data))}},Ne.useAsyncPlugin=function(e,t){var n,i=void 0===(n=(t=void 0===t?{}:t).exportsConstructor)?"aegis-plugin-"+Pe:n,o=void 0===(n=t.onAegisInit)?function(){}:n,r=void 0===(t=t.onAegisInitAndPluginLoaded)?function(){}:t;if(Pe+=1,"string"!=typeof e)throw new TypeError("useAsyncPlugin first param must be string");if("function"!=typeof o||"function"!=typeof r)throw new TypeError("onAegisInit and onAegisInitAndPluginLoaded must be function");this.use(new D({name:"asyncPlugin",onNewAegis:function(t){try{o(t),Ne.asyncPlugin[e]?r(t,window[Ne.asyncPlugin[e]]):(n=e,s=i,a=function(n){n||(Ne.asyncPlugin[e]=i,n=window[i],r(t,n))},u=document.createElement("script"),c=document.head,"function"==typeof s&&(a=s,s=""),u.src=n,u.setAttribute("name",s),u.name=s,u.setAttribute("crossorigin","anonymous"),u.crossorigin="anonymous",u.defer=!0,u.hasLoaded=!1,u.onreadystatechange=function(){u.hasLoaded||u.readyState&&"loaded"!==u.readyState&&"complete"!==u.readyState||(u.hasLoaded=!0,"function"==typeof a&&a(!1),setTimeout((function(){c.contains(u)&&c.removeChild(u)})))},u.onload=u.onreadystatechange,u.onerror=function(){"function"==typeof a&&a(!0),setTimeout((function(){c.contains(u)&&c.removeChild(u)}))},"complete"===document.readyState?c.appendChild(u):window.addEventListener("load",(function(){c.appendChild(u)})))}catch(n){console.error(n)}var n,s,a,u,c}}))},Ne.prototype.uploadLogs=function(e,t){this.lifeCycle.emit("uploadLogs",e=void 0===e?{}:e,t=void 0===t?{}:t)},Ne.__version__="1.34.60",Ne.sessionID="session-"+Date.now(),Ne.asyncPlugin={},Ne.urls={aegisCollect:"https://aegis.qq.com/collect",flog:"https://cdn-go.cn/vasdev/web_webpersistance_v2/v1.8.1/flog.core.min.js",shadowLog:""},Ne),Ie=new D({name:"offlineLog"}),Ae=(q=Ie=new D({name:"offlineLog",onNewAegis:function(e){var t=Ce.urls.flog,n=e.config,i=[],r=null,s=null,a=function(e){s=e},c=function(e){i=i.concat(e)},l=function(e,t){r={conds:e=void 0===e?{}:e,params:t=void 0===t?{}:t}};Ce.useAsyncPlugin(t,{exportsConstructor:"Flog",onAegisInit:function(e){e.lifeCycle.on("beforeWrite",c),e.lifeCycle.on("uploadLogs",l),e.lifeCycle.on("onConfigChange",a)},onAegisInitAndPluginLoaded:function(e,t){var f,d,p,h,g,y=void 0===(R=n.dbConfig)?{}:R,w=void 0===(L=n.url)?Ce.urls.aegisCollect:L,E=n.offlineLogExp,O=void 0===E?3:E,R=n.id,L=n.uin;null===(E=e.lifeCycle)||void 0===E||E.remove("beforeWrite",c),null===(E=e.lifeCycle)||void 0===E||E.remove("uploadLogs",l),null===(E=e.lifeCycle)||void 0===E||E.remove("onConfigChange",a),y=Object.assign({lookupUrl:w+"/offlineAuto?id="+R,preservedDay:O,id:R,uin:L,aid:(null===(L=e.bean)||void 0===L?void 0:L.aid)||"",beforeRequest:e.config.beforeRequest,afterRequest:e.config.afterRequest},y,{sessionId:Ce.sessionID});try{var S=new t(y);i.forEach((function(e){S.add(o(o({},e),{level:e.level===m.INFO_ALL?m.INFO:e.level}))})),null===(f=e.lifeCycle)||void 0===f||f.on("beforeWrite",(function(e){(e=void 0===e?[]:e).forEach((function(e){S.add(o(o({},e),{level:e.level===m.INFO_ALL?m.INFO:e.level}))}))})),null===(d=e.lifeCycle)||void 0===d||d.on("uploadLogs",(function(t,i){var o;void 0===t&&(t={}),void 0===i&&(i={}),S.uploadLogs(Object.assign({id:n.id,uin:n.uin,aid:null===(o=e.bean)||void 0===o?void 0:o.aid},t),i)})),null===(p=e.lifeCycle)||void 0===p||p.on("onConfigChange",(function(e){S.setConfig(e)})),null===(h=e.lifeCycle)||void 0===h||h.on("destroy",(function(){0===Ie.countInstance()&&(i.length=0,"function"==typeof((r=null)==S?void 0:S.destroy)&&S.destroy())})),S.on("PERREVENT",(function(t){e.send({type:v.OFFLINE,data:u({msg:b(t),level:m.INFO}),contentType:"application/x-www-form-urlencoded",method:"post",addBean:!1,url:n.url+"?id=893&sessionId="+Ce.sessionID+"&uin="+n.uin+"&from="+n.id+"&count=1&version=1.34.60",log:v.OFFLINE})})),s&&(S.setConfig(s),s=null),r&&(null===(g=e.lifeCycle)||void 0===g||g.emit("uploadLogs",r.conds,r.params),r=null),e.flog=S}catch(e){}}})}}),new D({name:"spa"}),new D({name:"spa",init:function(){history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState;var e=(null===(e=location.href)||void 0===e?void 0:e.split("?"))[0];this.$fireUrl=e,this.sendPv=this.sendPv.bind(this),this.onPageChange()},onPageChange:function(){window.addEventListener("replaceState",this.sendPv),window.addEventListener("pushState",this.sendPv),window.addEventListener("popstate",this.sendPv)},wr:function(e){var t=history[e];return"function"==typeof t&&!history.__hasWrittenByTamSpa&&(Object.defineProperty(history,"__hasWrittenByTamSpa",{value:!0,enumerable:!1}),function(){var n=t.apply(this,arguments),i=null;return"function"==typeof Event?i=new Event(e):(i=document.createEvent("HTMLEvents")).initEvent(e,!1,!0),window.dispatchEvent(i),n})},sendPv:function(){var e=this;setTimeout((function(){var t=location.href,n=(null===(n=location.href)||void 0===n?void 0:n.split("?"))[0];n&&n!==e.$fireUrl&&(e.$walk((function(e){e.send({url:e.config.pvUrl+"?from="+encodeURIComponent(t),beanFilter:["from"],type:v.WHITE_LIST})})),e.$fireUrl=n)}),0)},destroy:function(){window.removeEventListener("replaceState",this.option.sendPv),window.removeEventListener("pushState",this.option.sendPv),window.removeEventListener("popstate",this.option.sendPv)}}));function Ne(e){var t,n,i,r,s,a=Oe.call(this,e)||this;a.requestQueue=[],a.requesting=!1,a.speedLogPipeline=x([(r=a.config,s={},function(e,t){var n,i;r.speedSample?(i="object"==typeof r.repeat?r.repeat:{repeat:r.repeat},n=+i.speed||+i.repeat||5,Array.isArray(e)?(i=e.filter((function(e){var t=!s[e.url]||s[e.url]<n;return s[e.url]=1+~~s[e.url],t}))).length&&t(i):(!s[e.url]||s[e.url]<n)&&(s[e.url]=1+~~s[e.url],t(e))):t(e)}),S(a),(i=a,function(e,t){ae((function(n){i.extendBean("netType",n),t(e)}))}),function(e,t){a.lifeCycle.emit("beforeReportSpeed",e);var n=a.config.beforeReportSpeed;if((e="function"==typeof n?e.filter((function(e){var t=!1!==n(e);return"fetch"===e.type&&void 0===e.ret&&e.payload&&(e.ret=h(e.payload.data.response,a.config.api)),t})):e).length)return t(e)},function(e){return a.send({type:v.SPEED,url:""+a.config.speedUrl,method:"post",data:(t=e,n=a.bean,r={fetch:[],static:[]},s=new FormData,Array.isArray(t)?t.forEach((function(e){var t=M(e);r[e.type].push(t)})):(i=M(t),r[t.type].push(i)),s.append("payload",JSON.stringify(o({duration:r},n))),s),log:e});var t,n,i,r,s}]),e.asyncPlugin=!0;try{"undefined"!=typeof document&&(e.uin=e.uin||(null!==(t=document.cookie.match(/\buin=\D+(\d*)/))&&void 0!==t?t:[])[1]||(null!==(n=document.cookie.match(/\bilive_uin=\D*(\d+)/))&&void 0!==n?n:[])[1]||""),a.init(e),a.extendBean("sessionId",Ne.sessionID),a.extendBean("from",encodeURIComponent(e.pageUrl||location.href)),"undefined"!=typeof document&&a.extendBean("referer",encodeURIComponent(document.referrer||"")),e.ext1&&a.extendBean("ext1",e.ext1),e.ext2&&a.extendBean("ext2",e.ext2),e.ext3&&a.extendBean("ext3",e.ext3)}catch(e){console.warn(e),a.sendSDKError(e)}return a}function ke(){this.constructor=Re}return new D({name:"ie"}),Ce.use(ce),Ce.use($),Ce.use(V),Ce.use(fe),Ce.use(xe),Ce.use(H),Ce.use(se),Ce.use(q),Ce.use(Ae),Ce})),function(){const e=window.AppConfig&&"weocom"===window.AppConfig.normal.domain;window.Aegis&&(window.aegis=new window.Aegis({id:e?"bAUrIUljPGUFhElEGs":"ZvszvAcZ0904dranDh",uin:window.global_multi_user&&window.global_multi_user.uid||window.clientVars&&window.clientVars.userInfo&&window.clientVars.userInfo.uid||function(e){var t=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),n="";return window.document&&(n=document.cookie.match(t)),n?decodeURIComponent(n[1]):""}("uid")||"10000",version:window.__globalReleaseVersion,reportApiSpeed:!1,reportAssetSpeed:!0,speedSample:!1,beforeRequest:function(t){return e?"custom"===t.logType?(window.aegis.extendBean("from","https://doc.weixin.qq.com/sheet"),t):void 0:t}}))}();