self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["spread-sheet_src_core_feature_bootstrap_ts"],{"../spread-sheet/src/core/feature/bootstrap.ts":function(e,t,n){var r=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),a=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/@tencent/containerized/build/main/index.js")),o=n("../spread-sheet/src/flow/common/initialization.ts"),s=n("../spread-sheet/src/core/feature/copyPaste/copyPaste2.ui.ts"),i=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((r=r.apply(e,t||[])).next())}))};(0,o.Ch)(s.ICopyPaste,function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.getModule=function(){return i(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,"../spread-sheet/src/core/feature/copyPaste/copyPaste2.ui.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},t}(a.RU))},"../spread-sheet/src/core/feature/copyPaste/copyPaste2.ui.ts":function(e,t,n){n.r(t),n.d(t,{ICopyPaste:function(){return l.yM},default:function(){return mt},isChromeAndSupportClipboardApi:function(){return ut},isChromeAndSupportCopyMultiData:function(){return dt},mapFromApp:function(){return ft}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/esnext.reflect.metadata.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.object.assign.js");var r=n("../node_modules/i18next/dist/esm/i18next.js"),a=n("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),o=n("../spread-sheet/src/core/feature/copyPaste/lib/ParsePasteHTML.ts"),s=n("../spread-sheet/src/core/feature/copyPaste/clipboardCopy.ui.ts"),i=n("../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/paste-special-api.ts"),l=n("../spread-sheet/src/core/feature/copyPaste/interfaces.ts"),c=n("../spread-sheet/src/core/feature/copyPaste/copyPasteShape.ts"),u=n("../spread-sheet/src/core/feature/copyPaste/copyPasteCache.ts"),d=n("../packages/model/src/cell/CellDataSlot.ts"),p=n("../spread-sheet/src/core/ui/toast/index.ts"),h=n.g.ActiveXObject||"ActiveXObject"in n.g,f=function(){h&&localStorage&&null==localStorage.getItem("ctrl_C_key_copyTip")&&(localStorage.setItem("ctrl_C_key_copyTip","true"),(0,p.hideToast)(),(0,p.showToast)(r.ZP.t("由于IE浏览器限制，只能复制纯文字，不支持复制格式。建议使用Chrome或QQ浏览器。"),void 0,{isNeedBtn:!0,btnText:r.ZP.t("我知道了"),btnTextAfter:"",btnCallBack:function(){(0,p.hideToast)()}}))},v=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),m=n.n(v),g=n("../spread-sheet/src/core/feature/copyPaste/wxCopyPaste.ui.ts"),y=n("../packages/model/src/range/gridRangeUtils.ts"),b=n("../spread-sheet/src/base/util/timer.ts"),P=n("../spread-sheet/src/core/ui/dialog/index.ts"),w=n("../packages/report/src/index.ts"),I=n("../spread-sheet/src/base/config/report.ts"),x=n("../spread-sheet/src/core/feature/copyPaste/lib/parsers/automaticIdentifyLink.ts"),C=(n("../node_modules/core-js/modules/es.array.from.js"),n("../spread-sheet/src/core/feature/copyPaste/utils/mergeRangeUtils.ts")),T=n("../spread-sheet/src/core/utils/selection.ts"),R=n("../spread-sheet/src/core/feature/copyPaste/iconSource.tsx"),k=n("../spread-sheet/src/core/ui/loading/index.ts"),_=n("../spread-sheet/src/base/util/html.ts"),S=(n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../spread-sheet/src/core/feature/copyPaste/utils/loading.ts")),E=n("../spread-sheet/src/core/feature/copyPaste/utils/copy-paste-type-and-source.ts"),A=(n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.array.filter.js"),function(e,t){var n=window.React;if(t)switch(e){case"copy":return n.createElement("p",null,r.ZP.t("图片粘贴不成功。试试"),n.createElement("strong",null,r.ZP.t("单独复制原图")),r.ZP.t("并用"),n.createElement("strong",null,"⌘+V"),r.ZP.t("粘贴。"));case"import":return n.createElement("p",null,r.ZP.t("图片粘贴不成功。试试"),n.createElement("strong",null,r.ZP.t("单独复制原图")),r.ZP.t("并用"),n.createElement("strong",null,"⌘+V"),r.ZP.t("粘贴，或"),n.createElement("strong",null,r.ZP.t("导入表格")),"。");case"save":return n.createElement("p",null,r.ZP.t("图片粘贴不成功。试试"),n.createElement("strong",null,r.ZP.t("单独复制原图")),r.ZP.t("用"),n.createElement("strong",null,"⌘+V"),r.ZP.t("粘贴，或将原图保存到电脑后点击“"),n.createElement("strong",null,r.ZP.t("插入图片")),"”。")}else switch(e){case"copy":return n.createElement("p",null,r.ZP.t("图片粘贴不成功。试试"),n.createElement("strong",null,r.ZP.t("单独复制原图")),r.ZP.t("并用"),n.createElement("strong",null,"Ctrl+V"),r.ZP.t("粘贴。"));case"import":return n.createElement("p",null,r.ZP.t("图片粘贴不成功。试试"),n.createElement("strong",null,r.ZP.t("单独复制原图")),r.ZP.t("并用"),n.createElement("strong",null,"Ctrl+V"),r.ZP.t("粘贴，或"),n.createElement("strong",null,r.ZP.t("导入表格")),"。");case"save":return n.createElement("p",null,r.ZP.t("图片粘贴不成功。试试"),n.createElement("strong",null,r.ZP.t("单独复制原图")),r.ZP.t("用"),n.createElement("strong",null,"Ctrl+V"),r.ZP.t("粘贴，或将原图保存到电脑后点击“"),n.createElement("strong",null,r.ZP.t("插入图片")),"”。")}}),j=n("../spread-sheet/src/core/view/level-2/shape-upload/ShapeUpload.ts"),Z=function(e,t,n){var r="";return 0!==e.length?r=-1!=t.indexOf("urn:schemas-microsoft-com:office:office")?-1!=t.indexOf("urn:schemas-microsoft-com:office:excel")?e&&e.length<=5?A("copy",n):A("import",n):A("copy",n):A("save",n):-1!=t.indexOf("<img")&&-1!=t.indexOf('src="blob:')&&(r=A("save",n)),r},O=function(e){var t=null===e||void 0===e?void 0:e.fileSize;if(t)return-1===t?(0,p.showToast)(r.ZP.t("部分图片粘贴不成功，请重新试试"),void 0,{btnText:r.ZP.t("我知道了"),toolToastCloseTime:5e3}):t>j.VIP_IMG_SIZE_LIMIT?(0,p.showToast)(r.ZP.t("部分图片超出20M，请重新粘贴合适的图片"),void 0,{btnText:r.ZP.t("我知道了"),toolToastCloseTime:5e3}):void 0},D=n("../spread-sheet/src/core/feature/copyPaste/utils/handle-clipboard-string.ts"),L=n("../spread-sheet/src/core/feature/copyPaste/utils/select-range.ts"),F=n("../packages/common-utils/src/index.ts"),M=function(e,t,n,r,a){w.ZP.jank.log({moduleValue:"pasteHandle",actionValue:"analysis",detail:[{isFromOuter:e,preImages:null===t||void 0===t?void 0:t.length,pasteHtmlString:n.length,clipboardContents:r.length,hasImg:a}]})},G=n("../node_modules/@tencent/dui/lib/components/Modal/index.js"),N=n("../packages/model/src/cell/index.ts"),H=n("../packages/model/src/cell/metadata/CustomDataType.ts"),V=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),U=n("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/CollectEngine.ts"),z=n("../spread-sheet/src/core/feature/copyPaste/utils/cellFloatImage.ts"),B=n("../spread-sheet/src/core/feature/relateFormEnt/enterpriseStatus.ts"),W=n("../spread-sheet/src/external/mention-ent/varsSettings.ts"),Y=n("../spread-sheet/src/core/view/level-2/todo-ent/utils.ts"),X=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.string.anchor.js"),n("../node_modules/@tencent/dui/lib/components/Loading/index.js")),q=n("../spread-sheet/src/core/feature/copyPaste/middleware/cell/cellImage.ts"),J=n("../spread-sheet/src/core/feature/copyPaste/utils/url.ts"),K=(n("../node_modules/core-js/modules/es.string.link.js"),n("../spread-sheet/src/core/feature/copyPaste/middleware/index.ts")),Q=n("../spread-sheet/src/core/feature/copyPaste/middleware/interface.ts"),ee=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),te=(n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/core-js/modules/es.number.is-nan.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.string.bold.js"),n("../node_modules/core-js/modules/es.string.italics.js"),n("../node_modules/core-js/modules/es.string.fontsize.js"),n("../node_modules/core-js/modules/es.string.fontcolor.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../packages/model/src/dimension/DimensionProperties.ts")),ne=n("../packages/model/src/cell/ExtendedValueType.ts"),re=n("../packages/model/src/cell/CellData.ts"),ae=n("../packages/model/src/cell/CellFormat.ts"),oe=n("../node_modules/@tencent/tdocs-format-render/lib/index.js"),se=n("../packages/model/src/cell/format/HorizontalAlign.ts"),ie=n("../packages/model/src/cell/format/VerticalAlign.ts"),le=n("../packages/model/src/cell/format/WrapStrategy.ts"),ce=n("../packages/model/src/cell/format/UnderlineType.ts"),ue=n("../spread-sheet/src/core/feature/formula/autofix.ts"),de=n("../packages/model/src/cell/ExtendedValue.ts"),pe=n("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),he=n("../packages/model/src/config/index.ts"),fe=n("../packages/model/src/utils/numberFormat/ParsedValueType.ts"),ve=n("../spread-sheet/src/base/util/url.ts"),me=n("../packages/model/src/cell/format/TextFormat.ts"),ge=n("../packages/model/src/cell/format/Border.ts"),ye=n("../packages/model/src/cell/format/Borders.ts"),be=n("../packages/model/src/cell/TextFormatRun.ts"),Pe=n("../packages/utils/src/index.ts"),we=n("../packages/model/src/cell/ref-data/ref-data.ts"),Ie=n("../node_modules/lodash/set.js"),xe=n.n(Ie),Ce=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((r=r.apply(e,t||[])).next())}))};function Te(e){return null==e}var Re=function(e,t){if(Object.keys(e).length!=Object.keys(t).length)return!1;for(var n in e){if(!Object.prototype.hasOwnProperty.call(t,n))return!1;if(!ke(e[n],t[n]))return!1}return!0},ke=function(e,t){return e===t||"object"===typeof e&&null!=e&&"object"===typeof t&&null!=t&&Re(e,t)};function _e(e){if(!e||e.length<=1)return e;for(var t,n,r=0;r<e.length-1;)t=e[r],n=e[r+1],ke(t.format,n.format)?e.splice(r+1,1):r+=1;return e}function Se(e){switch(e){case he.DEFAULT_CELL_FORMAT_LITERAL.fontFamily:case"microsoft yahei":case"微软雅黑":return null;default:return e}}function Ee(e,t,n){var r,a=t&&!Number.isNaN(Number(t));switch(r=!!(n&&n.pattern!==oe.DEFAULT_FORMAT_PATTERN||a),e){case"left":return r?se.Z.LEFT:null;case"center":return se.Z.CENTER;case"right":return a&&null===n?null:se.Z.RIGHT;default:return null}}function Ae(e){switch(e){case"middle":default:return null;case"top":return ie.Z.TOP;case"bottom":return ie.Z.BOTTOM}}function je(e){switch(e){case he.DEFAULT_CELL_FORMAT_LITERAL.underline:return null;case"underline":return ce.Z.SINGLE_LINE;default:return null}}function Ze(e){switch(e){case he.DEFAULT_CELL_FORMAT_LITERAL.wrapStrategy:return null;case"normal":return le.Z.WRAP;default:return null}}function Oe(e){if(!e)return null;var t=e.colors,n=e.styles;if((!t||t.every((function(e){return null===e})))&&(!n||n.every((function(e){return null===e}))))return null;var r=null===t[0]||null===n[0]?null:ge.Z.createInstance({style:n[0],color:t[0]}),a=null===t[1]||null===n[1]?null:ge.Z.createInstance({style:n[1],color:t[1]}),o=null===t[2]||null===n[2]?null:ge.Z.createInstance({style:n[2],color:t[2]}),s=null===t[3]||null===n[3]?null:ge.Z.createInstance({style:n[3],color:t[3]}),i=null===t[4]||null===n[4]?null:ge.Z.createInstance({style:n[4],color:t[4]}),l=null===t[5]||null===n[5]?null:ge.Z.createInstance({style:n[5],color:t[5]});return ye.Z.createInstance({top:r,right:a,bottom:o,left:s,diagUp:i,diagDown:l})}function De(e){var t=e.fontfamily,n=e.fontsize,r=e.fontcolor,a=e.bold,o=e.italic,s=e.underline,i=e.strikeline;return me.Z.createInstance({color:r||(null===e||void 0===e?void 0:e.color),fontFamily:t,fontSize:n?parseInt(n,10):null,bold:"bold"===a||!0===a||null,italic:"italic"===o||!0===o||null,strikethrough:"strikeline"===i||!0===i||null,underline:je(s)})}function Le(e,t,n,r){var a,o=r.link,s=null,i=null;if(null===(a=null===o||void 0===o?void 0:o[n])||void 0===a?void 0:a[t]){var l=o[n][t];l&&(s=l.linkurl,i=l.linkType,(0,ve.KM)(l.linkurl)&&(i=(0,ve.KM)(l.linkurl)))}return{hyperlink:s,hyperlinkType:i}}var Fe=new RegExp(/%022/);function Me(e){var t,n,r,a,o,s={color:(r=e.fontcolor,r===he.DEFAULT_CELL_FORMAT_LITERAL.color?null:r),fontFamily:Se(e.fontfamily),fontSize:e.fontsize?(n=parseInt(e.fontsize,10),n===he.DEFAULT_CELL_FORMAT_LITERAL.fontSize?null:n):null,bold:"bold"===e.bold||null,italic:"italic"===e.italic||null,strikethrough:"strikeline"===e.strikeline||null,underline:je(e.underline)},i=_e(e.textFormatRuns);return i&&1===i.length&&(null===(t=i[0])||void 0===t?void 0:t.format)&&(a=s,o=function(e){var t=e.fontfamily,n=e.fontsize,r=e.fontcolor,a=e.bold,o=e.italic,s=e.underline,i=e.strikeline;return{color:r,fontFamily:t,fontSize:n?parseInt(n,10):null,bold:"bold"===a||null,italic:"italic"===o||null,strikethrough:"strikeline"===i||null,underline:je(s)}}(i[0].format),s={color:Te(a.color)?o.color:a.color,fontFamily:Te(o.fontFamily)?a.fontFamily:o.fontFamily,fontSize:Te(o.fontSize)?a.fontSize:o.fontSize,bold:Te(o.bold)?a.bold:o.bold,italic:Te(o.italic)?a.italic:o.italic,strikethrough:Te(o.strikethrough)?a.strikethrough:o.strikethrough,underline:Te(o.underline)?a.underline:o.underline},i=[]),["color","fontFamily","fontSize","bold","italic","strikethrough","underline"].every((function(e){return null===s[e]}))?null:me.Z.createInstance(s)}function Ge(e,t,n,r){var a,o,s=r.styles,i=(null===s||void 0===s?void 0:s[n])&&s[n]&&s[n][t],l=null,c=null,u=null,d=null;if(i){c=function(e,t){var n=e.format_data;n&&(n=unescape(n.replace(Fe,'"')));var r=n&&"General"!==n?oe.NumberFormatFactory.createInstance({pattern:n}):null,a=(0,pe.parseValueWithStyle)(t,r,{parseMode:pe.PARSE_MODE.CURRENT_STYLE_FIRST});return a=(0,pe.twelveNumberToText)(a),(!r||r&&r.pattern===oe.DEFAULT_FORMAT_PATTERN)&&a.numberFormat.pattern!==oe.DEFAULT_FORMAT_PATTERN?a.numberFormat:r}(i,e),d=Me(i);var p={numberFormat:c,backgroundColor:(o=i.cellcolor,o===he.DEFAULT_CELL_FORMAT_LITERAL.backgroundColor?null:o),horizontalAlign:Ee(i.h_align,e,c),verticalAlign:Ae(i.v_align),wrapStrategy:Ze(i.textwrap),borders:Oe(i.border),textFormat:d};!function(e,t){var n;null===(n=t.textFormatRuns)||void 0===n||n.forEach((function(t){var n=e.textFormat;Object.keys((null===n||void 0===n?void 0:n.getOptions())||{}).forEach((function(n){var r,a=n.toLocaleLowerCase();e.textFormat[n]&&"undefined"===typeof(null===(r=t.format)||void 0===r?void 0:r[a])&&t.format&&(t.format[a]=e.textFormat[n])}))}))}(p,i),l=ae.Z.createInstance(p),u=(a=_e(i.textFormatRuns))&&a.length?a.map((function(e){var t=e.format;return null===t?be.Z.createInstance({startIndex:e.startIndex}):be.Z.createInstance({startIndex:e.startIndex,format:De(t)})})):null}return{numberFormat:c,userEnteredFormat:l,textFormat:d,textFormatRuns:u}}function Ne(e,t,n,r,a){var o=r.formula,s=a.numberFormat,i=(0,pe.parseValueWithStyle)(e,s,{parseMode:pe.PARSE_MODE.CURRENT_STYLE_FIRST});(i=(0,pe.twelveNumberToText)(i)).valueType===fe.Z.FORMULA&&"string"===typeof i.value&&xe()(o,"["+n+"]["+t+"]",(0,ue.wh)(i.value,[]));var l=Number(i.valueType),c=i.value;return""===i.value&&l==ne.Z.STRING?null:de.Z.createInstance({type:l,value:c,originValue:void 0===i.originValue||null===i.originValue?"":String(i.originValue)})}function He(e){var t=e.effectiveValue,n=e.hyperlink,r=e.hyperlinkType;return Ce(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,o,s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!r){e.next=18;break}if(a=t,r!==N.HYPERLINK_TYPE.IMAGE){e.next=4;break}return e.abrupt("return",{hyperlinkType:N.HYPERLINK_TYPE.IMAGE,effectiveValue:a});case 4:return e.prev=4,e.next=7,(0,x.yi)({hyperlink:n,hyperlinkType:r,skipRangeShare:!0});case 7:return o=e.sent,s=o.value,i=o.newHyperlinkType,t&&s&&(a=de.Z.createInstance(Object.assign(Object.assign({},t.getOptions()),{value:s}))),w.ZP.monitor(35271164),w.ZP.tdwReport({opername:"link",module:"link_set",action:"link_tdocname_autoset"}),e.abrupt("return",{hyperlinkType:i,effectiveValue:a});case 16:e.prev=16,e.t0=e.catch(4);case 18:return e.abrupt("return",{effectiveValue:t,hyperlinkType:r});case 19:case"end":return e.stop()}}),e,null,[[4,16]])})))}var Ve=new RegExp(/\ufeff/g),Ue=new RegExp(/\s+$/);function ze(e,t){var n=t.x,r=t.y;return K.Z.getMiddleWaresByLevel(Q.aC.CELL_PROPS).filter((function(t){var a,o;if(t.tdToCellData){var s=t.desc.tableProps;return null===(o=null===(a=e[void 0===s?"":s])||void 0===a?void 0:a[r])||void 0===o?void 0:o[n]}return!1}))}function Be(e){var t={};return K.Z.getMiddleWaresByLevel(Q.aC.CELL_PROPS).forEach((function(n){var r=n.desc.tableProps;r&&(t[r]=e[r])})),t}function We(e,t,r,a){var o,s,i,l,c,u,d,p,h,f;return Ce(this,void 0,void 0,regeneratorRuntime.mark((function v(){var m,g,y,b,P,w,I,x,C,T,R,k,_,S,E,A,j,Z,O,D,L,F,M;return regeneratorRuntime.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:return"string"===typeof e&&(e=(e=e.replace(Ve,"")).replace(Ue,"")),m=a.cellSelect,g=Le(0,t,r,a),y=g.hyperlink,(null===(s=null===(o=a.link[r])||void 0===o?void 0:o[t])||void 0===s?void 0:s.hyperlinkRuns)&&(y=null),b=g.hyperlinkType,P=Ge(e,t,r,a),w=P.numberFormat,I=P.userEnteredFormat,x=P.textFormatRuns,v.next=9,Ne(e,t,r,a,{numberFormat:w});case 9:return C=v.sent,T=n.g.SpreadsheetApp.spreadsheet,v.next=13,He({effectiveValue:C,hyperlink:y,hyperlinkType:b});case 13:if(R=v.sent,!(C||y||I&&0!==I.setSlots||x||ze(a,{x:t,y:r})||(null===(i=m[r])||void 0===i?void 0:i[t]))){v.next=26;break}if(k={effectiveValue:R.effectiveValue,hyperlink:y,hyperlinkType:R.hyperlinkType,userEnteredFormat:I&&0!==I.setSlots?I:null,textFormatRuns:x,linkIconStatus:null===(c=null===(l=a.link[r])||void 0===l?void 0:l[t])||void 0===c?void 0:c.linkIconStatus,hyperlinkRuns:null===(d=null===(u=a.link[r])||void 0===u?void 0:u[t])||void 0===d?void 0:d.hyperlinkRuns,dataValidation:null===(h=null===(p=a.dataValidations)||void 0===p?void 0:p[r])||void 0===h?void 0:h[t]},K.Z.getMiddleWaresByLevel(Q.aC.CELL_PROPS).forEach((function(e){var n;(null===(n=e.tdToCellData)||void 0===n?void 0:n.isActive(a,{x:t,y:r},{effectiveValue:C}))&&(k=e.tdToCellData.fn(k))})),!(null===(f=m[r])||void 0===f?void 0:f[t])){v.next=25;break}if(_=m[r][t],S=_.value,E=_.refId,A=_.refData,S){v.next=22;break}return v.abrupt("return",null);case 22:if(k=Object.assign(k,{metadata:S,refIds:(0,ee.Z)(null===E||void 0===E?void 0:E.split(","))}),(S.customDataType===H.ZP.THIRD_PARTY_APP||S.customDataType===H.ZP.MINI_APP)&&A)try{j=JSON.parse(A),(Z=(0,we.R)(j))&&(k=Object.assign(k,{refData:Z}))}catch(G){console.error(G)}_.value.customDataType===H.ZP.DATE_REMINDER&&(O=_.docId,D=T.getSpreadsheetId(!0),L=T.activeSheetId,F=k.refIds[0],M=Pe.kk.getRandomId(),(null===O||void 0===O?void 0:O.length)&&T.fireCopyDateReminder([{srcDocId:O,srcReminderId:F,dstDocId:D,dstSheetId:L,dstReminderId:M}]));case 25:return v.abrupt("return",new re.Z(k));case 26:return v.abrupt("return",null);case 27:case"end":return v.stop()}}),v)})))}var Ye=function(e){return Ce(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,o,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.changes,r=e.formula,t.next=4,Promise.all(n.map((function(t,n){return Ce(s,void 0,void 0,regeneratorRuntime.mark((function r(){var a,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Promise.all(t.map((function(t,r){return We(t,r,n,e)})));case 2:return a=r.sent,o={values:a},r.abrupt("return",o);case 5:case"end":return r.stop()}}),r)})))})));case 4:return a=t.sent,r=r.map((function(t,n){return t.map((function(t,r){return e.submerge[n][r]?"":t}))})),o=Object.assign({isSingle:!1,isMerge:!1,merge:e.merge,rowDataUpdate:a,formula:r,fromType:l.gN.OUTER,fromApp:l.o_.unknown,select:{selectAll:e.from.selectAll,selectCol:e.from.selectCol,selectRow:e.from.selectRow},containTable:!1},Be(e)),e.rowsHeight&&(o.rowsDimensionProperties=e.rowsHeight.map((function(t,n){var r;return te.Z.createInstance({pixelSize:t,hiddenByUser:null===(r=e.hiddenRows)||void 0===r?void 0:r[n]})}))),e.colsWidth&&(o.colsDimensionProperties=e.colsWidth.map((function(t,n){var r;return te.Z.createInstance({pixelSize:t,hiddenByUser:null===(r=e.hiddenCols)||void 0===r?void 0:r[n],columnTypeMetadata:e.columnTypeMetadatas[n]})}))),t.abrupt("return",o);case 10:case"end":return t.stop()}}),t)})))},Xe=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((r=r.apply(e,t||[])).next())}))},qe=function(e){var t=function(e){var t={};t.columnTypeMetadatas=null===e||void 0===e?void 0:e.columnTypeMetadatas,t.changes=(null===e||void 0===e?void 0:e.data)?e.data:[[]],t.styles=(null===e||void 0===e?void 0:e.styles)?e.styles:null,t.link=(null===e||void 0===e?void 0:e.template)?e.template:null,t.rowsHeight=(null===e||void 0===e?void 0:e.size)&&e.size.rowHeights?e.size.rowHeights:null,t.colsWidth=(null===e||void 0===e?void 0:e.size)&&e.size.colWidths?e.size.colWidths:null;var n=(null===e||void 0===e?void 0:e.selectType)?e.selectType:null;return t.hiddenRows=(null===e||void 0===e?void 0:e.hiddenRowCol)&&e.hiddenRowCol.hiddenRows&&e.hiddenRowCol.hiddenRows.length>0?e.hiddenRowCol.hiddenRows:[],t.hiddenCols=(null===e||void 0===e?void 0:e.hiddenRowCol)&&e.hiddenRowCol.hiddenCols&&e.hiddenRowCol.hiddenCols.length>0?e.hiddenRowCol.hiddenCols:[],{pasteDataTemp:t,selectType:n}}(e),n=t.pasteDataTemp,r=t.selectType;!function(e){e.link&&(e.link=e.link.map((function(e){return e.map((function(e){var t=(e||{link:!1}).link;if(t){var n=t.url,r=t.value,a=t.type;return Object.assign({linkurl:n,linkvalue:r,linkType:a&&parseInt(a,10)||void 0,minType:"link"},t)}}))})))}(n);var a=(null===e||void 0===e?void 0:e.mergeCells)?e.mergeCells:[];n.formula=(null===e||void 0===e?void 0:e.formula)?e.formula:[[]],n.cellSelect=(null===e||void 0===e?void 0:e.cellSelect)?e.cellSelect:[[]],n.sheetList=null===e||void 0===e?void 0:e.sheetList,n.getLinkedWorkbookRangeById=null===e||void 0===e?void 0:e.getLinkedWorkbookRangeById,n.mClasses=null,n.isMaintaining=!0,n.dataValidations=(null===e||void 0===e?void 0:e.dataValidations)||[[]],K.Z.getAllMiddleWares({level:Q.aC.CELL_PROPS,tableProps:!0}).forEach((function(t){var r=t.desc.tableProps,a=void 0===r?"":r;n[a]=(null===e||void 0===e?void 0:e[a])?null===e||void 0===e?void 0:e[a]:[[]]}));var o=(null===e||void 0===e?void 0:e.data[0])?e.data[0].length-1:0,s=e?e.data.length-1:0;n.from={xRange:[0,o],yRange:[0,s],xDiff:o,yDiff:s,selectAll:"all"===r,selectRow:"row"===r,selectCol:"col"===r};var i=function(e){return e.reduce((function(e,t){var n=t.row,r=t.col,a=t.rowspan,o=t.colspan;return e[n+"-"+r]={merge:!0,w:o,h:a},e}),{})}(a),l=function(e){return e.reduce((function(e,t){for(var n=t.row,r=t.col,a=t.rowspan,o=t.colspan,s=n;s<=n+a-1;s++)for(var i=r;i<=r+o-1;i++)e[s+"-"+i]={merged:!0,parentIndexX:r,parentIndexY:n};return e}),{})}(a);return function(e,t){e.styles=e.styles.map((function(n,r){return n.map((function(n,a){var o=t[r+"-"+a];if(o){var s=o.parentIndexX,i=o.parentIndexY;(null===e||void 0===e?void 0:e.styles)&&e.styles[i]&&e.styles[i][s]&&e.styles[i][s].border&&(n||(n={}),n.border=e.styles[i][s].border)}return n}))}))}(n,l),function(e,t,n){e.merge=e.changes.map((function(e,n){return e.map((function(e,r){var a=t[n+"-"+r];if(a){var o=a.w,s=a.h;if(o&&s)return{w:o,h:s}}return!1}))})),e.submerge=e.changes.map((function(e,t){return e.map((function(e,r){var a=n[t+"-"+r];return!(!a||(null===a||void 0===a?void 0:a.parentIndexX)===r&&(null===a||void 0===a?void 0:a.parentIndexY)===t)}))}))}(n,i,l),n},Je=function(e){return Xe(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=qe(e),t.next=3,Ye(n);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))};function Ke(e,t,n){var r=[],a=[],o=!1,s=e.colsDimensionProperties,i=e.rowsDimensionProperties,l=n.xRange,c=n.yRange,u=l[0],d=c[0];return null===s||void 0===s||s.forEach((function(e,n){var r=u+n;t.sheetStatus.isCurrentColCanEdit({startCol:r,endCol:r})?a.push(e):(o=!0,a.push(null))})),null===i||void 0===i||i.forEach((function(e,n){var a=d+n;t.sheetStatus.isCurrentRowCanEdit({startRow:a,endRow:a})?r.push(e):(o=!0,r.push(null))})),Qe(o),{rowsDimensionArr:0===r.length?void 0:r,colsDimensionArr:0===a.length?void 0:a}}function Qe(e){e&&V.default.show({message:r.ZP.t("所在行列含有被保护单元格，暂不支持粘贴行高列宽。"),type:"info",duration:3e3})}var $e=n("../spread-sheet/src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts"),et=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((r=r.apply(e,t||[])).next())}))};function tt(e){switch(e){case"excel":return l.o_.excel;case"tencent":return l.o_.tencent;default:return l.o_.unknown}}var nt,rt,at=function(){function e(e){this.hotInstance=e.hotInstance,this.copyPasteShape=e.copyPasteShape,this.copyPasteCache=e.copyPasteCache,this.parsePasteTable=e.parsePasteTable,this.doPaste=e.doPaste,this.automaticIdentifyLink=e.automaticIdentifyLink}var t=e.prototype;return t.paste=function(e){var t=e.event,r=e.preImages,a=e.pasteHtmlString,o=e.clipboardContents,s=e.selectAreaCellRange,i=e.files;return et(this,void 0,void 0,regeneratorRuntime.mark((function e(){var l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=this.hotInstance.spreadsheet.activeSheetId,c=!1,!(0,E.qd)(c,t)){e.next=7;break}this.handleShapeFromOuter(t),c=!0,e.next=30;break;case 7:if(!(0,E.Xx)(c,r)){e.next=12;break}this.copyPasteShape.onParse(r,"files"),c=!0,e.next=30;break;case 12:if(!(0,E.Xc)(c,a,i)){e.next=17;break}this.handleFileFromOuter(i),c=!0,e.next=30;break;case 17:if(!(0,E.$u)(c,a)){e.next=23;break}return e.next=20,this.handleRichTextFromOuter(l,a,o,s);case 20:c=!0,e.next=30;break;case 23:if(!(0,E.qD)(c,o)){e.next=29;break}return e.next=26,this.handleTextFromOuter(o);case 26:c=!0,e.next=30;break;case 29:n.g.log.log("无法处理的外部粘贴内容",a);case 30:this.copyPasteCache.cancelCopy();case 31:case"end":return e.stop()}}),e,this)})))},t.handleShapeFromOuter=function(e){var t=e.clipboardData.getData("text/json"),n=JSON.parse(t);this.copyPasteShape.onParse(n,"json")},t.handleFileFromOuter=function(e){this.hotInstance.view.canvas.fileUploader.upload(e[0],Object.assign(Object.assign({},this.copyPasteCache.getPasteAnchor()),{sheetId:this.hotInstance.spreadsheet.activeSheetId}),"paste")},t.handleRichTextFromOuter=function(e,t,n,r){return et(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o,s,i,c,u,d,p,h=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=this.parsePasteTable.parseHTML(t),a.next=3,this.handleOuterImages(o);case 3:if(!((null===o||void 0===o?void 0:o.table)&&o.table.data.length>0)){a.next=25;break}return this.pasteBegin(t),a.next=7,Je(Object.assign(Object.assign({},o.table),{sheetList:this.hotInstance.spreadsheet.sheetManager.getSheetList(),getLinkedWorkbookRangeById:function(e){return h.hotInstance.spreadsheet.workbookRangeManager.getLinkedWorkbookRangeById(e)}}));case 7:return(s=a.sent).images=o.images,s.containTable=o.containTable,s.fromOuterContentType=l.XE.richText,o.fromApp&&(s.fromApp=tt(o.fromApp)),c=!1,(i=!1)&&(c=(0,$e.IK)(this.hotInstance,!0)),a.next=17,q.Z.beforePaste(s,this.copyPasteShape.handleOuterImg.bind(this.copyPasteShape));case 17:this.downloadError=a.sent,u=Ke(s,this.hotInstance,r),d=u.rowsDimensionArr,p=u.colsDimensionArr,s.rowsDimensionProperties=d,s.colsDimensionProperties=p,this.doPaste({activeSheetId:e,pasteData:s,pasteHtmlString:t,selectAreaCellRange:r}),this.pasteFinish(i,n,c),a.next=26;break;case 25:(null===o||void 0===o?void 0:o.images)&&o.images.forEach((function(e){e.anchor=void 0,h.copyPasteShape.addShape(e)}));case 26:case"end":return a.stop()}}),a,this)})))},t.handleTextFromOuter=function(e){return et(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.automaticIdentifyLink(e);case 2:this.handlePlainTextSmartSplit(e);case 3:case"end":return t.stop()}}),t,this)})))},t.handlePlainTextSmartSplit=function(e){if(!m().isMobilePhone){var t=!1;(0,$e.IK)(this.hotInstance)&&(t=(0,$e.IK)(this.hotInstance,!0),(0,$e.jq)(e,this.hotInstance,t))}},t.handleOuterImages=function(e){return et(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null===e||void 0===e?void 0:e.images)){t.next=4;break}return r=e.images.map((function(e){return new Promise((function(t){return et(a,void 0,void 0,regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(null===e||void 0===e?void 0:e.isOuterUrl)){r.next=11;break}return r.next=3,this.copyPasteShape.handleOuterImg(e.url);case 3:if(a=r.sent){r.next=8;break}return n.g.log.error("copypaste","外部图片上传错误"),t(null),r.abrupt("return");case 8:t(a),r.next=12;break;case 11:t(e);case 12:case"end":return r.stop()}}),r,this)})))}))})),t.next=4,Promise.all(r).then((function(t){e.images=t}));case 4:case"end":return t.stop()}}),t)})))},t.pasteBegin=function(e){(0,J.kb)(e)&&(this.load=X.default.show({tip:r.ZP.t("正在粘贴内容中...")}))},t.pasteFinish=function(e,t,n){var r;return et(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:this.downloadError&&O(this.downloadError),null===(r=this.load)||void 0===r||r.close(),e&&(0,$e.jq)(t,this.hotInstance,n);case 3:case"end":return a.stop()}}),a,this)})))},e}(),ot=function(e,t,n,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(t,n,s):a(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},st=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},it=function(e,t){return function(n,r){t(n,r,e)}},lt=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((r=r.apply(e,t||[])).next())}))},ct=o.Z.getSingleton(),ut=m().isChromeVersionAboveOrEqual("76.0")||(0,B.n_)(),dt=m().isChromeVersionAboveOrEqual("86.0"),pt=0|1<<d.Z.SLOT_EFFIECTIVE_VALUE|1<<d.Z.SLOT_HYPERLINK|1<<d.Z.SLOT_USER_ENTERED_FORMAT_DELTA|1<<d.Z.SLOT_FORMULA|1<<d.Z.SLOT_RICH_TEXT_STYLE_RUN,ht={html:"",plain:"",timeStamp:"0"};function ft(e){switch(e){case"excel":return l.o_.excel;case"tencent":return l.o_.tencent;default:return l.o_.unknown}}var vt=function(){function e(e,t){var r=this;this.hotInstance=t,this.closePasteSpecial=function(){return(0,i.V3)()},this.destroy=function(){return(0,s.Hu)()},this.getCacheData=function(){return r.copyPasteCache.getCacheData()},this.pasteFromOuter=function(e,t,n,a,o,s,i,l){return lt(r,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.pasteOuter.paste({event:e,preImages:t,pasteHtmlString:n,clipboardContents:a,selectAreaCellRange:o,files:l});case 2:(0,S.kl)(this.hotInstance,s,i);case 3:case"end":return r.stop()}}),r,this)})))},this.syncMobileClipboard=function(){return lt(r,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.px)();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))},this.clipboardCopy=function(e,t){var r=e.plain,a=e.html,o=e.json,i=void 0===o?"":o;(0,s.q2)({plain:r,html:a,json:i}).then((function(){return(0,s.c_)(a,r,i,t)})).catch((function(o){(0,s.c_)(a,r,i,t),n.g.log.error("copypaste","writeInClipBoard error",e,o)}))},this.textarea=e||this.hotInstance.view.canvas.inputManager.alloyRTE.input,this.enablePlugin(),this.copyPasteShape=new c.ZP(this.hotInstance,(function(e,t){return void 0===t&&(t=!1),r.hotInstance.requestApi.addImage(e,t)})),this.copyPasteCache=new u.default({spreadsheetApp:this.hotInstance,config:{setSlots:pt,tile:!0}}),g.Z.isCopyInEnv()&&g.Z.init(),this.destroy(),this.iconsList=(new R.Z).iconsList,this.pasteOuter=new at({hotInstance:t,copyPasteShape:this.copyPasteShape,copyPasteCache:this.copyPasteCache,parsePasteTable:ct,doPaste:this.doPaste.bind(this),automaticIdentifyLink:this.automaticIdentifyLink.bind(this)})}var t=e.prototype;return t.onPastePCClient=function(){if(!this.isPasteInvalid()){var e=(0,L.M)(this.hotInstance,!0),t=external.getClipboardData,n=function(e,t){var n="",r="",a=[];if(e.indexOf(l.Gu.TEXT)>-1){if(n=t(l.Gu.TEXT),-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")){var o=n.lastIndexOf("\n");o>-1&&""===n.slice(o+1)&&(n=n.slice(0,o))}n=n.replace(/\r\n/g,"\n")}if(e.indexOf(l.Gu.HTML)>-1&&(r=t(l.Gu.HTML)),e.indexOf(l.Gu.IMAGE)>-1){var s=t(l.Gu.IMAGE);if(s){var i=s.type,c={type:i,getAsFile:function(){return new File([s],"fromOutImage"+i.replace(/[^/]+\/([^/]+)/,"$1"),{type:i,lastModified:Date.now()})}};a.push(c)}}return{images:a,clipboardContents:n,pasteHtmlString:r}}(external.getClipboardType(),t),r=n.clipboardContents,a=n.pasteHtmlString,o=function(e,t){return{clipboardData:{items:e,getData:function(e){switch(e){case l.Gu.TEXT:return t(l.Gu.TEXT);case l.Gu.HTML:return t(l.Gu.HTML);case l.Gu.IMAGE:return t(l.Gu.IMAGE);default:return}}}}}(n.images,t);this.doClipboardPaste({html:a,plain:r},e,o)}},t.getPasteType=function(){var e=this.copyPasteCache.getCacheState();return(0,E.vy)(e)},t.doRangeToImgCopy=function(e){var t;w.ZP.tdwReport({opername:"excel_range_copy",module:"excel_copy",action:"range_menu_copy"});var n=this.hotInstance,a=n.view.getSelection(),o=e||a.rangeSelections[a.rangeSelections.length-1],s=o.startColIndex,i=o.endColIndex,l=o.startRowIndex,c=o.endRowIndex;if(!this.doCellImageCopy(o)){var u={exclude:[U.h.COPY_FRAME,U.h.FILTER_RANGE,U.h.FORMULA_LOADING,U.h.RANGTH_AUTH_BACKGROUND,U.h.COLLAB_CELL_CURSOR,U.h.CHART_RANGE,U.h.RANGTH_AUTH_HIGHLIGHT,U.h.VALIDATION_HEADER,U.h.AREA_HIGHLIGHT]},d=null===(t=n.view.canvas)||void 0===t?void 0:t.canvasProvider,p=null===d||void 0===d?void 0:d.getExcelCanvas(s,i,l,c,u);this.canvasWriteToClipboard({canvas:p},r.ZP.t("已复制为图片"),r.ZP.t("复制为图片失败"))}},t.doClipboardPaste=function(e,t,a){var o,i,l,c=this,u=+new Date;if(e){var d=new Date,h=e.plain,f=e.html||"";null===(o=n.g.log)||void 0===o||o.log("粘贴数据大小",{plain:null===(i=e.plain)||void 0===i?void 0:i.length,html:null===(l=e.html)||void 0===l?void 0:l.length});var v=f&&(f.length>3e3||!function(e){var t=(new DOMParser).parseFromString(e,"text/html");return 1===t.body.children.length&&"img"===t.body.children[0].tagName.toLocaleLowerCase()}(f))?[]:function(e){var t=[];if(!e||!e.clipboardData||!e.clipboardData.items)return null;for(var n=e.clipboardData.items,r=0;r<n.length;++r){var a=n[r];if(/^image\//.test(a.type)){var o=a.getAsFile();o&&t.push(o)}}return t}(a),m=function(e){return(null===e||void 0===e?void 0:e.clipboardData)?Array.from(e.clipboardData.files||[]):[]}(a),g=!(0,s._Y)(f,h,v,m);this.copyPasteCache.setIsFromOuter(g),function(e){var t=n.g.ActiveXObject||"ActiveXObject"in n.g,a="ctrl_V_key_pasteTip";e&&t&&null==(null===localStorage||void 0===localStorage?void 0:localStorage.getItem(a))&&(localStorage.setItem(a,"true"),(0,p.hideToast)(),(0,p.showToast)(r.ZP.t("由于IE浏览器限制，只能粘贴纯文字，不支持粘贴格式。建议使用Chrome或QQ浏览器。"),void 0,{isNeedBtn:!0,btnText:r.ZP.t("我知道了"),btnTextAfter:"",btnCallBack:function(){(0,p.hideToast)()}}))}(g),h=(0,D.Wf)(h),this.value=h;var y=null,P=g&&!f&&v&&v.length>0,x=(0,S.EB)(this.hotInstance);return this.copyPasteCache.setPasteAnchor(x),n.g.log.log("copypaste","isFromOuter",g),e.isApi?this.pasteHandler(g,a,v,f,h,t,y,P,m):new Promise((function(e){if((0,S.jq)(f,d,P,c.value)){var t=x.row,n=x.col;null===(y=k.ZP.createInstance(c.hotInstance.event,c.hotInstance.view.canvas,t,n,c.hotInstance.spreadsheet.getActiveSheetId(),k.zH.LEFT))||void 0===y||y.show()}b.Z.wait(100).run((function(){e()}))})).then((function(){c.pasteHandler(g,a,v,f,h,t,y,P,m)})).then((function(){w.ZP.speed.runReport(g?I.SPEED_REPORT_POINTS.COPY_PASTE_OUTER_PASTE:I.SPEED_REPORT_POINTS.COPY_PASTE_INNER_PASTE,u,+new Date)}))}this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,selectAreaCellRange:t})},t.doImageTextPaste=function(e){var t,n,r=e.type,a=e.pasteHtmlString,o=e.pasteData,s=e.selectAreaCellRange,i=[],c=this.copyPasteCache.getCacheState().pasteType===l.lb.cut;if(r===l.GI.table&&(null===a||void 0===a?void 0:a.length)>0&&c){var u=this.copyPasteCache.getCacheState().sheetId;i=(0,z.gh)(a).map((function(e){return{key:e,sheetId:u}})),null===(n=null===(t=this.hotInstance.view.canvas.shapeEditCenter)||void 0===t?void 0:t.shapeEdit)||void 0===n||n.hide()}if(a&&a.length>0){var d=ct.parseHTML(a);o=o||this.copyPasteCache.getCacheData(),(null===d||void 0===d?void 0:d.table)&&d.table.data.length>0&&(o.images=d.images,o.containTable=!0,o.cutEmbeddedArray=i,this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,pasteData:o,pasteHtmlString:a,selectAreaCellRange:s}))}else this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,pasteData:o,selectAreaCellRange:s})},t.doPaste=function(e){var t=e=e||{},a=t.selectAreaCellRange,o=t.activeSheetId,s=e,l=s.pasteData,u=s.cb,d=s.envs,h=s.pasteHtmlString;if(o=o||this.hotInstance.spreadsheet.getActiveSheetId(),a=a||(0,L.M)(this.hotInstance,!1),this.hotInstance.sheetStatus.containsPrivateCell())return G.default.confirm({title:r.ZP.t("column-type|隐私提醒"),content:r.ZP.t("column-type|粘贴区域包含不可见隐私内容，请手动清空后再次粘贴。"),cancelText:r.ZP.t("取消")}),w.ZP.tdwReport({opername:"doc_excel",module:"privacy_fill",action:"pop_up",ver6:"copy-paste"}),!0;var f=u||!(m().isMobilePhone||m().isAndroidPad)&&i.Yr,v=!1;try{v=this.handlerDoPaste({activeSheetId:o,pasteData:l,cb:f,undoCb:i.V3,selectAreaCellRange:a,envs:d})}catch(g){console.error(g)}return v&&h&&h.length>0&&function(e,t){var r=navigator.userAgent.match(/Mac\sOS\sX/i),a=e.filter((function(e){return!!e&&!(!e.url||e.url!==c.Eb&&e.url!==c.tZ)})),o=Z(a,t,r).msgContent;o&&((0,p.showToast)(o,{top:"182px","z-index":501,"max-width":800},{toastType:"typeNotice",isNeedClose:!0,isNeedReflush:!0}),$(".view_announcement").off("click").on("click",(function(){n.g.onlineDocDialog.createDialog(n.g.res.afterUpdateTip.content_afterupdate,null,(function(){(0,p.hideToast)()}))})))}((null===l||void 0===l?void 0:l.images)||[],h),this.copyPasteCache.cancelCopy(),v},t.doCopy=function(e){var t,n,a=e.copyType,o=e.previewActiveSheetId,s=e.isSelectAll,i=+new Date;(0,F.IZ)("inToastPreview")&&w.ZP.tdwReport({opername:"doc_preview",module:"pc_qqview",action:"cli_copy"});var c=this.hotInstance,u=(0,L.M)(c,!1,!0,s);!function(e){w.ZP.jank.log({moduleValue:"copy",actionValue:"analysis",detail:[{x:e.xRange[0],y:e.yRange[0],w:e.xRange[1]-e.xRange[0]+1,h:e.yRange[1]-e.yRange[0]+1}]})}(u),f();var d=c.spreadsheet.activeSheet,p=o||d.getSheetId(),h=(0,y.convertXYRangeToDimensionRanges)(u,p),v=(0,y.convertDimensionRangesToGridRange)(h),g=(0,T.isSelectRow)(c),b=(0,T.isSelectColoumn)(c);if(a===l.lb.cut&&(!c.sheetStatus.getRangeCanEdit(v)||!c.sheetStatus.isRangeCanEditByHighWater(v)))return ht;if((b||g)&&a===l.lb.cut&&!(0,C.zk)(v,d))return P.dialog.alert(r.ZP.t("提示"),r.ZP.t("无法对合并单元格执行此操作。"),(function(){})),ht;var x=this.copyPasteCache.onCopy({from:u,copyType:a,hotInstance:this.hotInstance,previewActiveSheetId:o,isSelectAll:s});try{this.clipboardCopy(x,l.GI.table)}catch(R){console.error(R)}return m().isMobile||null===(t=c.view.canvas.inputManager)||void 0===t||t.focus(),null===(n=c.view.canvas.copyFrame)||void 0===n||n.doCopy((0,y.convertXYRangeToGridRange)(u,c.spreadsheet.activeSheetId)),w.ZP.speed.runReport(I.SPEED_REPORT_POINTS.COPY_PASTE_COPY_TIME,i,+new Date),x},t.doChartCopy=function(e){var t,n;return lt(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o,s;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if((o=this.hotInstance).sheetStatus.canCopy){a.next=4;break}return(0,p.showToast)(r.ZP.t("文档作者限制了查看者的操作权限，无法复制内容。"),{},{showCloseBtn:!0}),a.abrupt("return");case 4:return a.next=6,null===(n=null===(t=o.view.canvas)||void 0===t?void 0:t.getCanvasProvider())||void 0===n?void 0:n.getChartCanvas(e);case 6:(s=a.sent)?this.canvasWriteToClipboard({canvas:s},r.ZP.t("已复制图表为图片。"),r.ZP.t("复制图表为图片失败。")):(0,p.showToast)(r.ZP.t("获取图表失败。"),null,{style:{padding:"8px 12px",borderRadius:"4px"},toolToastCloseTime:3e3});case 8:case"end":return a.stop()}}),a,this)})))},t.getPasteTypeFromBrowser=function(){var e=this;return window.navigator.clipboard&&window.navigator.clipboard.read?window.navigator.clipboard.read().then((function(t){return lt(e,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,a,o,s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=0;case 2:if(!(r<t.length)){e.next=23;break}if((a=t[r]).types){e.next=6;break}return e.abrupt("continue",20);case 6:o={},s=regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.types[t],e.next=3,a.getType(n);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return","continue");case 6:e.t0=n,e.next=e.t0===l.Gu.TEXT?9:e.t0===l.Gu.HTML?13:e.t0===l.Gu.IMAGE?17:e.t0===l.Gu.JPEG?21:25;break;case 9:return e.next=11,r.text();case 11:return o.plain=e.sent,e.abrupt("break",25);case 13:return e.next=15,r.text();case 15:return o.html=e.sent,e.abrupt("break",25);case 17:return o.type=l.Gu.IMAGE,o.blob=r,o.getAsFile=function(){return r},e.abrupt("break",25);case 21:return o.type=l.Gu.JPEG,o.blob=r,o.getAsFile=function(){return r},e.abrupt("break",25);case 25:case"end":return e.stop()}}),e)})),e.t0=regeneratorRuntime.keys(a.types);case 9:if((e.t1=e.t0()).done){e.next=17;break}return i=e.t1.value,e.delegateYield(s(i),"t2",12);case 12:if("continue"!==e.t2){e.next=15;break}return e.abrupt("continue",9);case 15:e.next=9;break;case 17:if(o.blob||o.html||o.plain){e.next=19;break}return e.abrupt("continue",20);case 19:n.push(o);case 20:r++,e.next=2;break;case 23:return null===window||void 0===window||window.log.log("[apiDoPaste] browserClipboard Log getClipboard callback: %o",n),e.abrupt("return",n.length>0?n:null);case 25:case"end":return e.stop()}}),e)})))})).catch((function(e){var t;return null===(t=null===window||void 0===window?void 0:window.log)||void 0===t||t.info("[apiDoPaste] browserClipboard Log getClipboard error: %o",e),null})):Promise.resolve(null)},t.getPasteTypeFromWxwork=function(){var e;return(0,B.n_)()?null===(e=null===W.DI||void 0===W.DI?void 0:W.DI.getClipboardData)||void 0===e?void 0:e.call(W.DI).then((function(e){null===window||void 0===window||window.log.info("[apiDoPaste] 3.1.18 newJsApi Log getClipboard callback: %o",e);try{"string"===typeof e&&(e=JSON.parse(e));var t=e.html===e.plain?"":e.html,n=e.plain;return t||n?[{html:t,plain:n}]:null}catch(r){return null===window||void 0===window||window.log.error("[apiDoPaste] 3.1.18 newJsApi Log getClipboard error: %o",r),null}}),(function(e){return null===window||void 0===window||window.log.info("[apiDoPaste] 3.1.18 newJsApi Log getClipboard error: %o",e),null})):Promise.resolve(null)},t.doShapesCopy=function(e){this.doShapesCopyInPc(e)},t.doCopyToClipboard=function(e,t){void 0===t&&(t=!0),t&&(0,s.ES)({copyContent:e,type:e.type||l.GI.table}),this.copyPasteCache.setCacheData({isSingle:!0,isMerge:!1,merge:[[]],rowDataUpdate:[{values:[new N.CellData({effectiveValue:N.ExtendedValueFactory.createInstance({type:N.EXTENDED_VALUE_TYPE.STRING,value:e.plain})})]}],fromType:l.gN.COPY_CACHE,fromApp:l.o_.tencent,select:{selectAll:!1,selectCol:!1,selectRow:!1},containTable:!0}),this.copyPasteCache.setValid(!0),this.copyPasteCache.setStateCopyData(e)},t.doShapesCopyInPc=function(e){var t,n,a,o=this,i=this.hotInstance,c=this.copyPasteShape.getCopyContent(),u=null===(t=i.view.canvas)||void 0===t?void 0:t.canvasProvider,d=null===(a=null===(n=i.view.canvas.shapeEditCenter)||void 0===n?void 0:n.shapeEdit)||void 0===a?void 0:a.shapeId;u.getShapeCanvas(d).then((function(t){var n;if(t&&ut){var a=Object.assign({},c,{canvas:t});o.canvasWriteToClipboard(a,r.ZP.t("复制图片成功"),r.ZP.t("复制图片失败"),!1),(0,s.c_)(a.html,a.plain,a.json,l.GI.shapes)}else o.clipboardCopy(c,l.GI.shapes);e===l.lb.cut&&o.deleteImageRequest(),o.copyPasteCache.cancelCopy(),null===(n=i.view.canvas.copyFrame)||void 0===n||n.closeCopy()}))},t.doShapesCopyInMoblie=function(e){var t,n=this.hotInstance,r=this.copyPasteShape.getCopyContent();this.clipboardCopy(r,l.GI.shapes),e===l.lb.cut&&this.deleteImageRequest(),this.copyPasteCache.cancelCopy(),null===(t=n.view.canvas.copyFrame)||void 0===t||t.closeCopy()},t.deleteImageRequest=function(){var e,t,n,r,a=this.hotInstance,o=null===(t=null===(e=a.view.canvas.shapeEditCenter)||void 0===e?void 0:e.shapeEdit)||void 0===t?void 0:t.shapeId;o&&(a.requestApi.deleteImage({id:o,sheetId:a.spreadsheet.activeSheetId}),null===(r=null===(n=a.view.canvas.shapeEditCenter)||void 0===n?void 0:n.shapeEdit)||void 0===r||r.hide())},t.onPaste=function(e){var t;if(n.g.log.info("copypaste2ui onpaste get in"),!(0,Y.TQ)(this.hotInstance)){w.ZP.run(I.CONFIG.COPY_PASTE),w.ZP.tdwReport({module:"cut_copy_paste",opername:"doc_excel_editor",action:"cut_copy_paste_paste_click",ver10:"quick_click"});var r=this.hotInstance;if(!this.isPasteInvalid()){null===e||void 0===e||e.preventDefault();var a=(0,L.M)(r,!0),o=(0,D.my)(e),i=null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text/html");i=(0,D.Cg)(i,o,e),n.g.log.info("copypaste2ui onpaste pasteHtmlString",i),(0,s.jZ)()===l.GI.shapes&&w.ZP.tdwReport({module:"excel_picture",opername:"doc_excel_editor",action:"picture_menu_ctrl_v"}),this.doClipboardPaste({html:i,plain:o},a,e)}}},t.onInputPaste=function(e){this.hotInstance.view.canvas.inputManager.handleExitInput({discard:!1}),this.copyPasteShape.inputTriggered(),this.onPaste(e)},t.enablePlugin=function(){var e=this,t=this.hotInstance.view.canvas.inputManager;(0,_.vP)(this.textarea,"paste",(function(t){return e.onPaste(t)}),!1),null===t||void 0===t||t.alloyRTE.emitter.on(t.alloyRTE.EVENT.ON_PASTE_OUTER,(function(t){return e.onInputPaste(t)}))},t.isPasteInvalid=function(){var e=this.hotInstance,t=e.view.getSelection();return!!e.view.canvas.inputManager.isInputtingState()||!e.sheetStatus.canEdit||1!==t.rangeSelections.length},t.pasteHandler=function(e,t,r,a,o,i,c,u,d){return lt(this,void 0,void 0,regeneratorRuntime.mark((function p(){var h,f,v;return regeneratorRuntime.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(h=this.copyPasteShape,f=(0,s.jZ)(),M(e,r,a,o,u),p.prev=3,!e){p.next=8;break}return p.next=7,this.pasteFromOuter(t,r,a,o,i,c,u,d);case 7:return p.abrupt("return",p.sent);case 8:if(!f){p.next=21;break}if(!(0,E.q_)(f,a)){p.next=13;break}this.doImageTextPaste({type:f,pasteHtmlString:a,selectAreaCellRange:i}),p.next=19;break;case 13:if(f!==l.GI.input){p.next=18;break}return p.next=16,this.automaticIdentifyLink.call(this,o);case 16:p.next=19;break;case 18:f===l.GI.table?this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,selectAreaCellRange:i}):f===l.GI.shapes&&(v=JSON.parse((0,s.e7)().json),h.onParse(v,"json"));case 19:p.next=23;break;case 21:if(o){p.next=23;break}return p.abrupt("return",!1);case 23:return(0,S.kl)(this.hotInstance,c,u),p.abrupt("return",!0);case 27:return p.prev=27,p.t0=p.catch(3),n.g.log.error("复制粘贴 pasteHandler 失败",p.t0),(0,S.Qj)(this.hotInstance,c),p.abrupt("return",!1);case 32:case"end":return p.stop()}}),p,this,[[3,27]])})))},t.handlerDoPaste=function(e){var t,a,o=e.activeSheetId,s=e.pasteData,i=e.cb,l=e.undoCb,c=e.selectAreaCellRange,u=e.envs,d=this.hotInstance,p=d.view.getSelection(),h={xRange:[(c=c||(0,L.M)(d,!1)).xRange[0],c.xRange[1]],yRange:[c.yRange[0],c.yRange[1]]},f=p.rangeSelections[p.rangeSelections.length-1];if((0,L.f)(f))return P.dialog.info({title:r.ZP.t("警告"),content:r.ZP.t("无法执行此操作。请选中区域重试")}),!1;try{null===(t=n.g.log)||void 0===t||t.info("pasteSelectRange",JSON.stringify(c),JSON.stringify(d.view.canvas.normalSelectData.selectQueue),JSON.stringify(d.view.getSelection().rangeSelections[d.view.getSelection().rangeSelections.length-1]))}catch(m){}var v=this.copyPasteCache.onPaste({activeSheetId:o,to:h,hotInstance:d,pasteData:s,cb:i,undoCb:l,envs:u});return null===(a=d.view.canvas.copyFrame)||void 0===a||a.closeCopy(),v},t.automaticIdentifyLink=function(e){return lt(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,L.M)(this.hotInstance,!1,!0),r=this.hotInstance.spreadsheet,t.next=4,(0,x.FJ)(e,r.sheetManager.getSheetList(),(function(e){return r.workbookRangeManager.getLinkedWorkbookRangeById(e)}));case 4:(a=t.sent)&&(a.fromOuterContentType=l.XE.text,this.doPaste({activeSheetId:this.hotInstance.spreadsheet.activeSheetId,pasteData:a,selectAreaCellRange:n}));case 6:case"end":return t.stop()}}),t,this)})))},t.doCellImageCopy=function(e){var t,n,a,o=this.hotInstance,s=e.startColIndex,i=e.startRowIndex,l=o.spreadsheet.activeSheet.getCellDatasAtRange(e);if(1===l.length&&1===l[0].length&&(null===(n=null===(t=l[0][0])||void 0===t?void 0:t.getMetadata())||void 0===n?void 0:n.customDataType)===H.ZP.IMAGE){var c=null===(a=o.view.canvas)||void 0===a?void 0:a.canvasProvider,u=null===c||void 0===c?void 0:c.getCellImageCanvas(i,s);if(u)return this.canvasWriteToClipboard({canvas:u},r.ZP.t("已复制为图片"),r.ZP.t("复制为图片失败")),!0}return!1},t.canvasWriteToClipboard=function(e,t,n,a){var o=this;void 0===a&&(a=!0),ut?e.canvas.toBlob((function(r){dt?o.blobToClipboard(r,e.html||"",e.plain||"",t,n,a):o.blobToClipboard(r,"","",t,n,a)})):a&&V.default.show({type:"error",message:n+"，"+r.ZP.t("请使用最新版Chrome浏览器尝试该功能"),autoClose:!0,duration:3e3,style:{zIndex:10004}})},t.blobToClipboard=function(e,t,n,a,o,s){return void 0===s&&(s=!0),lt(this,void 0,void 0,regeneratorRuntime.mark((function i(){var l,c;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,l={},(t||n)&&(l["text/html"]=new Blob([t],{type:"text/html"}),l["text/plain"]=new Blob([n],{type:"text/plain"})),e&&(l[e.type]=e),c=[new ClipboardItem(l)],i.next=7,navigator.clipboard.write(c).then((function(){s&&a&&V.default.show({type:"success",message:a,autoClose:!0,duration:3e3,style:{zIndex:10004}})}),(function(){s&&V.default.show({type:"error",message:o,autoClose:!0,duration:3e3,style:{zIndex:10004}})}));case 7:i.next=12;break;case 9:i.prev=9,i.t0=i.catch(0),V.default.show({type:"error",message:r.ZP.t("此浏览器暂不支持该功能，请使用最新版Chrome浏览器尝试"),autoClose:!0,duration:3e3,style:{zIndex:10004}});case 12:case"end":return i.stop()}}),i,null,[[0,9]])})))},e}(),mt=vt=ot([it(1,a.m),st("design:paramtypes",["function"===typeof(nt="undefined"!==typeof HTMLElement&&HTMLElement)?nt:Object,"function"===typeof(rt="undefined"!==typeof a.m&&a.m)?rt:Object])],vt)}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/spread-sheet_src_core_feature_bootstrap_ts.36e0949b80c832384d68.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=spread-sheet_src_core_feature_bootstrap_ts.36e0949b80c832384d68.js.map