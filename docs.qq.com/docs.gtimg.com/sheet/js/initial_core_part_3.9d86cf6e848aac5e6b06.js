self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["initial_core_part_3"],{"../spread-sheet/src/core/view/level-1/auto-scroll/AutoScroll.ts":function(e,t,i){i.d(t,{Iq:function(){return d},OD:function(){return n},gn:function(){return l}});var n,o=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(i("../node_modules/core-js/modules/es.number.max-safe-integer.js"),i("../node_modules/core-js/modules/es.number.constructor.js"),i("../node_modules/@tencent/containerized/build/main/index.js")),r=i("../packages/model/src/config/index.ts");!function(e){e[e.NONE=0]="NONE",e[e.TOP=1]="TOP",e[e.RIGHT=2]="RIGHT",e[e.BOTTOM=4]="BOTTOM",e[e.LEFT=8]="LEFT",e[e.Y=5]="Y",e[e.X=10]="X",e[e.ALL=15]="ALL"}(n||(n={}));var l=10,d=20,c=function(e){function t(t){var i;return(i=e.call(this)||this).spreadsheetView=t,i.currDirection=n.NONE,i._running=!1,i.diff={x:0,y:0},i.virtualTouch={clientX:0,clientY:0,identifier:Date.now(),target:document},i._handleMousemove=function(e){i._calc()?(i.cacheClientX=e.clientX,i.cacheClientY=e.clientY,i._scroll({diffX:i.diff.x,diffY:i.diff.y}),i._startDispatchEvent(i._dispatchMousemove)):i.timer&&clearInterval(i.timer)},i._handleTouchmove=function(e){i._calc()?(i.cacheClientX=e.touches[0].clientX,i.cacheClientY=e.touches[0].clientY,i._scroll({diffX:i.diff.x,diffY:i.diff.y}),i._startDispatchEvent(i._dispatchTouchmove)):i.timer&&clearInterval(i.timer)},i._handleUp=function(){document.removeEventListener("mousemove",i._handleMousemove),document.removeEventListener("mouseup",i._handleUp),document.removeEventListener("touchmove",i._handleTouchmove),document.removeEventListener("touchend",i._handleUp),clearTimeout(i.timer),i.currDirection=n.NONE,i.startFocusColArea=null,i.startFocusRowArea=null,i.currFocusColArea=null,i.currFocusRowArea=null,i.diff.x=0,i.diff.y=0,i.maxWidth=0,i.maxHeight=0,i._running=!1},i._startDispatchEvent=function(e){clearTimeout(i.timer),i.timer=setTimeout(e,60)},i._dispatchMousemove=function(){try{var e=new MouseEvent("mousemove",{clientX:i.cacheClientX,clientY:i.cacheClientY});document.dispatchEvent(e)}catch(t){return}i._startDispatchEvent(i._dispatchMousemove)},i._dispatchTouchmove=function(){i.virtualTouch.clientX=i.cacheClientX,i.virtualTouch.clientY=i.cacheClientY;var e=new TouchEvent("touchmove",{touches:[new Touch(i.virtualTouch)]});document.dispatchEvent(e),i._startDispatchEvent(i._dispatchTouchmove)},i}(0,a.Z)(t,e);var i=t.prototype;return i.ready=function(e,t,i){this.currDirection=e;var n=this._getCurrFocusRowArea(),o=this._getCurrFocusColArea();this.currFocusRowArea=n,this.startFocusRowArea=n,this.currFocusColArea=o,this.startFocusColArea=o,document.addEventListener("mousemove",this._handleMousemove,!0),document.addEventListener("mouseup",this._handleUp,!0),document.addEventListener("touchmove",this._handleTouchmove,!0),document.addEventListener("touchend",this._handleUp,!0),this.maxWidth=t||window.innerWidth,this.maxHeight=i||window.innerHeight,this._running=!0},i.dispose=function(){e.prototype.dispose.call(this),this._running&&(document.removeEventListener("mousemove",this._handleMousemove,!0),document.removeEventListener("mouseup",this._handleUp,!0),document.removeEventListener("touchmove",this._handleTouchmove,!0),document.removeEventListener("touchend",this._handleUp,!0))},i._getCurrFocusRowArea=function(){var e=this.spreadsheetView.operateContext.operateData;return e.currRow>=0&&e.currRow<Number.MAX_SAFE_INTEGER?e.currRow<=this.spreadsheetView.areaData.row.frozen.to?this.spreadsheetView.areaData.row.frozen:this.spreadsheetView.areaData.row.flow:null},i._getCurrFocusColArea=function(){var e=this.spreadsheetView.operateContext.operateData;return e.currCol>=0&&e.currCol<Number.MAX_SAFE_INTEGER?e.currCol<=this.spreadsheetView.areaData.col.frozen.to?this.spreadsheetView.areaData.col.frozen:this.spreadsheetView.areaData.col.flow:null},i._calc=function(){var e=this._calcX(),t=this._calcY();return!!(Number(e)|Number(t))},i._calcX=function(){var e=!1,t=this.spreadsheetView.operateContext.operateData;return this.currDirection&n.RIGHT&&(t.currCol===Number.MAX_SAFE_INTEGER||this.maxWidth>0&&t.displayCurrX>this.maxWidth)?e=this._calcRight():this.currDirection&n.LEFT&&(e=this._calcLeft()),e},i._calcY=function(){var e=!1,t=this.spreadsheetView.operateContext.operateData;return this.currDirection&n.BOTTOM&&(t.currRow===Number.MAX_SAFE_INTEGER||this.maxHeight>0&&t.displayCurrY>this.maxHeight)?e=this._calcBottom():this.currDirection&n.TOP&&(e=this._calcTop()),e},i._calcRight=function(){return this.diff.x=r.DEFAULT_COL_WIDTH>>1,!0},i._calcLeft=function(){var e=this.spreadsheetView.operateContext.operateData;if(this.startFocusColArea===this.spreadsheetView.areaData.col.flow){if(e.currCol<this.spreadsheetView.areaData.col.flow.from)return this.diff.x=-(r.DEFAULT_COL_WIDTH>>1),!0}else if(this.startFocusColArea===this.spreadsheetView.areaData.col.frozen){var t=this._getCurrFocusColArea();if(null!==this.currFocusColArea&&null!==t&&this.currFocusColArea!==t)return this.diff.x=-this.spreadsheetView.areaData.col.flow.offsetSize,this.currFocusColArea=t,!0}return!1},i._calcBottom=function(){return this.diff.y=r.DEFAULT_ROW_HEIGHT,!0},i._calcTop=function(){var e=this.spreadsheetView.operateContext.operateData;if(this.startFocusRowArea===this.spreadsheetView.areaData.row.flow){if(e.currRow<this.spreadsheetView.areaData.row.flow.from)return this.diff.y=-r.DEFAULT_ROW_HEIGHT,!0}else if(this.startFocusRowArea===this.spreadsheetView.areaData.row.frozen){var t=this._getCurrFocusRowArea();if(null!==this.currFocusRowArea&&null!==t&&this.currFocusRowArea!==t)return this.diff.y=-this.spreadsheetView.areaData.row.flow.offsetSize,this.currFocusRowArea=t,!0}return!1},i._scroll=function(e){var t=this.spreadsheetView.areaData;t.col.flow.setOffsetSize(t.col.flow.offsetSize+e.diffX),t.row.flow.setOffsetSize(t.row.flow.offsetSize+e.diffY)},(0,o.Z)(t,[{key:"running",get:function(){return this._running}}]),t}(s.JT);t.ZP=c},"../spread-sheet/src/core/view/level-1/cell-image-manager/index.ts":function(e,t,i){i.d(t,{Z:function(){return o}}),i("../node_modules/core-js/modules/es.object.assign.js");var n=i("../spread-sheet/src/core/utils/ImageLoader.ts"),o=function(e){this.clearCache=function(){n.ZP.clearCache()},Object.assign(this,e),e.event.sheetsBar.listen("switchSheet",this.clearCache)}},"../spread-sheet/src/core/view/level-1/default-scale/DefaultScale.ts":function(e,t,i){var n=i("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=i.n(n),a=i("../spread-sheet/src/core/view/config/default.ts");t.Z=function(e){if(this.spreadsheetView=e,this.default=a.QX,!o().isPC&&!o().isIPad){var t=a.U2;(this.spreadsheetView.areaData.row.frozen.isValid()||this.spreadsheetView.areaData.col.frozen.isValid())&&(t=a.ai),this.default=t,this.spreadsheetView.scale.scaleTo(t)}}},"../spread-sheet/src/core/view/level-1/drag-operate/DragOperate.ts":function(e,t,i){i.d(t,{Z:function(){return h}});var n,o,a,s,r=i("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),l=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),d=(i("../node_modules/core-js/modules/es.array.iterator.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.string.iterator.js"),i("../node_modules/core-js/modules/es.weak-map.js"),i("../node_modules/core-js/modules/esnext.weak-map.delete-all.js"),i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../packages/lib/event/index.ts")),c=i("../node_modules/@tencent/containerized/build/main/index.js"),u=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},h=function(e){function t(t){var i;return i=e.call(this)||this,n.set((0,r.Z)(i),new d.Q),o.set((0,r.Z)(i),new d.Q),a.set((0,r.Z)(i),new d.Q),s.set((0,r.Z)(i),new d.Q),i.onDragEnter=u((0,r.Z)(i),n,"f").event,i.onDragLeave=u((0,r.Z)(i),o,"f").event,i.onDragOver=u((0,r.Z)(i),a,"f").event,i.onDrop=u((0,r.Z)(i),s,"f").event,i.handleDragEnter=function(e){i.node.contains(e.target)&&(e.preventDefault(),u((0,r.Z)(i),n,"f").fire(e))},i.handleDragLeave=function(e){i.node.contains(e.target)&&(e.preventDefault(),u((0,r.Z)(i),o,"f").fire(e))},i.handleDragOver=function(e){i.node.contains(e.target)&&(e.preventDefault(),u((0,r.Z)(i),a,"f").fire(e))},i.handleDrop=function(e){i.node.contains(e.target)&&(e.preventDefault(),u((0,r.Z)(i),s,"f").fire(e))},i.node=t,document.addEventListener("dragenter",i.handleDragEnter),document.addEventListener("dragleave",i.handleDragLeave),document.addEventListener("dragover",i.handleDragOver),document.addEventListener("drop",i.handleDrop),i}return(0,l.Z)(t,e),t}(c.JT);n=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap},"../spread-sheet/src/core/view/level-1/error-tip-accessor/ErrorTipAccessor.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),a=(i("../node_modules/core-js/modules/es.object.keys.js"),i("../node_modules/lodash/set.js")),s=i.n(a),r=i("../node_modules/lodash/unset.js"),l=i.n(r),d=i("../spread-sheet/src/core/view/spreadsheet-view/accessor/BaseCellAccessor.ts"),c=function(e){function t(t,i){var n,o;return(o=e.call(this,{dataCallView:t,spreadsheet:i})||this).dataCallView=t,o.currentSheetId=i.activeSheetId,o._rowData[o.currentSheetId]=((n={}).error_tip_data=[],n),o}(0,o.Z)(t,e);var i=t.prototype;return i.refresh=function(e){var t,i;this._rowData[this.currentSheetId]=((t={}).error_tip_data=[],t),this.currentSheetId=e,this._rowData[this.currentSheetId]=((i={}).error_tip_data=[],i)},i.getErrorTipFlags=function(e,t){var i;return(null===(i=this.data[e])||void 0===i?void 0:i[t])||0},i.setErrorTipFlags=function(e,t,i){i?s()(this.data,[e,t],i):this.deleteErrorTipFlags(e,t)},i.deleteErrorTipFlags=function(e,t){l()(this.data,[e,t]),this.data[e]&&0===Object.keys(this.data[e]).length&&delete this.data[e]},(0,n.Z)(t,[{key:"data",get:function(){return this._rowData[this.currentSheetId].error_tip_data}}]),t}(d.Z);t.Z=c},"../spread-sheet/src/core/view/level-1/formula-select-data/FormulaSelectData.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),a=i("../packages/lib/index.ts"),s=i("../spread-sheet/src/core/view/level-1/select-center/base/BaseSelectData.ts"),r=i("../spread-sheet/src/core/view/level-1/select-center/base/utils.ts"),l=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).onUpdateCurrentIndexEmitter=new a.Q5,n._currentSelectIndex=-1,n.onUpdateCurrentIndex=n.onUpdateCurrentIndexEmitter.event,n}(0,o.Z)(t,e);var i=t.prototype;return i.addSelection=function(t){null===t?(e.prototype.addSelection.call(this,null,null),this.currentSelectIndex+=1):(t.activation||(t.activation={row:t.yRange?t.yRange[0]:0,col:t.xRange?t.xRange[0]:0}),e.prototype.addSelection.call(this,t,t.activation),this.currentSelectIndex+=1),this.onAddSelectDataEmitter.fire(this.select)},i.updateSelection=function(t,i){var n=this._selectQueue[t];if(void 0===n)throw new Error("错误更新选区");if(!i.activation){if(!n.activation)throw new Error("未传入激活区域，并且无法复用之前的激活区域");if(i.activation={row:n.activation.row,col:n.activation.col},i.xRange&&(i.activation.col<i.xRange[0]||i.activation.col>i.xRange[1]))throw new Error("未传入激活区域，并且无法复用之前的激活区域");if(i.yRange&&(i.activation.row<i.yRange[0]||i.activation.row>i.yRange[1]))throw new Error("未传入激活区域，并且无法复用之前的激活区域")}e.prototype.updateSelection.call(this,t,i,i.activation),this._currentSelectIndex=t,this.onUpdateSelectDataEmitter.fire({index:t,selection:this._selectQueue[t]})},i.removeSelection=function(t){e.prototype.removeSelection.call(this,t),this._currentSelectIndex=Math.min(this._currentSelectIndex,this._selectQueue.length-1),this.onRemoveSelectDataEmitter.fire(t)},i.resetSelection=function(){e.prototype.resetSelection.call(this),this._currentSelectIndex=-1,this.onResetSelectDataEmitter.fire()},(0,n.Z)(t,[{key:"currentSelectIndex",get:function(){return this._currentSelectIndex},set:function(e){if(e>this._selectQueue.length)throw new Error("设置的当前选区异常");this._currentSelectIndex=e,this.onUpdateCurrentIndexEmitter.fire(e)}},{key:"activeRow",get:function(){if(!this._selectQueue[this._currentSelectIndex])return-1;var e=this._selectQueue[this._currentSelectIndex].activation;return e?(0,r.Uz)(this.spreadsheetView.tableView,e.row,e.col).row:-1}},{key:"activeCol",get:function(){if(!this._selectQueue[this._currentSelectIndex])return-1;var e=this._selectQueue[this._currentSelectIndex].activation;return e?(0,r.Uz)(this.spreadsheetView.tableView,e.row,e.col).col:-1}},{key:"activation",get:function(){return this._selectQueue[this._currentSelectIndex].activation}},{key:"select",get:function(){return this._selectQueue[this._currentSelectIndex]||null}}]),t}(s.Z);t.Z=l},"../spread-sheet/src/core/view/level-1/formula-select-stage/stage/FormulaSelectionStage.pc.ts":function(e,t,i){i.d(t,{Z:function(){return v}});var n=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=i("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../spread-sheet/src/core/view/utils/base-func.ts")),r=i("../spread-sheet/src/core/view/level-1/select-center/base/stage/BaseSelectionStage.ts"),l=(i("../node_modules/core-js/modules/es.array.splice.js"),i("../node_modules/core-js/modules/es.object.assign.js"),i("../node_modules/core-js/modules/es.array.slice.js"),i("../node_modules/core-js/modules/es.array.join.js"),["#f7981d","#7e3794","#11a9cc","#a61d4c","#4285f4","#f4b400","#65b045","#795548","#999999","#f1ca3a","#3f5ca9","#c3d03f"]),d=function(){function e(e){this._element=document.createElement("div"),this._element.classList.add("formula-selection"),this.setAttribute(e)}e.newInstance=function(t,i){var n=e.pools.pop();return n?n.setAttribute(i):n=new e(i),t.appendChild(n._element),n},e.destroy=function(t){t._element.remove(),t._color="",e.pools.push(t)};var t=e.prototype;return t.setAttribute=function(e){var t=l[e.index%l.length];this._color=t;var i=e.display,n=void 0===i||i;(e.width<0||e.height<0)&&(n=!1),Object.assign(this._element.style,{left:e.left+"px",top:e.top+"px",width:e.width+"px",height:e.height+"px","border-color":t,"background-color":c(t,.2),display:n?"block":"none"})},t.active=function(){this._element.style.borderStyle="dashed"},t.unactive=function(){this._element.style.borderStyle="solid"},(0,n.Z)(e,[{key:"element",get:function(){return this._element}},{key:"color",get:function(){return this._color}}]),e}();function c(e,t){if(e&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){for(var i=[],n=1;n<7;n+=2)i.push(parseInt("0x"+e.slice(n,n+2),16));return"RGBA("+i.join(",")+", "+t+")"}return e}d.pools=[];var u=d,h=function(){function e(e){this._formulaSelections=[],this._board=e}var t=e.prototype;return t.clear=function(){for(var e;e=this._formulaSelections.pop();)u.destroy(e)},t.remove=function(e){var t=this._formulaSelections[e];void 0!==t?(this._formulaSelections.splice(e,1),u.destroy(t)):console.error("can't find formula selection by index: ",e)},t.add=function(e){e.index=this._formulaSelections.length,this._formulaSelections.push(u.newInstance(this._board,e))},t.update=function(e,t){t.index=e;var i=this._formulaSelections[e];void 0!==i?i.setAttribute(t):console.error("can't find multiple selection by index: ",e)},e}(),p=function(e){function t(t,i){var n;return(n=e.call(this)||this).spreadsheetView=t,n.blockBoard=i,n.board=document.createElement("div"),n.board.classList.add("selection-stage-board"),n.blockBoard.hiddenBoard.append(n.board),n._formulaSelectionApi=new h(n.board),n}(0,a.Z)(t,e);var i=t.prototype;return i.addSelection=function(e,t){var i={left:e.left-this.blockBoard.globalOffsetX,top:e.top-this.blockBoard.globalOffsetY,width:e.width,height:e.height,padding:e.padding,display:t};this._formulaSelectionApi.add(i)},i.updateSelection=function(e,t,i){var n={left:t.left-this.blockBoard.globalOffsetX,top:t.top-this.blockBoard.globalOffsetY,width:t.width,height:t.height,padding:t.padding,display:i};this._formulaSelectionApi.update(e,n)},i.removeSelection=function(e){this._formulaSelectionApi.remove(e)},i.resetSelection=function(){this._formulaSelectionApi.clear()},i.show=function(){this.board.style.display="block"},i.hide=function(){this.board.style.display="none"},i.dispose=function(){e.prototype.dispose.call(this),this.board.remove()},(0,n.Z)(t,[{key:"formulaSelectionApi",get:function(){return this._formulaSelectionApi}}]),t}(i("../node_modules/@tencent/containerized/build/main/index.js").JT),f=i("../spread-sheet/src/core/view/level-1/select-center/base/stage/utils.ts"),m=i("../spread-sheet/src/core/view/lib/mutex-management/MutexManagement.ts"),v=function(e){function t(t,i,n){var a;return(a=e.call(this,t)||this).formulaSelectData=t,a.spreadsheetView=i,a.mutexManagement=n,a._showing=!0,a.handleUpdateSelections=(0,s.ad)((function(){for(var e=0;e<a._selectData.selectQueue.length;e++){var t=a._selectData.selectQueue[e];a._updateSelection({index:e,selection:t})}})),a.topLeft=a._register(new p(i,a.spreadsheetView.mainBoard.top.left)),a.topRight=a._register(new p(i,a.spreadsheetView.mainBoard.top.right)),a.bottomLeft=a._register(new p(i,a.spreadsheetView.mainBoard.bottom.left)),a.bottomRight=a._register(new p(i,a.spreadsheetView.mainBoard.bottom.right)),a._register(a.spreadsheetView.areaData.row.frozen.onUpdateViewSize(a.handleUpdateSelections)),a._register(a.spreadsheetView.areaData.row.flow.onUpdateViewSize(a.handleUpdateSelections)),a._register(a.spreadsheetView.areaData.col.frozen.onUpdateViewSize(a.handleUpdateSelections)),a._register(a.spreadsheetView.areaData.col.flow.onUpdateViewSize(a.handleUpdateSelections)),a._register(a.spreadsheetView.areaData.row.frozen.onUpdateTotalSize(a.handleUpdateSelections)),a._register(a.spreadsheetView.areaData.row.flow.onUpdateTotalSize(a.handleUpdateSelections)),a._register(a.spreadsheetView.areaData.col.frozen.onUpdateTotalSize(a.handleUpdateSelections)),a._register(a.spreadsheetView.areaData.col.flow.onUpdateTotalSize(a.handleUpdateSelections)),a.mutexManagement.addMutexComponent(m.d.SELECTION,(0,o.Z)(a)),a}(0,a.Z)(t,e);var i=t.prototype;return i.refresh=function(){},i.show=function(){this._showing||this._show()},i.hide=function(){this._showing&&this._hide()},i.mutexHide=function(){this._showing&&this._hide()},i._show=function(){this._showing=!0,this.topLeft.show(),this.topRight.show(),this.bottomLeft.show(),this.bottomRight.show(),this.mutexManagement.mutexShow(m.d.FORMULA_SELECTION)},i._hide=function(){this._showing=!1,this.topLeft.hide(),this.topRight.hide(),this.bottomLeft.hide(),this.bottomRight.hide()},i._addSelection=function(){var e=this,t=this.spreadsheetView.areaData;this.topLeft.resetSelection(),this.topRight.resetSelection(),this.bottomLeft.resetSelection(),this.bottomRight.resetSelection(),this._selectData.selectQueue.forEach((function(i){var n=(0,f.i)(e.spreadsheetView.tableView,t,i);e.topLeft.addSelection(n,n.startRow<=t.row.frozen.to&&n.startCol<=t.col.frozen.to),e.topRight.addSelection(n,n.startRow<=t.row.frozen.to&&n.endCol>=t.col.flow.from),e.bottomLeft.addSelection(n,n.endRow>=t.row.flow.from&&n.startCol<=t.col.frozen.to),e.bottomRight.addSelection(n,n.endRow>=t.row.flow.from&&n.endCol>=t.col.flow.from)}))},i._updateSelection=function(e){var t=e.index,i=e.selection,n=this.spreadsheetView.areaData,o=(0,f.i)(this.spreadsheetView.tableView,n,i);this.topLeft.updateSelection(t,o,o.startRow<=n.row.frozen.to&&o.startCol<=n.col.frozen.to),this.topRight.updateSelection(t,o,o.startRow<=n.row.frozen.to&&o.endCol>=n.col.flow.from),this.bottomLeft.updateSelection(t,o,o.endRow>=n.row.flow.from&&o.startCol<=n.col.frozen.to),this.bottomRight.updateSelection(t,o,o.endRow>=n.row.flow.from&&o.endCol>=n.col.flow.from)},i._removeSelection=function(e){this.topLeft.removeSelection(e),this.topRight.removeSelection(e),this.bottomLeft.removeSelection(e),this.bottomRight.removeSelection(e)},i._resetSelection=function(){this.topLeft.resetSelection(),this.topRight.resetSelection(),this.bottomLeft.resetSelection(),this.bottomRight.resetSelection()},(0,n.Z)(t,[{key:"showing",get:function(){return this._showing}}]),t}(r.Z)},"../spread-sheet/src/core/view/level-1/input-manager/InputManager.pc.ts":function(e,t,i){i.d(t,{wq:function(){return Ae},ZP:function(){return We}});var n=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=i("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(i("../node_modules/core-js/modules/es.object.assign.js"),i("../node_modules/i18next/dist/esm/i18next.js")),r=i("../node_modules/@tencent/dui/lib/components/Modal/index.js"),l=i("../spread-sheet/src/core/view/level-1/input-manager/InputVariables.ts"),d=i("../packages/model/src/range/hexRangeUtils.ts"),c=i("../node_modules/@tencent/containerized/build/main/index.js"),u=function(e){function t(t){var i;return(i=e.call(this)||this).label=i.renderDom("bar-label"),i.setCellCoordinate(),t.parent.appendChild(i.label),i}(0,a.Z)(t,e);var i=t.prototype;return i.dispose=function(){this.label.remove()},i.setCellCoordinate=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=0),"number"===typeof e&&"number"===typeof t){var i=(0,d.colIndex2ColChar)(t)+(e+1);this.updateContent(i)}else console.error("Error(setCellCoordinate): 参数出错！")},i.updateContent=function(e){this.label.innerText=e},i.renderDom=function(e){var t=document.createElement("div");return t.classList.add(e),t},t}(c.JT),h=i("../packages/editor/src/AlloySimpleTextEditor.ts"),p=function(e){function t(t,i,n){var o;return(o=e.call(this)||this).parent=t,o.sheetStatus=i,o.fireSyncOutFormulaInput=n,o.syncFormulaInputValue2TableInput=function(e){if(e.source!==o.alloySTE.SOURCE.SILENT){var t=o.alloySTE.getText();o.fireSyncOutFormulaInput({cmd:Ae.SYNC_CONTENT,data:{value:t}})}},o.handleSheetStatusChange=function(){o.alloySTE.setEditable(o.sheetStatus.canEdit)},o.alloySTE=new h.Z({parent:o.parent,className:"formula-input",editable:o.sheetStatus.canEdit}),o.registerEvents(),o}(0,a.Z)(t,e);var i=t.prototype;return i.setContent=function(e){this.alloySTE.clear(),this.alloySTE.setText(e,this.alloySTE.SOURCE.SILENT)},i.dispose=function(){e.prototype.dispose.call(this),this.alloySTE.keyboard.destroy()},i.registerEvents=function(){var e=this;this.alloySTE.input.addEventListener("mousedown",(function(){e.fireSyncOutFormulaInput({cmd:Ae.ENTER_FORMULA_INPUT})})),this.alloySTE.on(this.alloySTE.EVENT.VALUE_CHANGE,this.syncFormulaInputValue2TableInput),this.alloySTE.keyboard.addBindings(this.keyBindings),this.sheetStatus.change(this.handleSheetStatusChange)},i.syncFormulaFormatCmd2TableInput=function(e){if(e){var t=this.alloySTE.getSelection();this.fireSyncOutFormulaInput({cmd:Ae.EXEC_FORMAT,data:{value:e,range:t||void 0}})}},(0,n.Z)(t,[{key:"keyBindings",get:function(){var e=this;return[{key:"b",shortKey:!0,override:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("bold"),!1}},{key:"i",shortKey:!0,override:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("italic"),!1}},{key:"u",shortKey:!0,override:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("underline"),!1}},{key:"d",shortKey:!0,override:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("strikeThrough"),!1}},{key:"5",ctrlKey:!0,override:!0,handler:function(){return e.syncFormulaFormatCmd2TableInput("strikeThrough"),!1}}]}}]),t}(c.JT),f=function(e){function t(t){var i;return(i=e.call(this)||this).startDragHandler=function(){i.isDragging=!0},i.draggingHandler=function(e){i.isDragging&&i.draggerHandler({clientX:e.clientX,clientY:e.clientY})},i.endDragHandler=function(){i.isDragging=!1},i.dragger=i.renderDom("bar-dragger"),t.parent.appendChild(i.dragger),i.isDragging=!1,i.draggerHandler=t.draggerHandler,i.registerEvents(),i}(0,a.Z)(t,e);var i=t.prototype;return i.dispose=function(){e.prototype.dispose.call(this),this.dragger.removeEventListener("mousedown",this.startDragHandler),document.removeEventListener("mousemove",this.draggingHandler),document.removeEventListener("mouseup",this.endDragHandler),document.removeEventListener("click",this.endDragHandler),this.dragger.remove()},i.registerEvents=function(){this.dragger.addEventListener("mousedown",this.startDragHandler),document.addEventListener("mousemove",this.draggingHandler),document.addEventListener("mouseup",this.endDragHandler),document.addEventListener("click",this.endDragHandler)},i.renderDom=function(e){var t=document.createElement("div");return t.classList.add(e),t},t}(c.JT),m=function(e){function t(t,i,n,o,a,s){var r;return(r=e.call(this)||this).sheetStatus=t,r.spreadsheetView=i,r.container=n,r.fireSyncOutFormulaInput=o,r.onSyncInFormulaInput=a,r.mountDom=s,r.barContainer=r.renderDom("formula-bar"),r.attachToParent(r.barContainer),r.initComponents(),r.registerMessageChanel(),r}(0,a.Z)(t,e);var i=t.prototype;return i.updateContent=function(e){var t=e.rowIndex,i=e.colIndex,n=e.value;this.barLabel.setCellCoordinate(t,i),this.sheetStatus.isCellPrivate(t,i)?this.formulaInput.setContent(s.ZP.t("此单元格已开启填写内容隐藏，你无法查看")):this.sheetStatus.isCellCanNotRead(t,i)?this.formulaInput.setContent(""):this.formulaInput.setContent(n||"")},i.dispose=function(){e.prototype.dispose.call(this),this.barContainer.remove()},i.initComponents=function(){this.barLabel=this._register(new u({parent:this.barContainer})),this.formulaInput=this._register(new p(this.barContainer,this.sheetStatus,this.fireSyncOutFormulaInput)),this.barDragger=this._register(new f({parent:this.barContainer,draggerHandler:this.handleDragger.bind(this)}))},i.registerMessageChanel=function(){var e=this;this.onSyncInFormulaInput((function(t){e.updateContent(t)}))},i.handleDragger=function(e){var t=this.barContainer.getBoundingClientRect().top,i=e.clientY-t;this.updateFormulaBarHeight(i),this.updateCanvasContainerHeight()},i.updateCanvasContainerHeight=function(){var e=this.container,t=e.getBoundingClientRect().top,i=window.innerHeight-t-36;e.style.height=i+"px",this.spreadsheetView.resize.resize()},i.attachToParent=function(e){if(!document.querySelector("#mainContainer .formula-bar")){var t=document.querySelector("#mainContainer"),i=document.querySelector("#mainContainer .ae-formula-bar");i&&(null===t||void 0===t||t.removeChild(i)),null===t||void 0===t||t.insertBefore(e,document.getElementById("mainEditor"))}},i.updateFormulaBarHeight=function(e){e=Math.max(e,25),e=Math.min(e,75),this.barContainer.style.height=e+"px",this.barContainer.style.lineHeight=e+"px"},i.renderDom=function(e){var t=document.createElement("div");return e&&t.classList.add(e),t},(0,n.Z)(t,[{key:"alloySTE",get:function(){return this.formulaInput.alloySTE}}]),t}(c.JT),v=i("../packages/editor/src/AlloyRichTextEditor.ts"),g=i("../packages/editor/src/interface.ts"),w=(i("../node_modules/core-js/modules/es.string.bold.js"),i("../node_modules/core-js/modules/es.string.italics.js"),i("../node_modules/core-js/modules/es.array.map.js"),i("../node_modules/core-js/modules/es.object.keys.js"),i("../spread-sheet/src/core/view/spreadsheet-view/model/WrapStrategy.ts")),S=i("../packages/editor/src/helper/utils.ts"),_=i("../node_modules/lodash/clone.js"),y=i.n(_),E=i("../spread-sheet/src/base/helper/font-polyfill.ts"),b=i("../spread-sheet/src/base/config/font.ts"),x=i("../packages/model/src/cell/format/Color.ts"),T=i("../packages/model/src/cell/format/ThemeColor.ts");function I(e,t,i){var n;if(!e||!t)return{editValue:"",cellStyles:A,textStyleRuns:V,mentionDetails:null};var o=(null===(n=e.cellFormat)||void 0===n?void 0:n.getTextFormat())||null,a=function(e,t){if(!e)return y()(A);var i=y()(R),n=y()(D);return"string"===typeof e.backgroundColor&&(i["background-color"]=e.backgroundColor),e.textAlgin&&(i["text-align"]=e.textAlgin),e.vertialAlgin&&(i["vertical-align"]=e.vertialAlgin),e.wrapStrategy===w.J.NORMAL&&(i["word-wrap"]="break-word",i["word-break"]="break-all"),e.textFormat&&((n=C(e.textFormat,t))["text-decoration"]=void 0,n["text-decoration-skip-ink"]=void 0),Object.assign(Object.assign({},i),n)}({textAlgin:t.style.horizontalAlign.value,vertialAlgin:t.style.verticalAlign.value,backgroundColor:t.style.background.hex,wrapStrategy:t.style.wrapStrategy.value,textFormat:o},i),s=function(e,t){return e&&e.length>0?e.map((function(e){return{startIndex:e.startIndex,format:C(e.format,t)}})):[{startIndex:0,format:y()(D)}]}(e.textFormatRuns,i),r=function(e){return e?Object.keys(e).map((function(t){return e[t].toObject()})):null}(e.mentionDetails);return{editValue:e.editValue||"",cellStyles:a,textStyleRuns:s,mentionDetails:r}}var D={"font-family":b.em,"font-size":"10pt",color:"rgba(0, 0, 0, 1)","font-weight":"normal","font-style":"normal","text-decoration":"none","text-decoration-skip-ink":"none","data-theme-color":""};function C(e,t){if(!e)return D;var i=y()(D);if(e.bold&&(i["font-weight"]="bold"),e.italic&&(i["font-style"]="italic"),"number"===typeof e.fontSize&&(i["font-size"]=e.fontSize+"pt"),e.fontFamily){var n=e.fontFamily;i["font-family"]=(0,E.A)(n)}return e.color&&(i.color=x.Z.getStringRGBA(e.color,t),T.ZP.isTargetType(e.color)&&(i[S.IH]=e.color.serialize())),(e.strikethrough||e.underline)&&(i["text-decoration"]="",e.strikethrough&&(i["text-decoration"]+="line-through"),e.underline&&(i["text-decoration"]+=" underline",2===e.underline&&console.warn("warning: 暂时不支持双下划线！处理成单下划线了。"))),i}var R={"background-color":"rgba(255, 255, 255, 1)","text-align":"left","vertical-align":"middle"},A=Object.assign(Object.assign({},R),D),V=[{startIndex:0,format:D}],k=function(e){function t(t){var i;return i=e.call(this,t)||this,t.sheetStatus.canEdit&&i.alloyRTE.focus(),i}return(0,a.Z)(t,e),t.prototype.initAlloyRTE=function(){this.alloyRTE=new v.Z({parent:this.parent,className:"table-input",platform:g.t4.PC,editable:this.sheetStatus.canEdit,defaultCellStyle:y()(A),defaultTextStyle:y()(D)})},t}(function(){function e(e){var t=this;this.handleSheetStatusChange=function(){t.alloyRTE.setEditable(t.sheetStatus.canEdit)},this.sheetStatus=e.sheetStatus,this.parent=e.parent,this.initAlloyRTE(),this.initEvent()}return e.prototype.initEvent=function(){this.sheetStatus.change(this.handleSheetStatusChange)},e}()),j=i("../node_modules/@tencent/docs-user-agent/dist/index.js"),L=i.n(j);function M(e){var t=function(e){var t=e;return t&&t.children&&e.id===g.al?(document.queryCommandSupported("styleWithCss")||function(e){if(e){var t={strong:{prop:"font-weight",value:"bold"},em:{prop:"font-style",value:"italic"},u:{prop:"text-decoration-line",value:"underline"},strike:{prop:"text-decoration-line",value:"line-through"}};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))for(var n=t[i],o=[].slice.call(e.querySelectorAll(i)),a=0;a<o.length;a++)o[a].setAttribute("style",n.prop+": "+n.value+";");for(var s=[].slice.call(e.querySelectorAll("font[face]")),r=0;r<s.length;r++){var l=s[r];l.style["font-family"]=l.getAttribute("face")}for(var d=[].slice.call(e.querySelectorAll("font[color]")),c=0;c<d.length;c++){var u=d[c];u.style.color=u.getAttribute("color")}}}(t),t):null}(e);if(!t)return null;var i=Array.from(t.childNodes).map((function(e){return F(e,{},[])})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return!(!e.text||""===e.text)}));return i=function(e){if(!e||e.length<=1)return e;for(var t,i,n=0;n<e.length-1;)t=e[n],i=e[n+1],N(t.style,i.style)?(t.text+=i.text,e.splice(n+1,1)):n+=1;return e}(i)}function O(e){if(!e||!e.children)return null;if(!e.querySelector("."+g.QP))return null;var t=0,i=[];return function e(n){var o;if(n.nodeType===Node.TEXT_NODE||"BR"===n.tagName)n.nodeType===Node.TEXT_NODE?t+=(n.textContent||"").length:t+=1;else if(n&&n.className===g.QP){var a=null;if(null===(o=n.dataset)||void 0===o?void 0:o.mentionDetail)try{a=JSON.parse(n.dataset.mentionDetail)}catch(Ie){console.error("JSON Parse MentionDetail error!")}if(a){var s=a.text.trim(),r=[t,t+s.length];a.pos=r,i.push(a),t+=s.length}else t+=(n.textContent||"").trim().length}else for(var l=0;l<n.childNodes.length;l++)e(n.childNodes[l])}(e),i}function F(e,t,i){var n;if((null===e||void 0===e?void 0:e.style)&&Object.assign(t,function(e,t){var i={},n=null===e||void 0===e?void 0:e.getAttribute(S.IH);if(n&&(i.dataThemeColor=n,delete t.color),null===e||void 0===e?void 0:e.style){var o=e.style,a=o.getPropertyValue("color")||o.color;a&&(i.color=a,delete t.dataThemeColor);var s=o.getPropertyValue("font-family")||o["font-family"],r=s.replace(/"|'/g,"");s&&-1===r.indexOf(b.em)&&(s.indexOf(",")>-1&&(s=s.split(",")[0]),i.fontFamily=s.replace(/"|'/g,"")),-1!==r.indexOf(b.em)&&(i.fontFamily=b.em);var l=o.getPropertyValue("font-size")||o["font-size"];l&&(i.fontSize=l);var d=o.getPropertyValue("font-weight")||o["font-weight"];d&&(i.bold="bold"===d);var c=o.getPropertyValue("font-style")||o["font-style"];c&&(i.italic="italic"===c);var u=o.getPropertyValue("text-decoration-line")||o.getPropertyValue("text-decoration")||o["text-decoration-line"]||o["text-decoration"];u&&u.indexOf("line-through")>=0&&(i.strikethrough=!0),(u&&u.indexOf("underline")>=0||e.tagName&&"U"===e.tagName.toUpperCase())&&(i.underline=!0)}return i}(e,t)),"BR"===e.nodeName)i.push({text:String.fromCharCode(10),style:Object.assign({},t)});else if(e.nodeType===Node.TEXT_NODE)i.push({text:e.textContent||"",style:Object.assign({},t)});else if(e&&e.className===g.QP)i.push({text:(null===(n=e.textContent)||void 0===n?void 0:n.trim())||"",style:{bold:!1,color:"rgb(1,136,251)",fontFamily:b.em,fontSize:"10pt",italic:!1}});else for(var o=0;o<e.childNodes.length;o++)F(e.childNodes[o],Object.assign({},t),i);return i}function N(e,t){if(e&&t){var i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(i.length!==n.length)return!1;for(var o=0;o<i.length;o++){var a=i[o];if(e[a]!==t[a])return!1}return!0}return!1}i("../node_modules/core-js/modules/es.array.filter.js"),i("../node_modules/core-js/modules/es.array.from.js"),i("../node_modules/core-js/modules/es.string.iterator.js"),i("../node_modules/core-js/modules/es.array.concat.js"),i("../node_modules/core-js/modules/es.string.trim.js"),i("../node_modules/core-js/modules/es.array.slice.js"),i("../node_modules/core-js/modules/es.regexp.exec.js"),i("../node_modules/core-js/modules/es.string.replace.js"),i("../node_modules/core-js/modules/es.string.split.js"),i("../node_modules/core-js/modules/es.array.splice.js"),i("../node_modules/core-js/modules/es.object.get-own-property-names.js");var P=i("../node_modules/@tencent/tdocs-format-render/lib/index.js"),z=i("../packages/model/src/cell/cellDataUtils.ts"),U=i("../spread-sheet/src/core/feature/formula/UIUtils.ts");function Z(e){return e+"px"}function B(e,t){e=H(e);var i=!1;if(t){var n=(0,z.getExportFormat)(t);n&&(0,P.isTextCell)(n.getNumberFormat())&&(i=!0)}return{isFormula:!i&&/^=$|^=[^=]/.test(e),isStock:/^=STOCK\(/i.test(e)}}function H(e){return e&&"string"===typeof e&&(e=(e=(e=e.replace(/\r\n$/,"\n")).replace(/\n$/,"")).replace(String.fromCharCode(65279),"")),e}var W,K=function(){function e(e,t,i,n,o){this.spreadsheet=e,this.sheetStatus=t,this.spreadsheetView=i,this.mountDom=n,this.saveContent=o}var t=e.prototype;return t.show=function(e){this.initInputRawData=e.initInputRawData,this.cellView=e.cellView,this.row=e.initInputRawData.row,this.col=e.initInputRawData.col},t.hide=function(){this.setStyle({left:"-9999px",top:"0px"})},t.dismiss=function(){this.hide(),this.alloyRTE.clear(),this.tooltipCard.hide()},t.extractInputData=function(){var e=this.alloyRTE.getText(),t=this.spreadsheet.activeSheet.getCellDataAtPosition(this.row,this.col);if(e=function(e,t){return B(e,t).isFormula&&(e=H(e=(0,U.$)(e))),e}(e,t),B(e,t).isFormula)return{text:e,textFormatInfos:null,mentionDetails:null};var i=this.alloyRTE.getInputDom();return{text:e,textFormatInfos:M(i),mentionDetails:O(i)}},t.showTooltip=function(e){this.tooltipCard.showWithType(e)},t.addIcon=function(e){this.tableInputIcon.addIcon(e)},t.hideIcon=function(){this.tableInputIcon.hideIcon()},t.setStyle=function(e){var t=Object.prototype.hasOwnProperty;for(var i in e)t.call(e,i)&&(this.stageElement.style[i]=e[i])},(0,n.Z)(e,[{key:"alloyRTE",get:function(){return this.tableInput.alloyRTE}}]),e}();!function(e){e[e.INPUT_HIDE=0]="INPUT_HIDE",e[e.INPUT_DELETE=1]="INPUT_DELETE"}(W||(W={}));var Y=function(){function e(t){this.element=e.getElement(),t.appendChild(this.element)}e.getElement=function(){var e=document.createElement("div");return e.classList.add("tooltip-card"),e};var t=e.prototype;return t.showWithType=function(e){switch(e){case W.INPUT_HIDE:this.showWidthContent(s.ZP.t("单元格被隐藏"));break;case W.INPUT_DELETE:this.showWidthContent(s.ZP.t("单元格已删除"))}},t.hide=function(){this.element.innerText="",this.element.style.display="none"},t.showWidthContent=function(e){this.element.innerText=e,this.element.style.display="block"},e}(),X=i("../packages/model/src/cell/CellFormat.ts"),Q=i("../spread-sheet/src/core/view/spreadsheet-view/utils.ts"),G=i("../spread-sheet/src/core/view/config/default.ts"),q=i("../spread-sheet/src/core/view/spreadsheet-view/model/HorizontalAlign.ts");function J(e,t,i,n){var o,a=function(e,t,i,n){for(var o,a,s=(null===(o=e.paragraphAccessor.getParagraph(i,n))||void 0===o?void 0:o.width)||0,r=(0,Q.o)(e.rowcolAccessor,t,n),l=e.areaData.inFrozenColArea(n)?0:e.rowcolAccessor.getFrozenColCount(),d=r,c=n,u=n+((null===(a=null===t||void 0===t?void 0:t.mergeData)||void 0===a?void 0:a.colCount)||1)-1,h=!1;t&&s>d;)if(c<=l&&(h=!0),h||t.style.horizontalAlign.value!==q.O.RIGHT&&t.style.horizontalAlign.value!==q.O.CENTER||(c-=1,d+=e.rowcolAccessor.isColHidden(c)?0:e.rowcolAccessor.getColSetWidth(c)),h||t.style.horizontalAlign.value===q.O.LEFT||t.style.horizontalAlign.value===q.O.CENTER){if(u>=e.rowcolAccessor.getColCount()-1)break;u+=1,d+=e.rowcolAccessor.isColHidden(u)?0:e.rowcolAccessor.getColSetWidth(u)}return{inputStageWidth:d=Math.max(d,s),leftCol:c,rightCol:u}}(e,t,i,n),s=a.inputStageWidth,r=a.leftCol,l=a.rightCol,d=(0,Q.E)(e.rowcolAccessor,t,i),c=e.rowcolAccessor.getFrozenColCount()-1;c>=r&&c<l&&(s+=G.kW);var u=e.rowcolAccessor.getFrozenRowCount()-1;u>=i&&u<i+((null===(o=null===t||void 0===t?void 0:t.mergeData)||void 0===o?void 0:o.rowCount)||1)-1&&(d+=G.kW);var h=e.areaData.getViewLeftByCol(r),p=e.areaData.inFrozenColArea(r)?0:e.areaData.col.frozen.viewSize,f=e.areaData.getViewTopByRow(i),m=e.areaData.inFrozenRowArea(i)?0:e.areaData.row.frozen.viewSize;return h=Math.max(h,p),f=Math.max(f,m),h-=G.kD,f-=G.kD,{inputStageWidth:s+=2*G.kD,inputStageHeight:d+=2*G.kD,left:h,top:f}}(0,c.yh)("ITableInputIcon");var $="table-input-icon",ee=function(e){function t(){return e.apply(this,arguments)||this}(0,a.Z)(t,e);var i=t.prototype;return i.addIcon=function(e){var t;this.hideIcon(),this._alloyRTEInputDom.style.paddingLeft="24px";var i=document.createElement("div");i.id=$,i.style.width="16px",i.style.height="16px",i.style.position="absolute",i.style.top="0px",i.style.bottom="0px",i.style.left="4px",i.style.margin="auto",null===(t=this._alloyRTEInputDom.parentNode)||void 0===t||t.appendChild(i),e(i)},i.hideIcon=function(){var e,t=document.getElementById($);t&&(null===(e=this._alloyRTEInputDom.parentNode)||void 0===e||e.removeChild(t)),this._alloyRTEInputDom.style.paddingLeft="4px"},t}((function(e){this._alloyRTEInputDom=e.alloyRTEInputDom})),te=ee,ie=function(e){function t(t,i,n,o,a){var s;return(s=e.call(this,t,i,n,o,a)||this).spreadsheet=t,s.sheetStatus=i,s.spreadsheetView=n,s.mountDom=o,s.saveContent=a,s.setupStage(),s}(0,a.Z)(t,e);var i=t.prototype;return i.show=function(t){e.prototype.show.call(this,t),this.tooltipCard.hide(),this.update();var i=this.transform2InputInitData(this.initInputRawData,this.cellView);this.alloyRTE.show(i)},i.mutexHide=function(){null!==this.initInputRawData?this.saveContent():this.dismiss()},i.hide=function(e){var t=this.spreadsheetView.headSize,i=t.displayRowHeadWidth,n=t.displayColHeadHeight,o=J(this.spreadsheetView,this.cellView,(null===e||void 0===e?void 0:e.row)||0,(null===e||void 0===e?void 0:e.col)||0),a=o.left,s=o.top,r=i+a*this.spreadsheetView.scale.scale,l=n+s*this.spreadsheetView.scale.scale;this.setStageStyle({left:r,top:l,borderWidth:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})},i.update=function(e){void 0!==(null===e||void 0===e?void 0:e.row)&&(this.row=e.row),void 0!==(null===e||void 0===e?void 0:e.col)&&(this.col=e.col);var t=this.getStageRect(this.cellView,this.row,this.col);t?this.setStageStyle(t):this.hide()},i.setupStage=function(){var e=document.createElement("div");e.classList.add("table-input-board"),Object.assign(e.style,{"user-select":"auto","-webkit-user-select":"auto"}),this.stageElement=document.createElement("div"),this.stageElement.classList.add("table-input-stage"),e.appendChild(this.stageElement),this.mountDom.appendChild(e),this.stageElement.addEventListener("contextmenu",(function(e){e.stopPropagation()})),this.tooltipCard=new Y(this.stageElement),this.tableInput=new k({sheetStatus:this.sheetStatus,parent:this.stageElement}),this.tableInputIcon=new te({alloyRTEInputDom:this.tableInput.alloyRTE.input}),this.dismiss()},i.setStageStyle=function(e){var t={transform:"scale("+this.spreadsheetView.scale.scale+")",left:Z(e.left),top:Z(e.top),"min-width":Z(e.minWidth),"max-width":Z(e.maxWidth),"min-height":Z(e.minHeight),"max-height":Z(e.maxHeight)};void 0!==e.borderWidth&&(t["border-width"]=Z(e.borderWidth)),this.setStyle(Object.assign(Object.assign({},{opacity:"1","pointer-events":"auto"}),t)),this.alloyRTE.setEditorContainerStyles({"min-height":Z(e.minHeight-2*G.kD),"max-height":Z(e.maxHeight-2*G.kD)}),this.alloyRTE.setEditorInputStyles({"min-width":Z(e.minWidth-2*G.kD),"max-width":Z(e.maxWidth-2*G.kD),height:Z(e.minHeight-2*G.kD),"min-height":Z(e.minHeight-2*G.kD),"max-height":Z(e.maxHeight-2*G.kD)})},i.transform2InputInitData=function(e,t){var i;return L().isIE&&(null===(i=null===e||void 0===e?void 0:e.cellFormat)||void 0===i?void 0:i.textFormat)&&(e.cellFormat=X.Z.createInstance(Object.assign(Object.assign({},e.cellFormat.getOptions()),{textFormat:Object.assign(Object.assign({},e.cellFormat.textFormat.getOptions()),{bold:!1,italic:!1})}))),I(e,t,this.spreadsheet)},i.getStageRect=function(e,t,i){if((null===e||void 0===e?void 0:e.mergeParent)&&(t+=e.mergeParent.y,i+=e.mergeParent.x,e=this.spreadsheetView.tableView.getCellViewAtPosition(t,i)),this.shouldHide(e,t,i))return null;var n=J(this.spreadsheetView,e,t,i),o=n.inputStageWidth,a=n.inputStageHeight,s=n.left,r=n.top,l=this.spreadsheetView.scale.scale,d=this.spreadsheetView.clientRect.width/l,c=this.spreadsheetView.clientRect.height/l,u=this.spreadsheetView.headSize,h=u.rowHeadWidth,p=u.colHeadHeight,f=Math.min((null===e||void 0===e?void 0:e.isAutoWrap())?o:1/0,d-h-s),m=c-p-r;return{minWidth:Math.min(o,f),maxWidth:f,minHeight:Math.min(a,m),maxHeight:m,borderWidth:2,left:(s+h)*l,top:(r+p)*l}},i.shouldHide=function(e,t,i){var n=this.spreadsheetView,o=n.clientRect,a=n.headSize,s=n.areaData,r=this.spreadsheetView.scale.scale,l=(0,Q.o)(this.spreadsheetView.rowcolAccessor,e,i),d=(0,Q.E)(this.spreadsheetView.rowcolAccessor,e,t),c=s.getViewLeftByCol(i),u=s.getViewTopByRow(t),h=s.inFrozenColArea(i)?0:s.col.frozen.viewSize,p=s.inFrozenRowArea(t)?0:s.row.frozen.viewSize;return h>c+l||c>o.width/r-a.rowHeadWidth||p>u+d||u>o.height/r-a.colHeadHeight},t}(K),ne=i("../spread-sheet/src/core/view/level-1/input-manager/utils.ts"),oe=(i("../node_modules/regenerator-runtime/runtime.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.promise.js"),i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../node_modules/core-js/modules/es.regexp.to-string.js"),i("../node_modules/@tencent/dui/lib/components/Snackbar/index.js")),ae=i("../packages/lib/EventEmitter.ts"),se=i("../packages/model/src/range/GridRange.ts"),re=i("../packages/model/src/cell/TextFormatRun.ts"),le=i("../packages/model/src/dimension/index.ts"),de=i("../packages/mutation/src/MutationId.ts"),ce=i("../spread-sheet/src/core/utils/index.ts"),ue=i("../spread-sheet/src/core/behavior/utils.ts"),he=i("../spread-sheet/src/core/view/lib/mutex-management/MutexManagement.ts"),pe=i("../packages/model/src/cell/metadata/CustomDataType.ts"),fe=i("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),me=i("../spread-sheet/src/base/util/domain-config.ts"),ve=i("../spread-sheet/src/core/view/utils/base-func.ts"),ge=i("../spread-sheet/src/core/view/level-2/formula-ui-center/utils.ts"),we=i("../spread-sheet/src/core/feature/formula/utils/parseUtil.ts"),Se=i("../spread-sheet/src/core/feature/formula/autofix.ts"),_e=i("../spread-sheet/src/core/feature/formula/utils.ts"),ye=i("../packages/model/src/cell/index.ts"),Ee=i("../spread-sheet/src/core/behavior/request/cell/SetSingleValueRequest.ts"),be=i("../spread-sheet/src/core/behavior/request/Type.ts"),xe=i("../spread-sheet/src/core/behavior/requests.ts"),Te=i("../spread-sheet/src/base/error/errorCodeModalProxy.ts"),Ie=i("../spread-sheet/src/base/error/index.ts"),De=function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function s(e){try{l(n.next(e))}catch(t){a(t)}}function r(e){try{l(n.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))},Ce=function(e){function t(t,i,n,o,a,s,r,d,c,u,h,p,f,m,v){var g;return(g=e.call(this)||this).view=t,g.spreadsheet=i,g.mutationBehavior=n,g.sheetStatus=o,g.spreadsheetView=a,g.dataCallView=s,g.modifyCellBroker=r,g.normalSelectData=d,g.formulaSelectData=c,g.normalSelectionStage=u,g.mutexManagement=h,g.linkIdentifyCenter=p,g.defaultScale=f,g.scrollApi=m,g.slideOperate=v,g.canInput=!0,g.position=null,g.isEditPending=!1,g.isInputtingState=function(){return g.variables.status!==l.Xz.DEFAULT},g.setEditPendingStatus=function(e){g.isEditPending=e},g.handleUpdateOffset=function(){g.updateInputStagePosition()},g.handleScale=function(){g.updateInputStagePosition()},g.handleRestart=function(){g.blur()},g.handleInsertRowCol=function(e){var t;if(g.isInputtingState()&&g.spreadsheet.activeSheetId===(null===(t=g.initInputRawData)||void 0===t?void 0:t.sheetId)){var i=e.index,n=e.amount,o=e.type,a=g.initInputRawData.row,s=g.initInputRawData.col,r=a,l=s;o===le.DIMENSION_TYPE.ROWS&&i<=a?r+=n:o===le.DIMENSION_TYPE.COLUMNS&&i<=s&&(l+=n),g.initInputRawData.row=r,g.initInputRawData.col=l,g.scrollTableIfNeedMakeInputPositionStable(),g.afterRowColChange(),g.tableInputStage.update({row:r,col:l})}},g.handleDeleteRowCol=function(e){var t;if(g.isInputtingState()&&g.spreadsheet.activeSheetId===(null===(t=g.initInputRawData)||void 0===t?void 0:t.sheetId)){var i=e.index,n=e.amount,o=e.type,a=g.initInputRawData.row,s=g.initInputRawData.col,r=i,l=i+n-1,d=a,c=s;o===le.DIMENSION_TYPE.ROWS&&(r<=a&&a<=l?d=-1:r<=a&&l<a&&(d-=n)),o===le.DIMENSION_TYPE.COLUMNS&&(r<=s&&s<=l?c=-1:r<=s&&l<s&&(c-=n)),g.initInputRawData.row=d,g.initInputRawData.col=c,g.scrollTableIfNeedMakeInputPositionStable(),g.afterRowColChange(),-1===d||-1===c?g.tableInputStage.showTooltip(W.INPUT_DELETE):g.tableInputStage.update({row:d,col:c})}},g.handleSetRowHeightColWidth=function(){var e;g.isInputtingState()&&g.spreadsheet.activeSheetId===(null===(e=g.initInputRawData)||void 0===e?void 0:e.sheetId)&&(g.scrollTableIfNeedMakeInputPositionStable(),g.tableInputStage.update())},g.handleSetRowVisibleColVisible=function(e){var t;g.isInputtingState()&&g.spreadsheet.activeSheetId===(null===(t=g.initInputRawData)||void 0===t?void 0:t.sheetId)&&(g.scrollTableIfNeedMakeInputPositionStable(),g.tableInputStage.update(),(g.spreadsheet.activeSheet.data.isRowHidden(g.initInputRawData.row)||g.spreadsheet.activeSheet.data.isColHidden(g.initInputRawData.col))&&g.traverseRangesCheckHit(e.ranges,g.initInputRawData.row,g.initInputRawData.col)&&g.tableInputStage.showTooltip(W.INPUT_HIDE))},g.handleUpdateCells=function(e){var t=e.mutation,i=e.isCollab;if(g.isInputtingState()&&i&&de.ZP.SET_CELL_PROPERTIES_MUTATION===t.id){var n=g.initInputRawData,o=n.row,a=n.col;t.gridRange.contain(new se.Z(g.spreadsheet.activeSheetId,o,o,a,a))&&(g.initInputRawData.isCollaborationChanged=!0)}},g.emitter=new ae.Z,g.variables=new l.ZP(l.Xz.DEFAULT,l.n$.TEXT),g.spreadsheet.parent.emitter.on(g.spreadsheet.parent.EVENT.RESTART_END,g.handleRestart),g.hasCanceledMention=!1,g}(0,a.Z)(t,e);var o=t.prototype;return o.isToolbarReady=function(){return this.view.header&&this.view.mobileToolBar&&this.view.footer},o.isInputtingStable=function(){return this.variables.status===l.Xz.STABLE_INPUT},o.isInputtingQuick=function(){return this.variables.status===l.Xz.QUICK_INPUT},o.isInputtingToolbar=function(){return this.variables.status===l.Xz.TOOLBAR_INPUT},o.switchInputType=function(e){this.variables.switchType(e)},o.switchInputStatus=function(e){this.sheetStatus.canEdit&&this.variables.switchStatus(e)},o.switchFocusDomNode=function(){L().isMobile||(L().isIPad?this.spreadsheetView.operateContext.operateBoard.board:this.alloyRTE).focus()},o.undo=function(){this.alloyRTE.undo()},o.redo=function(){this.alloyRTE.redo()},o.canUndo=function(){return this.alloyRTE.canUndo()},o.canRedo=function(){return this.alloyRTE.canRedo()},o.isComposing=function(){return this.alloyRTE.isComposing()},o.hasFocus=function(){return this.alloyRTE.hasFocus()},o.focus=function(){this.alloyRTE.focus(),this.emitter.emit(t.EVENT.FOCUS)},o.blur=function(){this.alloyRTE.blur()},o.format=function(e,t){this.alloyRTE.format(e,t)},o.getFormat=function(){return this.alloyRTE.getFormat()},o.getText=function(e){return void 0===e&&(e=!1),this.alloyRTE.getText(e)},o.setText=function(e,t){this.alloyRTE.setText(e,t)},o.insertNewLine=function(){this.alloyRTE.insertNewLine()},o.getSelection=function(){return this.alloyRTE.getSelection()},o.setSelection=function(e){this.alloyRTE.setSelection(e)},o.collapseToEnd=function(){this.isInputtingState()&&this.alloyRTE.collapseToEnd()},o.hide=function(){this.alloyRTE.blur(),this.normalSelectionStage.show()},o.handleEnterInput=function(){this.position=this.getPosition(this.initInputRawData.row,this.initInputRawData.col),this.mutexManagement.mutexShow(he.d.INPUT),this.variables.status===l.Xz.DEFAULT&&(this.variables.switchStatus(l.Xz.STABLE_INPUT),this.alloyRTE.setActive(!0)),this.isInputtingQuick()||this.alloyRTE.collapseToEnd(),this.isEditPending&&(this.isEditPending=!1),this.emitter.emit(t.EVENT.ENTER_INPUT),this.areaDataUpdateOffsetDispose=this.spreadsheetView.areaData.onUpdateOffset(this.handleUpdateOffset),this.scaleEventDispose=this.spreadsheetView.scale.onScale(this.handleScale)},o.handleExitInput=function(e){if(this.isEditPending)return!1;if(this.variables.status===l.Xz.DEFAULT)return!1;this.variables.switchStatus(l.Xz.DEFAULT),(null===e||void 0===e?void 0:e.discard)||this.commitTableInputData(),this.tableInputStage.dismiss();var i=this.initInputRawData||{},n=i.row,o=void 0===n?-1:n,a=i.col,s={row:o,col:void 0===a?-1:a};return this.emitter.emit(t.EVENT.EXIT_INPUT,s),this.areaDataUpdateOffsetDispose.dispose(),this.scaleEventDispose.dispose(),!0},o.handleMetaKeyEnter=function(){var e,t=this,n=this.spreadsheet.parent;if(n.sheetStatus.canEdit&&this.isInputtingState()){var o=n.view.getSelection().rangeSelections,a=void 0===o?[]:o;if(ce.Z.selection.singleRange(n)&&1===a.length)this.insertNewLine();else try{var s=this.getText(),r=this.initInputRawData,l=r.row,d=r.col,c=this.spreadsheet.activeSheet.getCellDataAtPosition(l,d),u=(0,ge.AO)(c,s).isFormula?(0,we.EG)(s,l,d,this.spreadsheet.activeSheet.getSheetId()):void 0,h=[];this.initInputRawData=null,this.handleExitInput(),a.forEach((function(e){e.each((function(e,i){var n=s;u&&(n=u.toString(e,i,t.spreadsheet.sheetManager)),h.push({userEnterValue:n,colIndex:i,rowIndex:e})}),t.spreadsheet.activeSheet)})),n.requestApi.userRangeEnter(h)}catch(p){null===(e=i.g.log)||void 0===e||e.error("handleMetaKeyEnter error",p)}}},o.afterRowColChange=function(){},o.addIcon=function(e){this.tableInputStage.addIcon(e)},o.hideIcon=function(){this.tableInputStage.hideIcon()},o.shouldPreventEnterInput=function(e,t){var i,n;return void 0===e&&(e=this.normalSelectData.activeRow),void 0===t&&(t=this.normalSelectData.activeCol),!this.sheetStatus.canEditExceptWorkbookStatus&&this.sheetStatus.workbookStatus.status.full&&Te.Z.server.showFullMemberTip(Ie.B.FULL_MEMBER),!this.sheetStatus.canEdit||!this.canInput||!!(null===(n=null===(i=this.view.canvas.linkCenter)||void 0===i?void 0:i.attachmentUploadingManager)||void 0===n?void 0:n.shouldPreventEnterInput(e,t))},o.initEvent=function(){this._register(this.dataCallView.onInsertRow((0,ve.kf)(this.handleInsertRowCol))),this._register(this.dataCallView.onInsertCol((0,ve.kf)(this.handleInsertRowCol))),this._register(this.dataCallView.onDeleteRow((0,ve.kf)(this.handleDeleteRowCol))),this._register(this.dataCallView.onDeleteCol((0,ve.kf)(this.handleDeleteRowCol))),this._register(this.dataCallView.onSetRowHeight((0,ve.kf)(this.handleSetRowHeightColWidth))),this._register(this.dataCallView.onSetColWidth((0,ve.kf)(this.handleSetRowHeightColWidth))),this._register(this.dataCallView.onSetRowVisible((0,ve.kf)(this.handleSetRowVisibleColVisible))),this._register(this.dataCallView.onSetColVisible((0,ve.kf)(this.handleSetRowVisibleColVisible))),this.mutationBehavior.emitter.on(this.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.handleUpdateCells)},o.initInputChangeEvent=function(e){var t=this;e.on(e.EVENT.VALUE_CHANGE,(function(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];(e=t.emitter).emit.apply(e,[t.EVENT.VALUE_CHANGE].concat(n))})),e.on(e.EVENT.SELECTION_CHANGE,(function(){t.emitter.emit(t.EVENT.SELECTION_CHANGE)}))},o.cancelInertialScroll=function(){this.slideOperate.cancelAnimationFrame()},o.getPosition=function(e,t){return{left:this.spreadsheetView.areaData.getDisplayGlobalLeftByCol(t),top:this.spreadsheetView.areaData.getDisplayGlobalTopByRow(e)}},o.checkRangeContains=function(e,t,i){var n=new se.Z(this.spreadsheet.activeSheetId,e.startRow,e.endRow,e.startCol,e.endCol),o=new se.Z(this.spreadsheet.activeSheetId,t,t,i,i);return n.contain(o)},o.commitTempInputData=function(){if(this.initInputRawData){var e=this.initInputRawData,t=e.sheetId,i=e.row,n=e.col;if((0,ue.y2)(i,n)){var o=this.getUserEnterOptions(this.initInputRawData),a=o.isTextChanged,s=o.isTextFormatRunsChanged,r=o.mentionDetailsMap,l=o.text,d=o.textFormatRuns,c=String.fromCharCode(10);if(a||s||!(l.indexOf(c)>=0)){var u=function(e,t){var i,n=t.colIndex,o=t.rowIndex,a=t.isChanged,s=void 0===a||a,r=t.isTextFormatRunsChanged,l=void 0===r||r,d=t.textFormatRuns,c=void 0===d?null:d,u=t.mentionDetailsMap,h=t.sheetId,p=void 0===h?e.getActiveSheetId():h,f=t.ignoreLinkUrl,m=void 0!==f&&f,v=t.text,g=e.sheetManager.getSheetBySheetId(p),w=null===g||void 0===g?void 0:g.getCellDataAtPosition(o,n),S=null===(i=null===w||void 0===w?void 0:w.getUserEnteredFormat())||void 0===i?void 0:i.getNumberFormat();if((!S||!(0,P.isTextCell)(S))&&(0,_e.jr)(v)){var _=[].slice.call(e.sheetManager.sheetList,0).map((function(e){return e.getTitle()}));v=(0,Se.wh)(v,_);var y=null===w||void 0===w?void 0:w.getFormula();if(y&&y.toString(o,n,e.sheetManager)===v)return null}return{sheetId:p,requestId:be.Z.SET_SINGLE_VALUE_REQUEST,opt:{rowIndex:o,colIndex:n,userEnterValue:v,ignoreLinkUrl:m,isChanged:s,textFormatRuns:c,isTextFormatRunsChanged:l,sheetId:p,mentionDetailsMap:u}}}(this.spreadsheet,{text:l,colIndex:n,rowIndex:i,sheetId:t,textFormatRuns:d,mentionDetailsMap:r,isFromQuickFill:!1});if(u){var h=this.spreadsheet.parent.view.getSelectionWithGridRanges(),p=function(e,t){var i,n=t.activeSheet.getCellDataAtPosition(e.rowIndex,e.colIndex),o=(0,Ee.VL)(Object.assign(Object.assign({},e),{cellData:n}));if(null!==n){var a=n.clone();i=ye.cellDataUtils.mergeDeltaToCellData(a,o)}else i=ye.cellDataUtils.mergeDeltaToCellData(n,o);return i&&i.autoUpdate(e.rowIndex,e.colIndex,t),i}((0,xe.h)(u.requestId,u.opt,h).behaviors[0],this.spreadsheet);p&&(this.spreadsheetView.transformTable.setInputCellData(i,n,p),this.spreadsheetView.renderManager.renderApi.renderNextTick())}}}}},o.commitTableInputData=function(){var e;return De(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,n,o,a,r,l,d,c,u,h,p,f,m,v,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.initInputRawData){t.next=2;break}return t.abrupt("return");case 2:if(i=this.initInputRawData,n=i.sheetId,o=i.row,a=i.col,(0,ue.y2)(o,a)){t.next=5;break}return t.abrupt("return");case 5:if(r=this.getUserEnterOptions(this.initInputRawData),l=r.text,d=r.textFormatRuns,c=r.isTextChanged,u=r.isTextFormatRunsChanged,h=r.mentionDetailsMap,p=this.spreadsheet.activeSheet.getCellDataAtPosition(o,a),f=null===p||void 0===p?void 0:p.getCellType(),!c||f!==pe.ZP.DATE_REMINDER){t.next=17;break}if(m=(0,fe.parseDateTimeValue)(l,{}),!l.length||m){t.next=17;break}return oe.default.show({message:s.ZP.t("请输入正确的日期或时间"),autoClose:!0,type:"info",duration:3e3,zIndex:10002}),t.abrupt("return");case 17:if(v=this.checkAndChangeCellValueForCollaboration(l,d,!(!c&&!u)),l=v.text,d=v.textFormatRuns,g=String.fromCharCode(10),c||u||!(l.indexOf(g)>=0)){t.next=25;break}this.modifyCellBroker.setCellTextAutoWrap(o,a,n),t.next=28;break;case 25:return t.next=27,this.modifyCellBroker.setCellProperties({sheetId:n,rowIndex:o,colIndex:a,text:l,isTextChanged:c,textFormatRuns:d,isTextFormatRunsChanged:u,mentionDetailsMap:h});case 27:!c&&this.hasCanceledMention&&me.xc;case 28:null===(e=this.linkIdentifyCenter)||void 0===e||e.tryToIdentifyCell({sheetId:n,rowIndex:o,colIndex:a});case 29:case"end":return t.stop()}}),t,this)})))},o.updateInputStagePosition=function(){var e;this.isInputtingState()&&this.spreadsheet.activeSheetId===(null===(e=this.initInputRawData)||void 0===e?void 0:e.sheetId)&&this.tableInputStage.update()},o.getUserEnterOptions=function(e){var t,i=e.row,n=e.col,o=e.editValue,a=e.textFormatRuns,s=this.tableInputStage.extractInputData(),r=s.text,l=function(e,t){return e.textFormatInfos?(0,ne.kJ)(e.textFormatInfos,t):null}(s,(null===(t=e.cellFormat)||void 0===t?void 0:t.getTextFormat())||null),d=function(e){return e.mentionDetails?(0,ne.Zi)(e.mentionDetails):null}(s),c=(0,ne.We)(e,s);return{text:r,isTextChanged:r!==o||c||this.sheetStatus.isCellPrivate(i,n),textFormatRuns:l,isTextFormatRunsChanged:!(0,ne.Az)(this.spreadsheet,i,n)&&!(0,ne.hF)(l,a),mentionDetailsMap:d}},o.checkAndChangeCellValueForCollaboration=function(e,t,i){var n=this,o=e,a=t,s=this.initInputRawData,r=s.row,l=s.col,d=s.isCollaborationChanged,c=(0,ne.dn)(this.spreadsheet,r,l);if(d){if(!i)return{text:c.editValue,textFormatRuns:c.textFormatRuns};if(c.editValue&&(c.editValue!==o||!(0,ne.hF)(t,c.textFormatRuns)))return setTimeout((function(){n.showCollaborationConfirmModal()})),this.mergeCellTextAndFormat({text:o,textFormatRuns:a},{text:c.editValue,textFormatRuns:c.textFormatRuns})}return{text:o,textFormatRuns:a}},o.mergeCellTextAndFormat=function(e,t){var i,n=t.text+"\n\n"+e.text,o=t.textFormatRuns||[];if(null===(i=e.textFormatRuns)||void 0===i?void 0:i.length){var a=t.text.length+2;o=o.concat(e.textFormatRuns.map((function(e){var t=e.startIndex,i=e.format;return re.Z.createInstance({startIndex:t+a,format:i})})))}return o.length||(o=null),{text:n,textFormatRuns:o}},o.traverseRangesCheckHit=function(e,t,i){for(var n=0;n<e.length;n++){var o=e[n],a=o.dimension,s=o.startIndex,r=o.endIndex;if(a===le.DIMENSION_TYPE.ROWS&&s<=t&&t<=r)return!0;if(a===le.DIMENSION_TYPE.COLUMNS&&s<=i&&i<=r)return!0}return!1},o.scrollTableIfNeedMakeInputPositionStable=function(){if(this.position&&this.initInputRawData){var e=this.initInputRawData.row,t=this.initInputRawData.col,i=this.getPosition(e,t),n=i.left-this.position.left,o=i.top-this.position.top;this.position=i,this.scrollApi.scrollByPixel({areaX:"flow",areaY:"flow",diffX:n>>0,diffY:o>>0})}},(0,n.Z)(t,[{key:"EVENT",get:function(){return t.EVENT}},{key:"alloyRTE",get:function(){return this.tableInputStage.alloyRTE}},{key:"activeEditor",get:function(){return this.tableInputStage.alloyRTE}},{key:"cellData",get:function(){return this.initInputRawData}},{key:"canEdit",get:function(){return this.sheetStatus.canEdit}},{key:"isNormalSelectDataValid",get:function(){return this.normalSelectData.isValid()}},{key:"isFormula",get:function(){return this.variables.type===l.n$.FORMULA}},{key:"inputable",get:function(){return this.canInput},set:function(e){this.canInput=e}}]),t}(c.JT);Ce.EVENT={ENTER_INPUT:"ENTER_INPUT",EXIT_INPUT:"EXIT_INPUT",VALUE_CHANGE:"VALUE_CHANGE",SELECTION_CHANGE:"SELECTION_CHANGE",EXIT_MENTION:"EXIT_MENTION",FOCUS:"FOCUS",ON_PASTE:"ON_PASTE",ON_PASTE_OUTER:"ON_PASTE_OUTER",UNDO_REDO_CHANGE:"UNDO_REDO_CHANGE",FORMAT_CHANGE:"FORMAT_CHANGE"};var Re,Ae,Ve=Ce,ke=i("../spread-sheet/src/base/event/event.ts"),je=i("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),Le=(i("../node_modules/core-js/modules/es.array.find.js"),i("../packages/lib/Keyboard.ts")),Me=function(){function e(e){var t=this;this.exitInputDiscardChange=function(e){e.preventDefault(),t.inputManager.handleExitInput({discard:!0})},this.exitInputStatusPreventDefault=function(e){e.preventDefault(),t.inputManager.handleExitInput()},this.exitInputStatus=function(){t.inputManager.handleExitInput()},this.insertNewline=function(e){e.preventDefault(),t.inputManager.insertNewLine()},this.stopPropagation=function(e){e.stopPropagation()},this.arrowKeyHandler=function(e){var i,n,o=t.inputManager;o.isFormula&&(null===(n=(i=o).getAllowKeyboardFormulaSelect)||void 0===n?void 0:n.call(i))?e.preventDefault():!o.isInputtingQuick()||e.keyCode===Le.ZP.KEYS.LEFT&&e.code!==e.key?e.stopPropagation():o.handleExitInput()},this.boldFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),t.inputManager.format("bold")},this.italicFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),t.inputManager.format("italic")},this.underlineFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),t.inputManager.format("underline")},this.strikeThroughFormatHandler=function(e){e.stopPropagation(),e.preventDefault(),t.inputManager.format("strikeThrough")},this.fontSizeDecrease=function(e){e.stopPropagation(),e.preventDefault();var i=t.inputManager.getFormat().fontSize,n=i-2<=9?9:i-2;t.inputManager.format("fontSize",""+n)},this.fontSizeIncrease=function(e){e.stopPropagation(),e.preventDefault();var i=t.inputManager.getFormat().fontSize+2;t.inputManager.format("fontSize",""+i)},this.handleUndo=function(e){e.stopPropagation(),e.preventDefault(),t.inputManager.undo()},this.handleRedo=function(e){e.stopPropagation(),e.preventDefault(),t.inputManager.redo()},this.handleMetaKeyEnter=function(e){e.preventDefault(),t.inputManager.handleMetaKeyEnter()},this.handleHomeAndEnd=function(e){var i=t.inputManager;i.isInputtingQuick()&&t.inputManager.handleExitInput(),i.isInputtingStable()&&e.stopPropagation()},this.inputManager=e.inputManager}return e.prototype.initEvent=function(){var e=this;this.inputManager.emitter.on(this.inputManager.EVENT.ENTER_INPUT,(function(){return e.handleEnterInputEvent()})),this.inputManager.emitter.on(this.inputManager.EVENT.EXIT_INPUT,(function(){return e.handleExitInputEvent()}))},(0,n.Z)(e,[{key:"baseKeyboardBindings",get:function(){return[{key:Le.h1,ignore:!0,handler:this.stopPropagation},{key:Le.ZP.KEYS.CONTROL,ignore:!0,handler:this.stopPropagation},{key:Le.ZP.KEYS.BACKSPACE,ignore:!0,handler:this.stopPropagation},{key:Le.ZP.KEYS.DELETE,ignore:!0,handler:this.stopPropagation},{key:"a",shortKey:!0,handler:this.stopPropagation},{key:Le.ZP.KEYS.UP,ignore:!0,handler:this.arrowKeyHandler},{key:Le.ZP.KEYS.DOWN,ignore:!0,handler:this.arrowKeyHandler},{key:Le.ZP.KEYS.LEFT,ignore:!0,handler:this.arrowKeyHandler},{key:Le.ZP.KEYS.RIGHT,ignore:!0,handler:this.arrowKeyHandler},{key:Le.ZP.KEYS.ENTER,ctrlKey:!0,override:!0,handler:this.handleMetaKeyEnter},{key:Le.ZP.KEYS.ENTER,metaKey:!0,override:!0,handler:this.handleMetaKeyEnter},{key:Le.ZP.KEYS.ENTER,altKey:!0,override:!0,handler:this.insertNewline},{key:Le.ZP.KEYS.ENTER,override:!0,handler:this.exitInputStatusPreventDefault},{key:Le.ZP.KEYS.ENTER,shiftKey:!0,override:!0,handler:this.exitInputStatusPreventDefault},{key:Le.ZP.KEYS.TAB,handler:this.exitInputStatusPreventDefault},{key:Le.ZP.KEYS.TAB,shiftKey:!0,handler:this.exitInputStatusPreventDefault},{key:"z",shortKey:!0,override:!0,handler:this.handleUndo},{key:"z",shortKey:!0,shiftKey:!0,override:!0,handler:this.handleRedo},{key:"y",shortKey:!0,override:!0,handler:this.handleRedo},{key:Le.ZP.KEYS.HOME,handler:this.handleHomeAndEnd},{key:Le.ZP.KEYS.END,handler:this.handleHomeAndEnd},{key:Le.ZP.KEYS.SPACE,shiftKey:!0,ctrlKey:!L().isMac,handler:this.stopPropagation},{key:Le.ZP.KEYS.SPACE,altKey:!0,ctrlKey:!L().isMac,handler:this.stopPropagation},{key:Le.ZP.KEYS.SPACE_SAFARI,altKey:!0,handler:this.stopPropagation}]}}]),e}(),Oe=i("../spread-sheet/src/core/view/level-2/formula-ui-center/lib/FormulaKeyboard.ts"),Fe=i("../packages/editor/src/core/Selection.ts"),Ne=function(e){function t(t){var i;return(i=e.call(this,t)||this).handleFormulaQuote=function(){if(i.inputManager.isInputtingState()&&i.inputManager.isFormula){var e=i.inputManager.getText(),t=(0,Oe.LD)(e),n=i.inputManager.getSelection().start,o=t.find((function(e){return n>=e.startIndex&&n<=e.endIndex}));if(o){var a=(0,Oe.cG)(o.value),s=(0,Oe.ax)(o.value,a),r=""+e.substring(0,null===o||void 0===o?void 0:o.startIndex)+s+e.substring(null===o||void 0===o?void 0:o.endIndex);i.inputManager.setText(r);var l=s.length-o.value.length;i.inputManager.setSelection(new Fe.e6(o.startIndex,o.endIndex+l))}}},i.normalSelectData=t.normalSelectData,i.keyboard=new Le.ZP({root:window.document}),i.initEvent(),i}(0,a.Z)(t,e);var i=t.prototype;return i.handleEnterInputEvent=function(){this.inputManager.alloyRTE.keyboard.addBindings(this.alloyRTEKeyboardBindings),this.keyboard.addBindings(this.documentKeyboardBindings)},i.handleExitInputEvent=function(){this.inputManager.alloyRTE.keyboard.removeBindings(this.alloyRTEKeyboardBindings),this.keyboard.removeBindings(this.documentKeyboardBindings)},(0,n.Z)(t,[{key:"alloyRTEKeyboardBindings",get:function(){return[].concat((0,je.Z)(this.baseKeyboardBindings),[{key:"b",shortKey:!0,override:!0,handler:this.boldFormatHandler},{key:"i",shortKey:!0,override:!0,handler:this.italicFormatHandler},{key:"u",shortKey:!0,override:!0,handler:this.underlineFormatHandler},{key:"d",shortKey:!0,override:!0,handler:this.strikeThroughFormatHandler},{key:"5",ctrlKey:!0,override:!0,handler:this.strikeThroughFormatHandler},{key:Le.ZP.KEYS.PERIOD,shiftKey:!0,shortKey:!0,override:!0,handler:this.fontSizeIncrease},{key:Le.ZP.KEYS.COMMA,shiftKey:!0,shortKey:!0,override:!0,handler:this.fontSizeDecrease},{key:Le.ZP.KEYS.F4,handler:this.handleFormulaQuote}])}},{key:"documentKeyboardBindings",get:function(){return[{key:Le.ZP.KEYS.ESCAPE,ignore:!0,handler:this.exitInputDiscardChange}]}}]),t}(Me),Pe=function(e){function t(t){var i;return(i=e.call(this,t)||this).handleEnterInputEvent=function(){i.inputManager.alloySTE.keyboard.addBindings(i.baseKeyboardBindings)},i.handleExitInputEvent=function(){i.inputManager.alloySTE.keyboard.removeBindings(i.baseKeyboardBindings)},i.initEvent(),i}return(0,a.Z)(t,e),t}(Me),ze=function(e){function t(t,i,n,a,s,r){var d;return(d=e.call(this)||this).inputManager=t,d.spreadsheet=i,d.view=n,d.spreadsheetView=a,d.normalSelectData=s,d.sheetStatus=r,d.initQuickInputEvent=function(){var e=L().isWindows,t=L().isIPad,i=L().isWxWork,n=L().isElectronTencentDocsClientVersionAboveOrEqual,o=d.inputManager.alloyRTE,a=t?d.spreadsheetView.operateContext.operateBoard.board:o.input;e&&(n("2.1.0")||i)&&a.addEventListener("input",d.onKeyDown),a.addEventListener("compositionstart",d.onKeyDown),a.addEventListener("keydown",d.onKeyDown)},d.initMouseEvent=function(){d._register(d.spreadsheetView.operateContext.mouseOperate.onMousedown(d.handleMouseDown)),d._register(d.spreadsheetView.operateContext.touchOperate.onTap(d.handleMouseDown))},d.onKeyDown=function(e){(0,d.inputManager.isInputtingState)()||d.checkCanEnterQuick(e)&&("input"===e.type&&null===e.data||d.handleQuickInput(d.getFirstChar(e)))},d.handleQuickInput=function(e){var t=(0,o.Z)(d).inputManager;L().isIPad&&t.alloyRTE.focus(),t.switchInputStatus(l.Xz.QUICK_INPUT),t.handleEnterInput(),e&&t.alloyRTE.setText(e,void 0,!0),(L().isIE||L().isIPad)&&t.alloyRTE.collapseToEnd()},d.handleMouseDown=function(){if(d.sheetStatus.canEdit){var e=d.inputManager,t=e.tableInputMountDom;(0,e.isInputtingState)()||window.setTimeout((function(){d.inputManager.isInputtingState()||(document.activeElement===t||t.contains(document.activeElement))&&d.inputManager.switchFocusDomNode()}),0)}},d.initQuickInputEvent(),d.initMouseEvent(),d}(0,a.Z)(t,e);var i=t.prototype;return i.isQuickInputHandleWebview=function(){var e=L().isMac,t=L().isSafari,i=L().isWeChat,n=L().isWxMiniProgram,o=L().isWxWork,a=L().isTencentMeeting;return!!e&&(t||i||n||a||o)},i.getFirstChar=function(e){var t=null;return e instanceof KeyboardEvent&&this.isQuickInputHandleWebview()&&("string"===typeof e.key||"number"===typeof e.key)?(t=String(e.key),e.preventDefault()):"input"===e.type&&(t=e.data),t},i.hasNoAttachmentUploading=function(e,t){var i,n;return!(null===(n=null===(i=this.view.canvas.linkCenter)||void 0===i?void 0:i.attachmentUploadingManager)||void 0===n?void 0:n.shouldPreventEnterInput(e,t))},i.checkCanEnterQuick=function(e){var t=!((0,ne.if)(e)||e.metaKey||e.ctrlKey||e.altKey||this.checkSpecial(e)),i=this.normalSelectData,n=i.activeRow,o=i.activeCol;return t&&!(0,pe.wK)(this.spreadsheet.activeSheet,n,o)&&!this.sheetStatus.isCellPrivate(n,o)&&this.hasNoAttachmentUploading(n,o)},i.checkSpecial=function(e){return this.checkForShiftKey(e)||this.checkForCapsLockKey(e)||this.checkForUnidentified(e)||this.checkForLinux(e)},i.checkForShiftKey=function(e){return e.shiftKey&&(16===e.keyCode||229===e.keyCode&&-1===ne.h7.indexOf(e.key)||32===e.keyCode)},i.checkForCapsLockKey=function(e){return"CapsLock"===e.key},i.checkForUnidentified=function(e){return"Unidentified"===e.code||"Unidentified"===e.key},i.checkForLinux=function(e){return"Pause"===e.key&&"Pause"===e.code},t}(c.JT),Ue=i("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),Ze=i("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),Be=function(e){function t(t,i,n){var o;return(o=e.call(this)||this).inputManager=t,o.spreadsheetView=i,o.spreadsheet=n,o.handleMouseDown=function(e){var t=o.inputManager,i=t.isFormula;(0,t.isInputtingState)()&&(e.e.preventDefault(),i||o.inputManager.handleExitInput())},o.handleDoubleClick=function(e){if(!(0,Ze.I1)(o.spreadsheet.parent,e.currRow,e.currCol)&&e.isHoverCell()){var t=e.currRow,i=e.currCol;(0,pe.hM)(o.spreadsheet.activeSheet,t,i)||(0,Ue.xy)(o.spreadsheet,t,i)||o.inputManager.handleEnterInput()}},o.initMouseEvent(),o}return(0,a.Z)(t,e),t.prototype.initMouseEvent=function(){this._register(this.spreadsheetView.operateContext.mouseOperate.onDblClick(this.handleDoubleClick)),this._register(this.spreadsheetView.operateContext.mouseOperate.onMousedown(this.handleMouseDown))},t}(c.JT);!function(e){e.VALUE="value",e.FORMAT="format"}(Re||(Re={})),function(e){e.ENTER_FORMULA_INPUT="enter_formula_input",e.EXEC_FORMAT="exec_format",e.SYNC_CONTENT="sync_content"}(Ae||(Ae={}));var He=function(e){function t(t,i,n,a,s,r,d,c,u,h,p,f,m,v,g,w){var S;return(S=e.call(this,n,i,a,s,r,d,c,u,h,p,f,m,v,g,w)||this).tableInputMountDom=t,S.spreadsheet=i,S.view=n,S.mutationBehavior=a,S.sheetStatus=s,S.spreadsheetView=r,S.dataCallView=d,S.modifyCellBroker=c,S.normalSelectData=u,S.formulaSelectData=h,S.normalSelectionStage=p,S.mutexManagement=f,S.linkIdentifyCenter=m,S.defaultScale=v,S.scrollApi=g,S.slideOperate=w,S._alwaysDiscard=!1,S.isAllowKeyboardFormulaSelect=!1,S.focus=function(){S.isInputtingToolbar()?S.alloySTE.focus():e.prototype.focus.call((0,o.Z)(S))},S.handleEnterInput=function(t,i){if(void 0===t&&(t=S.normalSelectData.activeRow),void 0===i&&(i=S.normalSelectData.activeCol),!S.shouldPreventEnterInput(t,i)){var n=S.spreadsheetView.tableView.getCellViewAtPosition(t,i);n&&(n.mergeParent&&(t+=n.mergeParent.y,i+=n.mergeParent.x,n=S.spreadsheetView.tableView.getCellViewAtPosition(t,i)),S.focus(),S.scrollCellFullDisplay(t,i,50,50),S.initInputRawData=(0,ne.dn)(S.spreadsheet,t,i,S.isInputtingQuick()),S.tableInputStage.show({initInputRawData:S.initInputRawData,cellView:n}),e.prototype.handleEnterInput.call((0,o.Z)(S)))}},S.handleExitInput=function(t){return S._alwaysDiscard&&(t=Object.assign(Object.assign({},t||{}),{discard:!0})),!!e.prototype.handleExitInput.call((0,o.Z)(S),t)&&((null===t||void 0===t?void 0:t.discard)&&S.updateFormulaInputStageContent(),S.alloyRTE.setActive(!1),S.alloySTE.setActive(!1),window.setTimeout((function(){S.focus()}),0),!0)},S.handleModifySelection=function(){S.variables.type!==l.n$.FORMULA&&(S.updateFormulaInputStageContent(),S.updateFormulaInputStageEditable())},S.handleValueChange=function(e){if(e.source!==S.alloyRTE.SOURCE.SILENT&&S.isInputtingState()){var t=S.alloyRTE.getText();S.alloySTE.setText(t,S.alloyRTE.SOURCE.SILENT)}},S.handleSyncOutFormulaInput=function(e){var t,i=S.normalSelectData,n=i.activeRow,o=i.activeCol;switch(e.cmd){case Ae.ENTER_FORMULA_INPUT:if(!S.sheetStatus.canEdit||!S.canInput||S.sheetStatus.isCellPrivate(n,o))return;if((0,pe.wK)(S.spreadsheet.activeSheet,n,o))return;S.isInputtingState()||(S.handleEnterInput(),S.alloySTE.focus()),S.alloySTE.setActive(!0),S.variables.switchStatus(l.Xz.TOOLBAR_INPUT);break;case Ae.EXEC_FORMAT:if(!e.data)return;S.focus(),S.alloyRTE.setSelection(e.data.range||null),S.alloyRTE.format(e.data.value);break;case Ae.SYNC_CONTENT:S.alloyRTE.setText(null===(t=e.data)||void 0===t?void 0:t.value,S.alloyRTE.SOURCE.SILENT);break;default:throw new Error("Error: cmd not found!")}},S.handleUpdateCellsForFormulaInput=function(e){if(!S.isInputtingState()){var t=S.normalSelectData,i=t.activeRow,n=t.activeCol;S.checkRangeContains(e,i,n)&&S.updateFormulaInputStageContent()}},S.handleSwitchSheet=function(e){var t;if(S.isInputtingState())if(S.variables.type===l.n$.FORMULA){if(S.tableInputStage.hide(),e!==(null===(t=S.initInputRawData)||void 0===t?void 0:t.sheetId)&&!S.isInputtingToolbar()){var i=S.alloyRTE.getSelection();return S.variables.switchStatus(l.Xz.TOOLBAR_INPUT),S.alloySTE.focus(),void S.alloySTE.setSelection(i)}ke.ZP.sheetsBar.one("switchSheetEnd",(function(){var t;if(e===(null===(t=S.initInputRawData)||void 0===t?void 0:t.sheetId)){var i=S.alloySTE.getSelection(),n=S.alloySTE.getText();S.tableInputStage.update(),S.variables.switchStatus(l.Xz.STABLE_INPUT),S.alloyRTE.focus(),S.alloyRTE.setText(n),S.alloyRTE.setSelection(i)}}))}else S.handleExitInput()},S.handleUpdateInputStage=function(){if(!S.isInputtingState()){var e=S.normalSelectData.activeRow,t=S.normalSelectData.activeCol;S.tableInputStage.hide({row:e,col:t,discard:!0})}},S.initInputStages(),S.initEvent(),new Ne({inputManager:(0,o.Z)(S),normalSelectData:S.normalSelectData}),new Pe({inputManager:(0,o.Z)(S)}),S._register(new ze((0,o.Z)(S),S.spreadsheet,S.view,S.spreadsheetView,S.normalSelectData,S.sheetStatus)),S._register(new Be((0,o.Z)(S),S.spreadsheetView,S.spreadsheet)),S}(0,a.Z)(t,e);var i=t.prototype;return i.toolbarInsertAt=function(){if(this.emitter.emit(this.EVENT.EXIT_MENTION),this.isInputtingQuick()||this.isInputtingStable())this.execInserAt();else if(this.isInputtingToolbar()){this.switchInputStatus(l.Xz.STABLE_INPUT);var e=this.alloySTE.getSelection();this.focus(),this.alloyRTE.setSelection(e),this.execInserAt()}else this.switchInputStatus(l.Xz.QUICK_INPUT),this.handleEnterInput(),this.execInserAt()},i.getAllowKeyboardFormulaSelect=function(){return this.isAllowKeyboardFormulaSelect},i.setAllowKeyboardFormulaSelect=function(e){this.isAllowKeyboardFormulaSelect=e},i.undo=function(){this.isInputtingToolbar()?this.alloySTE.undo():e.prototype.undo.call(this)},i.redo=function(){this.isInputtingToolbar()?this.alloySTE.redo():e.prototype.redo.call(this)},i.isComposing=function(){return this.isInputtingToolbar()?this.alloySTE.isComposing():e.prototype.isComposing.call(this)},i.hasFocus=function(){return this.isInputtingToolbar()?this.alloySTE.hasFocus():e.prototype.hasFocus.call(this)},i.blur=function(){this.isInputtingToolbar()?this.alloySTE.blur():e.prototype.blur.call(this)},i.format=function(t,i){if(this.isInputtingState()){if(this.isInputtingToolbar()){var n=this.alloySTE.getSelection();this.focus(),this.alloyRTE.setSelection(n)}e.prototype.format.call(this,t,i)}},i.getText=function(t){return void 0===t&&(t=!1),this.isInputtingToolbar()?this.alloySTE.getText(t):e.prototype.getText.call(this,t)},i.setText=function(t,i){this.isInputtingToolbar()?this.alloySTE.setText(t,i):e.prototype.setText.call(this,t,i)},i.insertNewLine=function(){this.isInputtingToolbar()?this.alloySTE.insertNewLine():e.prototype.insertNewLine.call(this)},i.getSelection=function(){return this.isInputtingToolbar()?this.alloySTE.getSelection():e.prototype.getSelection.call(this)},i.setSelection=function(t){this.isInputtingToolbar()?this.alloySTE.setSelection(t):e.prototype.setSelection.call(this,t)},i.collapseToEnd=function(){this.isInputtingState()&&(this.isInputtingToolbar()?this.alloySTE.collapseToEnd():e.prototype.collapseToEnd.call(this))},i.initEvent=function(){this._register(this.normalSelectData.onModifySelectData(this.handleModifySelection)),this.emitter.on(t.EVENT.SYNC_OUT_FORMULA_INPUT,this.handleSyncOutFormulaInput),this._register(this.dataCallView.onUpdateCells(this.handleUpdateCellsForFormulaInput)),this.alloyRTE.on(this.alloyRTE.EVENT.VALUE_CHANGE,this.handleValueChange),ke.ZP.sheetsBar.listen("switchSheetStart",this.handleSwitchSheet),this._register(this.normalSelectData.onModifySelectData(this.handleUpdateInputStage)),e.prototype.initEvent.call(this)},i.showCollaborationConfirmModal=function(){var e=r.default.confirm({title:s.ZP.t("提示"),content:ne.a$,cancelText:null,maskClosable:!0,onOk:function(){e()}}).close},i.initInputStages=function(){var i=this;this.formulaInputStage=new m(this.sheetStatus,this.spreadsheetView,this.spreadsheetView.container.parentElement,(function(e){i.emitter.emit(t.EVENT.SYNC_OUT_FORMULA_INPUT,e)}),(function(e){i.emitter.on(t.EVENT.SYNC_IN_FORMULA_INPUT,e)})),this.tableInputStage=new ie(this.spreadsheet,this.sheetStatus,this.spreadsheetView,this.tableInputMountDom,e.prototype.handleExitInput.bind(this)),this.initInputChangeEvent(this.alloySTE),this.initInputChangeEvent(this.alloyRTE),this.mutexManagement.addMutexComponent(he.d.INPUT,this.tableInputStage)},i.execInserAt=function(){this.alloyRTE.isCollapsed()||this.alloyRTE.deleteText(this.alloyRTE.SOURCE.SILENT),this.alloyRTE.emitter.emit(this.alloyRTE.EVENT.TOOLBAR_INSERT),this.alloyRTE.insertText("@",this.alloyRTE.SOURCE.SILENT),this.alloyRTE.emitTextChangeEvent(this.alloyRTE.SOURCE.API)},i.scrollCellFullDisplay=function(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var o=this.spreadsheetView.areaData.getDisplayViewLeftByCol(t),a=this.spreadsheetView.areaData.getDisplayViewTopByRow(e),s=this.getCellViewportSize(e,t),r=s.width,l=s.height,d=this.getAreaVisibleRectByCell(e,t),c=d.visibleLeft,u=d.visibleTop,h=d.visibleWidth,p=d.visibleHeight,f=this.spreadsheetView.tableView.getCellViewAtPosition(e,t),m=e,v=t;if((null===f||void 0===f?void 0:f.mergeData)&&(m+=f.mergeData.rowCount-1,v+=f.mergeData.colCount-1),r>=h)this.scrollApi.scrollToRenderFrom({col:t});else{var g=h-r,w=g>=2*n?n:g/2;(o<c||o+r+w>c+h)&&this.scrollApi.scrollToVisible({col:v,x:w})}if(l>=p)this.scrollApi.scrollToRenderFrom({row:e});else{var S=p-l,_=S>=2*i?i:S/2;(a<u||a+l+_>u+p)&&this.scrollApi.scrollToVisible({row:m,y:_})}},i.getAreaVisibleRectByCell=function(e,t){var i=this.spreadsheetView.areaData.inFlowColArea(t)?this.spreadsheetView.areaData.col.flow.viewSize:this.spreadsheetView.areaData.col.frozen.viewSize,n=this.spreadsheetView.areaData.inFlowRowArea(e)?this.spreadsheetView.areaData.row.flow.viewSize:this.spreadsheetView.areaData.row.frozen.viewSize;return{visibleLeft:this.spreadsheetView.areaData.inFlowColArea(t)?this.spreadsheetView.areaData.getDisplayGlobalLeftByCol(this.spreadsheetView.areaData.col.flow.from):0,visibleTop:this.spreadsheetView.areaData.inFlowRowArea(e)?this.spreadsheetView.areaData.getDisplayGlobalTopByRow(this.spreadsheetView.areaData.row.flow.from):0,visibleWidth:i,visibleHeight:n}},i.getCellViewportSize=function(e,t){var i=this.spreadsheetView.tableView.getCellViewAtPosition(e,t);return{width:(0,Q.o)(this.spreadsheetView.rowcolAccessor,i,t),height:(0,Q.E)(this.spreadsheetView.rowcolAccessor,i,e)}},i.updateFormulaInputStageContent=function(){var e=this.normalSelectData,i=e.activeRow,n=e.activeCol,o=(0,ne.dn)(this.spreadsheet,i,n);this.emitter.emit(t.EVENT.SYNC_IN_FORMULA_INPUT,{rowIndex:i,colIndex:n,value:o.editValue})},i.updateFormulaInputStageEditable=function(){var e=this.normalSelectData,t=e.activeRow,i=e.activeCol,n=!(0,pe.wK)(this.spreadsheet.activeSheet,t,i)&&!this.sheetStatus.isCellPrivate(t,i);this.alloySTE.setEditable(n),this.alloySTE.setCanCopy(this.sheetStatus.canCopy)},(0,n.Z)(t,[{key:"EVENT",get:function(){return t.EVENT}},{key:"alloySTE",get:function(){return this.formulaInputStage.alloySTE}},{key:"activeEditor",get:function(){return this.isInputtingToolbar()?this.alloySTE:this.alloyRTE}},{key:"alwaysDiscard",set:function(e){this._alwaysDiscard=e}}]),t}(Ve);He.EVENT=Object.assign(Object.assign({},Ve.EVENT),{SYNC_IN_FORMULA_INPUT:"sync_in_formula_input",SYNC_OUT_FORMULA_INPUT:"sync_out_formula_input"});var We=He},"../spread-sheet/src/core/view/level-1/input-manager/InputVariables.ts":function(e,t,i){var n,o;i.d(t,{Xz:function(){return n},n$:function(){return o}}),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.QUICK_INPUT=1]="QUICK_INPUT",e[e.STABLE_INPUT=2]="STABLE_INPUT",e[e.TOOLBAR_INPUT=3]="TOOLBAR_INPUT"}(n||(n={})),function(e){e[e.TEXT=0]="TEXT",e[e.FORMULA=1]="FORMULA"}(o||(o={}));var a=function(){function e(e,t){void 0===e&&(e=n.DEFAULT),void 0===t&&(t=o.TEXT),this.status=n.DEFAULT,this.status=e,this.type=t}var t=e.prototype;return t.switchStatus=function(e){this.status=e},t.switchType=function(e){this.type=e},e}();t.ZP=a},"../spread-sheet/src/core/view/level-1/input-manager/utils.ts":function(e,t,i){i.d(t,{nx:function(){return V},h7:function(){return k},We:function(){return j},hF:function(){return C},a$:function(){return _},dn:function(){return y},if:function(){return A},Az:function(){return R},Zi:function(){return T},kJ:function(){return x}}),i("../node_modules/core-js/modules/es.regexp.exec.js"),i("../node_modules/core-js/modules/es.number.constructor.js"),i("../node_modules/core-js/modules/es.object.keys.js"),i("../node_modules/core-js/modules/es.string.bold.js"),i("../node_modules/core-js/modules/es.string.italics.js"),i("../node_modules/core-js/modules/es.array.splice.js"),i("../node_modules/core-js/modules/es.array.map.js"),i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.regexp.to-string.js");var n=i("../node_modules/i18next/dist/esm/i18next.js"),o=i("../packages/model/src/cell/format/colorUtils.ts"),a=i("../packages/model/src/cell/format/UnderlineType.ts"),s=i("../packages/model/src/mention/MentionDetail.ts"),r=i("../node_modules/@tencent/docs-user-agent/dist/index.js"),l=i.n(r),d=(i("../node_modules/core-js/modules/es.array.find.js"),{shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1}),c={shiftKey:16,ctrlKey:17,altKey:18,metaKey:91};function u(e){if(0!==e.keyCode)return e.keyCode;switch(e.key){case"UIKeyInputRightArrow":return 39;case"UIKeyInputLeftArrow":return 37;case"UIKeyInputUpArrow":return 38;case"UIKeyInputDownArrow":return 40;case"UIKeyInputEscape":return 27}return function(e){var t=Object.keys(d).map((function(e){return{key:e,val:d[e]}})).find((function(t){var i=t.key,n=t.val;return e[i]&&!n||!e[i]&&n}));return function(e){Object.keys(d).forEach((function(t){d[t]=!!e[t]}))}(e),t?c[t.key]:e.keyCode}(e)||e.keyCode}var h=i("../spread-sheet/src/core/view/spreadsheet-view/model/line-engine/transform.ts"),p=i("../packages/model/src/cell/TextFormatRun.ts"),f=i("../packages/model/src/cell/format/TextFormat.ts"),m=i("../packages/model/src/cell/ExtendedValueType.ts"),v=i("../packages/model/src/cell/format/Color.ts"),g=i("../spread-sheet/src/base/config/font.ts"),w=i("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),S=i("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),_=n.ZP.t("编辑过程中有其他协作者修改了此单元格内容，你输入的内容将合并至其后面，可根据需要调整内容。");function y(e,t,i,n){var o=e.activeSheet.getCellDataAtPosition(t,i),a=e.activeSheetId;if(!o)return{sheetId:a,row:t,col:i,editValue:"",cellFormat:null,textFormatRuns:null,mentionDetails:null,dataValidation:null,isCollaborationChanged:!1};var s="";if(function(e){var t=e.spreadsheet,i=e.needEmptyData,n=e.row,o=e.col,a=t.activeSheet.getCellImage(n,o);return!(i||a||(0,w.xy)(t,n,o)||(0,S.tE)(t.parent,n,o))}({spreadsheet:e,needEmptyData:n,row:t,col:i})){s=o.getEditValue()||"";var r=o.getFormattedCustomTypeValue();r&&(s=String(r.value)),o.getFormula()&&(s=function(e,t,i,n,o){var a=t.getFormula();return e.filterViewManager.getActiveFilterView()?a.toString(n,o,e.spreadsheetReference.sheetManager):i}(e.activeSheet,o,s,t,i))}return{sheetId:a,row:t,col:i,editValue:s,cellFormat:o.getUserEnteredFormat()||null,textFormatRuns:(0,h.iF)(o,!0),mentionDetails:o.getMentionDetails()||null,dataValidation:o.getDataValidation()||null,isCollaborationChanged:!1}}function E(e){var t=/[+-]?\d+(?:\.\d+)?/g.exec(e);return t&&Number(t[0])||10}function b(e,t){if(!e||!Object.keys(e).length)return null;var i,n,s,r,l,d=e.color?(0,o.colorValues)(e.color):null,c=e.dataThemeColor;return i=c?v.Z.createColor(c):d?v.Z.createColor({red:d[0],green:d[1],blue:d[2],alpha:d[3]}):(null===t||void 0===t?void 0:t.color)?t.color:v.Z.createColor({red:0,green:0,blue:0,alpha:1}),(n=e.fontFamily?e.fontFamily:(null===t||void 0===t?void 0:t.fontFamily)?t.fontFamily:g.em)===g.em&&(n=""),s=e.fontSize?function(e){var t=10;return/pt$/i.test(e)?t=E(e):/px$/i.test(e)&&(t=Math.round(3*E(e)/4)),t}(e.fontSize):(null===t||void 0===t?void 0:t.fontSize)?t.fontSize:10,r=void 0!==e.bold?e.bold:!!(null===t||void 0===t?void 0:t.bold)&&t.bold,l=void 0!==e.italic?e.italic:!!(null===t||void 0===t?void 0:t.italic)&&t.italic,f.Z.createInstance({color:i,fontFamily:n,fontSize:s,bold:r,italic:l,strikethrough:void 0!==e.strikethrough&&e.strikethrough,underline:"boolean"===typeof e.underline&&e.underline?a.Z.SINGLE_LINE:null})}function x(e,t){if(!e||!e.length)return null;t||(t=f.Z.createInstance({bold:!1,italic:!1,color:v.Z.createColor({red:0,green:0,blue:0,alpha:1}),fontFamily:"",fontSize:10,strikethrough:!1,underline:null}));var i=[];i=e.map((function(e){var i=b(e.style,t);return i||(i=t),{text:e.text,textFormat:i}}));var n=[],o=0;return e&&(n=(i=function(e){var t;if(!e||e.length<=1)return e;for(var i,n,o=0;o<e.length-1;)i=e[o],n=e[o+1],i.textFormat===n.textFormat||(null===(t=i.textFormat)||void 0===t?void 0:t.equal(n.textFormat))?(i.text+=n.text,e.splice(o+1,1)):o+=1;return e}(i)).map((function(e){var t=p.Z.createInstance({startIndex:o,format:e.textFormat});return o+=e.text.length,t}))),n}function T(e){if(!e||!e.length)return null;var t={};return e.forEach((function(e){t[e.mentionId]=new s.Z(e)})),t}var I=f.Z.createInstance();function D(e){return!e||!e.length||1===e.length&&(!e[0].format||I.equal(e[0].format))}function C(e,t){if(D(e)&&D(t))return!0;if(e&&t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++){var n=e[i],o=t[i];if(!n.equal(o))return!1}return!0}return!1}function R(e,t,i){var n,o=e.activeSheet.getCellDataAtPosition(t,i),a=null===(n=null===o||void 0===o?void 0:o.getEffectiveValue())||void 0===n?void 0:n.type;return a===m.Z.NUMBER||a===m.Z.BOOL}function A(e){var t=e.keyCode;return l().isIPad&&(t=u(e)),function(e){return-1!==[V.ARROW_DOWN,V.ARROW_UP,V.ARROW_LEFT,V.ARROW_RIGHT,V.HOME,V.END,V.DELETE,V.BACKSPACE,V.F1,V.F2,V.F3,V.F4,V.F5,V.F6,V.F7,V.F8,V.F9,V.F10,V.F11,V.F12,V.VOLUME_DOWN,V.VOLUME_UP,V.NEXT,V.PREVIOUS,V.STOP,V.PLAY,V.TAB,V.PAGE_DOWN,V.PAGE_UP,V.INSERT,V.ENTER,V.ESCAPE,V.SHIFT,V.CAPS_LOCK,V.ALT,V.COMMAND_LEFT,V.CONTROL_LEFT,V.COMMAND_RIGHT,V.SCRLK,V.NUMLK].indexOf(e)}(t)}var V={MOUSE_LEFT:1,MOUSE_RIGHT:3,MOUSE_MIDDLE:2,BACKSPACE:8,COMMA:188,INSERT:45,DELETE:46,END:35,ENTER:13,ESCAPE:27,CONTROL_LEFT:91,COMMAND_LEFT:17,COMMAND_RIGHT:93,ALT:18,HOME:36,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,SPACE:32,SHIFT:16,CAPS_LOCK:20,TAB:9,ARROW_RIGHT:39,ARROW_LEFT:37,ARROW_UP:38,ARROW_DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,VOLUME_DOWN:174,VOLUME_UP:175,NEXT:176,PREVIOUS:177,STOP:178,PLAY:179,A:65,X:88,C:67,S:83,V:86,Y:89,Z:90,F:70,H:72,SCRLK:144,NUMLK:145},k=["Process","~","!","@","#","$","￥","%","……","^","&","*","(",")","_","+","{","}","「","」","｜","：",":",'"',"<","《",">","》","？"];function j(e,t){var i,n=e.mentionDetails,o=t.mentionDetails;if(null===n||null===o){if(null===n)return null!==o;if(null===o)return null!==n}var a=[Object.keys(n).length,o.length],s=a[1];if(a[0]!==s)return!0;for(var r=0;r<s;r++){var l=o[r].mentionId;if((null===(i=n[l])||void 0===i?void 0:i.mentionId)!==l)return!0}return!1}},"../spread-sheet/src/core/view/level-1/link-identify-center/link-identify-center.ts":function(e,t,i){i.d(t,{N:function(){return h}}),i("../node_modules/regenerator-runtime/runtime.js"),i("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),i("../node_modules/core-js/modules/esnext.reflect.metadata.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.promise.js"),i("../node_modules/core-js/modules/es.regexp.exec.js"),i("../node_modules/core-js/modules/es.string.replace.js");var n,o,a=i("../packages/model/src/spreadsheet/Spreadsheet.interface.ts"),s=(0,i("../node_modules/@tencent/containerized/build/main/index.js").yh)("IModifyCellBroker"),r=i("../spread-sheet/src/base/util/url.ts"),l=function(e,t,i,n){var o,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(s=(a<3?o(s):a>3?o(t,i,s):o(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s},d=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(e,t){return function(i,n){t(i,n,e)}},u=function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function s(e){try{l(n.next(e))}catch(t){a(t)}}function r(e){try{l(n.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))},h=function(){function e(e,t){this.spreadSheet=e,this.modifyCellBroker=t}var t=e.prototype;return t.tryToIdentifyCell=function(e){var t=e.sheetId,i=e.rowIndex,n=e.colIndex;return u(this,void 0,void 0,regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdentifiedCellValue({sheetId:t,rowIndex:i,colIndex:n});case 2:if(null!==(o=e.sent)){e.next=5;break}return e.abrupt("return");case 5:this.modifyCellBroker.setCellProperties({sheetId:t,rowIndex:i,colIndex:n,text:o,ignoreLinkUrl:!0});case 6:case"end":return e.stop()}}),e,this)})))},t.getIdentifiedCellValue=function(e){var t=e.sheetId,i=e.rowIndex,n=e.colIndex;return u(this,void 0,void 0,regeneratorRuntime.mark((function e(){var o,a,s,l,d,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(o=this.spreadSheet.sheetManager.getSheetBySheetId(t))){e.next=3;break}return e.abrupt("return",null);case 3:if(null!==(a=o.getCellDataAtPosition(i,n))){e.next=6;break}return e.abrupt("return",null);case 6:if(null!==(s=a.getEditValue())){e.next=9;break}return e.abrupt("return",null);case 9:if(null!==(l=(0,r.nx)((0,r.Kc)(s,!1)))){e.next=12;break}return e.abrupt("return",null);case 12:return e.prev=12,e.next=15,(0,r.sx)(l);case 15:if(d=e.sent,c=d.title,(u=a.getEditValue())===s){e.next=20;break}return e.abrupt("return",null);case 20:return e.abrupt("return",u.replace(l,c));case 23:return e.prev=23,e.t0=e.catch(12),e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this,[[12,23]])})))},e}();h=l([c(0,a.V),c(1,s),d("design:paramtypes",["function"===typeof(n="undefined"!==typeof a.V&&a.V)?n:Object,"function"===typeof(o="undefined"!==typeof s&&s)?o:Object])],h)},"../spread-sheet/src/core/view/level-1/modify-broker/cell/modify-cell-broker.ts":function(e,t,i){i("../node_modules/regenerator-runtime/runtime.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.promise.js");var n=i("../packages/model/src/range/GridRange.ts"),o=i("../packages/model/src/cell/format/WrapStrategy.ts"),a=i("../packages/report/src/index.ts"),s=i("../spread-sheet/src/base/config/report.ts"),r=i("../spread-sheet/src/core/behavior/utils.ts"),l=function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function s(e){try{l(n.next(e))}catch(t){a(t)}}function r(e){try{l(n.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))},d=function(){function e(e,t){this.spreadsheetApp=e,this.spreadsheet=t}var t=e.prototype;return t.clearFormat=function(){this.spreadsheetApp.requestApi.clearFormat()},t.clearContent=function(){var e,t;this.spreadsheetApp.requestApi.clearContent();var i=this.spreadsheetApp.view.getSelection().rangeSelections;null===(t=null===(e=this.spreadsheetApp.view.canvas)||void 0===e?void 0:e.weworkComponentCenter)||void 0===t||t.hidePanelWhenClearContent(i||[])},t.setCellProperties=function(e){var t;return l(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,o,r,l,d,c;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n=e.colIndex,o=e.rowIndex,r=e.text,l=e.isTextChanged,d=void 0!==l&&l,this.checkDimensionsValid(o,n)){i.next=3;break}return i.abrupt("return");case 3:return c=this.spreadsheetApp,i.next=6,c.view.getValidationErrorPanel();case 6:if(!1!==i.sent.verify(o,n,r,d)){i.next=9;break}return i.abrupt("return");case 9:null===(t=this.spreadsheetApp.requestApi)||void 0===t||t.userEnter(e).catch((function(e){(null===e||void 0===e?void 0:e.stack)&&a.ZP.run(s.CONFIG.VIEW_ERROR_INPUT,[e.stack]),console.error("无效输入",e)}));case 10:case"end":return i.stop()}}),i,this)})))},t.setCellTextAutoWrap=function(e,t,i){if(this.checkDimensionsValid(e,t)){var a=this.spreadsheet.activeSheet,s=a.getCellDataAtPosition(e,t);(null===s||void 0===s?void 0:s.getUserEnteredFormat())&&s.getUserEnteredFormat().getWrapStrategy()===o.Z.OVERFLOW_CELL&&this.spreadsheetApp.requestApi.autoWrap(o.Z.WRAP,new n.Z(i||a.getSheetId(),e,e,t,t))}},t.checkDimensionsValid=function(e,t){return(0,r.MN)(e)&&(0,r.MN)(t)},e}();t.Z=d},"../spread-sheet/src/core/view/level-1/modify-broker/chart/modify-chart-broker.ts":function(e,t,i){var n=i("../packages/model/src/new-embedded/EmbeddedObjectType.ts"),o=i("../spread-sheet/src/core/view/level-2/chart/charts/ChartsUtils.ts"),a=function(){function e(e,t){this.spreadsheetApp=e,this.spreadsheet=t}var t=e.prototype;return t.removeChart=function(e){this.spreadsheetApp.requestApi.deleteEmbeddedObject({embeddedObjectType:n.Z.CHART,sheetId:this.spreadsheet.activeSheetId,objectId:e})},t.layoutChange=function(e,t){var i=t.x,n=t.y,a=t.width,s=t.height,r=t.rowIndex,l=t.colIndex,d=(0,o.oI)(this.spreadsheet,e,{height:s,width:a,rowIndex:r,colIndex:l,x:i,y:n});if(!d)return null;this.spreadsheetApp.requestApi.updateEmbeddedObject({objects:[d]})},e}();t.Z=a},"../spread-sheet/src/core/view/level-1/modify-broker/dimension/modify-dimension-broker.ts":function(e,t,i){i.d(t,{Z:function(){return y}}),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.regexp.to-string.js"),i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../node_modules/core-js/modules/es.number.constructor.js"),i("../node_modules/core-js/modules/es.array.concat.js");var n=i("../node_modules/i18next/dist/esm/i18next.js"),o=i("../packages/model/src/range/DimensionRange.ts"),a=i("../packages/model/src/dimension/DimensionType.ts");function s(e,t,i,n){for(var o={},a=0;a<n.length;a++)for(var s=n[a],r=s[0];r<=s[1];r++)if(void 0===o[r]){for(var l=0,d=0;d<t.getRowCount();d++){var c=i.getParagraph(d,r);if(c){var u=e.getCellViewAtPosition(d,r);if(!(null===u||void 0===u?void 0:u.mergeData)&&!(null===u||void 0===u?void 0:u.mergeParent)){var h=u?u.paddingLeft+u.paddingRight:0;l=Math.max(l,c.width+h)}}}0!==l&&(o[r]=l)}return o}var r=i("../packages/report/src/index.ts"),l=i("../spread-sheet/src/core/view/level-1/select-center/base/utils.ts"),d=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),c=(i("../node_modules/core-js/modules/es.string.trim.js"),i("../node_modules/@tencent/dui/lib/components/Modal/index.js")),u=i("../node_modules/@tencent/dui/lib/components/Input/index.js"),h=i("react"),p=i.n(h),f=i("../packages/lib/Keyboard.ts"),m=i("../node_modules/@tencent/dui/lib/components/Form/index.js"),v=-1,g=!1,w=function(e){function t(t){var i;return(i=e.call(this,t)||this).getInputValue=function(e){var t=0===e.trim().length&&e.length>0;isNaN(Number(e))||Number(e)>1e3||t?(g=!1,i.setState({inputValue:"",isError:!g})):(g=0!==e.length&&Number(e)>=i.props.params.min,v=Number(e)||107,i.setState({inputValue:e,isError:!g})),i.props.toggleDisabled(!g)},i.initKeyBoard=function(){new f.ZP({root:i.contentRef.current,bindings:[{key:f.rW.ENTER,handler:i.handleEnter}]})},i.handleEnter=function(){i.props.keyboardSubmit()},i.inputRef=p().createRef(),i.contentRef=p().createRef(),i.state={inputValue:"",isError:!1},i}(0,d.Z)(t,e);var i=t.prototype;return i.componentDidMount=function(){var e=this;this.initKeyBoard(),this.setState({inputValue:this.props.params.defaultValue},(function(){var t,i;null===(t=e.inputRef.current)||void 0===t||t.focus(),null===(i=e.inputRef.current)||void 0===i||i.select(),v=Number(e.props.params.defaultValue),g=!0}))},i.render=function(){return p().createElement("div",{ref:this.contentRef,style:{width:"100%",height:"100%"}},p().createElement("p",{style:{marginBottom:"10px"}},this.props.params.info),p().createElement(m.default.Item,{status:this.state.isError?"error":"default",message:this.props.params.errorInfo},p().createElement(u.default,{inputRef:this.inputRef,onFocus:this.onFocus.bind(this),value:this.state.inputValue,placeholder:this.props.params.defaultValue,onChange:this.getInputValue.bind(this),style:{width:"100%"}})))},i.onFocus=function(){isNaN(Number(this.state.inputValue))&&(g=!1,this.setState({inputValue:"",isError:!g}),this.props.toggleDisabled(!g))},t}(p().Component),S=function(e){var t=function(){return v<e.min||g&&(o(),e.callback(v-0)),!1},i=c.default.confirm({onOk:t,title:e.title,content:p().createElement(w,{params:e,keyboardSubmit:t,toggleDisabled:function(e){n({okDisabled:e})}}),closable:!0,draggable:!1,destroyOnClose:!0,okDisabled:!g&&!e.defaultValue}),n=i.update,o=i.close},_=i("../packages/model/src/config/index.ts"),y=function(){function e(e,t,i,n){this.spreadsheetApp=e,this.spreadsheet=t,this.spreadsheetView=i,this.normalSelectData=n}var t=e.prototype;return t.insertRow=function(e){return this.spreadsheetApp.requestApi.insertRows(e)},t.insertCol=function(e){return this.spreadsheetApp.requestApi.insertColumns(e)},t.removeRow=function(){return this.spreadsheetApp.requestApi.deleteRows()},t.removeCol=function(){return this.spreadsheetApp.requestApi.deleteColumns()},t.setRowHeight=function(e,t){for(var i=[],n=0;n<e.length;n++){var s=e[n];i.push(new o.Z(this.spreadsheet.activeSheetId,s[0],s[1],a.Z.ROWS))}return this.spreadsheetApp.requestApi.resizeRows(i,t)},t.setColWidth=function(e,t){for(var i=[],n=0;n<e.length;n++){var s=e[n];i.push(new o.Z(this.spreadsheet.activeSheetId,s[0],s[1],a.Z.COLUMNS))}return this.spreadsheetApp.requestApi.resizeColumns(i,t)},t.setColWidths=function(e,t){for(var i=[],n=0;n<e.length;n++){var s=e[n];i.push(new o.Z(this.spreadsheet.activeSheetId,s[0],s[1],a.Z.COLUMNS))}return this.spreadsheetApp.requestApi.resizeColumns(i,t)},t.showDialogForRowsSetting=function(){var e,t=this,i=this.normalSelectData.selectQueue,o=n.ZP.t("设置行高"),a=n.ZP.t("行高 ( 默认值: {{DEFAULT_ROW_HEIGHT}}像素 )",{DEFAULT_ROW_HEIGHT:_.DEFAULT_ROW_HEIGHT});if(this.normalSelectData.isSingle()){var s=i[0],d=[0,0];if(s.selectAll||s.selectCol)d[0]=0,d[1]=this.spreadsheetView.rowcolAccessor.getRowCount()-1;else{if(!s.selectRow&&!s.selectCell)throw new Error("不可用的选区类型");d[0]=s.yRange[0],d[1]=s.yRange[1]}e=this.getDefaultRowSize(d),isNaN(e)&&(e="")}else e="";S({title:o,info:a,min:10,defaultValue:e.toString(),errorInfo:n.ZP.t("有效范围：{{min}}-1000",{min:10}),callback:function(e){var i=(0,l.TS)(t.spreadsheetView.rowcolAccessor,t.normalSelectData.selectQueue);t.setRowHeight(i,e),i.forEach((function(e){var t=e[0]===e[1]?"menu_1row_size":"menu_nrow_size";r.ZP.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:t})}))}})},t.showDialogForColsSetting=function(){var e,t=this,i=this.normalSelectData.selectQueue,o=n.ZP.t("设置列宽"),a=n.ZP.t("列宽 ( 默认值: {{DEFAULT_COL_WIDTH}}像素 )",{DEFAULT_COL_WIDTH:_.DEFAULT_COL_WIDTH});if(this.normalSelectData.isSingle()){var s=i[0],d=[0,0];if(s.selectAll||s.selectRow)d[0]=0,d[1]=this.spreadsheetView.rowcolAccessor.getColCount()-1;else{if(!s.selectCol&&!s.selectCell)throw new Error("不可用的选区类型");d[0]=s.xRange[0],d[1]=s.xRange[1]}e=this.getDefaultColSize(d),isNaN(e)&&(e="")}else e="";S({title:o,info:a,min:10,defaultValue:e.toString(),errorInfo:n.ZP.t("有效范围：{{min}}-1000",{min:10}),callback:function(e){var i=(0,l.rz)(t.spreadsheetView.rowcolAccessor,t.normalSelectData.selectQueue);t.setColWidth(i,e),i.forEach((function(e){var t=e[0]===e[1]?"menu_1col_size":"menu_ncol_size";r.ZP.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:t})}))}})},t.setRowHeightAutoFit=function(e){return this.setRowHeight(e,void 0)},t.setColWidthAutoFit=function(e){var t=s(this.spreadsheetView.tableView,this.spreadsheetView.rowcolAccessor,this.spreadsheetView.paragraphAccessor,e),i=[],n=[];for(var o in t)i.push([Number(o),Number(o)]),n.push(t[o]+1);return this.setColWidths(i,n)},t.setRowAndColAutoFit=function(e,t){for(var i=[],n=0;n<e.length;n++){var r=e[n];i.push({dimensionRange:new o.Z(this.spreadsheet.activeSheetId,r[0],r[1],a.Z.ROWS),size:void 0})}var l=s(this.spreadsheetView.tableView,this.spreadsheetView.rowcolAccessor,this.spreadsheetView.paragraphAccessor,t),d=[];for(var c in l)d.push({dimensionRange:new o.Z(this.spreadsheet.activeSheetId,Number(c),Number(c),a.Z.COLUMNS),size:l[c]});return this.spreadsheetApp.requestApi.resizeRowsColumns([].concat(i,d))},t.setColWidthToDefault=function(e){return this.setColWidth(e,_.DEFAULT_COL_WIDTH)},t.moveRows=function(e,t){var i=new o.Z(this.spreadsheet.activeSheetId,e[0],e[1],a.Z.ROWS);return this.spreadsheetApp.requestApi.moveRows(i,t)},t.moveCols=function(e,t){var i=new o.Z(this.spreadsheet.activeSheetId,e[0],e[1],a.Z.COLUMNS);return this.spreadsheetApp.requestApi.moveColumns(i,t)},t.hideRows=function(e){var t=this.transformOptionsToDiemsnionRanges(e,a.Z.ROWS);return this.spreadsheetApp.requestApi.hideRows(t)},t.hideCols=function(e){var t=this.transformOptionsToDiemsnionRanges(e,a.Z.COLUMNS);return this.spreadsheetApp.requestApi.hideColumns(t)},t.showRows=function(e){var t=this.transformOptionsToDiemsnionRanges(e,a.Z.ROWS);return this.spreadsheetApp.requestApi.showRows(t)},t.showCols=function(e){var t=this.transformOptionsToDiemsnionRanges(e,a.Z.COLUMNS);return this.spreadsheetApp.requestApi.showColumns(t)},t.getDefaultRowSize=function(e){for(var t=this.spreadsheetView.rowcolAccessor.getRowDisplayHeight(e[0]),i=e[0]+1;i<=e[1];i++)if(t!==this.spreadsheetView.rowcolAccessor.getRowDisplayHeight(i))return NaN;return t},t.getDefaultColSize=function(e){for(var t=this.spreadsheetView.rowcolAccessor.getColSetWidth(e[0]),i=e[0]+1;i<=e[1];i++)if(t!==this.spreadsheetView.rowcolAccessor.getColSetWidth(i))return NaN;return t},t.transformOptionsToDiemsnionRanges=function(e,t){for(var i=[],n=0;n<e.length;n++){var a=e[n];i.push(new o.Z(this.spreadsheet.activeSheetId,a.index,a.index+a.amount-1,t))}return i},e}()},"../spread-sheet/src/core/view/level-1/modify-broker/link/modify-link-broker.ts":function(e,t){var i=function(){function e(e){this.spreadsheetApp=e}var t=e.prototype;return t.setHyperlinkIconVisibility=function(e){var t=e.row,i=e.col,n=e.visibility;this.spreadsheetApp.requestApi.setHyperlinkIconVisibility({row:t,col:i,visibility:n})},t.setHyperlinkRuns=function(e){var t=e.row,i=e.col,n=e.linkValue,o=e.range;this.spreadsheetApp.requestApi.setHyperlinkRuns({row:t,col:i,linkValue:n,range:o})},t.cancelLink=function(e,t){this.spreadsheetApp.requestApi.clearLink(e,t)},t.insertLink=function(e,t,i,n){this.spreadsheetApp.requestApi.setLink(n,i,e,t)},t.insertHyperLink=function(e,t,i,n,o,a){this.spreadsheetApp.requestApi.setHyperLink(n,i,o,e,t,a)},t.addLinkedRange=function(e){return this.spreadsheetApp.requestApi.addLinkedRange(e)},e}();t.Z=i},"../spread-sheet/src/core/view/level-1/modify-broker/mention-notify-ent/modify-mention-notify-broker.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=i("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(i("../node_modules/core-js/modules/es.array.iterator.js"),i("../node_modules/core-js/modules/es.map.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.string.iterator.js"),i("../node_modules/core-js/modules/esnext.map.delete-all.js"),i("../node_modules/core-js/modules/esnext.map.every.js"),i("../node_modules/core-js/modules/esnext.map.filter.js"),i("../node_modules/core-js/modules/esnext.map.find.js"),i("../node_modules/core-js/modules/esnext.map.find-key.js"),i("../node_modules/core-js/modules/esnext.map.includes.js"),i("../node_modules/core-js/modules/esnext.map.key-of.js"),i("../node_modules/core-js/modules/esnext.map.map-keys.js"),i("../node_modules/core-js/modules/esnext.map.map-values.js"),i("../node_modules/core-js/modules/esnext.map.merge.js"),i("../node_modules/core-js/modules/esnext.map.reduce.js"),i("../node_modules/core-js/modules/esnext.map.some.js"),i("../node_modules/core-js/modules/esnext.map.update.js"),i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../node_modules/core-js/modules/es.object.keys.js"),i("../node_modules/core-js/modules/es.regexp.constructor.js"),i("../node_modules/core-js/modules/es.regexp.exec.js"),i("../node_modules/core-js/modules/es.regexp.to-string.js"),i("../node_modules/i18next/dist/esm/i18next.js")),r=i("./node_modules/axios/index.js"),l=i.n(r),d=i("../spread-sheet/src/external/resetLocation/utils.ts"),c=i("../node_modules/@tencent/containerized/build/main/index.js"),u=i("../spread-sheet/src/external/mention-ent/varsSettings.ts"),h=i("../spread-sheet/src/core/ui/toast/toast.tsx"),p=i("../node_modules/@tencent/docs-user-agent/dist/index.js"),f=i.n(p),m=i("../packages/report/src/index.ts"),v=i("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),g=function(e){function t(t){var i;return(i=e.call(this)||this).handleAuthError=function(e){v.default.show({type:"error",message:s.ZP.t(e+"没有此文档权限，不会收到提醒。"),autoClose:!0,duration:3e3,style:{zIndex:10004}})},i._normalSelectData=t.normalSelectData,i._waitingNotifyQueue=new Map,i._spreadSheet=t.spreadsheet,i._register(i._spreadSheet.onClearAllMention(i.clearMentionNotify.bind((0,o.Z)(i)))),i._register(i._spreadSheet.onNewAllMention(i.notifyNewMention.bind((0,o.Z)(i)))),i}(0,a.Z)(t,e);var r=t.prototype;return r.clearMentionNotify=function(e){var t=this,i=e.rowIndex,n=e.colIndex,o=e.callback,a=!1;this._waitingNotifyQueue.forEach((function(e,o){e.row===i&&e.col===n&&t.popMentionFromWaitingQueue(o)&&(a=!0)})),a&&this.showCancelNotifyToast(),null===o||void 0===o||o(a)},r.reduceMention=function(e){return Object.keys(e).reduce((function(t,i){return t[e[i].userId]=e[i],t}),{})},r.toKey=function(e,t,i){return e+"-"+t+"-"+i},r.notifyNewMention=function(e){for(var t,i=e.mentionDetails,n=e.colIndex,o=e.rowIndex,a=e.mentionText,s=i?this.reduceMention(i):{},r=0,l=Object.keys(s);r<l.length;r++)t=l[r],this.pushMentionToWaitingQueue(s[t],o,n,a)},r.hasMentionInWaitingQueue=function(e){return this._waitingNotifyQueue.has(e)},r.popMentionFromWaitingQueue=function(e){var t=this._waitingNotifyQueue.get(e);return!!t&&(this._waitingNotifyQueue.delete(e),clearTimeout(t.timeoutHandler),!0)},r.pushMentionToWaitingQueue=function(e,t,n,o){var a=this,r=e.sheetId,c=e.mentionId,h=e.userId,p=e.text,v=this.toKey(h,t,n);if(!this.hasMentionInWaitingQueue(v)){var g=(0,u.NA)(),w=(0,u.Ou)(),S=0;new RegExp(/^(w|e)2_/i).test(g)&&(S=2);var _={xRange:[n,n],yRange:[t,t],row:{frozen:0,flow:0},col:{frozen:0,flow:0}},y=r+"|"+(0,d.gl)(!1,_,t,n)+"|"+c,E={method:"get",url:"/txdoc/mention_notify",params:{doc_id:g,to_vid:e.userId,title:encodeURIComponent(s.ZP.t("在 {{fileName}}) 中 @ 了你",{fileName:w})),content:encodeURIComponent(o),plat:S,mainid:encodeURIComponent(y),r:Math.random(),sheet_id:r}},b=setTimeout((function(){var e,t=f().isPC;e=t?"xls_atsucc_pc":"xls_atsucc_m",m.ZP.kvrOss({itemname:e,DocID:(0,u.NA)()}),a._waitingNotifyQueue.delete(v),i.g.log.log("enterprise mention_notify start",E.params.to_vid+w+" "+o),l()(E).then((function(e){var t,n,o,s,r=e.data;0!==(null===(t=null===r||void 0===r?void 0:r.body)||void 0===t?void 0:t.ret)?(i.g.log.log("mention_notify error",(null===r||void 0===r?void 0:r.body)?null===(n=null===r||void 0===r?void 0:r.body)||void 0===n?void 0:n.ret:null===(o=null===r||void 0===r?void 0:r.head)||void 0===o?void 0:o.ret),m.ZP.kvrOss({itemname:"xls_at_succ"})):i.g.log.log("mention_notify success",E.params.to_vid),!1===(null===(s=null===r||void 0===r?void 0:r.body)||void 0===s?void 0:s.has_auth)&&(a.handleAuthError(p),i.g.log.log("mention_notify fail, the user-mentioned has no auth",E.params.to_vid))})).catch((function(e){i.g.log.log("mention_notify network error",e)}))}),5e3);i.g.log.log("[modifyMentionNotifyBroker] pushMentionToWaitingQueue row: "+t+", col: "+n+", "+h),this._waitingNotifyQueue.set(v,{row:t,col:n,userId:h,timeoutHandler:b})}},r.showCancelNotifyToast=function(){(0,h.showToast)(s.ZP.t("已撤销本次 @，对方不会收到通知"),{},{toolToastCloseTime:2e3})},(0,n.Z)(t,[{key:"normalSelectData",get:function(){return this._normalSelectData}}]),t}(c.JT);t.Z=g},"../spread-sheet/src/core/view/level-1/modify-broker/selection/modify-selection-broker.ts":function(e,t,i){var n=i("../spread-sheet/src/core/view/utils/base-func.ts"),o=function(){function e(e){var t=this;this.normalSelectData=e,this.cache=null,this.throttleSetSelection=(0,n.kf)((function(){null!==t.cache&&(t.normalSelectData.updateSelection(t.normalSelectData.currentSelectIndex,t.cache),t.cache=null)}),0)}return e.prototype.setSelection=function(e){this.cache=e,this.throttleSetSelection()},e}();t.Z=o},"../spread-sheet/src/core/view/level-1/modify-broker/shape/modify-shape-broker.ts":function(e,t,i){i("../node_modules/core-js/modules/es.object.assign.js");var n=i("../packages/model/src/embedded/EmbeddedObjectType.ts"),o=function(){function e(e,t){this.spreadsheetApp=e,this.spreadsheet=t}var t=e.prototype;return t.insertImage=function(e,t){void 0===t&&(t=!1),this.spreadsheetApp.requestApi.addImage(e,t)},t.updateShape=function(e,t){this.spreadsheetApp.requestApi.updateImage(Object.assign(t,{type:n.Z.IMAGE,id:e,sheetId:this.spreadsheet.activeSheetId}))},t.deleteShape=function(e){this.spreadsheetApp.requestApi.deleteImage({id:e,sheetId:this.spreadsheet.activeSheetId})},e}();t.Z=o},"../spread-sheet/src/core/view/level-1/modify-broker/smart-selection/modify-smart-selection-broker.ts":function(e,t,i){i("../node_modules/regenerator-runtime/runtime.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.promise.js");var n=function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function s(e){try{l(n.next(e))}catch(t){a(t)}}function r(e){try{l(n.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))},o=function(){function e(e){this.spreadsheetApp=e}return e.prototype.calc=function(e){return n(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.spreadsheetApp.editFeature.getSmartSelection();case 2:(0,t.sent)(this.spreadsheetApp,e);case 4:case"end":return t.stop()}}),t,this)})))},e}();t.Z=o},"../spread-sheet/src/core/view/level-1/scale-operate/ScaleOperate.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=i("../spread-sheet/src/core/view/utils/base-func.ts"),a=i("../spread-sheet/src/base/event/event.ts"),s=i("../node_modules/@tencent/containerized/build/main/index.js"),r=i("../packages/lib/index.ts"),l=i("../spread-sheet/src/core/view/spreadsheet-view/operate-context/operate-data/FingerData.ts"),d=i("../packages/lib/Keyboard.ts"),c=function(e){function t(t,n,s){var c;return(c=e.call(this)||this).spreadsheetView=t,c.scrollApi=n,c.spreadSheetApp=s,c.onStartScaleEmitter=new r.Q5,c.onEndScaleEmitter=new r.Q5,c.isShortKey=!1,c.timer=0,c._oldScale=0,c._scaleTo=(0,o.kf)((function(e,t){if(void 0===t&&(t={x:0,y:0}),e!==c.spreadsheetView.scale.scale){var i=c.spreadsheetView.scale.scale,n=c.spreadsheetView.areaData.col.flow.offsetSize+t.x/i*c._oldScale,o=c.spreadsheetView.areaData.row.flow.offsetSize+t.y/i*c._oldScale;c.spreadsheetView.scale.scaleTo(e);var a=n-(c.spreadsheetView.areaData.col.flow.offsetSize+t.x/e*c._oldScale),s=o-(c.spreadsheetView.areaData.row.flow.offsetSize+t.y/e*c._oldScale);c.scrollApi.scrollByPixel({diffX:a,diffY:s,areaX:"flow",areaY:"flow"})}}),30),c._handleTouchstart=function(){c.spreadsheetView.operateContext.operateData.fingerData.mode===l.w.SCALE&&(c._oldScale=c.spreadsheetView.scale.scale,c.onStartScaleEmitter.fire(),document.body.addEventListener("touchmove",c._handleTouchmove),document.body.addEventListener("touchend",c._handleTouchend))},c._handleTouchmove=function(){var e=c.spreadsheetView.operateContext.operateData;if(e.fingerData.mode===l.w.SCALE){var t=e.fingerData.zoom*c.spreadsheetView.scale.scale;t=Math.min(2,Math.max(.5,t)),c._scaleTo(t,e.fingerData.center)}},c._handleTouchend=function(){c.onEndScaleEmitter.fire(),document.body.removeEventListener("touchmove",c._handleTouchmove),document.body.removeEventListener("touchup",c._handleTouchend)},c.handleWheelFirstTime=function(e){c.isShortKey=e[d.jQ],0!==e.deltaY&&(c.handleWheelScale(e),c.spreadSheetApp.spreadsheet.isExternalSheet()||(c.handleWheelScale(e),window.removeEventListener("wheel",c.handleWheelFirstTime,!0),window.addEventListener("wheel",c.handleWheelFromSecondTime,{capture:!0,passive:!1}),window.addEventListener("keyup",c.handleKeyUp)))},c.handleWheelFromSecondTime=function(e){0!==e.deltaY&&(c.timer&&i.g.clearTimeout(c.timer),c.timer=i.g.setTimeout((function(){window.removeEventListener("wheel",c.handleWheelFromSecondTime,!0),window.removeEventListener("keyup",c.handleKeyUp),window.addEventListener("wheel",c.handleWheelFirstTime,{capture:!0,passive:!1}),c.timer=0,c.isShortKey=!1}),300),c.handleWheelScale(e))},c.handleKeyUp=function(e){e.key===d.h1&&(c.isShortKey=!1)},c.handleWheelScale=function(e){if(c.isShortKey){var t=-e.deltaY/Math.abs(e.deltaY)*2;a.ZP.sheetsBar.trigger("changeScale",t),e.stopPropagation(),e.preventDefault()}},c.onStartScale=c.onStartScaleEmitter.event,c.onEndScale=c.onEndScaleEmitter.event,c._register(c.spreadsheetView.operateContext.touchOperate.onTouchstart(c._handleTouchstart)),window.addEventListener("wheel",c.handleWheelFirstTime,{capture:!0,passive:!1}),c}return(0,n.Z)(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),window.removeEventListener("wheel",this.handleWheelFirstTime,!0)},t}(s.JT);t.Z=c},"../spread-sheet/src/core/view/level-1/scroll-api/ScrollApi.interface.ts":function(e,t,i){i.d(t,{ru:function(){return n}});var n,o=i("../node_modules/@tencent/containerized/build/main/index.js");!function(e){e.LINE="LINE",e.EASE_OUT="EASE_OUT"}(n||(n={})),(0,o.yh)("IScrollApi")},"../spread-sheet/src/core/view/level-1/scroll-api/ScrollApi.ts":function(e,t,i){i("../node_modules/core-js/modules/es.object.assign.js");var n=i("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=i.n(n),a=i("../spread-sheet/src/core/view/spreadsheet-view/area-data/AreaData.interface.ts"),s=i("../spread-sheet/src/core/view/utils/view-utils.ts"),r=i("../spread-sheet/src/core/view/level-1/scroll-api/ScrollApi.interface.ts"),l=i("../spread-sheet/src/core/view/level-1/scroll-api/utils.ts"),d=function(){function e(e){this.spreadsheetView=e}var t=e.prototype;return t.scrollByPixel=function(e,t,i,n){void 0===t&&(t=!0),void 0===n&&(n=a.oz.SLIENT);var o=0,s=0,r=0,l=0,d={flow:!1,frozen:!1};if(void 0!==(null===e||void 0===e?void 0:e.diffX))switch(null===e||void 0===e?void 0:e.areaX){case"flow":o=e.diffX;break;case"frozen":r=e.diffX}if(void 0!==(null===e||void 0===e?void 0:e.diffY))switch(null===e||void 0===e?void 0:e.areaY){case"flow":s=e.diffY;break;case"frozen":l=e.diffY}this._scroll({diffX:o,diffY:s},t,Object.assign(Object.assign({},i),{onAnimationEnd:function(){var e;d.flow=!0,d.frozen&&(null===(e=null===i||void 0===i?void 0:i.onAnimationEnd)||void 0===e||e.call(i))}}),n),this.scrollOfFrozen({diffFrozenX:r,diffFrozenY:l},(function(){var e;d.frozen=!0,d.flow&&(null===(e=null===i||void 0===i?void 0:i.onAnimationEnd)||void 0===e||e.call(i))}))},t.scrollToRenderFrom=function(e,t,i,n){void 0===t&&(t=!0),void 0===n&&(n=a.oz.SLIENT);var o=0,s=0,r=this.spreadsheetView.areaData;if(void 0!==e.row&&e.row>=r.row.flow.from){if(e.row>r.row.flow.to)throw new Error("row越界，无法定位");s=r.getAreaTopByRow(e.row)-r.row.flow.offsetSize}if(void 0!==e.col&&e.col>=r.col.flow.from){if(e.col>r.col.flow.to)throw new Error("col越界，无法定位");o=r.getAreaLeftByCol(e.col)-r.col.flow.offsetSize}this._scroll({diffX:o,diffY:s},t,i,n)},t.scrollToVisible=function(e,t,i,n){void 0===t&&(t=!0),void 0===n&&(n=a.oz.SLIENT);var o=this.spreadsheetView.areaData,s=(0,l.Hg)(e,o),r=(0,l.yE)(e,o);this._scroll({diffX:s,diffY:r},t,i,n)},t.scrollToDistanceAnchor=function(e,t,i){void 0===t&&(t=!0);var n=e.row,o=e.col,a=e.left,s=void 0===a?0:a,r=e.top,l=void 0===r?0:r,d=e.ignoreFrozen,c=void 0!==d&&d,u=this.spreadsheetView.areaData;if(c||!u.row.frozen.isValid()&&!u.col.frozen.isValid()){var h=0,p=0;if(void 0!==n&&n>=u.row.flow.from){if(n>u.row.flow.to)throw new Error("row 越界，无法定位");p=u.getAreaTopByRow(n)-l-u.row.flow.offsetSize}if(void 0!==o&&o>=u.col.flow.from){if(o>u.col.flow.to)throw new Error("col 越界，无法定位");h=u.getAreaLeftByCol(o)-s-u.col.flow.offsetSize}this._scroll({diffX:h,diffY:p},t,i)}else this.scrollToVisible({row:n,col:o},t,i)},t.scrollOfFrozen=function(e,t){if(void 0===t&&(t=function(){}),o().isPC)t();else{var i=e.diffFrozenX,n=e.diffFrozenY;if(0!==i){var a=this.spreadsheetView.areaData.col.frozen.viewSize;a+=i,a=Math.min(this.spreadsheetView.areaData.col.frozen.totalSize,Math.max((0,s.pJ)(this.spreadsheetView),a)),this.spreadsheetView.areaData.col.setMaxFrozenViewSize(a),this.spreadsheetView.areaData.col.frozen.setOffsetSize(this.spreadsheetView.areaData.col.frozen.totalSize)}if(0!==n){var r=this.spreadsheetView.areaData.row.frozen.viewSize;r+=n,r=Math.min(this.spreadsheetView.areaData.row.frozen.totalSize,Math.max((0,s.n_)(this.spreadsheetView),r)),this.spreadsheetView.areaData.row.setMaxFrozenViewSize(r),this.spreadsheetView.areaData.row.frozen.setOffsetSize(this.spreadsheetView.areaData.row.frozen.totalSize)}this.spreadsheetView.renderManager.renderApi.renderTable(),t()}},t._scroll=function(e,t,i,n){var o,s;void 0===t&&(t=!0),void 0===i&&(i={}),void 0===n&&(n=a.oz.SLIENT);var r=e.diffX,l=e.diffY,d=this.spreadsheetView.areaData;if(this.cancelAnimationHandler&&(this.cancelAnimationHandler(),this.cancelAnimationHandler=void 0),0!==r||0!==l)return t?(d.row.flow.setOffsetSize(d.row.flow.offsetSize+l,n),d.col.flow.setOffsetSize(d.col.flow.offsetSize+r,n),void(null===(s=i.onAnimationEnd)||void 0===s||s.call(i))):void this.setScrollWithAnimation(r,l,i,n);null===(o=i.onAnimationEnd)||void 0===o||o.call(i)},t.setScrollWithAnimation=function(e,t,i,n){void 0===n&&(n=a.oz.SLIENT);var o=i.type,s=void 0===o?r.ru.LINE:o,l=i.onAnimationEnd;switch(s){case r.ru.EASE_OUT:this.animationWithEaseOut(e,t,l,n,i.duration);break;case r.ru.LINE:this.animationWithLinear(e,t,l,n,i.steps)}},t.adjustScrollDistance=function(e,t,i){void 0===i&&(i=a.oz.SLIENT);var n=100,o=this.spreadsheetView.areaData,s=0,r=0;if(Math.abs(e)<n)s=e;else{var l=e/Math.abs(e),d=o.col.flow.offsetSize+l*(Math.abs(e)-n);o.col.flow.setOffsetSize(d,i),s=n*l}if(Math.abs(t)<n)r=t;else{var c=t/Math.abs(t),u=o.row.flow.offsetSize+c*(Math.abs(t)-n);o.row.flow.setOffsetSize(u,i),r=n*c}return{diffX:s,diffY:r}},t.animationWithEaseOut=function(e,t,i,n,o){var s=this;void 0===n&&(n=a.oz.SLIENT);var r=this.adjustScrollDistance(e,t,n),d=r.diffX,c=r.diffY,u=this.spreadsheetView.areaData,h=u.col.flow.offsetSize,p=u.row.flow.offsetSize,f=0,m=0;this.cancelAnimationHandler=(0,l.Vv)((function(e){var t,o=Math.ceil(e*d),a=Math.ceil(e*c);Math.abs(o-f)<2&&(o=f),Math.abs(a-m)<2&&(a=m),o===f&&a===m||(f=o,m=a,Math.abs(d-o)<2&&(o=d),Math.abs(c-a)<2&&(a=c),u.col.flow.setOffsetSize(o+h,n),u.row.flow.setOffsetSize(a+p,n),o===d&&a===c&&(null===i||void 0===i||i(),null===(t=s.cancelAnimationHandler)||void 0===t||t.call(s),s.cancelAnimationHandler=void 0))}),(function(){u.col.flow.setOffsetSize(d+h,n),u.row.flow.setOffsetSize(c+p,n),null===i||void 0===i||i(),s.cancelAnimationHandler=void 0}),o)},t.animationWithLinear=function(e,t,i,n,o){var s=this;void 0===n&&(n=a.oz.SLIENT);var r=this.spreadsheetView.areaData,d=o||(0,l.SI)(e,t),c=Math.abs(e)>Math.abs(t)?e:t,u=0,h=0;this.cancelAnimationHandler=(0,l.bJ)(0,c,d,(function(i){var o=i/c*e-u,a=i/c*t-h;r.row.flow.setOffsetSize(r.row.flow.offsetSize+a,n),r.col.flow.setOffsetSize(r.col.flow.offsetSize+o,n),u+=o,h+=a}),(function(){null===i||void 0===i||i(),s.cancelAnimationHandler=void 0}))},e}();t.Z=d},"../spread-sheet/src/core/view/level-1/scroll-api/utils.ts":function(e,t,i){i.d(t,{Hg:function(){return l},SI:function(){return s},Vv:function(){return r},bJ:function(){return a},yE:function(){return d}});var n=i("../node_modules/bezier-easing/src/index.js"),o=i.n(n);function a(e,t,i,n,o){i=i||2;var a=0,s=e;return function r(){if(s+=(t-e)/i,Math.abs(s)>Math.abs(t)-5)return n(t),null===o||void 0===o||o(),void(a=0);n(s),a=requestAnimationFrame(r)}(),function(){a&&cancelAnimationFrame(a)}}function s(e,t){var i=Math.abs(e||t);if(0===i)return 8;var n=8+i/(window.innerHeight/2)*8;return Math.min(16,Math.max(8,Math.round(n)))}function r(e,t,i){void 0===i&&(i=600);var n=o()(0,.98,.26,.99),a=Date.now(),s=0;return function o(){var r=(Date.now()-a)/i,l=n(r);l<1&&r<1?(e(l),s=requestAnimationFrame(o)):(null===t||void 0===t||t(),s=0)}(),function(){s&&cancelAnimationFrame(s)}}function l(e,t){var i,n,o=0,a=e.x||0,s=(null===(i=e.padding)||void 0===i?void 0:i.left)||0,r=(null===(n=e.padding)||void 0===n?void 0:n.right)||0;if(void 0!==e.col&&e.col>=t.col.flow.from){if(e.col>t.col.flow.to)throw new Error("col越界，无法定位");o=t.getAreaLeftByCol(e.col)-a-s-t.col.flow.offsetSize,0===(o=Math.min(0,o))&&(o=t.getAreaLeftByCol(e.col+1)+a+r-t.col.flow.viewSize-t.col.flow.offsetSize+t.col.flow.padding,o=Math.max(0,o))}return o}function d(e,t){var i,n,o=0,a=e.y||0,s=(null===(i=e.padding)||void 0===i?void 0:i.top)||0,r=(null===(n=e.padding)||void 0===n?void 0:n.bottom)||0;if(void 0!==e.row&&e.row>=t.row.flow.from){if(e.row>t.row.flow.to)throw new Error("row 越界，无法定位");o=t.getAreaTopByRow(e.row)-a-s-t.row.flow.offsetSize,0===(o=Math.min(0,o))&&(o=t.getAreaTopByRow(e.row+1)+a+r-t.row.flow.viewSize-t.row.flow.offsetSize+t.row.flow.padding,o=Math.max(0,o))}return o}},"../spread-sheet/src/core/view/level-1/scroll-bar/ScrollBar.pc.ts":function(e,t,i){i.d(t,{Z:function(){return f}});var n=i("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),o=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),a=(i("../node_modules/core-js/modules/es.object.assign.js"),i("../spread-sheet/src/core/view/level-1/scroll-bar/ScrollBar.base.ts")),s=i("../spread-sheet/src/core/view/utils/base-func.ts"),r=i("../node_modules/@tencent/docs-user-agent/dist/index.js"),l=i.n(r),d=function(){function e(e,t,i,n){var o=this;this._board=document.createElement("div"),this._box=document.createElement("div"),this._originY=0,this._setBoxHeight=(0,s.ad)((function(){o._area.displayTotalSize<o._area.displayViewSize?o._board.style.display="none":(o._board.style.display="block",o._height=Math.max(60,o._area.displayViewSize/o._area.displayTotalSize*o._area.displayViewSize),o._box.style.height=o._height+"px",o._setBoxOffset())})),this._setBoxOffset=function(){var e=o._area.displayOffsetSize/(o._area.displayTotalSize-o._area.displayViewSize)*(o._area.displayViewSize-o._height-o._area.displayPadding);o._box.style.transform="translateY("+e+"px)"},this._handleMousedown=function(e){e.preventDefault(),e.stopPropagation(),o._originY=e.clientY,document.addEventListener("mousemove",o._handleMousemove),document.addEventListener("mouseup",o._handleMouseup)},this._handleMousemove=function(e){var t=e.clientY,i=o._originY-t;o._callback({x:0,y:i/(o._area.displayViewSize-o._height)*(o._area.displayTotalSize-o._area.displayViewSize)/o._scale.scale}),o._originY=t},this._handleMouseup=function(){document.removeEventListener("mousemove",o._handleMousemove),document.removeEventListener("mouseup",o._handleMouseup),o._originY=0},this._handleTouchStart=function(e){var t,i;e.stopPropagation(),o._originY=null===(i=null===(t=e.targetTouches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientY,document.addEventListener("touchmove",o._handleTouchmove),document.addEventListener("touchend",o._handleTouchend)},this._handleTouchmove=function(e){var t,i,n=null===(i=null===(t=e.targetTouches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientY,a=o._originY-n;o._callback({x:0,y:a/(o._area.displayViewSize-o._height)*(o._area.displayTotalSize-o._area.displayViewSize)/o._scale.scale}),o._originY=n},this._handleTouchend=function(){document.removeEventListener("touchmove",o._handleTouchmove),document.removeEventListener("touchend",o._handleTouchend),o._originY=0},this._area=t,this._callback=n,this._scale=i,this._board.classList.add("scroll-y-board-pc"),this._box.classList.add("scroll-y-box-pc"),l().isMobile&&this._box.classList.add("scroll-y-box-pad"),this._setBoxHeight(),this._board.appendChild(this._box),e.appendChild(this._board),this._area.onUpdateOffset(this._setBoxOffset),this._area.onUpdateViewSize(this._setBoxHeight),this._area.onUpdateTotalSize(this._setBoxHeight),this.bind()}var t=e.prototype;return t.refresh=function(){this._setBoxHeight(),this._setBoxOffset()},t.bind=function(){this._box.addEventListener("mousedown",this._handleMousedown),this._box.addEventListener("touchstart",this._handleTouchStart)},t.unbind=function(){this._box.removeEventListener("mousedown",this._handleMousedown),this._box.removeEventListener("touchstart",this._handleTouchStart)},e}(),c=function(){function e(e,t,i,n){var o=this;this._board=document.createElement("div"),this._box=document.createElement("div"),this._originX=0,this._setBoxWidth=(0,s.ad)((function(){o._area.displayTotalSize<o._area.displayViewSize?o._board.style.display="none":(o._board.style.display="block",o._width=Math.max(60,o._area.displayViewSize/o._area.displayTotalSize*o._area.displayViewSize),o._box.style.width=(o._width>>0)+"px",o._setBoxOffset())})),this._setBoxOffset=function(){var e=o._area.displayOffsetSize/(o._area.displayTotalSize-o._area.displayViewSize)*(o._area.displayViewSize-o._width-o._area.displayPadding);o._box.style.transform="translateX("+e+"px)"},this._handleMousedown=function(e){e.preventDefault(),e.stopPropagation(),o._originX=e.clientX,document.addEventListener("mousemove",o._handleMousemove),document.addEventListener("mouseup",o._handleMouseup)},this._handleMousemove=function(e){var t=e.clientX,i=o._originX-t;o._callback({x:i/(o._area.displayViewSize-o._width)*(o._area.displayTotalSize-o._area.displayViewSize)/o._scale.scale,y:0}),o._originX=t},this._handleMouseup=function(){document.removeEventListener("mousemove",o._handleMousemove),document.removeEventListener("mouseup",o._handleMouseup),o._originX=0},this._handleTouchStart=function(e){var t,i;e.stopPropagation(),o._originX=null===(i=null===(t=e.targetTouches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientX,document.addEventListener("touchmove",o._handleTouchmove),document.addEventListener("touchend",o._handleTouchend)},this._handleTouchmove=function(e){var t,i,n=null===(i=null===(t=e.targetTouches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientX,a=o._originX-n;o._callback({x:a/(o._area.displayViewSize-o._width)*(o._area.displayTotalSize-o._area.displayViewSize)/o._scale.scale,y:0}),o._originX=n},this._handleTouchend=function(){document.removeEventListener("touchmove",o._handleTouchmove),document.removeEventListener("touchend",o._handleTouchend),o._originX=0},this._area=t,this._callback=n,this._scale=i,this._board.classList.add("scroll-x-board-pc"),this._box.classList.add("scroll-x-box-pc"),l().isMobile&&this._box.classList.add("scroll-x-box-pad"),this._setBoxWidth(),this._board.appendChild(this._box),e.appendChild(this._board),this._area.onUpdateOffset(this._setBoxOffset),this._area.onUpdateViewSize(this._setBoxWidth),this._area.onUpdateTotalSize(this._setBoxWidth),this.bind()}var t=e.prototype;return t.refresh=function(){this._setBoxWidth(),this._setBoxOffset()},t.bind=function(){this._box.addEventListener("mousedown",this._handleMousedown),this._box.addEventListener("touchstart",this._handleTouchStart)},t.unbind=function(){this._box.removeEventListener("mousedown",this._handleMousedown),this._box.removeEventListener("touchstart",this._handleTouchStart)},e}(),u=function(){function e(e,t){var i=this;this._yWrap=document.createElement("div"),this._xWrap=document.createElement("div"),this._refreshY=function(){i._yWrap.style.top=i._areaData.row.frozen.displayViewSize+"px",i._scrollY.refresh()},this._refreshX=function(){i._xWrap.style.left=i._areaData.col.frozen.displayViewSize+"px",i._scrollX.refresh()},this._container=e.container,this._areaData=e.areaData,this._scale=e.scale,this._yWrap.classList.add("scroll-y-wrap-pc"),this._xWrap.classList.add("scroll-x-wrap-pc"),this._scrollY=new d(this._yWrap,this._areaData.row.flow,this._scale,t),this._scrollX=new c(this._xWrap,this._areaData.col.flow,this._scale,t),this._container.appendChild(this._yWrap),this._container.appendChild(this._xWrap),this._refreshY(),this._refreshX(),this._areaData.row.frozen.onUpdateViewSize(this._refreshY),this._areaData.col.frozen.onUpdateViewSize(this._refreshX),this._scale.onScale((function(){i._refreshY(),i._refreshX()}))}return e.prototype.refresh=function(){this._refreshY(),this._refreshX()},e}(),h=function(e,t){var i=this;this._scrollBar=e,this._areaData=t.areaData,this._scrollBar.emitter.on(a.Z.EVENT.SCROLL,(function(e){0!=e.y&&i._areaData.row.flow.setOffsetSize(i._areaData.row.flow.offsetSize-e.y),0!=e.x&&i._areaData.col.flow.setOffsetSize(i._areaData.col.flow.offsetSize-e.x)}))},p=function(e){function t(t){var i;return(i=e.call(this,t)||this)._scrollCallback=function(e){i.emitter.emit(a.Z.EVENT.SCROLL,e)},i._scrollWrap=new u({container:i._mainBoard.element,areaData:i._areaData,scale:i._scale},i._scrollCallback),i._feature=new h((0,n.Z)(i),{areaData:i._areaData}),i}return(0,o.Z)(t,e),t.prototype.refresh=function(){this._scrollWrap.refresh()},t}(a.Z);p.EVENT=Object.assign({},a.Z.EVENT);var f=p},"../spread-sheet/src/core/view/level-1/select-api/SelectApi.ts":function(e,t,i){var n=i("../spread-sheet/src/core/view/level-1/select-center/base/utils.ts"),o=function(){function e(e){this.spreadsheetView=e,this.spreadsheetView=e}var t=e.prototype;return t.selectAll=function(e,t){void 0===t&&(t=null),this._clearSelectData(e),e.addSelection({},t)},t.selectCells=function(e,t,i){void 0===i&&(i=null),this._clearSelectData(e);var n={xRange:t.xRange,yRange:t.yRange};e.addSelection(n,i)},t.selectRows=function(e,t,i){void 0===i&&(i=null),this._clearSelectData(e);var n={yRange:t};e.addSelection(n,i)},t.selectCols=function(e,t,i){void 0===i&&(i=null),this._clearSelectData(e);var n={xRange:t};e.addSelection(n,i)},t.getSelectedRows=function(e){return(0,n.TS)(this.spreadsheetView.rowcolAccessor,e.selectQueue)},t.getSelectedCols=function(e){return(0,n.rz)(this.spreadsheetView.rowcolAccessor,e.selectQueue)},t._clearSelectData=function(e){e.resetSelection()},e}();t.Z=o},"../spread-sheet/src/core/view/level-1/select-center/normal-select-data/NormalSelectData.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),a=i("../spread-sheet/src/core/view/utils/base-func.ts"),s=i("../packages/lib/index.ts"),r=i("../spread-sheet/src/core/view/level-1/select-center/base/BaseSelectData.ts"),l=i("../spread-sheet/src/core/view/level-1/select-center/base/utils.ts"),d=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).onModifySelectDataEmitter=new s.Q5,n._modifySelection=(0,a.ad)((function(){n.onModifySelectDataEmitter.fire()})),n.onModifySelectData=n.onModifySelectDataEmitter.event,n}(0,o.Z)(t,e);var i=t.prototype;return i.isSingle=function(){return 1===this._selectQueue.length},i.addSelection=function(t){var i=this.select;i&&(i.activation=null,this.onUpdateSelectDataEmitter.fire({index:this.currentSelectIndex,selection:i})),t.activation||(t.activation={row:t.yRange?t.yRange[0]:0,col:t.xRange?t.xRange[0]:0}),e.prototype.addSelection.call(this,t,t.activation),this.onAddSelectDataEmitter.fire(this.select),this._modifySelection()},i.updateSelection=function(t,i){var n=this._selectQueue[t];if(!n)throw new Error("错误更新选区");if(!i.activation){if(!n.activation)throw new Error("未传入激活区域，并且无法复用之前的激活区域");if(i.activation={row:n.activation.row,col:n.activation.col},i.xRange&&(i.activation.col<i.xRange[0]||i.activation.col>i.xRange[1]))throw new Error("未传入激活区域，并且无法复用之前的激活区域");if(i.yRange&&(i.activation.row<i.yRange[0]||i.activation.row>i.yRange[1]))throw new Error("未传入激活区域，并且无法复用之前的激活区域")}e.prototype.updateSelection.call(this,t,i,i.activation),this.onUpdateSelectDataEmitter.fire({index:t,selection:this._selectQueue[t]}),this._modifySelection()},i.removeSelection=function(){throw new Error("normalSelectData shouldn't call removeSelection")},i.resetSelection=function(){e.prototype.resetSelection.call(this),this.onResetSelectDataEmitter.fire(),this._modifySelection()},(0,n.Z)(t,[{key:"activeRow",get:function(){var e=this.activation;return e?(0,l.Uz)(this.spreadsheetView.tableView,e.row,e.col).row:-1}},{key:"activeCol",get:function(){var e=this.activation;return e?(0,l.Uz)(this.spreadsheetView.tableView,e.row,e.col).col:-1}},{key:"activation",get:function(){return null===this.select?null:this.select.activation}}]),t}(r.Z);t.Z=d},"../spread-sheet/src/core/view/level-1/select-center/normal-select-stage/stage/DomSelectionStage.pc.ts":function(e,t,i){i.d(t,{Z:function(){return T}});var n=i("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=i("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(i("../node_modules/core-js/modules/es.array.splice.js"),i("../node_modules/core-js/modules/es.object.assign.js"),function(){function e(e){this._element=document.createElement("div"),this._ac=document.createElement("div"),this._stopPropagation=function(e){2==e.button&&e.stopPropagation()},this._element.classList.add("multiple-selection"),this._ac.classList.add("multiple-selection-active"),this._element.addEventListener("mousedown",this._stopPropagation),this._element.appendChild(this._ac),this.setAttribute(e)}return e.newInstance=function(t,i){var n=e.pools.pop();return n?n.setAttribute(i):n=new e(i),t.appendChild(n._element),n},e.destroy=function(t){t._element.remove(),e.pools.push(t)},e.prototype.setAttribute=function(e){var t;if(e.padding){this._ac.style.display="block";var i=e.padding;t=i[0]+"px "+i[1]+"px "+i[2]+"px "+i[3]+"px"}else this._ac.style.display="none",t="0px 0px 0px "+(e.width-1)+"px";var n=e.display,o=void 0===n||n;Object.assign(this._element.style,{left:e.left+"px",top:e.top+"px",width:Math.max(0,e.width-1)+"px",height:Math.max(0,e.height-1)+"px","border-width":t,display:o?"block":"none"})},e}());s.pools=[];var r=s,l=function(){function e(e){this._multipleSelections=[],this._board=e}var t=e.prototype;return t.size=function(){return this._multipleSelections.length},t.clear=function(){for(var e;e=this._multipleSelections.pop();)r.destroy(e)},t.remove=function(e){var t=this._multipleSelections[e];void 0!==t?(this._multipleSelections.splice(e,1),r.destroy(t)):console.error("can't find multiple selection by index: ",e)},t.add=function(e){this._multipleSelections.push(r.newInstance(this._board,e))},t.update=function(e,t){var i=this._multipleSelections[e];void 0!==i?i.setAttribute(t):console.error("can't find multiple selection by index: ",e)},e}(),d=function(){function e(){this._element=document.createElement("div"),this._element.classList.add("single-selection")}e.newInstance=function(t){var i=e.pools.pop();return i||(i=new e),t.appendChild(i._element),i},e.destroy=function(t){t._element.remove(),e.pools.push(t)};var t=e.prototype;return t.setAttribute=function(e){var t;if(e.padding){var i=e.padding;t=i[0]+"px "+i[1]+"px "+i[2]+"px "+i[3]+"px"}else t="0px 0px 0px "+(e.width-3)+"px";var n=e.display,o=void 0===n||n;Object.assign(this._element.style,{left:e.left+"px",top:e.top+"px",width:Math.max(0,e.width-1)+"px",height:Math.max(0,e.height-1)+"px","border-width":t,display:o?"block":"none"})},t.show=function(){this._element.style.display="block"},t.hide=function(){this._element.style.display="none"},e}();d.pools=[];var c=d,u=i("../node_modules/@tencent/containerized/build/main/index.js"),h=i("../packages/lib/event/index.ts"),p=function(e){function t(t){var n;return(n=e.call(this)||this)._serviceBrand=void 0,n.onClickEmitter=new h.Q,n.onDoubleClickEmitter=new h.Q,n.handleContextMenu=function(e){e.preventDefault()},n.handleMousedown=function(e){if(2===e.button)return e.preventDefault();n.onClickEmitter.fire(e)},n.handleDoubleClick=function(e){n.onDoubleClickEmitter.fire(e)},n.showCursor=function(){i.g.removeEventListener("mouseup",n.showCursor),setTimeout((function(){n.corner.classList.remove("no-cursor")}),100)},n.hideCursorWhenActive=function(){n.corner.classList.add("no-cursor"),i.g.addEventListener("mouseup",n.showCursor)},n.onClick=n.onClickEmitter.event,n.onDoubleClick=n.onDoubleClickEmitter.event,n.corner=document.createElement("div"),n.corner.classList.add("smart-corner"),n.corner.addEventListener("mousedown",n.handleMousedown),n.corner.addEventListener("dblclick",n.handleDoubleClick),n.corner.addEventListener("contextmenu",n.handleContextMenu),t.appendChild(n.corner),n}(0,a.Z)(t,e);var n=t.prototype;return n.setAttribute=function(e){this.hideCursorWhenActive(),Object.assign(this.corner.style,{left:e.left+e.width+"px",top:e.top+e.height+"px"})},n.show=function(){this.corner.style.display="block"},n.hide=function(){this.corner.style.display="none"},t}(u.JT),f=(i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../node_modules/core-js/modules/es.object.keys.js"),i("../packages/lib/index.ts")),m=function(){function e(e){var t=this;this.valid=!1,this.initDraggers=function(e){t.draggers={topDragger:t.initDiv("top"),rightDragger:t.initDiv("right"),bottomDragger:t.initDiv("bottom"),leftDragger:t.initDiv("left")},Object.keys(t.draggers).forEach((function(i){e.appendChild(t.draggers[i])}))},this.initDiv=function(e){var i=document.createElement("div");return i.classList.add("range-move-dragger"),i.classList.add(e),i.addEventListener("mousedown",t.handleMousedown),i.addEventListener("contextmenu",t.handleContextMenu),i},this.handleContextMenu=function(e){e.preventDefault(),e.stopPropagation()},this.handleMousedown=function(e){if(2===e.button)return e.preventDefault();t.mouseDownEmitter.fire(e)},this.showCursor=function(){i.g.removeEventListener("mouseup",t.showCursor),setTimeout((function(){t.draggers.topDragger.classList.remove("no-cursor"),t.draggers.rightDragger.classList.remove("no-cursor"),t.draggers.bottomDragger.classList.remove("no-cursor"),t.draggers.leftDragger.classList.remove("no-cursor")}),100)},this.hideCursorWhenActive=function(){t.draggers.topDragger.classList.add("no-cursor"),t.draggers.rightDragger.classList.add("no-cursor"),t.draggers.bottomDragger.classList.add("no-cursor"),t.draggers.leftDragger.classList.add("no-cursor"),i.g.addEventListener("mouseup",t.showCursor)},this.initDraggers(e),this.mouseDownEmitter=new f.Q5,this.onMouseDown=this.mouseDownEmitter.event}var t=e.prototype;return t.setAttribute=function(t){this.hideCursorWhenActive(),Object.assign(this.draggers.topDragger.style,{left:t.left+"px",top:t.top-2+"px",width:t.width+"px",height:e.BORDER_WIDTH+"px"}),Object.assign(this.draggers.rightDragger.style,{left:t.left+t.width-e.BORDER_WIDTH+1+"px",top:t.top+"px",width:e.BORDER_WIDTH+"px",height:t.height-e.BORDER_WIDTH+"px"}),Object.assign(this.draggers.bottomDragger.style,{left:t.left+"px",top:t.top+t.height-e.BORDER_WIDTH+1+"px",width:t.width+"px",height:e.BORDER_WIDTH+"px"}),Object.assign(this.draggers.leftDragger.style,{left:t.left-1+"px",top:t.top+"px",width:e.BORDER_WIDTH+"px",height:t.height-e.BORDER_WIDTH+"px"})},t.show=function(){var e=this;this.valid&&Object.keys(this.draggers).forEach((function(t){e.draggers[t].style.display="block"}))},t.hide=function(){var e=this;Object.keys(this.draggers).forEach((function(t){e.draggers[t].style.display="none"}))},t.setValid=function(e){this.valid=e,e?this.show():this.hide()},e}();m.BORDER_WIDTH=4;var v,g=m,w=i("../spread-sheet/src/base/util/appConfig.ts"),S=function(){function e(e){this.board=e,this.normalSelection=c.newInstance(this.board),this.smartCorner=new p(this.board),this.rangeMoveDragger=new g(this.board)}var t=e.prototype;return t.getLeft=function(){return this.left},t.getTop=function(){return this.top},t.getWidth=function(){return this.width},t.getHeight=function(){return this.height},t.getSmartCorner=function(){return this.smartCorner},t.hide=function(){!1!==w.Z.getConfig("custom.insertDeleteMoveRange")&&this.rangeMoveDragger.hide(),this.smartCorner.hide(),this.normalSelection.hide()},t.show=function(){!1!==w.Z.getConfig("custom.insertDeleteMoveRange")&&this.rangeMoveDragger.show(),this.smartCorner.show(),this.normalSelection.show()},t.update=function(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,!1!==w.Z.getConfig("custom.insertDeleteMoveRange")&&this.rangeMoveDragger.setAttribute(e),this.smartCorner.setAttribute(e),this.normalSelection.setAttribute(e)},e}();!function(e){e[e.EMPTY=0]="EMPTY",e[e.USING_SINGLE=1]="USING_SINGLE",e[e.USING_MULTIPLE=2]="USING_MULTIPLE"}(v||(v={}));var _=function(e){function t(t,i,n){var o;return(o=e.call(this)||this).sheetStatus=t,o.spreadsheetView=i,o.blockBoard=n,o.board=document.createElement("div"),o._normalSelectionStatus=v.EMPTY,o.changePermission=function(){if(o.sheetStatus.canEdit){var e=!1!==w.Z.getConfig("custom.insertDeleteMoveRange");o._singleSelectionApi.rangeMoveDragger.setValid(e)}else o._singleSelectionApi.rangeMoveDragger.setValid(!1)},o.board.classList.add("selection-stage-board"),o.blockBoard.hiddenBoard.append(o.board),o._singleSelectionApi=new S(o.board),o._multipleSelectionApi=new l(o.board),o.sheetStatus.change(o.changePermission),o.changePermission(),o}(0,a.Z)(t,e);var i=t.prototype;return i.addSelection=function(e,t){var i={left:e.left-this.blockBoard.globalOffsetX,top:e.top-this.blockBoard.globalOffsetY,width:e.width,height:e.height,padding:e.padding,display:t};this._normalSelectionStatus===v.EMPTY?(this._singleSelectionApi.update(i),this._singleSelectionApi.show(),this._normalSelectionStatus=v.USING_SINGLE):this._normalSelectionStatus===v.USING_SINGLE?(this._singleSelectionApi.hide(),this._multipleSelectionApi.add({left:this._singleSelectionApi.getLeft(),top:this._singleSelectionApi.getTop(),width:this._singleSelectionApi.getWidth(),height:this._singleSelectionApi.getHeight()}),this._multipleSelectionApi.add(i),this._normalSelectionStatus=v.USING_MULTIPLE):this._multipleSelectionApi.add(i)},i.updateSelection=function(e,t,i){var n={left:t.left-this.blockBoard.globalOffsetX,top:t.top-this.blockBoard.globalOffsetY,width:t.width,height:t.height,padding:t.padding,display:i};this._normalSelectionStatus===v.USING_MULTIPLE?this._multipleSelectionApi.update(e,n):this._normalSelectionStatus===v.USING_SINGLE&&this._singleSelectionApi.update(n)},i.removeSelection=function(e){this._normalSelectionStatus===v.USING_MULTIPLE?this._multipleSelectionApi.remove(e):this._normalSelectionStatus===v.USING_SINGLE&&this._singleSelectionApi.hide()},i.resetSelection=function(){this._multipleSelectionApi.clear(),this._singleSelectionApi.hide(),this._normalSelectionStatus=v.EMPTY},i.show=function(){this.board.style.display="block"},i.hide=function(){this.board.style.display="none"},i.dispose=function(){e.prototype.dispose.call(this),this.board.remove()},(0,n.Z)(t,[{key:"singleSelectionApi",get:function(){return this._singleSelectionApi}}]),t}(u.JT),y=i("../spread-sheet/src/core/view/level-1/select-center/base/stage/utils.ts"),E=i("../spread-sheet/src/core/view/level-1/select-center/base/stage/BaseSelectionStage.ts"),b=i("../spread-sheet/src/core/view/utils/base-func.ts"),x=i("../spread-sheet/src/core/view/lib/mutex-management/MutexManagement.ts"),T=function(e){function t(t,i,n,a){var s;return(s=e.call(this,t)||this).normalSelectData=t,s.spreadsheetView=i,s.sheetStatus=n,s.mutexManagement=a,s._handleUpdateSelections=(0,b.ad)((function(){for(var e=0;e<s._selectData.selectQueue.length;e++){var t=s._selectData.selectQueue[e];s._updateSelection({index:e,selection:t})}})),s.registerAfterAreaRenderOnce=function(){f.ju.once(s.spreadsheetView.renderManager.alloyExcel.onAfterAreaRender)((function(){s._handleUpdateSelections()}))},s.topLeft=s._register(new _(n,i,s.spreadsheetView.mainBoard.top.left)),s.topRight=s._register(new _(n,i,s.spreadsheetView.mainBoard.top.right)),s.bottomLeft=s._register(new _(n,i,s.spreadsheetView.mainBoard.bottom.left)),s.bottomRight=s._register(new _(n,i,s.spreadsheetView.mainBoard.bottom.right)),s._register(s.spreadsheetView.areaData.row.frozen.onUpdateViewSize(s.registerAfterAreaRenderOnce)),s._register(s.spreadsheetView.areaData.row.flow.onUpdateViewSize(s.registerAfterAreaRenderOnce)),s._register(s.spreadsheetView.areaData.col.frozen.onUpdateViewSize(s.registerAfterAreaRenderOnce)),s._register(s.spreadsheetView.areaData.col.flow.onUpdateViewSize(s.registerAfterAreaRenderOnce)),s._register(s.spreadsheetView.areaData.row.frozen.onUpdateTotalSize(s.registerAfterAreaRenderOnce)),s._register(s.spreadsheetView.areaData.row.flow.onUpdateTotalSize(s.registerAfterAreaRenderOnce)),s._register(s.spreadsheetView.areaData.col.frozen.onUpdateTotalSize(s.registerAfterAreaRenderOnce)),s._register(s.spreadsheetView.areaData.col.flow.onUpdateTotalSize(s.registerAfterAreaRenderOnce)),s.mutexManagement.addMutexComponent(x.d.SELECTION,(0,o.Z)(s)),s}(0,a.Z)(t,e);var i=t.prototype;return i.refresh=function(){},i.show=function(){this._showing||this._show()},i.hide=function(){this._showing&&this._hide()},i.mutexHide=function(){this._showing&&this._hide()},i._show=function(){this._showing=!0,this.topLeft.show(),this.topRight.show(),this.bottomLeft.show(),this.bottomRight.show(),this.mutexManagement.mutexShow(x.d.SELECTION),this.onSelectionStageVisiableChangeEmitter.fire(this._showing)},i._hide=function(){this._showing=!1,this.topLeft.hide(),this.topRight.hide(),this.bottomLeft.hide(),this.bottomRight.hide(),this.onSelectionStageVisiableChangeEmitter.fire(this._showing)},i._addSelection=function(e){var t=this.spreadsheetView.areaData,i=(0,y.i)(this.spreadsheetView.tableView,t,e);this.topLeft.addSelection(i,i.startRow<=t.row.frozen.to&&i.startCol<=t.col.frozen.to),this.topRight.addSelection(i,i.startRow<=t.row.frozen.to&&i.endCol>=t.col.flow.from),this.bottomLeft.addSelection(i,i.endRow>=t.row.flow.from&&i.startCol<=t.col.frozen.to),this.bottomRight.addSelection(i,i.endRow>=t.row.flow.from&&i.endCol>=t.col.flow.from)},i._updateSelection=function(e){var t=e.index,i=e.selection,n=this.spreadsheetView.areaData,o=(0,y.i)(this.spreadsheetView.tableView,n,i);this.topLeft.updateSelection(t,o,o.startRow<=n.row.frozen.to&&o.startCol<=n.col.frozen.to),this.topRight.updateSelection(t,o,o.startRow<=n.row.frozen.to&&o.endCol>=n.col.flow.from),this.bottomLeft.updateSelection(t,o,o.endRow>=n.row.flow.from&&o.startCol<=n.col.frozen.to),this.bottomRight.updateSelection(t,o,o.endRow>=n.row.flow.from&&o.endCol>=n.col.flow.from)},i._removeSelection=function(e){this._showing||this._show(),this.topLeft.removeSelection(e),this.topRight.removeSelection(e),this.bottomLeft.removeSelection(e),this.bottomRight.removeSelection(e)},i._resetSelection=function(){this._showing||this._show(),this.topLeft.resetSelection(),this.topRight.resetSelection(),this.bottomLeft.resetSelection(),this.bottomRight.resetSelection()},(0,n.Z)(t,[{key:"showing",get:function(){return this._showing}}]),t}(E.Z)},"../spread-sheet/src/core/view/level-1/shape-stage/stage/DomShapeStage.ts":function(e,t,i){i.d(t,{Z:function(){return A}});var n=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=(i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js")),a=(i("../node_modules/core-js/modules/es.array.iterator.js"),i("../node_modules/core-js/modules/es.map.js"),i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.string.iterator.js"),i("../node_modules/core-js/modules/esnext.map.delete-all.js"),i("../node_modules/core-js/modules/esnext.map.every.js"),i("../node_modules/core-js/modules/esnext.map.filter.js"),i("../node_modules/core-js/modules/esnext.map.find.js"),i("../node_modules/core-js/modules/esnext.map.find-key.js"),i("../node_modules/core-js/modules/esnext.map.includes.js"),i("../node_modules/core-js/modules/esnext.map.key-of.js"),i("../node_modules/core-js/modules/esnext.map.map-keys.js"),i("../node_modules/core-js/modules/esnext.map.map-values.js"),i("../node_modules/core-js/modules/esnext.map.merge.js"),i("../node_modules/core-js/modules/esnext.map.reduce.js"),i("../node_modules/core-js/modules/esnext.map.some.js"),i("../node_modules/core-js/modules/esnext.map.update.js"),i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.object.assign.js"),i("../node_modules/@babel/runtime/helpers/esm/createClass.js")),s=(i("../node_modules/regenerator-runtime/runtime.js"),i("../node_modules/core-js/modules/es.promise.js"),i("react")),r=i.n(s),l=i("react-dom"),d=i.n(l),c=i("../spread-sheet/src/core/utils/ImageLoader.ts"),u=i("../spread-sheet/src/core/view/level-1/shape-stage/stage/image/FailedPlaceHolder.tsx"),h=i("../node_modules/lodash/isEqual.js"),p=i.n(h),f=function(e,t,i,n){return new(i||(i=Promise))((function(o,a){function s(e){try{l(n.next(e))}catch(t){a(t)}}function r(e){try{l(n.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))},m=function(){function e(e,t,i){this.isImgLoadingError=!1,this.wrapImpl=document.createElement("div"),this.imageBox=document.createElement("div"),this._handleLoadSuccess=function(){},this._handleLoadFail=function(){},this.container=e,this.props=t,this.wrapImpl.classList.add("shape-wrap"),this.wrapImpl.setAttribute("data-testid","shape-wrap"),this.imageBox.classList.add("shape-image-box"),this.container.appendChild(this.wrapImpl),this.wrapImpl.appendChild(this.imageBox),this.update(),i&&(this.handleFocus=i)}var t=e.prototype;return t.setDatasetId=function(e){this.imageBox.dataset.id=e},t.setProps=function(e){var t=Object.assign(Object.assign({},this.props),e);p()(t,this.props)||(this.props=t,this.update())},t.destroy=function(){this.wrapImpl.remove()},t.handleFocus=function(e){},t.update=function(){return f(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,n,o,a,s,r,l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.props,n=i.width,o=i.height,a=i.left,s=i.top,r=i.zIndex,l=i.display,d=void 0===l||l,Object.assign(this.wrapImpl.style,{width:n+"px",height:o+"px",left:a+"px",top:s+"px","z-index":e.DEFAULT_Z_INDEX+r,display:d?"block":"none"}),this.updateImageSize(),t.next=5,this.updateImage();case 5:case"end":return t.stop()}}),t,this)})))},t.updateImage=function(){return f(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o,a,s,l,h,p,f,m,v,g,w,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!this.image,n=this.props,o=n.url,a=n.clipInfo,s=n.width,l=n.height,e.prev=2,h=a.clipLeft,p=a.clipRight,f=a.clipTop,m=a.clipBottom,v=h+s+p,g=f+l+m,w=(0,c.AJ)(o,{width:v*i.g.devicePixelRatio,height:g*i.g.devicePixelRatio,strategy:c.M$.COVER}),e.next=9,c.ZP.preLoadImageToBrowserCache(w);case 9:S=e.sent,this.image=S,this.isImgLoadingError=!1,this.updateImageSize(),this.imageBox.innerHTML="",this.imageBox.appendChild(S),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),t&&(this.isImgLoadingError=!0,d().render(r().createElement(u.x,null),this.imageBox));case 20:case"end":return e.stop()}}),e,this,[[2,17]])})))},t.updateImageSize=function(){if(this.image){var e=this.props,t=e.clipInfo,i=t.clipBottom,n=t.clipTop,o=t.clipLeft,a=t.clipRight,s=e.width,r=e.height;Object.assign(this.image.style,{top:-n+"px",left:-o+"px",width:o+s+a+"px",height:n+r+i+"px"})}},(0,a.Z)(e,[{key:"wrap",get:function(){return this.wrapImpl}}]),e}();m.imagesToLoad=0,m.failImageToReport=0,m.successImageToReport=0;var v=m,g=i("../spread-sheet/src/core/view/lib/pointer-support.ts"),w=function(e){function t(t,i,n){var o;return(o=e.call(this,t,i,n)||this).handleTap=function(e){e.originEvent.preventDefault(),o.handleFocus(e.originEvent)},(0,g.D2)(o.wrap),o.bindEvent(),o}(0,n.Z)(t,e);var i=t.prototype;return i.bindEvent=function(){this.wrap.addEventListener("pointer",this.handleTap),this.wrap.addEventListener("contextmenu",this.handleFocus)},i.unbindEvent=function(){this.wrap.removeEventListener("pointer",this.handleTap),this.wrap.removeEventListener("contextmenu",this.handleFocus)},t}(v),S=i("../node_modules/@tencent/containerized/build/main/index.js"),_=function(e){function t(t,i){var n;return(n=e.call(this)||this).blockBoard=t,n.focusCallback=i,n.shapeMap=new Map,n.board=document.createElement("div"),n.handleFocus=function(e){var t;e.preventDefault();var i=e.target;if(i){var a=i.dataset.id;a&&(null===(t=n.focusCallback)||void 0===t||t.call((0,o.Z)(n),a))}},n.board.classList.add("shape-stage-board"),n.blockBoard.hiddenBoard.append(n.board),n}(0,n.Z)(t,e);var i=t.prototype;return i.getShape=function(e){return this.shapeMap.get(e)},i.addShape=function(e,t){if(this.blockBoard.isInBoardVisibleArea(t,100)){var i=Object.assign(Object.assign({},t),{left:t.left-this.blockBoard.globalOffsetX,top:t.top-this.blockBoard.globalOffsetY}),n=new w(this.board,i,this.handleFocus);n.setDatasetId(e),this.shapeMap.set(e,n)}},i.updateShape=function(e,t){var i=this.shapeMap.get(e);if(i||(e===this.activeShapeBoxId&&(t.display=!1),this.addShape(e,t),i=this.shapeMap.get(e)),this.blockBoard.isInBoardVisibleArea(t,100)){var n=Object.assign({},t);void 0!==t.left&&(n.left=t.left-this.blockBoard.globalOffsetX),void 0!==t.top&&(n.top=t.top-this.blockBoard.globalOffsetY),i&&i.setProps(n)}else this.removeShape(e)},i.removeShape=function(e){var t=this.shapeMap.get(e);t&&(t.destroy(),this.shapeMap.delete(e))},i.showShape=function(e){this.activeShapeBoxId="";var t=this.shapeMap.get(e);t&&t.setProps({display:!0})},i.hideShape=function(e){this.activeShapeBoxId=e;var t=this.shapeMap.get(e);t&&t.setProps({display:!1})},i.show=function(){this.board.style.display="block"},i.hide=function(){this.board.style.display="none"},i.dispose=function(){e.prototype.dispose.call(this),this.board.remove()},t}(S.JT),y=i("../spread-sheet/src/core/view/level-1/shape-stage/stage/RecalculateListener.ts"),E=i("../packages/lib/index.ts"),b=i("../packages/model/src/embedded/index.ts"),x=function(){function e(){this.shapeMap=new Map}var t=e.prototype;return t.getShapeData=function(e){var t=this.shapeMap.get(e);return t||null},t.addShapeData=function(e){var t=e.shape,i=e.position,n=e.display,o=t.id;return this.shapeMap.get(o)?(console.error("shape已经在shapeStage中"),!1):(this.shapeMap.set(o,{shape:t,position:i,display:n}),!0)},t.updateShapeData=function(e,t){var i=this.shapeMap.get(e);return i?(void 0!==t.shape&&(i.shape=t.shape),void 0!==t.position&&(i.position=t.position),void 0!==t.display&&(i.display=t.display),!0):this.addShapeData(t)},t.removeShapeData=function(e){return!!this.shapeMap.get(e)&&(this.shapeMap.delete(e),!0)},e}(),T=i("../node_modules/lodash/throttle.js"),I=i.n(T),D=i("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),C=i("../spread-sheet/src/core/view/utils/base-func.ts");function R(e,t,i){var n={};if(void 0!==t.position&&(n.left=t.position.left*i,n.top=t.position.top*i),void 0!==t.shape){n.width=t.shape.position.overlayPosition.widthPixels*i>>0,n.height=t.shape.position.overlayPosition.heightPixels*i>>0,n.zIndex=t.shape.position.overlayPosition.zIndex,n.clipInfo={clipTop:t.shape.clipInfo.clipTop*i,clipRight:t.shape.clipInfo.clipRight*i,clipBottom:t.shape.clipInfo.clipBottom*i,clipLeft:t.shape.clipInfo.clipLeft*i},n.url=t.shape.url;var o=t.shape.position.overlayPosition.anchorCell,a=o.rowIndex,s=o.colIndex;(e.isRowHidden(a)||e.isColHidden(s))&&(n.display=!1)}return n}var A=function(e){function t(t,i,n){var o;return(o=e.call(this)||this).spreadsheet=t,o.dataCallView=i,o.spreadsheetView=n,o.viewShapeData=new x,o.focusEmitter=new E.Q5,o.setTimeoutThrottledUpdate=I()((function(){o.updateAll()}),30),o.promiseThrottledUpdate=(0,C.ad)((function(){o.updateAll()})),o.addShape=function(e){var t=o._getImageViewData(e);if(!t||t.shape.type===b.EMBEDDED_OBJECT_TYPE.CELL_IMAGE)return!1;if(!o.viewShapeData.addShapeData(t))return!1;var i=R(o.spreadsheet.activeSheet,t,o.spreadsheetView.scale.scale);return o.topLeft.addShape(t.shape.id,i),o.topRight.addShape(t.shape.id,i),o.bottomLeft.addShape(t.shape.id,i),o.bottomRight.addShape(t.shape.id,i),!0},o.updateShape=function(e){var t=o._getImageViewData(e);if(!t)return!1;if(t.shape.type===b.EMBEDDED_OBJECT_TYPE.CELL_IMAGE)return o.viewShapeData.getShapeData(e)&&o.removeShape(e),!0;if(!o.viewShapeData.updateShapeData(e,t))return!1;var i=R(o.spreadsheet.activeSheet,t,o.spreadsheetView.scale.scale);return o.topLeft.updateShape(e,i),o.topRight.updateShape(e,i),o.bottomLeft.updateShape(e,i),o.bottomRight.updateShape(e,i),!0},o.hideShape=function(e){o.topLeft.hideShape(e),o.topRight.hideShape(e),o.bottomLeft.hideShape(e),o.bottomRight.hideShape(e)},o.showShape=function(e){o.topLeft.showShape(e),o.topRight.showShape(e),o.bottomLeft.showShape(e),o.bottomRight.showShape(e)},o.removeShape=function(e){o.viewShapeData.removeShapeData(e)?(o.topLeft.removeShape(e),o.topRight.removeShape(e),o.bottomLeft.removeShape(e),o.bottomRight.removeShape(e)):console.warn("DOM不存在，imageId: ",e)},o._handleFocus=function(e){o.focusEmitter.fire(e)},o.updateAll=function(){o.spreadsheet.activeSheet.imageManager.each((function(e,t){e.type!==b.EMBEDDED_OBJECT_TYPE.CELL_IMAGE&&o.updateShape(t)}))},o.onFocus=o.focusEmitter.event,o.topLeft=o._register(new _(o.spreadsheetView.mainBoard.top.left,o._handleFocus)),o.topRight=o._register(new _(o.spreadsheetView.mainBoard.top.right,o._handleFocus)),o.bottomLeft=o._register(new _(o.spreadsheetView.mainBoard.bottom.left,o._handleFocus)),o.bottomRight=o._register(new _(o.spreadsheetView.mainBoard.bottom.right,o._handleFocus)),o._register(o.spreadsheetView.areaData.row.frozen.onUpdateViewSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.row.flow.onUpdateViewSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.col.frozen.onUpdateViewSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.col.flow.onUpdateViewSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.row.frozen.onUpdateTotalSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.row.flow.onUpdateTotalSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.col.frozen.onUpdateTotalSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.col.flow.onUpdateTotalSize(o.promiseThrottledUpdate)),o._register(o.spreadsheetView.areaData.onUpdateOffset(o.setTimeoutThrottledUpdate)),o._recalculateListener=o._register(new y.Z({dataCallView:o.dataCallView,spreadsheet:o.spreadsheet,addEmbeddedObject:o.addShape,updateEmbeddedObject:o.updateShape,removeEmbeddedObject:o.removeShape,hideEmbeddedObject:o.hideShape,showEmbeddedObject:o.showShape})),o}(0,n.Z)(t,e);var i=t.prototype;return i.refresh=function(){var e=this;this.viewShapeData.shapeMap.forEach((function(t,i){return e.removeShape(i)})),this.spreadsheet.activeSheet.imageManager.each((function(t,i){e.addShape(i)}))},i.show=function(){this.topLeft.show(),this.topRight.show(),this.bottomLeft.show(),this.bottomRight.show()},i.hide=function(){this.topLeft.hide(),this.topRight.hide(),this.bottomLeft.hide(),this.bottomRight.hide()},i._getImageViewData=function(e){var t=this.spreadsheet.activeSheet.imageManager.getImage(e);return t?(0,D.qo)(this.spreadsheet.parent,this.spreadsheet.activeSheetId)?null:{shape:t,position:function(e,t,i){var n=i.overlayPosition.anchorCell,o=n.colIndex,a=n.rowIndex,s=t.isColHidden(o)?0:i.overlayPosition.offsetXpixels,r=t.isRowHidden(a)?0:i.overlayPosition.offsetYpixels;return{left:e.getGlobalLeftByCol(o)+s,top:e.getGlobalTopByRow(a)+r}}(this.spreadsheetView.areaData,this.spreadsheetView.rowcolAccessor,t.position)}:null},t}(S.JT)},"../spread-sheet/src/core/view/level-1/shape-stage/stage/RecalculateListener.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=i("../spread-sheet/src/core/view/utils/base-func.ts"),a=function(e){function t(t){var i;return(i=e.call(this)||this)._updateAll=(0,o.ad)((function(e){i.isCurrentSheet(e)&&i._spreadsheet.activeSheet.imageManager.each((function(e,t){i._updateEmbeddedObject(t)}))})),i._rowVisibleChange=function(e){if(i.isCurrentSheet(e)){var t=e.ranges;i._spreadsheet.activeSheet.imageManager.each((function(e,n){for(var o=e.position.overlayPosition.anchorCell.rowIndex,a=0;a<t.length;a++){var s=t[a];if(o>=s.startIndex&&o<=s.endIndex)return void(i._spreadsheet.activeSheet.isRowHidden(o)?i._hideEmbeddedObject(n):i._showEmbeddedObject(n))}}))}},i._colVisibleChange=function(e){if(i.isCurrentSheet(e)){var t=e.ranges;i._spreadsheet.activeSheet.imageManager.each((function(e,n){for(var o=e.position.overlayPosition.anchorCell.colIndex,a=0;a<t.length;a++){var s=t[a];if(o>=s.startIndex&&o<=s.endIndex)return void(i._spreadsheet.activeSheet.isColHidden(o)?i._hideEmbeddedObject(n):i._showEmbeddedObject(n))}}))}},i._dataCallView=t.dataCallView,i._spreadsheet=t.spreadsheet,i._addEmbeddedObject=t.addEmbeddedObject,i._updateEmbeddedObject=t.updateEmbeddedObject,i._deleteEmbeddedObject=t.removeEmbeddedObject,i._hideEmbeddedObject=t.hideEmbeddedObject,i._showEmbeddedObject=t.showEmbeddedObject,i._register(i._dataCallView.onAddEmbeddedObject(i._addEmbeddedObject)),i._register(i._dataCallView.onUpdateEmbeddedObject(i._updateEmbeddedObject)),i._register(i._dataCallView.onDeleteEmbeddedObject(i._deleteEmbeddedObject)),i._register(i._dataCallView.onInsertCol(i._updateAll)),i._register(i._dataCallView.onInsertRow(i._updateAll)),i._register(i._dataCallView.onDeleteCol(i._updateAll)),i._register(i._dataCallView.onDeleteRow(i._updateAll)),i._register(i._dataCallView.onSetColVisible(i._colVisibleChange)),i._register(i._dataCallView.onSetRowVisible(i._rowVisibleChange)),i._register(i._dataCallView.onSetColWidth(i._updateAll)),i._register(i._dataCallView.onSetRowHeight(i._updateAll)),i}return(0,n.Z)(t,e),t.prototype.isCurrentSheet=function(e){return e.sheetId===this._spreadsheet.activeSheetId},t}(i("../node_modules/@tencent/containerized/build/main/index.js").JT);t.Z=a},"../spread-sheet/src/core/view/level-1/shape-stage/stage/image/FailedPlaceHolder.tsx":function(e,t,i){i.d(t,{x:function(){return s}});var n=i("../node_modules/i18next/dist/esm/i18next.js"),o=i("react"),a=i.n(o),s=function(){var e=(0,o.useRef)(null),t=(0,o.useState)(!1),i=t[0],s=t[1];return(0,o.useEffect)((function(){if(e.current){var t=e.current,i=t.clientHeight,n=t.clientWidth;s(!(i<108||n<200))}})),a().createElement("div",{ref:e,className:"loading-failed-pic-placeholder"},a().createElement("div",{className:"loading-failed-pic-placeholder-icon"}),a().createElement("div",{style:{display:i?"block":"none"},className:"loading-failed-pic-placeholder-tip"},n.ZP.t("图片加载失败，请稍后再试。")))}},"../spread-sheet/src/core/view/level-1/slide-operate/SlideEffect.pc.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=i("../spread-sheet/src/base/report/fps.ts"),a=i("../packages/common-utils/src/index.ts"),s=i("../node_modules/@tencent/containerized/build/main/index.js"),r=i("../packages/lib/index.ts"),l=function(e){function t(t,i){var n;return(n=e.call(this)||this).slideOperate=t,n.spreadsheetView=i,n._startSlideDispose=null,n._endSlideDispose=null,n._endFps=(0,a.Ds)((function(){var e;o.Z.end("fps_scroll"),null===(e=n._endSlideDispose)||void 0===e||e.dispose(),n._endSlideDispose=null,n._startSlideDispose=n._onceSlide(n._startFps)}),100),n._handleSlide=function(e){var t=n.spreadsheetView.areaData;t.row.flow.setOffsetSize(t.row.flow.offsetSize-e.y),t.col.flow.setOffsetSize(t.col.flow.offsetSize-e.x)},n._startFps=function(){o.Z.start("fps_scroll"),n._startSlideDispose=null,n._endSlideDispose=n.slideOperate.onSlide(n._endFps)},n._onceSlide=r.ju.once(n.slideOperate.onSlide),n._startSlideDispose=n._onceSlide(n._startFps),n._register(n.slideOperate.onSlide(n._handleSlide)),n}return(0,n.Z)(t,e),t.prototype.dispose=function(){var t,i;e.prototype.dispose.call(this),null===(t=this._startSlideDispose)||void 0===t||t.dispose(),null===(i=this._endSlideDispose)||void 0===i||i.dispose()},t}(s.JT);t.Z=l},"../spread-sheet/src/core/view/level-1/slide-operate/SlideOperate.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=(i("../node_modules/core-js/modules/es.object.to-string.js"),i("../node_modules/core-js/modules/es.regexp.to-string.js"),i("../node_modules/@tencent/docs-user-agent/dist/index.js")),a=i.n(o),s=i("../node_modules/@tencent/tdocs_support_bridge/lib/index.js"),r=i("../packages/lib/index.ts"),l=i("../node_modules/@tencent/containerized/build/main/index.js"),d=i("../spread-sheet/src/core/view/spreadsheet-view/operate-context/operate-data/FingerData.ts"),c=i("../spread-sheet/src/base/event/event.ts"),u=Math.cos(.25*Math.PI),h=6e-4,p=function(e){function t(t){var i;return(i=e.call(this)||this).spreadsheetView=t,i.ipadWheelData={currX:0,currY:0},i.continueMotionPoints=[],i.onSlideEmitter=new r.Q5,i.cacheData={x:0,y:0},i.handleMousedown=function(){i.cancelAnimationFrame()},i.handleWheel=function(e){switch(e.state){case"begin":i.handleWheelStart(e);break;case"change":i.handleWheelMove(e);break;case"end":i.handleWheelEnd()}},i.handleWheelStart=function(e){cancelAnimationFrame(i.requestTickID),i.ipadWheelData.currX=e["location.x"],i.ipadWheelData.currY=e["location.y"]},i.handleWheelMove=function(e){i.cacheData.x=e["location.x"]-i.ipadWheelData.currX,i.cacheData.y=e["location.y"]-i.ipadWheelData.currY,i.ipadWheelData.currX=e["location.x"],i.ipadWheelData.currY=e["location.y"],i.continueMotionPoints.length>10&&i.continueMotionPoints.shift(),i.continueMotionPoints.push({x:e["location.x"],y:e["location.y"],time:performance.now()}),i.onSlideEmitter.fire(i.cacheData)},i.handleWheelEnd=function(){i.checkAndInertiaScroll()},i.handleTouchstart=function(){var e=i.spreadsheetView.operateContext.operateData;i.cancelAnimationFrame(),i.isReachHorizontalEdge=!1,i.isReachVerticalEdge=!1,i.continueMotionPoints=[{x:e.currX,y:e.currY,time:performance.now()}],document.body.addEventListener("touchmove",i.handleTouchmove),document.body.addEventListener("touchend",i.handleTouchend),document.body.addEventListener("touchcancel",i.handleTouchend),s.Jn.sendEvent("sheet","sheet_r_start_slide")},i.handleTouchmove=function(){var e=i.spreadsheetView.operateContext.operateData;e.fingerData.mode===d.w.MOVE&&(i.cacheData.x=e.diffX,i.cacheData.y=e.diffY,i.continueMotionPoints.length>=12&&i.continueMotionPoints.shift(),i.continueMotionPoints.push({x:e.currX,y:e.currY,time:performance.now()}),i.onSlideEmitter.fire(i.cacheData))},i.handleTouchend=function(){var e=i.spreadsheetView.operateContext.operateData;i.continueMotionPoints.push({x:e.currX,y:e.currY,time:performance.now()}),e.fingerData.mode===d.w.IDLE&&(i.checkAndInertiaScroll(),document.body.removeEventListener("touchmove",i.handleTouchmove),document.body.removeEventListener("touchend",i.handleTouchend),document.body.removeEventListener("touchcancel",i.handleTouchend)),i.continueMotionPoints=[],s.Jn.sendEvent("sheet","sheet_r_end_slide")},i.onSlide=i.onSlideEmitter.event,i.addEvent(),c.ZP.sheetsBar.listen("switchSheet",(function(){i.cancelAnimationFrame()})),i}(0,n.Z)(t,e);var o=t.prototype;return o.cancelAnimationFrame=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){cancelAnimationFrame(this.requestTickID)})),o.dispose=function(){e.prototype.dispose.call(this),this.removeEvent()},o.addEvent=function(){var e;this.spreadsheetView.container.addEventListener("touchstart",this.handleTouchstart),this.spreadsheetView.container.addEventListener("mousedown",this.handleMousedown),a().isIPad&&a().isTencentDocsApp&&(null===(e=i.g.mqq)||void 0===e||e.addEventListener("ipadWheelEvent",this.handleWheel))},o.removeEvent=function(){var e;this.spreadsheetView.container.removeEventListener("touchstart",this.handleTouchstart),this.spreadsheetView.container.removeEventListener("mousedown",this.handleMousedown),a().isIPad&&a().isTencentDocsApp&&(null===(e=i.g.mqq)||void 0===e||e.removeEventListener("ipadWheelEvent",this.handleWheel))},o.checkAndInertiaScroll=function(){var e=this.getCurrentSpeed(),t=e[0],i=e[1],n=e[2];if(!(t<.04)){var o=.72*t,a=o*o/.0012,s=Math.round(t/h);this.lastScrollDistance=0,this.startInertiaScroll(a,Math.abs(i)<u?0:i,Math.abs(n)<u?0:n,s)}},o.getCurrentSpeed=function(){if(this.continueMotionPoints.length<4)return[0];var e=this.continueMotionPoints[0],t=this.continueMotionPoints[this.continueMotionPoints.length-1],i=t.x-e.x,n=t.y-e.y,o=Math.sqrt(i*i+n*n);return[o/(t.time-e.time),i/o,n/o]},o.startInertiaScroll=function(e,t,i,n){var o,a=this,s=Date.now();this.requestTickID=requestAnimationFrame((function r(){var l=Date.now()-s;l>=n?a.updateInertiaScrollStep(e,t,i):(o=e*function(e){var t=e-1;return 1-t*t*t*t}(l/n),e-o<.33||(a.updateInertiaScrollStep(o,t,i),a.checkEdge(),a.isReachHorizontalEdge&&a.isReachVerticalEdge||(a.requestTickID=requestAnimationFrame(r))))}))},o.updateInertiaScrollStep=function(e,t,i){var n=(e-this.lastScrollDistance)*t,o=(e-this.lastScrollDistance)*i;this.cacheData.x=this.isReachHorizontalEdge?0:n,this.cacheData.y=this.isReachVerticalEdge?0:o,this.lastScrollDistance=e,this.onSlideEmitter.fire(this.cacheData)},o.checkEdge=function(){var e=this.spreadsheetView.areaData.col.flow,t=e.offsetSize,i=e.maxOffsetSize,n=this.spreadsheetView.areaData.row.flow,o=n.offsetSize,a=n.maxOffsetSize;0!==t&&t!==i||(this.isReachHorizontalEdge=!0),0!==o&&o!==a||(this.isReachVerticalEdge=!0)},t}(l.JT);t.Z=p},"../spread-sheet/src/core/view/level-1/wheel-operate/WheelEffect.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=i("../spread-sheet/src/base/report/fps.ts"),a=i("../packages/common-utils/src/index.ts"),s=i("../packages/lib/index.ts"),r=function(e){function t(t,i){var n;return(n=e.call(this)||this).wheelOperate=t,n.spreadsheetView=i,n._startFpsDispose=null,n._endFpsDispose=null,n._endFps=(0,a.Ds)((function(){var e;o.Z.end("fps_scroll"),null===(e=n._endFpsDispose)||void 0===e||e.dispose(),n._endFpsDispose=null,n._startFpsDispose=n._onceScroll(n._startFps)}),100),n._handleScroll=function(e){var t=n.spreadsheetView.areaData;t.row.flow.setOffsetSize(t.row.flow.offsetSize-e.y),t.col.flow.setOffsetSize(t.col.flow.offsetSize-e.x)},n._startFps=function(){o.Z.start("fps_scroll"),n._startFpsDispose=null,n._endFpsDispose=n.wheelOperate.onScroll(n._endFps)},n._onceScroll=s.ju.once(n.wheelOperate.onScroll),n._startFpsDispose=n._onceScroll(n._startFps),n._register(n.wheelOperate.onScroll(n._handleScroll)),n}return(0,n.Z)(t,e),t.prototype.dispose=function(){var t,i;e.prototype.dispose.call(this),null===(t=this._startFpsDispose)||void 0===t||t.dispose(),null===(i=this._endFpsDispose)||void 0===i||i.dispose()},t}(i("../node_modules/@tencent/containerized/build/main/index.js").JT);t.Z=r},"../spread-sheet/src/core/view/level-1/wheel-operate/WheelOperate.ts":function(e,t,i){var n=i("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=(i("../node_modules/core-js/modules/web.dom-collections.for-each.js"),i("../spread-sheet/src/core/view/utils/ua.ts")),a=i("../packages/lib/index.ts"),s=i("../node_modules/@tencent/containerized/build/main/index.js"),r=i("../packages/model/src/config/index.ts"),l=.3,d=function(e){function t(t,i){var n;return(n=e.call(this)||this).spreadsheetView=t,n.containers=i,n.onScrollEmitter=new a.Q5,n._smoothScrollY=!1,n._smoothScrollX=!1,n._eventName="",n._stopResponse=!1,n._handleMouseScrollEventForFirefox=function(e){if(!n._stopResponse){var t=0,i=0;if("wheel"===e.type)t=e.deltaX,i=e.deltaY,1===e.deltaMode?o.V5?(0!==i&&(i=i>0?Math.max(10,Math.min(10*i,80)):Math.min(-10,Math.max(10*i,-80))),0!==t&&(t=t>0?Math.max(10,Math.min(10*t,80)):Math.min(-10,Math.max(10*t,-80)))):(0!==i&&(i=i>0?Math.max(20,Math.min(20*i,100)):Math.min(-20,Math.max(20*i,-100))),0!==t&&(t=t>0?Math.max(20,Math.min(20*t,100)):Math.min(-20,Math.max(20*t,-100)))):(i*=l,t*=l),n._scrollByPixel(-t,-i,e.shiftKey);else{var a=e.axis,s=e.detail>0?Math.max(10,Math.min(10*e.detail,80)):Math.min(-10,Math.max(10*e.detail,-80));1===a?n._scrollByPixel(-s,0):n._scrollByPixel(0,-s)}e.preventDefault()}},n._handleMouseScrollEventForNormal=function(e){if(!n._stopResponse){var t=0,i=0;void 0!==e.deltaY?t=-e.deltaY:void 0!==e.wheelDeltaY?t=e.wheelDeltaY:e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),void 0!==e.wheelDeltaX?i=e.wheelDeltaX:void 0!==e.deltaX&&(i=-e.deltaX);var o=2*r.DEFAULT_ROW_HEIGHT;n._smoothScrollY||0===t||t%120!==0?(n._smoothScrollY=!0,t*=l):t=Math.ceil(t/120)*o,n._smoothScrollX||0===i||i%120!==0?(n._smoothScrollX=!0,i*=l):i=Math.ceil(i/120)*o,n._scrollByPixel(i,t,e.shiftKey),e.preventDefault()}},n._handleMousedown=function(){n._stopResponse=!0,document.addEventListener("mouseup",n._handleMouseup,!0)},n._handleMouseup=function(){n._stopResponse=!1,document.removeEventListener("mouseup",n._handleMouseup,!0)},n.onScroll=n.onScrollEmitter.event,n._addEvent(),n}(0,n.Z)(t,e);var i=t.prototype;return i.dispose=function(){e.prototype.dispose.call(this),this._removeEvent()},i._addEvent=function(){var e=this;this.containers.forEach((function(t){if(o.tH){var i="onwheel"in document.createElement("div")?"wheel":"DOMMouseScroll";e._eventName=i,t.addEventListener(i,e._handleMouseScrollEventForFirefox)}else{var n;n="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e._eventName=n,t.addEventListener(n,e._handleMouseScrollEventForNormal)}t.addEventListener("mousedown",e._handleMousedown,!0)}))},i._removeEvent=function(){var e=this;this.containers.forEach((function(t){""!==e._eventName&&(o.tH?t.removeEventListener(e._eventName,e._handleMouseScrollEventForFirefox):t.removeEventListener(e._eventName,e._handleMouseScrollEventForNormal),t.removeEventListener("mousedown",e._handleMousedown,!0))}))},i._scrollByPixel=function(e,t,i){var n=this;void 0===i&&(i=!1);var o={x:e,y:t};i&&0!==o.y&&(o.x=o.y,o.y=0),window.requestAnimationFrame((function(){n.onScrollEmitter.fire(o)}))},t}(s.JT);t.Z=d}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/initial_core_part_3.9d86cf6e848aac5e6b06.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=initial_core_part_3.9d86cf6e848aac5e6b06.js.map