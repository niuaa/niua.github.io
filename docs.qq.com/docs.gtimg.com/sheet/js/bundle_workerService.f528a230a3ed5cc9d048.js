self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["bundle_workerService"],{"../spread-sheet/src/base/util/phone-number.ts":function(e,t,r){r.d(t,{AI:function(){return u},E$:function(){return p},Iq:function(){return s},YH:function(){return h},un:function(){return d}}),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.split.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.regexp.constructor.js"),r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/esnext.global-this.js"),r("../node_modules/core-js/modules/es.number.constructor.js");var n=r("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=r.n(n),s={"ar-DZ":"^(\\+?213|0)(5|6|7)\\d{8}$","ar-SY":"^(!?(\\+?963)|0)9\\d{8}$","ar-SA":"^(!?(\\+?966)|0)5\\d{8}$","en-US":"^(\\+?1)[2-9]\\d{2}[2-9](?!11)\\d{6}$","cs-CZ":"^(\\+?420)[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$","de-DE":"^(\\+?0{0,2}49[\\-]?)([0-9]{10,11})$","da-DK":"^(\\+?45)(\\d{8})$","el-GR":"^(\\+?30)(69\\d{8})$","en-AU":"^(\\+?61|0)4\\d{8}$","en-GB":"^(\\+?44|0)7\\d{9}$","en-HK":"^(\\+?852\\-?)[569]\\d{3}\\-?\\d{4}$","en-IN":"^(\\+?91|0)[789]\\d{9}$","en-NZ":"^(\\+?64|0)2\\d{7,9}$","en-ZA":"^(\\+?27|0)\\d{9}$","en-ZM":"^(\\+?26)09[567]\\d{7}$","es-ES":"^(\\+?34)(6\\d{1}|7[1234])\\d{7}$","fi-FI":"^(\\+?358|0)\\s(4(0|1|2|4|5)?|50)\\s?(\\d\\s?){4,8}\\d$","fr-FR":"^(\\+?33|0)[67]\\d{8}$","he-IL":"^(\\+972|0)([23489]|5[0248]|77)[1-9]\\d{6}","hu-HU":"^(\\+?36)(20|30|70)\\d{7}$","it-IT":"^(\\+?39)\\s?3\\d{2} ?\\d{6,7}$","ja-JP":"^(\\+?81|0)\\d{1,4}[ \\-]?\\d{1,4}[ \\-]?\\d{4}$","ms-MY":"^(\\+?6?01){1}(([145]{1}(\\-|\\s)?\\d{7,8})|([236789]{1}(\\s|\\-)?\\d{7}))$","nb-NO":"^(\\+?47)[49]\\d{7}$","nl-BE":"^(\\+?32|0)4\\d{8}$","nn-NO":"^(\\+?47)[49]\\d{7}$","pl-PL":"^(\\+?48)[5-8]\\d ?\\d{3} ?\\d{2} ?\\d{2}$","pt-BR":"^(\\+?55|0)\\-?[1-9]{2}\\-?[2-9]{1}\\d{3,4}\\-?\\d{4}$","pt-PT":"^(\\+?351)9[1236]\\d{7}$","ru-RU":"^(\\+?7|8)9\\d{9}$","sr-RS":"^(\\+3816|06)[- \\d]{5,9}$","tr-TR":"^(\\+?90|0)5\\d{9}$","vi-VN":"^(\\+?84|0)((1(2([0-9])|6([2-9])|88|99))|(9((?!5)[0-9])))([0-9]{7})$","zh-CN":"^(\\+?0?86\\-?)?((13[0-9])|(14[5-9])|(15([0-3]|[5-9]))|(16[6-7])|(17[1-8])|(18[0-9])|(19[1|3])|(19[5|6])|(19[8|9]))\\d{8}$","zh-TW":"^(\\+?886\\-?|0)9\\d{8}$"},a={"zh-CN":{regExp:"^([\\(（]?\\+?0?0?\\d{2,3}[\\)）]?[- ]?)?([\\(（]?0?\\d{2,3}[\\)）]?[- ]?)?([2-8]\\d{2,3}[- ]?\\d{4})((-|转|,| )(\\d+))?$",getExtIndex:function(e){var t=e.split("-");if(2===t.length&&7===t[0].length&&4===t[1].length)return e.lastIndexOf("-");var r=e.replace(this.regExp,"$4");return r?e.lastIndexOf(r):void 0}}},i=[110,119,120,122,999,112,114,1e4,10010,10011,10060,10086,11185,12300,12310,12315,12319,12333,12345,12348,12358,12365,12365,12366,12369,12395,12395,12591,16300,17900,17901,17908,17909,17910,17911,17920,17921,17931,17950,17951,17970,17971,17979,17987,17990,17991,17999,95033,95105,95116,95118,95119,95120,95160,95168,95169,95188,95384,95500,95501,95511,95512,95516,95518,95519,95522,95533,95555,95558,95559,95561,95566,95567,95568,95577,95588,95595,95598,95599,95766,95777,95803,95805,95806,95808,95809,95810,95811,95812,95813,95815,95816,95828,95829,95838,95839,95858,95859,95877,95880,5888,95900,95901,95911,95936,95937,95938,95939,95950,95951,95958,95963,95968,95993,96e3,96001,96002,96003,96005,96008,96010,96011,96014,96015,96096,96100,96101,96105,96110,96111,96112,96113,96118,96119,96120,96121,96126,96128,96129,96157,96158,96166,96168,96169,96177,96178,96179,96181,96188,96190,96191,96196,96197,96199,96300];function u(e,t){for(var r={isValid:!1,regExp:null,getExtIndex:null},n=String(e).replace(/((\s)|(-))/g,""),o=[c,l,f],s=0,a=o.length;s<a;s++){var i=0===s?n:e,u=o[s](String(i),t);if(u.isValid){r=u;break}}return r}function c(e,t){for(var r=t?[s[t]]:Object.values(s),n=0;n<r.length;n++){var o=new RegExp(r[n]);if(o.test(String(e)))return{isValid:!0,regExp:o,getExtIndex:null}}return{isValid:!1,getExtIndex:null,regExp:null}}function l(e,t){for(var r=t?[a[t]]:Object.values(a),n=0;n<r.length;n++){var o=new RegExp(r[n].regExp);if(o.test(String(e)))return{isValid:!0,getExtIndex:r[n].getExtIndex,regExp:o}}return{isValid:!1,getExtIndex:null,regExp:null}}function d(e){var t,n=String(e),o=u(n);if(!o.isValid)return null===r.g||void 0===r.g||r.g.log.error("不合法的号码: "+n),n;var s=null===(t=o.getExtIndex)||void 0===t?void 0:t.call(o,n);return void 0!==s&&o.regExp?String(e).substring(0,s)+","+String(e).substring(s+1):e}function h(e){var t;if(!e)return null;if(o().isTencentDocsApp)return null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.mqq)||void 0===t?void 0:t.invoke("nav","openSchema",{uri:"tel:"+e});var r=document.getElementById("dial-phone");r&&document.body.removeChild(r);var n=document.createElement("a");n.id="dial-phone",n.href="tel:"+e,document.body.appendChild(n),null===n||void 0===n||n.click()}function f(e,t){var r=!1,n=Number(e);return i.forEach((function(e){e===n&&(r=!0)})),{isValid:r,getExtIndex:null,regExp:null}}function p(e){var t;if(!e)return null;if(o().isTencentDocsApp)return null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.mqq)||void 0===t?void 0:t.invoke("nav","openSchema",{uri:e});var r=document.getElementById("email-string");r&&document.body.removeChild(r);var n=document.createElement("a");n.id="email-string",n.href=e,document.body.appendChild(n),null===n||void 0===n||n.click()}},"../spread-sheet/src/core/feature/dataValidation/DVInterface.ts":function(e,t,r){r.d(t,{Bb:function(){return i},Ju:function(){return c},UD:function(){return u},c1:function(){return l},h6:function(){return s.h6},ob:function(){return s.ob},y3:function(){return a}}),r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/i18next/dist/esm/i18next.js"),o=r("../packages/model/src/index.ts"),s=r("../spread-sheet/src/core/feature/dataValidation/type.ts"),a=new Map([[o.Cell.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,n.ZP.t("介于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,n.ZP.t("不介于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.EQUAL,n.ZP.t("等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,n.ZP.t("不等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS,n.ZP.t("早于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,n.ZP.t("不晚于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT,n.ZP.t("晚于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,n.ZP.t("不早于")]]),i=new Map([[o.Cell.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,n.ZP.t("介于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,n.ZP.t("不介于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.EQUAL,n.ZP.t("等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,n.ZP.t("不等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS,n.ZP.t("小于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,n.ZP.t("小于或等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT,n.ZP.t("大于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,n.ZP.t("大于或等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.INCLUDE,n.ZP.t("包括")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_INCLUDE,n.ZP.t("不包括")]]),u=new Map([[o.Cell.DATA_VALIDATION_CONDITION_TYPE.BETWEEN,n.ZP.t("介于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_BETWEEN,n.ZP.t("不介于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.EQUAL,n.ZP.t("等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.NOT_EQUAL,n.ZP.t("不等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS,n.ZP.t("小于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.LESS_EQUAL,n.ZP.t("小于或等于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT,n.ZP.t("大于")],[o.Cell.DATA_VALIDATION_CONDITION_TYPE.GREAT_EQUAL,n.ZP.t("大于或等于")]]),c=new Map([[s.h6.NONE,n.ZP.t("数值")],[s.h6.INT,n.ZP.t("整数")],[s.h6.FLOAT,n.ZP.t("小数")]]),l=new Map([[s.h6.ID_CARD,n.ZP.t("身份证号")],[s.h6.MAIL,n.ZP.t("邮箱")],[s.h6.PHONE,n.ZP.t("手机号")],[s.h6.TELEPHONE,n.ZP.t("电话号码")]])},"../spread-sheet/src/core/feature/formula/calculate-plugin/calc-plugin-base.ts":function(e,t,r){r.d(t,{Z:function(){return n}});var n=function(){function e(){}var t=e.prototype;return t.beforeBatchCalculate=function(){},t.beforeEveryCalculation=function(e,t){},t.afterEveryCalculation=function(e,t,r,n){},e}()},"../spread-sheet/src/core/network/message-center/base/BaseMessageCenterAdapter.ts":function(e,t,r){var n=r("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=function(e){function t(){return e.apply(this,arguments)||this}return(0,n.Z)(t,e),t}(r("../node_modules/@tencent/containerized/build/main/index.js").JT);t.Z=o},"../spread-sheet/src/core/network/message-center/model/MissChange.ts":function(e,t){t.Z=function(e){this.isValid=!0,this.commitId=e.commitId,this.sheetId=e.subId,this.newVersion=e.newRev,this.changeset=e.changeset,this.changesetType=e.changesetType,this.isNeedKeyframe=e.need,this.head=e.head,this.isWorkbook=e.isWorkbook||!1,this.revert=e.revert,this.collabUserId=e.author,this.keyData=e.keyData}},"../spread-sheet/src/core/network/message-center/model/PendingControl.ts":function(e,t,r){var n=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),o=(r("../node_modules/core-js/modules/es.object.keys.js"),function(){function e(){this._sheet={},this._loadingCount=0}var t=e.prototype;return t.startLoadSheet=function(e){return this._sheet[e]?(console.warn("sheet has loading"),!1):(this._loadingCount=this._loadingCount+1,this._sheet[e]=1,!0)},t.finishLoadSheet=function(e){return this._sheet[e]?(this._loadingCount=this._loadingCount-1,this._sheet[e]=void 0,!0):(console.error("sheet has't loading"),!1)},(0,n.Z)(e,[{key:"loadingCount",get:function(){return this._loadingCount}},{key:"sheet",get:function(){return Object.keys(this._sheet)}}]),e}());t.Z=o},"../spread-sheet/src/core/network/message-center/model/UserChange.ts":function(e,t,r){r.d(t,{t:function(){return n}});var n,o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../packages/report/src/index.ts")),a=r("../spread-sheet/src/base/config/report.ts"),i=r("../spread-sheet/src/core/behavior/multi-type-follow.ts");!function(e){e[e.WATING=0]="WATING",e[e.COMMITING=1]="COMMITING",e[e.ACCEPT=2]="ACCEPT"}(n||(n={}));var u=function(){function e(e){var t,o,u=this;this.head=!1,this.isWorkbook=!1,this.status=n.WATING,this.taskId=0,this.isOfflineMessage=!1,this.allowAutoMerge=!1,this.commitTimes=0,this.createMessageSeq=function(){return Math.ceil(2147483648*Math.random())},this.globalPadId=e.globalPadId,this.baseVersion=e.baseVersion,this.sheetId=e.sheetId,this.mutations=[],e.data&&(null===(o=null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.mutations)||void 0===o||o.forEach((function(t){if(t&&Array.isArray(t)){var r=[];t.forEach((function(t){var n,o=(0,i.Xe)(t,null===(n=e.data)||void 0===n?void 0:n.changesetType);o&&r.push(o)})),u.mutations.push(r)}else s.ZP.run(a.CONFIG.INIT_DATA_ERROR,[e.data.mutations])})),this.changesetType=e.data.changesetType,this.changeData=e.data.changedata||e.data.changeData||null,this.keyData=e.data.keyData||null,this.head=e.data.head||!1,this.isWorkbook=e.data.isWorkbook||!1,this.originSheetId=e.data.oSubId||null,this.taskId=e.data.taskId||this.createMessageSeq()),this.isOfflineMessage=e.isOfflineMessage||!1,this.allowAutoMerge=e.allowAutoMerge||!1,this.time=e.time||(new Date).getTime(),this.status=e.status||n.WATING,this.dver=e.dver||r.g.__globalCodeVersion}var t=e.prototype;return t.isMutationChange=function(){return!this.changeData},t.setChangeData=function(e){this.changeData=e},t.setOrAppendMutations=function(e){this.mutations.push(e)},t.setKeyData=function(e){this.keyData=e},t.isWithKeyData=function(){return!!this.keyData},(0,o.Z)(e,[{key:"requestCount",get:function(){return this.isMutationChange()?(null===this||void 0===this?void 0:this.mutations.length)||0:1}},{key:"isEmpty",get:function(){return(!this.mutations||0===this.mutations.length)&&!this.changeData||0===this.taskId}},{key:"key",get:function(){return this.globalPadId+"_"+this.sheetId+"_"+this.time}}]),e}();t.Z=u},"../spread-sheet/src/core/network/message-center/model/missChange-helper.ts":function(e,t,r){r.d(t,{AV:function(){return y},Ey:function(){return A},Tn:function(){return R},mb:function(){return m}});var n=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),o=(r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js"),r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/i18next/dist/esm/i18next.js")),s=r("./node_modules/axios/index.js"),a=r.n(s),i=r("../packages/common-utils/src/index.ts"),u=r("../spread-sheet/src/core/network/message-center/model/MissChange.ts"),c=r("../packages/report/src/index.ts"),l=r("../spread-sheet/src/base/config/report.ts"),d=r("../spread-sheet/src/base/error/index.ts"),h=r("../packages/utils/src/safe.ts"),f=(r("../spread-sheet/src/core/worker/worker-thread/index.ts"),function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{u(n.next(e))}catch(t){s(t)}}function i(e){try{u(n.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((n=n.apply(e,t||[])).next())}))});function p(e){return!(void 0!=e.revUpper&&e.revUpper<e.revLower)}function m(e){return f(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,o,s,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.next=6;break;case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=(0,h.f)();case 7:return r=t.t0,n=(0,i.IZ)("snaptk"),o=(0,i.IZ)("snapts"),s=void 0===e.revUpper?"":"&to="+e.revUpper,a="/dop-api/get/changes?padId="+e.padId+"&from="+e.revLower+s+"&xsrf="+r+"&snpatk="+n+"&snapts="+o,t.abrupt("return",a);case 13:case"end":return t.stop()}}),t)})))}function g(e){var t,n;return f(this,void 0,void 0,regeneratorRuntime.mark((function o(){var s;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,a()({method:"get",url:e,responseType:"json"});case 3:if(s=o.sent,0===(null===(t=s.data)||void 0===t?void 0:t.retcode)){o.next=6;break}return o.abrupt("return",{isSuccess:!1,data:s});case 6:return o.abrupt("return",{isSuccess:!0,data:s});case 9:return o.prev=9,o.t0=o.catch(0),null===(n=r.g.log)||void 0===n||n.error("sendMissChangesRequest catch error.",null===o.t0||void 0===o.t0?void 0:o.t0.stack),o.abrupt("return",{isSuccess:!1,data:void 0});case 13:case"end":return o.stop()}}),o,null,[[0,9]])})))}function v(e,t){return void 0===t&&(t=2),f(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n={isSuccess:!1,data:void 0},o=0;case 2:if(!(o<t)){r.next=14;break}return r.next=5,g(e);case 5:if(!(n=r.sent).isSuccess){r.next=9;break}return 1===o&&c.ZP.monitor(34276670),r.abrupt("break",14);case 9:return r.next=11,new Promise((function(e){setTimeout((function(){e(void 0)}),1e3)}));case 11:o+=1,r.next=2;break;case 14:return r.abrupt("return",n);case 15:case"end":return r.stop()}}),r)})))}function w(e){var t=e||{},r=t.status,n=t.data,s=t.statusText,a=void 0===s?"response is void":s;if(void 0===n)return{isSuccess:!1,data:void 0,errorCode:d.B.RESPONSE_DATA_EMPTY,errorMessage:a,reportCode:l.CONFIG.FETCH_USERCHANGES_3,reportOptions:[r,n]};var i=n.retcode,h=n.result;if(0!==i)return function(e){var t={1e5:33612375,100002:33612376,100003:33612377,200105:33612378,200200:33612379};e&&c.ZP.monitor(t[e])}(n.retcode),{isSuccess:!1,data:void 0,errorCode:d.B.RESPONSE_ERROR_CODE,errorMessage:"retcode="+n.retcode};var f=h.to,p=h.rev,m=h.changes;return 0===m.length?(c.ZP.monitor(33633645),{isSuccess:!1,data:void 0,errorCode:d.B.RESPONSE_ARRAY_EMPTY,errorMessage:o.ZP.t("userchanges长度为0")}):{isSuccess:!0,data:{maxRev:f,endRev:p,misschanges:m.map((function(e){var t=e.data;return new u.Z(t)}))}}}function T(e){return f(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,s,a,i,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=0,p(e)){t.next=3;break}return t.abrupt("return",{isSuccess:!1,data:void 0,errorCode:d.B.RESPONSE_DATA_EMPTY,errorMessage:o.ZP.t("参数to小于from"),reportCode:l.CONFIG.FETCH_USERCHANGE_ARGUMENT,reportOptions:[e.revLower,e.revUpper]});case 3:return c.ZP.run(l.CONFIG.FETCH_USERCHANGES,[e.revLower,e.revUpper,r]),t.next=6,m(e);case 6:return n=t.sent,t.next=9,v(n);case 9:if(s=t.sent,a=s.isSuccess,i=s.data,a){t.next=13;break}return t.abrupt("return",{isSuccess:!1,data:void 0,errorCode:d.B.CGI_HTTP_ERROR,errorMessage:"fetch cgi error."});case 13:return u=w(i),t.abrupt("return",u);case 15:case"end":return t.stop()}}),t)})))}function k(e,t,r){return void 0===e&&r>t?{isFinish:!1,revLower:t+1,revUpper:r}:void 0!==e&&e>t&&e<=r?{isFinish:!1,revLower:t+1,revUpper:e}:{isFinish:!0}}function R(e){return f(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,o,s,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],o=Object.assign({},e);case 2:return t.next=5,T(o);case 5:if((s=t.sent).isSuccess){t.next=10;break}return e.callback(!1,s.data,s.errorCode,s.errorMessage),void 0!==s.reportCode&&c.ZP.run(s.reportCode,s.reportOptions),t.abrupt("return");case 10:if(r.push.apply(r,(0,n.Z)(s.data.misschanges)),!(a=k(e.revUpper,s.data.maxRev,s.data.endRev)).isFinish){t.next=15;break}return e.callback(!0,r),t.abrupt("return");case 15:o=Object.assign(e,{revLower:a.revLower,revUpper:a.revUpper}),t.next=2;break;case 18:case"end":return t.stop()}}),t)})))}function y(e){return{commitId:e.commitId,subId:e.sheetId,newRev:e.newVersion,changeset:e.changeset,need:e.isNeedKeyframe,head:e.head,revert:e.revert,author:e.collabUserId,keyData:e.keyData}}function A(e){return new u.Z(e)}},"../spread-sheet/src/core/network/message-center/model/userChange-helper.ts":function(e,t,r){r.d(t,{HJ:function(){return l},Jv:function(){return c},PL:function(){return f},bR:function(){return h},rg:function(){return d}}),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.array.concat.js");var n=r("../spread-sheet/src/core/network/message-center/model/UserChange.ts"),o=r("../packages/report/src/index.ts"),s=r("../spread-sheet/src/base/config/report.ts"),a=r("../spread-sheet/src/core/behavior/multi-type-follow.ts"),i=r("../spread-sheet/src/core/network/message-center/model/changeset-type.ts");function u(e){if(e.changeData)return JSON.stringify(e.changeData);if(e.mutations){var t=[];return e.mutations.forEach((function(e){var r=[];e.forEach((function(e){var t=window.SpreadsheetApp.mutationBehavior.serializeMutation(e);r.push(t)})),t.push(r)})),JSON.stringify(t)}return JSON.stringify([])}function c(e){var t,r={};r.baseVersion=e.baseVersion,r.sheetId=e.sheetId;var n=[];null===(t=e.mutations)||void 0===t||t.forEach((function(t){var r=[];t.forEach((function(t){var n=window.SpreadsheetApp.mutationBehavior.serializeMutation(t);n?r.push(n):o.ZP.run(s.CONFIG.STORE_DATA_ERROR,[e.mutations])})),n.push(r)}));var a=e.changeData||null,i={type:"USER_CHANGES",taskId:e.taskId,baseRev:e.baseVersion,mutations:n,changeData:a,keyData:e.keyData,head:e.head,subId:e.sheetId,oSubId:e.originSheetId||!1,pver:1,changesetType:e.changesetType};return r.isOfflineMessage=!0,r.data=i,r.time=e.time,r.status=e.status,r.dver=e.dver,r}function l(e){var t={type:"USER_CHANGES",baseRev:e.baseVersion,changeset:u(e),changesetType:e.changesetType,keydata:e.keyData||!1,head:e.head,isWorkbook:e.isWorkbook,subId:e.sheetId,oSubId:e.originSheetId||!1,changeSetCount:e.requestCount,offlineMsg:e.isOfflineMessage,taskId:e.taskId,pver:1};return t.changeset=t.changeset+"\n",t.keydata&&(t.keydata=t.keydata+"\n"),JSON.stringify(t)}function d(e){var t={globalPadId:e.globalPadId,baseVersion:e.baseVersion,sheetId:e.sheetId,status:e.status,data:{}};if(e.mutations){var r=[];e.mutations.forEach((function(e){var t=[];e.forEach((function(e){var r=window.SpreadsheetApp.mutationBehavior.serializeMutation(e);t.push(r)})),r.push(t)})),t.data.mutations=JSON.stringify(r),t.data.changesetType=e.changesetType}return e.changeData&&(t.data.changeData=JSON.stringify(e.changeData)),void 0!==e.head&&(t.data.head=e.head),void 0!==e.originSheetId&&(t.data.oSubId=e.originSheetId),void 0!==e.taskId&&(t.data.taskId=e.taskId),void 0!==e.isWorkbook&&(t.data.isWorkbook=e.isWorkbook),t}function h(e){var t,r,o,s=e;if("smartsheet"===(null===(t=s.data)||void 0===t?void 0:t.changesetType)&&(s.data.mutations=[]),null===(r=s.data)||void 0===r?void 0:r.mutations)try{s.data.mutations=JSON.parse(s.data.mutations)}catch(a){}return(null===(o=s.data)||void 0===o?void 0:o.changeData)&&(s.data.changeData=JSON.parse(s.data.changeData)),new n.Z(s)}function f(e,t){var r=e.spreadsheet.sheetManager.getSheetBySheetId(t.sheetId),n=t.changesetType,o=[];t.mutations.forEach((function(e){o=o.concat(e)})),(t.head||t.isWorkbook||(null===r||void 0===r?void 0:r.isLoaded)||(null===r||void 0===r?void 0:r.getSheetId())===e.spreadsheet.activeSheetId&&n!==i.G.SMARTSHEET)&&(0,a.d)(o,n)}},"../spread-sheet/src/core/view/level-2/condition-format-center/data/calc-plugin/utils.ts":function(e,t,r){r.d(t,{Q:function(){return u},i:function(){return c}});var n=r("../spread-sheet/src/core/view/level-2/condition-format-center/data/ConditionFormatRule.ts"),o=r("../spread-sheet/src/core/feature/formula/utils/parseUtil.ts"),s=r("../packages/model/src/cell/formula/FormulaModel.ts"),a=r("../packages/model/src/cell/index.ts"),i=r("../packages/model/src/cell/format/Color.ts"),u=function(e,t,r,a,i,u){var c,l=(0,n.O8)(null===(c=e.booleanConditionalFormat)||void 0===c?void 0:c.condition,{sheet:u.sheetManager.getSheetBySheetId(t),sheetId:t,userValueRelativeRow:r,userValueRelativeCol:a,gridRanges:e.ruleRanges},i,u.activeSheet),d=(0,n.gq)(e.gradientConditionalFormat,{sheet:u.sheetManager.getSheetBySheetId(t),sheetId:t,userValueRelativeRow:r,userValueRelativeCol:a,gridRanges:e.ruleRanges}),h=(0,n.SL)(e.dataBarConditionalFormat,{sheet:u.sheetManager.getSheetBySheetId(t),sheetId:t,userValueRelativeRow:r,userValueRelativeCol:a,gridRanges:e.ruleRanges}),f=l||d||h;if(!f)return null;var p=s.Z.isTargetType(f)?f:(0,o.EG)(f,0,0,t);return p||null},c=function(e,t,r){var n=e.interpolationPoints,o=i.Z.getColorRGBA(n[0].color,r),s=o.red,u=o.green,c=o.blue,l=i.Z.getColorRGBA(n[1].color,r),d=s*(1-t)+l.red*t,h=u*(1-t)+l.green*t,f=c*(1-t)+l.blue*t;return a.CellFormatFactory.createInstance({backgroundColor:i.Z.createColor({red:d,green:h,blue:f,alpha:1})})}},"../spread-sheet/src/core/view/level-2/condition-format-center/data/custom-formula/condition-number-rules.ts":function(e,t,r){r.d(t,{Ab:function(){return i},nW:function(){return a},p3:function(){return c}}),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js");var n=r("../packages/model/src/index.ts"),o=r("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),s=n.Rule.CONDITION_TYPE,a={acceptRef:!0,min:4};function i(e,t,r){for(var n=[],o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];s.forEach((function(e){n.push(e.toArray())}));var i=c(t),l=c(r),d=n.map((function(t){return t.map((function(t){return u(e,t,i,l)}))}));return d}function u(e,t,r,n){if(null===t)return e===s.NUMBER_NOT_EQ||e===s.NUMBER_NOT_BETWEEN;var o=c(t);switch(e){case s.NUMBER_GREATER:return o>r;case s.NUMBER_GREATER_THAN_EQ:return o>=r;case s.NUMBER_LESS:return o<r;case s.NUMBER_LESS_THAN_EQ:return o<=r;case s.NUMBER_EQ:return o===r;case s.NUMBER_NOT_EQ:return o!==r;case s.NUMBER_BETWEEN:return o>=r&&o<=n;case s.NUMBER_NOT_BETWEEN:return o<r||o>n}return!1}function c(e){var t;if("number"===typeof e)return e;var r=(null===(t=(0,o.parseValue)(e,null))||void 0===t?void 0:t.numericValue)||e;return"string"!==typeof r||isNaN(parseFloat(r))?r:parseFloat(r)}},"../spread-sheet/src/core/view/level-2/condition-format-center/data/custom-formula/index.ts":function(e,t,r){r.d(t,{v:function(){return C}}),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.array.map.js");var n=r("../packages/model/src/index.ts"),o=n.Rule.CONDITION_TYPE,s={acceptRef:!0,min:4};function a(e,t,r){for(var n=[],o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];s.forEach((function(e){n.push(e.toArray())}));var u=n.map((function(n){return n.map((function(n){return"number"===typeof n&&i(e,n,t,r)}))}));return u}function i(e,t,r,n){switch(e){case o.DATE_DURING:case o.DATE_BETWEEN:return t>=r&&t<=n;case o.DATE_NOT_BETWEEN:return t<r||t>n;case o.DATE_BEFORE:return t<r;case o.DATE_AFTER:return t>r;case o.DATE_ON_OR_BEFORE:return t<=r;case o.DATE_ON_OR_AFTER:return t>=r;case o.DATE_EQ:return 0===n?t===r:t>=r&&t<n+1}return!1}var u=r("../node_modules/@tencent/sheet-formula-sdk/lib/index.js"),c={acceptRef:!0,min:2};function l(e){for(var t=[],r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];n.forEach((function(e){t.push(e.toArray())}));var s=t.map((function(t){return t.map((function(t){var r=d(t);return e?r:!r}))}));return s}function d(e){return u.Pz.hasError(e)||"number"===typeof e&&(isNaN(e)||!isFinite(e))}var h=r("../spread-sheet/src/core/view/level-2/condition-format-center/data/custom-formula/condition-number-rules.ts"),f=(r("../node_modules/core-js/modules/es.array.iterator.js"),r("../node_modules/core-js/modules/es.map.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.string.iterator.js"),r("../node_modules/core-js/modules/esnext.map.delete-all.js"),r("../node_modules/core-js/modules/esnext.map.every.js"),r("../node_modules/core-js/modules/esnext.map.filter.js"),r("../node_modules/core-js/modules/esnext.map.find.js"),r("../node_modules/core-js/modules/esnext.map.find-key.js"),r("../node_modules/core-js/modules/esnext.map.includes.js"),r("../node_modules/core-js/modules/esnext.map.key-of.js"),r("../node_modules/core-js/modules/esnext.map.map-keys.js"),r("../node_modules/core-js/modules/esnext.map.map-values.js"),r("../node_modules/core-js/modules/esnext.map.merge.js"),r("../node_modules/core-js/modules/esnext.map.reduce.js"),r("../node_modules/core-js/modules/esnext.map.some.js"),r("../node_modules/core-js/modules/esnext.map.update.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),{acceptRef:!0,min:1});function p(){for(var e=new Map,t=[],r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return n.forEach((function(r,n){var o=r.toArray();t[n]=new Array(o.length),o.forEach((function(r,o){if(null!==r){var s=e.get(r);s&&(t[s[0]][s[1]]=!0,t[n][o]=!0),e.set(r,[n,o])}}))})),t}r("../node_modules/core-js/modules/es.regexp.to-string.js"),r("../node_modules/core-js/modules/es.string.starts-with.js"),r("../node_modules/core-js/modules/es.string.ends-with.js"),r("../node_modules/core-js/modules/es.string.trim.js");var m=n.Rule.CONDITION_TYPE,g={acceptRef:!0,min:3};function v(e,t){for(var r=[],n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];o.forEach((function(e){r.push(e.toArray())})),u.AD.isCalcRef(t)&&(t=t.toArray()[0]);var a=t.toString().toUpperCase(),i=r.map((function(t){return t.map((function(t){return null===t&&(t=""),w(e,t.toString().toUpperCase(),a)}))}));return i}function w(e,t,r){switch(e){case m.TEXT_CONTAINS:return-1!==t.indexOf(r);case m.TEXT_NOT_CONTAINS:return-1===t.indexOf(r);case m.TEXT_EQ:return t===r;case m.TEXT_STARTS_WITH:return t.startsWith(r);case m.TEXT_ENDS_WITH:return t.endsWith(r);case m.BLANK:return 0===t.trim().length;case m.NOT_BLANK:return 0!==t.trim().length}return!1}var T=r("../packages/model/src/rule/DataBarProps.ts"),k={acceptRef:!0,min:3};function R(e,t){for(var r=[],n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];o.forEach((function(e){var t=e.toArray().map((function(e){return(0,h.p3)(e)}));r.push(t)}));var a=r.map((function(r){return r.map((function(r){return"number"===typeof r&&[r<0?T.N.Negative:T.N.Positive,y(e,t),A(r,e,t)]}))}));return a}function y(e,t){var r=t-e,n=0;return t*e<0?n=Math.abs(e)/r:t<=0&&(n=1),n}function A(e,t,r){var n=r-t,o=e<t?t:e>r?r:e,s=r*t<0?o:r<=0?o-r:o-t,a=0===n?s<0?-1:1:s/n;return Math.abs(a)}var b={acceptRef:!0,min:3};function _(e,t){for(var r=[],n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];o.forEach((function(e){var t=e.toArray().map((function(e){return(0,h.p3)(e)}));r.push(t)}));var a=t-e,i=r.map((function(t){return t.map((function(t){if("number"!==typeof t)return!1;var r=0===a?1:(t-e)/a;return r>1&&(r=1),r<0&&(r=0),r}))}));return i}var I=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),S=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.filter.js"),{acceptRef:!0,min:1});function E(){for(var e=[],t=[],r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];n.forEach((function(r){t=[].concat((0,I.Z)(t),(0,I.Z)(r.toArray())),e.push(r.toArray())}));var s=t.filter((function(e){return t.indexOf(e)===t.lastIndexOf(e)})),a=e.map((function(e){return e.map((function(e){return null!==e&&-1!==s.indexOf(e)}))}));return a}function C(e){e.registerExternalFunctions("COND_DATE",a,s),e.registerExternalFunctions("COND_ERROR",l,c),e.registerExternalFunctions("COND_NUMBER",h.Ab,h.nW),e.registerExternalFunctions("COND_REPEAT",p,f),e.registerExternalFunctions("COND_TEXT",v,g),e.registerExternalFunctions("COND_DATA_BAR",R,k),e.registerExternalFunctions("COND_GRADIENT",_,b),e.registerExternalFunctions("COND_UNIQUE",E,S)}},"../spread-sheet/src/core/worker/common/base-controller.ts":function(e,t,r){r.d(t,{Z:function(){return s}}),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");var n=r("../spread-sheet/src/base/util/timer.ts"),o=r("../spread-sheet/src/core/worker/util.ts"),s=function(){function e(){this.isDebugMode=!1,this.actionHandlerMap={}}var t=e.prototype;return t.request=function(e,t){if(this.channel)return this.channel.request(e,t);console.error("没有通信 Channel.")},t.requestPromise=function(e,t,r){return void 0===t&&(t=""),this.channel?this.channel.requestPromise(e,t,r):Promise.reject(new Error("no Channel."))},t.addActionHandler=function(e,t){if(this.isDebugMode,this.hasActionHandler(e))throw new Error("已注册事务 `"+e+"` 的处理器, 不能重复注册");this.actionHandlerMap[e]=t},t.actionHandler=function(e){var t=this,r=e.actionType,s=e.payload;if(!this.hasActionHandler(r))throw new Error("没有找到事务 `"+r+"` 的处理器, 是否已注册.");try{var a=this.actionHandlerMap[r](s);return(0,o.tI)(a)?a.catch((function(e){return n.Z.wait(0).run((function(){t.reportActionHandlerError(r,e)})),Promise.reject(e)})):Promise.resolve(a)}catch(i){return this.reportActionHandlerError(r,i),Promise.reject(i)}},t.addOnmessageListener=function(e){var t=this;return this.worker.addEventListener("message",e),function(){t.worker.removeEventListener("message",e)}},t.hasActionHandler=function(e){return!!this.actionHandlerMap[e]},t.reportActionHandlerError=function(e,t){var n,o="Worker action "+e+" error";console.error(o,t),null===(n=r.g.log)||void 0===n||n.error(o,t)},e}()},"../spread-sheet/src/flow/browser/phase/services/workerService.ts":function(e,t,r){r.r(t),r.d(t,{CalculationService:function(){return It},WorkerService:function(){return St}}),r("../node_modules/regenerator-runtime/runtime.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/esnext.reflect.metadata.js"),r("../node_modules/core-js/modules/es.object.to-string.js"),r("../node_modules/core-js/modules/es.promise.js");var n,o,s,a=r("../node_modules/@tencent/containerized/build/main/index.js"),i=r("../packages/report/src/index.ts"),u=r("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),c=r("../spread-sheet/src/core/feature/formula/calcControllerTaskQueue.ts"),l=r("../spread-sheet/src/core/feature/formula/utils.ts"),d=r("../spread-sheet/src/core/feature/formula/controller.ts"),h=(r("../node_modules/core-js/modules/es.object.assign.js"),r("../node_modules/core-js/modules/es.array.join.js"),r("../node_modules/i18next/dist/esm/i18next.js")),f=r("../spread-sheet/src/base/util/timer.ts"),p=r("../spread-sheet/src/base/util/appConfig.ts"),m=r("../spread-sheet/src/core/worker/config.ts"),g=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),v=r("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),w=(r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.array.concat.js"),(0,a.yh)("IMainThreadController")),T=r("../spread-sheet/src/core/worker/common/action-types.ts"),k=r("../spread-sheet/src/core/network/message-center/model/userChange-helper.ts"),R=r("../spread-sheet/src/core/network/message-center/model/missChange-helper.ts"),y=(0,a.yh)("IMainThreadMutationData"),A=(0,a.yh)("IMainThreadSheetData"),b=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},_=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},I=function(e,t){return function(r,n){t(r,n,e)}},S=function(e,t,r){var n=this;this.controller=e,this.mutationData=t,this.sheetData=r,this.handleCommit=function(e){var t=[];e.userChange.mutations.forEach((function(e){t=t.concat(e)}));var r=n.sheetData.isSheetDataConfirm?n.mutationData.updateMutationQueue(t,e.userChange.taskId):null,o={userChangeOptions:(0,k.rg)(e.userChange),mutationQueueId:r};n.controller.requestPromise(T.pS.Commit,o)},this.handleAcceptCommit=function(e){n.controller.requestPromise(T.pS.AcceptCommit,{sheetId:e.sheetId,newVersion:e.newVersion,userChange:(0,k.rg)(e.userChange)})},this.handleApplyNewChanges=function(e){if(n.sheetData.isSheetDataConfirm){var t=n.sheetData.isSheetDataConfirm?n.mutationData.updateMutationQueue(e.mutations,e.changeInfo.commitId):void 0,r={changeInfoOptions:(0,R.AV)(e.changeInfo),mutationQueueId:t};n.controller.requestPromise(T.pS.ApplyNewChanges,r)}}},E=S=b([I(0,w),I(1,y),I(2,A),_("design:paramtypes",["function"===typeof(n="undefined"!==typeof w&&w)?n:Object,"function"===typeof(o="undefined"!==typeof y&&y)?o:Object,"function"===typeof(s="undefined"!==typeof A&&A)?s:Object])],S),C=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),O=r("../spread-sheet/src/base/config/report.ts"),j=r("../spread-sheet/src/core/worker/common/base-controller.ts"),N=r("../spread-sheet/src/core/worker/common/channel.ts"),D=function(e){function t(n){var o,s,a;(o=e.call(this)||this).canNewWorker=t.hasWorkerClass;try{if(!o.canNewWorker)return(0,C.Z)(o);o.timeBeforeNewWorker=Date.now();var u=n.workerUrl;if(n.isDebugMode){o.isDebugMode=!0;var c="debugWorker=1";u=u.indexOf("?")>0?u+"&"+c:u+"?"+c}o.worker=new Worker(u,{name:n.workerName}),o.worker.onerror=function(e){var t;console.error("worker onerror",e),null===(t=r.g.log)||void 0===t||t.error("worker onerror",e),e&&void 0===e.filename&&i.ZP.zzsStatus({attrid:O.ZZS_REPORT_ATTR.WORKER_JS_NOTFOUND,status:1}),i.ZP.monitor(34945353)},o.timeAfterNewWorker=Date.now(),o.channel=new N.Z(o.worker,(0,C.Z)(o))}catch(l){console.error("worker init error:",l),null===(s=r.g.log)||void 0===s||s.error("worker onerror",l),null===(a=r.g.log)||void 0===a||a.report("sheet-worker-error-report"),o.canNewWorker=!1,i.ZP.run(O.CONFIG.CREATE_WORKER_ERROR,l)}return o}(0,v.Z)(t,e);var n=t.prototype;return n.terminate=function(){this.worker.terminate()},n.reportActionHandlerError=function(e,t){var n;throw console.error("Worker action "+e+" error:",t),null===(n=r.g.log)||void 0===n||n.error(e,t),i.ZP.monitor(34094592),new Error(t)},t}(j.Z);D.hasWorkerClass=!!window.Worker;var P,x,M,Z,L,H,W,V,F,B,U,G,q=r("../spread-sheet/src/base/error/errorCodeModalProxy.ts"),z=(0,a.yh)("IMainThreadWorkerAbilityTest"),Q=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},Y=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},$=function(e,t){return function(r,n){t(r,n,e)}},J=function(){function e(e,t){this.controller=e,this.workerAbilityTest=t,this.isHeartBeatTesting=!1,this.heartbeatNow=0,this.sickHeartbeats=[]}var t=e.prototype;return t.start=function(){var e=this;this.checkInterValHandle=setInterval((function(){e.checkHeartBeat()}),m.UO),this.removeOnmessageListener=this.controller.addOnmessageListener(this.onmessageAsHealthHeartBeat.bind(this))},t.stop=function(){var e;clearInterval(this.checkInterValHandle),f.Z.erase(this.checkTimeoutHandle),null===(e=this.removeOnmessageListener)||void 0===e||e.call(this),this.removeOnmessageListener=null},t.checkHeartBeat=function(){var e=this;if(!this.isHeartBeatTesting){this.isHeartBeatTesting=!0,this.heartbeatNow+=1;var t=Date.now();this.workerAbilityTest.heartBeatTest(this.heartbeatNow).then((function(){e.isHeartBeatTesting=!1,f.Z.erase(e.checkTimeoutHandle);var r=Date.now()-t;e.durationReport(r)})),f.Z.erase(this.checkTimeoutHandle),this.checkTimeoutHandle=f.Z.wait(m.R5).run((function(){e.isHeartBeatTesting=!1,f.Z.erase(e.checkTimeoutHandle),e.sickHeartbeats.push(e.heartbeatNow),e.checkHealth()}))}},t.onmessageAsHealthHeartBeat=function(){this.isHeartBeatTesting&&(this.isHeartBeatTesting=!1,f.Z.erase(this.checkTimeoutHandle))},t.checkHealth=function(){var e=this.sickHeartbeats.length;e>=2&&this.sickHeartbeats[e-2]+1===this.sickHeartbeats[e-1]&&(this.stop(),this.deadReport(),this.showDeadTip())},t.showDeadTip=function(){q.Z.showFormulaLayerCalcErrorTips()},t.durationReport=function(e){e>3e4&&(i.ZP.monitor(33969412),i.ZP.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_heartbeat_duration",ver5:e}))},t.deadReport=function(){i.ZP.monitor(33969414),i.ZP.tdwReport({opername:"tech_doc",module:"webworker",action:"worker_heart_beat",ver5:this.sickHeartbeats[this.sickHeartbeats.length-1]}),r.g.log.error("worker sickHeartBeats",this.sickHeartbeats)},e}(),K=J=Q([$(0,w),$(1,z),Y("design:paramtypes",["function"===typeof(P="undefined"!==typeof w&&w)?P:Object,"function"===typeof(x="undefined"!==typeof z&&z)?x:Object])],J),X=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ee=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},te=function(e,t){return function(r,n){t(r,n,e)}},re=function(){function e(e){this.controller=e}var t=e.prototype;return t.runTest=function(){var e=Date.now();return this.controller.requestPromise(T.WG.MessageTest,e)},t.heartBeatTest=function(e){return this.controller.requestPromise(T.WG.HeartBeatTest,e)},e}(),ne=re=X([te(0,w),ee("design:paramtypes",["function"===typeof(M="undefined"!==typeof w&&w)?M:Object])],re),oe=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},se=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},ae=function(e,t){return function(r,n){t(r,n,e)}},ie=function(){function e(e){this.controller=e}return e.prototype.syncCacConfig=function(e){return this.controller.requestPromise(T._K.SyncAllConfig,e)},e}(),ue=ie=oe([ae(0,w),se("design:paramtypes",["function"===typeof(Z="undefined"!==typeof w&&w)?Z:Object])],ie),ce=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),le=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},de=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},he=function(e,t){return function(r,n){t(r,n,e)}},fe=function(){function e(e){this.controller=e,this.controller=e,this.addActionListener()}var t=e.prototype;return t.monitor=function(e){i.ZP.monitor(e)},t.tdw=function(e){i.ZP.tdwReport(e)},t.huatuo=function(e){i.ZP.huatuo(e,!0)},t.tdwSingleReport=function(e){var t=e.data,r=e.disableParam;i.ZP.tdwSingleReport(t,r)},t.run=function(e){var t=e.args;i.ZP.run.apply(i.ZP,(0,ce.Z)(t))},t.speedRunReport=function(e){var t,r=e.args;(t=i.ZP.speed).runReport.apply(t,(0,ce.Z)(r))},t.speedHasDonePagePerformanceReport=function(e){var t,r=e.args;(t=i.ZP.speed).hasDonePagePerformanceReport.apply(t,(0,ce.Z)(r))},t.flowLog=function(e){var t=e.args;i.ZP.flowlog.apply(i.ZP,(0,ce.Z)(t))},t.debuggerAlert=function(e){alert(e)},t.weblog=function(e){var t,n,o,s=e.level,a=e.args;null===(o=null===(n=r.g.log)||void 0===n?void 0:n[s])||void 0===o||(t=o).call.apply(t,[n,"worker"].concat((0,ce.Z)(a)))},t.zzsStatus=function(e){i.ZP.zzsStatus(e)},t.zzsValue=function(e){i.ZP.zzsValue(e)},t.tipReport=function(e){i.ZP.tipReport(e)},t.resetDefaultTdwData=function(e){i.ZP.resetDefaultTdwData(e)},t.getSource1=function(e){i.ZP.getSource1(e)},t.kvrOss=function(e){i.ZP.kvrOss(e)},t.idkey=function(e){i.ZP.idkey(e)},t.addActionListener=function(){this.controller.addActionHandler(T.SG.MonitorReport,this.monitor.bind(this)),this.controller.addActionHandler(T.SG.TdwReport,this.tdw.bind(this)),this.controller.addActionHandler(T.SG.HuatuoReport,this.huatuo.bind(this)),this.controller.addActionHandler(T.SG.TdwSingleReport,this.tdwSingleReport.bind(this)),this.controller.addActionHandler(T.SG.DebuggerAlert,this.debuggerAlert.bind(this)),this.controller.addActionHandler(T.SG.RunReport,this.run.bind(this)),this.controller.addActionHandler(T.SG.FlowLogReport,this.flowLog.bind(this)),this.controller.addActionHandler(T.SG.SpeedRunReport,this.speedRunReport.bind(this)),this.controller.addActionHandler(T.SG.SpeedHasDonePagePerformanceReport,this.speedHasDonePagePerformanceReport.bind(this)),this.controller.addActionHandler(T.SG.WebLog,this.weblog.bind(this)),this.controller.addActionHandler(T.SG.ZzsStatus,this.zzsStatus.bind(this)),this.controller.addActionHandler(T.SG.ZzsValue,this.zzsValue.bind(this)),this.controller.addActionHandler(T.SG.tipReport,this.tipReport.bind(this)),this.controller.addActionHandler(T.SG.ResetDefaultTdwData,this.resetDefaultTdwData.bind(this)),this.controller.addActionHandler(T.SG.GetSource1,this.getSource1.bind(this)),this.controller.addActionHandler(T.SG.KvrOss,this.kvrOss.bind(this)),this.controller.addActionHandler(T.SG.Idkey,this.idkey.bind(this))},e}(),pe=fe=le([he(0,w),de("design:paramtypes",["function"===typeof(L="undefined"!==typeof w&&w)?L:Object])],fe),me=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ge=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},ve=function(e,t){return function(r,n){t(r,n,e)}},we=function(){function e(e){this.controller=e,this.addActionListener()}var t=e.prototype;return t.captureException=function(e){var t,r=e.errorString,n=e.params;null===(t=window.Raven)||void 0===t||t.captureException("from-worker: "+r,n)},t.captureWorkerPromiseException=function(e){var t,r=e.message,n=e.stack;try{var o=Object.assign(new Error,{message:r,stack:n});null===(t=window.Raven)||void 0===t||t.captureException(o)}catch(s){console.error(s)}},t.addActionListener=function(){this.controller.addActionHandler(T.kV.CaptureException,this.captureException.bind(this)),this.controller.addActionHandler(T.kV.CaptureWorkerPromiseException,this.captureWorkerPromiseException.bind(this))},e}(),Te=we=me([ve(0,w),ge("design:paramtypes",["function"===typeof(H="undefined"!==typeof w&&w)?H:Object])],we),ke=r("../packages/utils/src/safe.ts"),Re=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ye=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Ae=function(e,t){return function(r,n){t(r,n,e)}},be=function(){function e(e){this.controller=e,this.addActionListener()}var t=e.prototype;return t.getXsrf=function(){return(0,ke.f)()},t.getNowUserIndex=function(){return r.g.nowUserIndex||""},t.addActionListener=function(){this.controller.addActionHandler(T.EA.Xsrf,this.getXsrf.bind(this)),this.controller.addActionHandler(T.EA.NowUserIndex,this.getNowUserIndex.bind(this))},e}(),_e=be=Re([Ae(0,w),ye("design:paramtypes",["function"===typeof(W="undefined"!==typeof w&&w)?W:Object])],be),Ie=r("../spread-sheet/src/core/data/configService/spreadConfig.ts"),Se=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},Ee=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Ce=function(e,t){return function(r,n){t(r,n,e)}},Oe=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{u(n.next(e))}catch(t){s(t)}}function i(e){try{u(n.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((n=n.apply(e,t||[])).next())}))},je=function(){function e(e){this.controller=e,this.isSheetDataReady=!1,this.isSheetDataConfirm=!1,this.controller.addActionHandler(T.Pt.FetchSheetOnMainThread,this.fetchSheet.bind(this))}var t=e.prototype;return t.checkSheetFormulaLayerStatusBetweenThreads=function(){var e=r.g.SpreadsheetApp.calcController.sheetFormulaLayerStatusMap.getCurrentStatusMap();return this.controller.requestPromise(T.Pt.CheckSheetFormulaLayerStatusBetweenThreads,{currentStatusMap:e})},t.informNetworkChange=function(e){return this.controller.requestPromise(T.Pt.InformNetworkChange,e)},t.initSpreadsheetApp=function(e){var t,n=this,o={padId:Ie.q.getConfig("padId")};return this.isSheetDataConfirm=!0,null===(t=r.g.log)||void 0===t||t.info("[分片加载]-开始 InitSpreadsheetApp"),this.controller.requestPromise(T.Pt.InitSpreadsheetApp,Object.assign(e,{clientVars:o})).then((function(e){var t;return null===(t=r.g.log)||void 0===t||t.info("[分片加载]-结束 InitSpreadsheetApp 同步数据完成"),n.isSheetDataReady=!0,n.initSheetDataTime=Date.now(),e}))},t.initSheet=function(e){return this.controller.requestPromise(T.Pt.InitSheet,e)},t.loadSheet=function(e){return this.controller.requestPromise(T.Pt.LoadSheet,e)},t.loadSheetToWorker=function(e){return this.controller.requestPromise(T.Pt.LoadSheetToWorker,e)},t.resetSheetOnWorkerFormula=function(e){return this.controller.requestPromise(T.Pt.resetSheetOnWorkerFormula,e)},t.syncVisibleAreaToWorker=function(e){return this.controller.requestPromise(T.Pt.syncVisibleAreaToWorker,e)},t.updateSpreadsheet=function(e){return this.controller.requestPromise(T.Pt.UpdateSpreadsheet,e)},t.clearAndReInitSheets=function(e){return this.controller.requestPromise(T.Pt.ClearAndReInitSheets,e)},t.clearAndReInitOneSheet=function(e){return this.controller.requestPromise(T.Pt.ClearAndReInitOneSheet,e)},t.transformSpreadsheetBySheetId=function(e){return this.controller.requestPromise(T.Pt.TransformSpreadsheetBySheetId,e)},t.fetchSheet=function(e){var t=this;return new Promise((function(r){var n=(0,ke.f)();t.fetch(e.sheetId,e.spreadsheetId,n,(function(e){r(e)}))}))},t.fetch=function(e,t,n,o){return Oe(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.g.SpreadsheetApp,s=void 0,t.next=4,n.dataCenter.loaderManager.loadSheetData({sheetId:e,ignoreChunk:!0,baseVersion:n.messageCenter.versionManager.getCurrentVersion(),onSuccess:function(e){var t;e.isFinished&&(s&&(t=s.chunkData),o({initialAttributedText:{text:[].concat((0,ce.Z)(t||[]),(0,ce.Z)(e.chunkData||[]))},maxcol:(null===s||void 0===s?void 0:s.maxCol)||null,maxrow:(null===s||void 0===s?void 0:s.maxRow)||null}))},onFail:function(t){var n;null===(n=r.g.log)||void 0===n||n.error("worker 在主线程拉子表失败",e,t.error),o("fail")}}).catch((function(t){var n;null===(n=r.g.log)||void 0===n||n.error("worker 在主线程拉子表失败",e,t),o("fail")}));case 4:s=t.sent;case 5:case"end":return t.stop()}}),t)})))},e}(),Ne=je=Se([Ce(0,w),Ee("design:paramtypes",["function"===typeof(V="undefined"!==typeof w&&w)?V:Object])],je),De=(r("../node_modules/core-js/modules/es.array.map.js"),r("../node_modules/@tencent/docs-user-agent/dist/index.js")),Pe=r.n(De),xe=r("../spread-sheet/src/core/ui/toast/index.ts"),Me=(r("../node_modules/core-js/modules/es.array.splice.js"),-1),Ze=!1,Le=function(){function e(){this.queue=[]}var t=e.prototype;return t.push=function(e,t){var r=t;return this.queue.push({mutations:e,id:r,isComplete:!1,startTime:Date.now()}),this.queue.length<=200||(this.queue.splice(0,this.queue.length-200),this.queueMaxLengthReport(r)),r},t.transform=function(e,t,n){void 0===n&&(n=-1);var o=[],s=[t],a=!1,i=!1;-1===e&&(a=!0,i=!0);for(var u=0,c=this.queue.length;u<c;u++)a?o.push(this.queue[u].mutations):this.queue[u].id===e&&(a=!0,i=!0);return i?r.g.SpreadsheetApp.mutationBehavior.followRequestMutations(o,s,!0)[0]:t},t.complete=function(e){if(-1!==e){for(var t=0,r=0,n=this.queue.length;r<n;r++)if(this.queue[r].id===e){this.queue[r].isComplete||(this.queue[r].isComplete=!0,t=r,this.completeTimeoutReport(this.queue[r]));break}this.queue.splice(0,t)}},t.queueMaxLengthReport=function(e){Me<6&&(i.ZP.run(O.CONFIG.MUTATION_QUEUE_MAX_SIZE,[e,JSON.stringify(this.queue[this.queue.length-1]).substring(0,100)]),Me+=1),Ze||(r.g.SpreadsheetApp.getCurrentMainThreadWorker().sheetData.checkSheetFormulaLayerStatusBetweenThreads().then((function(e){e||i.ZP.monitor(34277139)})),Ze=!0)},t.completeTimeoutReport=function(e){Date.now()-e.startTime<=3e4||i.ZP.run(O.CONFIG.MUTATION_QUEUE_COMPLETE_TIMEOUT,[e.id,JSON.stringify(e).substring(0,100)])},e}(),He=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},We=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Ve=function(e,t){return function(r,n){t(r,n,e)}},Fe=!1,Be=148,Ue=149,Ge=150,qe=152,ze=153,Qe=154,Ye=function(){function e(e){var t=this;this.controller=e,this.workerHasFirstResult=!1,this.workerHasVisibleResult=!1,this.workerHasFullResult=!1,this.workerResultTime={hasFirstResult:0,hasVisibleResult:0,hasFullResult:0,isCrossResult:!1},this.workerResultHasReport=!1,this.mutationQueue=new Le,this.addListenActions(),this.mutationHandleStartTimeMap={},Pe().isPC&&this.showCalculatingToast(),f.Z.wait(12e4).run((function(){t.workerResultHasReport=!0}))}var t=e.prototype;return t.syncNonPersistentMutationsToMainThread=function(e){var t,n=e.serializedMutations,o=e.isFromFormula,s=e.latestMutationQueueIdInWorker,a=e.needToSetIntializedDone,u=void 0!==a&&a,l=e.isInVisibleArea,d=void 0!==l&&l,h=e.relatedSheetIds,f=e.canCheckUnfinishedCalculationNode,p=void 0!==f&&f,m=e.muationQueueRunnedIndex;this.getWorkerResultTime({serializedMutationsLength:n.length,isFromFormula:o,needToSetIntializedDone:u,canCheckUnfinishedCalculationNode:p,isInVisibleArea:d,relatedSheetIds:h||[]});var g=r.g.SpreadsheetApp,v=n.reduce((function(e,t){var r=g.mutationBehavior.deserializeMutation(t);return r&&e.push(r),e}),[]);if(this.mutationQueue.transform(s,v,m).forEach((function(e){var t=e.getAffectedSheetId(),r=g.spreadsheet.sheetManager.getSheetBySheetId(t);(null===r||void 0===r?void 0:r.isLoaded)&&g.mutationBehavior.applyMutation(e,{isLocal:!0,isFromFormula:o})})),this.mutationQueue.complete(s),null===h||void 0===h||h.forEach((function(e){g.calcController?u&&(g.calcController.sheetFormulaLayerStatusMap.setWaitingStart(e),g.calcController.sheetFormulaLayerStatusMap.setWaitingDone(e),g.calcController.sheetFormulaLayerStatusMap.setInitializedDone(e)):(0,c.gI)((function(){u&&(g.calcController.sheetFormulaLayerStatusMap.setWaitingStart(e),g.calcController.sheetFormulaLayerStatusMap.setWaitingDone(e),g.calcController.sheetFormulaLayerStatusMap.setInitializedDone(e))}))})),!Fe){var w="undefined"!==typeof this.mutationHandleStartTimeMap[s]?this.mutationHandleStartTimeMap[s]:g.getCurrentMainThreadWorker().sheetData.initSheetDataTime;if("number"===typeof w){var T=Date.now()-w;(p?T>2e4:T>5e3)&&(null===(t=i.ZP.tdwReport)||void 0===t||t.call(i.ZP,{opername:"doc_excel",module:"formula_worker",action:"worker_handle_mutation_timeout",ver5:JSON.stringify({duration:T,type:p?0:1})}),i.ZP.monitor(p?33969191:33969190),Fe=!0)}}return this.workerResultTimeReport(),!0},t.syncNonPersistentMutationsToWorkerThread=function(e){var t=e.mutations,n=r.g.SpreadsheetApp,o={serializedMutations:t.map((function(e){return n.mutationBehavior.serializeMutation(e)}))};this.controller.requestPromise(T.bP.SyncNonPersistentMutationsToWorkerThread,o)},t.updateMutationQueue=function(){var e,t=(e=this.mutationQueue).push.apply(e,arguments);return this.mutationHandleStartTimeMap[t]=Date.now(),t},t.addListenActions=function(){this.controller.addActionHandler(T.bP.CompleteMutationQueue,this.completeMutationQueue.bind(this)),this.controller.addActionHandler(T.bP.SyncNonPersistentMutationsToMainThread,this.syncNonPersistentMutationsToMainThread.bind(this))},t.completeMutationQueue=function(e){var t=e.mutationQueueId;this.mutationQueue.complete(t)},t.getWorkerResultTime=function(e){var t=e.serializedMutationsLength,n=e.canCheckUnfinishedCalculationNode,o=e.isInVisibleArea,s=e.relatedSheetIds;if(!this.workerResultHasReport&&!(this.workerHasFirstResult&&this.workerHasVisibleResult&&this.workerHasFullResult)&&(!this.workerHasFirstResult&&t>0&&(this.workerHasFirstResult=!0,this.workerResultTime.hasFirstResult=Date.now()),!this.workerHasVisibleResult&&this.workerHasFirstResult&&o&&(this.workerResultTime.hasVisibleResult=Date.now()),this.workerHasVisibleResult||!this.workerHasFirstResult||o||(this.workerHasVisibleResult=!0,this.workerResultTime.hasVisibleResult=this.workerResultTime.hasVisibleResult||Date.now()),!this.workerHasFullResult&&n)){this.workerHasFullResult=!0,this.workerResultTime.hasFullResult=Date.now();var a=r.g.SpreadsheetApp.spreadsheet.activeSheetId;(1===s.length&&s[0]!==a||s.length>1)&&(this.workerResultTime.isCrossResult=!0)}},t.workerResultTimeReport=function(){var e,t;if(!this.workerResultHasReport&&this.workerHasFirstResult&&this.workerHasVisibleResult&&this.workerHasFullResult){var n=null===(e=r.g.performanceData)||void 0===e?void 0:e.jsStartRun;if(n){var o,s;this.workerResultTime={hasFirstResult:this.workerResultTime.hasFirstResult-n,hasVisibleResult:this.workerResultTime.hasVisibleResult-n,hasFullResult:this.workerResultTime.hasFullResult-n,isCrossResult:this.workerResultTime.isCrossResult},null===(t=i.ZP.tdwReport)||void 0===t||t.call(i.ZP,{opername:"doc_excel",module:"formula_worker",action:"worker_result_time",ver5:JSON.stringify(this.workerResultTime)});var a=this.workerResultTime.isCrossResult?((o={})[qe]=this.workerResultTime.hasFirstResult,o[ze]=this.workerResultTime.hasVisibleResult,o[Qe]=this.workerResultTime.hasFullResult,o):((s={})[Be]=this.workerResultTime.hasFirstResult,s[Ue]=this.workerResultTime.hasVisibleResult,s[Ge]=this.workerResultTime.hasFullResult,s);i.ZP.huatuo({appid:20533,flag1:22213,flag2:1,flag3:1,speedTime:a},!0)}this.workerResultHasReport=!0}},t.showCalculatingToast=function(){var e=r.g.SpreadsheetApp.spreadsheet.activeSheetId;f.Z.wait(1e4).run((function(){var t,n=r.g.SpreadsheetApp;if(n.spreadsheet.activeSheetId===e){var o=null===(t=n.calcController)||void 0===t?void 0:t.sheetFormulaLayerStatusMap.isSheetInitialized(e);"boolean"!==typeof o||o||((0,xe.hideToast)(),(0,xe.showToast)(h.ZP.t("函数正在计算中，若加载时间过长，请刷新试试。"),void 0,{btnTextAfter:"",toolToastCloseTime:3e3}),i.ZP.monitor(35328652))}}))},e}(),$e=Ye=He([Ve(0,w),We("design:paramtypes",["function"===typeof(F="undefined"!==typeof w&&w)?F:Object])],Ye),Je=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},Ke=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Xe=function(e,t){return function(r,n){t(r,n,e)}},et=function(){function e(e){this.controller=e,this.controller=e,this.addActionListener()}var t=e.prototype;return t.listenDataChange=function(e){var t=e.workbookRangeId;this.reRenderChart(t)},t.addActionListener=function(){this.controller.addActionHandler(T.be.DATA_CHANGE,this.listenDataChange.bind(this))},t.reRenderChart=function(e){var t=r.g.SpreadsheetApp;f.Z.wait(0).run((function(){t.view.canvas.dataCallView.reRenderChart({workbookRangeId:e})}))},e}(),tt=et=Je([Xe(0,w),Ke("design:paramtypes",["function"===typeof(B="undefined"!==typeof w&&w)?B:Object])],et),rt=r("../spread-sheet/src/core/app/tool.ts"),nt=(r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.replace.js"),function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}),ot=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},st=function(e,t){return function(r,n){t(r,n,e)}},at=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{u(n.next(e))}catch(t){s(t)}}function i(e){try{u(n.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((n=n.apply(e,t||[])).next())}))},it=function(){function e(e){this.controller=e,this.LoadServiceTimeout=2e4,this.loadedServicesMap={}}var t=e.prototype;return t.service=function(e){var t;return at(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,s,a,i,u=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.replace("?.*$",""),!this.loadedServicesMap[o]){n.next=3;break}return n.abrupt("return",this.loadedServicesMap[o]);case 3:return null===(t=r.g.log)||void 0===t||t.info("Worker service start, "+e),s=f.Z.wait(this.LoadServiceTimeout).run((function(){f.Z.erase(s),u.loadServiceTimeoutReport(e)})),n.next=7,this.controller.requestPromise(T.yZ.Service,{serviceUrl:e});case 7:return a=n.sent,f.Z.erase(s),i=this.getServiceFromServiceInfo(a),this.loadedServicesMap[o]=i,this.loadServiceSuccessReport(e),n.abrupt("return",i);case 13:case"end":return n.stop()}}),n,this)})))},t.getServiceFromServiceInfo=function(e){var t=this,r=e.serviceName,n=e.serviceActionNameList,o={name:r};return n.forEach((function(e){var n=r+"."+e;o[e]=function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t.controller.requestPromise(n,r)}})),o},t.loadServiceTimeoutReport=function(e){var t,n="Worker service timeout, "+e;console.error(n),i.ZP.monitor(35444981),i.ZP.tdwReport({opername:"tech_doc",module:"webworker",action:"main_worker_service_timeout",ver5:e}),null===(t=r.g.log)||void 0===t||t.error(n)},t.loadServiceSuccessReport=function(e){var t;i.ZP.monitor(35445032),null===(t=r.g.log)||void 0===t||t.info("Worker service success, "+e)},e}(),ut=it=nt([st(0,w),ot("design:paramtypes",["function"===typeof(U="undefined"!==typeof w&&w)?U:Object])],it),ct=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},lt=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},dt=function(e,t){return function(r,n){t(r,n,e)}},ht=function(){function e(e){this.controller=e,this.columnValidationResult={},this.controller=e,this.addActionListener()}var t=e.prototype;return t.listenValidStatusChange=function(e){var t=r.g.SpreadsheetApp;this.columnValidationResult=e,t.view.canvas.renderApi.renderColHead()},t.addActionListener=function(){this.controller.addActionHandler(T.vW.UPDATE_COLUMN_VALIDATION_STATUS,this.listenValidStatusChange.bind(this))},e}(),ft=ht=ct([dt(0,w),lt("design:paramtypes",["function"===typeof(G="undefined"!==typeof w&&w)?G:Object])],ht),pt=function(e){function t(t){var n;return(n=e.call(this)||this).isTerminated=!1,n.loadSheetToWorkerIfNeeded=function(e,t){var o,s=void 0===t?{checked:!1,defaultNeedLoadInWorker:!1,isLocalMutation:!1}:t,a=s.checked,i=s.defaultNeedLoadInWorker,u=s.isLocalMutation;if(n.workerHasInitSheetMap[e])return!1;var c=r.g.SpreadsheetApp;if(!(null===(o=c.spreadsheet.sheetManager.getSheetBySheetId(e))||void 0===o?void 0:o.isLoaded))return!1;if(a?i:(0,l.fA)(c.spreadsheet,e).needLoadInWorker){var d=[],h=[];c.spreadsheet.workbookRangeManager.chartWorkbookRangeMap.forEach((function(t){t.range.sheetId===e&&d.push(t.serialize())})),c.spreadsheet.embeddedObjectManager.each((function(t){t.location.sheetId===e&&h.push(t.serialize())}));var f=u?c.spreadsheet.sheetManager.getSheetBySheetId(e).serialize():void 0,p=u?c.spreadsheet.sheetManager.getSheetBySheetId(e).filterViewManager.getActiveFilterViewId():void 0;return n.sheetData.loadSheetToWorker({activeFilterViewId:p,sheetId:e,newChartWorkbookRanges:d,newEmbeddedObjects:h,serializeData:f}),n.workerHasInitSheetMap[e]=!0,!0}return!1},n.handleCommit=function(e){var t=e.userChange.sheetId;n.messageCenterData.handleCommit(e),n.loadSheetToWorkerIfNeeded(t,{isLocalMutation:!0,checked:!1,defaultNeedLoadInWorker:!1})},n.handleApplyNewChanges=function(e){var t=e.changeInfo.sheetId;n.messageCenterData.handleApplyNewChanges(e),n.loadSheetToWorkerIfNeeded(t,{isLocalMutation:!0,checked:!1,defaultNeedLoadInWorker:!1})},n.initListeners=function(){var e=r.g.SpreadsheetApp;e.messageCenterAdapter&&(n._register(e.messageCenterAdapter.sendMessageCenterAdapter.onUserChangeNew((function(e){return n.handleCommit(e)}))),n._register(e.messageCenterAdapter.sendMessageCenterAdapter.onAcceptCommit((function(e){return n.messageCenterData.handleAcceptCommit(e)}))),n._register(e.messageCenterAdapter.receiveMessageCenterAdapter.onAfterApplyCollabMutations((function(e){return n.handleApplyNewChanges(e)}))))},n.controller=new D(t),n.workerAbilityTest=new ne(n.controller),n.cacSync=new ue(n.controller),n.report=new pe(n.controller),n.raven=new Te(n.controller),n.cookie=new _e(n.controller),n.sheetData=new Ne(n.controller),n.mutationData=new $e(n.controller),n.charts=new tt(n.controller),n.heartBeatCheck=new K(n.controller,n.workerAbilityTest),n.messageCenterData=new E(n.controller,n.mutationData,n.sheetData),n.dynamic=new ut(n.controller),n.columnDataValidation=new ft(n.controller),n.workerHasInitSheetMap={},n.initListeners(),n}(0,v.Z)(t,e);var n=t.prototype;return n.clearWorkerHasInitSheetMap=function(e){this.workerHasInitSheetMap[e]&&(this.workerHasInitSheetMap[e]=!1)},n.startHeartBeatCheck=function(){this.isTerminated||this.heartBeatCheck.start()},n.dispose=function(){var t;e.prototype.dispose.call(this),null===(t=r.g.log)||void 0===t||t.debug("flow MainThreadWorker destroy()"),rt.Z.window.SpreadsheetApp.emitter.off(rt.Z.window.SpreadsheetApp.EVENT.SPREAD_SHEET_EDITABLE,this.initListeners),this.heartBeatCheck.stop(),this.controller.terminate(),this.isTerminated=!0},n.reportWorkerStatus=function(e,n){var o;if(void 0===e&&(e=!1),e&&i.ZP.monitor(34097396),!0!==t.hasReportWorkerStatus){t.hasReportWorkerStatus=!0;var s=D.hasWorkerClass,a=this.controller.canNewWorker,u=!!n,c=-1;u&&n&&(c=n-this.controller.timeBeforeNewWorker);var l=NaN;this.controller.timeAfterNewWorker&&this.controller.timeBeforeNewWorker&&(l=this.controller.timeAfterNewWorker-this.controller.timeBeforeNewWorker),this.workerStatus={hasWorkerClass:s,canNewWorker:a,canPostMessage:u,workerReadyDuration:c,newWorkerDuration:l},i.ZP.tdwReport({opername:"tech_doc",module:"formula_worker",action:"worker_status",ver5:JSON.stringify(this.workerStatus)}),a||i.ZP.monitor(33848585),u||(i.ZP.monitor(33848586),i.ZP.zzsStatus({attrid:O.ZZS_REPORT_ATTR.WORKER_COMMUNICATION_FAIL,status:1})),null===(o=r.g.log)||void 0===o||o.info("workerStatus",this.workerStatus)}},(0,g.Z)(t,[{key:"canNewWorker",get:function(){return this.controller.canNewWorker}}]),t}(a.JT);pt.hasReportWorkerStatus=!1;var mt=pt;function gt(e){var t=r.g.location.href.indexOf("debugWorker=1")>=0,n=new mt(Object.assign(Object.assign({},e),{isDebugMode:e.isDebugMode||t,workerUrl:vt()}));return n.canNewWorker?(function(e){var t=f.Z.wait(m.Ob).run((function(){e.reportWorkerStatus()}));e.workerAbilityTest.runTest().then((function(r){var n=Date.now();f.Z.erase(t),e.controller.isDebugMode;var o=r>m.Ob;e.reportWorkerStatus(o,n)})).catch((function(t){e.controller.isDebugMode&&console.error("%cFirst communication timeout: "+t,"color: orange")})),f.Z.wait(m.lK).run((function(){e.startHeartBeatCheck()}))}(n),function(e){e.cacSync.syncCacConfig(p.Z.getAllConfig()).then((function(){})).catch((function(e){console.error("sync cac config error",e)}))}(n)):n.reportWorkerStatus(),n}function vt(){var e=r.g.__globalWorkerFilePath,t=[];return r.g.location.href.indexOf("showLog=1")>=0&&t.push("showLog=1"),r.g.location.href.indexOf("showFormulaLog=1")>=0&&t.push("showFormulaLog=1"),h.ZP.language&&t.push("lng="+h.ZP.language),e=e+"?"+t.join("&")}var wt,Tt,kt,Rt=r("../spread-sheet/src/flow/browser/phase/services/sheetLifecyle.interface.ts"),yt=function(e,t,r,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,r,a):o(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},At=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},bt=function(e,t){return function(r,n){t(r,n,e)}},_t=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{u(n.next(e))}catch(t){s(t)}}function i(e){try{u(n.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((n=n.apply(e,t||[])).next())}))},It=function(){function e(e){this.app=e,this.initCalcController()}return e.prototype.initCalcController=function(){var e=new d.Z(this.app);this.calcController=e,e.initEdit(this.app.data.initMutations),this.app.data.initMutations.length=0,this.app.initCalcController(e),(0,c.x2)()},e}();It=yt([bt(0,u.m),At("design:paramtypes",["function"===typeof(wt="undefined"!==typeof u.m&&u.m)?wt:Object])],It);var St=function(){function e(e,t){this.app=e,this.sheetLifeService=t}var t=e.prototype;return t.initWorker=function(){var e;return _t(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null===(e=r.g.log)||void 0===e||e.info("flow WorkerService initWorker()",r.g.SpreadsheetAppInitComplete),this.sheetLifeService.phase=Rt.P.SPREAD_SHEET_WORKER_SATRT,this.initMainThreadWorker(),r.g.SpreadsheetAppInitComplete?this.initSpreadsheetAppInWorker():this.app.emitter.once(this.app.EVENT.SPREAD_SHEET_ALL_CHUNK_READY,(function(){var e;null===(e=r.g.log)||void 0===e||e.info("flow WorkerService on SPREAD_SHEET_ALL_CHUNK_READY"),n.initSpreadsheetAppInWorker()})),this.sheetLifeService.phase=Rt.P.SPREAD_SHEET_WORKER_END;case 5:case"end":return t.stop()}}),t,this)})))},t.initMainThreadWorker=function(){var e=gt({workerName:"defaultWorker"});this.mainThreadWorker=e,this.app.initMainThreadWorker(e),(0,a.jz)(e)},t.initSpreadsheetAppInWorker=function(){var e;return _t(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,s,a,u,c,d,h,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.app.initOptions,o=n.activeSheetId,s=n.title,a=n.sheetList,u=n.spreadsheetId,c=n.baseVersion,d=n.workbookRanges,h=void 0===d?[]:d,null===(e=r.g.log)||void 0===e||e.info("flow","WorkerService initSpreadsheetAppInWorker()"),f=(0,l.fA)(this.app.spreadsheet,o),this.app.mainThreadWorker.sheetData.isSheetDataReady||this.app.mainThreadWorker.sheetData.initSpreadsheetApp({activeSheetId:o,header:a,spreadsheetId:u,title:s,waitForFormulaLayerToBeInitialized:!0,baseVersion:c,workbookRanges:h}),this.mainThreadWorker.loadSheetToWorkerIfNeeded(o,{checked:!0,defaultNeedLoadInWorker:f.needLoadInWorker}),f.needLoadInWorker?i.ZP.tdwReport({opername:"tech_doc",module:"webworker",action:"need_worker_when_init",ver5:JSON.stringify(f)}):(this.app.calcController.sheetFormulaLayerStatusMap.setWaitingStart(o),this.app.calcController.sheetFormulaLayerStatusMap.setWaitingDone(o),this.app.calcController.sheetFormulaLayerStatusMap.setInitializedDone(o));case 6:case"end":return t.stop()}}),t,this)})))},e}();St=yt([bt(0,u.m),bt(1,Rt.n),At("design:paramtypes",["function"===typeof(Tt="undefined"!==typeof u.m&&u.m)?Tt:Object,"function"===typeof(kt="undefined"!==typeof Rt.n&&Rt.n)?kt:Object])],St)}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/bundle_workerService.f528a230a3ed5cc9d048.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=bundle_workerService.f528a230a3ed5cc9d048.js.map