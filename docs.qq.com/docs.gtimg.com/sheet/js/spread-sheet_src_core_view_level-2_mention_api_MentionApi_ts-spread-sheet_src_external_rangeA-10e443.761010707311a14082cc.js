self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["spread-sheet_src_core_view_level-2_mention_api_MentionApi_ts-spread-sheet_src_external_rangeA-10e443"],{"../spread-sheet/src/core/view/level-2/mention/api/MentionApi.ts":function(e,t,n){n.d(t,{Z:function(){return h}});var r,a,i,o=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=(n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.search.js"),n("../spread-sheet/src/base/event/event.ts")),u=n("../spread-sheet/src/external/mention/enum.ts"),c=n("../spread-sheet/src/external/view/mobile/toolbar/native-toolbar/index.ts"),l=n("../spread-sheet/src/base/index.ts");!function(e){e.MENTION_LIST="MENTION_LIST",e.QUICK_REMIND_MENU="QUICK_REMIND_MENU"}(r||(r={})),function(e){e.TOP="top"}(i||(i={}));var d=function(){function e(){}return e.popMentionList=function(t,a,i,o){var c;n.g.log.info("MentionApi","popMentionList - position: "+JSON.stringify(t)+", rowHeight: "+a+", sheetId: "+i),null===(c=s.ZP.mentionEvent)||void 0===c||c.trigger(u.yS.ADD_MENTION_ACTION,t,a,i,o),e.modifyMentionUIComponentDisplayStatus(r.MENTION_LIST,!0)},e.setMentionMenu=function(t,a,i){var o;if(n.g.log.debug("MentionApi","setMentionMenu - visible: "+t+", pos: "+JSON.stringify(a)+", rowHeight: "+i),a.x<0||a.y<0)return n.g.log.warn("MentionApi","setMentionMenu position is invalid, force hide mention list!"),e.hideMentionList(),void e.modifyMentionUIComponentDisplayStatus(r.MENTION_LIST,!1);null===(o=s.ZP.mentionEvent)||void 0===o||o.trigger(u.yS.SET_MENTION_MENU,t,a,i),e.modifyMentionUIComponentDisplayStatus(r.MENTION_LIST,!1)},e.search=function(t){var a;n.g.log.debug("MentionApi","search - "+t),null===(a=s.ZP.mentionEvent)||void 0===a||a.trigger(u.yS.SEARCH_MENTION,t),e.modifyMentionUIComponentDisplayStatus(r.MENTION_LIST,!0)},e.control=function(t){var a;n.g.log.debug("MentionApi","control - "+t),null===(a=s.ZP.mentionEvent)||void 0===a||a.trigger(u.yS.KEYBOARD_DOWN,t),e.modifyMentionUIComponentDisplayStatus(r.MENTION_LIST,!0)},e.hideMentionList=function(){var t;n.g.log.info("MentionApi","hideMentionList"),null===(t=s.ZP.mentionEvent)||void 0===t||t.trigger(u.yS.CANCEL_MENTION_ACTION),e.modifyMentionUIComponentDisplayStatus(r.MENTION_LIST,!1)},e.showRemindBoard=function(t,a,i,o,c){var l;n.g.log.info("MentionApi","showRemindBoard - mentionId: "+t+", position: "+JSON.stringify(a)+", visible: "+i+", rowHeight: "+o),null===(l=s.ZP.mentionEvent)||void 0===l||l.trigger(u.yS.SET_QUICKREMIND_MENU,{mentionId:t,pos:a,visible:i,rowHeight:o,userId:c}),e.modifyMentionUIComponentDisplayStatus(r.QUICK_REMIND_MENU,!0)},e.closeRemindBoard=function(){var t;n.g.log.info("MentionApi","closeRemindBoard"),null===(t=s.ZP.mentionEvent)||void 0===t||t.trigger(u.yS.HIDE_QUICKREMIND_MENU),e.modifyMentionUIComponentDisplayStatus(r.QUICK_REMIND_MENU,!1)},e.enterFullScreenMode=function(){return(0,c.KK)()?(n.g.log.info("MentionApi","enterFullScreenMode - Hide native toolbar start"),l.Z.util.timer.wait(500).run((function(){c.ZP.hideNativeToolbar(),n.g.log.info("MentionApi","enterFullScreenMode - Hide native toolbar end")})),!0):(n.g.log.debug("MentionApi","enterFullScreenMode - Does not support native toolbar"),!1)},e.modifyMentionUIComponentDisplayStatus=function(t,n){e.mentionDisplayStatus[t]=n},(0,o.Z)(e,null,[{key:"isMentionListVisible",get:function(){return e.mentionDisplayStatus[r.MENTION_LIST]}},{key:"isQuickRemindMenuVisible",get:function(){return e.mentionDisplayStatus[r.QUICK_REMIND_MENU]}}]),e}();d.mentionDisplayStatus=((a={})[r.MENTION_LIST]=!1,a[r.QUICK_REMIND_MENU]=!1,a);var h=d},"../spread-sheet/src/external/mention/enum.ts":function(e,t,n){var r,a;n.d(t,{aV:function(){return i},yS:function(){return r}}),function(e){e.ADD_MENTION_ACTION="addMentionAction",e.SET_MENTION_MENU="setMentionMenu",e.SEND_MENTION_ACTION="sendMentionAction",e.CANCEL_MENTION_ACTION="cancelMentionAction",e.DELETE_MENTION_ACTION="deleteMentionAction",e.SEARCH_MENTION="searchMention",e.SET_QUICKREMIND_MENU="setQuickRemindMenu",e.HIDE_QUICKREMIND_MENU="hideQuickRemindMenu",e.KEYBOARD_DOWN="keyboardDown",e.AUTO_CREATE_MENTION="autoCreateMention"}(r||(r={})),function(e){e.MENTION_START="mention_start",e.MENTION_END="mention_end"}(a||(a={}));var i=function(e){return e+"Success"}},"../spread-sheet/src/external/rangeAuth/loader/RangeAuthManager.ts":function(e,t,n){n.d(t,{d:function(){return R}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js");var r=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),a=function(){},i=n("../spread-sheet/src/external/rangeAuth/util/range-auth-request-util.ts"),o=n("../spread-sheet/src/core/app/tool.ts"),s=n("../spread-sheet/src/base/util/appConfig.ts"),u=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.getUserRangePrivilege=function(e){var t=o.Z.window.rangeAuthVars?o.Z.window.rangeAuthVars.rangeRev:"";return new Promise((function(r,a){$.ajax({url:"//"+s.Z.getConfig("runtime.domainName")+"/cgi-go/range_priv/get_user_range_privilege",type:"POST",xhrFields:{withCredentials:!0},data:{localPadId:window.clientVars.localPadId,type:1,domain:(0,i.MQ)(),rangeIdList:JSON.stringify(e),rangeRev:t,xsrf:o.Z.getXsrf()},success:function(e){var t,a;if("string"===typeof e)try{a=JSON.parse(e)}catch(i){null===(t=n.g.log)||void 0===t||t.error("rangeAuthRequestUtil.tempData.parse",null===i||void 0===i?void 0:i.stack),a={}}else a=e;r(a)},error:function(e){a(e)}})}))},t}(a),c=n("../node_modules/@tencent/docs_offline/lib/index.js"),l=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),d=n("../spread-sheet/src/external/rangeAuth/util/util.ts"),h=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},g=function(e){function t(t){var n;return(n=e.call(this)||this).app=t,n}return(0,r.Z)(t,e),t.prototype.getUserRangePrivilege=function(e){var t=this;return new Promise((function(r,a){return h(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,null===(i=this.app.offlineOpen)||void 0===i?void 0:i.offlineDataManager.getHelper(c.Gk.EXCEL).getRangePrivilege(l.q.getConfig("globalPadId"),e);case 3:s=t.sent,t.next=11;break;case 6:return t.prev=6,t.t0=t.catch(0),a(t.t0),null===(o=n.g.log)||void 0===o||o.error("getRangePrivilege error",null===t.t0||void 0===t.t0?void 0:t.t0.stack,null===t.t0||void 0===t.t0?void 0:t.t0.message),t.abrupt("return");case 11:s.error&&a(s.error),u=(0,d.convertToServerRangePrivilege)(s.data.data),r({data:{isOwner:!1,rangeCheckResList:u},msg:"",retcode:0});case 14:case"end":return t.stop()}}),t,this,[[0,6]])})))}))},t}(a),p=n("../node_modules/@tencent/netcheck/lib/index.js"),v=n("../spread-sheet/src/external/rangeAuth/logic/check-user-auth.ts");function f(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},R=function(){function e(t){var r=this;if(this.updateLocalUserRangePrivilege=function(e){for(var t,a,i,o=[],s=f((0,d.getProtectedMap)().keys());!(i=s()).done;){var u=i.value;o.push(u)}try{null===(t=r.app.offlineOpen)||void 0===t||t.offlineDataManager.getHelper(c.Gk.EXCEL).cacheRangePrivilege(l.q.getConfig("globalPadId"),(0,d.convertToLocalRangePrivilege)(e),o)}catch(h){null===(a=n.g.log)||void 0===a||a.error("cacheRangePrivilege error",null===h||void 0===h?void 0:h.stack,null===h||void 0===h?void 0:h.message)}},this.app=t,e.instance)return e.instance;this.serverLoader=new u,this.offlineLoader=new g(t),e.instance=this}var t=e.prototype;return t.getUserRangePrivilege=function(e){return void 0===e&&(e=[]),A(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.__SUPPORT_FULL_OFFLINE_MODE||p.network.isOnline){t.next=4;break}return t.next=3,this.offlineLoader.getUserRangePrivilege(e);case 3:return t.abrupt("return",t.sent);case 4:return t.next=6,this.serverLoader.getUserRangePrivilege(e);case 6:return n=t.sent,this.updateLocalUserRangePrivilege(n.data.rangeCheckResList),t.abrupt("return",n);case 9:case"end":return t.stop()}}),t,this)})))},t.deleteRangeAuth=function(e){var t,r;try{null===(t=this.app.offlineOpen)||void 0===t||t.offlineDataManager.getHelper(c.Gk.EXCEL).deleteRangeAuth(l.q.getConfig("globalPadId"),e)}catch(a){null===(r=n.g.log)||void 0===r||r.error("deleteRangeAuth error",null===a||void 0===a?void 0:a.stack,null===a||void 0===a?void 0:a.message)}},t.isSheetRangeCanEdit=function(e){var t=this;return new Promise((function(r){var a=t.app.sheetStatus.workbookStatus.canEdit,i=(0,d.getExistSheetRangeIdItem)(e);i||r(a),l.q.getConfig("isOwner")&&r(a),t.getUserRangePrivilege([i]).then((function(e){var t,n;if(null===(n=null===(t=e.data)||void 0===t?void 0:t.rangeCheckResList)||void 0===n?void 0:n[0]){var a=e.data.rangeCheckResList[0],i=Number(a.rangePolicy||1),o=Number(a.rangePrivilege||0),s=(0,v.f)(i,o);r(s)}else r(!0)})).catch((function(e){var t;null===(t=n.g.log)||void 0===t||t.error("rangeAuth.util.util.isSheetRangeCanEdit",null===e||void 0===e?void 0:e.stack),r(a)}))}))},e}()},"../spread-sheet/src/external/rangeAuth/logic/check-user-auth.ts":function(e,t,n){n.d(t,{O:function(){return i},f:function(){return a}});var r=n("../spread-sheet/src/external/rangeAuth/config/auth-constant.ts");function a(e,t){return 0!==e&&r.Zx[e][t]}function i(e,t,n){return n!==r.mA.CAN_NOT_VIEW||0!==e&&r.q9[e][t]}},"../spread-sheet/src/external/rangeAuth/range-auth-plugin.ts":function(e,t,n){n.d(t,{Z:function(){return V}});var r=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),i=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.entries.js"),n("../node_modules/core-js/modules/es.array.find-index.js"),n("../node_modules/i18next/dist/esm/i18next.js")),o=n("../packages/model/src/range/GridRange.ts"),s=n("../packages/model/src/spreadsheet/SpreadsheetType.ts"),u=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),c=(n("../node_modules/core-js/modules/es.array.concat.js"),n("../spread-sheet/src/core/app/tool.ts")),l=n("../spread-sheet/src/external/rangeAuth/util/util.ts"),d=n("../spread-sheet/src/external/rangeAuth/util/data-api.ts"),h=n("../spread-sheet/src/core/app/sheetStatus/ranges.ts"),g=n("../spread-sheet/src/external/rangeAuth/util/range-auth-error-util.ts"),p=n("../node_modules/@tencent/dui/lib/components/Modal/index.js"),v=n("../spread-sheet/src/external/rangeAuth/util/range-auth-report-util.ts"),f=n("../spread-sheet/src/external/rangeAuth/util/range-auth-request-util.ts"),m=n("../spread-sheet/src/external/rangeAuth/loader/RangeAuthManager.ts"),A=n("../spread-sheet/src/core/data/configService/spreadConfig.ts");function R(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js");var _=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},I=function(){function e(e){this.isReportOverLap=!1,this.app=e}var t=e.prototype;return t.checkOverLap=function(){return _(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.isReportOverLap){e.next=3;break}return e.abrupt("return");case 3:if(0!==(t=this.getCurrentSheetRangeIds()).length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,(0,f.ng)(t);case 8:n=e.sent,r=n.data.protectedRangeList,a=[],r.forEach((function(e){a.push({rangeId:e.rangeId,rangePolicy:e.rangePolicy})})),this.checkRangesIfOverlap(a),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.warn(e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])})))},t.checkRangesIfOverlap=function(e){for(var t,n,r=(0,l.getProtectedMap)();e.length>0;){for(var a=e[0],i=a.rangeId,o=a.rangePolicy,s=null===(t=r.get(i))||void 0===t?void 0:t.range,u=1;u<e.length;u++){var c=e[u],d=c.rangeId,h=c.rangePolicy,g=null===(n=r.get(d))||void 0===n?void 0:n.range;if((null===s||void 0===s?void 0:s.isCross(g))&&o!==h)return(0,v.u1)(),void(this.isReportOverLap=!0)}e.splice(0,1)}},t.getCurrentSheetRangeIds=function(){for(var e,t=[],n=(0,l.getProtectedMap)(),r=this.app.spreadsheet.activeSheetId,a=R(n.entries());!(e=a()).done;){var i=e.value,o=i[0];i[1].range.sheetId===r&&t.push(o)}return t},e}();function S(e,t,n,r,a){t.isSheet&&e.setSheetsStatus(t.sheetId,r,a),e.addRangeAuthAndCache(n,t.clone(),r)}var w=n("../spread-sheet/src/external/rangeAuth/logic/check-user-auth.ts"),C=n("../spread-sheet/src/external/rangeAuth/constants/range-auth-event.ts"),b=n("../spread-sheet/src/external/rangeAuth/util/check-sheet-status-utils.ts"),y=n("../packages/report/src/index.ts"),N=n("../node_modules/@tencent/ioc/lib/esm/index.js"),T=n("../spread-sheet/src/external/view/ui-layer/range-auth/components/range-auth-drawer.tsx"),k=n("../spread-sheet/src/core/app/sheetStatus/auth-range.ts");function x(e,t){void 0===t&&(t=e.spreadsheet.activeSheetId),(0,k.ft)(e.spreadsheet.activeSheet)&&(e.view.canvas.init(t),e.view.canvas.renderApi.renderNextTick())}var j=n("../spread-sheet/src/core/view/level-2/collab-center-ent/utils.ts"),O=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},P=function(){function e(e){var t=this;this.initEvent=function(){c.Z.event.rangeAuthEvent.listen(C.k.PROTECT_RANGE,t.protectRange),c.Z.event.rangeAuthEvent.listen(C.k.PROTECT_SHEET,t.protectSheet),c.Z.event.rangeAuthEvent.listen(C.k.CHECK_ALL_RANGE_AUTH,t.checkAllRangeAuth),c.Z.event.rangeAuthEvent.listen(C.k.SHOW_EXIT_RANGE_SELECTOR,t.showExitRangeSelector),c.Z.event.rangeAuthEvent.listen(C.k.SHOW_RANGE_AUTH,t.showRangeAuth),c.Z.event.rangeAuthEvent.listen(C.k.HIDE_RANGE_AUTH,t.hideRangeAuth),c.Z.event.rangeAuthEvent.listen(C.k.SWITCH_SHEET_AND_CHANGE_RANGED_ID,t.switchSheetAndChangeRangeId),c.Z.event.rangeAuthEvent.listen(h.wL.EVENT.SET_OVERLAP_STATUS,t.reportOverlapStatus),t.app.emitter.on(t.app.EVENT.PAGE_LOAD_FINISHED,t.initSheetRangeAuthStatus)},this.protectRange=function(e){return O(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,l.isRangeCountExceedMaxValue)()){t.next=2;break}return t.abrupt("return");case 2:return n=(0,l.getNewRangeId)(),r=(0,l.parseSelectDataForRangeAuth)(),a=r.gridRange,t.next=6,this.getRangeAuthPanel();case 6:t.sent.selector.show({isNewRangeId:!0,gridRange:a.clone()},n),(0,v.Ye)(e,a),y.ZP.kvrOss({itemname:"xls_rangeprotect_range_newrule_click"});case 9:case"end":return t.stop()}}),t,this)})))},this.protectSheet=function(e){return O(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.app.spreadsheet.activeSheetId,this.app.spreadsheet.isExternalSheet()?(0,v.ub)():(0,v.Ye)(e,new o.Z(n)),!(0,l.isRangeCountExceedMaxValue)()){t.next=4;break}return t.abrupt("return");case 4:if(!(0,l.getExistSheetRangeIdItem)(n)){t.next=8;break}return p.default.confirm({title:i.ZP.t("保护工作表提示"),content:i.ZP.t("此工作表已被保护。"),cancelText:null}),t.abrupt("return");case 8:return r=(0,l.getNewRangeId)(),t.next=11,this.getRangeAuthPanel();case 11:t.sent.selector.show({isNewRangeId:!0,gridRange:new o.Z(n)},r),y.ZP.kvrOss({itemname:"xls_rangeprotect_sheet_protect"});case 13:case"end":return t.stop()}}),t,this)})))},this.checkAllRangeAuth=function(e,n){return O(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(0,v.mr)(e),N.Am.get(T.Z).openDrawer({highlightRangeId:n});case 3:case"end":return t.stop()}}),t)})))},this.showExitRangeSelector=function(e){return O(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(0,b.x)(e,this.app.spreadsheet),this.checkIsFindRangeIdInProtectMap(e)&&!n){t.next=4;break}return t.abrupt("return");case 4:if(r=(0,l.getGridRangeByRangeId)(e),a=r.sheetId,i=r.isSheet,o=this.app.spreadsheet.activeSheetId,a===o){t.next=11;break}return this.switchRangeId=e,c.Z.event.sheetsBar.trigger("switchSheet",a,this.app.spreadsheet.activeSheetId),t.abrupt("return");case 11:return t.next=13,this.getRangeAuthPanel();case 13:t.sent.selector.show({isNewRangeId:!1,gridRange:r},e),i?y.ZP.kvrOss({itemname:"xls_rangeprotect_sheet_edit"}):y.ZP.kvrOss({itemname:"xls_rangeprotect_range_edit"});case 15:case"end":return t.stop()}}),t,this)})))},this.switchSheetAndChangeRangeId=function(e,n){t.switchRangeId=n,c.Z.event.sheetsBar.trigger("switchSheet",e,t.app.spreadsheet.activeSheetId)},this.handleSwitchSheetEnd=function(){return O(t,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.app.sheetStatus.tempStatus.status.isHistory){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.initSheetRangeAuthStatus();case 4:return e.next=6,this.checkIfNeedToggleRangeAuth();case 6:case"end":return e.stop()}}),e,this)})))},this.initSheetRangeAuthStatus=function(){return O(t,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isOwner){e.next=4;break}return this.initOwnerRangeAuth(),c.Z.event.rangeAuthEvent.trigger(C.k.AUTH_INITED),e.abrupt("return");case 4:if(!A.q.getConfig("isLogin")){e.next=8;break}return e.next=8,this.initCooperationRangeAuth();case 8:c.Z.event.rangeAuthEvent.trigger(C.k.AUTH_INITED);case 9:case"end":return e.stop()}}),e,this)})))},this.showRangeAuth=function(){t.checkAllRangeAuth("oldversion")},this.hideRangeAuth=function(){N.Am.get(T.Z).closeDrawer()},this.checkIfNeedToggleRangeAuth=function(){return O(t,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isOwner&&this.switchRangeId){e.next=2;break}return e.abrupt("return");case 2:return t=(0,l.getGridRangeByRangeId)(this.switchRangeId),e.next=5,this.getRangeAuthPanel();case 5:e.sent.selector.show({isNewRangeId:!1,gridRange:t},this.switchRangeId),this.switchRangeId="";case 7:case"end":return e.stop()}}),e,this)})))},this.reportFirstOpen=function(){t.isFirstOpenReportAlready||(0,l.getProtectedMap)()&&(0,l.getProtectedMap)().size>0&&(t.isFirstOpenReportAlready=!0,(0,v._f)(c.Z.window.clientVars.padId,c.Z.window.clientVars.padTitle),t.isOwner||(0,v.dx)())},this.initCooperationRangeAuthWithRangeIds=function(e,n){return O(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.app.permissions.setRangeStatusCanEdit(!1),this.app.permissions.setRangeStatusCanRead(!1),this.hasRangeAuth=!0,r=[].concat((0,u.Z)(e),(0,u.Z)(n)).filter((function(e){return!!e})),t.next=6,this.requestCooperationRangeAuthWithRangeIds(r);case 6:this.isInitComplete=!0,c.Z.event.rangeAuthEvent.trigger(C.k.COOPERATION_INITED),x(this.app);case 9:case"end":return t.stop()}}),t,this)})))},this.requestCooperationRangeAuthWithRangeIds=function(e){return O(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.d.instance.getUserRangePrivilege(e).then((function(e){r.handleGetUserRangeAuthSuccess(e)})).catch((function(e){var t;null===(t=n.g.log)||void 0===t||t.error("rangeAuthPluginBase.initCooperationRangeAuth",null===e||void 0===e?void 0:e.stack),(0,g.J3)(i.ZP.t("初始化"+j.PJ+"权限失败，请刷新～"))}));case 2:case"end":return t.stop()}}),t)})))},this.handleGetUserRangeAuthSuccess=function(e){var n,r=t.app.spreadsheet.activeSheetId,a=t.app.spreadsheet.workbookRangeManager.protectedRangeMap,s=(null===(n=e.data)||void 0===n?void 0:n.rangeCheckResList)?e.data.rangeCheckResList:[];if(0===s.length){if(l.isWedocUpgradedSheet())return;t.app.permissions.setSheetsStatus(r,h.BP.CAN_NOT_VIEW,r)}else s.forEach((function(e){var n=e.rangeId,s=e.rangePolicy,u=e.rangePrivilege,c=e.rangeOtherPrivilegeType;if(0!==s){var d=(0,w.f)(s,u),p=(0,w.O)(s,u,c),v=d?h.BP.EDITABLE:p?h.BP.READ_ONLY:h.BP.CAN_NOT_VIEW,f=function(e,t){var n,r,a=t.get(e);return{isSheetRangeId:null!==(n=null===a||void 0===a?void 0:a.range.isSheet)&&void 0!==n&&n,sheetId:null!==(r=null===a||void 0===a?void 0:a.range.sheetId)&&void 0!==r?r:""}}(n,a),m=f.isSheetRangeId,A=f.sheetId;m&&t.app.permissions.setSheetsStatus(A,v,r);var R=(0,l.getProtectedMap)().get(n),E=R?R.range:new o.Z(r);t.app.permissions.addRangeAuthAndCache(n,E,v)}else!l.isWedocUpgradedSheet()&&(0,g.J3)(i.ZP.t("文档保护范围已失效，请提醒管理员重新设置～"))}))},this.app=e,this.hasRangeAuth=!1,this.isFirstOpenReportAlready=!1,this.rangeAuthUtil=l,this.dataApi=d,this.isInitComplete=!1,this.checkOverLapLogic=new I(this.app)}var t=e.prototype;return t.initDefault=function(){this.isOwner=!!A.q.getConfig("isOwner"),this.initEvent(),this.reportFirstOpen(),this.initOwnerNick(),this.initRangeAuthManager()},t.initRangeAuthManager=function(){new m.d(this.app)},t.initOwnerNick=function(){this.isOwner||(0,f.r2)()},t.reportOverlapStatus=function(){(0,v.u1)()},t.checkIsFindRangeIdInProtectMap=function(e){var t=(0,l.getProtectedMap)();return!!(null===t||void 0===t?void 0:t.get(e))},t.initOwnerRangeAuth=function(){var e=this,t=this.app.spreadsheet.activeSheetId;this.app.permissions.resetRangeStatusBySheetId(t),(0,l.getProtectedMap)().forEach((function(n,r){S(e.app.permissions,n.range,r,h.BP.EDITABLE,t)})),this.isInitComplete=!0},t.initCooperationRangeAuth=function(e){return O(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e||this.app.spreadsheet.activeSheetId,r=this.app.spreadsheet.workbookRangeManager.protectedRangeMap,this.resetCurrentSheetRangeAuthStatus(n),a=(0,l.getCurrentSheetRangeIdsAndAllSheetRangeIds)(n,r),i=a.currentSheetRangeIds,o=a.allSheetRangeIds,s=l.getRangeIdsBySheetId(n),u=s.rangeIds,!(s.sheetRangeId||u.length>0||o.length>0)){t.next=11;break}return t.next=9,this.initCooperationRangeAuthWithRangeIds(i,o);case 9:t.next=12;break;case 11:this.isInitComplete=!0;case 12:case"end":return t.stop()}}),t,this)})))},t.getRangeAuthPanel=function(){return O(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.app.view.getRangeAuthPanel());case 1:case"end":return e.stop()}}),e,this)})))},t.resetCurrentSheetRangeAuthStatus=function(e){this.app.permissions.resetRangeStatusBySheetId(e),this.app.permissions.resetSheetsStatus(e)},e}();P.EVENT={PROTECT_RANGE:"protectRange",PROTECT_SHEET:"protectSheet",CHECK_ALL_RANGE_AUTH:"checkAllRangeAuth",SHOW_EXIT_RANGE_SELECTOR:"showExitRangeSelector",SHOW_RANGE_AUTH:"showRangeAuth",HIDE_RANGE_AUTH:"hideRangeAuth",SWITCH_SHEET_AND_CHANGE_RANGED_ID:"switchSheetAndChangeRangedId",ADD_NEW_RANGE_AUTH:"addNewRangeAuth",DIMENSION_CHANGE:"dimensionChange",DELETE_RANGE_AUTH:"deleteRangeAuth",UPDATE_RANGE_AUTH:"updateRangeAuth",COOERATION_ADD_NEW_RANGE_DONE:"cooperationAddNewRangeDone",RANGE_AUTH_CHANGE:"rangeAuthChange",COOPERATION_INITED:"cooperation_inited",OWNER_INITED:"ownerInited",AUTH_INITED:"authInited",SHOW_RANGE_AUTH_SELECT_AREA:"showRangeAuthSelectArea"};var M=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),D=n("react"),Z=n("react-dom"),H=n("../node_modules/@tencent/dui/lib/components/Tooltip/index.js"),U=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),L=n.n(U),B=n("../node_modules/@tencent/dui-mobile/lib/components/Snackbar/index.js"),G=n("../spread-sheet/src/base/event/eventName.ts"),W=function(e){function t(t){var n;return(n=e.call(this,t)||this).initEvent=function(){var e=n.app.view.canvas;c.Z.event.rangeAuthEvent.listen(C.J.SHOW_RANGE_AUTH_ICO,n.show),c.Z.event.rangeAuthEvent.listen(C.J.HIDE_RANGE_AUTH_ICO,n.hide),c.Z.event.sheetsBar.listen("rangeAuthListenSwitchSheetEnd",n.hide),L().isPC&&(e.wheelOperate.onScroll(n.hide),e.scrollBar.emitter.on("scroll",n.hide)),L().isMobile&&e.areaData.onUpdateOffset(n.hide),e.scale.onScale(n.hide)},n.show=function(e,t,r){void 0===r&&(r=!0),n.icoPosition=e,n.isOwner=t;var a=n.app.view.canvas.normalSelectData.selectQueue[0]||{};if(!(a.selectRow||a.selectCol||a.selectAll)){var i=new o.Z(n.app.spreadsheet.activeSheetId,e.row,e.row,e.col,e.col),s=(0,l.getRangeIdByGridRange)(i),u=n.getPositionByRowColIndex(e.row,e.col),c=u.x,d=u.y;n.setState({x:c,y:d,rangeId:t?s:"",show:!0}),n.state.isInMobile?n.getIcoTextForMobile(s,t,r):n.getIcoTextForPc(s,t,r)}},n.hide=function(){var e;null===(e=n.toolTipRef)||void 0===e||e.hide(),n.setState({show:!1})},n.jumpToAuth=function(){n.canJumpToAuth&&c.Z.event.rangeAuthEvent.trigger(C.k.SHOW_RANGE_AUTH_SELECT_AREA,n.app.spreadsheet.activeSheetId,n.state.rangeId)},n.handleContainerClick=function(e){e.preventDefault(),e.stopPropagation(),n.state.isInMobile&&B.default.show({type:"info",message:n.state.headerStr,autoClose:!0,style:{zIndex:10004}})},n.reportClickToolTip=function(e){e&&(0,v.II)()},n.app=t.app,n.state={headerStr:"",bodyStr:"",rangeId:"",x:0,y:0,show:!1,isInMobile:L().isMobile||L().isIPad||L().isAndroidPad},n}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){c.Z.event.init.listen(G.W1.AFTER_ALL_RENDER,this.initEvent)},n.getIcoTextForMobile=function(e,t,n){t&&e?this.setState({headerStr:i.ZP.t("已保护此范围，请到电脑端设置")}):this.setState({headerStr:n?i.ZP.t("此范围受保护，你没有编辑权限。"):i.ZP.t("此范围受保护，你没有查看权限。")})},n.getIcoTextForPc=function(e,t,n){t&&e?this.setState({bodyStr:i.ZP.t("点击进入权限管理"),headerStr:i.ZP.t("已保护此范围")}):this.setState({headerStr:i.ZP.t("此范围受保护"),bodyStr:n?i.ZP.t("暂无编辑权限"):i.ZP.t("暂无查看权限")})},n.getPositionByRowColIndex=function(e,t){var n=this.app.view.canvas,r=n.areaData,a=n.headSize,i={x:0,y:0};return i.x=r.getDisplayViewRightByCol(t)+a.displayRowHeadWidth,i.y=r.getDisplayViewTopByRow(e)+a.displayColHeadHeight,i},n.getToolTipContent=function(){return D.createElement("div",{className:"range-auth-container_tips"},D.createElement("div",{className:"range-auth-container_tips_header"},this.state.headerStr),D.createElement("div",{className:"range-auth-container_tips_body "+(this.canJumpToAuth?"range-auth-container_tips_body-jump":""),onClick:this.jumpToAuth.bind(this)},this.state.bodyStr))},n.render=function(){var e=this,t=this.state.x-18-2,n=this.state.y+2;return D.createElement("div",{className:"range-auth-container "+(this.state.show?"range-auth-container-show":""),style:{left:t,top:n},onClick:this.handleContainerClick.bind(this)},this.state.isInMobile?D.createElement("div",{className:"range-auth-container_ico"}):D.createElement(H.default,{title:this.getToolTipContent(),placement:"bottom",ref:function(t){e.toolTipRef=t},onVisibleChange:this.reportClickToolTip,trigger:"click"},D.createElement("div",{className:"range-auth-container_ico"})))},(0,M.Z)(t,[{key:"canJumpToAuth",get:function(){return this.state.rangeId&&!this.state.isInMobile}}]),t}(D.Component);n("../spread-sheet/src/base/util/domain-config.ts");var q=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},V=function(e){function t(t){var a;return(a=e.call(this,t)||this).handleAfterAllRender=function(){a.isOwner&&a.renderAuthRangeArea(!0)},a.getActiveCellRange=function(e,t,n){var r=a.app.spreadsheet.activeSheet.getCellDataAtPosition(t,n),i=null===r||void 0===r?void 0:r.getMergeReference(),s=null!==i&&void 0!==i;return{activeCellRange:s?null!==i&&void 0!==i?i.clone():new o.Z(e):new o.Z(e,t,t,n,n),isInMergeCell:s}},a.handleSelectData=function(){a.checkSelectionRangeStatus()},a.renderAuthRangeArea=function(e){var t=a.app.view.canvas.rangeAuthRenderPlugin;e?t.enableRangeAuthRender(a.isOwner?h.BP.EDITABLE:h.BP.READ_ONLY):t.cancelRangeAuthRender()},a.showAuthIco=function(e,t){void 0===e&&(e={row:-1,col:-1}),void 0===t&&(t=!0),a.isRangeAuthIcoShow=!0,c.Z.event.rangeAuthEvent.trigger(C.J.SHOW_RANGE_AUTH_ICO,e,a.isOwner,t)},a.hideAuthIco=function(){a.isRangeAuthIcoShow&&(a.isRangeAuthIcoShow=!1,c.Z.event.rangeAuthEvent.trigger(C.J.HIDE_RANGE_AUTH_ICO))},a.handleAddNewRangeAuth=function(e){if(e.sType!==s.Z.PREVIEW&&a.isInitComplete){var t=e.rangeId;if(t){var n=a.app.spreadsheet.activeSheetId,r=(0,l.getProtectedMap)().get(t),i=r?r.range.clone():new o.Z(n);if(a.isOwner)return S(a.app.permissions,i,t,h.BP.EDITABLE,n),void a.app.view.canvas.renderApi.renderNextTick();a.cooperationHandleAddNewRangeAuth(t)}}},a.cooperationHandleAddNewRangeAuth=function(e){return q((0,r.Z)(a),void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.requestCooperationRangeAuthWithRangeIds([e]).catch((function(e){var t;null===(t=n.g.log)||void 0===t||t.error("rangeAuthPlugin.handleAddNewRangeAuth",null===e||void 0===e?void 0:e.stack),(0,g.J3)(i.ZP.t("添加保护区域失败，请刷新～"))}));case 2:this.app.view.canvas.renderApi.renderNextTick(),c.Z.event.rangeAuthEvent.trigger(C.k.COOERATION_ADD_NEW_RANGE_DONE);case 4:case"end":return t.stop()}}),t,this)})))},a.handleDimensionChange=function(e){e.sType!==s.Z.PREVIEW&&a.refreshRangeAuthCacheBySheetIdWithCheck(e,!1)},a.handleDeleteRangeAuth=function(e){if(e.sType!==s.Z.PREVIEW){m.d.instance.deleteRangeAuth(e);var t=a.app.sheetStatus.rangesStatus.getCacheGridRangeByRangeId(e.rangeId),n=void 0===t?"":t.sheetId;(null===t||void 0===t?void 0:t.isSheet)&&a.app.permissions.resetSheetsStatus(n),a.refreshRangeAuthCacheBySheetIdWithCheck({sheetId:n,rangeId:e.rangeId},!0)}},a.handleUpdateRangeAuth=function(e){e.sType!==s.Z.PREVIEW&&a.refreshRangeAuthCacheBySheetIdWithCheck(e,!0)},a.refreshRangeAuthCacheBySheetIdWithCheck=function(e,t){var n=a.app.spreadsheet.activeSheetId;if(a.isInitComplete){var r=e.sheetId;r===n&&a.refreshRangeAuthCacheBySheetId(r,t)}},a.handleShowRangeAuthSelectArea=function(e,t){if(e===a.app.spreadsheet.activeSheetId){var n=(0,l.getProtectedMap)().get(t);if(n){var r=n.range,i=r.startRowIndex,o=r.endRowIndex,s=r.startColIndex,u=r.endColIndex;r.isValid(a.app.spreadsheet.activeSheet.getRowCount(),a.app.spreadsheet.activeSheet.getColCount())&&(r.isSheet||(r.isCol?a.app.view.canvas.selectApi.selectCols(a.app.view.canvas.normalSelectData,[s,u],null):r.isRow?a.app.view.canvas.selectApi.selectRows(a.app.view.canvas.normalSelectData,[i,o],null):a.app.view.canvas.selectApi.selectCells(a.app.view.canvas.normalSelectData,{xRange:[r.startColIndex,r.endColIndex],yRange:[r.startRowIndex,r.endRowIndex]},null)))}}},a.handleRangeAuthChange=function(e){var t;if(!a.isOwner){var r={};try{r=e.body.notice.payload.rangeAction||{}}catch(c){null===(t=n.g.log)||void 0===t||t.error("rangeAuthPlugin.rangeAction",null===c||void 0===c?void 0:c.stack),(0,g.J3)(i.ZP.t("更新区域权限失败，请刷新～"))}var o=r.rangeIdList,s=a.app.spreadsheet.activeSheetId,u=o.filter((function(e){var t=(0,l.getProtectedMap)().get(e);return!!t&&t.range.sheetId===s}));0!==u.length&&m.d.instance.getUserRangePrivilege(u).then((function(e){var t;((null===(t=e.data)||void 0===t?void 0:t.rangeCheckResList)?e.data.rangeCheckResList:[]).forEach((function(e){var t=e.rangeId,n=e.rangePolicy,r=e.rangePrivilege,i=e.rangeOtherPrivilegeType,o=(0,w.f)(n,r),u=(0,w.O)(n,r,i),c=o?h.BP.EDITABLE:u?h.BP.READ_ONLY:h.BP.CAN_NOT_VIEW,l=a.isOwner?h.BP.EDITABLE:c;a.app.permissions.updateRangeAuthCacheStatus(t,s,l)})),a.refreshRangeAuthCacheBySheetId(s,!0)})).catch((function(e){var t;null===(t=n.g.log)||void 0===t||t.error("rangeAuthPlugin.handleRangeAuthChange",null===e||void 0===e?void 0:e.stack),(0,g.J3)(i.ZP.t("区域权限信息同步出错，请刷新"))}))}},a.refreshRangeAuthCacheWithFilter=function(e,t){var n={};Object.entries(t).forEach((function(e){var t=e[0],r=e[1],i=r.gridRange,o=r.rangeStatus,s=a.app,u=s.permissions,c=s.spreadsheet;i.isSheet&&u.setSheetsStatus(i.sheetId,o,c.activeSheetId),n[t]={rangeStatus:o,gridRange:i.clone()}})),a.app.permissions.refreshRangeAuthCache(e,n)},a.isRangeAuthIcoShow=!1,function(e){var t=document.createElement("div");t.className="range-auth-mount",c.Z.window.document.querySelector(".excel-container").appendChild(t),Z.render(D.createElement(W,{app:e}),t)}(t),a}(0,a.Z)(t,e);var u=t.prototype;return u.initDefault=function(){e.prototype.initDefault.call(this),this.initCommonEvent()},u.initCommonEvent=function(){c.Z.event.rangeAuthEvent.listen(C.k.ADD_NEW_RANGE_AUTH,this.handleAddNewRangeAuth),c.Z.event.rangeAuthEvent.listen(C.k.DIMENSION_CHANGE,this.handleDimensionChange),c.Z.event.rangeAuthEvent.listen(C.k.DELETE_RANGE_AUTH,this.handleDeleteRangeAuth),c.Z.event.rangeAuthEvent.listen(C.k.UPDATE_RANGE_AUTH,this.handleUpdateRangeAuth),c.Z.event.rangeAuthEvent.listen(C.k.RANGE_AUTH_CHANGE,this.handleRangeAuthChange),c.Z.event.rangeAuthEvent.listen(C.k.COOPERATION_INITED,this.handleSelectData),c.Z.event.rangeAuthEvent.listen(C.k.SHOW_RANGE_AUTH_SELECT_AREA,this.handleShowRangeAuthSelectArea),c.Z.event.init.listen(G.W1.AFTER_ALL_RENDER,this.handleAfterAllRender)},u.checkNeedShowIco=function(e,t){var n=t.rowIndex,r=t.colIndex,a=this.getActiveCellRange(e,n,r),i=a.activeCellRange,o=a.isInMergeCell,s=this.app.sheetStatus.getRangeCanEdit(i),u=this.app.sheetStatus.getRangeCanRead(i),c=this.app.sheetStatus.getActiveSheetStatus(),l=void 0===c||c.canEdit,d=this.app.sheetStatus.workbookStatus.canEdit,h=this.app.sheetStatus.tempStatus.status.activate||this.app.sheetStatus.shutDownStatus.status.activate,g=!s&&l&&d&&!h,p=!this.isOwner&&g,v=o?i.startRowIndex:n,f=o?i.endColIndex:r;p?this.showAuthIco({row:v,col:f},u):this.hideAuthIco()},u.checkSelectionRangeStatus=function(){var e=this,t=this.app.view.getSelection(),n=t.activeCell,r=n.rowIndex,a=n.colIndex,i=n.sheetId;if(this.checkNeedShowIco(i,{rowIndex:r,colIndex:a}),!this.isOwner&&this.app.sheetStatus.canEditExceptRangeStatus){var o=t.rangeSelections,s=-1===o.findIndex((function(t){return!e.app.sheetStatus.getRangeCanEdit(t)})),u=-1===o.findIndex((function(t){return!e.app.sheetStatus.getRangeCanRead(t)}));this.renderAuthRangeArea(!s),this.app.permissions.setRangeStatusCanEdit(s),this.app.permissions.setRangeStatusCanRead(u)}},u.refreshRangeAuthCacheBySheetId=function(e,t){var n=this,r={};(0,l.getProtectedMap)().forEach((function(t,a){var i=n.app.sheetStatus.rangesStatus.getRangeAuthCacheItem(e);t.range.sheetId===e&&i[a]&&(r[a]={rangeStatus:n.isOwner?h.BP.EDITABLE:i[a].rangeStatus,gridRange:t.range.clone()})})),this.refreshRangeAuthCacheWithFilter(e,r),this.checkSelectionRangeStatus(),t&&x(this.app,e)},t}(P)},"../spread-sheet/src/external/view/mobile/toolbar/native-toolbar/index.ts":function(e,t,n){n.d(t,{ZP:function(){return s},fG:function(){return o},KK:function(){return i}});var r=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../spread-sheet/src/external/view/native/native-toolbar/utils.ts")),i=function(){return(0,a.KK)()};function o(){return(0,a.fG)()}var s=new(function(){function e(){var e=this;this.callbackMap={},this.toolbarHeight=0,this.panelHeight=0,this.keyboardHeight=0,this.taskStack=[],this.initNativeToolbar=function(t){e.toolbarConfig=t,e.allPanelConfig&&e.initClientConfig()},this.updateNativeToolbar=function(t){e.appendToTaskStack("updateNativeToolbar",(function(){n.g.mqq.invoke("docx","updateToolbarConfig",{toolbar:e.convertConfigAndExtractCallback(t),key:e.uniqueKey},null)}))},this.initNativePanel=function(t){e.allPanelConfig=t,e.toolbarConfig&&e.initClientConfig()},this.updateNativePanel=function(t){e.appendToTaskStack("updateNativePanel",(function(){n.g.mqq.invoke("docx","updateStylePanelConfig",Object.assign(Object.assign({},e.convertConfigAndExtractCallback(t)),{key:e.uniqueKey}),null)}))},this.showNativeToolbar=function(){e.setNativeToolbarVisible(!0)},this.hideNativeToolbar=function(){e.setNativeToolbarVisible(!1)},this.showNativePanel=function(t){e.setNativePanelVisible(!0,t)},this.hideNativePanel=function(t){e.setNativePanelVisible(!1,t)},this.getHeightInfo=function(){return{toolbar:e.toolbarHeight,panel:e.panelHeight,keyboard:e.keyboardHeight}},this.initClientConfig=function(){e.appendToTaskStack("initClientConfig",(function(){n.g.mqq.invoke("docx","initToolbarConfig",{toolbar:e.convertConfigAndExtractCallback(e.toolbarConfig),stylepanel:e.convertConfigAndExtractCallback(e.allPanelConfig),key:e.uniqueKey},null)}))},this.setNativeToolbarVisible=function(t){e.appendToTaskStack("setNativeToolbarVisible",(function(){n.g.mqq.invoke("docx","setNativeToolbarShow",{show:t,key:e.uniqueKey},null)}))},this.setNativePanelVisible=function(t,r){e.appendToTaskStack("setNativePanelVisible",(function(){n.g.mqq.invoke("docx","setNativePanelShow",{show:t,name:r,key:e.uniqueKey},null)}))},this.bindEvents()}var t=e.prototype;return t.bindEvents=function(){var e=this;(0,a.M4)()||(window.toolbarClick=function(t,n){var r,a,i=t+"-onClick";null===(a=(r=e.callbackMap)[i])||void 0===a||a.call(r,new Event("click"),n)},window.toolbarHeightChange=function(t){e.toolbarHeight=t.toolbar,e.panelHeight=t.stylepanel,e.keyboardHeight=t.keyboard})},t.appendToTaskStack=function(e,t){var n=this;this.taskStack.length||setTimeout((function(){n.runTaskStack()}),0),this.taskStack.push({type:e,exec:t})},t.runTaskStack=function(){if(this.taskStack.length){for(var e={},t=[],n=this.taskStack.length-1;n>=0;n--){var r=this.taskStack[n];e[r.type]||(t.unshift(r.exec),e[r.type]=!0)}t.forEach((function(e){e()})),this.taskStack=[]}},t.convertConfigAndExtractCallback=function(e){var t=this;return function e(n){if("object"===typeof n){if(!n)return n;var r="[object Array]"===Object.prototype.toString.call(n)?[]:{};return Object.keys(n).forEach((function(a){"function"===typeof n[a]?t.callbackMap[n.name+"-"+a]=n[a]:r[a]=e(n[a])})),r}return n}(e)},(0,r.Z)(e,[{key:"uniqueKey",get:function(){return function(){var e=window.location.href.match("/sheet/([a-zA-Z0-9]*).*"),t="sheet";return e&&(t=e[1]),t}()}}]),e}())},"../spread-sheet/src/external/view/native/native-toolbar/utils.ts":function(e,t,n){n.d(t,{KK:function(){return o},M4:function(){return s},Rx:function(){return d},fG:function(){return c},w2:function(){return u}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.object.entries.js");var r=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),a=n.n(r),i=null,o=function(){return null===i&&(i=location.href.indexOf("nativetoolbar")>-1||!!(a().isTencentDocsApp&&window.mqq&&(a().isAndroid&&a().isTencentDocsAppVersionAboveOrEqual("2.1.8")||(a().isIOS||a().isIPad)&&a().isTencentDocsAppVersionAboveOrEqual("2.1.8")))),i};function s(){if(!o())return!1;var e=navigator.userAgent.match(/TencentDocs\/(\S*)/),t="0";return e&&e.length>1&&(t=-1!==e[1].indexOf(".tencentdocs")?e[1].split(".tencentdocs")[0]:e[1]),t>="99.99.99"}function u(){var e=window.location.href.match("/sheet/([a-zA-Z0-9]*).*"),t="sheet";return e&&(t=e[1]),t}function c(){return!!(a().isTencentDocsApp&&window.mqq&&(a().isAndroid&&a().isTencentDocsAppVersionAboveOrEqual("2.2.4")||(a().isIOS||a().isIPad)&&a().isTencentDocsAppVersionAboveOrEqual("2.2.4")))}var l=new Map(Object.entries({"quick-fill":"quick-fill-row","font-style":"font-tab","cell-property":"cell-tab",formula:"formula-tab",strikethrough:"strike-through","vertical-align-top":"verticalalign-top","vertical-align-middle":"verticalalign-middle","vertical-align-bottom":"verticalalign-bottom","horizontal-align-left":"align-left","horizontal-align-center":"align-center","horizontal-align-right":"align-right",decimal:"number-digit"}));function d(e){return l.get(e)||e}}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/spread-sheet_src_core_view_level-2_mention_api_MentionApi_ts-spread-sheet_src_external_rangeA-10e443.761010707311a14082cc.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=spread-sheet_src_core_view_level-2_mention_api_MentionApi_ts-spread-sheet_src_external_rangeA-10e443.761010707311a14082cc.js.map