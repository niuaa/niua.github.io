self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["bundle_view_level2_readyonly_lazy_module1","bundle_panel_ErrorTipPanel_pc"],{"../spread-sheet/src/base/util/html.ts":function(e,t,a){function n(e,t,a,n){return e.addEventListener?e.addEventListener(t,a,n):e.attachEvent&&e.attachEvent("on"+t,(function(){a(window.event)})),e}function r(e,t,a,n){e.removeEventListener?e.removeEventListener(t,a,n):e.detachEvent&&e.detachEvent("on"+t,(function(){a(window.event)}))}function s(e,t){e&&e.classList.add(t)}function o(e,t){e&&e.classList.remove(t)}a.d(t,{GM:function(){return l},IV:function(){return o},cn:function(){return s},vP:function(){return n},xC:function(){return r}}),a("../node_modules/core-js/modules/es.regexp.exec.js"),a("../node_modules/core-js/modules/es.string.replace.js"),a("../node_modules/core-js/modules/es.array.concat.js"),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.object.keys.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.array.slice.js"),a("../packages/common-utils/src/index.ts");var i={CSS:{Sequence:function(){var e=/\\((([\dA-F]{2}|[\dA-F]{1,5})\s)|([\dA-F]{6}|[\dA-F]{4}))/gim;return e.unescape=function(e){var t=window,a=t.String.fromCharCode,n=t.parseInt;return e.replace(this,(function(e){return a(n(e.slice(2),16))}))},e}()}},l=function(e){return function(e){return e.replace(/(\\.)/g,(function(e){return e.slice(1)})).replace(/(\\[$\-+/():!^&'~{}<>= ])/g,(function(e){return e.slice(1)}))}(i.CSS.Sequence.unescape(e))}},"../spread-sheet/src/base/util/phone-number.ts":function(e,t,a){a.d(t,{AI:function(){return l},E$:function(){return m},Iq:function(){return s},YH:function(){return u},un:function(){return d}}),a("../node_modules/core-js/modules/es.regexp.exec.js"),a("../node_modules/core-js/modules/es.string.split.js"),a("../node_modules/core-js/modules/es.string.replace.js"),a("../node_modules/core-js/modules/es.object.values.js"),a("../node_modules/core-js/modules/es.regexp.constructor.js"),a("../node_modules/core-js/modules/es.regexp.to-string.js"),a("../node_modules/core-js/modules/esnext.global-this.js"),a("../node_modules/core-js/modules/es.number.constructor.js");var n=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),r=a.n(n),s={"ar-DZ":"^(\\+?213|0)(5|6|7)\\d{8}$","ar-SY":"^(!?(\\+?963)|0)9\\d{8}$","ar-SA":"^(!?(\\+?966)|0)5\\d{8}$","en-US":"^(\\+?1)[2-9]\\d{2}[2-9](?!11)\\d{6}$","cs-CZ":"^(\\+?420)[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$","de-DE":"^(\\+?0{0,2}49[\\-]?)([0-9]{10,11})$","da-DK":"^(\\+?45)(\\d{8})$","el-GR":"^(\\+?30)(69\\d{8})$","en-AU":"^(\\+?61|0)4\\d{8}$","en-GB":"^(\\+?44|0)7\\d{9}$","en-HK":"^(\\+?852\\-?)[569]\\d{3}\\-?\\d{4}$","en-IN":"^(\\+?91|0)[789]\\d{9}$","en-NZ":"^(\\+?64|0)2\\d{7,9}$","en-ZA":"^(\\+?27|0)\\d{9}$","en-ZM":"^(\\+?26)09[567]\\d{7}$","es-ES":"^(\\+?34)(6\\d{1}|7[1234])\\d{7}$","fi-FI":"^(\\+?358|0)\\s(4(0|1|2|4|5)?|50)\\s?(\\d\\s?){4,8}\\d$","fr-FR":"^(\\+?33|0)[67]\\d{8}$","he-IL":"^(\\+972|0)([23489]|5[0248]|77)[1-9]\\d{6}","hu-HU":"^(\\+?36)(20|30|70)\\d{7}$","it-IT":"^(\\+?39)\\s?3\\d{2} ?\\d{6,7}$","ja-JP":"^(\\+?81|0)\\d{1,4}[ \\-]?\\d{1,4}[ \\-]?\\d{4}$","ms-MY":"^(\\+?6?01){1}(([145]{1}(\\-|\\s)?\\d{7,8})|([236789]{1}(\\s|\\-)?\\d{7}))$","nb-NO":"^(\\+?47)[49]\\d{7}$","nl-BE":"^(\\+?32|0)4\\d{8}$","nn-NO":"^(\\+?47)[49]\\d{7}$","pl-PL":"^(\\+?48)[5-8]\\d ?\\d{3} ?\\d{2} ?\\d{2}$","pt-BR":"^(\\+?55|0)\\-?[1-9]{2}\\-?[2-9]{1}\\d{3,4}\\-?\\d{4}$","pt-PT":"^(\\+?351)9[1236]\\d{7}$","ru-RU":"^(\\+?7|8)9\\d{9}$","sr-RS":"^(\\+3816|06)[- \\d]{5,9}$","tr-TR":"^(\\+?90|0)5\\d{9}$","vi-VN":"^(\\+?84|0)((1(2([0-9])|6([2-9])|88|99))|(9((?!5)[0-9])))([0-9]{7})$","zh-CN":"^(\\+?0?86\\-?)?((13[0-9])|(14[5-9])|(15([0-3]|[5-9]))|(16[6-7])|(17[1-8])|(18[0-9])|(19[1|3])|(19[5|6])|(19[8|9]))\\d{8}$","zh-TW":"^(\\+?886\\-?|0)9\\d{8}$"},o={"zh-CN":{regExp:"^([\\(（]?\\+?0?0?\\d{2,3}[\\)）]?[- ]?)?([\\(（]?0?\\d{2,3}[\\)）]?[- ]?)?([2-8]\\d{2,3}[- ]?\\d{4})((-|转|,| )(\\d+))?$",getExtIndex:function(e){var t=e.split("-");if(2===t.length&&7===t[0].length&&4===t[1].length)return e.lastIndexOf("-");var a=e.replace(this.regExp,"$4");return a?e.lastIndexOf(a):void 0}}},i=[110,119,120,122,999,112,114,1e4,10010,10011,10060,10086,11185,12300,12310,12315,12319,12333,12345,12348,12358,12365,12365,12366,12369,12395,12395,12591,16300,17900,17901,17908,17909,17910,17911,17920,17921,17931,17950,17951,17970,17971,17979,17987,17990,17991,17999,95033,95105,95116,95118,95119,95120,95160,95168,95169,95188,95384,95500,95501,95511,95512,95516,95518,95519,95522,95533,95555,95558,95559,95561,95566,95567,95568,95577,95588,95595,95598,95599,95766,95777,95803,95805,95806,95808,95809,95810,95811,95812,95813,95815,95816,95828,95829,95838,95839,95858,95859,95877,95880,5888,95900,95901,95911,95936,95937,95938,95939,95950,95951,95958,95963,95968,95993,96e3,96001,96002,96003,96005,96008,96010,96011,96014,96015,96096,96100,96101,96105,96110,96111,96112,96113,96118,96119,96120,96121,96126,96128,96129,96157,96158,96166,96168,96169,96177,96178,96179,96181,96188,96190,96191,96196,96197,96199,96300];function l(e,t){for(var a={isValid:!1,regExp:null,getExtIndex:null},n=String(e).replace(/((\s)|(-))/g,""),r=[c,h,p],s=0,o=r.length;s<o;s++){var i=0===s?n:e,l=r[s](String(i),t);if(l.isValid){a=l;break}}return a}function c(e,t){for(var a=t?[s[t]]:Object.values(s),n=0;n<a.length;n++){var r=new RegExp(a[n]);if(r.test(String(e)))return{isValid:!0,regExp:r,getExtIndex:null}}return{isValid:!1,getExtIndex:null,regExp:null}}function h(e,t){for(var a=t?[o[t]]:Object.values(o),n=0;n<a.length;n++){var r=new RegExp(a[n].regExp);if(r.test(String(e)))return{isValid:!0,getExtIndex:a[n].getExtIndex,regExp:r}}return{isValid:!1,getExtIndex:null,regExp:null}}function d(e){var t,n=String(e),r=l(n);if(!r.isValid)return null===a.g||void 0===a.g||a.g.log.error("不合法的号码: "+n),n;var s=null===(t=r.getExtIndex)||void 0===t?void 0:t.call(r,n);return void 0!==s&&r.regExp?String(e).substring(0,s)+","+String(e).substring(s+1):e}function u(e){var t;if(!e)return null;if(r().isTencentDocsApp)return null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.mqq)||void 0===t?void 0:t.invoke("nav","openSchema",{uri:"tel:"+e});var a=document.getElementById("dial-phone");a&&document.body.removeChild(a);var n=document.createElement("a");n.id="dial-phone",n.href="tel:"+e,document.body.appendChild(n),null===n||void 0===n||n.click()}function p(e,t){var a=!1,n=Number(e);return i.forEach((function(e){e===n&&(a=!0)})),{isValid:a,getExtIndex:null,regExp:null}}function m(e){var t;if(!e)return null;if(r().isTencentDocsApp)return null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.mqq)||void 0===t?void 0:t.invoke("nav","openSchema",{uri:e});var a=document.getElementById("email-string");a&&document.body.removeChild(a);var n=document.createElement("a");n.id="email-string",n.href=e,document.body.appendChild(n),null===n||void 0===n||n.click()}},"../spread-sheet/src/core/feature/dataValidation/api/DataValidationCalc.ts":function(e,t,a){a.d(t,{O:function(){return h}}),a("../node_modules/core-js/modules/es.number.constructor.js");var n=a("../node_modules/@tencent/sheet-formula-sdk/lib/index.js"),r=a("../packages/model/src/cell/data-validation/data-validation-utils.ts"),s=a("../packages/model/src/range/hexRangeUtils.ts"),o=a("../spread-sheet/src/core/feature/dataValidation/custom-formula/convert.ts"),i=a("../spread-sheet/src/core/feature/dataValidation/api/DataValidationUtils.ts"),l=a("../packages/model/src/cell/index.ts"),c=a("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),h=function(e,t,h,d){var u=e.spreadsheet.activeSheet.getCellDataAtPosition(h,t);if(null==u)return null;var p=u.getEffectiveValue();if(null==d&&(d=null===p||void 0===p?void 0:p.value),""===d)return null;var m=u.getDataValidation();if(m&&null!=d){var v=function(e,t,h,d,u,p){var m,v,f,g,C=e.spreadsheet.activeSheet.getSheetId(),w=p||C,R={rowIndex:h,colIndex:d,options:e.spreadsheet.sheetManager};if(null===(m=null===t||void 0===t?void 0:t.argTokens)||void 0===m?void 0:m.length){var S=t.argTokens[0],_=(0,r.o5)(S,{rowIndex:h,colIndex:d,options:e.spreadsheet.sheetManager}),E=(0,s.getRangeInfoFormHexRange)(e.spreadsheet,_).sheetId||C;if(!(null===(v=e.spreadsheet.sheetManager.getSheetBySheetId(E))||void 0===v?void 0:v.isLoaded))return null===(f=a.g.log)||void 0===f||f.log("数据验证跨表数据未加载"),!1}var x=(0,o.f)(t,R);if(!x)return!0;var y=(0,i.KN)(u);t.ruleType===l.DATA_VALIDATION_RULE_TYPE.DATE&&"number"===typeof y&&(0,c.isPrecisionBiggerThan16)(""+y)&&(y=Number((0,c.handleLongNumber)(""+y,void 0,!0)));var I=(0,i.Np)(y)||n.Pz.toCellId(h,d),D=null===(g=e.spreadsheet.sheetManager.getSheetBySheetId(w))||void 0===g?void 0:g.getCellDataAtPosition(h,d),A=(0,i.Dq)(I,D,u),b=function(e,t){var a=e.sheetId,n=e.calculator;if(t){var r=t.calcController.getResultBySingleFormula(n,a).result;if(null!=r)return!0===r||"TRUE"===r}return null}({calculator:(0,i.ko)(x,"$SLOT",A),col:d,row:h,sheetId:w},e);return!0===b}(e,m,h,t,d)&&(0,i.uU)(d,m);if(null!=v)return{isDataValid:v,dataValidation:m,cell:n.Pz.toCellId(h,t)}}return null}},"../spread-sheet/src/core/feature/index.ts":function(e,t,a){a.d(t,{Z:function(){return x}}),a("../node_modules/core-js/modules/es.array.sort.js");var n=a("../spread-sheet/src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts"),r=a("../spread-sheet/src/core/feature/dataValidation/api/DataValidationUtils.ts"),s=a("../spread-sheet/src/core/feature/dataValidation/api/DataValidationCalc.ts"),o=(a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../packages/model/src/cell/CellFormat.ts")),i=a("../packages/model/src/cell/format/Color.ts");function l(e,t,a){var n=function(e,t){for(var a=[],n=t.startRowIndex;n<=t.endRowIndex;n++){for(var r=[],s=t.startColIndex;s<=t.endColIndex;s++){var o=e.data.rowData[n]?e.data.rowData[n].values[s]:null;r.push(o)}a.push(r)}return a}(e,t);if(n.length<=1)return!1;for(var r=!1,s=function(e,t,a){var n=a[0],r=[];t.forEach((function(t){r.push(t.column-e.startColIndex)}));for(var s=0;s<n.length;s++)r.length&&-1===r.indexOf(s)&&r.push(s);return r}(t,a,n),o=0;o<s.length;o++){var i=h(n,s[o]);if(c(i[0]))return!1;if(r=d(e,t,i))break}return r}function c(e){return!(e&&!e.isEmpty())||!(e.getHyperlink()||e.getFormula()||e.getEditValue())}function h(e,t){var a=[];return e.forEach((function(e){a.push(e[t])})),a}function d(e,t,a){return!!function(e,t){var a=e.getBasicFilter(),n=e.properties;return!!function(e,t){var a=-1;return e&&(a=e.range.startRowIndex),a>-1&&t===a}(a,t.startRowIndex)||!!function(e,t){var a=0,n=e.gridProperties;if(n&&(a=n.frozenRowCount),a>0&&t+1===a)return!0}(n,t.startRowIndex)}(e,t)||!!function(e,t){var a=!1;if(e.length>=3){if(c(e[0])||c(e[1]))return!1;var n=e[0],r=e[1];!function(e,t,a){for(var n=2;n<e.length&&!u(t,e[n],a);n++);}(e,r,t),u(n,r,t)&&(a=!0)}return a}(a,e.spreadsheetReference)||!!function(e){var t,a,n="00000";if(e.length>=3){if(c(e[0])||c(e[1]))return!1;var r=(null===(t=e[0])||void 0===t?void 0:t.effectiveValue)?w(e[0].effectiveValue):n,s=(null===(a=e[1])||void 0===a?void 0:a.effectiveValue)?w(e[1].effectiveValue):n,o=function(e,t){for(var a,n="00000",r=!1,s=2;s<e.length;s++){if(((null===(a=e[s])||void 0===a?void 0:a.effectiveValue)?w(e[s].effectiveValue):n)!==t&&!c(e[s])){r=!0;break}if(c(e[s]))break}return r}(e,s);return r!==s&&!o}return!1}(a)}function u(e,t,a){var n,r,s=!1;if(e&&t){var i=o.Z.createInstance(),l=null!==(n=e.getUserEnteredFormat())&&void 0!==n?n:i,c=null!==(r=t.getUserEnteredFormat())&&void 0!==r?r:i;l&&c&&(s=["bold","italic","fontSize","fontColor","backgroundColor","numberFormat"].some((function(e){return function(e,t,a,n){return{bold:p,italic:m,fontSize:v,fontColor:f,backgroundColor:g,numberFormat:C}[e](t,a,n)}(e,l,c,a)})))}return s}function p(e,t){var a=!1;return(e.getBold()||!1)!==(t.getBold()||!1)&&(a=!0),a}function m(e,t){var a=!1;return(e.getItalic()||!1)!==(t.getItalic()||!1)&&(a=!0),a}function v(e,t){var a=!1;return(e.getFontSize()||10)!==(t.getFontSize()||10)&&(a=!0),a}function f(e,t,a){var n=!1,r=e.getColor()||i.Z.createColor("#000000"),s=t.getColor()||i.Z.createColor("#000000");return r&&s?i.Z.getColorHexCode(r,a)!==i.Z.getColorHexCode(s,a)&&(n=!0):(r||s)&&(n=!0),n}function g(e,t,a){var n=!1,r=e.getBackgroundColor()||i.Z.createColor("#FFFFFF"),s=t.getBackgroundColor()||i.Z.createColor("#FFFFFF");return r&&s?i.Z.getColorHexCode(r,a)!==i.Z.getColorHexCode(s,a)&&(n=!0):(r||s)&&(n=!0),n}function C(e,t){var a=!1,n=e.getNumberFormat(),r=t.getNumberFormat();return n&&r?n.equals(r)||(a=!0):(n&&0!==n.id||r&&0!==r.id)&&(a=!0),a}function w(e){var t="0001",a="";if(e&&3!==e.type){var n=String(e.value);a+=/[a-zA-Z\u4e00-\u9fa5]+/.test(n)?"1":"0",a+=/^-?(\d|([1-9]\d+))(\.\d+)?$/.test(n)?"1":"0",a+=/[!@#$%\\^&*)(+={}[\]/",<>~`?:;|]/.test(n)?"1":"0",/^#N\/A$|^#DIV\/0!$|#VALUE!$|^#REF!$|^#ERROR$|^#NUM!$|^#NAME\?$|^#NULL!$|^#PARAMS_LACK$/.test(n)?a=t:a+="1"}else e&&3===e.type&&(a=t);return a}var R,S=a("../spread-sheet/src/core/feature/sort/Sort.ts"),_=a("../spread-sheet/src/core/feature/dataValidation/DVInterface.ts"),E=a("../spread-sheet/src/core/feature/dataValidation/api/DataValidationError.ts");!function(e){!function(e){e.needCheckSmartSplit=n.IK,e.doSmartSplitMobile=n.jq}(e.smartSplit||(e.smartSplit={})),function(e){e.getUIDVAtPosition=r.Sc,e.getDropDownValues=r.ZK,e.viewCheckDataValid=s.O,e.compareMaxMinError=r.JU,e.isActiveCellContainDV=r.v1,e.VALID_TYPE=_.ob,e.DATA_TYPE=_.h6,e.DATE_OPERATE_MAP=_.y3,e.TEXT_OPERATE_MAP=_.Bb,e.NUMBER_OPERATE_MAP=_.UD,e.NUMBER_DATA_TYPE_MAP=_.Ju,e.error=E}(e.dataValidation||(e.dataValidation={})),function(e){e.checkSortTitle=l,e.checkExtendRange=S.Df,e.hasPositiveRef=S.Hq}(e.sort||(e.sort={}))}(R||(R={}));var x=R},"../spread-sheet/src/core/feature/sort/Sort.ts":function(e,t,a){a.d(t,{Df:function(){return i},Hq:function(){return o}});var n,r=a("../spread-sheet/src/core/behavior/index.ts");!function(e){e.EXTEND="extend",e.NOT_EXTEND="not-extend"}(n||(n={}));var s=function(e,t,a){var n=e.spreadsheet.activeSheet.getCellDataAtPosition(t,a),r=null===n||void 0===n?void 0:n.getFormula();return!!r&&r.hasRelativeReference()},o=function(e,t){for(var a=t,n=a.startRowIndex;n<=a.endRowIndex;n++)for(var r=a.startColIndex;r<=a.endColIndex;r++)if(s(e,n,r))return!0;return!1};function i(e,t){var a,n=t,s=function(e,t){return r.Z.Utils.searchCloseDataArea(e.spreadsheet.activeSheet,t)}(e,n),o=!s.equal(t),i=(a=n,!(0!==Math.abs(a.startColIndex-a.endColIndex)||0!==Math.abs(a.startRowIndex-a.endRowIndex))),l=function(e){return 0===Math.abs(e.startColIndex-e.endColIndex)||0===Math.abs(e.startRowIndex-e.endRowIndex)}(n);return{extRange:s,oriRange:n,canExtend:o,isOneCell:i,singleColOrRow:l}}},"../spread-sheet/src/core/utils/linkedRange.ts":function(e,t,a){a.d(t,{$q:function(){return o},Tu:function(){return l},XI:function(){return i}}),a("../node_modules/core-js/modules/es.regexp.exec.js"),a("../node_modules/core-js/modules/es.string.split.js");var n=a("../node_modules/i18next/dist/esm/i18next.js"),r=a("../packages/model/src/range/hexRangeUtils.ts"),s=a("../spread-sheet/src/base/util/url.ts"),o=function(e,t){if(null===t||void 0===t?void 0:t[0]){var a=t[0].linkUrl;if(null===a||void 0===a?void 0:a.split("=")){var n=(null===a||void 0===a?void 0:a.split("="))[1],r=e.workbookRangeManager.getLinkedWorkbookRangeById(n);if(r)return r}}return null},i=function(e,t){var a=o(e,t);if(a){var s=function(e,t){var a=t.sheetId,s=e.sheetManager.getSheetBySheetId(a);if(!s)return n.ZP.t("链接无效");var o=""+(0,r.range2RelativeHex)(t,s);return"'"+s.getTitle()+"'!"+o}(e,a.range);return s}return(null===t||void 0===t?void 0:t.length)?n.ZP.t("链接无效"):""},l=function(e,t){var a=(0,s.lS)(t);return a&&e.sheetManager.hasSheetId(a)?{sheetId:a,title:e.sheetManager.getSheetTitleBySheetId(a)}:null}},"../spread-sheet/src/core/view/level-2/CanvasTooltip/index.tsx":function(e,t,a){a.d(t,{H:function(){return d}}),a("../node_modules/core-js/modules/es.array.find.js"),a("../node_modules/core-js/modules/es.object.assign.js");var n=a("react"),r=a("react-dom"),s=a.n(r),o=a("../node_modules/@tencent/dui/lib/components/Tooltip/index.js"),i=document.getElementById("canvasContainer"),l=document.createElement("div");null===i||void 0===i||i.appendChild(l);var c=null,h=[];function d(e,t){i&&(0===h.length&&requestAnimationFrame(u),h.push({iconArea:e,props:t}))}function u(){if(0!==h.length){var e=h.find((function(e){return e.props.visible}));h=[],e?p(e.iconArea,e.props):m()}}function p(e,t){var a=e.x,r=e.y,i=e.width,h=e.height;s().render(n.createElement(o.default,Object.assign({},t,{style:Object.assign({position:"absolute",left:a+"px",top:r+"px",pointerEvents:"none"},t.style),zIndex:1}),n.createElement("div",{style:{width:i+"px",height:h+"px"}})),l),c={iconArea:e,props:t}}function m(){if(c){var e=c,t=e.iconArea,a=e.props;p(t,Object.assign(Object.assign({},a),{visible:!1}))}}null===i||void 0===i||i.addEventListener("mouseleave",m),p({x:0,y:0,width:0,height:0},{visible:!1})},"../spread-sheet/src/core/view/level-2/area-texture/index.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var n=a("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),r=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(a("../node_modules/regenerator-runtime/runtime.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.promise.js"),a("../node_modules/core-js/modules/es.array.filter.js"),a("../node_modules/core-js/modules/es.array.map.js"),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.object.assign.js"),a("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts")),o=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},i=new Image,l=new Promise((function(e){i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABKSURBVHgBfcyhEUAhDANQ8s031VhUR2D/Ddo7bCfBcUGgoJF9SYu794j4yyVm1j4RGao6bwig4rUkcowM+RkZ8oYMT+GFu5AhswBkuylkkVfzHgAAAABJRU5ErkJggg==",i.onload=e}));function c(){return o(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return(t=document.createElement("canvas")).width=i.width,t.height=i.height,(a=t.getContext("2d"))&&a.drawImage(i,0,0),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))}var h=a("../spread-sheet/src/core/view/utils/base-func.ts"),d=a("../node_modules/lodash/flatten.js"),u=a.n(d),p=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/CollectEngine.ts"),m=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},v=function(e){function t(t){var a;return(a=e.call(this,t)||this).handlers=[],a.renderAfterArea=function(e){u()(a.handlers.map((function(e){return e()}))).filter((function(e){return e})).forEach((function(t){var n=Math.max(t.startColIndex,e.fromCol),r=Math.max(t.startRowIndex,e.fromRow),s=Math.min(t.endColIndex,e.toCol),o=Math.min(t.endRowIndex,e.toRow);if(!(n>s||r>o)){var i=a.areaData.getViewLeftByCol(n)+a.headSize.rowHeadWidth,l=a.areaData.getViewTopByRow(r)+a.headSize.colHeadHeight,c=n===s,d=r===o,u=c?i:a.areaData.getViewLeftByCol(s-1)+a.headSize.rowHeadWidth,m=d?l:a.areaData.getViewTopByRow(o-1)+a.headSize.colHeadHeight,v=s-1,f=a.spreadsheet.activeSheet.data.isColHidden(v)?0:a.rowcolAccessor.getColSetWidth(v),g=a.spreadsheet.activeSheet.data.isColHidden(s)?0:a.rowcolAccessor.getColSetWidth(s),C=c?g:g+f,w=o-1,R=a.spreadsheet.activeSheet.data.isRowHidden(w)?0:a.rowcolAccessor.getRowDisplayHeight(w),S=a.spreadsheet.activeSheet.data.isRowHidden(o)?0:a.rowcolAccessor.getRowDisplayHeight(o),_=d?S:S+R;i=Math.max(i,0),l=Math.max(l,0);var E=u<0?C+u:u+C-i,x=m<0?_+m:m+_-l;E=Math.max(E,0),x=Math.max(x,0);var y=a._alloyExcel.ctx.createPattern(a.bgCanvas,"repeat");null!==y&&a.textureBackgroundCollector.collect({color:"canvasPattern",canvasPattern:y,graphicsInfo:{path:(0,h.j9)(i,l,E,x)}},p.h.RANGTH_AUTH_BACKGROUND)}}))},Object.assign((0,n.Z)(a),t),a.init(),a}(0,r.Z)(t,e);var a=t.prototype;return a.addTextureAreaHandler=function(e){this.handlers.push(e),this.refreshRender()},a.refreshRender=function(){this.renderApi.renderNextTick()},a.init=function(){return m(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:this.bgCanvas=e.sent,this._alloyExcel.onAfterAreaRender(this.renderAfterArea);case 4:case"end":return e.stop()}}),e,this)})))},t}(s.Z)},"../spread-sheet/src/core/view/level-2/card-center/BaseCard.ts":function(e,t,a){var n=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),r=a("../spread-sheet/src/core/view/utils/base-func.ts"),s=function(){function e(){this._container=document.createElement("div"),this._container.classList.add("base-card"),this._container.setAttribute("tabindex","5"),this._container.addEventListener("keydown",r.UW),this._container.addEventListener("wheel",r.UW)}return(0,n.Z)(e,[{key:"container",get:function(){return this._container}}]),e}();t.Z=s},"../spread-sheet/src/core/view/level-2/card-center/CardCenter.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var n,r=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=a("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),o=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),i=(a("../node_modules/core-js/modules/es.array.splice.js"),a("../spread-sheet/src/core/view/spreadsheet-view/accessor/BaseCellAccessor.ts")),l=(a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../spread-sheet/src/core/utils/linkedRange.ts")),c=a("../spread-sheet/src/core/view/spreadsheet-view/area-data/AreaData.interface.ts");!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP"}(n||(n={}));var h={x:16,y:0},d=function(){function e(e){var t=this;this._container=document.createElement("div"),this._cardPool=[],this._eventDisposes=[],this.isCellLink=function(e,a){var n=t._spreadsheet.activeSheet.getCellDataAtPosition(e,a),r=null===n||void 0===n?void 0:n.getHyperlinkRuns();return!(!r||!(0,l.XI)(t._spreadsheet,r))||!!(null===n||void 0===n?void 0:n.getHyperlink())},this._getDisplayDownPosY=function(e,a,n){return{top:e-a>t._cardRect.height?a+n+"px":e-t._cardRect.height+"px",bottom:""}},this._getDisplayUpPosY=function(e,a,n){var r="",s="",o=t._clientRect.width<=480?4:8,i=a-n;return i>t._cardRect.height?t._cardRect.height>0?r=i-t._cardRect.height-o+"px":s=e-i+"px":t._cardRect.height>0?r=e-t._cardRect.height-o+"px":s=t._cardRect.height+"px",{top:r,bottom:s}},this._handleInsertCol=function(e){if(t.isCurrentSheet(e)){var a=e.index,n=e.amount;a<=t._col&&(t._col+=n)}},this._handleInsertRow=function(e){if(t.isCurrentSheet(e)){var a=e.index,n=e.amount;a<=t._row&&(t._row+=n)}},this._handleDeleteCol=function(e){if(t.isCurrentSheet(e)){var a=e.index,n=e.amount;a<=t._col&&(a+n>t._col?t._destroy():t._col-=n)}},this._handleDeleteRow=function(e){if(t.isCurrentSheet(e)){var a=e.index,n=e.amount;a<=t._row&&(a+n>t._row?t._destroy():t._row-=n)}},this.getCardPositionOffset=function(e){return null!==e&&void 0!==e?e:0},this._spreadsheet=e.spreadsheet,this._tableView=e.tableView,this._clientRect=e.clientRect,this._areaData=e.areaData,this._headSize=e.headSize,this._mainBoard=e.mainBoard,this._dataCallView=e.dataCallView,this._cardRect=e.cardRect,this._propsDestroy=e.destroy,this._row=e.row,this._col=e.col,this._vertical=n.DOWN,this._init()}var t=e.prototype;return t.append=function(e){this._container.appendChild(e.container),this._cardPool.push(e)},t.remove=function(e){var t=this._cardPool.indexOf(e);t>-1&&(this._container.removeChild(e.container),this._cardPool.splice(t,1),this.refresh())},t.refresh=function(){0===this._cardPool.length&&this._destroy()},t.hideAll=function(e){var t;for(void 0===e&&(e=c.oz.USER);t=this._cardPool.pop();)t.hide(e),this.remove(t);this._destroy()},t.adjustPositionByDiff=function(e,t){var a=this.container.getBoundingClientRect(),n=a.width,r=a.height;return this.adjustPosition({width:n+((null===e||void 0===e?void 0:e.width)||0),height:r+((null===e||void 0===e?void 0:e.height)||0)},t)},t.adjustPosition=function(e,t){this._cardRect=e,this._container.classList.remove("card-group-to-down"),this._container.classList.remove("card-group-to-up"),this.setPosition(),t&&(this._container.classList.remove("card-group-to-down"),this._container.classList.remove("card-group-to-up"))},t.setPosition=function(e){var t;void 0===e&&(e=h);var a=this._row,r=this._col,s=this._areaData.getDisplayViewTopByRow(a)+this.getCardPositionOffset(null===e||void 0===e?void 0:e.y),o=this._tableView.getCellViewAtPosition(a,r);(null===o||void 0===o?void 0:o.mergeData)&&(a+=o.mergeData.rowCount-1);var i=this._areaData.getDisplayViewBottomByRow(a),l=this._clientRect.width-this._headSize.displayRowHeadWidth,c=l-h.x,d=this._clientRect.height-this._headSize.displayColHeadHeight,u=d-h.y;if(this._cardRect.height>0?u-i>this._cardRect.height+4:u-i>s){var p=this._getDisplayDownPosY(d,i,4),m=p.top,v=p.bottom;this._container.style.top=m,this._container.style.bottom=v,this._container.classList.remove("card-group-to-up"),this._container.classList.add("card-group-to-down"),this._vertical=n.DOWN}else{var f=this._getDisplayUpPosY(d,s,4),g=f.top,C=f.bottom;this._container.style.top=g,this._container.style.bottom=C,this._container.classList.remove("card-group-to-down"),this._container.classList.add("card-group-to-up"),this._vertical=n.UP}null===(t=this._onPositionChange)||void 0===t||t.call(this,{top:this._container.style.top,bottom:this._container.style.top,vertical:this._vertical,areaHeight:d});var w=this._areaData.getDisplayViewLeftByCol(r)+this.getCardPositionOffset(null===e||void 0===e?void 0:e.x),R=c-w,S=this._cardRect.width||280;this._container.style.left=w<0?"0px":R<S?l-S+"px":w+"px"},t._init=function(){var e=this;this._container.classList.add("card-group"),this.setPosition(),this._mainBoard.element.appendChild(this._container),this._eventDisposes.push(this._areaData.onUpdateOffset((function(){e.setPosition()}))),this._eventDisposes.push(this._dataCallView.onInsertCol(this._handleInsertCol)),this._eventDisposes.push(this._dataCallView.onInsertRow(this._handleInsertRow)),this._eventDisposes.push(this._dataCallView.onDeleteCol(this._handleDeleteCol)),this._eventDisposes.push(this._dataCallView.onDeleteRow(this._handleDeleteRow))},t._destroy=function(){this._mainBoard.element.contains(this._container)&&this._mainBoard.element.removeChild(this._container),this._propsDestroy(this,this._row,this._col),this._eventDisposes.forEach((function(e){e.dispose()}))},t.isCurrentSheet=function(e){return e.sheetId===this._spreadsheet.activeSheetId},(0,r.Z)(e,[{key:"container",get:function(){return this._container}},{key:"vertical",get:function(){return this._vertical}},{key:"onPositionChange",set:function(e){this._onPositionChange=e}}]),e}(),u=a("../spread-sheet/src/core/view/lib/mutex-management/MutexManagement.ts"),p=function(e){function t(t){var a,n;return(a=e.call(this,t)||this)._queue=[],a._destroy=function(e,t,n){var r,s,o=a._queue.indexOf(e);a._queue.splice(o,1),(null===(s=null===(r=a._rowData[a.currentSheetId].group)||void 0===r?void 0:r[t])||void 0===s?void 0:s[n])===e&&delete a._rowData[a.currentSheetId].group[t][n]},a._dependency=t,a._tableView=t.tableView,a._clientRect=t.clientRect,a._areaData=t.areaData,a._mainBoard=t.mainBoard,a._headSize=t.headSize,a._mutexManagement=t.mutexManagement,a.currentSheetId=a._spreadsheet.activeSheetId,a._rowData[a.currentSheetId]={group:[]},null===(n=a._mutexManagement)||void 0===n||n.addMutexComponent(u.d.CARD_CENTER,(0,s.Z)(a)),a}(0,o.Z)(t,e);var a=t.prototype;return a.getCardGroup=function(e,t,a){return this._rowData[this.currentSheetId].group[e]||(this._rowData[this.currentSheetId].group[e]=[]),this._rowData[this.currentSheetId].group[e][t]||(this._rowData[this.currentSheetId].group[e][t]=new d({clientRect:this._clientRect,areaData:this._areaData,mainBoard:this._mainBoard,headSize:this._headSize,tableView:this._tableView,dataCallView:this._dataCallView,row:e,col:t,cardRect:a||{width:0,height:0},destroy:this._destroy,spreadsheet:this._spreadsheet}),this._queue.push(this._rowData[this.currentSheetId].group[e][t])),this._rowData[this.currentSheetId].group[e][t]},a.hide=function(e){void 0===e&&(e=c.oz.USER),this._hide(e)},a.mutexHide=function(){this._hide()},a.refresh=function(e){this._rowData[this.currentSheetId]={group:[]},this.currentSheetId=e,this._rowData[this.currentSheetId]={group:[]},this._hide()},a._hide=function(e){var t;for(void 0===e&&(e=c.oz.USER);t=this._queue[0];)t.hideAll(e)},(0,r.Z)(t,[{key:"dependency",get:function(){return this._dependency}}]),t}(i.Z)},"../spread-sheet/src/core/view/level-2/cell-corner/const.ts":function(e,t,a){var n,r;a.d(t,{$s:function(){return n},Bq:function(){return r},N7:function(){return s},YZ:function(){return o}}),function(e){e[e.LeftTop=0]="LeftTop",e[e.RightTop=1]="RightTop"}(n||(n={})),function(e){e.Blue="#0188fb",e.Red="#ff4419",e.Gray="#81868f"}(r||(r={}));var s=6,o=1},"../spread-sheet/src/core/view/level-2/collab-cursor/CollabCursor.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return T}});var n=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),r=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/es.map.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.string.iterator.js"),a("../node_modules/core-js/modules/esnext.map.delete-all.js"),a("../node_modules/core-js/modules/esnext.map.every.js"),a("../node_modules/core-js/modules/esnext.map.filter.js"),a("../node_modules/core-js/modules/esnext.map.find.js"),a("../node_modules/core-js/modules/esnext.map.find-key.js"),a("../node_modules/core-js/modules/esnext.map.includes.js"),a("../node_modules/core-js/modules/esnext.map.key-of.js"),a("../node_modules/core-js/modules/esnext.map.map-keys.js"),a("../node_modules/core-js/modules/esnext.map.map-values.js"),a("../node_modules/core-js/modules/esnext.map.merge.js"),a("../node_modules/core-js/modules/esnext.map.reduce.js"),a("../node_modules/core-js/modules/esnext.map.some.js"),a("../node_modules/core-js/modules/esnext.map.update.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.object.assign.js"),a("../node_modules/core-js/modules/es.function.name.js"),function(e){this.id=e.id,this.name=e.name,this.corpName=e.corpName,this.color=e.color,this.isEditing=e.input,this.coords={x:e.x,y:e.y},this.cell=e.cell}),o=a("../spread-sheet/src/core/view/level-2/collab-cursor/cell/CollabCell.ts"),i=a("../packages/report/src/index.ts"),l=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),c=a.n(l),h=a("../spread-sheet/src/core/view/spreadsheet-view/accessor/BaseCellAccessor.ts"),d=function(e){function t(t){var a,n;return(n=e.call(this,t)||this).currentSheetId=n._spreadsheet.activeSheetId,n.users=new Map,n._rowData[n.currentSheetId]=((a={}).cell_store=[],a),n}(0,r.Z)(t,e);var a=t.prototype;return a.getCell=function(e,t){if(this._rowData[this.currentSheetId]&&this._rowData[this.currentSheetId].cell_store&&this._rowData[this.currentSheetId].cell_store[e])return this._rowData[this.currentSheetId].cell_store[e][t]},a.addUser=function(e){if(void 0!==e.x&&void 0!==e.y)if(this.users.get(e.id))this.updateUser(e);else{var t=this.getCell(e.y,e.x);t||(t=new o.Z({}));var a=new s(Object.assign(e,{cell:t}));t.insertUser(a),this.users.set(e.id,a),this._setCell(e.y,e.x,t)}},a.updateUser=function(e){void 0!==e.x&&void 0!==e.y&&(this.users.get(e.id)?(this.removeUser(e.id),this.addUser(e)):this.addUser(e))},a.removeUser=function(e){var t=this.users.get(e);if(t){var a=t;a.cell.eraseUser(a),this.users.delete(e)}},a.exist=function(e){return this.users.has(e)},a.clear=function(){var e,t;this.users.clear(),this._rowData[this.currentSheetId]=((e={}).cell_store=[],e),this.currentSheetId=this._spreadsheet.activeSheetId,this._rowData[this.currentSheetId]=((t={}).cell_store=[],t)},a.focus=function(e,t){var a=e.x,n=e.y,r=this.getCell(n,a);r&&(r.active(t),i.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_co-edit",action:"mb_select_hover_tag"}),t&&t())},a.unfocus=function(e,t){var a=e.x,n=e.y,r=this.getCell(n,a);if(r){r.inactive();var s=c().isPC?"co_edit_p":"mb_co_edit_p";i.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_co-edit",action:s,obj3:r.usersEditingAmount()+1}),t&&t()}},a._setCell=function(e,t,a){var n;this._rowData[this.currentSheetId]||(this._rowData[this.currentSheetId]=((n={}).cell_store=[],n)),this._rowData[this.currentSheetId].cell_store[e]||(this._rowData[this.currentSheetId].cell_store[e]=[]),this._rowData[this.currentSheetId].cell_store[e][t]=a},t}(h.Z),u=(a("../node_modules/core-js/modules/es.set.js"),a("../node_modules/core-js/modules/esnext.set.add-all.js"),a("../node_modules/core-js/modules/esnext.set.delete-all.js"),a("../node_modules/core-js/modules/esnext.set.difference.js"),a("../node_modules/core-js/modules/esnext.set.every.js"),a("../node_modules/core-js/modules/esnext.set.filter.js"),a("../node_modules/core-js/modules/esnext.set.find.js"),a("../node_modules/core-js/modules/esnext.set.intersection.js"),a("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),a("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),a("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),a("../node_modules/core-js/modules/esnext.set.join.js"),a("../node_modules/core-js/modules/esnext.set.map.js"),a("../node_modules/core-js/modules/esnext.set.reduce.js"),a("../node_modules/core-js/modules/esnext.set.some.js"),a("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),a("../node_modules/core-js/modules/esnext.set.union.js"),a("../node_modules/core-js/modules/es.array.slice.js"),a("../node_modules/core-js/modules/es.array.from.js"),a("../node_modules/core-js/modules/es.symbol.js"),a("../node_modules/core-js/modules/es.symbol.description.js"),a("../node_modules/core-js/modules/es.symbol.iterator.js"),function(e){this.id=e.id,this.name=e.name,this.corpName=e.corpName,this.color=e.color,this.shapeId=e.shapeId,this.shape=e.shape}),p=(a("../node_modules/core-js/modules/es.array.splice.js"),a("../spread-sheet/src/core/view/level-2/collab-cursor/utils.ts")),m=a("../spread-sheet/src/base/util/timer.ts"),v=function(){function e(e){var t=this;this._handleMouseenter=function(){t._showCard(!0)},this._hideCard=function(){t.hideTimer&&t.hideTimer.stop(),t.hideTimer=null,t.topLeftFrame.children[0]&&(t.topLeftFrame.children[0].style.display="none"),t.topRightFrame.children[0]&&(t.topRightFrame.children[0].style.display="none"),t.bottomLeftFrame.children[0]&&(t.bottomLeftFrame.children[0].style.display="none"),t.bottomRightFrame.children[0]&&(t.bottomRightFrame.children[0].style.display="none")},this.users=[],this._shapeId=e.shapeId,this._shapeStage=e.shapeStage;var a=document.createElement("div");a.classList.add("collab-shape"),this.topLeftFrame=a.cloneNode(),this.topRightFrame=a.cloneNode(),this.bottomLeftFrame=a.cloneNode(),this.bottomRightFrame=a.cloneNode(),this._addShapeBorder()}var t=e.prototype;return t.insertUser=function(e){this.users.unshift(e),this._updateShapeBorder()},t.eraseUser=function(e){var t=this.users.indexOf(e);t>-1&&this.users.splice(t,1),this._updateShapeBorder()},t.userAmount=function(){return this.users.length},t._addShapeBorder=function(){var e=this._shapeId,t=document.createElement("span");function a(a,n,r){var s=a.getShape(e);if(s){var o=t.cloneNode();n.appendChild(o),s.wrap.appendChild(n),s.wrap.addEventListener("mouseenter",r)}}t.classList.add("collab-shape-card"),a(this._shapeStage.topLeft,this.topLeftFrame,this._handleMouseenter),a(this._shapeStage.topRight,this.topRightFrame,this._handleMouseenter),a(this._shapeStage.bottomLeft,this.bottomLeftFrame,this._handleMouseenter),a(this._shapeStage.bottomRight,this.bottomRightFrame,this._handleMouseenter)},t._updateShapeBorder=function(){if(void 0!==this.users[0]){var e=(0,p.Pb)(this.users),t=this.users[0].color;this.updateFrame(this.topLeftFrame,e,t),this.updateFrame(this.topRightFrame,e,t),this.updateFrame(this.bottomLeftFrame,e,t),this.updateFrame(this.bottomRightFrame,e,t),this._showCard()}else this._removeShapeBorder()},t._removeShapeBorder=function(){var e=this._shapeId;function t(t,a){var n=t.getShape(e);n&&n.wrap.contains(a)&&n.wrap.removeChild(a)}t(this._shapeStage.topLeft,this.topLeftFrame),t(this._shapeStage.topRight,this.topRightFrame),t(this._shapeStage.bottomLeft,this.bottomLeftFrame),t(this._shapeStage.bottomRight,this.bottomRightFrame)},t._showCard=function(e){void 0===e&&(e=!0),this.hideTimer&&this.hideTimer.stop(),e&&(this.hideTimer=m.Z.wait(5e3).run(this._hideCard)),this.topLeftFrame.children[0]&&(this.topLeftFrame.children[0].style.display="block"),this.topRightFrame.children[0]&&(this.topRightFrame.children[0].style.display="block"),this.bottomLeftFrame.children[0]&&(this.bottomLeftFrame.children[0].style.display="block"),this.bottomRightFrame.children[0]&&(this.bottomRightFrame.children[0].style.display="block")},t.updateFrame=function(e,t,a){void 0!==e.children[0]&&(e.style.borderColor=a,e.children[0].innerText=t,e.children[0].style.backgroundColor=a,e.children[0].style.display="inline")},(0,n.Z)(e,[{key:"shapeId",get:function(){return this._shapeId}}]),e}();function f(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(e){if("string"===typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?g(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var C,w=function(){function e(e){this._shapeStage=e.shapeStage,this.users=new Map,this.shapes=new Set}var t=e.prototype;return t.getShape=function(e){for(var t,a=f(this.shapes.values());!(t=a()).done;){var n=t.value;if(e===n.shapeId)return n}return null},t.addUser=function(e){if(e.shapeId)if(this.users.get(e.id))this.updateUser(e);else{for(var t,a=null,n=f(this.shapes.values());!(t=n()).done;){var r=t.value;if(r.shapeId===e.shapeId){a=r;break}}a||(a=new v({shapeId:e.shapeId,shapeStage:this._shapeStage}));var s=new u(Object.assign(e,{shape:a}));a.insertUser(s),this.users.set(e.id,s),this.shapes.add(a)}},t.updateUser=function(e){e.shapeId&&(this.users.get(e.id)?(this.removeUser(e.id),this.addUser(e)):this.addUser(e))},t.removeUser=function(e){var t=this.users.get(e);if(t){var a=t;return a.shape.eraseUser(a),a.shape.userAmount()<=0&&this.shapes.delete(a.shape),this.users.delete(e),a}return null},t.exist=function(e){return this.users.has(e)},t.clear=function(){this.users.clear(),this.shapes.clear()},e}(),R=a("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),S=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts"),_=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),E=a("../spread-sheet/src/core/view/utils/base-func.ts"),x=a("../spread-sheet/src/core/view/spreadsheet-view/utils.ts"),y=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/CollectEngine.ts"),I=function(e){function t(t){var a;return(a=e.call(this,t)||this).renderAfterCell=function(e){if(e.row>0){var t={x:e.x,y:e.y-a._alloyExcel.api.getRowHeight(e.row-1),row:e.row-1,col:e.col};a.renderCollabCell(t)}a.renderCollabCell(e);var n={x:e.x,y:e.y+a._alloyExcel.api.getRowHeight(e.row),row:e.row+1,col:e.col};a.renderCollabCell(n)},a._rowcolAccessor=t.rowcolAccessor,a._tableView=t.tableView,a._collabCursor=t.collabCursor,a._addCollabBorderCollector(),a._alloyExcel.onAfterCellRender(a.renderAfterCell),a}(0,r.Z)(t,e);var a=t.prototype;return a.renderCollabCell=function(e){var t=this._collabCursor.cellStore.getCell(e.row,e.col);t&&t.usersAmount()>0&&this._render(e.x,e.y,e.row,e.col,t)},a._addCollabBorderCollector=function(){this._collabBorderCollector=this._alloyExcel.collectEngine.generateCollector(S.g4.LineRenderer,S.DF.CollabBorder),this._alloyExcel.collectEngine.add("collab-border-collector",this._collabBorderCollector)},a._render=function(e,t,a,n,r){var s=this._tableView.getCellViewAtPosition(a,n),o=(0,x.o)(this._rowcolAccessor,s,n),i=(0,x.E)(this._rowcolAccessor,s,a);this._renderBorder(e,t,o,i,r.color),r.cardVisiable&&this._renderCard(e,t,o,i,r)},a._renderBorder=function(e,t,a,n,r){var s={width:2,style:_.j.MEDIUM,color:r},o=(0,E.j9)(e,t,a,n);this._collabBorderCollector.collect({line:o,lineProp:s},y.h.COLLAB_CELL_CURSOR)},a._renderCard=function(e,t,a,n,r){var s;t>o.Z.cardHeight?(t-=o.Z.cardHeight,s="top"):(t+=n,s="bottom"),e=e+a-r.textWidth,("none"===r.position||r.position===s)&&(r.position=s,this._alloyExcel.collectEngine.bitmapCollector.collect({img:r.cacheImage,dx:e,dy:t,dWidth:r.textWidth,dHeight:o.Z.cardHeight,sx:0,sy:0,sWidth:r.textWidth*o.Z.DPR,sHeight:o.Z.cardHeight*o.Z.DPR},y.h.COLLAB_CELL_CURSOR))},t}(R.Z),D=a("../spread-sheet/src/base/index.ts"),A=a("../packages/common-utils/src/index.ts"),b=a("../spread-sheet/src/external/tencentMeeting/operation/operation.interface.ts");!function(e){e[e.CELL=0]="CELL",e[e.SHAPE=1]="SHAPE",e[e.EMPTY=2]="EMPTY"}(C||(C={}));var T=function(){function e(e){var t=this;this._notifyMyPosition=(0,E.kf)((function(){if(t._status===C.CELL){var e=t._coords,a=e.x,n=e.y,r={coords:[n,a,n,a],isEditing:e.isEditing};D.Z.event.network.trigger("userCaretChange",r)}else if(t._status===C.SHAPE){if(null===t._shapeId)return;var s={shapeId:t._shapeId};D.Z.event.network.trigger("userCaretChange",s)}}),10),this._render=(0,A.Ds)((function(){t._renderApi.renderNextTick()}),100),this._pickSelection=function(){t._status=C.CELL,t._coords.x=t._normalSelectData.activeCol,t._coords.y=t._normalSelectData.activeRow,t._focusCell(t._coords),t._notifyMyPosition()},this._focusCell=function(e){t._cellStore.focus(e,(function(){return t._render()}))},this._focusShape=function(){t._shapeEdit.shapeId&&(t._status=C.SHAPE,t._shapeId=t._shapeEdit.shapeId,t._notifyMyPosition())},this._blurShape=function(){t._shapeEdit.shapeId||(t._status=C.CELL,t._shapeId=null,t._notifyMyPosition())},this._pickEmpty=function(){t._status=C.EMPTY,t._coords.x=-1,t._coords.y=-1,t._coords.isEditing=!1,t._notifyMyPosition()},this._enterInput=function(){t._status=C.CELL,t._coords.x=t._normalSelectData.activeCol,t._coords.y=t._normalSelectData.activeRow,t._coords.isEditing=!0,t._inputCell({x:t._coords.x,y:t._coords.y}),t._notifyMyPosition()},this._exitInput=function(){t._coords.isEditing=!1,t._notifyMyPosition()},this._clear=function(){t._cellStore.clear(),t._shapeStore.clear(),t._render(),t._spreadsheetApp.event.sheetsBar.trigger("refreshCursor")},this._spreadsheetApp=e.spreadsheetApp,this._renderApi=e.renderApi,this._normalSelectData=e.normalSelectData,this._shapeEdit=e.shapeEdit,this._shapeStage=e.shapeStage,this._alloyExcel=e.alloyExcel,this._rowcolAccessor=e.rowcolAccessor,this._tableView=e.tableView,this._dataCallView=e.dataCallView,this._baseInputManager=e.baseInputManager,this._selectCells=e.selectCells,this._coords={x:-1,y:-1,isEditing:!1},this._shapeId=null,o.Z.init(),this._cellStore=new d({dataCallView:this._dataCallView,spreadsheet:this._spreadsheetApp.spreadsheet}),this._shapeStore=new w({shapeStage:this._shapeStage}),this._collabCellCursor=new I({alloyExcel:this._alloyExcel,collabCursor:this,rowcolAccessor:this._rowcolAccessor,tableView:this._tableView}),this._selectCells.emitter.on(this._selectCells.EVENT.END_SELECT,this._pickSelection),this._normalSelectData.onModifySelectData(this._pickSelection),this._shapeEdit.edit.emitter.on(this._shapeEdit.edit.EVENT.SHOW,this._focusShape),this._shapeEdit.edit.emitter.on(this._shapeEdit.edit.EVENT.HIDE,this._blurShape),this._baseInputManager.emitter.on(this._baseInputManager.EVENT.ENTER_INPUT,this._enterInput),this._baseInputManager.emitter.on(this._baseInputManager.EVENT.EXIT_INPUT,this._exitInput),this._spreadsheetApp.event.sheetsBar.listen("switchSheetEnd",this._clear),this._dataCallView.onSetRowVisible(this._clear)}var t=e.prototype;return t.addCollaborator=function(e){this._isValid(e)&&(i.ZP.jank.log({moduleValue:"view",actionValue:"collaborator",detail:["add"]}),this.selectedAvailableCell(e)&&e.role!==b.uU.HOST?this._cellStore.addUser(e):e.shapeId&&this._shapeStore.addUser(e),this._render())},t.changeCollaborator=function(e){if(this._isValid(e)){if(i.ZP.jank.log({moduleValue:"view",actionValue:"collaborator",detail:["change"]}),this.selectedAvailableCell(e)){if(e.role===b.uU.HOST)return void(this._shapeStore.exist(e.id)&&this._shapeStore.removeUser(e.id));this._shapeStore.exist(e.id)?(this._shapeStore.removeUser(e.id),this.addCollaborator(e)):this._cellStore.exist(e.id)?this._cellStore.updateUser(e):this.addCollaborator(e)}else e.shapeId?this._cellStore.exist(e.id)?(this._cellStore.removeUser(e.id),this.addCollaborator(e)):this._shapeStore.exist(e.id)?this._shapeStore.updateUser(e):this.addCollaborator(e):this.removeCollaborator(e.id);this._render()}},t.removeCollaborator=function(e){this._cellStore.exist(e)?this._cellStore.removeUser(e):this._shapeStore.exist(e)&&this._shapeStore.removeUser(e),this._render()},t._isValid=function(e){return null!==e.x&&null!==e.y},t._inputCell=function(e){var t=this;this._cellStore.unfocus(e,(function(){return t._render()}))},t.selectedAvailableCell=function(e){return void 0!==e.x&&void 0!==e.y&&!this._rowcolAccessor.isRowHidden(e.y)&&!this._rowcolAccessor.isColHidden(e.x)},(0,n.Z)(e,[{key:"cellStore",get:function(){return this._cellStore}}]),e}()},"../spread-sheet/src/core/view/level-2/collab-cursor/collab-area-cursor/CollabAreaCursorRenderPlugin.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var n=a("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),r=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(a("../node_modules/regenerator-runtime/runtime.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.promise.js"),a("../node_modules/core-js/modules/es.object.assign.js"),a("../node_modules/i18next/dist/esm/i18next.js")),o=a("../spread-sheet/src/core/view/spreadsheet-view/model/Color.ts"),i=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts"),l=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),c=a("../spread-sheet/src/core/view/spreadsheet-view/utils.ts"),h=a("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),d=a("../spread-sheet/src/core/view/level-2/collab-cursor/cell/CollabCell.ts"),u=a("../spread-sheet/src/core/view/level-2/collab-cursor/constant.ts"),p=a("../spread-sheet/src/core/view/level-2/collab-cursor/utils.ts"),m=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},v=function(e){function t(t){var a;return(a=e.call(this,t)||this).gridRange=null,a.cardImage=new Image,a.renderAfterArea=function(e){var t;if(a.gridRange&&(null===(t=a.gridRange)||void 0===t?void 0:t.sheetId)===a.spreadsheet.activeSheetId&&!(0,p.ji)(a.gridRange,a.rowcolAccessor)){var n=a.gridRange,r=n.startRowIndex,s=n.startColIndex,o=e.toRow,i=e.toCol;r>o||s>i||(a.renderBorderArea(e),a.renderCardArea())}},Object.assign((0,n.Z)(a),t),a.addCollabBorderCollector(),a.init(),a}(0,r.Z)(t,e);var a=t.prototype;return a.setRange=function(e){this.gridRange=(null===e||void 0===e?void 0:e.clone())||null,this.renderApi.renderNextTick()},a.setUserInfo=function(e){this.isUserChange(e)&&(this.userInfo=e,this.cardImage=this.getCardImg(),this.renderApi.renderNextTick())},a.isUserChange=function(e){var t=e.userName,a=e.isEditing;return!this.userInfo||t!==this.userInfo.userName||a!==this.userInfo.isEditing},a.init=function(){return m(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._alloyExcel.onAfterAreaRender(this.renderAfterArea);case 1:case"end":return e.stop()}}),e,this)})))},a.addCollabBorderCollector=function(){this.collabAreaBorderCollector=this._alloyExcel.collectEngine.generateCollector(i.g4.LineRenderer,i.DF.CollabBorder),this._alloyExcel.collectEngine.get(u.yu)||this._alloyExcel.collectEngine.add(u.yu,this.collabAreaBorderCollector)},a.renderBorderArea=function(e){var t={width:2,style:l.j.MEDIUM,color:o.Z.newInstanceByHex(u.de)},a=this.gridRange,n=a.startRowIndex,r=a.endRowIndex,s=a.startColIndex,i=a.endColIndex,c=this.headSize,h=c.rowHeadWidth,d=c.colHeadHeight,p=this.areaData.getViewLeftByCol(s)+h,m=this.areaData.getViewTopByRow(n)+d,v=this.areaData.getViewRightByCol(i)+h,f=this.areaData.getViewBottomByRow(r)+d,g=e.fromRow,C=e.toRow,w=e.fromCol,R=e.toCol;n>=g&&this.collabAreaBorderCollector.collect({line:[p,m,v,m],lineProp:t}),i<=R&&this.collabAreaBorderCollector.collect({line:[v,m,v,f],lineProp:t}),r<=C&&this.collabAreaBorderCollector.collect({line:[p,f,v,f],lineProp:t}),s>=w&&this.collabAreaBorderCollector.collect({line:[p,m,p,f],lineProp:t})},a.renderCardArea=function(){var e=this.gridRange,t=e.startRowIndex,a=e.endColIndex,n=e.endRowIndex,r=this.tableView.getCellViewAtPosition(t,a),s=this.headSize,o=s.rowHeadWidth,i=s.colHeadHeight,l=(0,c.o)(this.rowcolAccessor,r,a),h=this.areaData.getViewLeftByCol(a)+o+l-this.textWidth,u=this.areaData.getAreaTopByRow(t)+i,p=this.areaData.getViewTopByRow(t)+i,m=n===t&&this.areaData.row.frozen.renderTo===t&&this.areaData.row.frozen.renderFrom===t;u>this.headSize.colHeadHeight&&p>d.Z.cardHeight||m?p-=d.Z.cardHeight:n===t&&(p+=(0,c.E)(this.rowcolAccessor,r,t)),this._alloyExcel.collectEngine.bitmapCollector.collect({img:this.cardImage,dx:h,dy:p,dWidth:this.textWidth,dHeight:d.Z.cardHeight,sx:0,sy:0,sWidth:this.textWidth*d.Z.DPR,sHeight:d.Z.cardHeight*d.Z.DPR})},a.getCardImg=function(){d.Z.init();var e=this.userInfo,t=e.userName,a=e.isEditing,n=(0,p.db)(t,16);a&&(n=s.ZP.t("{{content}} 正在输入 ",{content:n}));var r=new Image,o=(0,p.mY)(n),i=(0,p.Jn)(n,u.de);return r.src=i,this.textWidth=o/d.Z.DPR>>0,r},t}(h.Z)},"../spread-sheet/src/core/view/level-2/condition-format-center/data/custom-formula/condition-number-rules.ts":function(e,t,a){a.d(t,{Ab:function(){return i},nW:function(){return o},p3:function(){return c}}),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.array.map.js");var n=a("../packages/model/src/index.ts"),r=a("../packages/model/src/utils/numberFormat/FormatParseEngine.ts"),s=n.Rule.CONDITION_TYPE,o={acceptRef:!0,min:4};function i(e,t,a){for(var n=[],r=arguments.length,s=new Array(r>3?r-3:0),o=3;o<r;o++)s[o-3]=arguments[o];s.forEach((function(e){n.push(e.toArray())}));var i=c(t),h=c(a),d=n.map((function(t){return t.map((function(t){return l(e,t,i,h)}))}));return d}function l(e,t,a,n){if(null===t)return e===s.NUMBER_NOT_EQ||e===s.NUMBER_NOT_BETWEEN;var r=c(t);switch(e){case s.NUMBER_GREATER:return r>a;case s.NUMBER_GREATER_THAN_EQ:return r>=a;case s.NUMBER_LESS:return r<a;case s.NUMBER_LESS_THAN_EQ:return r<=a;case s.NUMBER_EQ:return r===a;case s.NUMBER_NOT_EQ:return r!==a;case s.NUMBER_BETWEEN:return r>=a&&r<=n;case s.NUMBER_NOT_BETWEEN:return r<a||r>n}return!1}function c(e){var t;if("number"===typeof e)return e;var a=(null===(t=(0,r.parseValue)(e,null))||void 0===t?void 0:t.numericValue)||e;return"string"!==typeof a||isNaN(parseFloat(a))?a:parseFloat(a)}},"../spread-sheet/src/core/view/level-2/data-context-menu/menu.ts":function(e,t,a){a.d(t,{oe:function(){return E},pN:function(){return x},cl:function(){return y},T4:function(){return I}});var n,r=a("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),s=(a("../node_modules/regenerator-runtime/runtime.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.promise.js"),a("../node_modules/core-js/modules/es.number.constructor.js"),a("../node_modules/core-js/modules/es.array.map.js"),a("../node_modules/core-js/modules/es.regexp.to-string.js"),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.symbol.js"),a("../node_modules/core-js/modules/es.symbol.description.js"),a("../node_modules/i18next/dist/esm/i18next.js")),o=a("../spread-sheet/src/core/view/level-2/data-context-menu/config.tsx"),i=a("../packages/model/src/cell/metadata/select/SelectConfig.ts"),l=a("../node_modules/@tencent/dui/lib/components/Modal/index.js"),c=a("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),h=(a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../packages/model/src/range/index.ts")),d=a("../packages/model/src/cell/metadata/Metadata.ts"),u=a("../spread-sheet/src/core/feature/relateForm/seeker-util.ts"),p=function(){function e(e){var t=this;this.sendRequest=function(e,a){var n=e?d.Z.createInstance({customDataType:e,config:a}):null;t.spreadsheetApp.requestApi.setMetadata({metadata:n})},this.spreadsheetApp=e.spreadsheetApp,this.currCol=e.currCol,this.from=e.from,this.selection=e.selection}var t=e.prototype;return t.getTargetRange=function(e){var t,a=this;return e===o.BD.COL?[new h.GridRange({sheetId:this.spreadsheetApp.spreadsheet.activeSheetId,startColIndex:this.currCol,endColIndex:this.currCol,startRowIndex:0,endRowIndex:this.spreadsheetApp.spreadsheet.activeSheet.getRowCount()})]:e===o.BD.SHEETBAR||e===o.BD.CONTEXT?null===(t=this.selection)||void 0===t?void 0:t.rangeSelections.map((function(e){return new h.GridRange({sheetId:a.spreadsheetApp.spreadsheet.activeSheetId,startColIndex:e.startColIndex,endColIndex:e.endColIndex,startRowIndex:e.startRowIndex,endRowIndex:e.endRowIndex})})):[]},t.getSelectionMetaData=function(e){var t,a,n,r,s,i,l,c,h;if(e===o.BD.COL&&void 0!==this.currCol)return null===(t=this.spreadsheetApp.spreadsheet.activeSheet.data.colMetadata[this.currCol])||void 0===t?void 0:t.columnTypeMetadata;if((null===(n=null===(a=this.selection)||void 0===a?void 0:a.selectQueue)||void 0===n?void 0:n.length)&&(null===(r=this.selection)||void 0===r?void 0:r.selectQueue[0].selectCol)){var d=null===(i=null===(s=this.selection)||void 0===s?void 0:s.selectQueue[0].activation)||void 0===i?void 0:i.col;return null===(l=this.spreadsheetApp.spreadsheet.activeSheet.data.colMetadata[d])||void 0===l?void 0:l.columnTypeMetadata}if(e===o.BD.SHEETBAR||e===o.BD.CONTEXT){var u=null===(c=this.selection)||void 0===c?void 0:c.activeCell,p=u.rowIndex,m=u.colIndex;return null===(h=this.spreadsheetApp.spreadsheet.activeSheet.getCellDataAtPosition(p,m))||void 0===h?void 0:h.getMetadata()}},t.getSelectionDataValidation=function(e){var t,a,n,r,s;if((e!==o.BD.COL||void 0===this.currCol)&&(!(null===(a=null===(t=this.selection)||void 0===t?void 0:t.selectQueue)||void 0===a?void 0:a.length)||!(null===(n=this.selection)||void 0===n?void 0:n.selectQueue[0].selectCol))&&(e===o.BD.SHEETBAR||e===o.BD.CONTEXT)){var i=null===(r=this.selection)||void 0===r?void 0:r.activeCell,l=i.rowIndex,c=i.colIndex;return null===(s=this.spreadsheetApp.spreadsheet.activeSheet.getCellDataAtPosition(l,c))||void 0===s?void 0:s.getDataValidation()}},t.checkAllCellEffectiveValue=function(e,t,a){var n=this,s=[],i=[],l=(0,u.ns)(this.spreadsheetApp.spreadsheet.activeSheet),c=e;return a===o.BD.COL&&l&&(c=[],e.forEach((function(e){var t;(t=c).push.apply(t,(0,r.Z)(e.getExcept(l,n.spreadsheetApp.spreadsheet.activeSheet)))}))),c.forEach((function(e){var n=[e.startRowIndex,e.endRowIndex],r=[e.startColIndex,e.endColIndex],c=!!l&&a===o.BD.COL&&e.startColIndex>=l.startColIndex&&e.endColIndex<=l.endColIndex;t.forEach((function(e,t){var a;t<n[0]||t>n[1]||l&&c&&t<=(null===l||void 0===l?void 0:l.endRowIndex)||null===(a=null===e||void 0===e?void 0:e.values)||void 0===a||a.map((function(e,a){var n;a<r[0]||a>r[1]||((null===(n=null===e||void 0===e?void 0:e.getEffectiveValue())||void 0===n?void 0:n.value)&&s.push([a,t]),(null===e||void 0===e?void 0:e.getMetadata())&&i.push([a,t]))}))}))})),{hasValue:s,hasMeta:i}},e}(),m=a("../packages/model/src/cell/metadata/CustomDataType.ts"),v=a("../packages/report/src/index.ts"),f=a("../packages/model/src/cell/format/Color.ts"),g=a("../packages/model/src/filter-view/utils/grid-range-util.ts"),C=a("../spread-sheet/src/external/view/ui-layer/data-validation/data-validation-utils.ts"),w=a("../spread-sheet/src/core/feature/dataValidation/constant.ts"),R=a("../spread-sheet/src/core/data/configService/spreadConfig.ts"),S=(a("../spread-sheet/src/base/util/domain-config.ts"),function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))}),_=function(){function e(e){var t=this;this.firstCustomTypeUsed=!1,this.firstRemoved=!1,this.update=function(e){t.from=e.from,t.currCol=e.currCol,t.spreadsheetApp=e.spreadsheetApp,t.selection=e.selection,t.closeCallBack=e.closeCallBack},this.handleClick=function(e,a){return S(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,o,i,c,h,d,u,p,v=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===a||void 0===a||a.stopPropagation(),i=(0,C.RQ)(e),void 0!==this.from&&null!==this.from){t.next=4;break}return t.abrupt("return");case 4:c=this.logic.getSelectionMetaData(this.from),h=(0,m.NI)(Number(i.customTypeId)),d=(null===c||void 0===c?void 0:c.customDataType)!==Number(i.customTypeId),!h&&((null===(n=this.cellHasValue.hasValue)||void 0===n?void 0:n.length)>0||(null===(r=this.cellHasValue.hasMeta)||void 0===r?void 0:r.length)>0)&&d&&!this.firstCustomTypeUsed||h&&(null===(o=this.cellHasValue.hasMeta)||void 0===o?void 0:o.length)>0&&d&&!this.firstCustomTypeUsed?(u=w.rX[(null===i||void 0===i?void 0:i.customUITypeId)||""],p=s.ZP.t("设置{{value}}，将覆盖原有单元格内容，继续设置吗？",{value:u.text}),l.default.confirm({title:s.ZP.t("{{value}}提示",{value:u.text}),okText:s.ZP.t("确定"),content:p,onOk:function(){v.setDataType(i),v.firstCustomTypeUsed=!0}})):this.setDataType(i),this.closeMenu();case 9:case"end":return t.stop()}}),t,this)})))},this.submitCallBack=function(e,a,n){var r;if(!(n.items.length<1)){var o=n.items.map((function(e){return{id:null===e||void 0===e?void 0:e.id,text:null===e||void 0===e?void 0:e.text,textColor:f.Z.createColor(null===e||void 0===e?void 0:e.textColor),bgColor:f.Z.createColor(null===e||void 0===e?void 0:e.bgColor)}}));r=i.Z.createInstance({isMultiSelect:n.multiChoice,withColor:n.showItemColor,templateType:n.templateType,options:o}),t.logic.sendRequest(m.ZP.SELECT,r),D(t.from,m.ZP.SELECT,n.templateType),r.isMultiSelect&&v.ZP.tdwReport({opername:"doc_excel_editor",module:"data_validation",action:"validation_multichoice"}),r.withColor&&v.ZP.tdwReport({opername:"doc_excel_editor",module:"data_validation",action:"validation_color"}),c.default.show({message:s.ZP.t("设置成功"),type:"success"})}},this.from=e.from,this.currCol=e.currCol,this.spreadsheetApp=e.spreadsheetApp,this.selection=e.selection,this.closeCallBack=e.closeCallBack}var t=e.prototype;return t.getInitData=function(){var e;this.logic=new p({spreadsheetApp:this.spreadsheetApp,currCol:this.currCol,from:this.from,selection:this.selection});var t=this.logic.getSelectionMetaData(this.from),a=null===t||void 0===t?void 0:t.customDataType,n=[],r=null===(e=null===t||void 0===t?void 0:t.config)||void 0===e?void 0:e.templateType;n=a!==m.ZP.SELECT&&a!==m.ZP.DATE_TIME||!r?[""+((null===a||void 0===a?void 0:a.toString())||0)]:[a.toString(),a.toString()+"_"+r.toString()];var s=this.spreadsheetApp.spreadsheet.activeSheet,o=(0,g.e6)(this.logic.getTargetRange(this.from),s);return o.length>0&&(this.cellHasValue=this.logic.checkAllCellEffectiveValue(o,s.data.rowData,this.from)),{selectedIds:n,config:this.getColConfig()}},t.closeMenu=function(){var e;null===(e=this.closeCallBack)||void 0===e||e.call(this)},t.getColConfig=function(){v.ZP.tdwReport({opername:"doc_excel",module:"privacy_fill",action:"view_row",ver6:R.q.getConfig("isOwner")?1:2});var e=(0,r.Z)(o.t),t=(0,r.Z)(o.MZ);return this.spreadsheetApp.sheetStatus.containsPrivateRange()?t.push((0,o.Fx)(this.spreadsheetApp)):t.push((0,o.QO)(R.q.getConfig("isOwner"))),e.push.apply(e,(0,r.Z)(t)),e},t.setDataType=function(e){return S(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.spreadsheetApp.view.getDataValidationPanel();case 2:t.sent.create({customDataType:Number(null===e||void 0===e?void 0:e.customTypeId)||void 0,templateType:Number(null===e||void 0===e?void 0:e.templateId)||void 0,colIndex:this.from===o.BD.COL?this.currCol:void 0});case 3:case"end":return t.stop()}}),t,this)})))},e}();function E(e){return n?(n.update({from:e.from,spreadsheetApp:e.spreadsheetApp,currCol:e.currCol,selection:e.selection,closeCallBack:e.closeCallBack}),n):n=new _({from:e.from,spreadsheetApp:e.spreadsheetApp,currCol:e.currCol,selection:e.selection,closeCallBack:e.closeCallBack})}function x(e){return Number(e)===m.ZP.STAR?"menu-item-star":Number(e)===m.ZP.CHECKBOX?"menu-item-checkbox":Number(e)===m.ZP.PROGRESS?"menu-item-progressbar":void 0}function y(e,t){var a="";return o.De.forEach((function(n){n.id===e.toString()&&n.subMenu&&n.subMenu.forEach((function(e){e.id===t.toString()&&"string"===typeof(null===e||void 0===e?void 0:e.description)&&(a=e.description)}))})),a}function I(){v.ZP.tdwReport({opername:"doc_excel_editor",module:"data_validation",action:"view_validation"})}function D(e,t,a){var n={opername:"doc_excel_editor",module:"data_validation",action:"set_validation",ver10:o.z8.customdatainfo[t],ver12:o.z8.from[e]};t===m.ZP.SELECT&&a&&(n.ver11=o.z8.selecttemplate[a]),t===m.ZP.SELECT&&a&&(n.ver13=o.z8.datetimetemplate[a]),v.ZP.tdwReport(n)}},"../spread-sheet/src/core/view/level-2/dimension-color/DimensionColor.ts":function(e,t,a){a.r(t);var n=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=a("../node_modules/@tencent/containerized/build/main/index.js"),s=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=a.n(s),i=a("../spread-sheet/src/core/view/utils/base-func.ts"),l=a("../spread-sheet/src/core/view/level-1/select-center/base/selection/AllSelection.ts"),c=a("../spread-sheet/src/core/view/level-1/select-center/base/selection/RowSelection.ts"),h=a("../spread-sheet/src/core/view/level-1/select-center/base/selection/CellSelection.ts"),d=a("../spread-sheet/src/core/view/level-1/select-center/base/selection/ColSelection.ts"),u=a("../packages/model/src/filter-view/filter-view-util.ts"),p=o().isMobile?0:1.5,m=function(e){function t(t,a,n,r,s){var o;return(o=e.call(this)||this).normalSelectData=t,o.transformTable=a,o.areaData=n,o.scale=r,o.spreadsheet=s,o._getColSelectStatus=function(e){var t,a,n=e.index,r=o.normalSelectData.selectQueue,s=u.xJ(o.spreadsheet),m=(r.length>1?.5:p)/o.scale.scale;e.defaulted(s);for(var v=0;v<r.length;v++){if((t=r[v])instanceof l.Z)return e.selected(s),void e.expandFitLine(m);if(t instanceof c.Z)e.actived(s),e.expandFitLine(m);else if(t instanceof h.Z)(0,i.yQ)(n,t.xRange)&&(e.actived(s),a=o.areaData.getFirstRowInView(),t.yRange[0]<=a&&t.yRange[1]>=a&&e.expandFitLine(m));else if(t instanceof d.Z&&(0,i.yQ)(n,t.xRange))return e.selected(s),void e.expandFitLine(m)}},o._getRowSelectStatus=function(e){var t,a,n=e.index,r=o.normalSelectData.selectQueue,s=u.xJ(o.spreadsheet),m=(r.length>1?.5:p)/o.scale.scale;e.defaulted(s);for(var v=0;v<r.length;v++){if((t=r[v])instanceof l.Z)return e.selected(s),void e.expandFitLine(m);if(t instanceof d.Z)e.actived(s),e.expandFitLine(m);else if(t instanceof h.Z)(0,i.yQ)(n,t.yRange)&&(e.actived(s),a=o.areaData.getFirstColInView(),t.xRange[0]<=a&&t.xRange[1]>=a&&e.expandFitLine(m));else if(t instanceof c.Z&&(0,i.yQ)(n,t.yRange))return e.selected(s),void e.expandFitLine(m)}},o._register(o.transformTable.onCalcColHeadStatus(o._getColSelectStatus)),o._register(o.transformTable.onCalcRowHeadStatus(o._getRowSelectStatus)),o}return(0,n.Z)(t,e),t}(r.JT);t.default=m},"../spread-sheet/src/core/view/level-2/dimension-edit/DimensionEdit.pc.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return $e}});var n,r=a("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),s=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),o=(a("../node_modules/regenerator-runtime/runtime.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.promise.js"),a("../node_modules/core-js/modules/es.array.find.js"),a("react")),i=a.n(o),l=a("react-dom"),c=a.n(l),h=a("../node_modules/lodash/throttle.js"),d=a.n(h),u=a("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),p=(a("../node_modules/core-js/modules/es.regexp.exec.js"),a("../node_modules/core-js/modules/es.string.split.js"),a("../node_modules/core-js/modules/es.array.map.js"),a("../node_modules/core-js/modules/es.symbol.js"),a("../node_modules/core-js/modules/es.symbol.description.js"),a("../node_modules/core-js/modules/es.number.constructor.js"),a("../node_modules/core-js/modules/es.object.assign.js"),a("../node_modules/i18next/dist/esm/i18next.js")),m=a("../node_modules/@tencent/dui/lib/components/Menu/index.js"),v=a("../spread-sheet/src/core/view/level-2/data-context-menu/config.tsx"),f=a("../node_modules/@tencent/dui/lib/components/Divider/index.js"),g=a("../spread-sheet/src/core/view/level-2/data-context-menu/menu.ts"),C=a("../packages/model/src/cell/metadata/CustomDataType.ts"),w=(a("../spread-sheet/src/base/util/domain-config.ts"),a("../node_modules/@tencent/dui/lib/components/Tooltip/index.js")),R=a("../spread-sheet/src/base/event/event.ts"),S=a("../packages/report/src/index.ts"),_=a("../spread-sheet/src/core/data/configService/spreadConfig.ts"),E=function(e){function t(t){var a;return(a=e.call(this,t)||this).ref=i().createRef(),a.resize=d()((function(){a.setState({maxHeight:a.getMaxHeight()})}),50),a.stopPropagation=function(e){var t;null===(t=e.stopPropagation)||void 0===t||t.call(e)},a.getMaxHeight=function(){return a.props.spreadsheetApp.view.canvas.mainBoard.element.clientHeight},a.handleMenuItemClick=function(e,t){var n,r,s,o;t.stopPropagation();var i=e.split("_");a.setSelectedIds([i[0],e]),a.dataMenu.handleClick(e,t),null===(r=(n=a.props).handleSubMenuDisplay)||void 0===r||r.call(n,!0),null===(o=(s=a.props).closeCallBack)||void 0===o||o.call(s)},a.setSelectedIds=function(e){a.setState({selectedIds:e})},a.renderDataMenuItem=function(e,t){return e.subMenu?a.renderSubMenu(e,t):e.isDescription?i().createElement("div",{className:"menu-description-item"},e.text):a.renderNormalMenuItem(e)},a.state={selectedIds:[],maxHeight:a.getMaxHeight()},a}(0,s.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e;R.ZP.windowEvent.listen("resize",this.resize),null===(e=this.ref.current)||void 0===e||e.addEventListener("wheel",this.stopPropagation)},a.componentWillUnmount=function(){var e;R.ZP.windowEvent.remove("resize",this.resize),null===(e=this.ref.current)||void 0===e||e.removeEventListener("wheel",this.stopPropagation)},a.render=function(){var e,t=this.props,a=t.visible,n=t.from,r=t.className,s=t.selectable,o=void 0===s||s,l=this.state.maxHeight;n===v.BD.COL&&a&&(0,g.T4)(),this.dataMenu=(0,g.oe)(this.props);var c=null===(e=this.dataMenu)||void 0===e?void 0:e.getInitData(),h=c.selectedIds,d=c.config,u=this.renderDataMenuItem,p=this.handleMenuItemClick;return i().createElement("div",{ref:this.ref,className:"data-context-menu "+r,style:a?void 0:{display:"none"}},i().createElement(m.default,{className:"menu-with-tooltip",onClick:p,visible:a,selectable:o,selectedIds:h,style:{maxHeight:l,overflow:"auto"}},!1,d.map((function(e){return u(e,h)}))))},a.renderNormalMenuItem=function(e,t){var a=this;void 0===t&&(t=!0);var n=e.id,r=e.text,s=e.icon,o=e.description,l=e.tooltip,c=e.callback,h=e.redDot,d=e.disabled,u=e.splitAfter,p=i().createElement(m.default.Item,{id:n,disabled:d,description:o,style:{minWidth:"140px"},icon:s,onClick:function(e){c&&(e.stopPropagation(),c(a.props.spreadsheetApp),a.dataMenu.closeMenu())}},r,h&&this.renderRedDot());return t?i().createElement(i().Fragment,null,i().createElement(w.default,{title:l,disabled:!l,placement:"right",onVisibleChange:function(e){e&&S.ZP.tdwReport({opername:"doc_excel",module:"privacy_fill",action:"view_direction",ver6:_.q.getConfig("isOwner")?1:2})}},p),u&&i().createElement(f.default,null)):i().createElement(i().Fragment,null,p,u&&i().createElement(f.default,null))},a.renderSubMenu=function(e,t){var a=this,n=e.id,r=e.text,s=e.subMenu,o=e.icon,l=e.redDot,c=e.disabled,h=e.splitAfter;return i().createElement(i().Fragment,null,i().createElement(m.default.SubMenu,{id:n,disabled:c,icon:o,style:{minWidth:"140px"},popupClassName:"menu-with-tooltip",title:i().createElement(i().Fragment,null,r,l&&this.renderRedDot())},null===s||void 0===s?void 0:s.map((function(e){return e.subMenu?a.renderSubMenu(e,t):function(){var r=Number(n)===C.d9.SELECT||Number(n)===C.d9.DATE_TIME?n+"_"+e.id:""+e.id,s=Number(n)===C.d9.SELECT&&t.indexOf(r)>=0?i().createElement("span",{className:"menu-item-assist-infos"},p.ZP.t("点击修改")):e.description;return a.renderNormalMenuItem(Object.assign(Object.assign({},e),{id:r,description:s}),!1)}()}))),h&&i().createElement(f.default,null))},a.renderRedDot=function(){return this.props.showRedDot?i().createElement("sup",{className:"data-context-red-dot"},"NEW"):null},t}(i().Component),x=(a("../node_modules/core-js/modules/es.string.replace.js"),a("../node_modules/core-js/modules/es.object.keys.js"),new Image);x.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgIHhtbG5zOnY9Imh0dHBzOi8vdmVjdGEuaW8vbmFubyI+PHBhdGggZD0iTTIgM2g2TDUuMDEyIDd6IiBmaWxsPSIjZmZmIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=";var y=new Image;y.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgIHhtbG5zOnY9Imh0dHBzOi8vdmVjdGEuaW8vbmFubyI+PHBhdGggZD0iTTIgM2g2TDUuMDEyIDd6IiBmaWxsPSIjODE4NjhmIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=";var I,D,A=((n={})[C.ZP.CHECKBOX]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M17.08 4.998l-1.3 1.3L6.3 6.3l-.003 3.699L6.3 14v3.7h11.4v-5.119l1.3-1.3V18a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1l11.08-.002zm2.577 1.823a.65.65 0 0 1 0 .919l-7.672 7.672a.5.5 0 0 1-.707 0l-2.934-2.934a.65.65 0 0 1 .919-.919l2.369 2.369 7.106-7.106a.65.65 0 0 1 .919 0z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.CONTACT]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12 12c3.178 0 7 1.596 7 3.989V19H5v-3.011c0-2.338 3.646-3.915 6.777-3.987L12 12zm0 1.3c-2.835 0-5.541 1.354-5.693 2.581l-.007.108V17.7h11.4v-1.711c0-1.218-2.624-2.607-5.45-2.686L12 13.3zM12 4a3.5 3.5 0 0 1 .192 6.995L12 11a3.5 3.5 0 0 1-.192-6.995L12 4zm0 1.3a2.2 2.2 0 0 0 0 4.4 2.2 2.2 0 0 0 0-4.4z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.DATE_TIME]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M8 4v1h7.75V4H17v1h2a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.75V4H8zm10.7 2.3H5.3v11.4h13.4V6.3zM15 8.512V15.5h-1.142V9.888l-.73.566-.179-.096V9.233l1.021-.721H15zM9.877 8.5c.602.006 1.087.212 1.446.617a2.09 2.09 0 0 1 .522 1.391c0 .27-.046.53-.139.786-.088.207-.23.393-.424.561l-.031.023.033.025a1.79 1.79 0 0 1 .264.272l.105.151.086.161c.119.271.179.555.179.852-.006.653-.2 1.174-.582 1.554-.375.39-.858.588-1.443.594-.455 0-.861-.155-1.212-.465-.308-.271-.521-.647-.637-1.124L8 13.688l.109-.138h.903l.103.075c.074.205.178.368.312.493.128.122.3.184.522.184a.78.78 0 0 0 .595-.256c.161-.156.244-.381.25-.678-.005-.308-.089-.539-.25-.701-.128-.127-.284-.203-.47-.228l-.146-.009h-.491l.012-1.076h.409c.281 0 .492-.079.64-.236a.8.8 0 0 0 .221-.588.87.87 0 0 0-.23-.607c-.149-.152-.341-.231-.58-.236-.168 0-.32.056-.461.173-.115.09-.202.222-.258.398l-.037.14-.108.091h-.903l-.11-.128c.049-.52.249-.96.599-1.316.303-.311.659-.489 1.065-.533l.18-.011z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.EMAIL]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M19 5a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h14zm-.25 2.946L12 12.768 5.25 7.947v8.803h13.5V7.946zm0-1.696H5.25v.399l.113-.158L12 11.231l6.637-4.74.113.159v-.4z" fill="textColor" fill-rule="nonzero"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.ID]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M19 5a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h14zm-.25 1.25H5.25v10.5h13.5V6.25zM17 12v1.3h-6V12h6zM9 9v3H7V9h2zm8 0v1.3h-6V9h6z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.ATTACHMENT]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M11.302 5.56c1.58-1.58 4.141-1.58 5.721 0 1.527 1.527 1.578 3.971.153 5.56l-.153.161-5.241 5.24c-.912.912-2.391.912-3.303 0-.871-.87-.91-2.257-.119-3.175l.119-.128 5.241-5.24c.244-.244.64-.244.884 0 .217.217.241.554.072.797l-.072.087-5.241 5.24c-.424.424-.424 1.111 0 1.535.394.394 1.014.422 1.44.084l.095-.084 5.241-5.24c1.092-1.092 1.092-2.861 0-3.953-1.046-1.046-2.716-1.09-3.814-.131l-.14.131-5.241 5.24c-1.76 1.759-1.76 4.612 0 6.372a4.51 4.51 0 0 0 6.204.16l.168-.16 5.241-5.24c.244-.244.64-.244.884 0 .217.217.241.554.072.797l-.072.087-5.241 5.24a5.76 5.76 0 0 1-8.14 0c-2.187-2.187-2.246-5.696-.177-7.954l.177-.185 5.241-5.24z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.NUMBER]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M6.19 17.884V6.116H5.07L3 8.017v1.355l2.07-1.934v10.446h1.12zm7.568 0v-1.058H8.996l3.875-5.256c.607-.826.887-1.438.887-2.38 0-1.934-1.229-3.174-3.05-3.174-1.852 0-3.05 1.339-3.05 3.19h1.12c0-1.521.903-2.132 1.929-2.132 1.214 0 1.929.843 1.929 2.116 0 .645-.202 1.157-.622 1.736l-4.372 5.901v1.058h6.115zm3.99.116C19.553 18 21 16.843 21 14.678c0-1.471-.576-2.43-1.696-2.876.996-.479 1.494-1.372 1.494-2.612 0-1.917-1.245-3.19-3.05-3.19-1.681 0-2.988 1.124-3.112 3.025h1.12c.109-1.207.825-1.967 1.992-1.967 1.074 0 1.929.744 1.929 2.149 0 1.322-.622 2.132-1.976 2.132h-.233v1.041h.233c1.509 0 2.178.86 2.178 2.281 0 1.438-.934 2.281-2.132 2.281-1.058 0-2.038-.579-2.132-2.05h-1.12C14.589 17.025 16.005 18 17.748 18z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.PHONE_NUM]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M9.941 4.375H6.647c-1.255 0-2.272 1.017-2.272 2.272.424 7.001 5.977 12.554 12.94 12.977 1.293.001 2.31-1.016 2.31-2.271v-3.294c0-.256-.156-.485-.393-.58l-4.118-1.647-.096-.03c-.259-.058-.532.055-.672.289l-.928 1.547-.069-.038c-1.214-.72-2.228-1.734-2.948-2.948l-.039-.07 1.548-.927c.263-.158.373-.483.259-.768l-1.647-4.118c-.095-.237-.325-.393-.58-.393zm-.424 1.25l1.292 3.23-1.601.962c-.279.167-.383.521-.239.812.943 1.912 2.49 3.459 4.402 4.402l.099.039c.269.08.564-.03.713-.278l.961-1.602 3.231 1.292v2.871a1.02 1.02 0 0 1-1.022 1.022c-6.295-.384-11.344-5.433-11.729-11.766.001-.527.459-.984 1.023-.984h2.87z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.TELEPHONE_NUM]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M4.32 14.007l-.536-.525h0l.536.525zm2.502-1.482a.75.75 0 0 0-1.072-1.05l1.072 1.05zm11.429-1.05a.75.75 0 0 0-1.072 1.05l1.072-1.05zm1.43 2.532l-.536.525h0l.536-.525zM5.12 19.75h13.76v-1.5H5.12v1.5zm-.37-1.87v-3.089h-1.5v3.089h1.5zm.106-3.348l1.966-2.007-1.072-1.05-1.966 2.007 1.072 1.05zm12.323-2.007l1.966 2.007 1.072-1.05-1.966-2.007-1.072 1.05zm2.072 2.266v3.089h1.5v-3.089h-1.5zm-.106-.259a.37.37 0 0 1 .106.259h1.5a1.87 1.87 0 0 0-.534-1.309l-1.072 1.05zm-14.394.259a.37.37 0 0 1 .106-.259l-1.072-1.05a1.87 1.87 0 0 0-.534 1.309h1.5zm14.13 4.96a1.87 1.87 0 0 0 1.87-1.87h-1.5a.37.37 0 0 1-.37.37v1.5zm-13.76-1.5a.37.37 0 0 1-.37-.37h-1.5a1.87 1.87 0 0 0 1.87 1.87v-1.5z" fill="textColor"/>\n            <g stroke="textColor" stroke-width="1.5">\n                <path d="M20.997 8.909C20.976 7.443 17.523 5.001 12 5S3.024 7.443 3.003 8.909s.019 3.374 2.292 3.056c2.659-.372 2.496-1.376 2.496-2.811 0-1.001 2.163-1.242 4.209-1.242s4.208.241 4.209 1.242c0 1.435-.164 2.438 2.496 2.811 2.272.318 2.313-1.59 2.292-3.056z"/>\n                <circle cx="12" cy="14" r="2.25"/>\n            </g>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.SELECT]='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12 4a8 8 0 1 1 0 16 8 8 0 1 1 0-16zm0 1.3a6.7 6.7 0 1 0 0 13.4 6.7 6.7 0 0 0 0-13.4zm2.305 5.2l.895.874L12 14.5l-3.2-3.126.895-.874 2.306 2.253 2.305-2.253z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.TEXT]='<svg width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            <path d="M13.075 5L18 18.5h-1.492l-1.46-4.001H8.95L7.491 18.5H6L10.923 5h2.152zM12 6.14l-2.576 7.059h5.15L12 6.14z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.TEMPERATURE]='<svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <path d="M15.481 5c2.304 0 4.014 1.404 4.446 3.816h0-1.404c-.342-1.566-1.44-2.592-3.042-2.592-.846 0-1.656.324-2.214.9-.81.828-.9 1.71-.9 4.392v.291c.007 2.457.12 3.304.9 4.101.558.576 1.368.9 2.214.9 1.602 0 2.736-1.026 3.078-2.592h0 1.368c-.414 2.412-2.16 3.816-4.446 3.816-1.26 0-2.412-.468-3.276-1.332-1.113-1.113-1.199-2.272-1.205-4.582h0v-1.204c.007-2.31.092-3.469 1.205-4.582C13.069 5.468 14.221 5 15.481 5zM6.5 6a2.5 2.5 0 1 1 0 5 2.5 2.5 0 1 1 0-5zm0 1.3a1.2 1.2 0 0 0 0 2.4 1.2 1.2 0 0 0 0-2.4z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.PROGRESS]='<svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <path d="M19 8a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h14zm-3.923 1.25h-4.944l.251.25L5.5 14.384l-.25-.251v.617h4.624l-.258-.269 5.461-5.231zm3.673 0h-1.865l-5.744 5.5h7.609v-5.5zm-9.884 0H5.25v3.616L8.866 9.25z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n[C.ZP.STAR]='<svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12 4c.13 0 .391.128.521.512l1.824 3.584c.13.256.521.64.912.64l4.039.64c.782.128.912.64.391 1.024l-2.997 2.816c-.261.256-.391.768-.391 1.024l.651 3.968c.13.64-.261 1.024-.912.64l-3.388-1.92c-.087-.085-.232-.114-.357-.123l-.164-.005-.194.003c-.141.007-.234.034-.327.125l-3.648 1.92c-.615.363-.998.04-.929-.536l.668-4.072c0-.384-.13-.768-.391-1.024l-2.997-2.816c-.521-.512-.391-1.024.391-1.024l4.039-.64c.391 0 .782-.384.912-.64l1.824-3.584C11.609 4.256 11.87 4 12 4zm0 2.242l-1.231 2.421c-.333.654-1.045 1.24-1.852 1.315l-.032.001-2.734.434 2.034 1.912c.46.451.716 1.072.758 1.72l.006.195-.017.202-.447 2.715 2.436-1.282.067-.049c.222-.146.468-.227.752-.26l.175-.015.25-.003.222.008c.321.024.61.093.878.267l.089.065 2.147 1.217-.437-2.664-.017-.203a2.93 2.93 0 0 1 .651-1.791l.134-.144 2.013-1.892-2.734-.434-.031-.001c-.749-.07-1.417-.58-1.775-1.176l-.077-.139L12 6.242z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n.default='<svg width="24px" height="24px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" >\n            <path d="M18.2931666,13 L19,14.1108073 L12,19 L5,14.1108073 L5.70683345,13 L12,17.3945997 L18.2931666,13 Z M19,9.7 L19,11 L5,11 L5,9.7 L19,9.7 Z M19,5 L19,6.3 L5,6.3 L5,5 L19,5 Z" fill="textColor"></path>\n            <path d="M20 0H4a4 4 0 0 0-4 4v16a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4z" fill="bgColor"/>\n            </svg>',n),b=function(e,t){return Object.keys(A).reduce((function(a,n){var r=new Image;return r.src=function(e,t,a){var n=(a&&A[a]?A[a]:A.default).replace(/textColor/g,e).replace(/bgColor/g,t);return"data:image/svg+xml;base64,"+btoa(n)}(e,t,n),a[n]=r,a}),{})},T={colSelected:{normalIcon:b("#ffffff","transparent"),hoverIcon:b("#ffffff","rgba(255, 255, 255, 0.15)")},colDefault:{normalIcon:b("rgba(0, 0, 0, 0.65)","transparent"),hoverIcon:b("rgba(0, 0, 0, 0.65)","rgba(0, 0, 0, 0.15)")},colSelectedInFilterView:{normalIcon:b("rgba(0, 0, 0, 0.65)","transparent"),hoverIcon:b("rgba(0, 0, 0, 0.65)","rgba(0, 0, 0, 0.15)")},colDefaultInFilterView:{normalIcon:b("#ffffff","transparent"),hoverIcon:b("#ffffff","rgba(255, 255, 255, 0.15)")}},M=a("../packages/model/src/filter-view/filter-view-util.ts"),k=a("../spread-sheet/src/core/view/level-2/CanvasTooltip/index.tsx"),P=(a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../spread-sheet/src/core/feature/dataValidation/constant.ts")),L=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},N=20,j=function(e){function t(t){var n;return(n=e.call(this,t)||this).container=document.createElement("div"),n.handleMouseMove=d()((function(){n.iconShowByHover&&n.renderApi.renderColHead()}),50),n.renderAfterCol=function(e){var t=e.x,a=e.col;0===a&&(n.iconShowByHover=!1),n.collectMoreIconRenderData(t,a)},n.destory=function(){return n.container.style.visibility="hidden",c().unmountComponentAtNode(n.container)},n.checkColRangeCanEdit=function(e){return n.spreadsheetApp.sheetStatus.isCurrentColCanEdit({startCol:e,endCol:e})},n.hidePanel=function(){var e;n.menuShow&&(n.menuShow=!1,n.container.style.visibility="hidden",n.renderPanel(),null===(e=document.getElementById("headerContainer"))||void 0===e||e.removeEventListener("click",n.hidePanel))},n.renderPanel=function(){return L((0,r.Z)(n),void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.menuShow||!this.getColMeta(this.currCol)){e.next=6;break}return c().unmountComponentAtNode(this.container),e.next=4,this.spreadsheetApp.view.getDataValidationPanel();case 4:return e.sent.create({colIndex:this.currCol}),e.abrupt("return");case 6:c().render(i().createElement(E,{visible:this.menuShow,currCol:this.currCol,from:v.BD.COL,spreadsheetApp:this.spreadsheetApp,closeCallBack:this.hidePanel,selection:this.spreadsheetApp.view.getSelection()}),this.container);case 7:case"end":return e.stop()}}),e,this)})))},n.handleDocumentClick=function(e){var t=e.target;t&&t.closest&&(t.closest(".excel-container")||t.closest(".dui-menu-submenu-content")||n.hidePanel())},n.handleClick=function(e){if(0===e.e.button){var t=e.currCol,a=n.areaData.getViewLeftByCol(t)+n.headSize.rowHeadWidth,r=n.rowcolAccessor.getColSetWidth(t),s=n.headSize.colHeadHeight,o=a+r-N-4,i=(s-N)/2;n.checkHover(o,i,N,N)?(n.renderApi.renderColHead(),n.currCol=t,n.updatePosition(t),n.showPanel()):n.hidePanel()}else n.hidePanel()},n.headSize=t.headSize,n.rowcolAccessor=t.rowcolAccessor,n.operateData=t.operateData,n.mouseOperate=t.mouseOperate,n.areaData=t.areaData,n.mainBoard=t.mainBoard,n.spreadsheetApp=t.spreadsheetApp,n.renderApi=t.renderApi,n.container.className="column-menu-container",n.mainBoard.element.appendChild(n.container),n._alloyExcel.onAfterColHeadRender(n.renderAfterCol),a.g.document.addEventListener("click",n.handleDocumentClick),n.mouseOperate.onMousedown(n.handleClick),n.mouseOperate.onMousemove(n.handleMouseMove),n}(0,s.Z)(t,e);var n=t.prototype;return n.isMenuVisible=function(){return this.menuShow},n.showPanel=function(){var e;this.checkColRangeCanEdit(this.currCol)&&(this.menuShow=!0,this.container.style.visibility="visible",this.renderPanel(),null===(e=document.getElementById("headerContainer"))||void 0===e||e.addEventListener("click",this.hidePanel))},n.modifyColHandContainerStyle=function(e){this.colHandContainer||(this.colHandContainer=document.querySelector(".col-dragger-hand")),this.colHandContainer&&e(this.colHandContainer.style)},n.restoreCursorStyle=function(){this.modifyColHandContainerStyle((function(e){return e.removeProperty("cursor")}))},n.fixCursorStyle=function(){this.modifyColHandContainerStyle((function(e){return e.cursor="pointer"}))},n.collectMoreIconRenderData=function(e,t){var a=this.spreadsheetApp.view.getSelection(),n=a.activeCell,r=a.selectQueue,s=this.rowcolAccessor.getColSetWidth(t),o=this.headSize.colHeadHeight,i=this.getColMeta(t),l=this.checkHover(e,0,s,o),c=n.colIndex===t,h=!!(null===r||void 0===r?void 0:r.find((function(e){return e.selectCol&&e.xRange[0]<=t&&e.xRange[1]>=t})));if((i||c||l)&&this.checkColRangeCanEdit(t)){var d=e+s-4-N,u=o/2-10,m=this.checkHover(d,u,N,20);this.iconShowByHover=this.iconShowByHover||!c&&l||m;var v=function(e){var t,a=e.isColSelected,n=e.isIconHovered,r=e.colDataType;t=e.isInFilterView?a?T.colSelectedInFilterView:T.colDefaultInFilterView:a?T.colSelected:T.colDefault;var s=n?t.hoverIcon:t.normalIcon;return s[r||""]||s.default}({isColSelected:h,isIconHovered:m,isColActive:c,colDataType:null===i||void 0===i?void 0:i.customDataType,isInFilterView:(0,M.xJ)(this.spreadsheetApp.spreadsheet)}),f=function(e){if(!e)return p.ZP.t("设置列类型");var t="";return Object.keys(P.rX).forEach((function(a){P.rX[a].customDataType===e.customDataType&&(t+=P.rX[a].text)})),e.customDataType===C.ZP.SELECT&&e.config&&(t=e.config.isMultiSelect?p.ZP.t("多选"):p.ZP.t("单选")),t?p.ZP.t("列类型：{{text}}",{text:t}):p.ZP.t("设置列类型")}(i);f&&(0,k.H)({x:d,y:u,width:N,height:20},{visible:m&&!this.menuShow,title:f,placement:"bottom"}),this.checkHover(d,u,N,20)?this.fixCursorStyle():this.operateData.currCol===t&&this.restoreCursorStyle(),this._alloyExcel.collectEngine.bitmapCollector.collect({dx:d,dy:u,dWidth:N,dHeight:20,img:v})}},n.updatePosition=function(e){var t=this.areaData.getDisplayViewRightByCol(e)-4-N;document.body.clientWidth-t<240&&(t-=240-(document.body.clientWidth-t)),this.container.style.top="0px",this.container.style.left=t+"px"},n.checkHover=function(e,t,a,n){var r=this.operateData,s=r.currX,o=r.currY,i=(r.e||{}).target,l=this.mainBoard.element.parentElement;return!(i&&!(null===l||void 0===l?void 0:l.contains(i)))&&(s>=e-4&&s<=e+a+4&&o>=t-4&&o<=t+n+4)},n.getColMeta=function(e){var t;return null===(t=this.spreadsheetApp.spreadsheet.activeSheet.getColProperties(e))||void 0===t?void 0:t.columnTypeMetadata},t}(u.Z),O=a("../packages/model/src/index.ts"),H=a("../spread-sheet/src/core/view/utils/base-func.ts");!function(e){e[e.NO_NUMBER=0]="NO_NUMBER",e[e.BEYOND_LIMIT=1]="BEYOND_LIMIT",e[e.TOO_MANY=2]="TOO_MANY"}(I||(I={})),function(e){e[e.ENTER=13]="ENTER"}(D||(D={}));var B=function(){function e(e){var t=this;this.checkShowHide=(0,H.ad)((function(){t.areaData.row.flow.renderTo>=t.areaData.row.flow.to?(t.update(),t.show()):t.hide()})),this.hasErrorReport=!1,this.hasExpandReport=!1,this.container=document.createElement("div"),this.board=document.createElement("div"),this.input=document.createElement("input"),this.button=document.createElement("button"),this.error=document.createElement("div"),this.sheetPool={},this.showing=!1,this.update=function(){t.board.style.top=t.areaData.getDisplayViewTopByRow(t.areaData.row.flow.renderTo+1)-t.headSize.displayColHeadHeight+"px",t.container.style.top=t.headSize.displayColHeadHeight+1+"px"},this.show=function(){t.showing||(t.showing=!0,t.container.style.display="block",S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"show_insert_row"}))},this.hide=function(){t.showing&&(t.showing=!1,t.container.style.display="none")},this.switchSheet=function(){t.hideError(),t.setInputValue()},this.spreadsheetApp=e.spreadsheetApp,this.spreadsheet=e.spreadsheet,this.areaData=e.areaData,this.mainBoard=e.mainBoard,this.headSize=e.headSize,this.modifyDimensionBroker=e.modifyDimensionBroker,this.modifySelectionBroker=e.modifySelectionBroker,this.scrollApi=e.scrollApi,this.sheetStatus=e.sheetStatus,this.initUI(),this.initEvent(),this.setInputValue(),this.checkShowHide(),this.sheetStatus.canEdit?this.switchToEditable():this.switchToReadonly(),this.listenStatusChange()}var t=e.prototype;return t.refresh=function(){this.hide()},t.setInputValue=function(){var e=this.spreadsheet.activeSheetId;if(void 0===this.sheetPool[e]){var t=this.getRecommendRows();this.sheetPool[e]=t}this.input.value=String(this.sheetPool[e])},t.getRowCount=function(){var e=this.spreadsheet.activeSheet;return O.Config.MAX_CELL_COUNT/e.getColCount()>>0},t.getValidRows=function(){var e=this.spreadsheet.activeSheet;return this.getRowCount()-e.getRowCount()},t.showError=function(e){this.setErrorText(e),this.error.style.display="inline-block"},t.getRecommendRows=function(){var e=this.getValidRows();return e<10&&S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"insert_row_under10"}),Math.min(Math.max(e,0),10)},t.setErrorText=function(e){var t;switch(e){case I.NO_NUMBER:t=p.ZP.t("请输入数字。");break;case I.BEYOND_LIMIT:t=this.getMaxRowsErrorText(),this.handleErrorReport();break;case I.TOO_MANY:t=p.ZP.t("一次插入过多行，推荐分批插入。");break;default:return void(null===a.g||void 0===a.g||a.g.log.error("dimension-edit","unknown error"))}this.error.innerText=t},t.expandRows=function(){var e=this.spreadsheet.activeSheet,t=parseInt(this.input.value,10);if(isNaN(t))this.showError(I.NO_NUMBER);else{var a=this.getRowCount(),n=e.getRowCount();n+t>a||(n+t)*e.getColCount()>O.Config.MAX_CELL_COUNT?this.showError(I.BEYOND_LIMIT):t>=2500?this.showError(I.TOO_MANY):t<=0||(this.modifyDimensionBroker.insertRow([{index:n,amount:t}]),this.modifySelectionBroker.setSelection({yRange:[n,n+t-1],activation:{row:n,col:0}}),this.scrollApi.scrollByPixel({areaY:"flow",diffY:t*O.Config.DEFAULT_ROW_HEIGHT}),this.hideError(),this.handleExpandReport())}},t.listenStatusChange=function(){var e=this;this.sheetStatus.change((function(){return e.sheetStatus.canEdit?e.switchToEditable():e.switchToReadonly()}))},t.switchToReadonly=function(){var e,t;this.hide(),null===(e=this.updateOffsetDispose)||void 0===e||e.dispose(),null===(t=this.updateTotalSizeDispose)||void 0===t||t.dispose(),this.spreadsheetApp.event.sheetsBar.remove("switchSheetEnd",this.switchSheet),this.areaData.row.flow.setDisplaySafeDistance(30)},t.switchToEditable=function(){this.updateOffsetDispose=this.areaData.onUpdateOffset(this.checkShowHide),this.updateTotalSizeDispose=this.areaData.row.flow.onUpdateTotalSize(this.checkShowHide),this.spreadsheetApp.event.sheetsBar.listen("switchSheetEnd",this.switchSheet),this.areaData.row.flow.setDisplaySafeDistance(90)},t.getMaxRowsErrorText=function(){var e=this.getValidRows();return e<=0?p.ZP.t("超出最大单元格数量，建议删除无用行列后再试。"):p.ZP.t("超出最大单元格数量，请输入{{maxRows}}行内的数值。",{maxRows:e})},t.handleExpandReport=function(){this.hasExpandReport||(S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"insert_row_amount"}),this.hasExpandReport=!0)},t.handleErrorReport=function(){S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"insert_row_error"}),this.hasErrorReport||(S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"insert_row_error_amount"}),this.hasErrorReport=!0)},t.hideError=function(){this.error.innerText="",this.error.style.display="none"},t.initUI=function(){this.container.className="expand-row-container",this.board.className="expand-row-board";var e=document.createElement("div");e.className="expand-row-info",e.innerText=p.ZP.t("在底部添加"),this.board.appendChild(e),this.input.className="expand-row-input",this.input.setAttribute("type","text"),this.board.appendChild(this.input);var t=document.createElement("div");t.className="expand-row-info",t.innerText=p.ZP.t("行"),this.board.appendChild(t),this.button.className="expand-row-button",this.button.innerText=p.ZP.t("添加"),this.board.appendChild(this.button),this.error.className="expand-row-error",this.board.appendChild(this.error),this.container.appendChild(this.board),this.mainBoard.element.appendChild(this.container)},t.initEvent=function(){var e=this;this.button.addEventListener("click",(function(){e.expandRows()})),this.input.addEventListener("keydown",(function(t){t.stopPropagation(),t.keyCode===D.ENTER&&e.expandRows()})),this.input.addEventListener("blur",(function(){var t=parseInt(e.input.value,10);isNaN(t)||(e.sheetPool[e.spreadsheet.activeSheetId]=t)}))},e}(),V=a("../spread-sheet/src/core/ui/dialog/index.ts"),Z=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},F=function(){function e(e){var t=this;this.checkShowHide=(0,H.ad)((function(){t.areaData.row.flow.renderTo>=t.areaData.row.flow.to?(t.update(),t.show()):t.hide()})),this.hasExpandReport=!1,this.showing=!1,this.button=document.createElement("div"),this.buttonIcon=document.createElement("div"),this.board=document.createElement("div"),this.update=function(){t.board.style.top=t.areaData.getDisplayViewTopByRow(t.areaData.row.flow.renderTo+1)+t.headSize.displayColHeadHeight+9+"px",t.button.style.height=O.Config.DEFAULT_ROW_HEIGHT*t.scale.scale-2+"px",t.button.style.width=t.headSize.displayRowHeadWidth+1+"px",t.buttonIcon.style.width=O.Config.DEFAULT_ROW_HEIGHT*t.scale.scale-2+"px",t.buttonIcon.style.height=O.Config.DEFAULT_ROW_HEIGHT*t.scale.scale-2+"px"},this.show=function(){t.showing||(t.showing=!0,t.board.style.display="block",t.update(),S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"show_insert_row"}))},this.hide=function(){t.showing&&(t.showing=!1,t.board.style.display="none")},this.expandOneRows=function(){return Z(t,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.spreadsheet.activeSheet,a=t.getRowCount(),n=this.getRowCount(),!(a+1>n)){e.next=7;break}return V.dialog.confirm({title:p.ZP.t("插入行列失败"),content:p.ZP.t("已达最大行列限制，建议删除无用行列或新建一个工作表。")}),e.abrupt("return");case 7:return e.next=9,this.modifyDimensionBroker.insertRow([{index:a,amount:1}]);case 9:this.modifySelectionBroker.setSelection({yRange:[a,a],activation:{row:a,col:0}}),this.handleExpandReport(),this.scrollApi.scrollByPixel({areaY:"flow",diffY:O.Config.DEFAULT_ROW_HEIGHT});case 12:case"end":return e.stop()}}),e,this)})))},this.spreadsheet=e.spreadsheet,this.areaData=e.areaData,this.container=e.container,this.modifyDimensionBroker=e.modifyDimensionBroker,this.modifySelectionBroker=e.modifySelectionBroker,this.scrollApi=e.scrollApi,this.headSize=e.headSize,this.sheetStatus=e.sheetStatus,this.scale=e.scale,this.initUI(),this.initMouse(),this.checkShowHide(),this.sheetStatus.canEdit?this.switchToEditable():this.switchToReadonly(),this.listenStatusChange()}var t=e.prototype;return t.refresh=function(){this.hide()},t.listenStatusChange=function(){var e=this;this.sheetStatus.change((function(){return e.sheetStatus.canEdit?e.switchToEditable():e.switchToReadonly()}))},t.switchToReadonly=function(){var e,t;this.hide(),null===(e=this.updateOffsetDispose)||void 0===e||e.dispose(),null===(t=this.updateTotalSizeDispose)||void 0===t||t.dispose()},t.switchToEditable=function(){this.updateOffsetDispose=this.areaData.onUpdateOffset(this.checkShowHide),this.updateTotalSizeDispose=this.areaData.row.flow.onUpdateTotalSize(this.checkShowHide)},t.getRowCount=function(){var e=this.spreadsheet.activeSheet;return O.Config.MAX_CELL_COUNT/e.getColCount()>>0},t.handleExpandReport=function(){this.hasExpandReport||(S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"insert_row_amount"}),this.hasExpandReport=!0)},t.initUI=function(){this.board.className="expand-one-row-board",this.board.setAttribute("aria-hidden","true"),this.button.className="expand-one-row-button",this.button.setAttribute("title",p.ZP.t("向下增加一行")),this.buttonIcon.className="expand-one-row-button-icon",this.buttonIcon.setAttribute("data-testid","expand-one-row-button-icon"),this.buttonIcon.innerHTML='<svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="6.17" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="as">\n                <g>\n                    <rect id="Rectangle" fill="#000000" opacity="0" x="0" y="0" width="22" height="22"></rect>\n                    <path d="M11,19 C6.581722,19 3,15.418278 3,11 C3,6.581722 6.581722,3 11,3 C15.418278,3 19,6.581722 19,11 C19,15.418278 15.418278,19 11,19 Z M11,17.75 C14.7279221,17.75 17.75,14.7279221 17.75,11 C17.75,7.27207794 14.7279221,4.25 11,4.25 C7.27207794,4.25 4.25,7.27207794 4.25,11 C4.25,14.7279221 7.27207794,17.75 11,17.75 Z M10.35,10.35 L10.35,7 L11.65,7 L11.65,10.35 L15,10.35 L15,11.65 L11.65,11.65 L11.65,15 L10.35,15 L10.35,11.65 L7,11.65 L7,10.35 L10.35,10.35 Z" fill="#000000" fill-rule="nonzero"></path>\n                </g>\n            </g>\n        </g>\n    </svg>',this.button.appendChild(this.buttonIcon),this.board.appendChild(this.button),this.container.appendChild(this.board)},t.initMouse=function(){this.button.addEventListener("click",this.expandOneRows)},e}(),U=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},z=function(){function e(e){var t=this;this.checkShowHide=(0,H.ad)((function(){t.areaData.col.flow.renderTo>=t.areaData.col.flow.to?(t.update(),t.show()):t.hide()})),this.hasExpandReport=!1,this.showing=!1,this.button=document.createElement("div"),this.buttonIcon=document.createElement("div"),this.board=document.createElement("div"),this.update=function(){t.board.style.left=t.areaData.getDisplayViewLeftByCol(t.areaData.col.flow.to+1)+t.headSize.displayRowHeadWidth+9+"px",t.button.style.height=t.headSize.displayColHeadHeight+1+"px",t.button.style.width=t.headSize.displayColHeadHeight+1+"px"},this.show=function(){t.showing||(t.showing=!0,t.board.style.display="block",t.update(),S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"show_insert_row"}))},this.hide=function(){t.showing&&(t.showing=!1,t.board.style.display="none")},this.expandOneCols=function(){return U(t,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.spreadsheet.activeSheet,a=t.getColCount(),n=this.getColCount(),!(a+1>n)){e.next=7;break}return V.dialog.confirm({title:p.ZP.t("插入行列失败"),content:p.ZP.t("已达最大行列限制，建议删除无用行列或新建一个工作表。")}),e.abrupt("return");case 7:return e.next=9,this.modifyDimensionBroker.insertCol([{index:a,amount:1}]);case 9:this.modifySelectionBroker.setSelection({xRange:[a,a],activation:{col:a,row:0}}),this.scrollApi.scrollByPixel({areaX:"flow",diffX:O.Config.DEFAULT_COL_WIDTH}),this.handleExpandReport();case 12:case"end":return e.stop()}}),e,this)})))},this.spreadsheet=e.spreadsheet,this.areaData=e.areaData,this.container=e.container,this.modifyDimensionBroker=e.modifyDimensionBroker,this.modifySelectionBroker=e.modifySelectionBroker,this.scrollApi=e.scrollApi,this.headSize=e.headSize,this.sheetStatus=e.sheetStatus,this.scale=e.scale,this.initUI(),this.initMouse(),this.checkShowHide(),this.sheetStatus.canEdit?this.switchToEditable():this.switchToReadonly(),this.listenStatusChange()}var t=e.prototype;return t.refresh=function(){this.hide()},t.listenStatusChange=function(){var e=this;this.sheetStatus.change((function(){return e.sheetStatus.canEdit?e.switchToEditable():e.switchToReadonly()}))},t.switchToReadonly=function(){var e,t;this.hide(),null===(e=this.updateOffsetDispose)||void 0===e||e.dispose(),null===(t=this.updateTotalSizeDispose)||void 0===t||t.dispose(),this.areaData.col.flow.setDisplaySafeDistance(30)},t.switchToEditable=function(){this.updateOffsetDispose=this.areaData.onUpdateOffset(this.checkShowHide),this.updateTotalSizeDispose=this.areaData.col.flow.onUpdateTotalSize(this.checkShowHide),this.areaData.col.flow.setDisplaySafeDistance(50)},t.getColCount=function(){var e=this.spreadsheet.activeSheet;return O.Config.MAX_CELL_COUNT/e.getRowCount()>>0},t.handleExpandReport=function(){this.hasExpandReport||(S.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_row_panel",action:"insert_row_amount"}),this.hasExpandReport=!0)},t.initUI=function(){this.board.className="expand-one-col-board",this.board.setAttribute("aria-hidden","true"),this.button.className="expand-one-col-button",this.button.setAttribute("data-testid","expand-one-col-button"),this.button.title=p.ZP.t("向右增加一列"),this.buttonIcon.innerHTML='<svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="6.17" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="as">\n                <g>\n                    <rect id="Rectangle" fill="#000000" opacity="0" x="0" y="0" width="22" height="22"></rect>\n                    <path d="M11,19 C6.581722,19 3,15.418278 3,11 C3,6.581722 6.581722,3 11,3 C15.418278,3 19,6.581722 19,11 C19,15.418278 15.418278,19 11,19 Z M11,17.75 C14.7279221,17.75 17.75,14.7279221 17.75,11 C17.75,7.27207794 14.7279221,4.25 11,4.25 C7.27207794,4.25 4.25,7.27207794 4.25,11 C4.25,14.7279221 7.27207794,17.75 11,17.75 Z M10.35,10.35 L10.35,7 L11.65,7 L11.65,10.35 L15,10.35 L15,11.65 L11.65,11.65 L11.65,15 L10.35,15 L10.35,11.65 L7,11.65 L7,10.35 L10.35,10.35 Z" fill="#000000" fill-rule="nonzero"></path>\n                </g>\n            </g>\n        </g>\n    </svg>',this.button.appendChild(this.buttonIcon),this.board.appendChild(this.button),this.container.appendChild(this.board)},t.initMouse=function(){this.button.addEventListener("click",this.expandOneCols)},e}(),W=function(){function e(e){this.expandRows=new B(e),this.expandSingleRow=new F(e),this.expandSingleCol=new z(e)}var t=e.prototype;return t.getExpandRows=function(){return this.expandRows},t.getExpandSingleRow=function(){return this.expandSingleRow},t.getExpandSingleCol=function(){return this.expandSingleCol},t.refresh=function(){this.expandRows.refresh(),this.expandSingleRow.refresh(),this.expandSingleCol.refresh()},e}(),G=function(){},Y=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),K=a("../spread-sheet/src/core/view/level-1/auto-scroll/AutoScroll.ts"),X=a("../node_modules/@tencent/dui/lib/components/Modal/index.js"),J=function(){function e(e){var t=this;this.handle=document.createElement("div"),this.line=document.createElement("div"),this.ruler=document.createElement("div"),this.showing=!1,this.focusCol=-1,this.cacheX=0,this.cacheOffsetSize=0,this.updateHandleHeight=function(){t.handle.style.height=t.headSize.displayColHeadHeight+"px"},this.updateLineHeight=function(){t.line.style.height=t.clientRect.height+"px"},this.checkMousemove=function(){if(t.sheetStatus.canEdit&&!t.operateData.stopPropagation&&!t.operateData.isMovingRowOrCol)if(t.operateData.isOverTable())t.hideHandle();else if(-1===t.operateData.currRow&&-1!==t.operateData.currCol){for(var e=t.operateData.currCol,a=e-1;a<=e;a++){var n=t.areaData.getDisplayViewRightByCol(a)+t.headSize.displayRowHeadWidth;if(Math.abs(n-t.operateData.displayCurrX)<3)return void t.showHandle(a)}t.hideHandle()}else t.hideHandle()},this.hideHandle=function(){t.showing&&(t.showing=!1,t.focusCol=-1,t.handle.style.display="none",t.cacheOffsetSize=0)},this.handleMousedown=function(){t.showLineRuler(),t.cacheX=t.operateData.displayCurrX,t.cacheOffsetSize=t.areaData.col.flow.offsetSize,t.updateRulerValue(t.operateData.displayCurrX),t.mousemoveDisposable.dispose(),document.addEventListener("mousemove",t.handleMousemove),document.addEventListener("mouseup",t.handleMouseup),t.autoScroll.ready(K.OD.X,t.clientRect.width-10)},this.handleMousemove=function(){var e=Math.max(t.areaData.getDisplayViewLeftByCol(t.focusCol)+t.headSize.displayRowHeadWidth,t.operateData.displayCurrX);t.handle.style.left=e+"px",t.updateRulerValue(t.operateData.displayCurrX)},this.handleMouseup=function(){if(t.mousemoveDisposable=t.mouseOperate.onMousemove(t.checkMousemove),document.removeEventListener("mousemove",t.handleMousemove),document.removeEventListener("mouseup",t.handleMouseup),t.canColUpdate()){var e=Math.max(t.areaData.getDisplayViewLeftByCol(t.focusCol)+t.headSize.displayRowHeadWidth,t.operateData.displayCurrX),a=t.areaData.col.flow.offsetSize-t.cacheOffsetSize,n=e-t.cacheX+a;if(Math.abs(n)>=1){var r=Math.max(0,n/t.scale.scale+t.rowcolAccessor.getColSetWidth(t.focusCol))>>0;t.propsSetColWidth(t.focusCol,r)}t.hideLineRuler()}},this.handleDblclick=function(){t.propsSetColAutoFit(t.focusCol),t.hideHandle()},this.container=e.container,this.headSize=e.headSize,this.clientRect=e.clientRect,this.resize=e.resize,this.scale=e.scale,this.mouseOperate=e.mouseOperate,this.areaData=e.areaData,this.rowcolAccessor=e.rowcolAccessor,this.propsSetColAutoFit=e.setColAutoFit,this.propsSetColWidth=e.setColWidth,this.operateData=e.operateData,this.sheetStatus=e.sheetStatus,this.autoScroll=e.autoScroll,this.handle.classList.add("resizer-vertical-handle"),this.line.classList.add("resizer-vertical-line"),this.ruler.classList.add("resizer-vertical-ruler"),this.handle.appendChild(this.line),this.handle.appendChild(this.ruler),this.container.appendChild(this.handle),this.updateHandleHeight(),this.updateLineHeight(),this.initEvent()}var t=e.prototype;return t.showHandle=function(e){this.showing&&this.focusCol===e||(this.showing=!0,this.focusCol=e,this.handle.style.left=this.areaData.getDisplayViewRightByCol(e)+this.headSize.displayRowHeadWidth-2+"px",this.handle.style.display="block")},t.showLineRuler=function(){this.line.style.display="block",this.ruler.style.display="block"},t.hideLineRuler=function(){this.line.style.display="none",this.ruler.style.display="none"},t.initEvent=function(){this.resize.onResize(this.updateLineHeight),this.scale.onScale(this.updateHandleHeight),this.mousemoveDisposable=this.mouseOperate.onMousemove(this.checkMousemove),this.handle.addEventListener("contextmenu",H.p7),this.handle.addEventListener("mousedown",this.handleMousedown),this.handle.addEventListener("dblclick",this.handleDblclick)},t.updateRulerValue=function(e){var t=this.areaData.col.flow.offsetSize-this.cacheOffsetSize,a=e-this.cacheX+t,n=Math.max(0,a/this.scale.scale+this.rowcolAccessor.getColSetWidth(this.focusCol))>>0;this.ruler.innerText=p.ZP.t("宽度：{{width}}像素",{width:n})},t.canColUpdate=function(){return!!this.sheetStatus.isCurrentColCanEdit({startCol:this.focusCol,endCol:this.focusCol})||(X.default.confirm({title:p.ZP.t("保护范围提示"),content:p.ZP.t("创建者「{{value}}」设置了保护范围，你没有权限进行此操作。如需编辑，请联系创建者授予权限。",{value:window.clientVars.ownerNick}),cancelText:null,okText:p.ZP.t("确定")}),!1)},e}(),q=(a("../node_modules/core-js/modules/es.number.max-safe-integer.js"),a("../spread-sheet/src/core/view/level-1/select-center/base/utils.ts")),$=function(){function e(e,t){var a=this;this.dragBoard=t,this.line=document.createElement("div"),this.bar=document.createElement("div"),this.rect=document.createElement("div"),this.cacheStartCol=-1,this.cacheEndCol=-1,this.cacheMoveTo=-1,this.cacheDiff=0,this.handleMousedown=function(){a.sheetStatus.canEdit&&!a.operateData.isOverTable()&&-1===a.operateData.currRow&&-1!==a.operateData.currCol&&1===a.normalSelectData.selectQueue.length&&(0,q.rl)(a.operateData.currCol,a.normalSelectData)&&0===a.operateData.e.button&&!a.operateData.e.ctrlKey&&(a.operateData.e.preventDefault(),a.showMove(),a.operateData.isMovingRowOrCol=!0,document.addEventListener("mousemove",a.handleMousemove),document.addEventListener("mouseup",a.handleMouseup),a.autoScroll.ready(K.OD.X,a.clientRect.width-10))},this.handleMouseup=function(){document.removeEventListener("mousemove",a.handleMousemove),document.removeEventListener("mouseup",a.handleMouseup),(a.cacheMoveTo<a.cacheStartCol||a.cacheMoveTo>a.cacheEndCol+1)&&a.cacheMoveTo>=0&&a.cacheMoveTo<=a.rowcolAccessor.getColCount()&&a.propsMoveCol([a.cacheStartCol,a.cacheEndCol],a.cacheMoveTo),a.hideMove()},this.handleMousemove=function(e){e.stopPropagation(),a.operateData.stopPropagation=!0,a.updateElements()},this.hideMove=function(){a.line.style.display="none",a.bar.style.display="none",a.cacheStartCol=-1,a.cacheEndCol=-1,a.cacheMoveTo=-1,a.cacheDiff=0,a.operateData.isMovingRowOrCol=!1},this.updateElements=function(){var e=a.cacheStartCol,t=a.cacheEndCol,n=Math.max(a.headSize.displayRowHeadWidth,a.areaData.getDisplayViewLeftByCol(e)+a.headSize.displayRowHeadWidth),r=a.areaData.getDisplayViewRightByCol(t)+a.headSize.displayRowHeadWidth-n;a.operateData.currCol<0?a.cacheMoveTo=a.areaData.getFirstColInView():a.operateData.currCol===Number.MAX_SAFE_INTEGER?a.cacheMoveTo=a.areaData.getLastColInView():a.cacheMoveTo=a.calcMoveToCol();var s=Math.max(a.headSize.displayRowHeadWidth,a.areaData.getDisplayViewLeftByCol(a.cacheMoveTo)+a.headSize.displayRowHeadWidth);a.line.style.left=s-2+"px",a.line.style.top=a.headSize.displayColHeadHeight+"px",a.bar.style.top="0px",a.bar.style.width=r+"px",a.bar.style.left=a.operateData.displayCurrX-a.cacheDiff+"px",a.bar.style.height=a.areaData.row.frozen.displayTotalSize+a.areaData.row.flow.displayTotalSize+"px",a.rect.style.top=a.headSize.displayColHeadHeight+"px"},this.container=e.container,this.headSize=e.headSize,this.clientRect=e.clientRect,this.resize=e.resize,this.scale=e.scale,this.mouseOperate=e.mouseOperate,this.areaData=e.areaData,this.rowcolAccessor=e.rowcolAccessor,this.normalSelectData=e.normalSelectData,this.operateData=e.operateData,this.autoScroll=e.autoScroll,this.sheetStatus=e.sheetStatus,this.propsMoveCol=e.moveCol,this.line.classList.add("move-vertical-line"),this.bar.classList.add("move-vertical-bar"),this.rect.classList.add("move-vertical-rect"),this.bar.appendChild(this.rect),this.container.appendChild(this.line),this.container.appendChild(this.bar),this.initEvent()}var t=e.prototype;return t.initEvent=function(){this.dragBoard.addEventListener("mousedown",this.handleMousedown,!0)},t.showMove=function(){var e,t,a=this.normalSelectData.selectQueue[0];if(!a)throw new Error("移动列异常");if(a.selectCol&&!a.selectRow){var n=a.xRange;e=n[0],t=n[1],this.line.style.height=this.clientRect.height+"px",this.line.style.display="block",this.bar.style.display="block",this.cacheStartCol=e,this.cacheEndCol=t,this.cacheDiff=this.operateData.displayStartX-this.areaData.getDisplayViewLeftByCol(e)-this.headSize.displayRowHeadWidth,this.updateElements();var r=t-e+1>1?"movemorecol":"moveonecol";S.ZP.tdwReport({module:"exceldimension",opername:"docexceleditor",action:r})}},t.calcMoveToCol=function(){var e=this.areaData.getColByDisplayViewLeft(this.operateData.displayCurrX-this.headSize.displayRowHeadWidth);if(e>=this.cacheStartCol&&e<=this.cacheEndCol)return this.cacheStartCol;var t=this.areaData.getDisplayViewLeftByCol(e)+this.headSize.displayRowHeadWidth,a=this.areaData.getDisplayViewRightByCol(e)+this.headSize.displayRowHeadWidth;return this.operateData.displayCurrX-t>a-this.operateData.displayCurrX?e+1:e},e}(),Q=function(){function e(e){var t=this;this.operateBoard=document.createElement("div"),this.onOperateBoardMousedown=function(){t.sheetStatus.canEdit&&!t.operateData.isOverTable()&&t.isOperateInColHead()&&1===t.normalSelectData.selectQueue.length&&0===t.operateData.e.button||t.hide()},this.onSelectionModified=function(){var e=t.normalSelectData.selectQueue[0];if(t.sheetStatus.canEdit&&(null===e||void 0===e?void 0:e.selectCol)){var a=e.xRange[0],n=e.xRange[1];t.show(),t.updateElement(a,n)}},this.updateElement=function(e,a){var n=t.getColRangeRect(e,a);t.board.style.left=n.left+"px",t.board.style.width=n.width+"px",t.board.style.height=n.height+"px"},this.headSize=e.headSize,this.areaData=e.areaData,this.sheetStatus=e.sheetStatus,this.operateData=e.operateData,this.mouseOperate=e.mouseOperate,this.normalSelectData=e.normalSelectData,this.container=e.operateBoard.board,this.operateBoard.classList.add("col-dragger-hand"),this.operateBoard.setAttribute("data-testid","col-dragger-hand"),this.container.appendChild(this.operateBoard),this.initEvents()}var t=e.prototype;return t.initEvents=function(){this.mouseOperate.onMousedown(this.onOperateBoardMousedown),this.normalSelectData.onModifySelectData(this.onSelectionModified)},t.isOperateInColHead=function(){var e=this.operateData,t=e.currRow,a=e.currCol;return-1===t&&-1!==a},t.getColRangeRect=function(e,t){var a=this.headSize,n=a.displayRowHeadWidth,r=a.displayColHeadHeight,s=this.areaData.getDisplayViewLeftByCol(e),o=this.areaData.getDisplayViewRightByCol(t),i=Math.max(n,s+n);return{left:i,width:o+n-i,height:r}},t.show=function(){this.board.style.display="block"},t.hide=function(){this.board.style.display=""},(0,Y.Z)(e,[{key:"board",get:function(){return this.operateBoard}}]),e}(),ee=function(){function e(e){this.board=document.createElement("div"),this.container=e.container,this.board.classList.add("col-head-board"),this.container.appendChild(this.board),e.container=this.board,this.resizeOperateBoard=new J(e),this.draggerOperateBoard=new Q(e),this.moveOperateBoard=new $(e,this.draggerOperateBoard.board),e.container=this.container}return(0,Y.Z)(e,[{key:"resizeBoard",get:function(){return this.resizeOperateBoard}},{key:"moveBoard",get:function(){return this.moveOperateBoard}},{key:"draggerBoard",get:function(){return this.draggerOperateBoard}}]),e}(),te=(a("../node_modules/core-js/modules/es.array.slice.js"),a("../node_modules/core-js/modules/es.function.name.js"),a("../node_modules/core-js/modules/es.array.from.js"),a("../node_modules/core-js/modules/es.string.iterator.js"),a("../node_modules/core-js/modules/es.symbol.iterator.js"),a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/@tencent/docs-user-agent/dist/index.js")),ae=a.n(te);function ne(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(e){if("string"===typeof e)return re(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?re(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var se=function(){function e(e){this.normalSelectData=e.normalSelectData,this.modifyDimensionBroker=e.modifyDimensionBroker,this.modifySelectionBroker=e.modifySelectionBroker,this.rowcolAccessor=e.rowcolAccessor}var t=e.prototype;return t.getSelectColRange=function(){for(var e,t=[],a=ne(this.normalSelectData.selectQueue);!(e=a()).done;){var n=e.value;n.selectAll?t.push([0,this.rowcolAccessor.getColCount()-1]):n.selectCol&&t.push([n.xRange[0],n.xRange[1]])}return t},t.setColWidth=function(e,t){if(t<=(ae().isMobile?15:5))if((0,q.rl)(e,this.normalSelectData)){var a=this.getSelectColRange()[0];this.modifyDimensionBroker.hideCols([{index:a[0],amount:a[1]-a[0]+1}])}else this.modifyDimensionBroker.hideCols([{index:e,amount:1}]);else{var n;if((0,q.rl)(e,this.normalSelectData)){var r=this.getSelectColRange();this.modifyDimensionBroker.setColWidth(r,t),n="drag_n1col_size"}else this.modifyDimensionBroker.setColWidth([[e,e]],t),n="drag_1col_size";S.ZP.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:n})}},t.setColAutoFit=function(e){var t;if((0,q.rl)(e,this.normalSelectData)){var a=this.getSelectColRange();this.modifyDimensionBroker.setColWidthAutoFit(a),t="clk_auto_ncol_size"}else this.modifyDimensionBroker.setColWidthAutoFit([[e,e]]),t="clk_auto_1col_size";S.ZP.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:t})},t.moveCol=function(e,t){var a=this;this.modifyDimensionBroker.moveCols(e,t).then((function(){var n=t<e[0]?t:t-(e[1]-e[0]+1);a.modifySelectionBroker.setSelection({xRange:[n,n+e[1]-e[0]],activation:{row:a.normalSelectData.activeRow,col:n+a.normalSelectData.activeCol-e[0]}})}));var n=e[1]-e[0]>0?"more":"one";S.ZP.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:"move_"+n+"_col"})},e}(),oe=function(e){function t(t){var a;return(a=e.call(this,t)||this).board=new ee(Object.assign(Object.assign({},t),{setColWidth:a.setColWidth.bind((0,r.Z)(a)),setColAutoFit:a.setColAutoFit.bind((0,r.Z)(a)),moveCol:a.moveCol.bind((0,r.Z)(a))})),a}return(0,s.Z)(t,e),t}(se),ie=function(){function e(e){var t=this;this.handle=document.createElement("div"),this.line=document.createElement("div"),this.ruler=document.createElement("div"),this.showing=!1,this.focusRow=-1,this.cacheY=0,this.cacheOffsetSize=0,this.updateHandleWidth=function(){t.handle.style.width=t.headSize.displayRowHeadWidth+"px"},this.updateLineWidth=function(){t.line.style.width=t.clientRect.width+"px"},this.checkMousemove=function(){if(!t.shouldReturn())if(t.shouldHideHanlde())t.hideHandle();else{for(var e=t.operateData.currRow,a=e-1;a<=e;a++){var n=t.areaData.getDisplayViewBottomByRow(a)+t.headSize.displayColHeadHeight;if(Math.abs(n-t.operateData.displayCurrY)<3)return void t.showHandle(a)}t.hideHandle()}},this.hideHandle=function(){t.showing&&(t.showing=!1,t.focusRow=-1,t.handle.style.display="none",t.cacheOffsetSize=0)},this.handleMousedown=function(){t.showLineRuler(),t.cacheY=t.operateData.displayCurrY,t.cacheOffsetSize=t.areaData.row.flow.offsetSize,t.updateRulerValue(t.operateData.displayCurrY),t.mousemoveDisposable.dispose(),document.addEventListener("mousemove",t.handleMousemove),document.addEventListener("mouseup",t.handleMouseup),t.autoScroll.ready(K.OD.Y,t.clientRect.height-t.areaData.row.flow.displayPadding)},this.handleMousemove=function(){var e=Math.max(t.areaData.getDisplayViewTopByRow(t.focusRow)+t.headSize.displayColHeadHeight,t.operateData.displayCurrY);t.handle.style.top=e+"px",t.updateRulerValue(t.operateData.displayCurrY)},this.handleMouseup=function(){if(t.mousemoveDisposable=t.mouseOperate.onMousemove(t.checkMousemove),document.removeEventListener("mousemove",t.handleMousemove),document.removeEventListener("mouseup",t.handleMouseup),t.canRowUpdate()){var e=Math.max(t.areaData.getDisplayViewTopByRow(t.focusRow)+t.headSize.displayColHeadHeight,t.operateData.displayCurrY),a=t.areaData.row.flow.offsetSize-t.cacheOffsetSize,n=e-t.cacheY+a;if(Math.abs(n)>=1){var r=Math.max(0,n/t.scale.scale+t.rowcolAccessor.getRowDisplayHeight(t.focusRow))>>0;t.propsSetRowHeight(t.focusRow,r)}t.hideLineRuler()}},this.handleDblclick=function(){t.propsSetRowAutoFit(t.focusRow),t.hideHandle()},this.container=e.container,this.headSize=e.headSize,this.clientRect=e.clientRect,this.resize=e.resize,this.scale=e.scale,this.mouseOperate=e.mouseOperate,this.areaData=e.areaData,this.rowcolAccessor=e.rowcolAccessor,this.propsSetRowAutoFit=e.setRowAutoFit,this.propsSetRowHeight=e.setRowHeight,this.operateData=e.operateData,this.sheetStatus=e.sheetStatus,this.autoScroll=e.autoScroll,this.handle.classList.add("resizer-horizontal-handle"),this.line.classList.add("resizer-horizontal-line"),this.ruler.classList.add("resizer-horizontal-ruler"),this.handle.appendChild(this.line),this.handle.appendChild(this.ruler),this.container.appendChild(this.handle),this.updateHandleWidth(),this.updateLineWidth(),this.initEvent()}var t=e.prototype;return t.shouldReturn=function(){return!this.sheetStatus.canEdit||this.operateData.stopPropagation||this.operateData.isMovingRowOrCol},t.shouldHideHanlde=function(){return this.operateData.isOverTable()||-1===this.operateData.currRow||-1!==this.operateData.currCol},t.showHandle=function(e){this.showing&&this.focusRow===e||(this.showing=!0,this.focusRow=e,this.handle.style.top=this.areaData.getDisplayViewBottomByRow(e)+this.headSize.displayColHeadHeight-2+"px",this.handle.style.display="block")},t.showLineRuler=function(){this.line.style.display="block",this.ruler.style.display="block"},t.hideLineRuler=function(){this.line.style.display="none",this.ruler.style.display="none"},t.initEvent=function(){this.resize.onResize(this.updateLineWidth),this.scale.onScale(this.updateHandleWidth),this.mousemoveDisposable=this.mouseOperate.onMousemove(this.checkMousemove),this.handle.addEventListener("contextmenu",H.p7),this.handle.addEventListener("mousedown",this.handleMousedown),this.handle.addEventListener("dblclick",this.handleDblclick)},t.updateRulerValue=function(e){var t=this.areaData.row.flow.offsetSize-this.cacheOffsetSize,a=e-this.cacheY+t,n=Math.max(0,a/this.scale.scale+this.rowcolAccessor.getRowDisplayHeight(this.focusRow))>>0;this.ruler.innerText=p.ZP.t("高度：{{height}}",{height:n})},t.canRowUpdate=function(){return!!this.sheetStatus.isCurrentRowCanEdit({startRow:this.focusRow,endRow:this.focusRow})||(X.default.confirm({title:p.ZP.t("保护范围提示"),content:p.ZP.t("创建者「{{value}}」设置了保护范围，你没有权限进行此操作。如需编辑，请联系创建者授予权限。",{value:window.clientVars.ownerNick}),cancelText:null,okText:p.ZP.t("确定")}),!1)},e}(),le=function(){function e(e,t){var a=this;this.dragBoard=t,this.line=document.createElement("div"),this.bar=document.createElement("div"),this.rect=document.createElement("div"),this.cacheStartRow=-1,this.cacheEndRow=-1,this.cacheMoveTo=-1,this.cacheDiff=0,this.handleMousedown=function(){a.sheetStatus.canEdit&&!a.operateData.isOverTable()&&-1!==a.operateData.currRow&&-1===a.operateData.currCol&&1===a.normalSelectData.selectQueue.length&&(0,q.TD)(a.operateData.currRow,a.normalSelectData)&&0===a.operateData.e.button&&!a.operateData.e.ctrlKey&&(a.operateData.e.preventDefault(),a.showMove(),a.operateData.isMovingRowOrCol=!0,document.addEventListener("mousemove",a.handleMousemove),document.addEventListener("mouseup",a.handleMouseup),a.autoScroll.ready(K.OD.Y,a.clientRect.height-a.areaData.row.flow.displayPadding))},this.handleMouseup=function(){document.removeEventListener("mousemove",a.handleMousemove),document.removeEventListener("mouseup",a.handleMouseup),(a.cacheMoveTo<a.cacheStartRow||a.cacheMoveTo>a.cacheEndRow+1)&&a.cacheMoveTo>=0&&a.cacheMoveTo<=a.rowcolAccessor.getRowCount()&&a.propsMoveRow([a.cacheStartRow,a.cacheEndRow],a.cacheMoveTo),a.hideMove()},this.handleMousemove=function(e){e.stopPropagation(),a.operateData.stopPropagation=!0,a.updateElements()},this.hideMove=function(){a.line.style.display="none",a.bar.style.display="none",a.cacheStartRow=-1,a.cacheEndRow=-1,a.cacheMoveTo=-1,a.cacheDiff=0,a.operateData.isMovingRowOrCol=!1},this.updateElements=function(){var e=a.cacheStartRow,t=a.cacheEndRow,n=Math.max(a.headSize.displayColHeadHeight,a.areaData.getDisplayViewTopByRow(e)+a.headSize.displayColHeadHeight),r=a.areaData.getDisplayViewBottomByRow(t)+a.headSize.displayColHeadHeight-n;a.operateData.currRow<0?a.cacheMoveTo=a.areaData.getFirstRowInView():a.operateData.currRow===Number.MAX_SAFE_INTEGER?a.cacheMoveTo=a.areaData.getLastRowInView():a.cacheMoveTo=a.calcMoveToRow();var s=Math.max(a.headSize.displayColHeadHeight,a.areaData.getDisplayViewTopByRow(a.cacheMoveTo)+a.headSize.displayColHeadHeight);a.line.style.top=s-2+"px",a.bar.style.left="0px",a.bar.style.height=r+"px",a.bar.style.top=a.operateData.displayCurrY-a.cacheDiff+"px",a.bar.style.width=a.areaData.col.frozen.displayTotalSize+a.areaData.col.flow.displayTotalSize+"px",a.rect.style.left=a.headSize.displayRowHeadWidth+"px"},this.container=e.container,this.headSize=e.headSize,this.clientRect=e.clientRect,this.resize=e.resize,this.scale=e.scale,this.mouseOperate=e.mouseOperate,this.areaData=e.areaData,this.rowcolAccessor=e.rowcolAccessor,this.normalSelectData=e.normalSelectData,this.operateData=e.operateData,this.autoScroll=e.autoScroll,this.sheetStatus=e.sheetStatus,this.propsMoveRow=e.moveRow,this.line.classList.add("move-horizontal-line"),this.bar.classList.add("move-horizontal-bar"),this.rect.classList.add("move-horizontal-rect"),this.bar.appendChild(this.rect),this.container.appendChild(this.line),this.container.appendChild(this.bar),this.initEvent()}var t=e.prototype;return t.initEvent=function(){this.dragBoard.addEventListener("mousedown",this.handleMousedown,!0)},t.showMove=function(){var e,t,a=this.normalSelectData.selectQueue[0];if(!a)throw new Error("移动行异常");if(a.selectRow){var n=a.yRange;e=n[0],t=n[1],this.line.style.width=this.clientRect.width+"px",this.line.style.left=this.headSize.displayRowHeadWidth+"px",this.line.style.display="block",this.bar.style.display="block",this.cacheStartRow=e,this.cacheEndRow=t,this.cacheDiff=this.operateData.displayStartY-this.areaData.getDisplayViewTopByRow(e)-this.headSize.displayColHeadHeight,this.updateElements();var r=t-e+1>1?"movemorerow":"moveonerow";S.ZP.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:r})}},t.calcMoveToRow=function(){var e=this.areaData.getRowByDisplayViewTop(this.operateData.displayCurrY-this.headSize.displayColHeadHeight);if(e>=this.cacheStartRow&&e<=this.cacheEndRow)return this.cacheStartRow;var t=this.areaData.getDisplayViewTopByRow(e)+this.headSize.displayColHeadHeight,a=this.areaData.getDisplayViewBottomByRow(e)+this.headSize.displayColHeadHeight;return this.operateData.displayCurrY-t>a-this.operateData.displayCurrY?e+1:e},e}(),ce=function(){function e(e){var t=this;this.operateBoard=document.createElement("div"),this.onOperateBoardMousedown=function(){t.sheetStatus.canEdit&&!t.operateData.isOverTable()&&t.isOperateInRowHead()&&1===t.normalSelectData.selectQueue.length&&0===t.operateData.e.button||t.hide()},this.onSelectionModified=function(){var e=t.normalSelectData.selectQueue[0];if(t.sheetStatus.canEdit&&(null===e||void 0===e?void 0:e.selectRow)){var a=e.yRange[0],n=e.yRange[1];t.show(),t.updateElement(a,n)}},this.updateElement=function(e,a){var n=t.getRowRangeRect(e,a);t.board.style.top=n.top+"px",t.board.style.width=n.width+"px",t.board.style.height=n.height+"px"},this.headSize=e.headSize,this.areaData=e.areaData,this.sheetStatus=e.sheetStatus,this.operateData=e.operateData,this.mouseOperate=e.mouseOperate,this.normalSelectData=e.normalSelectData,this.container=e.operateBoard.board,this.operateBoard.classList.add("row-dragger-hand"),this.container.appendChild(this.board),this.initEvents()}var t=e.prototype;return t.initEvents=function(){this.mouseOperate.onMousedown(this.onOperateBoardMousedown),this.normalSelectData.onModifySelectData(this.onSelectionModified)},t.isOperateInRowHead=function(){var e=this.operateData,t=e.currRow,a=e.currCol;return-1!==t&&-1===a},t.getRowRangeRect=function(e,t){var a=this.headSize,n=a.displayColHeadHeight,r=a.displayRowHeadWidth,s=this.areaData.getDisplayViewTopByRow(e),o=this.areaData.getDisplayViewBottomByRow(t),i=Math.max(n,s+n),l=o+n;return{top:i,bottom:l,height:l-i,width:r}},t.show=function(){this.board.style.display="block"},t.hide=function(){this.board.style.display=""},(0,Y.Z)(e,[{key:"board",get:function(){return this.operateBoard}}]),e}(),he=function(){function e(e){this.board=document.createElement("div"),this.container=e.container,this.board.classList.add("row-head-board"),this.container.appendChild(this.board),e.container=this.board,this.resizeOperateBoard=new ie(e),this.draggerOperateBoard=new ce(e),this.moveOperateBoard=new le(e,this.draggerOperateBoard.board),e.container=this.container}return(0,Y.Z)(e,[{key:"resizeBoard",get:function(){return this.resizeOperateBoard}},{key:"moveBoard",get:function(){return this.moveOperateBoard}},{key:"draggerBoard",get:function(){return this.draggerOperateBoard}}]),e}();function de(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(e){if("string"===typeof e)return ue(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ue(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var pe=function(){function e(e){this.normalSelectData=e.normalSelectData,this.modifyDimensionBroker=e.modifyDimensionBroker,this.modifySelectionBroker=e.modifySelectionBroker,this.rowcolAccessor=e.rowcolAccessor}var t=e.prototype;return t.getSelectRowRange=function(){for(var e,t=[],a=de(this.normalSelectData.selectQueue);!(e=a()).done;){var n=e.value;n.selectAll?t.push([0,this.rowcolAccessor.getRowCount()-1]):n.selectRow&&t.push([n.yRange[0],n.yRange[1]])}return t},t.setRowHeight=function(e,t){if(t<=(ae().isMobile?15:5))if((0,q.TD)(e,this.normalSelectData)){var a=this.getSelectRowRange()[0];this.modifyDimensionBroker.hideRows([{index:a[0],amount:a[1]-a[0]+1}])}else this.modifyDimensionBroker.hideRows([{index:e,amount:1}]);else{var n;if((0,q.TD)(e,this.normalSelectData)){var r=this.getSelectRowRange();this.modifyDimensionBroker.setRowHeight(r,t),n="drag_n1row_size"}else this.modifyDimensionBroker.setRowHeight([[e,e]],t),n="drag_1row_size";this.handleReport(n)}},t.setRowAutoFit=function(e){var t;if((0,q.TD)(e,this.normalSelectData)){var a=this.getSelectRowRange();this.modifyDimensionBroker.setRowHeightAutoFit(a),t="clk_auto_nrow_size"}else this.modifyDimensionBroker.setRowHeightAutoFit([[e,e]]),t="clk_auto_1row_size";this.handleReport(t)},t.moveRow=function(e,t){var a=this;this.modifyDimensionBroker.moveRows(e,t).then((function(){var n=t<e[0]?t:t-(e[1]-e[0]+1);a.modifySelectionBroker.setSelection({yRange:[n,n+e[1]-e[0]],activation:{col:a.normalSelectData.activeCol,row:n+a.normalSelectData.activeRow-e[0]}})}));var n="move_"+(e[1]-e[0]>0?"more":"one")+"_row";this.handleReport(n)},t.handleReport=function(e){S.ZP.tdwReport({module:"excel_dimension",opername:"doc_excel_editor",action:e})},e}(),me=function(e){function t(t){var a;return(a=e.call(this,t)||this).board=new he(Object.assign(Object.assign({},t),{setRowHeight:a.setRowHeight.bind((0,r.Z)(a)),setRowAutoFit:a.setRowAutoFit.bind((0,r.Z)(a)),moveRow:a.moveRow.bind((0,r.Z)(a))})),a}return(0,s.Z)(t,e),t}(pe),ve=function(e){function t(t){var a;return(a=e.call(this)||this).colHeadOperate=new oe(t),a.rowHeadOperate=new me(t),a}return(0,s.Z)(t,e),t}(G),fe=a("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),ge=(a("../node_modules/core-js/modules/es.array.concat.js"),a("../spread-sheet/src/core/view/spreadsheet-view/model/Color.ts")),Ce=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts"),we=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/utils.ts"),Re=a("../spread-sheet/src/core/view/level-2/dimension-edit/hide-show-head/utils.ts"),Se=a("../node_modules/@tencent/dui/lib/components/Snackbar/index.js");function _e(){Se.default.show({type:"info",message:p.ZP.t("所在行列包含保护范围，暂不支持此操作。"),autoClose:!0,style:{zIndex:1e4},duration:3e3})}var Ee,xe=[0,2,12,14];function ye(e,t,a){return e===Ae.RIGHT?[t,xe[1],xe[3],xe[2]]:[t+a-xe[3],xe[1],xe[3],xe[2]]}function Ie(e,t,a){return e===Ae.TOP?[xe[0],t+a-xe[3],xe[2],xe[3]]:[xe[0],t,xe[2],xe[3]]}!function(e){e[e.ROWHEAD=1]="ROWHEAD",e[e.COLHEAD=2]="COLHEAD",e[e.MAINBOARD=3]="MAINBOARD"}(Ee||(Ee={}));var De,Ae,be=function(){function e(e){var t=this;this.cacheData={hover:!1,dir:0,row:-1,col:-1},this.handleMove=function(){if(!t.operateData.isOverTable()){var e=t.operateData,a=e.currRow,n=e.currCol,r=t.getMoveRegion(a,n);r!==Ee.MAINBOARD?r!==Ee.COLHEAD?t.handleHoverInRow(a):t.handleHoverInCol(n):t.cacheData.hover&&t.clearCache()}},this.handleDown=function(){t.cacheData.hover&&t.sheetStatus.canEdit&&(t.operateData.stopPropagation=!0,-1!==t.cacheData.col&&t.colIconDown(t.cacheData.col,t.cacheData.dir),-1!==t.cacheData.row&&t.rowIconDown(t.cacheData.row,t.cacheData.dir))},this.mouseOperate=e.mouseOperate,this.operateData=e.operateData,this.spreadsheet=e.spreadsheet,this.areaData=e.areaData,this.rowcolAccessor=e.rowcolAccessor,this.scale=e.scale,this.headSize=e.headSize,this.sheetStatus=e.sheetStatus,this.renderRowHead=e.renderRowHead,this.renderColHead=e.renderColHead,this.colIconDown=e.colIconDown,this.rowIconDown=e.rowIconDown,this.mouseOperate.onMousemove(this.handleMove),this.mouseOperate.onMousedown(this.handleDown)}var t=e.prototype;return t.clearCache=function(){-1!==this.cacheData.row&&-1===this.cacheData.col&&this.renderRowHead(),-1===this.cacheData.row&&-1!==this.cacheData.col&&this.renderColHead(),this.cacheData.hover=!1,this.cacheData.dir=0,this.cacheData.row=-1,this.cacheData.col=-1},t.checkHover=function(e,t,a,n){return this.operateData.currX>=e&&this.operateData.currX<=e+a&&this.operateData.currY>=t&&this.operateData.currY<=t+n},t.getMoveRegion=function(e,t){return-1!==e&&-1!==t||-1===e&&-1===t?Ee.MAINBOARD:-1!==t?Ee.COLHEAD:Ee.ROWHEAD},t.updateHoverCacheData=function(e){var t=e===Ae.LEFT||e===Ae.TOP?De.DOWN_OR_RIGHT:De.UP_OR_LEFT;this.cacheData.hover&&this.cacheData.dir===t||(this.cacheData.hover=!0,this.cacheData.dir=t)},t.handleColHeadHover=function(e){var t=this.areaData.getViewLeftByCol(e)+this.headSize.rowHeadWidth,a=this.rowcolAccessor.getColSetWidth(e);this.spreadsheet.activeSheet.isColHiddenByUser(e+1)&&(this.checkHover.apply(this,(0,fe.Z)(ye(Ae.LEFT,t,a)))?this.updateHoverCacheData(Ae.LEFT):this.spreadsheet.activeSheet.isColHiddenByUser(e-1)||this.clearCache()),this.spreadsheet.activeSheet.isColHiddenByUser(e-1)&&(this.checkHover.apply(this,(0,fe.Z)(ye(Ae.RIGHT,t,a)))?this.updateHoverCacheData(Ae.RIGHT):this.spreadsheet.activeSheet.isColHiddenByUser(e+1)||this.clearCache())},t.handleRowHeadHover=function(e){var t=this.areaData.getViewTopByRow(e)+this.headSize.colHeadHeight,a=this.rowcolAccessor.getRowDisplayHeight(e),n=this.spreadsheet.activeSheet;(0,Re.e5)(n,e)&&(this.checkHover.apply(this,(0,fe.Z)(Ie(Ae.TOP,t,a)))?this.updateHoverCacheData(Ae.TOP):(0,Re.Lu)(n,e)||this.clearCache()),(0,Re.Lu)(n,e)&&(this.checkHover.apply(this,(0,fe.Z)(Ie(Ae.BOTTOM,t,a)))?this.updateHoverCacheData(Ae.BOTTOM):(0,Re.e5)(n,e)||this.clearCache())},t.handleHoverInCol=function(e){this.cacheData.col!==e?(this.clearCache(),this.cacheData.col=e):this.handleColHeadHover(e),this.renderColHead()},t.handleHoverInRow=function(e){this.cacheData.row!==e?(this.clearCache(),this.cacheData.row=e):this.handleRowHeadHover(e),this.renderRowHead()},e}(),Te=function(){function e(e){var t=this;this.handleDown=function(){if(!t.operateData.isOverTable()){var e=t.operateData,a=e.currRow,n=e.currCol;-1!==n&&-1===a&&t.handleColHeadTouch(n),-1!==a&&-1===n&&t.handleRowHeadTouch(a)}},this.touchOperate=e.touchOperate,this.operateData=e.operateData,this.spreadsheet=e.spreadsheet,this.areaData=e.areaData,this.rowcolAccessor=e.rowcolAccessor,this.scale=e.scale,this.headSize=e.headSize,this.colIconDown=e.colIconDown,this.rowIconDown=e.rowIconDown,this.touchOperate.onTouchstart(this.handleDown)}var t=e.prototype;return t.checkHover=function(e,t,a,n){return this.operateData.currX>=e&&this.operateData.currX<=e+a&&this.operateData.currY>=t&&this.operateData.currY<=t+n},t.handleColHeadTouch=function(e){var t=this.spreadsheet.activeSheet,a=this.areaData.getViewLeftByCol(e)+this.headSize.rowHeadWidth,n=this.rowcolAccessor.getColSetWidth(e);t.isColHiddenByUser(e+1)&&this.checkHover.apply(this,(0,fe.Z)(ye(Ae.LEFT,a,n)))&&this.colIconDown(e,1),t.isColHiddenByUser(e-1)&&this.checkHover.apply(this,(0,fe.Z)(ye(Ae.RIGHT,a,n)))&&this.colIconDown(e,-1)},t.handleRowHeadTouch=function(e){var t=this.spreadsheet.activeSheet,a=this.areaData.getViewTopByRow(e)+this.headSize.colHeadHeight,n=this.rowcolAccessor.getRowDisplayHeight(e);(0,Re.e5)(t,e)&&this.checkHover.apply(this,(0,fe.Z)(Ie(Ae.TOP,a,n)))&&this.rowIconDown(e,1),(0,Re.Lu)(t,e)&&this.checkHover.apply(this,(0,fe.Z)(Ie(Ae.BOTTOM,a,n)))&&this.rowIconDown(e,-1)},e}(),Me=a("../packages/model/src/range/index.ts");!function(e){e[e.DOWN_OR_RIGHT=1]="DOWN_OR_RIGHT",e[e.UP_OR_LEFT=-1]="UP_OR_LEFT"}(De||(De={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(Ae||(Ae={}));var ke=function(e){function t(t){var a;(a=e.call(this,t)||this).color=ge.Z.newInstanceByHex("#000000"),a.filterViewColor=ge.Z.newInstanceByHex("#ffffff"),a.filterViewHoverBgColor=ge.Z.newInstanceByHex("#000000"),a.renderAfterRow=function(e){var t,n=e.row,r=e.y,s=a.spreadsheet.activeSheet;for(t=1;s.isRowHidden(n+t)&&n+t<s.getRowCount();){if(s.isRowHiddenByUser(n+t)){var o=a.rowcolAccessor.getRowDisplayHeight(n);a.renderTriangleGraphics(Ae.TOP,0,r,a.headSize.rowHeadWidth,o);break}t+=1}for(t=1;s.isRowHidden(n-t)&&n-t>=0;){if(s.isRowHiddenByUser(n-t)){var i=a.rowcolAccessor.getRowDisplayHeight(n);a.renderTriangleGraphics(Ae.BOTTOM,0,r,a.headSize.rowHeadWidth,i);break}t+=1}},a.renderAfterCol=function(e){var t=e.col,n=e.x;if(a.spreadsheet.activeSheet.isColHiddenByUser(t+1)){var r=a.rowcolAccessor.getColSetWidth(t);a.renderTriangleGraphics(Ae.LEFT,n,0,r,a.headSize.colHeadHeight)}if(a.spreadsheet.activeSheet.isColHiddenByUser(t-1)){var s=a.rowcolAccessor.getColSetWidth(t);a.renderTriangleGraphics(Ae.RIGHT,n,0,s,a.headSize.colHeadHeight)}},a.showCol=function(e,t){var n=a.getShowColRange(e,t),r=n.start,s=n.end,o=new Me.GridRange(a.spreadsheet.activeSheetId,r,s);if(!a.sheetStatus.getRangeCanEdit(o))return _e();a.modifySelectionBroker.setSelection({xRange:[r,s],activation:{row:0,col:r}}),a.modifyDimensionBroker.showCols([{index:r,amount:s-r+1}])},a.showRow=function(e,t){var n=a.getShowRowRange(e,t),r=n.start,s=n.end,o=new Me.GridRange(a.spreadsheet.activeSheetId,r,s);if(!a.sheetStatus.getRangeCanEdit(o))return _e();a.modifySelectionBroker.setSelection({yRange:[r,s],activation:{row:r,col:0}}),a.modifyDimensionBroker.showRows([{index:r,amount:s-r+1}])},a.spreadsheet=t.spreadsheet,a.rowcolAccessor=t.rowcolAccessor,a.hoverBackgroundCollect=a._alloyExcel.collectEngine.get("cover-background"),a.triangleCollect=a._alloyExcel.collectEngine.generateCollector(Ce.g4.GraphicsRender,Ce.DF.RowColTriangle),a._alloyExcel.collectEngine.add("hide-show-triangle",a.triangleCollect),a.areaData=t.areaData,a.renderApi=t.renderApi,a.headSize=t.headSize,a.modifyDimensionBroker=t.modifyDimensionBroker,a.modifySelectionBroker=t.modifySelectionBroker,a.operateData=t.operateData,a.scale=t.scale,a.sheetStatus=t.sheetStatus,a._alloyExcel.onAfterRowHeadRender(a.renderAfterRow),a._alloyExcel.onAfterColHeadRender(a.renderAfterCol);var n=t.mouseOperate;n&&new be({mouseOperate:n,operateData:a.operateData,spreadsheet:a.spreadsheet,areaData:a.areaData,rowcolAccessor:a.rowcolAccessor,scale:a.scale,headSize:a.headSize,sheetStatus:a.sheetStatus,renderRowHead:a.renderApi.renderRowHead.bind(a.renderApi),renderColHead:a.renderApi.renderColHead.bind(a.renderApi),colIconDown:a.showCol,rowIconDown:a.showRow});var r=t.touchOperate;return r&&new Te({touchOperate:r,operateData:a.operateData,spreadsheet:a.spreadsheet,areaData:a.areaData,rowcolAccessor:a.rowcolAccessor,scale:a.scale,headSize:a.headSize,colIconDown:a.showCol,rowIconDown:a.showRow}),a}(0,s.Z)(t,e);var a=t.prototype;return a.checkHover=function(e,t,a,n){return this.operateData.currX>=e&&this.operateData.currX<=e+a&&this.operateData.currY>=t&&this.operateData.currY<=t+n},a.renderBackgroundAndLine=function(e,t){this.hoverBackgroundCollect.collect({color:(0,M.xJ)(this.spreadsheet)?this.filterViewHoverBgColor.hex:"#ffffff",graphicsInfo:{path:e}}),this._alloyExcel.collectEngine.lineCollector.collect({line:t,lineProp:{color:ge.Z.newInstanceByHex("#d4d4d4"),style:we.j.THIN,width:null}})},a.renderForOwn=function(e){var t=e.left,a=e.top,n=e.width,r=e.height,s=[t,a,t+n,a,t+n,a+r,t,a+r],o=[t,a+r,t,a,t+n,a,t+n,a+r,t,a+r];this.renderBackgroundAndLine(s,o)},a.renderForNeighbor=function(e,t){var a,n,r=t.left,s=t.top,o=t.width,i=t.height;switch(e){case Ae.TOP:a=[r,s+i,r+o,s+i,r+o,s+2*i,r,s+2*i],n=[r,s+2*i,r,s+i,r+o,s+i,r+o,s+2*i,r,s+2*i];break;case Ae.RIGHT:a=[r-o,s,r,s,r,s+i,r-o,s+i],n=[r-o,s+i,r-o,s,r,s,r,s+i,r-o,s+i];break;case Ae.BOTTOM:a=[r,s-i,r+o,s-i,r+o,s,r,s],n=[r,s,r,s-i,r+o,s-i,r+o,s,r,s];break;case Ae.LEFT:a=[r+o,s,r+2*o,s,r+2*o,s+i,r+o,s+i],n=[r+o,s+i,r+o,s,r+2*o,s,r+2*o,s+i,r+o,s+i]}this.renderBackgroundAndLine(a,n)},a.renderHover=function(e,t,a,n,r){if(this.checkHover(t,a,n,r)){var s={left:t,top:a,width:n,height:r};return this.renderForOwn(s),this.renderForNeighbor(e,s),!0}return!1},a.renderTriangleGraphics=function(e,t,a,n,r){var s=[];switch(e){case Ae.TOP:s.push(Re.AL[0]+Re.AL[2]/2,a+r-Re.AL[3]-Re.AL[4],Re.AL[0]+Re.AL[2],a+r-Re.AL[4],Re.AL[0],a+r-Re.AL[4]),this.renderHover.apply(this,[e].concat((0,fe.Z)(Ie(e,a,r))));break;case Ae.RIGHT:s.push(t+Re.AL[3]+Re.AL[4],Re.AL[1]+Re.AL[2]/2,t+Re.AL[4],Re.AL[1]+Re.AL[2],t+Re.AL[4],Re.AL[1]),this.renderHover.apply(this,[e].concat((0,fe.Z)(ye(e,t,n))));break;case Ae.BOTTOM:s.push(Re.AL[0]+Re.AL[2]/2,a+Re.AL[3]+Re.AL[4],Re.AL[0],a+Re.AL[4],Re.AL[0]+Re.AL[2],a+Re.AL[4]),this.renderHover.apply(this,[e].concat((0,fe.Z)(Ie(e,a,r))));break;case Ae.LEFT:s.push(t+n-Re.AL[3]-Re.AL[4],Re.AL[1]+Re.AL[2]/2,t+n-Re.AL[4],Re.AL[1],t+n-Re.AL[4],Re.AL[1]+Re.AL[2]),this.renderHover.apply(this,[e].concat((0,fe.Z)(ye(e,t,n))))}this.triangleCollect.collect({color:(0,M.xJ)(this.spreadsheet)?this.filterViewColor.hex:this.color.hex,graphicsInfo:{path:s}})},a.getShowColRange=function(e,t){var a,n;if(t===De.DOWN_OR_RIGHT){var r=Math.min(this.spreadsheet.activeSheet.getColCount()-1,(0,Re.mt)(this.spreadsheet.activeSheet,e,De.DOWN_OR_RIGHT));n=-1===r?this.spreadsheet.activeSheet.getColCount()-1:r-1,a=e+1}else{var s=(0,Re.mt)(this.spreadsheet.activeSheet,e,De.UP_OR_LEFT);a=-1===s?0:s+1,n=e-1}return{start:a,end:n}},a.getShowRowRange=function(e,t){var a,n;if(t===De.DOWN_OR_RIGHT){var r=Math.min(this.spreadsheet.activeSheet.getRowCount()-1,(0,Re.kI)(this.spreadsheet.activeSheet,e,De.DOWN_OR_RIGHT));n=-1===r?this.spreadsheet.activeSheet.getRowCount()-1:r-1,a=e+1}else{var s=(0,Re.kI)(this.spreadsheet.activeSheet,e,De.UP_OR_LEFT);a=-1===s?0:s+1,n=e-1}return{start:a,end:n}},t}(u.Z),Pe=(a("../node_modules/core-js/modules/es.array.filter.js"),a("../spread-sheet/src/core/view/level-2/cell-corner/const.ts")),Le=a("../node_modules/@tencent/dui/lib/components/Button/index.js"),Ne=a("../spread-sheet/src/core/feature/formula/utils.ts"),je=a("../packages/model/src/range/GridRange.ts"),Oe=a("../packages/model/src/cell/CellDataSlot.ts"),He=a("../packages/model/src/dimension/index.ts"),Be=a("../packages/mutation/src/cell/SetCellPropertiesMutation.ts"),Ve=a("../packages/mutation/src/cell/SetRangeMutation.ts"),Ze=a("../packages/mutation/src/dimension/InsertDimensionMutation.ts"),Fe=a("../packages/mutation/src/dimension/DeleteDimensionMutation.ts"),Ue=a("../packages/mutation/src/dimension/SetDimensionPropertiesMutation.ts"),ze=a("../spread-sheet/src/core/feature/relateForm/seeker-util.ts"),We=function(){function e(e){this.nextCalcPromise=null,this.calcResult={},this.dirtyColumnMap={},this.spreadsheet=e.spreadsheet,this.calcCompleteCallback=e.calcCompleteCallback}var t=e.prototype;return t.markColumnDirty=function(e,t){this.dirtyColumnMap[e]||(this.dirtyColumnMap[e]={}),this.dirtyColumnMap[e][t]=!0,this.scheduleNextCalc()},t.markCellDirty=function(e,t,a){this.calcCell(e,t,a),this.scheduleNextCalc()},t.shiftByDeleteColumn=function(e,t,a){for(var n=this.calcResult[e]||{},r=this.dirtyColumnMap[e]||{},s=0;s<a;s++){var o=t+s;delete n[o],delete r[o]}this.calcResult[e]=this.shiftMapIndex(n,t,-a),this.dirtyColumnMap[e]=this.shiftMapIndex(r,t,-a),this.scheduleNextCalc()},t.shiftByInsertColumn=function(e,t,a){var n=this.calcResult[e]||{},r=this.dirtyColumnMap[e]||{};this.calcResult[e]=this.shiftMapIndex(n,t,a),this.dirtyColumnMap[e]=this.shiftMapIndex(r,t,a),this.scheduleNextCalc()},t.shiftByDeleteRow=function(e,t,a){var n=this;Object.keys(this.calcResult[e]||{}).forEach((function(r){for(var s=n.calcResult[e][r]||{},o=0;o<a;o++)delete s[t+o];0!==Object.keys(s).length?n.calcResult[e][r]=n.shiftMapIndex(s,t,-a):delete n.calcResult[e][r]})),this.scheduleNextCalc()},t.shiftByInsertRow=function(e,t,a){var n=this;Object.keys(this.calcResult[e]||{}).forEach((function(r){var s=n.calcResult[e][r]||{};n.calcResult[e][r]=n.shiftMapIndex(s,t,a)})),this.scheduleNextCalc()},t.scheduleNextCalc=function(){var e=this;this.nextCalcPromise||(this.nextCalcPromise=Promise.resolve().then((function(){e.calcDirtyColumns(),e.calcCompleteCallback(),e.nextCalcPromise=null})).catch((function(){})))},t.calcDirtyColumns=function(){var e=this;Object.keys(this.dirtyColumnMap).forEach((function(t){Object.keys(e.dirtyColumnMap[t]).forEach((function(a){e.calcColumn(t,+a)}))}))},t.calcColumn=function(e,t){var a,n,r=this.spreadsheet.sheetManager.getSheetBySheetId(e),s=null===r||void 0===r?void 0:r.getColProperties(t),o=null===s||void 0===s?void 0:s.columnTypeMetadata;if(this.calcResult[e]||(this.calcResult[e]={}),o&&!(null===s||void 0===s?void 0:s.ignoreInvalidError)){for(var i={},l=r.getRowCount(),c=null!==(n=null!==(a=r.getColumnDvIgnoreRows())&&void 0!==a?a:null===s||void 0===s?void 0:s.ignoreValidateRows)&&void 0!==n?n:this.getDefaultIgnoreRows(t,r);c<l;c++){var h=r.getCellDataAtPosition(c,t);this.compareCellWithColumn(s,h,c,i)}this.saveCalcResult(e,t,i)}else delete this.calcResult[e][t]},t.calcCell=function(e,t,a){var n,r,s;if(!(null===(n=this.dirtyColumnMap[e])||void 0===n?void 0:n[t])){var o=this.spreadsheet.sheetManager.getSheetBySheetId(e),i=null===o||void 0===o?void 0:o.getColProperties(t);if((null===i||void 0===i?void 0:i.columnTypeMetadata)&&!(null===i||void 0===i?void 0:i.ignoreInvalidError)&&!(a<(null!==(s=null!==(r=o.getColumnDvIgnoreRows())&&void 0!==r?r:null===i||void 0===i?void 0:i.ignoreValidateRows)&&void 0!==s?s:this.getDefaultIgnoreRows(t,o)))){this.calcResult[e]||(this.calcResult[e]={});var l=this.calcResult[e][t]||{},c=o.getCellDataAtPosition(a,t);this.compareCellWithColumn(i,c,a,l),this.saveCalcResult(e,t,l)}}},t.compareCellWithColumn=function(e,t,a,n){var r,s,o,i,l,c,h=null===t||void 0===t?void 0:t.getMetadata(),d=null===t||void 0===t?void 0:t.getDataValidation(),u=e.columnTypeMetadata,p=e.dataValidation;if(h)if(p&&p.key!==(null===d||void 0===d?void 0:d.key)||(null===u||void 0===u?void 0:u.key)!==(null===h||void 0===h?void 0:h.key)){var m=null===(r=null===p||void 0===p?void 0:p.argTokens)||void 0===r?void 0:r[0],v=null===(s=null===d||void 0===d?void 0:d.argTokens)||void 0===s?void 0:s[0],f=null===(i=null===(o=null===m||void 0===m?void 0:m.formula)||void 0===o?void 0:o.getAllCellRangeWithFixedInfo())||void 0===i?void 0:i[0],g=null===(c=null===(l=null===v||void 0===v?void 0:v.formula)||void 0===l?void 0:l.getAllCellRangeWithFixedInfo())||void 0===c?void 0:c[0];if(f&&g&&f.key===g.key)return void delete n[a];n[a]=C.dx.DifferDataValidation}else delete n[a];else n[a]=C.dx.NoDataValidation},t.getDefaultIgnoreRows=function(e,t){var a=(0,ze.GY)(t);return a&&e>=a.startColIndex&&e<=a.endColIndex?a.endRowIndex+1:0},t.saveCalcResult=function(e,t,a){Object.keys(a).length>0?this.calcResult[e][t]=a:delete this.calcResult[e][t]},t.shiftMapIndex=function(e,t,a){var n={};return Object.keys(e).forEach((function(r){var s=+r;n[s<t?s:s+a]=e[s]})),n},(0,Y.Z)(e,[{key:"columnValidationResult",get:function(){return this.calcResult}}]),e}(),Ge=a("../spread-sheet/src/core/feature/dataValidation/api/DataValidationUtils.ts"),Ye=function(){function e(e){var t=this;this.cellMetaChange=function(e){(0,Ge.gZ)(t.spreadsheet,e,(function(e,a,n){t.validationHandler.markCellDirty(n,a,e)}))},this.afterMutationRunHandler=function(e){var a=e.mutation;a instanceof Be.Z?t.setCellPropertiesMutationForDataValidation(a):a instanceof Ve.Z?t.setRangeMutationForDataValidation(a):a instanceof Ze.Z?t.insertDimensionMutationForDataValidation(a):a instanceof Fe.Z?t.deleteDimensionMutationForDataValidation(a):a instanceof Ue.ZP&&t.setDimensionPropertiesMutationForDataValidation(a)},this.setCellPropertiesMutationForDataValidation=function(e){var a=e.gridRange,n=e.cellDataDelta,r=1<<Oe.Z.SLOT_METADATA,s=1<<Oe.Z.SLOT_DATA_VALIDATION_RULE;(n.clearSlots&r||n.setSlots&r)&&t.cellMetaChange(a),(n.clearSlots&s||n.setSlots&s)&&t.cellMetaChange(a)},this.setRangeMutationForDataValidation=function(e){var a=e.gridRange,n=e.cellDataDeltaAtPositions;if(!n)return null;n.forEach((function(e){var n=e.cellDataDelta,r=1<<Oe.Z.SLOT_METADATA;if(n.clearSlots&r||n.setSlots&r){var s=e.rowIndex,o=e.colIndex,i=new je.Z(a.sheetId,s,s,o,o);t.cellMetaChange(i)}}))},this.insertDimensionMutationForDataValidation=function(e){var a=e.type,n=e.sheetId,r=e.index,s=e.amount;a===He.DIMENSION_TYPE.COLUMNS?t.validationHandler.shiftByInsertColumn(n,r,s):t.validationHandler.shiftByInsertRow(n,r,s)},this.deleteDimensionMutationForDataValidation=function(e){var a=e.type,n=e.sheetId,r=e.index,s=e.amount;a===He.DIMENSION_TYPE.COLUMNS?t.validationHandler.shiftByDeleteColumn(n,r,s):t.validationHandler.shiftByDeleteRow(n,r,s)},this.setDimensionPropertiesMutationForDataValidation=function(e){var a=e.operation,n=e.ranges;if(a.some((function(e){var t=e.slot;return t===Ue.P8.SLOT_COLUMN_TYPE_METADATA||t===Ue.P8.SLOT_IGNORE_VALIDATE_ROWS||t===Ue.P8.SLOT_IGNORE_INVALID_ERROR})))for(var r=0;r<n.length;r++)if(n[r].dimension===He.DIMENSION_TYPE.COLUMNS)for(var s=n[r].startIndex;s<=n[r].endIndex;s++)t.validationHandler.markColumnDirty(n[r].sheetId,s)},this.spreadsheet=e.spreadsheet,this.validationHandler=new We({spreadsheet:this.spreadsheet,calcCompleteCallback:function(){t.spreadsheet.parent.view.canvas.renderApi.renderColHead()}}),this.refreshAllColumnDV(),this.spreadsheet.parent.mutationBehavior.emitter.addListener(this.spreadsheet.parent.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.afterMutationRunHandler)}var t=e.prototype;return t.refreshAllColumnDV=function(e){var t=this,a=e?this.spreadsheet.sheetManager.getSheetBySheetId(e):this.spreadsheet.activeSheet;null===a||void 0===a||a.data.colMetadata.forEach((function(e,n){var r;(null===(r=null===e||void 0===e?void 0:e.columnTypeMetadata)||void 0===r?void 0:r.customDataType)&&t.validationHandler.markColumnDirty(a.getSheetId(),n)}))},t.columnMetaChange=function(e){for(var t=0;t<e.length;t++)if(e[t].dimension===He.DIMENSION_TYPE.COLUMNS)for(var a=e[t].startIndex;a<=e[t].endIndex;a++)this.validationHandler.markColumnDirty(e[t].sheetId,a)},t.deleteColumn=function(e,t,a){this.validationHandler.shiftByDeleteColumn(e,t,a)},t.addColumn=function(e,t,a){this.validationHandler.shiftByInsertColumn(e,t,a)},t.deleteRow=function(e,t,a){this.validationHandler.shiftByDeleteRow(e,t,a)},t.addRow=function(e,t,a){this.validationHandler.shiftByInsertRow(e,t,a)},t.calcAfterInit=function(e){var t=this,a=this.spreadsheet.sheetManager.getSheetBySheetId(e);null===a||void 0===a||a.data.colMetadata.forEach((function(a,n){var r;(null===(r=null===a||void 0===a?void 0:a.columnTypeMetadata)||void 0===r?void 0:r.customDataType)&&t.validationHandler.markColumnDirty(e,n)}))},(0,Y.Z)(e,[{key:"columnValidationResult",get:function(){return this.validationHandler.columnValidationResult}}]),e}(),Ke=Ye,Xe=a("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),Je=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},qe=function(e){function t(t,a){var n;return(n=e.call(this,t)||this).container=document.createElement("div"),n.validationErrors=[],n.renderAfterCol=function(e){var t=e.x,a=e.col;if(!1===n.getColumnValidationResult(a).isValid&&!(0,Xe.qo)(n.spreadsheetApp,n.spreadsheetApp.spreadsheet.activeSheetId)){var r=Pe.N7,s=Pe.YZ,o=[];o[0]=t+s,o[1]=s,o[2]=t+r+s,o[3]=s,o[4]=t+s,o[5]=r+s,n.coverBackgroundCollect.collect({graphicsInfo:{path:o},color:Pe.Bq.Red})}},n.destory=function(){return n.container.style.visibility="hidden",c().unmountComponentAtNode(n.container)},n.hideTip=function(){var e;n.tipShow&&(n.currCol=-1,n.tipShow=!1,n.container.style.visibility="hidden",n.validationErrors=[],n.renderTip(),null===(e=document.getElementById("headerContainer"))||void 0===e||e.removeEventListener("click",n.hideTip))},n.handleClick=function(e){if(0===e.e.button&&n.spreadsheetApp.sheetStatus.canEdit)if(n.columnMenuManager.isMenuVisible())n.hideTip();else{var t=e.currCol,a=n.areaData.getViewLeftByCol(t)+n.headSize.rowHeadWidth,r=n.rowcolAccessor.getColSetWidth(t),s=n.headSize.colHeadHeight;n.checkHover(a,0,r,s)&&!1===n.getColumnValidationResult(t).isValid?(n.updatePosition(t),n.showTip(t)):n.hideTip()}else n.hideTip()},n.headSize=t.headSize,n.rowcolAccessor=t.rowcolAccessor,n.operateData=t.operateData,n.mouseOperate=t.mouseOperate,n.areaData=t.areaData,n.mainBoard=t.mainBoard,n.spreadsheetApp=t.spreadsheetApp,n.renderApi=t.renderApi,n.coverBackgroundCollect=t.coverBackgroundCollect,n.columnMenuManager=a,n.columnDataValidationApi=new Ke({spreadsheet:n.spreadsheetApp.spreadsheet}),n.container.className="column-tip-container",n.mainBoard.element.appendChild(n.container),n._alloyExcel.onAfterColHeadRender(n.renderAfterCol),n.mouseOperate.onMousedown(n.handleClick),n}(0,s.Z)(t,e);var a=t.prototype;return a.showTip=function(e){var t;this.currCol=e,this.tipShow=!0,this.container.style.visibility="visible",this.validationErrors=this.getColValidationResultForView(e),this.renderTip(),null===(t=document.getElementById("headerContainer"))||void 0===t||t.addEventListener("click",this.hideTip)},a.renderTip=function(){var e=this;c().render(i().createElement("div",{className:"column-tip-panel",style:{display:this.validationErrors.length?"block":"none"}},i().createElement("div",{className:"content"},i().createElement("div",{className:"title"},p.ZP.t("提示：")),this.validationErrors.map((function(t,a){return i().createElement("div",{className:"item",key:a},i().createElement("span",null,(0,Ne.Zb)({row:t.start,col:e.currCol})),t.end>t.start&&i().createElement("span",null,":",(0,Ne.Zb)({row:t.end,col:e.currCol})),i().createElement("span",{style:{padding:"0 3px"}},t.type===C.dx.NoDataValidation?p.ZP.t("数据验证为空"):p.ZP.t("包含其他数据验证")),i().createElement("span",{className:"revert",onClick:function(){return e.restoreError(e.currCol,t.start,t.end)}},p.ZP.t("恢复")))}))),i().createElement("div",{className:"button"},i().createElement(Le.default,{onClick:function(){return e.ignoreColumnError(e.currCol)},type:"plain"},p.ZP.t("忽略")))),this.container)},a.updatePosition=function(e){var t=Math.max(0,Math.min(this.mainBoard.element.clientWidth-254,this.areaData.getDisplayViewLeftByCol(e)));this.container.style.top="0px",this.container.style.left=t+"px"},a.checkHover=function(e,t,a,n){var r=this.operateData,s=r.currX,o=r.currY;return s>=e&&s<=e+a&&o>=t&&o<=t+n},a.getColProperties=function(e){return this.spreadsheetApp.spreadsheet.activeSheet.getColProperties(e)},a.getColValidationResultForView=function(e){var t=this.getColumnValidationResult(e).result,a=[];return Object.keys(t).forEach((function(e){var n=a[a.length-1],r=+e,s=t[r];n&&n.type===s&&n.end===r-1?n.end+=1:a.push({type:s,start:r,end:r})})),a},a.getColumnValidationResult=function(e){var t,a=this,n=this.spreadsheetApp.spreadsheet.activeSheetId;if((0,Xe.qo)(this.spreadsheetApp,n))return{isValid:!0,result:{}};var r=this.columnDataValidationApi.columnValidationResult,s=Object.assign({},(null===(t=r[n])||void 0===t?void 0:t[e])||{}),o=this.spreadsheetApp.spreadsheet.activeSheet.getBasicFilter();return Object.keys(s).forEach((function(t){(0,Xe.I1)(a.spreadsheetApp,+t,e,n)&&delete s[t],(null===o||void 0===o?void 0:o.getHiddenRowMap().get(+t))&&delete s[t]})),{isValid:0===Object.keys(s).length,result:s}},a.restoreError=function(e,t,a){var n=this,r=this.getColProperties(e);if(null===r||void 0===r?void 0:r.columnTypeMetadata){var s=r.ignoreValidateRows,o=void 0===s?0:s;t=t>=o?t:Math.min(o,a);for(var i=!1,l=!1,c=[],h=(0,C.NI)(r.columnTypeMetadata.customDataType),d=t;d<=a;d++){var u=this.spreadsheetApp.spreadsheet.activeSheet.getCellDataAtPosition(d,e),m=null===u||void 0===u?void 0:u.getEffectiveValue();i=!!m&&""!==m.value,l=!!(null===u||void 0===u?void 0:u.getMetadata()),(null===u||void 0===u?void 0:u.getMergeReference())&&c.push({row:d,col:e,cellData:u})}l||!h&&i?X.default.confirm({title:p.ZP.t("提示"),okText:p.ZP.t("确定"),content:p.ZP.t("将覆盖原有单元格内容，继续设置吗？"),onOk:function(){n.confirmRestoreError(e,t,a,c)}}):this.confirmRestoreError(e,t,a,c)}},a.confirmRestoreError=function(e,t,a,n){return Je(this,void 0,void 0,regeneratorRuntime.mark((function r(){var s,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=this.spreadsheetApp.spreadsheet.activeSheetId,o=this.getColProperties(e),!n.length){r.next=5;break}return r.next=5,this.spreadsheetApp.requestApi.unmergeCells(n.map((function(e){return new Me.GridRange(s,e.row,e.row,e.col,e.col)})));case 5:return r.next=7,this.spreadsheetApp.requestApi.setMetadata({metadata:(null===o||void 0===o?void 0:o.columnTypeMetadata)||null,dataValidation:(null===o||void 0===o?void 0:o.dataValidation)||null,colIndexes:[],effectiveRanges:[new Me.GridRange({sheetId:this.spreadsheetApp.spreadsheet.activeSheetId,startColIndex:e,endColIndex:e,startRowIndex:t,endRowIndex:a})]});case 7:this.validationErrors=this.validationErrors.filter((function(e){return e.start!==t&&e.end!==a})),0===this.validationErrors.length?this.hideTip():this.renderTip();case 9:case"end":return r.stop()}}),r,this)})))},a.ignoreColumnError=function(e){this.spreadsheetApp.requestApi.setIgnoreColumnError({ignoreInvalidError:!0,colIndex:e}),this.hideTip()},t}(u.Z),$e=function(){function e(e){this.expandDimension=new W(e),this.headOperate=new ve(e),this.hideShowHead=new ke(e),this.columnMenu=new j(e),this.columnErrorTip=new qe(e,this.columnMenu)}return e.prototype.refresh=function(){this.expandDimension.refresh()},e}()},"../spread-sheet/src/core/view/level-2/error-tip/index.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return W}});var n,r,s,o,i,l,c,h=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),d=(a("../node_modules/regenerator-runtime/runtime.js"),a("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),a("../node_modules/core-js/modules/esnext.reflect.metadata.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.promise.js"),a("../node_modules/core-js/modules/es.array.includes.js"),a("../node_modules/core-js/modules/es.string.includes.js"),a("../node_modules/core-js/modules/es.array.find-index.js"),a("../node_modules/core-js/modules/es.array.splice.js"),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/es.string.iterator.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/@tencent/containerized/build/main/index.js")),u=(0,d.yh)("IErrorTipAccessor"),p=(0,d.yh)("IRenderApi"),m=a("../spread-sheet/src/core/view/data-call-view/DataCallView.interface.ts"),v=(0,d.yh)("INormalSelectData"),f=a("../spread-sheet/src/core/view/spreadsheet-view/area-data/AreaData.interface.ts"),g=a("../node_modules/lodash/throttle.js"),C=a.n(g),w=a("../packages/model/src/cell/index.ts"),R=a("../packages/mutation/src/MutationId.ts"),S=a("../packages/model/src/cell/ErrorTipType.ts"),_=a("../spread-sheet/src/base/event/eventName.ts"),E=a("../packages/model/src/range/index.ts"),x=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),y=a.n(x),I=a("../packages/report/src/index.ts"),D=a("../spread-sheet/src/core/data/configService/spreadConfig.ts"),A=a("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),b=a("../spread-sheet/src/core/view/level-2/cell-corner/const.ts"),T=a("../spread-sheet/src/core/view/level-2/error-tip/utils.ts"),M=a("../packages/model/src/cell/metadata/CustomDataType.ts"),k=(0,d.yh)("IErrorTipCheckService"),P=a("../node_modules/lodash/debounce.js"),L=a.n(P),N=a("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),j=a("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),O=function(e,t,a,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,n);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(o=(s<3?r(o):s>3?r(t,a,o):r(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},H=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},B=function(e,t){return function(a,n){t(a,n,e)}},V=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))},Z=[{errorTipType:S.Z.NUMBER_STORED_AS_TEXT,shouldCheck:function(e){var t,a,n=null===(t=e.getMetadata())||void 0===t?void 0:t.customDataType,r=e.getDataValidation(),s=n&&[M.d9.ID,M.d9.PHONE_NUM].includes(n),o=n===M.d9.SELECT&&!(0,M.J$)(n,r);return!s&&!o&&(null===(a=e.getEffectiveValue())||void 0===a?void 0:a.type)===w.EXTENDED_VALUE_TYPE.STRING}}],F=0,U=y().isIPad||y().isIPadEmulatedMac,z=function(){function e(e,t,n,r,s,o,i,l){var c=this;if(this.instantiationService=e,this.app=t,this.errorTipAccessor=n,this.renderApi=s,this.dataCallView=o,this.normalSelectData=i,this.areaData=l,this.pendingMessages=[],this.hasReportedDoc=!1,this.refresh=function(e){U||(c.pendingMessages=[],c.errorTipAccessor.refresh(e),c.updateErrorTipPanel(),c.checkAllCells())},this.handlePanelUpdate=function(){c.updateErrorTipPanel()},this.updateErrorTipPanel=function(e){return V(c,void 0,void 0,regeneratorRuntime.mark((function t(){var a,n,r,s,o,i,l,c,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.app.view.getSelection(),r=n.activeCell,s=n.rangeSelections,o=(0,T.y)(this.app.spreadsheet,r.rowIndex,r.colIndex),i=o.shouldReplaceError,l=o.tipFlag,c=(0,T.V)(this.app.spreadsheet.activeSheet,this.errorTipAccessor,r.rowIndex,r.colIndex),1===s.length&&(c||l)&&this.app.sheetStatus.canEdit){t.next=6;break}return null===(a=this.app.view.plugins.errorTipPanel)||void 0===a||a.hide(),t.abrupt("return");case 6:return t.next=8,this.app.view.getErrorTipPanel();case 8:if(h=t.sent,!l||c&&!i){t.next=12;break}return null===h||void 0===h||h.show({range:s[0],errorFlag:l,expand:e}),t.abrupt("return");case 12:null===h||void 0===h||h.show({range:s[0],errorFlag:c,extraTipFlag:l,expand:e});case 13:case"end":return t.stop()}}),t,this)})))},this.handleScroll=function(){var e;null===(e=c.app.view.plugins.errorTipPanel)||void 0===e||e.hide()},this.handleInsertRow=function(e){var t=e.index,a=e.amount,n=e.sheetId;c.isCurrentSheet({sheetId:n})&&c.handleDimensionChange(t,a,n,"insert","row")},this.handleDeleteRow=function(e){var t=e.index,a=e.amount,n=e.sheetId;c.isCurrentSheet({sheetId:n})&&c.handleDimensionChange(t,a,n,"delete","row")},this.handleInsertCol=function(e){var t=e.index,a=e.amount,n=e.sheetId;c.isCurrentSheet({sheetId:n})&&c.handleDimensionChange(t,a,n,"insert","col")},this.handleDeleteCol=function(e){var t=e.index,a=e.amount,n=e.sheetId;c.isCurrentSheet({sheetId:n})&&c.handleDimensionChange(t,a,n,"delete","col")},this.handleCorner=function(e,t){if((0,T.V)(c.app.spreadsheet.activeSheet,c.errorTipAccessor,e,t)&&!(0,j.tE)(c.app,e,t))return c.hasReportedDoc||(c.hasReportedDoc=!0,I.ZP.tdwReport({opername:"doc_excel_editor",module:"gray_icon",action:"gray_icon_activedoc",ver11:D.q.getConfig("padTitle")})),{position:b.$s.LeftTop,color:b.Bq.Gray,zIndex:2}},this.handleExitInput=function(e){var t=e.row,a=e.col,n=c.app.spreadsheet,r=n.activeSheetId,s=n.activeSheet,o=new E.GridRange(r,t,t,a,a),i=s.getCellDataAtPosition(t,a);(null===i||void 0===i?void 0:i.getIgnoredErrorFlags())&&c.app.requestApi.setIgnoredErrorFlags({range:o,rangeFlags:0}),setTimeout((function(){c.checkCells(t,t,a,a,r)}),0)},this.handleMutationRun=function(e){var t=e.sheetId,a=e.mutation,n=e.isReplay;if(a.id===R.ZP.SET_RANGE_MUTATION||a.id===R.ZP.SET_CELL_PROPERTIES_MUTATION){if(n)return;var r=a;if(c.app.spreadsheet.activeSheetId!==t)return;var s=r.gridRange;c.checkCells(s.startRowIndex,s.endRowIndex,s.startColIndex,s.endColIndex,t)}a.id===R.ZP.UPDATE_FILTER_MUTATION&&a.filterViewId&&c.refresh(c.app.spreadsheet.activeSheetId),a.id===R.ZP.ACTIVE_FILTER_VIEW_MUTATION&&c.refresh(c.app.spreadsheet.activeSheetId)},this.checkAllCells=function(){var e=c.app.spreadsheet.activeSheet,t=e.data,a=t.startRow,n=t.startCol;c.checkCells(a,e.data.getDataRowCount(),n,e.data.getDataColCount(),e.getSheetId(),!0)},this.handleCheckResponse=function(e){var t=c.pendingMessages.findIndex((function(t){return t.seq===e.seq}));if(-1!==t){var a=c.pendingMessages[t],n=a.sheetId,r=a.checkCellDatas;c.pendingMessages.splice(t,1),n===c.app.spreadsheet.activeSheetId&&(r.forEach((function(t,a){var n=t.row,r=t.col;n<0||r<0||c.errorTipAccessor.setErrorTipFlags(n,r,e.result[a])})),c.renderApi.renderNextTick(),c.updateErrorTipPanel())}},!U){this.errorTipAccessor=n,this.handleScroll=C()(this.handleScroll,100);var u=C()(this.handlePanelUpdate,50),p=L()(this.handlePanelUpdate,120);this.app.mutationBehavior.emitter.on(this.app.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.handleMutationRun);var m=this.app.view.canvas.inputManager;m.emitter.on(m.EVENT.ENTER_INPUT,u),m.emitter.on(m.EVENT.VALUE_CHANGE,u),m.emitter.on(m.EVENT.EXIT_INPUT,this.handleExitInput),this.app.event.sheetsBar.listen("switchSheetEnd",(function(){return c.refresh(c.app.spreadsheet.activeSheetId)})),this.app.event.init.listen(_.W1.AFTER_ALL_RENDER,(function(){return c.refresh(c.app.spreadsheet.activeSheetId)})),r.addCornerHandler(this.handleCorner),this.normalSelectData.onUpdateSelectData(p),this.normalSelectData.onAddSelectData(u),this.areaData.onUpdateOffset(this.handleScroll),this.areaData.onUpdateOffset(p),this.app.view.canvas.scale.onScale(u),this.dataCallView.onInsertRow(this.handleInsertRow),this.dataCallView.onDeleteRow(this.handleDeleteRow),this.dataCallView.onInsertCol(this.handleInsertCol),this.dataCallView.onDeleteCol(this.handleDeleteCol),this.app.sheetStatus.change(u),this.app.view.canvas.mouseOperate.onDblClick((function(){var e=c.app.view.getSelection().activeCell,t=e.rowIndex,a=e.colIndex;(0,N.xy)(c.app.spreadsheet,t,a)&&c.updateErrorTipPanel(!0)})),this.instantiationService.addService(k,new d.Mj(function(e){function t(){return e.apply(this,arguments)||this}return(0,h.Z)(t,e),t.prototype.getModule=function(){return V(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.e("bundle_worker_services").then(a.bind(a,"./src/runners/webpack/customized-plugins/alloy-worker-plugin/entry-loader.js!../spread-sheet/src/core/view/level-2/error-tip/error-tip-check-service.ts"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},t}(d.RU)))}}var t=e.prototype;return t.handleDimensionChange=function(e,t,a,n,r){this.pendingMessages.forEach((function(s){var o=s.sheetId,i=s.checkCellDatas;o===a&&i.forEach((function(a){e>a[r]||("insert"===n?a[r]+=t:e+t>a[r]?a[r]=-1:a[r]-=t)}))}))},t.removeErrorTipFlags=function(e,t){this.errorTipAccessor.getErrorTipFlags(e,t)&&(this.errorTipAccessor.setErrorTipFlags(e,t,0),this.updateErrorTipPanel())},t.checkCells=function(e,t,a,n,r,s){var o=this;void 0===s&&(s=!1);var i=this.app.spreadsheet,l=i.activeSheet,c=i.activeSheetId,h=new E.GridRange(c,e,t,a,n),d=l.data.getCellDatasAtRange(h),u=[];if(d.forEach((function(t,n){t.forEach((function(t,r){var s,i=o.app.spreadsheet.activeSheet.transformCoordFromSheetToFilterView(e+n,a+r),l=i.row,c=i.col;if(t){var h=Z.reduce((function(e,a){var n=a.errorTipType,r=a.shouldCheck;return t.getIgnoredErrorFlags()&n||!r(t)?e:e+n}),0),d=null===(s=t.getEffectiveValue())||void 0===s?void 0:s.value;h&&d?u.push({row:l,col:c,value:d,checkErrorFlags:h}):o.removeErrorTipFlags(l,c)}else o.removeErrorTipFlags(l,c)}))})),0!==u.length){var p={checkCellDatas:u,sheetId:r,seq:F++,isAllCells:s};this.pendingMessages.push(p),this.instantiationService.invokeFunction((function(e){return V(o,void 0,void 0,regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.get(k),t.next=3,a.getInstance();case 3:t.sent.checkError(p).then(this.handleCheckResponse);case 5:case"end":return t.stop()}}),t,this)})))}))}},t.isCurrentSheet=function(e){return e.sheetId===this.app.spreadsheet.activeSheetId},e}(),W=z=O([B(0,d.TG),B(1,A.m),B(2,u),B(4,p),B(5,m.Z),B(6,v),B(7,f.ZP),H("design:paramtypes",["function"===typeof(n="undefined"!==typeof d.TG&&d.TG)?n:Object,"function"===typeof(r="undefined"!==typeof A.m&&A.m)?r:Object,"function"===typeof(s="undefined"!==typeof u&&u)?s:Object,Object,"function"===typeof(o="undefined"!==typeof p&&p)?o:Object,"function"===typeof(i="undefined"!==typeof m.Z&&m.Z)?i:Object,"function"===typeof(l="undefined"!==typeof v&&v)?l:Object,"function"===typeof(c="undefined"!==typeof f.ZP&&f.ZP)?c:Object])],z)},"../spread-sheet/src/core/view/level-2/error-tip/utils.ts":function(e,t,a){a.d(t,{V:function(){return o},y:function(){return i}});var n=a("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),r=a("../spread-sheet/src/external/view/main/panel/errorTipPanel/index.tsx"),s=a("../spread-sheet/src/core/data/configService/spreadConfig.ts");function o(e,t,a,r){if((0,n.xy)(e.spreadsheetReference,a,r,e))return 0;var s=e.getCellDataAtPosition(a,r),o=0;return s&&(o=s.getIgnoredErrorFlags()),~o&t.getErrorTipFlags(a,r)}function i(e,t,a){var o={tipFlag:null,shouldReplaceError:!1};return s.q.getConfig("isOwner")||((0,n.xy)(e,t,a)?(o.tipFlag=r.CustomCellErrorType.NO_AUTH_FOR_PRIVATE_AREA,o.shouldReplaceError=!0):(0,n._7)(e,t,a)&&(o.tipFlag=r.CustomCellErrorType.REMIND_FOR_PRIVATE_AREA)),o}},"../spread-sheet/src/core/view/level-2/formula-ui-center/formula-error-center/FormulaErrorCenter.tsx":function(e,t,a){a.r(t),a.d(t,{default:function(){return T}}),a("../node_modules/core-js/modules/es.array.slice.js");var n,r=a("../node_modules/i18next/dist/esm/i18next.js"),s=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=a.n(s),i=a("../spread-sheet/src/core/feature/dataValidation/api/DataValidationError.ts"),l=a("../packages/model/src/index.ts"),c=a("../packages/model/src/filter-view/utils/formula-util.ts");function h(e,t,a){var n=e.getEffectiveValue(),s=(0,i.getDataValidationError)(e,t),o=function(e){var t=(null===e||void 0===e?void 0:e.getDataValidation())||null;return(null===t||void 0===t?void 0:t.inputMessage)?{title:r.ZP.t("提示"),message:t.inputMessage}:null}(e),h=t.rowIndex,d=t.colIndex,u=(0,c.o)(a,h,d,e),p={};return s&&(p.dvError=s),n&&n.type===l.Cell.EXTENDED_VALUE_TYPE.ERROR&&(p.formulaError=n.value),o&&(p.dvInputMsg=o),u&&(p.filterViewReorderWarn=u),p.dvError||p.formulaError||p.dvInputMsg||p.filterViewReorderWarn?p:null}!function(e){e.NORMAL="normal",e.WARN="warn",e.ERROR="error"}(n||(n={}));var d=a("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),u=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),p=a("react"),m=a.n(p),v=a("react-dom"),f=a.n(v),g=a("../spread-sheet/src/core/view/level-2/card-center/BaseCard.ts"),C=(a("../node_modules/core-js/modules/es.array.map.js"),function(e){function t(){var t;return(t=e.apply(this,arguments)||this).state={visible:!1,messages:[]},t}(0,u.Z)(t,e);var a=t.prototype;return a.show=function(e){this.setState({visible:!0,messages:e})},a.hide=function(){this.setState({visible:!1,messages:[]})},a.render=function(){var e=this,t=this.state.visible,a=t?e.state.messages:[];return p.createElement("div",{style:{display:t?"block":"none"},className:"formula-error"},a.map((function(e,t){var n="formula-error-title title-"+e.type+"-style";return p.createElement("div",{className:"formula-error-wrap",key:e.title+e.content,style:{marginTop:t>0&&a.length>1?8:0}},p.createElement("span",{className:n},e.title+"："),p.createElement("span",{className:"formula-error-content"},e.content))})))},t}(p.Component)),w=C,R=a("../packages/report/src/index.ts"),S=a("../spread-sheet/src/core/view/spreadsheet-view/table-view/utils.ts"),_=a("../packages/common-utils/src/index.ts"),E=a("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),x=a("../spread-sheet/src/base/util/domain-config.ts"),y=function(e){function t(t){var a;return(a=e.call(this)||this)._row=-1,a._col=-1,a.handleMove=(0,_.Ds)((function(){if((!a.operateData||a.operateData.isHoverCell())&&a.tableView&&a.operateData){var e=(0,S.Fs)(a.tableView,a.operateData.currRow,a.operateData.currCol),t=e.row,n=e.col;a.show(t,n)}}),100),a.hide=function(){a._row>=0&&a._col>=0&&a._cardCenter.getCardGroup(a._row,a._col).remove((0,d.Z)(a)),a._formulaObj.hide(),a._row=-1,a._col=-1},a._handleSelectCells=function(e){if(e.select){var t=e.select,n=t.xRange,r=t.yRange;if(!n||!r)return;var s=n[0],o=n[1],i=r[0],l=r[1];if(s!==o||i!==l)return}if(e.activation){var c=e.activation,h=c.row,d=c.col,u=a._spreadsheet.activeSheet.getCellDataAtPosition(h,d),p=null===u||void 0===u?void 0:u.getMergeReference();p&&(h=p.startRowIndex,d=p.startColIndex),a.show(h,d)}},a._getMessages=t.getMessages,a.selectCells=t.selectCells,a._cardCenter=t.cardCenter,a._spreadsheet=t.spreadsheet,a.operateData=t.operateData,a.tableView=t.tableView,a.mouseOperate=t.mouseOperate,a._container.classList.add("formula-error-card"),a._render(),a._initEvent(),a}(0,u.Z)(t,e);var n=t.prototype;return n.show=function(e,t){var a=this._isPluginWillShow(e,t);a.length<=0||(0,E.xy)(this._spreadsheet,e,t)?this._formulaObj.hide():(this.hide(),this._row=e,this._col=t,this._formulaObj.show(a),this._cardCenter.getCardGroup(e,t).append(this),R.ZP.tdwReport({module:"doc_excel",opername:"data_error",action:"popups_exp"}))},n._render=function(){var e=this,t=document.createElement("div");this._container.appendChild(t),f().render(m().createElement(w,{ref:function(t){e._formulaObj=t}}),t)},n._isPluginWillShow=function(e,t){var n,r,s=this._getMessages(e,t);return r=null===(n=a.g.SpreadsheetApp.view.canvas.dataValidationCenter)||void 0===n?void 0:n.validationListCard.showing,s.length>0&&!r?s:[]},n._initEvent=function(){this.selectCells&&this.selectCells.emitter.on(this.selectCells.EVENT.START_SELECT,this._handleSelectCells),this.mouseOperate&&!x.xc&&this.mouseOperate.onMousemove(this.handleMove)},t}(g.Z),I=a("../spread-sheet/src/core/feature/index.ts"),D=a("../spread-sheet/src/core/view/level-2/cell-corner/const.ts"),A=a("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),b=function(e){var t=this;this.handleCellCorner=function(e,a){var n=t._spreadsheet.activeSheet;if(n&&!(0,A.tE)(t._spreadsheet.parent,e,a)){var r=n.getCellDataAtPosition(e,a);if(r&&!(0,E.xy)(t._spreadsheet,e,a)){var s=r.getEffectiveValue(),o=I.Z.dataValidation.error.getDataValidationError(r,{rowIndex:e,colIndex:a,options:t._spreadsheet.sheetManager}),i=s&&s.type===l.Cell.EXTENDED_VALUE_TYPE.ERROR,h=(0,c.o)(t._spreadsheet,e,a,r);return o||i||h?{position:D.$s.LeftTop,color:D.Bq.Red}:void 0}}},this._spreadsheet=e.spreadsheet,this._cellCornerPlugin=e.cellCornerPlugin,this._cellCornerPlugin.addCornerHandler(this.handleCellCorner)},T=function(){function e(e){var t=this;this._getMessages=function(e,a){var n=t._spreadsheet.activeSheet.getCellDataAtPosition(e,a),r=n&&!(0,A.tE)(t._spreadsheet.parent,e,a)&&h(n,{rowIndex:e,colIndex:a,options:t._spreadsheet.sheetManager},t._spreadsheet);return r?t.getMessagesCore(r):[]},this._spreadsheet=e.spreadsheet,this._cardCenter=e.cardCenter,this.selectCells=e.selectCells,this.operateData=e.operateData,this.tableView=e.tableView,this.mouseOperate=e.mouseOperate,this._card=new y({getMessages:this._getMessages,selectCells:this.selectCells,cardCenter:this._cardCenter,spreadsheet:this._spreadsheet,operateData:this.operateData,tableView:this.tableView,mouseOperate:this.mouseOperate}),this._formulaErrorRenderPlugin=new b({spreadsheet:this._spreadsheet,cellCornerPlugin:e.cellCornerPlugin})}return e.prototype.getMessagesCore=function(e){var t=[],a=e.formulaError,r=e.dvError,s=e.dvInputMsg,i=e.filterViewReorderWarn;if((null===r||void 0===r?void 0:r.message)&&r.title||function(e,t){o().isMobile||(null===t||void 0===t?void 0:t.message)&&t.title&&e.push({content:t.message,title:t.title,type:n.ERROR})}(t,a),(null===r||void 0===r?void 0:r.message)&&r.title)t.push({content:r.message,title:r.title,type:n.ERROR});else if(s){var l=s.message;l=l.slice&&"$"===l.slice(0,1)?l.slice(1):l,t.push({content:l,title:s.title,type:n.WARN})}return i&&t.push({content:i.message,title:i.title,type:n.WARN}),t},e}()},"../spread-sheet/src/core/view/level-2/private-range/index.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return s}}),a("../node_modules/core-js/modules/es.array.filter.js"),a("../node_modules/core-js/modules/es.array.map.js"),a("../node_modules/core-js/modules/es.array.from.js"),a("../node_modules/core-js/modules/es.string.iterator.js"),a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.object.assign.js");var n=a("../spread-sheet/src/core/data/configService/spreadConfig.ts"),r=a("../packages/model/src/filter-view/utils/grid-range-util.ts"),s=function(e){var t=this;this.getRenderPrivateRanges=function(){if(!n.q.getConfig("isOwner"))return null;var e=t.spreadsheet,a=e.workbookRangeManager,s=e.activeSheetId,o=Array.from(a.privateRangeMap.values()).map((function(e){return e.range})).filter((function(e){return e.sheetId===s}));return(0,r.gj)(o,t.spreadsheet.activeSheet)},Object.assign(this,e),this.areaTexturePlugin.addTextureAreaHandler(this.getRenderPrivateRanges)}},"../spread-sheet/src/core/view/level-2/range-auth/range-auth-render-plugin.ts":function(e,t,a){a.r(t),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.object.assign.js");var n=a("../spread-sheet/src/core/app/sheetStatus/ranges.ts"),r=(a("../spread-sheet/src/base/util/domain-config.ts"),function(){function e(e){var t=this;this.isRenderShowAuthRange=!1,this.rangeStatus=n.BP.READ_ONLY,this.getRangeAuthRangeList=function(){if(!t.isRenderShowAuthRange)return null;var e=t.spreadsheet,a=e.activeSheet,r=e.activeSheetId,s=t.sheetStatus.getRangeStatusBlockByBlock(r,t.rangeStatus),o=[];s.forEach((function(e){e.isSheet||o.push(e.clampToSheetSize(a))}));var i=t.spreadsheet.activeSheet.mergeManager.mergeList,l=null===t.rangeStatus?n.BP.READ_ONLY:t.rangeStatus;return i.forEach((function(e){t.sheetStatus.isGridRangeSetRangeStatus(e,l)&&o.push(e)})),o},Object.assign(this,e),this.areaTexturePlugin.addTextureAreaHandler(this.getRangeAuthRangeList)}var t=e.prototype;return t.enableRangeAuthRender=function(e){this.isRenderShowAuthRange=!0,this.rangeStatus=e,this.areaTexturePlugin.refreshRender()},t.cancelRangeAuthRender=function(){this.isRenderShowAuthRange=!1,this.areaTexturePlugin.refreshRender()},e}());t.default=r},"../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts":function(e,t,a){var n=a("../packages/lib/EventEmitter.ts");t.Z=function(e){this.emitter=new n.Z,this._alloyExcel=e.alloyExcel}},"../spread-sheet/src/core/view/level-2/render-plugin/RenderPluginExtension.ts":function(e,t,a){a.r(t);var n=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),r=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/renderer/BaseRenderer.ts"),s=function(){function e(e){this._alloyExcel=e.alloyExcel,this._coverBackgroundCollect=this._alloyExcel.collectEngine.generateCollector(r.g4.GraphicsRender,r.DF.CoverBackground),this._alloyExcel.collectEngine.add("cover-background",this._coverBackgroundCollect),this._textureBackgroundCollector=this._alloyExcel.collectEngine.generateCollector(r.g4.GraphicsRender,r.DF.RangeAuthBackground),this._alloyExcel.collectEngine.add("texture-background",this._textureBackgroundCollector),this._highlightAnimateCollector=this._alloyExcel.collectEngine.generateCollector(r.g4.GraphicsRender,r.DF.HighlightAnimate),this._alloyExcel.collectEngine.add("highlight-animate",this._highlightAnimateCollector),this.selectRowColHighlightCollector=this._alloyExcel.collectEngine.generateCollector(r.g4.GraphicsRender,r.DF.SelectRowColHighlight),this._alloyExcel.collectEngine.add("select-rowcol-highlight",this.selectRowColHighlightCollector),this._rangeBorderRenderCollector=this._alloyExcel.collectEngine.generateCollector(r.g4.LineRenderer,r.DF.ChartRange),this._alloyExcel.collectEngine.add("chart-range-line",this._rangeBorderRenderCollector),this.shapeToCellHighlightCollector=this._alloyExcel.collectEngine.generateCollector(r.g4.GraphicsRender,r.DF.ShapeToCellHighlight),this._alloyExcel.collectEngine.add("shape-to-cell-highlight",this.shapeToCellHighlightCollector)}return(0,n.Z)(e,[{key:"coverBackgroundCollect",get:function(){return this._coverBackgroundCollect}},{key:"textureBackgroundCollector",get:function(){return this._textureBackgroundCollector}},{key:"formulaTextRenderCollector",get:function(){return this._formulaTextRenderCollector}},{key:"highlightAnimateCollector",get:function(){return this._highlightAnimateCollector}},{key:"formulaBgRenderCollector",get:function(){return this._formulaBgRenderCollector}},{key:"rangeBorderRenderCollector",get:function(){return this._rangeBorderRenderCollector}}]),e}();t.default=s},"../spread-sheet/src/core/view/level-2/search-replace2/interface.ts":function(e,t,a){var n,r;a.d(t,{H:function(){return r},S:function(){return n}}),function(e){e[e.CASE_DIFF=0]="CASE_DIFF",e[e.ONLY_FORMULA=1]="ONLY_FORMULA",e[e.SEARCH_IN_COL=2]="SEARCH_IN_COL",e[e.ALL_MATCH=3]="ALL_MATCH"}(n||(n={})),function(e){e.InSheet="insheet",e.AllSheet="allsheet",e.Range="range"}(r||(r={}))},"../spread-sheet/src/core/view/level-2/search-replace2/panel/pc/search-replace-modal.tsx":function(e,t,a){a.d(t,{N:function(){return n},Z:function(){return E}}),a("../node_modules/core-js/modules/es.object.assign.js");var n,r=a("../node_modules/i18next/dist/esm/i18next.js"),s=a("react"),o=a.n(s),i=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),l=a("../node_modules/@tencent/dui/lib/components/Input/index.js"),c=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),h=a.n(c),d=a("../node_modules/lodash/debounce.js"),u=a.n(d),p=function(e){function t(t){var a;return(a=e.call(this,t)||this).clickPrev=function(){a.props.handlePrev()},a.clickNext=function(){if(a.props.handleNext(),h().isSafari){var e=document.querySelector(".search-button-wrap .next-button");e&&document.activeElement!==e&&e.focus()}},a.onChange=function(e,t){a.isInputUpdate=!0,a.setState({searchText:e});var n=null===t||void 0===t?void 0:t.nativeEvent;u()((function(t){(null===t||void 0===t?void 0:t.isComposing)||a.props.handleChangeSearch(e)}),200)(n)},a.onCompositionEnd=function(e){var t,n;if(h().isFirefox){var r=null===(n=null===(t=null===e||void 0===e?void 0:e.nativeEvent)||void 0===t?void 0:t.target)||void 0===n?void 0:n.value;r=r||a.state.searchText,a.onChange(r,e)}else a.onChange(a.state.searchText,e)},a.onInputKeyDown=function(e){if(13===(null===e||void 0===e?void 0:e.keyCode)){if(null===e||void 0===e?void 0:e.shiftKey)return void a.props.handlePrev();a.props.handleNext()}},a.state={searchText:a.props.searchCache},a.searchInputRef=o().createRef(),a}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e;null===(e=this.searchInputRef.current)||void 0===e||e.focus()},a.componentDidUpdate=function(e){var t;e.keyboardOpen&&!this.isInputUpdate&&(null===(t=this.searchInputRef.current)||void 0===t||t.focus()),this.isInputUpdate=!1},a.render=function(){var e="";0!==this.props.total?e=this.props.current+1+"/"+this.props.total:""!==this.props.searchCache&&(e=r.ZP.t("无结果"));var t=this.props.total?{}:{display:"none"},a=this.props.isLoading?o().createElement("div",{className:"search-count-info"},o().createElement("div",{className:"search-icon loading"})):o().createElement("div",{className:"search-count-info"},o().createElement("div",{className:"search-icon prevbtn",onClick:this.clickPrev,style:t}),o().createElement("div",{className:"search-count-info-content"},e),o().createElement("div",{className:"search-icon nextbtn",onClick:this.clickNext,style:t})),n=this.props.isRegionSearch?r.ZP.t("在范围 {{value}} 中查找",{value:this.props.region}):r.ZP.t("输入查找内容");return o().createElement("div",{className:"search-replace-content-wrap"},o().createElement(l.default,{inputRef:this.searchInputRef,placeholder:n,id:"search-input",className:"search-input",value:this.state.searchText,onChange:this.onChange,onCompositionEnd:this.onCompositionEnd,onMouseDown:function(e){return e.stopPropagation()},icon:a,autoComplete:"off",onKeyDown:this.onInputKeyDown}),o().createElement("div",{className:"search-message-wrap",style:this.props.message?{}:{display:"none"}},o().createElement("div",{className:"search-replace-message"},this.props.message)),o().createElement("div",{className:"search-advance-switch-wrap"},o().createElement("div",{className:"expand-info",onClick:this.props.handleChooseAdvancedContent},r.ZP.t("替换 / 高级查找"),o().createElement("span",{className:"expand-icon"}))))},t}(o().Component),m=(a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.regexp.to-string.js"),a("../node_modules/@tencent/dui/lib/components/Button/index.js")),v=a("../spread-sheet/src/core/view/level-2/search-replace2/interface.ts"),f=a("../node_modules/@tencent/dui/lib/components/Checkbox/index.js"),g=a("../node_modules/@tencent/dui/lib/components/Select/index.js"),C=a("../spread-sheet/src/core/view/level-2/condition-format-center/ui/utils/dataUtils.ts"),w=a("../spread-sheet/src/external/view/main/panel/dataValidationPanel/style/assets.ts"),R=function(e){function t(t){var a,n;return(a=e.call(this,t)||this).clickPrev=function(){a.props.handlePrev()},a.clickNext=function(){if(a.props.handleNext(),h().isSafari){var e=document.querySelector(".search-button-wrap .next-button");e&&document.activeElement!==e&&e.focus()}},a.onSearchChange=function(e){a.isInputUpdate=!0,a.setState({searchText:e,keyboardOpen:!1}),a.props.handleChangeSearch(e,!1)},a.onReplaceChange=function(e){a.isInputUpdate=!0,a.setState({replaceText:e,keyboardOpen:!1})},a.handleSearch=function(){a.props.handleChangeSearch(a.state.searchText)},a.handleReplaceSingle=function(){a.props.handleReplace(a.state.searchText,a.state.replaceText)},a.handleReplaceAll=function(){a.props.handleReplaceAll(a.state.searchText,a.state.replaceText)},a.onCheckBoxClick=function(e,t){var n,r,s,o,i,l,c,h;if(t.target){var d=t.target["attr-type"];switch(d){case v.S.ALL_MATCH:a.setState({isMatchAll:e}),null===(r=(n=a.props).handleCheckBoxChange)||void 0===r||r.call(n,{caseIgnore:a.state.isCaseIgnore,onlyFormula:a.state.onlyFormula,searchInCol:a.state.searchInCol,allMatch:e},d);break;case v.S.CASE_DIFF:a.setState({isCaseIgnore:e}),null===(o=(s=a.props).handleCheckBoxChange)||void 0===o||o.call(s,{caseIgnore:e,onlyFormula:a.state.onlyFormula,searchInCol:a.state.searchInCol,allMatch:a.state.isMatchAll},d);break;case v.S.ONLY_FORMULA:a.setState({onlyFormula:e}),null===(l=(i=a.props).handleCheckBoxChange)||void 0===l||l.call(i,{caseIgnore:a.state.isCaseIgnore,onlyFormula:e,searchInCol:a.state.searchInCol,allMatch:a.state.isMatchAll},d);break;case v.S.SEARCH_IN_COL:a.setState({searchInCol:e}),null===(h=(c=a.props).handleCheckBoxChange)||void 0===h||h.call(c,{caseIgnore:a.state.isCaseIgnore,onlyFormula:a.state.onlyFormula,searchInCol:e,allMatch:a.state.isMatchAll},d)}}},a.handleChangeSearchRegion=function(e){e!==a.state.rtype&&(a.setState({rtype:e,ranges:""}),a.props.handleRegionTypeChange(e))},a.rangeInputChange=function(e){(0,C.V4)("rule_panel_type_area"),-1!==e.indexOf(",")&&(0,C.V4)("rule_panel_type_nonadjacent_area")},a.handleEnterSelectionPanel=function(){a.props.handleRangeSelect((function(e){a.setState({ranges:e})}))},a.onInputKeyDown=function(e){if(13===(null===e||void 0===e?void 0:e.keyCode)){if(null===e||void 0===e?void 0:e.shiftKey)return void a.props.handlePrev();a.props.handleNext()}},a.state={searchText:a.props.searchCache,replaceText:"",rtype:a.props.isRegionSearch?v.H.Range:v.H.InSheet,ranges:(null===(n=a.props.region)||void 0===n?void 0:n.toString())||"",isCaseIgnore:!1,onlyFormula:!1,isMatchAll:!1,searchInCol:!1},a.searchInputRef=o().createRef(),a.replaceInputRef=o().createRef(),a}(0,i.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e;null===(e=this.searchInputRef.current)||void 0===e||e.focus()},a.componentDidUpdate=function(e){var t;e.keyboardOpen&&!this.isInputUpdate&&(null===(t=this.searchInputRef.current)||void 0===t||t.focus()),this.isInputUpdate=!1},a.render=function(){var e="";0!==this.props.total?e=this.props.current+1+"/"+this.props.total:""!==this.props.searchCache&&(e=r.ZP.t("无结果"));var t=this.props.total?{}:{display:"none"},a=this.props.isLoading?o().createElement("div",{className:"search-count-info"},o().createElement("div",{className:"search-icon loading"})):o().createElement("div",{className:"search-count-info"},o().createElement("div",{className:"search-icon prevbtn",onClick:this.clickPrev,style:t}),o().createElement("div",{className:"search-count-info-content"},e),o().createElement("div",{className:"search-icon nextbtn",onClick:this.clickNext,style:t})),n=this.state.rtype===v.H.Range?r.ZP.t("在范围 {{value}} 中查找",{value:this.state.ranges}):r.ZP.t("输入查找内容"),s=0===this.props.total||!this.props.canSearch;return o().createElement("div",{className:"search-replace-content-wrap"},o().createElement(l.default,{inputRef:this.searchInputRef,placeholder:n,id:"search-input",className:"search-input",value:this.state.searchText,onChange:this.onSearchChange,onMouseDown:function(e){return e.stopPropagation()},icon:a,autoComplete:"off",onKeyDown:this.onInputKeyDown}),!this.props.hideReplace&&o().createElement(o().Fragment,null,o().createElement("div",{className:"text-wrap"},r.ZP.t("替换为")),o().createElement(l.default,{onMouseUp:function(e){return e.stopPropagation()},inputRef:this.replaceInputRef,placeholder:r.ZP.t("输入替换内容"),id:"replace-input",className:"replace-input",onChange:this.onReplaceChange,value:this.state.replaceText,autoComplete:"off"})),this.props.showRegionTypeSelect&&this.renderReginSelect(),this.renderCheckboxGroup(),o().createElement("div",{className:"search-button-wrap"},o().createElement(m.default,{type:"primary",onClick:this.handleSearch,disabled:!this.props.canSearch},r.ZP.t("查找")),!this.props.hideReplace&&o().createElement("div",null,o().createElement(m.default,{onClick:this.handleReplaceSingle,disabled:!this.props.canSingleReplace||s},r.ZP.t("替换")),o().createElement(m.default,{style:{marginLeft:16,padding:"0 15px"},onClick:this.handleReplaceAll,disabled:!this.props.canReplaceAll||s},r.ZP.t("全部替换")))),o().createElement("div",{className:"search-message-wrap",style:this.props.message?{}:{display:"none"}},o().createElement("div",{className:"search-replace-message"},this.props.message)))},a.renderCheckboxGroup=function(){var e=Object.assign({showCaseIgnore:!1,showSearchInCol:!1,showOnlyFormula:!1,showMatchAll:!1},this.props.showCheckBoxType),t=e.showCaseIgnore,a=e.showSearchInCol,n=e.showOnlyFormula,s=e.showMatchAll;return o().createElement("div",{className:"search-checkbox-group-wrap"},t&&o().createElement(f.default,{className:"search-condition","attr-type":v.S.CASE_DIFF,onChange:this.onCheckBoxClick,disabled:this.props.isLoading,checked:this.state.isCaseIgnore},r.ZP.t("区分大小写")),a&&o().createElement(f.default,{className:"search-condition","attr-type":v.S.SEARCH_IN_COL,onChange:this.onCheckBoxClick,disabled:this.props.isLoading,checked:this.state.searchInCol},r.ZP.t("按列查找")),n&&o().createElement(f.default,{className:"search-condition","attr-type":v.S.ONLY_FORMULA,onChange:this.onCheckBoxClick,disabled:this.props.isLoading,checked:this.state.onlyFormula},r.ZP.t("仅在公式中查找")),s&&o().createElement(f.default,{className:"search-condition","attr-type":v.S.ALL_MATCH,onChange:this.onCheckBoxClick,disabled:this.props.isLoading,checked:this.state.isMatchAll},r.ZP.t("完全匹配单元格内容")))},a.renderReginSelect=function(){var e=this.state.rtype===v.H.Range,t=e?{width:"168px"}:{width:"352px"};return o().createElement("div",{className:"search-region-wrapper"},o().createElement(g.default,{className:"search-region-select",style:t,value:this.state.rtype,onChange:this.handleChangeSearchRegion,disabled:this.props.isLoading},o().createElement(g.default.Option,{value:v.H.InSheet},r.ZP.t("查找当前工作表")),o().createElement(g.default.Option,{value:v.H.AllSheet},r.ZP.t("查找全部工作表")),o().createElement(g.default.Option,{value:v.H.Range},r.ZP.t("查找指定范围"))),e&&o().createElement(l.default,{style:{width:"168px",marginLeft:"16px",display:"inline-block"},placeholder:r.ZP.t("在工作表中框选范围"),value:this.state.ranges,inputMode:"none",inputRef:this.inputRangeRef,inputStyle:{height:"36px"},icon:w.Z,onClickIcon:this.handleEnterSelectionPanel}))},t}(o().Component),S=a("../node_modules/@tencent/dui/lib/components/Modal/index.js"),_=a("../spread-sheet/src/base/util/html.ts");!function(e){e[e.BASIC_SEARCH=0]="BASIC_SEARCH",e[e.ADVANCED_SEARCH=1]="ADVANCED_SEARCH"}(n||(n={}));var E=function(){function e(e){var t=this;this.close=function(){t.dialog&&(t.removeListener(),t.dialog.close(),t.dialog=null)},this.handleIpadKeyboardHide=function(){h().isIPad&&h().isTencentDocsApp&&window.scrollTo(0,0)},this.updateDependency=function(e){Object.assign(t.initDependency,e),t.initDependency.isKeyboardOpen=!!e.isKeyboardOpen},this.initDependency=e,this.searchContentRef=o().createRef()}var t=e.prototype;return t.renderTitle=function(){return o().createElement("div",{className:"search-replace-head-warp"},o().createElement("li",{className:"replace active"},this.initDependency.mode===n.BASIC_SEARCH?r.ZP.t("查找"):r.ZP.t("查找替换")))},t.renderContent=function(){return this.initDependency.mode===n.BASIC_SEARCH?(this.searchContentRef=o().createRef(),o().createElement(p,{ref:this.searchContentRef,handleNext:this.initDependency.handleNext,handleChangeSearch:this.initDependency.handleChangeSearch,handlePrev:this.initDependency.handlePrev,handleClose:this.initDependency.handleClose,handleChooseAdvancedContent:this.initDependency.handleChooseAdvancedContent,current:this.initDependency.current,total:this.initDependency.total,keyboardOpen:!!this.initDependency.isKeyboardOpen,searchCache:this.initDependency.searchCache||"",message:this.initDependency.message||"",isRegionSearch:this.initDependency.regionType===v.H.Range,region:this.initDependency.region,isLoading:this.initDependency.isLoading})):this.initDependency.mode===n.ADVANCED_SEARCH?(this.searchContentRef=o().createRef(),o().createElement(R,{ref:this.searchContentRef,handleNext:this.initDependency.handleNext,handleChangeSearch:this.initDependency.handleChangeSearch,handlePrev:this.initDependency.handlePrev,handleClose:this.initDependency.handleClose,handleReplace:this.initDependency.handleReplace,handleReplaceAll:this.initDependency.handleReplaceAll,handleRangeSelect:this.initDependency.handleRangeSelect,handleRegionTypeChange:this.initDependency.handleRegionTypeChange,handleCheckBoxChange:this.initDependency.handleCheckBoxChange,current:this.initDependency.current,total:this.initDependency.total,keyboardOpen:!!this.initDependency.isKeyboardOpen,searchCache:this.initDependency.searchCache||"",message:this.initDependency.message||"",isRegionSearch:this.initDependency.regionType===v.H.Range,region:this.initDependency.region,canReplaceAll:!!this.initDependency.canReplace,canSingleReplace:!!this.initDependency.canSingleReplace,canSearch:void 0===this.initDependency.canSearch||this.initDependency.canSearch,isLoading:this.initDependency.isLoading,showCheckBoxType:this.initDependency.showCheckBoxType,showRegionTypeSelect:this.initDependency.showRegionTypeSelect,hideReplace:this.initDependency.hideReplace})):void 0},t.show=function(t){if(this.updateDependency(t),!this.dialog)return this.createDialog(),void this.addListener();t.regionType&&this.initDependency.handleRegionTypeChange(t.regionType),this.dialog.update({title:this.renderTitle(),content:this.renderContent(),style:Object.assign(Object.assign({},this.initDependency.mode===n.BASIC_SEARCH?e.basicStyle:e.advancedStyle),{position:"absolute",paddingLeft:"0px",paddingRight:"0px"})})},t.update=function(t){this.updateDependency(t),t.regionType&&this.initDependency.handleRegionTypeChange(t.regionType),this.dialog&&this.dialog.update({title:this.renderTitle(),content:this.renderContent(),style:Object.assign(Object.assign({},this.initDependency.mode===n.BASIC_SEARCH?e.basicStyle:e.advancedStyle),{position:"absolute",paddingLeft:"0px",paddingRight:"0px",transition:"all 100ms ease-in-out",visibility:!1===this.initDependency.visible?"hidden":"visible"})})},t.createDialog=function(){this.dialog=S.default.confirm({className:"search-replace-dialog",destroyOnClose:!0,mask:!1,draggable:!0,style:Object.assign(Object.assign({},this.initDependency.mode===n.BASIC_SEARCH?e.basicStyle:e.advancedStyle),{position:"absolute",paddingLeft:"0px",paddingRight:"0px"}),title:this.renderTitle(),content:this.renderContent(),footer:null,onCancel:this.initDependency.handleClose,onClose:this.initDependency.handleClose})},t.addListener=function(){(0,_.vP)(document,"focusout",this.handleIpadKeyboardHide,!0)},t.removeListener=function(){(0,_.xC)(document,"focusout",this.handleIpadKeyboardHide,!0)},e}();E.basicStyle={minHeight:180,width:400,top:103,right:10},E.advancedStyle={minHeight:276,width:400,top:103,right:10}},"../spread-sheet/src/core/view/level-2/search-replace2/search-replace-center2.pc.ts":function(e,t,a){a.r(t),a.d(t,{default:function(){return et}});var n=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),r=(a("../node_modules/core-js/modules/es.object.assign.js"),a("../spread-sheet/src/base/index.ts")),s=a("../spread-sheet/src/core/view/level-2/search-replace2/panel/pc/search-replace-modal.tsx"),o=a("../spread-sheet/src/core/view/level-2/search-replace2/interface.ts"),i=(a("../node_modules/core-js/modules/es.array.filter.js"),a("../node_modules/core-js/modules/es.array.from.js"),a("../node_modules/core-js/modules/es.string.iterator.js"),a("../node_modules/core-js/modules/es.array.find-index.js"),a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/es.map.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/esnext.map.delete-all.js"),a("../node_modules/core-js/modules/esnext.map.every.js"),a("../node_modules/core-js/modules/esnext.map.filter.js"),a("../node_modules/core-js/modules/esnext.map.find.js"),a("../node_modules/core-js/modules/esnext.map.find-key.js"),a("../node_modules/core-js/modules/esnext.map.includes.js"),a("../node_modules/core-js/modules/esnext.map.key-of.js"),a("../node_modules/core-js/modules/esnext.map.map-keys.js"),a("../node_modules/core-js/modules/esnext.map.map-values.js"),a("../node_modules/core-js/modules/esnext.map.merge.js"),a("../node_modules/core-js/modules/esnext.map.reduce.js"),a("../node_modules/core-js/modules/esnext.map.some.js"),a("../node_modules/core-js/modules/esnext.map.update.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.array.concat.js"),a("../node_modules/core-js/modules/es.array.slice.js"),a("../node_modules/core-js/modules/es.array.find.js"),a("../node_modules/core-js/modules/es.promise.js"),a("../node_modules/core-js/modules/es.regexp.exec.js"),a("../node_modules/core-js/modules/es.string.split.js"),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../node_modules/core-js/modules/es.array.join.js"),a("../node_modules/core-js/modules/es.string.match.js"),a("../node_modules/core-js/modules/es.array.sort.js"),a("../packages/model/src/grid/index.ts")),l=a("../packages/model/src/range/hexRangeUtils.ts"),c=a("../packages/model/src/range/index.ts"),h=a("../packages/model/src/cell/metadata/CustomDataType.ts");function d(e,t){var a,n=null===(a=t.sheetManager.getSheetBySheetId(e))||void 0===a?void 0:a.properties;return!n||(null===n||void 0===n?void 0:n.hidden)?null:new c.GridRange({sheetId:n.sheetId,startRowIndex:0,endRowIndex:(null===n||void 0===n?void 0:n.gridProperties.rowCount)-1,startColIndex:0,endColIndex:(null===n||void 0===n?void 0:n.gridProperties.colCount)-1})}function u(e,t,a,n){var r,s=null===(r=t.sheetManager.getSheetBySheetId(e))||void 0===r?void 0:r.properties;return!s||(null===s||void 0===s?void 0:s.hidden)?null:new c.GridRange({sheetId:s.sheetId,startRowIndex:a.row,endRowIndex:n.row,startColIndex:a.col,endColIndex:n.col})}function p(e,t){var a=Array.from(e.sheetManager.sheetMap).filter((function(t){var a=t[1];return!a.getDisplayHidden()&&!e.isExternalSheet(a.getSheetId())})),n=a.findIndex((function(a){return t?a[0]===t:a[0]===e.activeSheetId}));return new Map(a.slice(n,a.length).concat(a.slice(0,n)))}function m(e,t,n){return new Promise((function(r,s){var o=n.sheetManager.getSheetBySheetId(e);if(o)if(o.isLoaded)r(!0);else try{a.g.log.info("search-replace: 子表 "+e+" 开始loadSheet"),t.loadSheetData({sheetId:e,onFinished:function(){a.g.log.info("search-replace: 子表 "+e+" loadSheet结束"),r(!0)},onFail:function(e){r(!1),a.g.log.log(e)}})}catch(i){a.g.log.info("search-replace: 子表 "+e+" loadSheet 发生异常"),s(i)}else r(!1)}))}var v=function(e,t){return t.findIndex((function(t){return t.position.row===e.rowIndex&&t.position.col===e.colIndex}))},f=function(e){var t,a=e.getSelectionWithGridRanges(),n=e.getSelectionWithGridRanges().activeCell;if(0===(null===(t=a.rangeSelections)||void 0===t?void 0:t.length))return n;var r=a.rangeSelections[0],s=r.startColIndex,o=r.startRowIndex,l=r.endRowIndex;return s===r.endColIndex&&o===l?new i.Cell(n.sheetId,o,s):n},g=function(e){return e.canEdit},C=function(e,t){var a=-1;return t.length<=0||e.colIndex<0||e.rowIndex<0?a:a=t.findIndex((function(t){return t.position.row===e.rowIndex&&t.position.col>=e.colIndex||t.position.row>e.rowIndex}))},w=function(e,t){var a=-1;return t.length<=0||e.colIndex<0||e.rowIndex<0?a:(a=Array.from(t).reverse().findIndex((function(t){return t.position.row===e.rowIndex&&t.position.col<=e.colIndex||t.position.row<e.rowIndex})),t.length-a-1)},R=function(e,t){var a=-1;return t.length<=0||e.colIndex<0||e.rowIndex<0?a:a=t.findIndex((function(t){return t.position.col===e.colIndex&&t.position.row>e.rowIndex||t.position.col>e.colIndex}))},S=function(e,t){var a=-1;return t.length<=0||e.colIndex<0||e.rowIndex<0?a:(a=Array.from(t).reverse().findIndex((function(t){return t.position.col===e.colIndex&&t.position.row<=e.rowIndex||t.position.col<e.colIndex})),t.length-a-1)},_=function(e,t,a){var n,r,s=a.activeSheet.data,o=s.colMetadata,i=s.rowMetadata;return(null===(n=null===o||void 0===o?void 0:o[e])||void 0===n?void 0:n.hiddenByUser)||!!(null===(r=null===i||void 0===i?void 0:i[t])||void 0===r?void 0:r.hiddenByUser)},E=function(e,t){var a=t.row,n=t.col;return a<e.row||a===e.row&&n<e.col},x=function(e,t){var a=t.row,n=t.col;return n<e.col||n===e.col&&a<e.row},y=function(e,t){var a=t.row,n=t.col;return n>e.col||n===e.col&&a>e.row},I=function(e,t){var a=t.row,n=t.col;return a>e.row||a===e.row&&n>e.col},D=function(e,t){var a=t.getSelectionWithGridRanges();if(!a.activeCell||!a.rangeSelections||0===a.rangeSelections.length)return!1;if(a.rangeSelections.length>=2)return!0;var n=a.rangeSelections[0],r=n.endColIndex,s=n.endRowIndex,o=(r!==a.activeCell.colIndex||s!==a.activeCell.rowIndex)&&!A(e,t)&&!b(e,t,0);return o},A=function(e,t){var a,n=t.getSelectionWithGridRanges();if(null===(a=null===n||void 0===n?void 0:n.rangeSelections)||void 0===a?void 0:a[0]){var r=n.rangeSelections[0],s=r.startColIndex,o=r.startRowIndex,i=r.endColIndex,l=r.endRowIndex,c=e.activeSheet.getCellDataAtPosition(l,i),h=null===c||void 0===c?void 0:c.getMergeReference();return(null===h||void 0===h?void 0:h.startColIndex)===s&&(null===h||void 0===h?void 0:h.startRowIndex)===o}return!1},b=function(e,t,a){var n,r,s,o,i,l,c=t.getSelectionWithGridRanges(),h=c.rangeSelections[a],d=h.startColIndex,u=h.startRowIndex,p=null===(r=null===(n=e.activeSheet.data.colMetadata)||void 0===n?void 0:n[d])||void 0===r?void 0:r.hiddenByUser,m=null===(o=null===(s=e.activeSheet.data.rowMetadata)||void 0===s?void 0:s[u])||void 0===o?void 0:o.hiddenByUser;return(null===(i=null===c||void 0===c?void 0:c.selectQueue)||void 0===i?void 0:i[a].selectCol)&&p||(null===(l=null===c||void 0===c?void 0:c.selectQueue)||void 0===l?void 0:l[a].selectRow)&&m},T=function(e,t,a){var n=t.split(",");if(n.length<=0)return[];var r=a.sheetManager.getSheetBySheetId(e),s=[];return n.forEach((function(t){var a=(0,l.hex2Range)(t,e);a&&(r&&(a=a.clampToSheetSize(r)),s.push(a))})),s},M=function(e,t){var a=t.getSelectionWithGridRanges();if(!a.activeCell||!a.rangeSelections)return"";var n=e.activeSheetId,r=e.sheetManager.getSheetBySheetId(n);if(!r)return"";var s=a.rangeSelections,o=[];return s.forEach((function(e){var t=(0,l.range2RelativeHex)(e,r);o.push(t)})),o.join(",")},k=function(e){var t,a=e.getEffectiveValue();return(null===(t=e.getMetadata())||void 0===t?void 0:t.customDataType)===h.ZP.IMAGE&&"图片"===(null===a||void 0===a?void 0:a.value)},P=function(e){var t;return(null===(t=null===e||void 0===e?void 0:e.getMetadata())||void 0===t?void 0:t.customDataType)===h.ZP.DATE_REMINDER},L=function(e){return!!e.getUserEnteredFormat()},N=function(e){return!!e.getFormula()},j=function(e){return!!e.getMentionDetails()},O=/(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g,H=function(e){var t;return!!e.getHyperlink()||!!(null===(t=e.getEditValue())||void 0===t?void 0:t.match(O))},B=function(e,t){return new Promise((function(a,n){e.sheetsBar.trigger("switchSheet",t,t,{onSuccess:function(){a(-1)},onFail:function(){e.sheetsBar.trigger("switchSheet",t),n(-2)}})}))},V=function(e){return Array.from(e).sort((function(e,t){return e.position.col===t.position.col&&e.position.row>t.position.row||e.position.col>t.position.col?0:-1}))},Z=function(e,t,a){var n=a.canvas.areaData.row.frozen,r=n.renderFrom,s=n.renderTo,o=a.canvas.areaData.row.flow,i=o.renderFrom,l=o.renderTo,c=a.canvas.areaData.col.frozen,h=c.renderFrom,d=c.renderTo,u=a.canvas.areaData.col.flow,p=u.renderFrom,m=u.renderTo;return(e>=r&&e<=s||e>=i&&e<=l)&&(t>=h&&t<=d||t>=p&&t<=m)},F=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),U=a("../spread-sheet/src/core/view/utils/base-func.ts"),z=a("../spread-sheet/src/core/view/spreadsheet-view/model/Color.ts"),W=a("../spread-sheet/src/core/view/level-2/render-plugin/BaseRenderPlugin.ts"),G=a("../spread-sheet/src/core/view/spreadsheet-view/utils.ts"),Y=a("react"),K=a.n(Y),X=a("react-dom"),J=a.n(X),q=a("../spread-sheet/src/base/util/ui.tsx"),$=K().createRef(),Q=function(e){$.current&&J().unmountComponentAtNode(e)},ee=a("../spread-sheet/src/core/view/spreadsheet-view/render-manager/alloy-excel/canvas/CollectEngine.ts"),te=z.Z.newInstanceByHex("#fff2a3"),ae=function(e){function t(t){var a,n;return(a=e.call(this,t)||this).searchMap={},a.lastSearchMap={},a.showing=!1,a.renderAfterCell=function(e){if(a.showing){var t=e.x,n=e.y,r=e.row,s=e.col;if(void 0!==a.searchMap[r]&&void 0!==a.searchMap[r][s]){var o=a.tableView.getCellViewAtPosition(r,s),i=(0,G.o)(a.rowcolAccessor,o,s),l=(0,G.E)(a.rowcolAccessor,o,r);a.coverBackgroundCollect.collect({color:te.hex,graphicsInfo:{path:(0,U.j9)(t,n,i,l)}},ee.h.SEARCH_HIGHLIGHT)}}},a.setFormulaViewVisible=function(e){e?a.app.view.canvas.dataCallView.openFormulaDisplay():a.app.view.canvas.dataCallView.closeFormulaDisplay(),a.app.view.canvas.paragraphAccessor.formulaDisplay=e,a.app.spreadsheet.sheetManager.getSheetIdList().forEach((function(e){a.app.view.canvas.init(e)})),a.renderApi.renderNextTick()},a.updateCellHightBoxPosition=function(){if(a.currentCell){var e,t=a.currentCell,n=t.col,r=t.row,s=a.app.view.canvas.areaData.getDisplayViewLeftByCol(n),o=a.app.view.canvas.areaData.getDisplayViewTopByRow(r),i=Z(r,n,a.app.view),l=a.getRenderWidthHeight(n,r),c=l.width,h=l.height,d={left:s,top:o,height:h>0?h-1:h,width:c>0?c-1:c,hidden:!i};a.domContainer.hasChildNodes()&&(e=d,$.current&&$.current.setState({width:e.width,height:e.height,top:e.top,left:e.left,hidden:null===e||void 0===e?void 0:e.hidden}))}},a.getRenderWidthHeight=function(e,t){var n,r,s,o,i=a.tableView.getCellViewAtPosition(a.currentCell.row,a.currentCell.col),l=null===(r=null===(n=a.app.spreadsheet.activeSheet.data.rowMetadata)||void 0===n?void 0:n[t])||void 0===r?void 0:r.hiddenByUser;return{width:(null===(o=null===(s=a.app.spreadsheet.activeSheet.data.colMetadata)||void 0===s?void 0:s[e])||void 0===o?void 0:o.hiddenByUser)?0:(0,G.o)(a.rowcolAccessor,i,e)*a.app.view.canvas.scale.scale,height:l?0:(0,G.E)(a.rowcolAccessor,i,t)*a.app.view.canvas.scale.scale}},a.rowcolAccessor=t.rowcolAccessor,a.tableView=t.tableView,a.coverBackgroundCollect=t.renderPluginExtension.coverBackgroundCollect,a.renderApi=t.renderApi,a.app=t.spreadsheetApp,a.domContainer=document.createElement("div"),a.domContainer.classList.add("cell-find-highlight-board"),null===(n=t.spreadsheetApp.view.canvas.mainBoard)||void 0===n||n.element.appendChild(a.domContainer),a._alloyExcel.onAfterCellRender(a.renderAfterCell),a.spreadsheet=t.spreadsheetApp.spreadsheet,a.view=t.spreadsheetApp.view,a._alloyExcel.onAfterAreaRender(a.updateCellHightBoxPosition),a}(0,F.Z)(t,e);var a=t.prototype;return a.showSearchHighlight=function(e,t){for(var a=0;a<e.length;a++){var n=e[a].position,r=n.col,s=n.row;e[a].sheetId===t&&(void 0===this.searchMap[s]&&(this.searchMap[s]={}),this.searchMap[s][r]=1)}this.showing=!0,this.renderApi.renderNextTick()},a.refreshSearchHighlight=function(e,t){this.searchMap={},this.showSearchHighlight(e,t)},a.showCurrentHightBox=function(e,t){this.currentCell={col:e,row:t};var a=this.app.view.canvas.areaData.getDisplayViewLeftByCol(e),n=this.app.view.canvas.areaData.getDisplayViewTopByRow(t),r=this.getRenderWidthHeight(e,t),s=r.width,o=r.height,i={left:a,top:n,height:o>0?o-1:o,width:s>0?s-1:s};!function(e,t){var a,n=(null===(a=$.current)||void 0===a?void 0:a.state)||{},r=n.width,s=n.height,o=n.left,i=n.top;t.left===o&&t.top===i&&t.width===r&&t.height===s||((null===$||void 0===$?void 0:$.current)&&Q(e),J().render(K().createElement(q.WW,{ref:$,left:t.left,top:t.top,width:t.width,height:t.height,className:"search-hightlight-active-cell-rect"}),e))}(this.domContainer,i)},a.hideCurrentHightBox=function(){Q(this.domContainer)},a.hideSearch=function(e){this.lastSearchMap={},this.searchMap={},this.showing=!1,this.renderApi.renderNextTick(),e||Q(this.domContainer)},t}(W.Z),ne=a("../node_modules/i18next/dist/esm/i18next.js"),re=(a("../node_modules/core-js/modules/es.array.includes.js"),a("../node_modules/core-js/modules/es.string.includes.js"),a("../packages/model/src/range/GridRange.ts")),se=a("../packages/model/src/index.ts"),oe=a("../spread-sheet/src/core/view/level-2/search-replace2/controller/interface.ts"),ie=(a("../spread-sheet/src/base/util/domain-config.ts"),a("../spread-sheet/src/core/feature/index.ts")),le=function(e,t,a){var n,r=a.col,s=a.row,o=a.sheetId,i=null===(n=e.sheetManager.getSheetBySheetId(o))||void 0===n?void 0:n.getCellDataAtPosition(s,r),l=(null===i||void 0===i?void 0:i.getMergeReference())||new re.Z(o,s,s,r,r);return t.getRangeCanEdit(l)||!1},ce=function(e,t,a){var n=ie.Z.dataValidation.getUIDVAtPosition(e,t,a);return!0===(null===n||void 0===n?void 0:n.isStrict)};function he(e,t){return se.Range.hexRangeUtils.cellCoords2CellChar([t,e])}var de,ue=function(e,t){return L(t)&&(a=e).matchType.includes(oe.sM.FORMATTED_VALUE)&&!a.matchType.includes(oe.sM.EDIT_VALUE);var a},pe=function(e,t){return N(t)&&(a=e).matchType.includes(oe.sM.EFFECTIVE_VALUE)&&!a.matchType.includes(oe.sM.EDIT_VALUE);var a},me=a("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),ve=(a("../node_modules/@tencent/dui-mobile/lib/components/Snackbar/index.js"),function(e){function t(t){var a;return(a=e.call(this,t)||this).isFormulaViewVisible=!1,a.initPanel=function(e){a.panel=new s.Z({mode:a.mode,regionType:o.H.InSheet,current:0,total:0,handleChooseAdvancedContent:e.handleChooseAdvancedContent,handleNext:e.handleNext,handleChangeSearch:e.handleChangeSearch,handlePrev:e.handlePrev,handleReplace:e.handleReplace,handleReplaceAll:e.handleReplaceAll,handleClose:e.handleClose,handleRangeSelect:e.handleRangeSelect,handleRegionTypeChange:e.handleRegionTypeChange,handleCheckBoxChange:e.handleCheckBoxChange,canReplace:g(a.sheetStatus),hideReplace:!a.sheetStatus.workbookStatus.canEdit,searchCache:"",isKeyboardOpen:!1,isLoading:!1,showRegionTypeSelect:!0,showCheckBoxType:{showCaseIgnore:!0,showOnlyFormula:!0,showMatchAll:!0,showSearchInCol:!0}})},a.showPanel=function(e){var t;(null===e||void 0===e?void 0:e.mode)&&a.updatePanelMode(null===e||void 0===e?void 0:e.mode),null===(t=a.panel)||void 0===t||t.show(e)},a.addEventListener=function(){document.addEventListener("mousedown",a.setOperatingOn),document.addEventListener("mouseup",a.setOperatingOff),a.listenSearchEvent()},a.closePanel=function(){var e;a.panel.update({isLoading:!1}),null===(e=a.panel)||void 0===e||e.close()},a.disableAdvancedPanelButton=function(){a.panel.update({canReplace:!1,canSingleReplace:!1,canSearch:!1})},a.enableAdvancedPanelButton=function(){a.panel.update({canSearch:!0})},a.focusPanel=function(){var e,t;a.panel.dialog&&a.panel.searchContentRef&&(null===(t=null===(e=a.panel.searchContentRef.current)||void 0===e?void 0:e.searchInputRef)||void 0===t||t.current.focus())},a.checkEditPermission=function(e,t){var n=e.col,r=e.row;return!!le(a.spreadsheet,a.sheetStatus,e)||(a.updatePanelMessage(ne.ZP.t("单元格“{{value}}”没有编辑权限，暂不支持替换",{value:he(n,r)}),{current:t,col:n,row:r}),!1)},a.updatePanelRegion=function(e,t){a.panel.update({region:e,regionType:t})},a.setFormulaViewVisible=function(e){a.isFormulaViewVisible=e,a.searchHighlightRenderPlugin.setFormulaViewVisible(e)},a.updateAdvancedPanel=function(){var e;(null===(e=a.searchCacheParams.cacheResult)||void 0===e?void 0:e.length)>0&&a.searchCacheParams.cacheResult[a.searchCacheParams.current]&&a.checkAndUpdatePanel()},a.updateViewAfterCurrentChange=function(e,t){var n,r,s=a.searchCacheParams.current;if(a.updateSearchCacheParams(e),a.panel.update({current:a.searchCacheParams.current,total:a.searchCacheParams.total}),!(null===(n=a.searchCacheParams.cacheResult)||void 0===n?void 0:n[a.searchCacheParams.current]))return a.hideHighLightBox(),void a.panel.update({message:""});var o=null===(r=a.searchCacheParams.cacheResult[a.searchCacheParams.current])||void 0===r?void 0:r.position,i=o.row,l=o.col;a.focusHighLightBox(i,l),a.checkAndUpdatePanel(),t&&a.checkCircleRound(s)},a.updateViewAfterFragmentSearch=function(e,t,n){var r;if(a.updateSearchCacheParams(e),!(null===(r=a.searchCacheParams.cacheResult)||void 0===r?void 0:r[a.searchCacheParams.current]))return a.hideHighLightBox(),void a.panel.update({message:""});var s=a.searchCacheParams.cacheResult[a.searchCacheParams.current].sheetId;s===n&&(a.searchHighlightRenderPlugin.showSearchHighlight(t,s),a.checkAndUpdatePanel())},a.chooseAdvancedContent=function(e){var t,n;a.mode=s.N.ADVANCED_SEARCH,a.panel.update({mode:s.N.ADVANCED_SEARCH,current:a.searchCacheParams.current,total:a.searchCacheParams.total,searchCache:e}),(null===(n=null===(t=a.searchCacheParams.cacheResult)||void 0===t?void 0:t[a.searchCacheParams.current])||void 0===n?void 0:n.sheetId)&&a.checkAndUpdatePanel()},a.clear=function(){a.mode=s.N.BASIC_SEARCH,a.searchCacheParams={current:0,total:0,searchValue:"",cacheResult:[],panelTipInfo:"",findPrev:!1},a.panelMessageIndex=void 0,a.isFormulaViewVisible&&a.setFormulaViewVisible(!1)},a.listenSearchEvent=function(){var e;a.eventManager.needClearViewEvent((function(){a.toggleLoading(!1),a.clearView()})),a.eventManager.needUpdateMessageEvent((function(e){var t=a.searchCacheParams.cacheResult[a.searchCacheParams.current].position,n=t.col,r=t.row;a.updatePanelMessage(e.message,{current:e.index,col:n,row:r})})),a.eventManager.beforeJobStartEvent((function(){a.toggleLoading(!0),a.mode===s.N.ADVANCED_SEARCH&&a.disableAdvancedPanelButton()})),a.eventManager.afterJobEndEvent((function(){a.toggleLoading(!1),a.mode===s.N.ADVANCED_SEARCH&&a.enableAdvancedPanelButton()})),a.eventManager.afterChangeResultEvent((function(e){a.updateViewAfterResultChange(e.params,e.sheetId,e.ignoreScroll)})),a.eventManager.afterChangeCurrentEvent((function(e){a.updateViewAfterCurrentChange(e.params,e.needCheckCircle)})),a.eventManager.afterFragmentBackEvent((function(e){a.updateViewAfterFragmentSearch(e.params,e.fragList,e.curSheetId)})),a.eventManager.allSheetSearchFinishedEvent((function(){null===e||void 0===e||e.close(),a.showSuccessTip(ne.ZP.t("全部工作表查找结束"))})),a.eventManager.setFormulaViewEvent((function(e){a.setFormulaViewVisible(e.val)})),a.eventManager.startFetchSheetEvent((function(t){var n=t.sheetName;e=a.showFetchSheetLoadingTips(ne.ZP.t("正在获取工作表 「{{sheetName}}」 并启动查找...",{sheetName:n}),e)})),a.eventManager.afterFetchSheetEvent((function(){})),a.eventManager.afterAutoSwitchSheetEvent((function(){a.updateViewAfterCurrentChange({})}))},a.mode=s.N.BASIC_SEARCH,a.searchHighlightRenderPlugin=t.searchHighlightRenderPlugin,a}(0,F.Z)(t,e);var a=t.prototype;return a.toggleLoading=function(e){this.panel.update({isLoading:e})},a.setInvisible=function(){this.panel.update({visible:!1})},a.setVisible=function(){this.panel.update({visible:!0})},a.clearView=function(){this.updateSearchCacheParams({searchValue:"",total:0,current:0,cacheResult:[],panelTipInfo:"",findPrev:!1}),this.resetPanel(),this.removeHighlight()},a.resetPanel=function(){this.panelMessageIndex=void 0,this.panel.update({current:0,total:0,message:"",canSingleReplace:!1,canReplace:!1,canSearch:!0,searchCache:this.searchCacheParams.searchValue,isLoading:!1})},a.updateHighlight=function(e){this.searchHighlightRenderPlugin.refreshSearchHighlight(this.searchCacheParams.cacheResult,e)},a.updateViewAfterResultChange=function(e,t,a){var n,r,s;if(this.updateSearchCacheParams(e),this.updateHighlight(t),this.panel.update({total:this.searchCacheParams.total,current:this.searchCacheParams.current,searchCache:this.searchCacheParams.searchValue}),!(null===(n=this.searchCacheParams.cacheResult)||void 0===n?void 0:n[this.searchCacheParams.current]))return this.hideHighLightBox(),void this.panel.update({message:""});if(this.checkAndUpdatePanel(),(null===(s=null===(r=this.searchCacheParams.cacheResult)||void 0===r?void 0:r[this.searchCacheParams.current])||void 0===s?void 0:s.sheetId)===t){var o=this.searchCacheParams.cacheResult[this.searchCacheParams.current].position,i=o.row,l=o.col;this.focusHighLightBox(i,l,!!a)}else this.hideHighLightBox()},a.removeHighlight=function(){this.searchHighlightRenderPlugin.hideSearch()},a.hideHighLightBox=function(){this.searchHighlightRenderPlugin.hideCurrentHightBox()},a.focusHighLightBox=function(e,t,a){this.searchHighlightRenderPlugin.showCurrentHightBox(t,e),Z(e,t,this.view)||this.isOperatingSheet||a||this.scrollApi.scrollToVisible({col:t,row:e,x:200,y:200})},t}((function(e){var t=this;this.addEventListener=function(){document.addEventListener("mousedown",t.setOperatingOn),document.addEventListener("mouseup",t.setOperatingOff),document.addEventListener("touchstart",t.setOperatingOn),document.addEventListener("touchend",t.setOperatingOff)},this.removeEventListener=function(){document.removeEventListener("mousedown",t.setOperatingOn),document.removeEventListener("mouseup",t.setOperatingOff),document.removeEventListener("touchstart",t.setOperatingOn),document.removeEventListener("touchend",t.setOperatingOff),t.removeSearchEvent()},this.checkCircleRound=function(e){var a=0===t.searchCacheParams.current&&e===t.searchCacheParams.total-1&&!t.searchCacheParams.findPrev,n=t.searchCacheParams.current===t.searchCacheParams.total-1&&0===e&&t.searchCacheParams.findPrev;(a||n)&&me.default.show({message:ne.ZP.t("找不到其他匹配项，已从初始位置开始查找。"),type:"info",duration:1e3,style:{zIndex:10011}})},this.showFetchSheetLoadingTips=function(e,a){var n=me.default;if(a)return a.update({message:e}),a;var r=n.show({autoClose:!1,type:"loading",message:e,closable:!1,style:{zIndex:10011},action:ne.ZP.t("取消"),onClickAction:function(){t.eventManager.cancelSearchEmitter.fire(),null===r||void 0===r||r.close()}});return r},this.showSuccessTip=function(e){me.default.show({message:e,type:"success",duration:1e3,style:{zIndex:10011}})},this.updateSearchCacheParams=function(e){Object.assign(t.searchCacheParams,e)},this.checkHasEditPermission=function(e,a){var n=e.col,r=e.row;return!!le(t.spreadsheet,t.sheetStatus,e)||(t.updatePanelMessage(ne.ZP.t("单元格“{{value}}”没有编辑权限，暂不支持替换",{value:he(n,r)}),{current:a,col:n,row:r}),!1)},this.checkIsUserHide=function(e){var a;if(!(null===(a=t.searchCacheParams.cacheResult)||void 0===a?void 0:a[t.searchCacheParams.current]))return!1;var n=t.searchCacheParams.cacheResult[t.searchCacheParams.current].position,r=n.col,s=n.row,o=t.searchCacheParams.cacheResult[t.searchCacheParams.current].sheetId;if(!p(t.spreadsheet).get(o))return!1;var i=_(r,s,t.spreadsheet);return i&&t.updatePanelMessage(ne.ZP.t("在隐藏的“{{value}}”单元格中找到匹配项；",{value:he(r,s)}),{current:e,col:r,row:s}),i},this.getCanSingleReplace=function(){var e;if(null===(e=t.searchCacheParams.cacheResult)||void 0===e?void 0:e[t.searchCacheParams.current]){var a=t.searchCacheParams.cacheResult[t.searchCacheParams.current].position,n=a.row,r=a.col,s=t.searchCacheParams.cacheResult[t.searchCacheParams.current].sheetId,o=t.searchCacheParams.current,i=t.checkIsUserHide(o),l=t.checkHasEditPermission({sheetId:s,col:r,row:n},t.searchCacheParams.current),c=t.checkIsCellInCustomType(),h=t.checkIsCellOnlyMatchDisplayValue();return l&&!i&&!c&&!h}},this.updatePanelMode=function(e){t.mode=e},this.checkIsCellInCustomType=function(){var e;if(!(null===(e=t.searchCacheParams.cacheResult)||void 0===e?void 0:e[t.searchCacheParams.current]))return!1;var a=t.searchCacheParams.cacheResult[t.searchCacheParams.current].position,n=a.col,r=a.row,s=t.searchCacheParams.cacheResult[t.searchCacheParams.current].sheetId,o=p(t.spreadsheet).get(s);if(!o)return!1;var i=o.getCellDataAtPosition(r,n);return!!i&&!!((0,h.wK)(o,r,n)||P(i)||H(i)||j(i))&&(t.updatePanelMessage(ne.ZP.t("“{{value}}”为固定格式内容，暂不支持替换；",{value:he(n,r)}),{current:t.searchCacheParams.current,col:n,row:r}),!0)},this.updatePanelMessage=function(e,a){t.panelMessageIndex===a?!t.searchCacheParams.panelTipInfo.includes(e)&&(t.searchCacheParams.panelTipInfo+=e):(t.searchCacheParams.panelTipInfo=e,t.panelMessageIndex=a),t.panel.update({message:t.searchCacheParams.panelTipInfo})},this.checkAndUpdatePanel=function(){if(0!==t.searchCacheParams.cacheResult.length){t.panel.update({message:""});var e=t.searchCacheParams.current;if(t.mode===s.N.ADVANCED_SEARCH){var a=t.getCanSingleReplace();t.panel.update({canSingleReplace:a,canReplace:g(t.sheetStatus)&&t.searchCacheParams.total>0})}else t.checkIsUserHide(e)}else t.panel.update({message:""})},this.checkIsCellOnlyMatchDisplayValue=function(){var e;if(!(null===(e=t.searchCacheParams.cacheResult)||void 0===e?void 0:e[t.searchCacheParams.current]))return!1;var a=t.searchCacheParams.cacheResult[t.searchCacheParams.current],n=t.searchCacheParams.cacheResult[t.searchCacheParams.current].position,r=n.col,s=n.row,o=t.searchCacheParams.cacheResult[t.searchCacheParams.current].sheetId,i=p(t.spreadsheet).get(o);if(!i)return!1;var l=i.getCellDataAtPosition(s,r);return!(!l||!a)&&(pe(a,l)?(t.updatePanelMessage(ne.ZP.t("单元格“{{value}}为函数计算值, 不支持替换；",{value:he(r,s)}),{current:t.searchCacheParams.current,col:r,row:s}),!0):!!ue(a,l)&&(t.updatePanelMessage(ne.ZP.t("带格式单元格“{{value}}”仅结果值匹配, 不支持替换；",{value:he(r,s)}),{current:t.searchCacheParams.current,col:r,row:s}),!0))},this.setOperatingOn=function(){t.isOperatingSheet=!0},this.setOperatingOff=function(){t.isOperatingSheet=!1},this.removeSearchEvent=function(){t.eventManager.removeAll()},this.sheetStatus=e.spreadsheetApp.sheetStatus,this.scrollApi=e.scrollApi,this.spreadsheet=e.spreadsheet,this.view=e.spreadsheetApp.view,this.eventManager=e.eventManager,this.searchCacheParams={current:0,total:0,cacheResult:[],panelTipInfo:"",findPrev:!1,searchValue:""}}))),fe=a("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),ge=(a("../node_modules/regenerator-runtime/runtime.js"),a("../node_modules/core-js/modules/es.array.map.js"),a("../node_modules/core-js/modules/es.set.js"),a("../node_modules/core-js/modules/esnext.set.add-all.js"),a("../node_modules/core-js/modules/esnext.set.delete-all.js"),a("../node_modules/core-js/modules/esnext.set.difference.js"),a("../node_modules/core-js/modules/esnext.set.every.js"),a("../node_modules/core-js/modules/esnext.set.filter.js"),a("../node_modules/core-js/modules/esnext.set.find.js"),a("../node_modules/core-js/modules/esnext.set.intersection.js"),a("../node_modules/core-js/modules/esnext.set.is-disjoint-from.js"),a("../node_modules/core-js/modules/esnext.set.is-subset-of.js"),a("../node_modules/core-js/modules/esnext.set.is-superset-of.js"),a("../node_modules/core-js/modules/esnext.set.join.js"),a("../node_modules/core-js/modules/esnext.set.map.js"),a("../node_modules/core-js/modules/esnext.set.reduce.js"),a("../node_modules/core-js/modules/esnext.set.some.js"),a("../node_modules/core-js/modules/esnext.set.symmetric-difference.js"),a("../node_modules/core-js/modules/esnext.set.union.js"),a("../node_modules/core-js/modules/es.object.keys.js"),a("../node_modules/core-js/modules/es.number.constructor.js"),a("../node_modules/@tencent/dui/lib/components/Modal/index.js")),Ce=(a("../node_modules/core-js/modules/es.string.replace.js"),a("../node_modules/core-js/modules/es.regexp.to-string.js"),a("../node_modules/core-js/modules/es.regexp.constructor.js"),function(e,t){return{match:!0,schema:e.split(new RegExp(t))}}),we=function(e,t,a){var n=e.matchValue.find((function(e){return e.key===oe.sM.EDIT_VALUE}));if(!n)return"";var r=[];return null===n||void 0===n||n.schema.reduce((function(e,t,s){var o=e.length,i=e.length+t.length;return r.push(n.value.slice(o,i)),e+(s!==(null===n||void 0===n?void 0:n.schema.length)-1?a:"")+t}),""),r.join(t)},Re=a("../packages/mutation/src/index.ts"),Se=a("../packages/common-utils/src/common/index.ts"),_e=function(e){var t=this;this.addMutationListener=function(e){t.restartSearch=e,t.app.mutationBehavior.emitter.on(t.app.mutationBehavior.EVENT.AFTER_MUTATION_RUN,t.mutationRunCallback)},this.removeMutationListener=function(){t.app.mutationBehavior.emitter.off(t.app.mutationBehavior.EVENT.AFTER_MUTATION_RUN,t.mutationRunCallback)},this.mutationRunCallback=function(e){if(!(void 0===e.mutation.requestId||e.mutation.requestId<0))switch(e.mutation.id){case Re.xF.INSERT_DIMENSION_MUTATION:case Re.xF.DELETE_DIMENSION_MUTATION:case Re.xF.SET_DIMENSION_PROPERTIES_MUTATION:case Re.xF.SET_RANGE_MUTATION:case Re.xF.SET_CELL_PROPERTIES_MUTATION:case Re.xF.UPDATE_FILTERS_MODEL_MUTATION:case Re.xF.ADD_EMBEDDED_OBJECT_MUTATION:case Re.xF.DELETE_EMBEDDED_OBJECT_MUTATION:case Re.xF.UPDATE_EMBEDDED_OBJECT_MUTATION:case Re.xF.INSERT_SHEET_MUTATION:case Re.xF.DELETE_SHEET_MUTATION:case Re.xF.MOVE_SHEET_MUTATION:case Re.xF.SET_SHEET_PROPERTIES_MUTATION:case Re.xF.UPDATE_ALL_SHEETS_MUTATION:case Re.xF.INIT_DATA_MUTATION:case Re.xF.COPY_PASTE_MUTATION:case Re.xF.REORDER_RANGE_MUTATION:case Re.xF.MAP_RANGE_MUTATION:case Re.xF.DEFINE_FILTER_MUTATION:case Re.xF.DELETE_FILTER_MUTATION:case Re.xF.UPDATE_FILTER_MUTATION:case Re.xF.EMPTY_MUTATION:case Re.xF.ADD_CONDITIONAL_FORMAT_MUTATION:case Re.xF.DELETE_CONDITIONAL_FORMAT_MUTATION:case Re.xF.UPDATE_CONDITIONAL_FORMAT_MUTATION:case Re.xF.DEFINE_WORKBOOK_RANGE_MUTATION:case Re.xF.UPDATE_WORKBOOK_RANGE_MUTATION:case Re.xF.DELETE_WORKBOOK_RANGE_MUTATION:case Re.xF.NEW_ADD_EMBEDDED_OBJECT_MUTATION:case Re.xF.NEW_DELETE_EMBEDDED_OBJECT_MUTATION:case Re.xF.NEW_UPDATE_EMBEDDED_OBJECT_MUTATION:case Re.xF.SWITCH_FILTER_SYNC_MUTATION:case Re.xF.ACTIVE_FILTER_VIEW_MUTATION:t.callbackDebounce(t.restartSearch.bind(t,e.sheetId,e.isLocal),e.sheetId);break;case Re.xF.DEFINE_SHEET_RANGE_MUTATION:case Re.xF.DELETE_SHEET_RANGE_MUTATION:case Re.xF.UPDATE_SHEET_RANGE_MUTATION:case Re.xF.SET_WORKBOOK_PROPERTIES_MUTATION:case Re.xF.MERGE_CELLS_MUTATION:case Re.xF.UNMERGE_CELLS_MUTATION:t.callbackDebounce(t.restartSearch.bind(t,e.sheetId,e.isLocal,!0),e.sheetId)}},this.callbackDebounce=function(e,a){var n;if(t.debounceMap.has(a))null===(n=t.debounceMap.get(a))||void 0===n||n();else{var r=(0,Se.Ds)(e,50);r(),t.debounceMap.set(a,r)}},this.app=e.spreadsheetApp,this.debounceMap=new Map},Ee=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))};!function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.PAUSED=2]="PAUSED",e[e.FINISHED=3]="FINISHED",e[e.STOPPED=4]="STOPPED"}(de||(de={}));var xe,ye=function(e,t){var n=this;this.start=function(){return Ee(n,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.status=de.RUNNING,e.prev=1,e.next=4,null===(t=this.startTask)||void 0===t?void 0:t.call(this);case 4:(r=e.sent)&&this.status===de.RUNNING&&(this.status=de.FINISHED),this.status=de.FINISHED,n=r,e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),this.stop(),n=Promise.reject(),a.g.log.error("search task run error");case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this,[[1,10]])})))},this.stop=function(){var e;null===(e=n.stopTask)||void 0===e||e.call(n),n.status=de.STOPPED},this.destroy=function(){n.stop(),n.startTask=void 0,n.status=de.INIT},this.status=de.INIT,this.startTask=e,this.stopTask=t},Ie=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))};!function(e){e[e.IDLE=0]="IDLE",e[e.PAUSED=1]="PAUSED",e[e.RUNNING=2]="RUNNING",e[e.FINISHED=3]="FINISHED"}(xe||(xe={}));var De,Ae=function(){var e=this;this.addTask=function(t,a){e.taskMap.get(t)&&e.taskMap.delete(t),e.taskMap.set(t,a)},this.getTaskStatus=function(t){var a;if(e.taskMap.get(t))return null===(a=e.taskMap.get(t))||void 0===a?void 0:a.status},this.deleteTask=function(t){e.taskMap.get(t)&&e.taskMap.delete(t)},this.startTask=function(t){return Ie(e,void 0,void 0,regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status=xe.RUNNING,a=this.taskMap.get(t)){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,a.start();case 6:return n=e.sent,this.taskMap.delete(t),this.lastFinishedMap.set(t,a),0===this.taskMap.size&&(this.status=xe.FINISHED),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})))},this.stopTask=function(t){var a=e.taskMap.get(t);a&&(e.status=xe.FINISHED,a.status===de.RUNNING&&a.stop(),e.taskMap.delete(t))},this.startAllSync=function(t){return Ie(e,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,s,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.status=xe.RUNNING,a.g.log.info("search-replace: startAllSync全部启动"),n=Array.from(this.taskMap.entries()),r=0;case 4:if(!(r<n.length)){e.next=15;break}if(s=n[r],o=s[0],i=s[1],this.status!==xe.RUNNING){e.next=10;break}return e.next=9,i.start();case 9:a.g.log.info("search-replace: "+o+" 任务结束");case 10:i.stop(),null===t||void 0===t||t();case 12:r++,e.next=4;break;case 15:a.g.log.info("search-replace: startAllSync全部完成"),this.copyTask(this.lastFinishedMap,this.taskMap),this.stopAll(),this.status=xe.FINISHED;case 19:case"end":return e.stop()}}),e,this)})))},this.startAllAsync=function(){return Ie(e,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,s,o,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.status=xe.RUNNING,t=[],n=Array.from(this.taskMap.entries()),r=0;r<n.length;r++)s=n[r],o=s[1],t.push(o.start());return e.next=6,Promise.all(t).then((function(){i.copyTask(i.lastFinishedMap,i.taskMap),i.status=xe.FINISHED,i.stopAll()}),(function(e){a.g.log.log(e)}));case 6:case"end":return e.stop()}}),e,this)})))},this.pauseAll=function(){e.taskMap.forEach((function(e){e.stop()})),e.status=xe.PAUSED},this.resumeAll=function(){e.status=xe.RUNNING,e.taskMap.forEach((function(e){e.start()}))},this.stopAll=function(){e.taskMap.forEach((function(e){e.stop()})),e.taskMap.clear()},this.redoAllLastTaskAsync=function(){return Ie(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAll(),this.copyTask(this.taskMap,this.lastFinishedMap),this.lastFinishedMap.clear(),e.next=5,this.startAllAsync();case 5:case"end":return e.stop()}}),e,this)})))},this.redoAllLastTaskSync=function(){return Ie(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAll(),this.copyTask(this.taskMap,this.lastFinishedMap),this.lastFinishedMap.clear(),e.next=5,this.startAllSync();case 5:case"end":return e.stop()}}),e,this)})))},this.clear=function(){e.taskMap.forEach((function(e){e.stop(),e.destroy()})),e.taskMap.clear(),e.lastFinishedMap.clear()},this.copyTask=function(e,t){t.forEach((function(t,a){e.set(a,t)}))},this.status=xe.IDLE,this.taskMap=new Map,this.lastFinishedMap=new Map},be=a("../packages/report/src/index.ts"),Te=a("../packages/common-utils/src/index.ts"),Me=function(e){be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search_2",action:"search_search_amount_threshold",ver10:"over "+e+"w"})},ke=function(e,t){var a;"1"===(0,Te.IZ)("inToastPreview")&&be.ZP.tdwReport({opername:"doc_preview",module:"pc_qqview",action:"cli_search"}),e===s.N.BASIC_SEARCH?(a=!!t,be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search_2",action:"open_basic"}),be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search",action:"clk_find_replace",ver10:a?"1":"0"})):function(e){be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search",action:"clk_replace_open"}),be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search",action:"clk_find_replace",ver10:e?"1":"0"})}(!!t)},Pe=function(e,t){var a,n,r=((a={})[s.N.BASIC_SEARCH]="0",a[s.N.ADVANCED_SEARCH]="1",a),i=((n={})[o.H.InSheet]="0",n[o.H.AllSheet]="1",n[o.H.Range]="2",n);be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search_2",action:"clk_find",ver10:r[t],ver11:i[e]})},Le=function(e){var t,a=((t={})[s.N.BASIC_SEARCH]="0",t[s.N.ADVANCED_SEARCH]="1",t);be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search",action:"clk_find_next",ver10:a[e]})},Ne=function(){be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search",action:"clk_replace_next"})},je=function(){be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search",action:"clk_replace_replace_all"})},Oe=function(e){be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search_2",action:"context_change_search",ver11:e})},He=function(e,t){be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search_2",action:"single_task_search_restart",ver11:e,ver12:t?"replace_after":"mutation"})},Be=function(e){var t,a=((t={})[o.S.CASE_DIFF]="0",t[o.S.SEARCH_IN_COL]="1",t[o.S.ONLY_FORMULA]="2",t[o.S.ALL_MATCH]="3",t);be.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_search",action:"clk_replace_options",ver10:a[e]})},Ve=a("../spread-sheet/src/core/app/sheetStatus/private-range.ts"),Ze=a("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),Fe=a("../spread-sheet/src/core/data/configService/spreadConfig.ts"),Ue=function(e,t,a,n){return new(a||(a=Promise))((function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}l((n=n.apply(e,t||[])).next())}))};!function(e){e[e.REG=0]="REG",e[e.ALL=1]="ALL",e[e.CASE=2]="CASE",e[e.ANGLE=3]="ANGLE"}(De||(De={}));var ze=function(){function e(t){var n=this;this.current=0,this.total=0,this.hasSearchContextChange=!1,this.findPrev=!1,this.notUserSwitch=!1,this.isSearchTaskAllow=!1,this.restartSearchAndCorrectCurrent=function(e){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.spreadsheet.isExternalSheet()){t.next=4;break}return this.app.view.canvas.searchReplaceCenter.close(),this.eventManager.afterFetchSheetEmitter.fire(),t.abrupt("return");case 4:if(this.cacheValue){t.next=10;break}return this.isSearchTaskAllow=!1,this.resetSearchResult(),this.taskCenter.stopAll(),this.stopAllSearchTimer(),t.abrupt("return");case 10:if(this.isSearchTaskAllow=!0,this.mode!==s.N.ADVANCED_SEARCH||this.regionType!==o.H.Range||this.hexRanges){t.next=14;break}return this.eventManager.needUpdateMessageEmitter.fire({message:ne.ZP.t("区域选择器不能为空；"),index:this.current}),t.abrupt("return");case 14:if(this.hasSearchContextChange||this.mode!==s.N.ADVANCED_SEARCH||e){t.next=19;break}return t.next=17,this.handleNext();case 17:return this.hasSearchContextChange=!1,t.abrupt("return");case 19:return this.hasSearchContextChange=!1,this.resetSearchResult(),a.g.log.info("search-replace: searchJobStart 初始化上次查找结果并开始查找"),this.eventManager.beforeJobStartEventEmitter.fire(),t.next=25,this.searchJobStart();case 25:if(this.eventManager.afterJobEndEmitter.fire(),a.g.log.info("search-replace: searchJobStart 全部结束 下一步校正光标"),!(this.cacheResult.length<=0)){t.next=30;break}return this.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:[],current:0,total:0,searchValue:this.cacheValue},sheetId:this.currentSheetId}),t.abrupt("return");case 30:if(n=this.cacheResult,this.searchDirection===oe.JR.IN_COL&&(n=this.cacheResultInCol),!(r=f(this.view))){t.next=44;break}if(!((i=this.afterCallbackCorrectCurrent(r,n.filter((function(e){return e.sheetId===l.currentSheetId}))))&&i>=0)){t.next=40;break}this.current=i,this.setKeepLocate(n,this.current),t.next=44;break;case 40:return t.next=42,this.checkIndexAndSwitchSheet(this.current,this.cacheResult);case 42:t.sent&&this.setKeepLocate(n,this.current);case 44:return this.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:n,current:this.current,total:n.length,searchValue:this.cacheValue},sheetId:this.currentSheetId}),t.abrupt("return",{cacheResult:n,current:this.current});case 46:case"end":return t.stop()}}),t,this)})))},this.handleMutationChangeSearch=function(e,t,a){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e===this.currentSheetId||this.regionType===o.H.AllSheet){n.next=2;break}return n.abrupt("return");case 2:if(this.cacheValue&&!this.hasSearchContextChange){n.next=4;break}return n.abrupt("return");case 4:if(!a){n.next=7;break}return this.resetRender(),n.abrupt("return");case 7:return n.next=9,this.restartSingleSheetSearchTask(e,t);case 9:case"end":return n.stop()}}),n,this)})))},this.restartSingleSheetSearchTask=function(e,t,a){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function n(){var r,s,o,i,l,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.initSheetTaskBeforeSearch(e),(o=this.sheetDataMap.get(e))&&!(null===o||void 0===o?void 0:o.getDisplayHidden())){n.next=6;break}this.updateSearchResult(e,[]),n.next=9;break;case 6:return n.next=8,this.restartSheetSearchById(e);case 8:He(this.regionType,!!a);case 9:if(i=this.cacheResult,this.searchDirection===oe.JR.IN_COL&&(i=this.cacheResultInCol),l=!1,!a){n.next=21;break}return this.keepLocate&&(c=null===(s=this.sheetDataMap.get((null===(r=this.keepLocate)||void 0===r?void 0:r.sheetId)||""))||void 0===s?void 0:s.getCellDataAtPosition(this.keepLocate.y,this.keepLocate.x),this.searchInCellData(c,{sheetId:e,searchType:this.regionType,searchContext:this.searchContext,searchValue:this.cacheValue,searchCondition:this.searchCondition},{row:this.keepLocate.y,col:this.keepLocate.x})&&(this.current+=1)),this.current>=i.length&&(this.current=0),this.setKeepLocate(i,this.current),n.next=18,this.checkIndexAndSwitchSheet(this.current,i);case 18:l=!!n.sent,n.next=22;break;case 21:this.afterMutationSearchKeepOrCorrectLocation(i,t);case 22:this.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:i,current:this.current,total:i.length,searchValue:this.cacheValue},sheetId:this.currentSheetId,ignoreScroll:!(l||a)});case 23:case"end":return n.stop()}}),n,this)})))},this.resetSearchRegionType=function(e,t){n.hasSearchContextChange=!0,n.regionType=e,n.regionType!==o.H.Range?n.hexRanges="":t&&(n.hexRanges=t)},this.resetSearchConditions=function(e,t){var a=e.caseIgnore,r=e.allMatch,s=e.searchInCol,i=e.onlyFormula;if(void 0===a&&void 0===r&&void 0===i||(n.hasSearchContextChange=!0),n.searchCondition=[],a&&n.searchCondition.push(oe.lg.CASE),r&&n.searchCondition.push(oe.lg.ALL),t===o.S.ONLY_FORMULA&&(n.searchContext=i?oe.Pf.ONLY_FORMULA:oe.Pf.DEFAULT,n.eventManager.setFormulaViewEmitter.fire({val:!!i})),t===o.S.SEARCH_IN_COL){n.searchDirection=s?oe.JR.IN_COL:oe.JR.IN_ROW,s&&(n.cacheResultInCol=n.getSearchResultInCol());var l=s?n.cacheResultInCol:n.cacheResult;n.current=n.getCellCurrentByKeepLocate(l),n.setKeepLocate(l,n.current),l.length>0&&n.eventManager.afterChangeCurrentEmitter.fire({params:{cacheResult:l,current:n.current},needCheckCircle:!1})}},this.handleChangeSearch=function(e,t){return void 0===t&&(t=!0),Ue(n,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t){a.next=7;break}return this.cacheValue=e,a.next=4,this.restartSearchAndCorrectCurrent();case 4:Pe(this.regionType,this.mode),a.next=9;break;case 7:this.hasSearchContextChange=this.cacheValue!==e,this.cacheValue=e;case 9:case"end":return a.stop()}}),a,this)})))},this.handleNext=function(){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.findPrev=!1,!this.hasSearchContextChange||this.mode!==s.N.ADVANCED_SEARCH){e.next=6;break}return e.next=4,this.restartSearchAndCorrectCurrent();case 4:return Oe(this.regionType),e.abrupt("return");case 6:if(0!==this.total){e.next=9;break}return console.warn("没有搜索结果"),e.abrupt("return");case 9:return t=this.cacheResult,this.searchDirection===oe.JR.IN_COL?(t=this.cacheResultInCol,this.current=this.getCellCurrentByKeepLocate(this.cacheResultInCol)):this.current=this.getCellCurrentByKeepLocate(this.cacheResult),a=this.current,this.current+=1,this.current>=this.total&&(this.current=0),this.setKeepLocate(t,this.current),e.next=17,this.checkIndexAndSwitchSheet(this.current,t);case 17:if(e.sent){e.next=27;break}if(n=f(this.view),!this.selectChanged||!t[a]){e.next=24;break}return this.selectChanged=!1,e.next=24,this.afterSelectChangeCorrectionCurrent(t,n,a);case 24:this.eventManager.afterChangeCurrentEmitter.fire({params:{cacheResult:t,current:this.current,total:t.length,searchValue:this.cacheValue,findPrev:!1},needCheckCircle:!0}),e.next=28;break;case 27:this.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:t,current:this.current,total:t.length,searchValue:this.cacheValue,findPrev:!1},sheetId:this.currentSheetId});case 28:Le(this.mode);case 29:case"end":return e.stop()}}),e,this)})))},this.handlePrev=function(){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.findPrev=!0,0!==this.total){e.next=4;break}return console.warn("没有搜索结果"),e.abrupt("return");case 4:return this.searchDirection===oe.JR.IN_COL?(t=this.cacheResultInCol,this.current=this.getCellCurrentByKeepLocate(this.cacheResultInCol)):(t=this.cacheResult,this.current=this.getCellCurrentByKeepLocate(this.cacheResult)),a=this.current,this.current-=1,this.current<0&&(this.current=this.total-1),this.setKeepLocate(t,this.current),e.next=11,this.checkIndexAndSwitchSheet(this.current,t);case 11:if(e.sent){e.next=21;break}if(n=f(this.view),!this.selectChanged){e.next=18;break}return this.selectChanged=!1,e.next=18,this.afterSelectChangeCorrectionCurrent(t,n,a);case 18:this.eventManager.afterChangeCurrentEmitter.fire({params:{cacheResult:t,current:this.current,total:t.length,searchValue:this.cacheValue,findPrev:!0},needCheckCircle:!0}),e.next=22;break;case 21:this.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:t,current:this.current,total:t.length,searchValue:this.cacheValue,findPrev:!0},sheetId:this.currentSheetId});case 22:this.findPrev=!1,Le(this.mode);case 24:case"end":return e.stop()}}),e,this)})))},this.showRangeSelectPanel=function(e){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=M(this.spreadsheet,this.view),t.next=3,this.view.getRangeSelectionPanel();case 3:t.sent.show((function(t){r.sheetDataMap=p(r.spreadsheet),r.currentSheetId=r.spreadsheet.activeSheetId,r.hexRanges=t,r.hasSearchContextChange=!0,e(t)}),(function(t){e(r.hexRanges),null===a.g||void 0===a.g||a.g.log.log(t)}),{defaultValue:n});case 4:case"end":return t.stop()}}),t,this)})))},this.addListener=function(){n.addMutationListener(),n.addSelectListener(),n.addSwitchSheetListener(),n.addSearchEventListener()},this.removeListener=function(){n.removeMutationListener(),n.removeSelectListener(),n.removeSwitchSheetListener(),n.removeSearchEventListener()},this.addMutationListener=function(){n.mutationChangeHandler.addMutationListener(n.handleMutationChangeSearch)},this.removeMutationListener=function(){n.mutationChangeHandler.removeMutationListener()},this.addSelectListener=function(){n.selectDispose=n.normalSelectData.onModifySelectData(n.onSelectionModified)},this.addSwitchSheetListener=function(){n.event.sheetsBar.listen("switchSheetEnd",n.switchSheetCallback)},this.removeSwitchSheetListener=function(){n.event.sheetsBar.remove("switchSheetEnd",n.switchSheetCallback)},this.removeSelectListener=function(){n.selectDispose.dispose()},this.addSearchEventListener=function(){n.eventManager.cancelSearchEvent((function(){n.isSearchTaskAllow=!1,n.hasSearchContextChange=!0}))},this.removeSearchEventListener=function(){var e;null===(e=n.eventManager.cancelSearchEmitter)||void 0===e||e.dispose()},this.getFragmentRegion=function(t){for(var a=[],n=t.endColIndex-t.startColIndex+1,r=Math.floor(e.SEARCH_FRAGMENT/n),s=t.startRowIndex,o=t.startColIndex;s<=t.endRowIndex&&o<=t.endColIndex;){var i=t.endRowIndex<=s+r?t.endRowIndex:s+r;a.push({startX:o,endX:t.endColIndex,startY:s,endY:i}),s+=r+1}return a},this.getSearchRegions=function(e,t){var a=[];if(e.searchType!==o.H.Range||!D(n.spreadsheet,n.view)&&n.mode!==s.N.ADVANCED_SEARCH){var r=t.getRowCount(),i=t.getColCount();a=n.getFragmentRegion({startRowIndex:0,startColIndex:0,endRowIndex:r-1,endColIndex:i-1})}else{var l=n.hexRanges?T(n.currentSheetId,n.hexRanges,n.spreadsheet):n.view.getSelectionWithGridRanges().rangeSelections;if(!l)return a;l.forEach((function(e){a=a.concat(n.getFragmentRegion(e))}))}return a},this.clearInvalidSheetTask=function(){n.taskCenter.taskMap.forEach((function(e,t){var a;n.sheetDataMap.get(t)&&!(null===(a=n.sheetDataMap.get(t))||void 0===a?void 0:a.getDisplayHidden())||n.taskCenter.deleteTask(t)}))},this.afterMutationSearchKeepOrCorrectLocation=function(e,t){var a=n.getCellCurrentByKeepLocate(e);if(a>=0)n.current=a;else if(n.current<0||n.current>=e.length||t){var r=f(n.view);if(r){var s=e.filter((function(e){return e.sheetId===n.currentSheetId})),o=n.afterCallbackCorrectCurrent(r,s);void 0!==o&&o>=0&&(n.current=o)}}n.setKeepLocate(e,n.current)},this.restartSheetSearchById=function(e){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new ye(this.startSearchTask.bind(this,{sheetId:e,searchType:this.regionType,searchContext:this.searchContext,searchValue:this.cacheValue,searchCondition:this.searchCondition,searchDirection:this.searchDirection},this.searchCallback.bind(this,!1)),this.stopFragmentSearchTimer.bind(this,e)),this.taskCenter.taskMap.get(e)&&this.taskCenter.stopTask(e),this.taskCenter.addTask(e,n),t.prev=3,a.g.log.info("search-replace: 子表 "+e+" 单任务触发"),t.next=7,this.taskCenter.startTask(e);case 7:a.g.log.info("search-replace: 子表 "+e+" 单任务结束"),t.next=15;break;case 10:return t.prev=10,t.t0=t.catch(3),a.g.log.log(t.t0),t.next=15,this.taskCenter.stopTask(e);case 15:case"end":return t.stop()}}),t,this,[[3,10]])})))},this.searchJobStart=function(){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.spreadsheet.activeSheetId,this.currentSheetId=t,this.sheetDataMap=p(this.spreadsheet),this.taskCenter.clear(),a.g.log.info("search-replace: 开启全部任务"),e.prev=5,this.regionType===o.H.AllSheet){e.next=13;break}return n=new ye(this.startSearchTask.bind(this,{sheetId:this.currentSheetId,searchType:this.regionType||o.H.InSheet,searchContext:this.searchContext,searchValue:this.cacheValue,searchCondition:this.searchCondition,searchDirection:this.searchDirection},this.searchCallback.bind(this,!0)),this.stopFragmentSearchTimer.bind(this,this.currentSheetId)),this.taskCenter.addTask(this.currentSheetId,n),e.next=11,this.taskCenter.startTask(this.currentSheetId);case 11:e.next=17;break;case 13:return e.next=15,this.runAllSheetTask();case 15:(r=e.sent)&&(null===r||void 0===r?void 0:r.length)>0?a.g.log.info("search-replace: 查找结果超出40W, "+r.join(", ")+" 等子表的查找被用户忽略"):this.isSearchTaskAllow&&this.eventManager.allSheetSearchFinishedEmitter.fire({});case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(5),this.taskCenter.stopAll(),a.g.log.info("search-replace: 异常中止",e.t0);case 23:a.g.log.info("search-replace: 结束全部任务"),this.resultKeyCache.clear();case 25:case"end":return e.stop()}}),e,this,[[5,19]])})))},this.runAllSheetTask=function(){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,s,o,i,l,c,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!1,r=[],s=Array.from(this.sheetDataMap.entries()),o=0;case 4:if(!(o<s.length)){t.next=30;break}if(i=s[o],l=i[0],c=new ye(this.startSearchTask.bind(this,{sheetId:l,searchType:this.regionType,searchContext:this.searchContext,searchValue:this.cacheValue,searchCondition:this.searchCondition,searchDirection:this.searchDirection},this.searchCallback.bind(this,!0)),this.stopFragmentSearchTimer.bind(this,l)),!(this.getSearchResultAmount()>=e.MAX_SEARCH_CELL_NUMBER.MIDDLE)||n){t.next=16;break}return t.next=11,this.showContinueSearchConfirm().then((function(e){return e}));case 11:if(h=t.sent,n=!!h){t.next=16;break}return r.push(l),t.abrupt("continue",27);case 16:if(this.taskCenter.taskMap.get(l)&&this.taskCenter.stopTask(l),this.taskCenter.addTask(l,c),this.isSearchTaskAllow){t.next=23;break}return a.g.log.debug("search-replace: searchPanelShow为false, 停止任务 "+l),this.taskCenter.stopTask(l),this.resetSearch(),t.abrupt("return");case 23:return a.g.log.info("search-replace: 子表 "+l+" 查找任务【开始】"),t.next=26,this.taskCenter.startTask(l);case 26:a.g.log.info("search-replace: 子表 "+l+" 查找任务【结束】");case 27:o++,t.next=4;break;case 30:return t.abrupt("return",r);case 32:case"end":return t.stop()}}),t,this)})))},this.searchCallback=function(e,t,a,r){if(n.updateSearchResult(r,t),n.total=n.cacheResult.length,0!==t.length){var s=f(n.view),o=n.isCellInRegion(a,s);if(s&&e&&o&&t.length>0&&(null===t||void 0===t?void 0:t[0].sheetId)===n.currentSheetId){var i=n.afterCallbackCorrectCurrent(s,n.cacheResult.filter((function(e){return e.sheetId===n.currentSheetId})));void 0!==i&&i>=0&&(n.current=i,n.setKeepLocate(n.cacheResult,n.current))}n.eventManager.afterFragmentBackEmitter.fire({params:{cacheResult:n.cacheResult,current:n.current,total:n.total},fragList:t,curSheetId:n.currentSheetId})}},this.showContinueSearchConfirm=function(){return new Promise((function(e,t){var a=ge.default.confirm({destroyOnClose:!0,mask:!0,maskStyle:{backgroundColor:"rgba(0, 0, 0, 0.4)"},style:{},title:ne.ZP.t("提示"),content:ne.ZP.t("已达到查找40w单元格上限，继续查找将等待时间，是否继续？"),onOk:function(){e(!0)},onCancel:function(){t(),a()}}).close}))},this.onSelectionModified=function(){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.selectChanged=!0;case 1:case"end":return e.stop()}}),e,this)})))},this.checkIndexAndSwitchSheet=function(e,t){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===t||void 0===t?void 0:t[e]){n.next=2;break}return n.abrupt("return",!1);case 2:if(t[e].sheetId!==this.currentSheetId){n.next=4;break}return n.abrupt("return",!1);case 4:return this.notUserSwitch=!0,this.currentSheetId=t[e].sheetId,n.prev=6,n.next=9,B(this.event,t[e].sheetId);case 9:n.sent&&this.eventManager.afterAutoSwitchSheetEmitter.fire({val:!1}),n.next=17;break;case 13:return n.prev=13,n.t0=n.catch(6),a.g.log.log("search-replace: checkIndexAndSwitchSheet 切表失败"),n.abrupt("return",!1);case 17:return this.selectChanged=!1,this.notUserSwitch=!1,n.abrupt("return",!0);case 20:case"end":return n.stop()}}),n,this,[[6,13]])})))},this.afterCallbackCorrectCurrent=function(e,t){if(t&&!(t.length<0)){var a=v(e,t);if(a>=0)return a;var r=-1;return(r=n.searchDirection===oe.JR.IN_COL?n.findPrev?S(e,t):R(e,t):n.findPrev?w(e,t):C(e,t))<0?n.findPrev?0:t.length-1:r}},this.afterSelectChangeCorrectionCurrent=function(e,t,a){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function n(){var r,s,o,i,l,c,h,d,u,p,m,v,f,g,_=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t&&0!==e.length){n.next=2;break}return n.abrupt("return");case 2:if(l=e[this.current],c=l.sheetId,h=l.position,t.rowIndex!==h.row||t.colIndex!==h.col||this.currentSheetId!==c){n.next=5;break}return n.abrupt("return");case 5:if(d={row:t.rowIndex,col:t.rowIndex},u={row:null===(r=e[a])||void 0===r?void 0:r.position.row,col:null===(s=e[a])||void 0===s?void 0:s.position.col},p={row:null===(o=e[this.current])||void 0===o?void 0:o.position.row,col:null===(i=e[this.current])||void 0===i?void 0:i.position.col},!this.isActiveCellBetweenCurrentAndNext(u,d,p)){n.next=10;break}return n.abrupt("return");case 10:if(m=e.filter((function(e){return e.sheetId===_.currentSheetId})),v=-1,!((v=this.searchDirection===oe.JR.IN_COL?this.findPrev?S(t,m):R(t,m):this.findPrev?w(t,m):C(t,m))<0)){n.next=22;break}if(!((f=this.getSwitchSheetCell(e))>=0)){n.next=20;break}return this.current=f,n.next=19,this.checkIndexAndSwitchSheet(f,e);case 19:this.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:e,current:this.current,total:e.length,searchValue:this.cacheValue},sheetId:this.currentSheetId});case 20:n.next=24;break;case 22:(g=e.findIndex((function(e){return e===m[v]})))>=0&&(this.current=g);case 24:this.setKeepLocate(e,this.current);case 25:case"end":return n.stop()}}),n,this)})))},this.getAfterSwitchSheetCorrectCellIndex=function(e,t){if(0===n.cacheResult.length)return-1;var a=e.filter((function(e){return e.sheetId===n.currentSheetId})),r=C(t,a),s=w(t,a),o=r>=0?r:s;return o>=0?n.cacheResult.findIndex((function(e){return e===a[o]})):-1},this.setKeepLocate=function(e,t){e[t]&&(n.keepLocate={sheetId:e[t].sheetId,x:e[t].position.col,y:e[t].position.row})},this.getCellCurrentByKeepLocate=function(e){return 0===n.cacheResult.length||void 0===n.keepLocate?n.current:e.findIndex((function(e){var t,a,r;return e.position.col===(null===(t=n.keepLocate)||void 0===t?void 0:t.x)&&e.position.row===(null===(a=n.keepLocate)||void 0===a?void 0:a.y)&&e.sheetId===(null===(r=n.keepLocate)||void 0===r?void 0:r.sheetId)}))},this.updateSearchResult=function(e,t){n.cacheResultMap=new Map(Array.from(n.sheetDataMap).map((function(e){var t=e[0];return[t,n.cacheResultMap.get(t)||[]]})));var a=n.cacheResultMap.get(e);a&&n.cacheResultMap.set(e,[].concat((0,fe.Z)(a),(0,fe.Z)(t))),n.cacheResult.length=0,n.cacheResultMap.forEach((function(e){n.cacheResult=n.cacheResult.concat(e)})),n.total=n.cacheResult.length,n.searchDirection===oe.JR.IN_COL&&(n.cacheResultInCol=n.getSearchResultInCol())},this.initSheetTaskBeforeSearch=function(e){var t;n.currentSheetId=n.spreadsheet.activeSheetId,n.taskCenter.status===xe.RUNNING&&n.taskCenter.getTaskStatus(e)===de.RUNNING&&n.taskCenter.stopTask(e);var a=Array.from(n.sheetDataMap.values())[0].getDisplayHidden()?n.currentSheetId:null===(t=Array.from(n.sheetDataMap.keys()))||void 0===t?void 0:t[0];n.sheetDataMap=p(n.spreadsheet,a),n.searchTimer.get(e)&&n.taskCenter.stopTask(e),n.cacheResultMap.set(e,[])},this.resetRender=function(){var e=n.cacheResult;n.searchDirection===oe.JR.IN_COL&&(e=n.cacheResultInCol),n.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:e,current:n.current,total:e.length,searchValue:n.cacheValue},sheetId:n.currentSheetId,ignoreScroll:!0})},this.isCellInRegion=function(e,t){return e.endY>=t.rowIndex&&e.startY<=t.rowIndex&&e.startX<=t.colIndex&&e.endX>=t.colIndex},this.getSearchResultInCol=function(){var e=[];return n.cacheResultMap.forEach((function(t){var a=V(t);e=e.concat(a)})),e},this.isActiveCellBetweenCurrentAndNext=function(e,t,a){return n.searchDirection===oe.JR.IN_ROW&&!E(e,t)&&!I(a,t)||n.searchDirection===oe.JR.IN_COL&&!x(e,t)&&!y(a,t)},this.getSearchResultAmount=function(){return Array.from(n.cacheResultMap.values()).reduce((function(e,t){return e+t.length}),0)},this.switchSheetCallback=function(){if(n.app.spreadsheet.isExternalSheet())n.app.view.canvas.searchReplaceCenter.close();else if(!n.notUserSwitch){var e=n.spreadsheet.getActiveSheetId();if(n.mode===s.N.BASIC_SEARCH)return n.resetSearchResult(),n.restartSearchAndCorrectCurrent(),void Oe(n.regionType);var t=n.cacheResult;if(n.searchDirection===oe.JR.IN_COL&&(t=n.cacheResultInCol),n.regionType!==o.H.AllSheet&&e!==n.currentSheetId)return n.currentSheetId=e,n.hasSearchContextChange=!0,void n.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:t,current:n.current,total:t.length,searchValue:n.cacheValue},sheetId:n.currentSheetId});n.currentSheetId=e;var a=f(n.view),r=n.getAfterSwitchSheetCorrectCellIndex(t,a);r>=0&&(n.current=r,n.setKeepLocate(t,n.current)),n.eventManager.afterChangeResultEmitter.fire({params:{cacheResult:t,current:n.current,total:t.length,searchValue:n.cacheValue},sheetId:n.currentSheetId})}},this.spreadsheet=t.spreadsheetApp.spreadsheet,this.view=t.spreadsheetApp.view,this.event=t.spreadsheetApp.event,this.dataCenter=t.spreadsheetApp.dataCenter,this.app=t.spreadsheetApp,this.eventManager=t.eventManager,this.regionType=o.H.InSheet,this.mutationChangeHandler=new _e(t),this.normalSelectData=t.normalSelectData,this.cacheResult=[],this.cacheResultInCol=[],this.cacheResultMap=new Map,this.resultKeyCache=new Map,this.cacheValue="",this.searchTimer=new Map,this.taskCenter=new Ae,this.searchCondition=[],this.searchDirection=oe.JR.IN_ROW,this.searchContext=oe.Pf.DEFAULT,this.mode=s.N.BASIC_SEARCH}var t=e.prototype;return t.resetSearch=function(){this.keepLocate=void 0,this.cacheValue="",this.resetSearchResult(),this.taskCenter.clear(),this.initConditions()},t.initSearch=function(e){this.isSearchTaskAllow=!0,this.initConditions(),void 0!==e&&(this.mode=e)},t.close=function(){this.resetSearch(),a.g.log.debug("search-replace: 关闭窗口"),this.isSearchTaskAllow=!1,this.resultKeyCache.clear()},t.resetSearchResult=function(){this.current=0,this.total=0,this.cacheResult.length=0,this.cacheResultMap.clear(),this.cacheResultInCol.length=0,this.keepLocate=void 0,this.eventManager.needClearViewEmitter.fire()},t.startSearchTask=function(e,t){var n=this;return new Promise((function(r,s){return Ue(n,void 0,void 0,regeneratorRuntime.mark((function n(){var i,l,c=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.sheetId){n.next=3;break}return r(!1),n.abrupt("return");case 3:if(this.clearInvalidSheetTask(),!(null===(i=this.sheetDataMap.get(e.sheetId))||void 0===i?void 0:i.isLoaded)){n.next=10;break}a.g.log.info("search-replace: 子表 "+e.sheetId+" 已加载 直接查找"),this.startFragmentSearch(e,i,t,r),n.next=30;break;case 10:if(n.prev=10,l=null===i||void 0===i?void 0:i.getName(),this.regionType===o.H.AllSheet&&this.eventManager.startFetchSheetEmitter.fire({sheetName:l||""}),this.isSearchTaskAllow){n.next=19;break}return a.g.log.debug("search-replace: searchPanelShow 为 false, 不拉取 "+e.sheetId+" 子表, 直接返回"),this.taskCenter.stopAll(),this.resetSearch(),s(),n.abrupt("return");case 19:return n.next=21,m(e.sheetId,this.dataCenter,this.spreadsheet).then((function(n){c.eventManager.afterFetchSheetEmitter.fire();var o=c.sheetDataMap.get(e.sheetId);(null===o||void 0===o?void 0:o.isLoaded)&&n?(a.g.log.info("search-replace: fetchSheetData子表 "+e.sheetId+" 结束"),c.startFragmentSearch(e,o,t,r)):s()})).catch((function(){c.eventManager.afterFetchSheetEmitter.fire(),a.g.log.info("search-replace: fetchSheetData子表 "+e.sheetId+" 失败"),s()}));case 21:if(this.view.rangeAuth.isOwner){n.next=24;break}return n.next=24,this.view.rangeAuth.initCooperationRangeAuth(e.sheetId);case 24:n.next=30;break;case 26:n.prev=26,n.t0=n.catch(10),this.eventManager.afterFetchSheetEmitter.fire(),s();case 30:case"end":return n.stop()}}),n,this,[[10,26]])})))}))},t.startFragmentSearch=function(t,n,r,s){var o=this;this.resultKeyCache.delete(t.sheetId),this.stopFragmentSearchTimer(t.sheetId);var i=this.getSearchRegions(t,n),l=0,c=setInterval((function(){if(o.isSearchTaskAllow||(a.g.log.debug("search-replace: 窗口关闭了 stopAllSearchTimer"),o.taskCenter.stopTask(t.sheetId),o.stopAllSearchTimer(),o.resetSearch(),null===s||void 0===s||s(!1)),l>=i.length)o.taskCenter.stopTask(t.sheetId),null===s||void 0===s||s(!0),a.g.log.info("search-replace: 子表 "+t.sheetId+" 查找任务结束 resolve"),o.resultKeyCache.delete(t.sheetId);else{var c=o.getSearchResultAmount();c>=e.MAX_SEARCH_CELL_NUMBER.LOW&&(a.g.log.info("search-replace: 当前已查找到的单个格 "+c+" 个"),c>=e.MAX_SEARCH_CELL_NUMBER.MIDDLE?Me("40"):c>=e.MAX_SEARCH_CELL_NUMBER.HIGH?Me("100"):Me("20")),o.searchInDataRegion(n,t,i[l],r),l+=1}}),40);a.g.log.info("search-replace: 子表 "+t.sheetId+" 分片查找开始"),this.searchTimer.set(t.sheetId,c)},t.searchInDataRegion=function(e,t,a,n){for(var r,s,o=[],i={isOwner:Fe.q.getConfig("isOwner"),ownerId:Fe.q.getConfig("ownerId"),tinyid:Fe.q.getConfig("tinyid")},l=a.startY;l<=a.endY;l++)if(!e.data.isRowHiddenByFilter(l))for(var c=a.startX;c<=a.endX;c++){var h=e.getCellDataAtPosition(l,c);if(!(0,Ve.xy)(this.spreadsheet,l,c,e,i)&&!(0,Ze.tE)(this.app,l,c,e.getSheetId())&&h){var d=this.searchInCellData(h,t,{row:l,col:c});this.resultKeyCache.get(t.sheetId)||this.resultKeyCache.set(t.sheetId,new Set),d&&!(null===(r=this.resultKeyCache.get(t.sheetId))||void 0===r?void 0:r.has(c+"_"+l))&&(null===(s=this.resultKeyCache.get(t.sheetId))||void 0===s||s.add(c+"_"+l),o.push(d))}}null===n||void 0===n||n(o,a,t.sheetId)},t.stopFragmentSearchTimer=function(e){var t=this.searchTimer.get(e);a.g.log.debug(this.searchTimer),t&&(a.g.log.debug("search-replace: 清除任务 "+e+" 计时器"),clearInterval(t),this.searchTimer.delete(e))},t.stopAllSearchTimer=function(){var e=this;this.searchTimer.forEach((function(t,n){a.g.log.debug("search-replace: 清除任务 "+n+" 计时器"),clearInterval(t),e.searchTimer.delete(n)}))},t.searchInCellData=function(e,t,a){var n=this.findCellDataProperties(e,t.searchContext);if(!n)return null;var r=[],s=[];return Object.keys(n).forEach((function(e){var a=Number(e),o=function(e,t,a){if(!a||!t)return{match:!1,schema:[]};if(/^\d*\.\d+$/.test(t)&&(t=t.toString().replace(/0*$/,"")),e.includes(oe.lg.REG))return Ce(t,a);var n=t.toString().replace("","").toLowerCase().indexOf(a.toLowerCase())>-1,r=t.toString().replace("","").toLowerCase().split(a.toLowerCase()),s=e.includes(oe.lg.CASE),o=e.includes(oe.lg.ALL);return s&&!o&&(n=t.toString().replace("","").indexOf(a)>-1,r=t.toString().replace("","").split(a)),o&&(n=n&&t.toString().toLowerCase().replace("","")===a.toLowerCase(),r=t.toString().replace("","").toLowerCase().split(a.toLowerCase())),s&&o&&(n=t.toString().replace("","")===a,r=t.toString().replace("","").split(a)),e.includes(oe.lg.ANGLE),{match:n,schema:r}}(t.searchCondition,n[a],t.searchValue),i=o.match,l=o.schema;i&&(r.push(Number(e)),s.push({key:Number(e),value:n[a]||"",schema:l}))})),r.length?{sheetId:t.sheetId,position:a,matchType:r,matchValue:s}:null},t.findCellDataProperties=function(e,t){var a,n,r,s,o,i,l=t===oe.Pf.ONLY_FORMULA;return k(e)&&!l?{}:L(e)&&!l?((s={})[oe.sM.EDIT_VALUE]=e.getEditValue(),s[oe.sM.FORMATTED_VALUE]=null===(n=e.getFormattedValue())||void 0===n?void 0:n.value,s):N(e)?l?((o={})[oe.sM.EDIT_VALUE]=e.getEditValue(),o):((i={})[oe.sM.EDIT_VALUE]=e.getEditValue(),i[oe.sM.EFFECTIVE_VALUE]=null===(r=e.getFormattedValue())||void 0===r?void 0:r.value,i):l?{}:((a={})[oe.sM.EDIT_VALUE]=e.getEditValue(),a)},t.initConditions=function(){this.searchContext===oe.Pf.ONLY_FORMULA&&this.eventManager.setFormulaViewEmitter.fire({val:!1}),this.searchCondition=[],this.searchContext=oe.Pf.DEFAULT,this.searchDirection=oe.JR.IN_ROW},t.getSwitchSheetCell=function(e){var t=this;return this.findPrev?e.findIndex((function(a,n){return a.sheetId!==t.currentSheetId&&e[n+1].sheetId===t.currentSheetId})):e.findIndex((function(a,n){return a.sheetId!==t.currentSheetId&&e[n-1].sheetId===t.currentSheetId}))},e}();ze.SEARCH_FRAGMENT=8192,ze.MAX_SEARCH_CELL_NUMBER={LOW:2e5,MIDDLE:4e5,HIGH:1e6},a("../node_modules/@tencent/dui-mobile/lib/components/Modal/index.js");var We=function(){function e(t){var a=this;this.handleReplace=function(e,t){var n;a.sheetDataMap=p(a.spreadsheet);var r=a.searchController.current;if(!(r<0)){var s=(a.searchController.searchDirection===oe.JR.IN_COL?a.searchController.cacheResultInCol:a.searchController.cacheResult)[r],o=s.position,i=s.sheetId,l=o.row,c=o.col;if(le(a.spreadsheet,a.sheetStatus,{sheetId:i,col:c,row:l})&&(null===(n=a.sheetDataMap.get(i))||void 0===n?void 0:n.getCellDataAtPosition(l,c))){var h=u(i,a.spreadsheet,{col:c,row:l},{col:c,row:l});if(h){var d={sheetId:i,gridRange:h,celldata:[{sheetId:i,value:we(s,t,e),x:c,y:l,matchValue:s.matchValue,replace:t,search:e}]};a.searchController.removeMutationListener(),a.sendReplaceRequest([d]),a.searchController.addMutationListener(),a.searchController.restartSingleSheetSearchTask(i,!0,!0),Ne()}}}},this.handleReplaceAll=function(e,t){a.sheetDataMap=p(a.spreadsheet);var n=a.getReplaceCount(),r="";if(n.replaceNum>0){var s=a.getRegionTypeName().toLowerCase();r+=ne.ZP.t("确定将此{{regionStr}}内的 {{value1}} 处 “{{search}}” 全部替换为 “{{value3}}” 吗?\n\n",{regionStr:s,value1:n.replaceNum,search:e,value3:""===t?"空":t})}var o=a.searchController.searchDirection===oe.JR.IN_COL?a.searchController.cacheResultInCol:a.searchController.cacheResult,i=n.replaceNum<o.length&&n.replaceNum>0,l=i?ne.ZP.t("（注："):"";l=n.hasRangePermission>0?ne.ZP.t("{{appendText}}查找结果中 {{value1}}处被设置了范围保护，无法被替换。",{appendText:l,value1:n.hasRangePermission}):l,l=n.resultOnlyNum>0?ne.ZP.t("{{appendText}}查找结果中 {{value1}} 处是结果值或不可替换类型，无法被替换。",{appendText:l,value1:n.resultOnlyNum}):l,l=n.hasMetaDataNum>0?ne.ZP.t("{{appendText}}查找结果中有 {{value1}} 项为数据验证内容，暂不支持替换。",{appendText:l,value1:n.hasMetaDataNum}):l,l=n.validValueOnly>0?ne.ZP.t("{{appendText}}查找结果中有 {{value1}} 项设置了数据验证，不允许替换。",{appendText:l,value1:n.validValueOnly}):l,r+=l=i?l+"）":l;var c=ge.default.confirm({destroyOnClose:!0,mask:!0,maskStyle:{backgroundColor:"rgba(0, 0, 0, 0.4)"},style:{},title:ne.ZP.t("提示"),okText:ne.ZP.t("确定"),cancelText:ne.ZP.t("取消"),content:r,okDisabled:n.replaceNum<=0,onOk:function(){n.replaceNum>0&&a.replaceAllAsync(e,t),c()}}).close},this.replaceAllAsync=function(e,t){var n=me.default,r=n.show({autoClose:!1,type:"info",message:ne.ZP.t("正在执行全部替换，请稍候...99%"),style:{zIndex:10011}});setTimeout((function(){a.checkAndReplaceAll(e,t)&&a.searchController.restartSearchAndCorrectCurrent(!0),null===r||void 0===r||r.close(),n.show({type:"success",message:ne.ZP.t("全部替换完成"),style:{zIndex:10011}}),je()}),100)},this.sendReplaceRequest=function(e){a.requestApi.replace(e)},this.checkAndReplaceAll=function(t,n){var r,s,o=[],i=[],l=0,c=a.searchController.searchDirection===oe.JR.IN_COL?a.searchController.cacheResultInCol:a.searchController.cacheResult;if(c.forEach((function(r,s){var h=i.reduce((function(e,t,a){return a<l?e+t.length:e}),0),d=r.sheetId,u=r.position,p=u.row,m=u.col,v=a.sheetDataMap.get(d);(s>=h+e.MAX_FRAGMENT||s>0&&d!==c[s-1].sheetId)&&(l+=1),i[l]||(i[l]=[]);var f=null===v||void 0===v?void 0:v.getCellDataAtPosition(p,m);if(f&&le(a.spreadsheet,a.sheetStatus,{sheetId:d,col:m,row:p})&&(!v||!ce(v,p,m))){var g=we(r,n,t);if(a.isCellReplaceable(f,r)){var C={value:g,x:r.position.col,y:r.position.row,sheetId:r.sheetId,matchValue:r.matchValue,replace:n,search:t};i[l].push(C),o.push(r)}}})),r=a.spreadsheet,s=a.sheetStatus,-1!==o.findIndex((function(e){var t=e.position,a=t.col,n=t.row;return!le(r,s,{sheetId:e.sheetId,col:a,row:n})})))return a.showPermissionBar(),!1;var h=[];return i.forEach((function(e){var t,n=null===(t=e[0])||void 0===t?void 0:t.sheetId;if(n){var r=d(n,a.spreadsheet);r&&h.push({sheetId:n,gridRange:r,celldata:e})}})),a.searchController.removeMutationListener(),a.sendReplaceRequest(h),a.searchController.addMutationListener(),!0},this.showPermissionBar=function(){var e={zIndex:10005};me.default.show({type:"info",autoClose:!0,duration:5e3,style:e,className:"",message:ne.ZP.t("查找替换的内容已被保护。请修改查找替换的范围，或联系创建者「{{value}}」授予权限。",{value:Fe.q.getConfig("ownerNick")})})},this.getReplaceCount=function(){var e={resultOnlyNum:0,hasMetaDataNum:0,hasRangePermission:0,replaceNum:0,validValueOnly:0};return(a.searchController.searchDirection===oe.JR.IN_COL?a.searchController.cacheResultInCol:a.searchController.cacheResult).forEach((function(t){var n=t.position,r=n.row,s=n.col,o=t.sheetId,i=a.sheetDataMap.get(t.sheetId),l=null===i||void 0===i?void 0:i.getCellDataAtPosition(r,s);if(l&&i){var c=le(a.spreadsheet,a.sheetStatus,{sheetId:o,col:s,row:r});c||(e.hasRangePermission+=1);var d=a.isCellReplaceable(l,t);d||(e.resultOnlyNum+=1);var u=(0,h.wK)(i,t.position.row,t.position.col)||P(l);u&&(e.hasMetaDataNum+=1);var p=ce(i,r,s);p&&(e.validValueOnly+=1),c&&d&&!u&&!p&&(e.replaceNum+=1)}})),e},this.spreadsheet=t.spreadsheet,this.sheetStatus=t.spreadsheetApp.sheetStatus,this.searchController=t.searchController,this.requestApi=t.spreadsheetApp.requestApi}var t=e.prototype;return t.isCellReplaceable=function(e,t){return!!e&&!k(e)&&!P(e)&&!H(e)&&!j(e)&&!ue(t,e)&&!pe(t,e)},t.getRegionTypeName=function(){switch(this.searchController.regionType){case o.H.InSheet:return ne.ZP.t("工作表");case o.H.Range:return ne.ZP.t("范围");case o.H.AllSheet:return ne.ZP.t("表格")}},e}();We.MAX_FRAGMENT=65536;var Ge=a("../packages/lib/Keyboard.ts"),Ye=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),Ke=a.n(Ye),Xe=a("../spread-sheet/src/core/view/level-1/input-manager/utils.ts"),Je=function(e){var t=this;this.showSearch=function(){return t.app.spreadsheet.isExternalSheet()||t.propsShow(s.N.BASIC_SEARCH),!1},this.showReplace=function(){return t.app.spreadsheet.isExternalSheet()||t.propsShow(s.N.ADVANCED_SEARCH),!1},this.handleEsc=function(){t.propsClose()},this.app=e.app,this.propsShow=function(t){e.show(t,!0)},this.propsClose=e.close,new Ge.ZP({root:document.body,bindings:[{key:"f",shortKey:!0,handler:this.showSearch},{key:"h",shiftKey:Ke().isMac||Ke().isIPad,shortKey:!0,handler:this.showReplace},{key:Xe.nx.ESCAPE,shiftKey:!1,shortKey:!1,handler:this.handleEsc}],shouldDisable:this.app.spreadsheet.isExternalSheet})},qe=a("../spread-sheet/src/base/event/eventName.ts"),$e=a("../packages/lib/index.ts"),Qe=function(){var e=this;this.removeAll=function(){e.emitterList.forEach((function(e){e.dispose()}))},this.beforeJobStartEventEmitter=new $e.Q5,this.afterJobEndEmitter=new $e.Q5,this.startFetchSheetEmitter=new $e.Q5,this.afterFetchSheetEmitter=new $e.Q5,this.setFormulaViewEmitter=new $e.Q5,this.afterChangeResultEmitter=new $e.Q5,this.afterChangeCurrentEmitter=new $e.Q5,this.afterFragmentBackEmitter=new $e.Q5,this.needClearViewEmitter=new $e.Q5,this.needUpdateMessageEmitter=new $e.Q5,this.allSheetSearchFinishedEmitter=new $e.Q5,this.afterAutoSwitchSheetEmitter=new $e.Q5,this.cancelSearchEmitter=new $e.Q5,this.emitterList=[this.beforeJobStartEventEmitter,this.afterJobEndEmitter,this.startFetchSheetEmitter,this.afterFetchSheetEmitter,this.setFormulaViewEmitter,this.afterChangeResultEmitter,this.afterChangeCurrentEmitter,this.afterFragmentBackEmitter,this.needClearViewEmitter,this.needUpdateMessageEmitter,this.allSheetSearchFinishedEmitter,this.afterAutoSwitchSheetEmitter,this.cancelSearchEmitter],this.beforeJobStartEvent=this.beforeJobStartEventEmitter.event,this.afterJobEndEvent=this.afterJobEndEmitter.event,this.startFetchSheetEvent=this.startFetchSheetEmitter.event,this.afterFetchSheetEvent=this.afterFetchSheetEmitter.event,this.setFormulaViewEvent=this.setFormulaViewEmitter.event,this.afterChangeResultEvent=this.afterChangeResultEmitter.event,this.afterChangeCurrentEvent=this.afterChangeCurrentEmitter.event,this.afterFragmentBackEvent=this.afterFragmentBackEmitter.event,this.needClearViewEvent=this.needClearViewEmitter.event,this.needUpdateMessageEvent=this.needUpdateMessageEmitter.event,this.allSheetSearchFinishedEvent=this.allSheetSearchFinishedEmitter.event,this.afterAutoSwitchSheetEvent=this.afterAutoSwitchSheetEmitter.event,this.cancelSearchEvent=this.cancelSearchEmitter.event},et=function(){function e(e){var t=this;this.cacheValue="",this.showValue=!1,this.show=function(e,a){var n;if(void 0===e&&(e=s.N.BASIC_SEARCH),!(null===(n=t.app.history)||void 0===n?void 0:n.showing)){var i=g(t.app.sheetStatus),l=s.N.BASIC_SEARCH;e===s.N.ADVANCED_SEARCH&&(l=s.N.ADVANCED_SEARCH);var c={mode:l,canReplace:i,canSearch:!0,isKeyboardOpen:!!a,searchCache:t.cacheValue,regionType:o.H.InSheet};t.searchController.total>0&&(c.canSingleReplace=t.updateViewController.getCanSingleReplace()),t.setSearchRegionType(l,c),t.showValue&&t.removeListener(),t.addListener(),t.showValue=!0,t.searchController.initSearch(l),t.app.view.canvas.inputManager.isInputtingState()&&t.app.view.canvas.inputManager.handleExitInput(),t.updateViewController.showPanel(c),t.app.event.default.trigger(r.Z.EVENT_NAME.UI_SHOW,qe.Xs.SEARCH_PANEL_PC),ke(l,a)}},this.addListener=function(){t.searchController.addListener(),t.updateViewController.addEventListener()},this.removeListener=function(){t.searchController.removeListener(),t.updateViewController.removeEventListener()},this.handleRangeSelect=function(e){t.updateViewController.setInvisible(),t.searchController.showRangeSelectPanel((function(a){t.updateViewController.setVisible(),e(a)}))},this.chooseAdvanced=function(){t.searchController.initSearch(s.N.ADVANCED_SEARCH),t.updateViewController.chooseAdvancedContent(t.cacheValue)},this.handleClose=function(){t.close()},this.handleNext=function(){t.searchController.handleNext()},this.handleChangeSearch=function(e,a){t.cacheValue=e,t.searchController.handleChangeSearch(e,a)},this.handlePrev=function(){t.searchController.handlePrev()},this.handleReplace=function(e,a){t.replaceController.handleReplace(e,a)},this.handleReplaceAll=function(e,a){t.replaceController.handleReplaceAll(e,a)},this.handleRegionTypeChange=function(e){t.searchController.resetSearchRegionType(e)},this.handleCheckBoxChange=function(e,a){t.searchController.resetSearchConditions(e,a),Be(a)},this.app=e.spreadsheetApp,this.eventManager=new Qe,this.searchHighlightRenderPlugin=new ae({alloyExcel:e.alloyExcel,spreadsheetApp:e.spreadsheetApp,rowcolAccessor:e.rowcolAccessor,tableView:e.tableView,renderPluginExtension:e.renderPluginExtension,renderApi:e.renderApi}),this.updateViewController=new ve(Object.assign(Object.assign({},e),{searchHighlightRenderPlugin:this.searchHighlightRenderPlugin,eventManager:this.eventManager})),this.searchController=new ze(Object.assign(Object.assign({},e),{eventManager:this.eventManager})),this.replaceController=new We(Object.assign(Object.assign({},e),{searchController:this.searchController,eventManager:this.eventManager})),this.updateViewController.initPanel({handleChooseAdvancedContent:this.chooseAdvanced,handleNext:this.handleNext,handleChangeSearch:this.handleChangeSearch,handlePrev:this.handlePrev,handleReplace:this.handleReplace,handleReplaceAll:this.handleReplaceAll,handleClose:this.handleClose,handleRangeSelect:this.handleRangeSelect,handleRegionTypeChange:this.handleRegionTypeChange,handleCheckBoxChange:this.handleCheckBoxChange}),new Je({show:this.show,close:this.handleClose,app:this.app}),this.listenStatusChange()}var t=e.prototype;return t.switchToReadonly=function(){this.showValue&&this.updateViewController.updateAdvancedPanel()},t.switchToEditable=function(){this.showValue&&this.updateViewController.updateAdvancedPanel()},t.listenStatusChange=function(){var e=this;this.app.sheetStatus.change((function(){e.app.sheetStatus.canEdit?e.switchToEditable():e.switchToReadonly()}))},t.close=function(){this.showValue&&(this.showValue=!1,this.reset(),this.updateViewController.closePanel(),this.removeListener(),this.app.view.canvas.inputManager.focus())},t.reset=function(){this.cacheValue="",this.searchController.close(),this.updateViewController.clear()},t.setSearchRegionType=function(e,t){D(this.app.spreadsheet,this.app.view)&&e===s.N.ADVANCED_SEARCH?(t.regionType=o.H.Range,t.region=M(this.app.spreadsheet,this.app.view),this.searchController.resetSearchRegionType(t.regionType,t.region)):this.searchController.resetSearchRegionType(t.regionType)},(0,n.Z)(e,[{key:"showing",get:function(){return this.showValue}}]),e}()},"../spread-sheet/src/external/view/main/panel/dataValidationPanel/style/assets.ts":function(e,t,a){a.d(t,{Z:function(){return n}});var n="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMiAxNWExIDEgMCAwIDEtMS0xVjJhMSAxIDAgMCAxIDEtMWgxMmExIDEgMCAwIDEgMSAxdjEyYTEgMSAwIDAgMS0xIDFIMnptNS40LTYuNEgyLjJ2NS4yaDUuMlY4LjZ6bTYuNCAwSDguNnY1LjJoNS4yVjguNnpNNy40IDIuMkgyLjJ2NS4yaDUuMlYyLjJ6bTYuNCAwSDguNnY1LjJoNS4yVjIuMnoiIGZpbGw9IiM4MTg2OEYiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg=="},"../spread-sheet/src/external/view/main/panel/errorTipPanel/index.tsx":function(e,t,a){a.r(t),a.d(t,{CustomCellErrorType:function(){return E},default:function(){return b}}),a("../node_modules/core-js/modules/es.array.map.js");var n=a("../node_modules/i18next/dist/esm/i18next.js"),r=a("react-dom"),s=a.n(r),o=a("react"),i=a.n(o),l=a("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),c=a("../node_modules/@babel/runtime/helpers/esm/createClass.js"),h=a("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),d=(a("../node_modules/core-js/modules/es.array.concat.js"),a("../node_modules/core-js/modules/es.array.slice.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.function.name.js"),a("../node_modules/core-js/modules/es.array.from.js"),a("../node_modules/core-js/modules/es.string.iterator.js"),a("../node_modules/core-js/modules/es.symbol.js"),a("../node_modules/core-js/modules/es.symbol.description.js"),a("../node_modules/core-js/modules/es.symbol.iterator.js"),a("../node_modules/core-js/modules/es.array.iterator.js"),a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../spread-sheet/src/core/view/lib/mutex-management/MutexManagement.ts")),u=a("../node_modules/@tencent/dui/lib/components/Menu/index.js"),p=a("../node_modules/@tencent/dui/lib/components/Divider/index.js"),m=a("../packages/report/src/index.ts"),v=a("../node_modules/@tencent/docs-user-agent/dist/index.js"),f=a.n(v),g=a("../node_modules/@tencent/dui-mobile/lib/components/ActionSheet/index.js");function C(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(e){if("string"===typeof e)return w(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?w(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var R=f().isMobile,S=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).state={isExpanded:!!t.props.expand},t.rootNodeRef=i().createRef(),t.handleOuterClick=function(e){var a=t.rootNodeRef.current;a&&(a.contains(e.target)||t.mutexHide())},t.handleIconClick=function(){var e,a;R&&t.hasErrorActions?t.showMobileAction():t.state.isExpanded?t.setState({isExpanded:!1}):(null===(a=(e=t.props).onExpand)||void 0===a||a.call(e),t.setState({isExpanded:!0}),t.props.mutexManagement.mutexShow(d.d.ERROR_TIP_PANEL),m.ZP.tdwReport({opername:"doc_excel_editor",module:"gray_icon",action:"gray_icon_click"}))},t}(0,h.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){this.props.mutexManagement.addMutexComponent(d.d.ERROR_TIP_PANEL,this),document.addEventListener("mousedown",this.handleOuterClick),document.addEventListener("touchstart",this.handleOuterClick)},a.componentWillUnmount=function(){this.props.mutexManagement.removeMutexComponent(d.d.ERROR_TIP_PANEL,this),document.removeEventListener("mousedown",this.handleOuterClick),document.removeEventListener("touchstart",this.handleOuterClick)},a.componentDidUpdate=function(e){this.props.expand&&this.props.expand!==e.expand&&(R?this.hasErrorActions&&this.showMobileAction():this.setState({isExpanded:!0}))},a.mutexHide=function(){this.setState({isExpanded:!1})},a.render=function(){var e=this.props,t=e.left,a=e.top,n=e.visible,r=e.tipContent,s=e.errorContent,o=this.state.isExpanded;return!1===n||!s&&!r?null:i().createElement("div",{className:"error-tip",style:{left:t,top:a},ref:this.rootNodeRef},i().createElement("div",{className:"error-tip-icon",onClick:this.handleIconClick},i().createElement("div",{className:"error-tip-icon-info"}),i().createElement("div",{className:"error-tip-icon-arrow"})),o&&this.shouldShowDropDown&&i().createElement(i().Fragment,null,s&&i().createElement(u.default,{className:"error-tip-expand",itemClassName:"error-tip-action"},i().createElement("div",{className:"error-tip-description",style:this.hasErrorActions?{}:{padding:"0 12px"}},s.title,s.content),this.renderErrorActions()),r&&i().createElement(u.default,{className:"error-tip-expand"},i().createElement("div",{className:"extra-tip-area"},r.content))))},a.showMobileAction=function(){var e=this.props,t=e.errorContent,a=e.errorActions,n=(null===a||void 0===a?void 0:a.map((function(e){return{id:e.key,title:e.text,titleClassName:e.warning?"warning-action":""}})))||[];g.default.show({options:[{id:"description",title:t.content,titleStyle:{fontSize:"14px"},disabled:!0}].concat((0,l.Z)(n)),onClickAction:function(e){if(a)for(var t,n=C(a);!(t=n()).done;){var r=t.value,s=r.callback;if(r.key===e){s();break}}}})},a.renderErrorActions=function(){var e=this,t=this.props.errorActions;if(!(null===t||void 0===t?void 0:t.length))return null;var a=t.map((function(t){return i().createElement(u.default.Item,{onClick:function(){t.callback(),e.mutexHide()},id:t.key},t.text)}));return[i().createElement(p.default,null)].concat((0,l.Z)(a))},(0,c.Z)(t,[{key:"hasErrorActions",get:function(){var e;return!!(null===(e=this.props.errorActions)||void 0===e?void 0:e.length)}},{key:"shouldShowDropDown",get:function(){return!R||!this.hasErrorActions}}]),t}(i().PureComponent);S.defaultProps={left:0,top:0};var _,E,x=a("../spread-sheet/src/core/data/configService/spreadConfig.ts"),y=a("../spread-sheet/src/core/view/level-2/error-tip/utils.ts"),I=a("../packages/model/src/cell/ErrorTipType.ts"),D=a("../packages/model/src/cell/metadata/CustomDataType.ts");!function(e){e[e.NO_AUTH_FOR_PRIVATE_AREA=65536]="NO_AUTH_FOR_PRIVATE_AREA",e[e.REMIND_FOR_PRIVATE_AREA=131072]="REMIND_FOR_PRIVATE_AREA"}(E||(E={}));var A=((_={})[I.Z.NUMBER_STORED_AS_TEXT]={title:i().createElement("div",{className:"error-tip-description-title"},n.ZP.t("失效：")),content:n.ZP.t("该数字是文本格式，可能会使计算出错")},_[E.NO_AUTH_FOR_PRIVATE_AREA]={title:i().createElement("div",{className:"error-tip-description-title"},n.ZP.t("无查看权限：")),content:n.ZP.t("此单元格已开启填写内容隐藏，你无法查看")},_[E.REMIND_FOR_PRIVATE_AREA]={content:n.ZP.t("此单元格已开启填写内容隐藏，仅你和文档创建者可见")},_),b="page-editor"==a.j?function(){function e(e){var t,a=this;this.show=function(e){var t=e.range,n=e.errorFlag,r=e.extraTipFlag,o=e.expand;a.range&&t.equal(a.range)||m.ZP.tdwReport({opername:"doc_excel_editor",module:"gray_icon",action:"gray_icon_view"}),a.range=t,a.errorFlags=n;var l=t.startColIndex,c=t.endColIndex,h=t.startRowIndex,d=a.areaData.getDisplayViewLeftByCol(l),u=a.areaData.getDisplayViewRightByCol(c),p=d+a.canvas.inputManager.activeEditor.input.clientWidth,v=f().isMobile&&a.canvas.inputManager.isSupportFloatStage(),g=a.canvas.inputManager.isInputtingState()&&!v?Math.max(p,u):u,C=a.areaData.getDisplayViewTopByRow(h),w=a.canvas.headSize,R=w.displayColHeadHeight,_=w.displayRowHeadWidth+(d>47?d-47:g+5),x=R+Math.max(0,C);r===E.REMIND_FOR_PRIVATE_AREA&&m.ZP.tdwReport({opername:"doc_excel",module:"privacy_fill",action:"view_tips"}),s().render(i().createElement(S,{expand:o,left:_,top:x,errorContent:A[n],errorActions:a.errorActions[n],tipContent:r&&A[r],mutexManagement:a.canvas.mutexManagement,onExpand:a.getTipPanelExpandCallback(r)}),a.container)},this.hide=function(){s().render(i().createElement(S,{visible:!1,mutexManagement:a.canvas.mutexManagement}),a.container)},this.getTipPanelExpandCallback=function(e){return function(){e===E.REMIND_FOR_PRIVATE_AREA&&m.ZP.tdwReport({opername:"doc_excel",module:"privacy_fill",action:"clk_tips"}),e===E.NO_AUTH_FOR_PRIVATE_AREA&&m.ZP.tdwReport({opername:"doc_excel",module:"privacy_fill",action:"view_clear",ver6:f().isMobile?2:1})}},this.tranformToNumber=function(){a.app.requestApi.numberFormat({pattern:"General",gridRange:a.range,cells:a.getRelatedCellCoordinates(),shouldReparse:!0}),a.hideAndRestoreFocus(),m.ZP.tdwReport({opername:"doc_excel_editor",module:"gray_icon",action:"gray_icon_use",ver10:"translate_to_number",ver11:x.q.getConfig("padTitle")})},this.clearContentAndRefill=function(){var e=a.app.view.canvas,t=e.inputManager,n=e.cellEditorManager,r=a.app.view.getSelection().activeCell,s=r.rowIndex,o=r.colIndex;(0,D.wK)(a.app.spreadsheet.activeSheet,s,o)?n.updateEditor({row:s,col:o,clearPrivacyContent:!0}):f().isMobile?t.handleEnterInput({ignorePrivateCell:!0}):t.handleEnterInput(),a.hideAndRestoreFocus(),m.ZP.tdwReport({opername:"doc_excel",module:"privacy_fill",action:"clk_clear",ver6:f().isMobile?2:1})},this.ignoreError=function(){var e=a.getRelatedCellCoordinates().map((function(e){var t,n=e.row,r=e.col;return{row:n,col:r,ignoreFlags:((null===(t=a.app.spreadsheet.activeSheet.getCellDataAtPosition(n,r))||void 0===t?void 0:t.getIgnoredErrorFlags())||0)+a.errorFlags}}));a.app.requestApi.setIgnoredErrorFlags({cellFlags:e,range:a.range}),a.hideAndRestoreFocus(),m.ZP.tdwReport({opername:"doc_excel_editor",module:"gray_icon",action:"gray_icon_use",ver10:"miss_clue",ver11:x.q.getConfig("padTitle")})},this.app=e,this.canvas=e.view.canvas,this.areaData=this.canvas.areaData,this.container=document.createElement("div");var r=document.getElementById("canvasContainer");null===r||void 0===r||r.appendChild(this.container),this.errorActions=((t={})[I.Z.NUMBER_STORED_AS_TEXT]=[{key:"ignore-num-as-text",text:n.ZP.t("忽略提示"),callback:this.ignoreError},{key:"convert-text-to-num",text:n.ZP.t("转换为数字"),callback:this.tranformToNumber}],t[E.NO_AUTH_FOR_PRIVATE_AREA]=[{key:"clear-and-refill",text:n.ZP.t("清空重写"),warning:!0,callback:this.clearContentAndRefill}],t[E.REMIND_FOR_PRIVATE_AREA]=[],t)}var t=e.prototype;return t.getRelatedCellCoordinates=function(){var e=this,t=[];return this.range.each((function(a,n){var r=(0,y.V)(e.app.spreadsheet.activeSheet,e.app.view.canvas.errorTipAccessor,a,n);e.errorFlags&&r===e.errorFlags&&t.push({row:a,col:n})})),t},t.hideAndRestoreFocus=function(){this.hide(),f().isPC&&this.app.view.canvas.inputManager.focus()},e}():null},"../spread-sheet/src/external/view/ui-layer/data-validation/data-validation-constants.ts":function(e,t,a){a.d(t,{og:function(){return i},tx:function(){return c}}),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.regexp.to-string.js"),a("../node_modules/core-js/modules/es.object.values.js"),a("../node_modules/core-js/modules/es.array.find.js");var n,r,s,o,i,l,c,h,d=a("../node_modules/i18next/dist/esm/i18next.js"),u=a("../packages/model/src/cell/metadata/date-time/DateTimeTemplateType.ts"),p=a("../packages/model/src/cell/metadata/CustomDataType.ts"),m=a("../packages/model/src/cell/metadata/select/SelectTemplateType.ts"),v=a("../packages/model/src/cell/index.ts"),f=a("../spread-sheet/src/core/view/level-2/data-context-menu/config.tsx");!function(e){e[e.DATAVALIDATION=101]="DATAVALIDATION",e[e.REPEAT=102]="REPEAT",e[e.CONDITIONFORMAT=103]="CONDITIONFORMAT",e[e.CONDITIONMANAGER=104]="CONDITIONMANAGER",e[e.SMARTSPLIT=105]="SMARTSPLIT"}(i||(i={})),function(e){e.RED="red",e.BLUE="blue",e.YELLOW="yellow",e.PINK="pink",e.PURPLE="purple",e.ORANGE="orange"}(l||(l={})),function(e){e.MENU="menu",e.COL="column",e.CONTEXT="context_menu"}(c||(c={})),function(e){e.REMOVE="validation_delete",e.SET_COLOR="validation_color",e.SET_MULITI="validation_multichoice"}(h||(h={}));d.ZP.t("单选多选"),p.d9.SELECT.toString(),d.ZP.t("自定义"),m.Z.CUSTOM.toString(),d.ZP.t("是否"),m.Z.YES_NO.toString(),d.ZP.t("性别"),m.Z.SEX.toString(),d.ZP.t("学历"),m.Z.EDUCATION.toString(),d.ZP.t("状态"),m.Z.PROJECT_STATUS.toString(),d.ZP.t("已完成/未完成"),d.ZP.t("优先级"),m.Z.PRIORITY.toString(),d.ZP.t("服装尺寸"),m.Z.CLOTHING_SIZE.toString(),d.ZP.t("复选框"),p.d9.CHECKBOX.toString(),d.ZP.t("评星"),p.d9.STAR.toString(),d.ZP.t("进度"),p.d9.PROGRESS.toString(),d.ZP.t("身份证号"),p.d9.ID.toString(),d.ZP.t("手机号码"),p.d9.PHONE_NUM.toString(),d.ZP.t("电子邮箱"),p.d9.EMAIL.toString(),d.ZP.t("时间日期"),p.d9.DATE_TIME.toString(),d.ZP.t("年月日"),u.KS.YEAR_MONTH_DAY.toString(),d.ZP.t("2018年4月18日"),d.ZP.t("年月"),u.KS.YEAR_MONTH.toString(),d.ZP.t("2018年4月"),d.ZP.t("月日"),u.KS.MONTH_DAY.toString(),d.ZP.t("4月18日"),d.ZP.t("日期时间"),u.KS.DATE_TIME.toString(),d.ZP.t("时间"),u.KS.HOUR_MINUTE.toString(),d.ZP.t("温度"),p.d9.TEMPERATURE.toString(),d.ZP.t("更多数据验证");(function(){var e=[];e[p.d9.ID]=v.DATA_VALIDATION_RULE_TYPE.CUSTOM_ID_CARD,e[p.d9.EMAIL]=v.DATA_VALIDATION_RULE_TYPE.CUSTOM_TEXT_MAIL,e[p.d9.PHONE_NUM]=v.DATA_VALIDATION_RULE_TYPE.CUSTOM_NUM_PHONE})(),d.ZP.t("数据验证"),i.DATAVALIDATION.toString(),d.ZP.t("红"),d.ZP.t("橙"),d.ZP.t("蓝"),d.ZP.t("绿"),d.ZP.t("紫"),d.ZP.t("粉"),d.ZP.t("灰"),d.ZP.t("白"),(n={})[c.COL]="column",n[c.MENU]="menu",n[c.CONTEXT]="rightside_menu",n[f.BD.COL]="column",n[f.BD.SHEETBAR]="menu",n[f.BD.CONTEXT]="rightside_menu",(r={})[p.d9.SELECT]="choice",r[p.d9.STAR]="star",r[p.d9.CHECKBOX]="checkbox",r[p.d9.PROGRESS]="progress",r[p.d9.DATE_TIME]="time",r[p.d9.ID]="ID",r[p.d9.PHONE_NUM]="phone",r[p.d9.EMAIL]="mail",r[p.d9.TEMPERATURE]="temperature",r[p.d9.IMAGE]="",r[p.d9.DATE_REMINDER]="date-reminder",r[p.d9.TEXT]="text",r[p.d9.NUMBER]="number",r[p.d9.TELEPHONE_NUM]="telephone-number",r[p.d9.CONTACT]="contact",r[p.d9.ATTACHMENT]="attachment",r[p.d9.STAFF_CARD]="staff-card",r[p.d9.GROUP_CARD]="group-card",r[p.d9.SCHEDULE]="schedule",r[p.d9.TODO]="todo",r[p.d9.THIRD_PARTY_APP]="third_party_app",r[p.d9.MINI_APP]="mini_app",(s={})[m.Z.CUSTOM]="selfdefine",s[m.Z.SEX]="sexuality",s[m.Z.EDUCATION]="education",s[m.Z.YES_NO]="yes_or_no",s[m.Z.PRIORITY]="priority",s[m.Z.PROJECT_STATUS]="status",s[m.Z.CLOTHING_SIZE]="size",(o={})[u.KS.DATE_TIME]="d_c",o[u.KS.HOUR_MINUTE]="clock",o[u.KS.MONTH_DAY]="m_d",o[u.KS.YEAR_MONTH]="y_m",o[u.KS.YEAR_MONTH_DAY]="y_m_d"},"../spread-sheet/src/external/view/ui-layer/data-validation/data-validation-utils.ts":function(e,t,a){a.d(t,{RQ:function(){return s}}),a("../node_modules/core-js/modules/es.regexp.exec.js"),a("../node_modules/core-js/modules/es.string.split.js"),a("../node_modules/core-js/modules/es.object.to-string.js"),a("../node_modules/core-js/modules/es.regexp.to-string.js"),a("../node_modules/core-js/modules/web.dom-collections.for-each.js"),a("../packages/model/src/cell/metadata/CustomDataType.ts"),a("../packages/report/src/index.ts"),a("../packages/model/src/cell/format/Color.ts");var n=a("../spread-sheet/src/external/view/ui-layer/data-validation/data-validation-constants.ts"),r=a("../spread-sheet/src/core/feature/dataValidation/constant.ts");function s(e){var t=e.split("_");if(t[0]===n.og.REPEAT.toString()||t[0]===n.og.CONDITIONFORMAT.toString()||t[0]===n.og.CONDITIONMANAGER.toString()||t[0]===n.og.SMARTSPLIT.toString())return{customUITypeId:t[0]};if(t[0]===n.og.DATAVALIDATION.toString())return{customUITypeId:t[0],customTypeId:r.rX[t[0]].customDataType};var a={customUITypeId:t[0],customTypeId:r.rX[t[0]].customDataType};return t.length>1&&(a.templateId=t[1]),a}}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/bundle_view_level2_readyonly_lazy_module1.78c2109053999a48bbae.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=bundle_view_level2_readyonly_lazy_module1.78c2109053999a48bbae.js.map