self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["spread-sheet_src_external_view_ui-layer_range-auth_components_range-auth-drawer_tsx"],{"../spread-sheet/src/external/rangeAuth/util/check-sheet-status-utils.ts":function(e,t,n){n.d(t,{x:function(){return a}});var r=n("../node_modules/i18next/dist/esm/i18next.js"),o=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),s=n("../spread-sheet/src/external/rangeAuth/util/util.ts");function a(e,t){var n,a=(0,s.getProtectedMap)(),i=(0,s.getSheetIdByRangeId)(e,a),d=void 0!==i&&!!(null===(n=t.sheetManager.getSheetBySheetId(i))||void 0===n?void 0:n.properties.hidden);return d&&o.default.show({type:"info",message:r.ZP.t("工作表已隐藏，请先取消工作表隐藏～"),autoClose:!0}),d}},"../spread-sheet/src/external/rangeAuth/util/data-api.ts":function(e,t,n){n.r(t),n.d(t,{addRangeAuth:function(){return s},autoTest:function(){return u},deleteRangeAuth:function(){return i},updateRangeAuth:function(){return a},updateRangeAuthOnSheet:function(){return d}});var r=n("../packages/model/src/range/GridRange.ts"),o=n("../packages/utils/src/index.ts");function s(e,t,n,r){e.addProtectionRange({workbookRangeId:t,range:n,description:"",otherPrivilege:r})}function a(e,t,n,r){e.updateProtectionRange({workbookRangeId:t,range:n,description:"",otherPrivilege:r})}function i(e,t){e.deleteProtectionRange({workbookRangeIds:t instanceof Array?t:[t]})}function d(e,t,n,r){t&&a(e,t,r.clone()),n&&i(e,n)}var u={addRangeAuth:function(e,t){var n=t.sheetId,a=t.startRowIndex,i=t.endRowIndex,d=t.startColIndex,u=t.endColIndex,c=o.kk.getRandomId();return s(e,c,new r.Z(n,a,i,d,u)),c},deleteRangeAuth:i,updateRangeAuth:function(e,t,n){var o=n.sheetId,s=n.startRowIndex,i=n.endRowIndex,d=n.startColIndex,u=n.endColIndex;a(e,t,new r.Z(o,s,i,d,u))}}},"../spread-sheet/src/external/rangeAuth/util/range-auth-parse-util.ts":function(e,t,n){n.d(t,{Pw:function(){return a},rk:function(){return d}});var r=n("../node_modules/i18next/dist/esm/i18next.js"),o=n("../packages/model/src/range/hexRangeUtils.ts"),s=n("../packages/model/src/range/GridRange.ts");function a(e){if(e.isSheet)return"「"+n.g.SpreadsheetApp.spreadsheet.sheetManager.getSheetTitleBySheetId(e.sheetId)+"」";var t=e.startRowIndex,s=e.endRowIndex,a=e.startColIndex,i=e.endColIndex,d=e.isCol,u=e.isRow,c=e.isSheet,l=(0,o.colIndex2ColChar)(a),h=(0,o.colIndex2ColChar)(i);return d?l===h?r.ZP.t("（第{{startColName}}列）",{startColName:l}):r.ZP.t("（第{{startColName}}至{{endColName}}列）",{startColName:l,endColName:h}):u?t===s?r.ZP.t("（第{{value}}行）",{value:t+1}):r.ZP.t("（第{{value0}}至{{value1}}行）",{value0:t+1,value1:s+1}):c?n.g.SpreadsheetApp.spreadsheet.sheetManager.getSheetTitleBySheetId(e.sheetId):t===s&&l===h?"（"+l+(t+1)+"）":"（"+l+(t+1)+":"+h+(s+1)+"）"}function i(e){var t={text:"",isSingleSelect:!0,gridRange:new s.Z(n.g.SpreadsheetApp.spreadsheet.activeSheetId)};if(e.length>1||0===e.length)return t.isSingleSelect=!1,t;var r=e[0],o=function(e){var t={startRowIndex:0,endRowIndex:0,startColIndex:0,endColIndex:0},r=e.selectRow,o=e.selectAll,s=e.selectCol;return r?(t.startRowIndex=e.yRange[0],t.endRowIndex=e.yRange[1],t):s?(t.startColIndex=e.xRange[0],t.endColIndex=e.xRange[1],t):o?(t.endRowIndex=n.g.SpreadsheetApp.spreadsheet.activeSheet.getRowCount()-1,t.endColIndex=n.g.SpreadsheetApp.spreadsheet.activeSheet.getColCount()-1,t):(t.startRowIndex=e.yRange[0],t.endRowIndex=e.yRange[1],t.startColIndex=e.xRange[0],t.endColIndex=e.xRange[1],t)}(r),i=o.startRowIndex,d=o.endRowIndex,u=o.startColIndex,c=o.endColIndex;t.gridRange.startRowIndex=i,t.gridRange.endRowIndex=d,t.gridRange.startColIndex=u,t.gridRange.endColIndex=c;var l=r.selectRow,h=r.selectCol;return l?(t.gridRange.startColIndex=s.v,t.gridRange.endColIndex=s.v):h&&(t.gridRange.startRowIndex=s.v,t.gridRange.endRowIndex=s.v),t.text+=a(t.gridRange),t}function d(){return i(n.g.SpreadsheetApp.view.canvas.normalSelectData.selectQueue)}},"../spread-sheet/src/external/rangeAuth/util/range-auth-report-util.ts":function(e,t,n){n.d(t,{E8:function(){return c},II:function(){return p},MK:function(){return j},Ye:function(){return u},_V:function(){return d},_f:function(){return _},dx:function(){return v},i2:function(){return m},k7:function(){return R},m0:function(){return l},mr:function(){return h},nm:function(){return g},u1:function(){return I},ub:function(){return A},vf:function(){return f}});var r=n("../packages/report/src/index.ts"),o=n("../spread-sheet/src/external/rangeAuth/config/auth-constant.ts");function s(e){return e.isSheet?"sheet":e.isCol?"line":e.isRow?"row":"range"}function a(e){return e===o.oI.ONLY_I_CAN_EDIT?"me":"cooperation"}function i(e){return e===o.jV.COOPERATION?"onlyfriend":e===o.jV.VIEWABLE?"allsee":e===o.jV.EDITBLE?"alledit":"onlyme"}function d(e){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"view_range_protection",ver10:e})}function u(e,t){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"click_range_protection",ver10:e,ver11:s(t)})}function c(e,t,n,o){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"range_protection_set",ver10:a(e),ver11:s(n),ver12:i(t),ver13:o})}function l(){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"click_invite_friends"})}function h(e){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"range_protection_list",ver10:e})}function g(e){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"click_organize",ver11:s(e)})}function m(e){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"click_cancel",ver11:s(e)})}function f(){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"cowoker_view"})}function p(){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"click_lock"})}function _(e,t){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"range_protection_activedoc",ver11:e,ver12:t})}function v(){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"cowoker_number"})}function R(){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"cowoker_click"})}var x=!1;function I(){x||(x=!0,r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"range_authority_commonrange"}))}function j(){r.ZP.tdwReport({opername:"doc_excel_editor",module:"range_authority",action:"range_authority_commonrange_set"})}function A(){r.ZP.tdwReport({opername:"doc_smartsheet_editor",module:"excel_smartsheet",action:"protect_smartsheet"})}},"../spread-sheet/src/external/rangeAuth/util/util.ts":function(e,t,n){n.r(t),n.d(t,{convertToLocalRangePrivilege:function(){return y},convertToServerRangePrivilege:function(){return E},getActiveSheetRangeIds:function(){return v},getCurrentSheetRangeIdsAndAllSheetRangeIds:function(){return f},getExistSheetRangeIdItem:function(){return p},getGridRangeByRangeId:function(){return I},getGridRangeListBySheetId:function(){return j},getNewRangeId:function(){return g},getProtectedMap:function(){return m},getRangeAuthInfo:function(){return i.ng},getRangeAuthListCrossGridRange:function(){return w},getRangeAuthListCrossSelectArea:function(){return b},getRangeIdByGridRange:function(){return x},getRangeIdsBySheetId:function(){return _},getSheetIdByRangeId:function(){return k},getWorkbookAuth:function(){return i.Vu},isGridRangeSetAuth:function(){return A},isRangeCountExceedMaxValue:function(){return S},isSheetRangeSetAuth:function(){return R},isWedocUpgradedSheet:function(){return C},parseGridRangeText:function(){return d.Pw},parseSelectDataForRangeAuth:function(){return d.rk},setRangeAuthInfo:function(){return i.Sh},setWorkbookAuth:function(){return i.QQ}}),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.find-index.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/core-js/modules/es.symbol.iterator.js");var r=n("../node_modules/i18next/dist/esm/i18next.js"),o=n("../spread-sheet/src/core/app/tool.ts"),s=n("../packages/utils/src/index.ts"),a=n("../packages/model/src/range/GridRange.ts"),i=n("../spread-sheet/src/external/rangeAuth/util/range-auth-request-util.ts"),d=n("../spread-sheet/src/external/rangeAuth/util/range-auth-parse-util.ts"),u=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),c=n("../spread-sheet/src/core/data/configService/spreadConfig.ts");function l(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(){return s.kk.getRandomId()}function m(){return n.g.SpreadsheetApp.spreadsheet.workbookRangeManager.protectedRangeMap}function f(e,t){var n={currentSheetRangeIds:[],allSheetRangeIds:[]};return t.forEach((function(t,r){t.range.isSheet?n.allSheetRangeIds.push(r):t.range.sheetId===e&&n.currentSheetRangeIds.push(r)})),n}function p(e){var t="";return m().forEach((function(n,r){if(n.range.isSheet&&n.range.sheetId===e)return t=r})),t}function _(e){var t=[],n="";return m().forEach((function(r,o){r.range.sheetId===e&&(r.range.isSheet?n=o:t.push(o))})),{rangeIds:t,sheetRangeId:n}}function v(){return _(o.Z.window.SpreadsheetApp.spreadsheet.activeSheetId)}function R(e){return!!p(e)}function x(e){for(var t,n="",r=l(m().entries());!(t=r()).done;){var o=t.value,s=o[0];if(o[1].range.contain(e)){n=s;break}}return n}function I(e){var t=new a.Z(o.Z.window.SpreadsheetApp.spreadsheet.activeSheetId),n=m().get(e);return void 0!==n&&(t=n.range.clone()),t}function j(e){var t=[];return m().forEach((function(n){n.range.sheetId===e&&t.push(n.range.clone())})),t}function A(e){return-1!==j(e.sheetId).findIndex((function(t){return t.isCross(e)}))}function w(e){var t=[];return m().forEach((function(n,r){var o=n.range;o.isCross(e)&&!o.isSheet&&t.push({rangeId:r,modifyTime:n.properties.modifyTime||0,gridRange:n.range.clone()})})),t}function b(){var e=(0,d.rk)(),t=e.gridRange,n=e.isSingleSelect;return t.isSheet||!n?[]:w(t)}function S(){var e=m().size>=2e3;return e&&u.default.show({type:"info",message:r.ZP.t("受保护范围已超过2000个上限，请取消部分保护范围后重试。"),autoClose:!0,style:{zIndex:10004}}),e}function y(e){var t={};return e.length&&e.forEach((function(e){t[e.rangeId]=[e.rangePolicy,e.rangePrivilege,Number(e.setUid),e.uintype,e.rangeOtherPrivilegeType]})),t}function E(e){var t=[];return Object.keys(e).forEach((function(n){t.push({rangeId:n,rangePolicy:e[n][0],rangePrivilege:e[n][1],setUid:""+e[n][2],uintype:e[n][3],rangeOtherPrivilegeType:e[n][4]})})),t}function k(e,t){var n;return null===(n=t.get(e))||void 0===n?void 0:n.range.sheetId}function C(){return(c.q.getConfig("padId")||"").match(/^e2_/)}},"../spread-sheet/src/external/view/main/panel/rangeAuthPanel/utils/index.ts":function(e,t,n){n.d(t,{Eu:function(){return _},LZ:function(){return p},Rj:function(){return c},WF:function(){return m},Yg:function(){return R},wJ:function(){return f},yM:function(){return v}}),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.array.sort.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.array.filter.js");var r=n("../node_modules/i18next/dist/esm/i18next.js"),o=n("../spread-sheet/src/core/app/tool.ts"),s=n("../spread-sheet/src/external/rangeAuth/config/auth-constant.ts"),a=n("../spread-sheet/src/external/rangeAuth/util/util.ts"),i=n("../spread-sheet/src/external/rangeAuth/util/range-auth-parse-util.ts"),d=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),u=(n("../spread-sheet/src/base/util/domain-config.ts"),{1:"qq",102:"qq",103:"qq",2:"wx",104:"auth-group"});function c(e){var t=u[e];return void 0===t&&(t="wework"),"avatar-"+t}function l(e){var t=new Map;return e.forEach((function(e){t.set(e.uid,e)})),t}function h(e){var t="",n=(0,a.getProtectedMap)().get(e);if(!n)return t;var r=n.range;return(t=(0,i.Pw)(r)).replace(/(（|）)/g,"")}function g(e,t){var n;return null===(n=t[e])||void 0===n?void 0:n.isSelected}function m(e,t,n,r,a){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=[]);var i=[],d=l(n),u=l(t);return e.forEach((function(e){var t=e.uid,n=Object.assign(Object.assign({},e),{isWorkbookCanEdit:e.info===s.mP.USER_CAN_EDIT,isCurrentSheetCanEdit:!0,isSelected:void 0!==u.get(t)||g(t,a)});if(r){var c=d.get(t);n.isCurrentSheetCanEdit=void 0!==c&&c.rangePrivilege===s.M.CAN_EDIT}n.uid!==o.Z.window.clientVars.userInfo.uid&&i.push(n)})),i}function f(){var e=o.Z.window.clientVars.userInfo;return{avatar:e.avatar,nick:e.nick,uidSource:e.uid_source}}function p(){var e={};return(0,a.getProtectedMap)().forEach((function(t,r){var o=t.range,s=o.sheetId,a=o.isSheet,i=t.properties.modifyTime;i=void 0===i?0:i;var d=n.g.SpreadsheetApp.spreadsheet.sheetManager.getSheetBySheetId(s);if(d){var u=d.getTitle();e[r]={rangeId:r,sheetId:s,title:""+u,eclipseTitle:""+(u.length>9?u.substr(0,9)+"...":u),rangeDesc:h(r),isSheet:a,modifyTime:i}}})),e}function _(e){void 0===e&&(e={});var t=[],n=[];return(window.SpreadsheetApp.spreadsheet.sheetManager.sheetList||[]).forEach((function(e){n.push({id:e.getSheetId()})})),n.forEach((function(n){var r=n.id,o=[];Object.keys(e).forEach((function(t){e[t].sheetId===r&&o.push(e[t])})),o.sort((function(e,t){return e.isSheet&&t.isSheet?0:e.isSheet||t.isSheet?-1:t.modifyTime-e.modifyTime})),t.push.apply(t,o)})),t}function v(e){var t={};return e.forEach((function(e){e.isSelected&&(t[e.uid]={isSelected:!0})})),t}function R(e,t){var n=[],o=!!d.q.getConfig("isOwner"),i=d.q.getConfig("uid");return e.forEach((function(e){for(var d,u=e.rangeId,c=e.sheetId,l=e.title,h=e.isSheet,g=e.eclipseTitle,m=e.rangeDesc,f=t.length,p=!1,_=0;_<f;_++){var v=t[_];if(v.rangeId===u){n.push({sheetId:c,rangeId:u,title:l,canEdit:x(v.memlist.filter((function(e){return e.rangePrivilege===s.M.CAN_EDIT})).map((function(e){return e.uid})),v.rangePolicy),canRead:I(v.memlist.map((function(e){return e.uid})),v.rangePolicy,v.rangeOtherPrivilegeType),canManage:v.setUid===i||o,creatorName:null!==(d=v.setName)&&void 0!==d?d:r.ZP.t("owner自己"),isSheet:h,eclipseTitle:g,rangeDesc:m}),p=!0;break}}p||(0,a.isWedocUpgradedSheet)()&&!h||n.push({sheetId:c,rangeId:u,title:l,canEdit:o,canRead:o,creatorName:"",isBadData:!0,isSheet:h,eclipseTitle:g,rangeDesc:m})})),n}function x(e,t){var n=d.q.getConfig("isOwner"),r=d.q.getConfig("uid"),o=t===s.oI.SOME_CAN_EDIT&&-1!==e.indexOf(r);return n||o}function I(e,t,n){var r=d.q.getConfig("isOwner"),o=d.q.getConfig("uid"),a=t===s.oI.SOME_CAN_EDIT&&-1!==e.indexOf(o),i=n!==s.mA.CAN_NOT_VIEW;return r||a||i}},"../spread-sheet/src/external/view/ui-layer/range-auth/components/range-auth-drawer.tsx":function(e,t,n){n.d(t,{Z:function(){return Z}});var r,o=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),s=(n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/esnext.reflect.metadata.js"),n("react")),a=n.n(s),i=n("../node_modules/@tencent/workbench/lib/esm/services/drawer/drawer-service.js"),d=n("../node_modules/@tencent/workbench/lib/esm/decorators/class/service.js"),u=n("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),c=n("../spread-sheet/src/core/workbench/common/base-drawer.tsx"),l=(n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.array.find-index.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/i18next/dist/esm/i18next.js")),h=n("../spread-sheet/src/external/view/main/panel/rangeAuthPanel/utils/index.ts"),g=n("../spread-sheet/src/external/rangeAuth/util/range-auth-request-util.ts"),m=n("../spread-sheet/src/external/rangeAuth/util/util.ts"),f=n("../spread-sheet/src/external/rangeAuth/config/auth-constant.ts"),p=n("../node_modules/classnames/index.js"),_=n.n(p),v=n("../spread-sheet/src/external/rangeAuth/util/data-api.ts"),R=n("../node_modules/@tencent/dui/lib/components/Tooltip/index.js"),x=n("../spread-sheet/src/external/view/main/panel/rangeAuthPanel/utils/request-utils.ts"),I=n("../spread-sheet/src/external/rangeAuth/util/range-auth-report-util.ts"),j=n("../spread-sheet/src/core/app/tool.ts"),A=(n("../spread-sheet/src/external/rangeAuth/util/check-sheet-status-utils.ts"),n("../spread-sheet/src/external/rangeAuth/constants/range-auth-event.ts")),w=n("../node_modules/@tencent/ioc/lib/esm/index.js"),b=n("../spread-sheet/src/base/event/event.ts");n("../spread-sheet/src/base/util/appConfig.ts");!function(e){e[e.Loading=0]="Loading",e[e.Loaded=1]="Loaded",e[e.LoadFail=2]="LoadFail"}(r||(r={})),s.Component,n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js");var S,y=n("../packages/report/src/index.ts"),E=function(e){function t(t){var n;return(n=e.call(this,t)||this).gobackToSheetPolicy=function(){n.closeList(),n.app.event.default.trigger("showCooperationV2")},n.closeList=function(){w.Am.get(Z).closeDrawer()},n.app=n.props.app,n.state={showLoading:!1,sheetRangeAuthList:[],highlightIndex:-1},n}(0,o.Z)(t,e);var r=t.prototype;return r.componentDidMount=function(){this.props.onRef(this)},r.initSheetRangeAuthList=function(e){var t=this,r=(0,h.LZ)(),o=Object.keys(r);this.setState({showLoading:!0}),(0,g.ng)(o,f.N7.ONLY_RANGE_AUTH).then((function(n){var o=n.data.protectedRangeList;[].concat(o).forEach((function(e){var n=e.rangeId,o=e.rangePolicy===f.oI.ONLY_I_CAN_EDIT?0:t.getMemlistLength(e.memlist);r[n]&&(r[n].count=o)}));var s=(0,h.Eu)(r);t.setState({sheetRangeAuthList:s,showLoading:!1},(function(){void 0!==e&&t.handleHighLightRangeId(s,e)}))})).catch((function(e){var r;null===(r=n.g.log)||void 0===r||r.error("rangeAuthAllList.initSheetRangeAuthList",null===e||void 0===e?void 0:e.stack),t.setState({showLoading:!1})}))},r.getMemlistLength=function(e){void 0===e&&(e=[]);var t=j.Z.window.clientVars.userInfo.uid,n=-1!==e.findIndex((function(e){return e.uid===t}));return e.length-(n?1:0)},r.handleHighLightRangeId=function(e,t){var n=e.findIndex((function(e){return e.rangeId===t})),r=(0,m.getGridRangeByRangeId)(t).sheetId;if(this.handleAuthMemberEnter(r,t,n),null!==this.rangeAuthMemberList){var o=this.rangeAuthMemberList.scrollTop,s=this.rangeAuthMemberList.offsetHeight,a=this.rangeAuthMemberList.children[n];if(void 0!==a){var i=a.offsetTop;a.offsetHeight+i>Number(s)+Number(o)&&(this.rangeAuthMemberList.scrollTop=i)}}},r.handleRangeAuthSetting=function(e,t){var n=(0,m.getGridRangeByRangeId)(t);this.app.event.rangeAuthEvent.trigger(A.k.SHOW_EXIT_RANGE_SELECTOR,t),(0,I.nm)(n)},r.handleRangeAuthDelete=function(e,t){var n=(0,m.getGridRangeByRangeId)(e);(0,v.deleteRangeAuth)(this.app.requestApi,e),this.state.sheetRangeAuthList.splice(t,1),this.setState({sheetRangeAuthList:this.state.sheetRangeAuthList}),(0,x.DR)(),(0,I.i2)(n),b.ZP.sheetsBar.trigger("bindStatusChange"),n.isSheet?(y.ZP.kvrOss({itemname:"xls_rangeprotect_sheet_delete"}),y.ZP.kvrOss({itemname:"xls_rangeprotect_sheet_delete_done"})):(y.ZP.kvrOss({itemname:"xls_rangeprotect_range_delete"}),y.ZP.kvrOss({itemname:"xls_rangeprotect_range_delete_done"}))},r.handleAuthMemberEnter=function(e,t,n){e&&t&&(this.app.event.rangeAuthEvent.trigger(A.k.SHOW_RANGE_AUTH_SELECT_AREA,e,t),this.setState({highlightIndex:n}))},r.handleAuthMemberLeave=function(){this.setState({highlightIndex:-1})},r.render=function(){var e=this,t=this.state,n=t.showLoading,r=t.sheetRangeAuthList,o=t.highlightIndex;return s.createElement("div",{className:"range-auth-all-list"},n&&s.createElement("div",{className:"range-auth-all-list-loading picture_rotate"}),s.createElement("div",{className:_()("range-auth-content",n?"hide":null)},s.createElement("div",{className:"range-auth-header"},s.createElement("button",{className:"go-back-button",onClick:function(){e.gobackToSheetPolicy()}}),s.createElement("span",{className:"range-auth-header-title"},l.ZP.t("查看整体文档权限")),s.createElement("button",{className:"close-button",onClick:function(){e.closeList()}})),s.createElement("div",{className:"sheet-title-container"},s.createElement("span",{className:"sheet-title-left"},l.ZP.t("全部受保护范围"))),s.createElement("div",{className:"range-auth-member-list",ref:function(t){e.rangeAuthMemberList=t}},r.map((function(t,n){return s.createElement("div",{key:t.rangeId,className:"range-auth-member-item "+(o===n?"range-auth-member-item-highlight":""),onMouseEnter:e.handleAuthMemberEnter.bind(e,t.sheetId,t.rangeId,n),onMouseLeave:e.handleAuthMemberLeave.bind(e,n)},s.createElement("div",{className:"range-auth-all-list-member-desc"},s.createElement("div",{className:"range-auth-member-title"},s.createElement("span",null,t.isSheet?"":t.rangeDesc),s.createElement("span",null,t.isSheet?"":" -"),s.createElement("span",null,t.title)),s.createElement("div",{className:"range-auth-member-content"},s.createElement("div",null,t.count?l.ZP.t("自己与{{value}}位好友可编辑",{value:t.count}):l.ZP.t("仅自己可编辑")))),s.createElement("div",{className:"range-auth-all-list-member-operate "+(o===n?"range-auth-all-list-member-operate-visible":"")},s.createElement(R.default,{title:l.ZP.t("管理权限"),placement:"top"},s.createElement("span",{className:"range-auth-all-list-member-operate_setting",onClick:e.handleRangeAuthSetting.bind(e,t.sheetId,t.rangeId)})),s.createElement(R.default,{title:l.ZP.t("取消保护"),placement:"top"},s.createElement("span",{className:"range-auth-all-list-member-operate_delete",onClick:e.handleRangeAuthDelete.bind(e,t.rangeId,n)}))))})))))},t}(s.Component),k=n("../node_modules/lodash/debounce.js"),C=n.n(k),P=(n("../spread-sheet/src/base/util/domain-config.ts"),function(e,t,n,r){var o,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(s<3?o(a):s>3?o(t,n,a):o(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}),L=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},N=function(e,t){return function(n,r){t(n,r,e)}},T=function(e){function t(t){var n;return(n=e.call(this,t,"range-auth-drawer")||this).app=t,n.drawerMode=i.$t.PUSH,n.debounceRefreshList=C()(n.refreshList,500),n.getContent=function(){var e=E;return a().createElement(e,{app:n.app,onRef:n.onRef})},n.afterOpenDrawer=function(){n.rangeAuthAllList.initSheetRangeAuthList(n.config.highlightRangeId),n.addListener()},n.afterCloseDrawer=function(){n.removeListener()},n.onRef=function(e){n.rangeAuthAllList=e},n}(0,o.Z)(t,e);var n=t.prototype;return n.addListener=function(){b.ZP.rangeAuthEvent.listen(A.k.ADD_NEW_RANGE_AUTH,this.debounceRefreshList.bind(this)),b.ZP.rangeAuthEvent.listen(A.k.RANGE_AUTH_CHANGE,this.debounceRefreshList.bind(this)),b.ZP.rangeAuthEvent.listen(A.k.UPDATE_RANGE_AUTH,this.debounceRefreshList.bind(this)),b.ZP.rangeAuthEvent.listen(A.k.DIMENSION_CHANGE,this.debounceRefreshList.bind(this))},n.removeListener=function(){b.ZP.rangeAuthEvent.remove(A.k.ADD_NEW_RANGE_AUTH,this.debounceRefreshList.bind(this)),b.ZP.rangeAuthEvent.remove(A.k.RANGE_AUTH_CHANGE,this.debounceRefreshList.bind(this)),b.ZP.rangeAuthEvent.remove(A.k.UPDATE_RANGE_AUTH,this.debounceRefreshList.bind(this)),b.ZP.rangeAuthEvent.remove(A.k.DIMENSION_CHANGE,this.debounceRefreshList.bind(this))},n.refreshList=function(){this.isDrawerOpen&&this.rangeAuthAllList.initSheetRangeAuthList()},t}(c.Z),Z=T=P([(0,d.t)(),N(0,u.m),L("design:paramtypes",["function"===typeof(S="undefined"!==typeof u.m&&u.m)?S:Object])],T)}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/spread-sheet_src_external_view_ui-layer_range-auth_components_range-auth-drawer_tsx.ac2f21489b8d50698563.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=spread-sheet_src_external_view_ui-layer_range-auth_components_range-auth-drawer_tsx.ac2f21489b8d50698563.js.map