self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["bundle_plugin_pcFooter"],{"../spread-sheet/src/base/util/toggle.ts":function(e,t,n){n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/@tencent/toggle-client-js/dist/toggle.es.js")},"../spread-sheet/src/core/utils/offline-env.ts":function(e,t,n){n.d(t,{j:function(){return s}});var s=function(){return!!window.__SUPPORT_FULL_OFFLINE_MODE}},"../spread-sheet/src/core/utils/relate/RelateType.ts":function(e,t){var n;!function(e){e[e.FORM=2]="FORM",e[e.AIO=7]="AIO"}(n||(n={})),t.Z=n},"../spread-sheet/src/core/utils/relate/relate.ts":function(e,t,n){n.d(t,{QP:function(){return a},tZ:function(){return c},yg:function(){return o}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js");var s=n("../spread-sheet/src/core/utils/relate/RelateType.ts"),i=n("../spread-sheet/src/base/event/event.ts"),r=(n("../spread-sheet/src/base/util/toggle.ts"),n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))});function o(){return r(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.ZP.header.trigger("relateBtnUpdate"),i.ZP.sheetsBar.trigger("bindStatusChange"),i.ZP.formRelationEvent.trigger("formRelationChange");case 3:case"end":return e.stop()}}),e)})))}function a(e){var t=e.split("$");return{domain_id:+t[0],pad_id:t[1]}}function c(e,t){if(e&&e.relateForm&&e.relateAio)return e.relateForm.isRelated(t)?s.Z.FORM:e.relateAio.isRelated(t)?s.Z.AIO:void 0}},"../spread-sheet/src/external/view/main/footer/browser/utils.ts":function(e,t,n){n.d(t,{I$:function(){return o},Zc:function(){return a},s_:function(){return h},uC:function(){return c}}),n("../node_modules/core-js/modules/es.array.map.js");var s=n("../node_modules/i18next/dist/esm/i18next.js"),i=n("../spread-sheet/src/core/ui/index.ts"),r=(n("../packages/common-utils/src/index.ts"),n("../spread-sheet/src/core/utils/relate/RelateType.ts"));function o(e,t){if(t)switch(t){case r.Z.FORM:return s.ZP.t("确定要删除该{{sheetName}}吗？删除后将无法恢复。绑定的收集表也将取消关联，收集结果不再自动更新到表格。",{sheetName:e});case r.Z.AIO:return s.ZP.t("确定删除该{{sheetName}}吗？删除后将无法恢复，文档小应用也将取消关联。",{sheetName:e})}return s.ZP.t("确定要删除该{{sheetName}}吗？删除后将无法恢复。",{sheetName:e})}function a(e,t){switch(t){case r.Z.FORM:return s.ZP.t("操作被禁止。无法删除关联了收集表的{{sheetName}}。请联系表格所有者删除。",{sheetName:e});case r.Z.AIO:return s.ZP.t("操作被禁止。无法删除关联了文档小应用的{{sheetName}}。请联系表格所有者删除。",{sheetName:e})}}function c(){i.Z.tooltip.showTooltip("#footerContainer [data-tooltip]",{tooltipArrowClass:"tooltip-after"})}function h(e,t,n){if(e.length<=0)return 0;for(var s=0;s<e.length;s++)if(e[s].hasOwnProperty(t)&&e[s][t]&&e[s][t]==n)return s;return 0}},"../spread-sheet/src/external/view/main/footer/commands/constants.ts":function(e,t){t.Z={SHEET_BAR_ADD_SHEET:"sheetBar.addSheet",SHEET_BAR_COPY_SHEET:"sheetBar.copySheet",SHEET_BAR_DELETE_SHEET:"sheetBar.deleteSheet",SHEET_BAR_MOVE_SHEET:"sheetBar.moveSheet",SHEET_BAR_RENAME_SHEET:"sheetBar.renameSheet",SHEET_BAR_SWITCH_SHEET:"sheetBar.switchSheet",SHEET_BAR_SHOW_SHEET:"sheetBar.showSheet",SHEET_BAR_HIDE_SHEET:"sheetBar.hideSheet"}},"../spread-sheet/src/external/view/main/footer/common/utils.ts":function(e,t,n){n.d(t,{Ls:function(){return h},eq:function(){return o},h0:function(){return a},jd:function(){return c}}),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.array.find-index.js"),n("../node_modules/core-js/modules/es.object.assign.js");var s=n("../node_modules/i18next/dist/esm/i18next.js"),i=n("../packages/model/src/sheet/SheetType.ts"),r=n("../packages/model/src/sheet/sheetUtils.ts");function o(e){for(var t=Math.random().toString(36).substr(2,6),n=!1;!n;)e&&e.indexOf(t)>-1?t=Math.random().toString(36).substr(2,6):n=!0;return t}function a(e,t){void 0===t&&(t=i.ZP.GRID);var n=i.BG[t],s=[];return e.forEach((function(e){if(e.indexOf(n)>-1){var t=parseInt(e.substring(n.length));isNaN(t)||s.push(t)}})),s.length||s.push(0),""+(n+(Math.max.apply(null,s)+1))}function c(e,t){var n=new RegExp(s.ZP.t("(.*)\\(副本(\\d*)\\)")),i=0,r="";if(n.test(t)){var o=t.match(n);o&&(r=o[1])}else r=t;return e.forEach((function(e){var t=e.match(n);if(t&&r===t[1]){var s=t[2];if(s){var o=Number(s);o>=i&&(i=o+1)}else i=i||1}})),i?s.ZP.t("{{sheetName}}(副本{{lastIndex}})",{sheetName:r,lastIndex:i}):s.ZP.t("{{name}}(副本)",{name:t})}function h(e,t,n){if(1===t.length){var s=(0,r.formatRegStr)(n),i=RegExp("^"+s+"(?:（(\\d+)）)?$"),o=-1;return e.forEach((function(e){i.test(e)&&(o=Math.max(o,Number(RegExp.$1)))})),[(0,r.removeStartOrEndWithSingleQuotes)(n+(-1!==o?"（"+(o+1)+"）":""))]}var a={},c=t.map((function(e){var t=0|a[e];return a[e]=t+1,e+(t>0?"（"+t+"）":"")})),h=-1;c.forEach((function(t){var n=(0,r.formatRegStr)(t),s=RegExp("^"+n+"(?:（(\\d+)）)?$");e.forEach((function(e){s.test(e)&&(h=Math.max(h,Number(RegExp.$1)))}))}));var l=-1!==h?"（"+(h+1)+"）":"";return c.map((function(e){return(0,r.removeStartOrEndWithSingleQuotes)(""+e+l)}))}},"../spread-sheet/src/external/view/main/footer/logic/sheetOperationLogic.ts":function(e,t,n){n.d(t,{X:function(){return l}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js");var s=n("../spread-sheet/src/base/index.ts"),i=n("../spread-sheet/src/external/view/main/footer/commands/constants.ts"),r=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),o=n.n(r),a=n("../packages/model/src/sheet/SheetType.ts"),c=n("../spread-sheet/src/external/view/main/footer/utils/report.ts"),h=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},l=function(){function e(e,t){var n=this;this.onRename=function(e,t){return h(n,void 0,void 0,regeneratorRuntime.mark((function n(){var s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.commandService.executeCommand(i.Z.SHEET_BAR_RENAME_SHEET,{sheetId:e,sheetName:t});case 2:(null===(s=this.app.spreadsheet.sheetManager.getSheetBySheetId(e))||void 0===s?void 0:s.getSheetType())===a.ZP.SMART_SHEET?(0,c.cC)(c.VC.RENAME_SMART_SHEET):(0,c.Fs)(c.Si.RENAME_SHEET);case 4:case"end":return n.stop()}}),n,this)})))},this.onWheel=function(e,t,n,s){if(e.preventDefault(),(e.deltaY||e.deltaX)&&!(t-n>0)){var i=o().isFirefox?20:1,r=Math.max(t-n,Math.min(0,s-e.deltaY*i)),a=Math.max(t-n,Math.min(0,s-e.deltaX*i));return Math.abs(e.deltaY)>Math.abs(e.deltaX)?r:a}},this.onAddSheet=function(e){return h(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,s,r,o,h,l,d,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e.sheetName,r=e.sheetType,o=e.sheetIndex,h=e.tableJSON,l=e.mutations,!this.toPreventSheetAction()){t.next=3;break}return t.abrupt("return");case 3:return d=this.app.spreadsheet.activeSheet.getIndex(),t.next=6,null===(n=this.commandService)||void 0===n?void 0:n.executeCommand(i.Z.SHEET_BAR_ADD_SHEET,{sheetIndex:o||d+1,sheetName:s,sheetType:r,tableJSON:h,mutations:l});case 6:return u=t.sent,r===a.ZP.SMART_SHEET?l?(0,c.cC)(c.VC.NEW_SMART_SHEET_TEMPLATE):(0,c.cC)(c.VC.NEW_SMART_SHEET_BLANK):(0,c.Fs)(c.Si.NEW_SHEET_BLANK),t.abrupt("return",u);case 9:case"end":return t.stop()}}),t,this)})))},this.onDeleteSheet=function(e){return h(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.toPreventSheetAction()){t.next=2;break}return t.abrupt("return");case 2:return s=null===(n=this.app.spreadsheet.sheetManager.getSheetBySheetId(e))||void 0===n?void 0:n.getSheetType(),t.next=5,this.commandService.executeCommand(i.Z.SHEET_BAR_DELETE_SHEET,{sheetId:e});case 5:s===a.ZP.SMART_SHEET?(0,c.cC)(c.VC.DEL_SMART_SHEET):(0,c.Fs)(c.Si.DEL_SHEET);case 6:case"end":return t.stop()}}),t,this)})))},this.onCopySheet=function(e){return h(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,s,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.toPreventSheetAction()){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,null===(n=this.commandService)||void 0===n?void 0:n.executeCommand(i.Z.SHEET_BAR_COPY_SHEET,{sheetId:e});case 4:return r=t.sent,(null===(s=this.app.spreadsheet.sheetManager.getSheetBySheetId(e))||void 0===s?void 0:s.getSheetType())===a.ZP.SMART_SHEET?(0,c.cC)(c.VC.COPY_SMART_SHEET):(0,c.Fs)(c.Si.COPY_SHEET),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)})))},this.onHideSheet=function(e){return h(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,s,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.toPreventSheetAction()){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,null===(n=this.commandService)||void 0===n?void 0:n.executeCommand(i.Z.SHEET_BAR_HIDE_SHEET,{sheetId:e});case 4:return r=t.sent,(null===(s=this.app.spreadsheet.sheetManager.getSheetBySheetId(e))||void 0===s?void 0:s.getSheetType())===a.ZP.SMART_SHEET?(0,c.cC)(c.VC.HIDE_SMART_SHEET):(0,c.Fs)(c.Si.HIDE_SHEET),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)})))},this.onShowSheet=function(e){return h(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.toPreventSheetAction()){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,null===(n=this.commandService)||void 0===n?void 0:n.executeCommand(i.Z.SHEET_BAR_SHOW_SHEET,{sheetId:e});case 4:(0,c.Fs)(c.Si.SHOW_SHEET);case 5:case"end":return t.stop()}}),t,this)})))},this.toPreventSheetAction=function(){var e,t;return!(!(null===(e=n.app.view.plugins.rangeSelectionPanel)||void 0===e?void 0:e.onSelecting)||(null===(t=n.app.view.plugins.rangeSelectionPanel)||void 0===t?void 0:t.enableSheetAction))},this.app=e,this.commandService=t}var t=e.prototype;return t.registerSheetOperationListeners=function(e){this.sheetOperationHandle=e;var t=s.Z.event.sheetsBar;return t.listen("renameDone",e.onRename),t.listen("addSheet",e.onAddSheet),t.listen("deleteSheet",e.onDeleteSheet),t.listen("copySheet",e.onCopySheet),t.listen("hideSheet",e.onHideSheet),t.listen("showSheet",e.onShowSheet),this},t.dispose=function(){var e=s.Z.event.sheetsBar;e.remove("renameDone",this.sheetOperationHandle.onRename),e.remove("addSheet",this.sheetOperationHandle.onAddSheet),e.remove("deleteSheet",this.sheetOperationHandle.onDeleteSheet),e.remove("copySheet",this.sheetOperationHandle.onCopySheet),e.remove("hideSheet",this.sheetOperationHandle.onHideSheet),e.remove("showSheet",this.sheetOperationHandle.onShowSheet)},e}()},"../spread-sheet/src/external/view/main/footer/media/sheet-icon.ts":function(e,t,n){var s,i=n("../packages/model/src/sheet/SheetType.ts"),r=n("../node_modules/@tencent/docs-design-resources/pc/svg/file_menu_x_24.svg"),o=n("../node_modules/@tencent/docs-design-resources/pc/svg/file_menu_sheet_24.svg"),a=((s={})[i.ZP.GRID]=o,s[i.ZP.SMART_SHEET]=r,s);t.Z=a},"../spread-sheet/src/external/view/main/footer/sheetsbar/baseController.ts":function(e,t,n){n.d(t,{Z:function(){return x}});var s=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=(n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../spread-sheet/src/base/index.ts")),o=n("../packages/report/src/index.ts"),a=n("../spread-sheet/src/external/view/main/footer/browser/utils.ts"),c=n("../packages/mutation/src/MutationId.ts"),h=(n("../node_modules/core-js/modules/es.function.name.js"),n("../spread-sheet/src/base/util/object.ts")),l=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),d=n.n(l),u=n("../spread-sheet/src/core/utils/relate/relate.ts"),p=document.createElement("canvas"),f=p.getContext("2d");function m(e,t){var n=0,s=0,i=[];return e.forEach((function(e,t){i[t]=(0,h.clone)(e)})),i.forEach((function(e){var i,r,o=e.name,a=e.id,c=function(e){if(S[e])return S[e];var t=function(e){var t=f.measureText(e).width;return Math.ceil(t)}(e)+2;return S[e]=t,t}(o),h=void 0!==t.sheetStatus.sheetsStatus.getSheetStatus(a);e.setAuthLock=h;var l=null!==(r=null===(i=t.sheetStatus.sheetsStatus.getSheetStatus(a))||void 0===i?void 0:i.canEdit)&&void 0!==r&&r;e.lockOpen=l;var p=(0,u.tZ)(t.feature,e.id);e.relatedType=p;var m=t.spreadsheet.isExternalSheet(e.id),v=!(!p&&!m),g=function(e,t){if(t.hidden)return 0;var n=t.isSetAuthLock,s=t.hasSheetIcon,i=0;return d().isMobilePhone||d().isAndroidPad?i=100:(i=e+51,s&&(i+=32)),n&&(i+=s?10:24),i}(c,{hidden:e.hidden,isSetAuthLock:h,hasSheetIcon:v}),w=n;!d().isMobilePhone&&!d().isAndroidPad&&!d().isIPad&&g>0&&(n+=g-1),e.hidden?s+=g:s+=g-1,e.inputWidth=c,e.width=g,e.left=w})),{contentWidth:s+=1,sheets:i}}f.font="400 14px Microsoft YaHei,Verdana,sans-serif";var S={};n("../node_modules/core-js/modules/es.number.constructor.js");var v=n("../node_modules/@tencent/containerized/build/main/index.js"),g=n("../spread-sheet/src/external/view/main/footer/commands/constants.ts"),w=n("../spread-sheet/src/core/utils/offline-env.ts"),E=n("../spread-sheet/src/external/view/pc/footer/footerComponent/redux/store.ts"),_=n("../spread-sheet/src/external/view/pc/footer/footerComponent/redux/interface.ts"),b=function(e){return{type:_.o.UPDATE_WIDTH,payload:e}},I=n("../spread-sheet/src/base/event/event.ts"),T=function(e){function t(t,n,i,r,o,c,h,l,d){var u;return(u=e.call(this)||this).onUpdateSpreadsheet=function(){u.footerEvent.triggerRefreshUI()},u.getActiveSheetPosition=function(e){return function(e,t,n,s,i){var r,o=i||t;return e.forEach((function(e){e.id===o&&(r=e)})),function(){for(var t=0;t<e.length;t++){var i=e[t];if(i.id===o){if(n-r.left>s){if(t>=1){var a=e[t-1];return a.left+Number(a.width)/2}return i.left}return n<=s?0:n-s}}}()}(u.innerSheets,u.activeSheetId,u.contentWidth,u.wrapWidth,e)},u.setUIRef=function(e){u.elementRef=e},u.updateProps=function(e){u.checkScrollMove(e),u.componentDidUpdate(e),Object.keys(e).forEach((function(t){u[""+t]=e[""+t]})),u.updateUI(e),e.innerSheets&&u.updateInnerSheetProps(),u.handleReceiveProps()},u.checkScrollMove=function(e){if(void 0!==e.wrapWidth){var t=u.contentWidth-e.wrapWidth;Math.abs(u.scrollDistance)>t&&u.setScrollMove(-(t<0?0:t))}},u.handleReceiveProps=function(){},u.componentDidUpdate=function(e){var t=u.activeSheetId;e.innerSheets&&(u.innerSheets.length>e.innerSheets.length&&t&&u.focusActiveSheet(u.innerSheets,t,"add"),u.innerSheets.length<e.innerSheets.length&&t&&u.focusActiveSheet(u.innerSheets,t,"del"))},u.toPreventSheetAction=function(){var e,t;return!(!(null===(e=u.app.view.plugins.rangeSelectionPanel)||void 0===e?void 0:e.onSelecting)||(null===(t=u.app.view.plugins.rangeSelectionPanel)||void 0===t?void 0:t.enableSheetAction))},u.toPreventSwitchSheetAction=function(e){var t,n,s=u.app.spreadsheet.isExternalSheet(e);return!(!(null===(t=u.app.view.plugins.rangeSelectionPanel)||void 0===t?void 0:t.onSelecting)||!s)||!(!(null===(n=u.app.view.canvas.inputManager)||void 0===n?void 0:n.isFormula)||!s)},u.app=t,u.context=h||(0,s.Z)(u),u.disabled=!1,u.container=n,u.innerSheets=i,u.activeSheetId=r||"",u.hidden=!1,u.fadeOut=!1,u.wrapWidth=o,u.loading=!1,u.contentWidth=0,u.scrollDistance=0,u.switchSheetId="",u.moveIndex=(0,a.s_)(u.innerSheets,"id",u.activeSheetId),u.commandService=c,u.componentConfig=l,u.footerEvent=d,u.onSwitchSheet=u.onSwitchSheet.bind((0,s.Z)(u)),u.onSwitchSheetEnd=u.onSwitchSheetEnd.bind((0,s.Z)(u)),u.onRefresh=u.onRefresh.bind((0,s.Z)(u)),u.onStatusChange=u.onStatusChange.bind((0,s.Z)(u)),u.onUpdateSpreadsheet=u.onUpdateSpreadsheet.bind((0,s.Z)(u)),u.onDisableSheet=u.onDisableSheet.bind((0,s.Z)(u)),u.onEnableSheet=u.onEnableSheet.bind((0,s.Z)(u)),u.onHideSheetBar=u.onHideSheetBar.bind((0,s.Z)(u)),u.onShowSheetsBar=u.onShowSheetsBar.bind((0,s.Z)(u)),u.onHideFooter=u.onHideFooter.bind((0,s.Z)(u)),u.onShowFooter=u.onShowFooter.bind((0,s.Z)(u)),u.onUpSheetDom=u.onUpSheetDom.bind((0,s.Z)(u)),u.handleWorkbookRangeChange=u.handleWorkbookRangeChange.bind((0,s.Z)(u)),u.registerListeners=u.registerListeners.bind((0,s.Z)(u)),u.setScrollMove=u.setScrollMove.bind((0,s.Z)(u)),u}(0,i.Z)(t,e);var h=t.prototype;return h.componentDidMount=function(){this.cacluateSheetProperty(),this.registerListeners(),this.netWorkChange(),this.checkInitScrollPosition(),this.app.viewManager.resize()},h.cacluateSheetProperty=function(){var e=m(this.innerSheets,this.app),t=e.contentWidth,n=e.sheets;this.innerSheets=n,this.contentWidth=t,this.updateUI({innerSheets:this.innerSheets,contentWidth:this.contentWidth}),E.Z.dispatch(b({contentWidth:t}))},h.updateInnerSheetProps=function(){this.cacluateSheetProperty()},h.registerListeners=function(){if(this.app){var e=r.Z.event.sheetsBar;e.listen("switchSheet",this.onSwitchSheet),e.listen("switchSheetEnd",this.onSwitchSheetEnd),e.listen("refresh",this.onRefresh),e.listen("bindStatusChange",this.onStatusChange),r.Z.event.default.listen("update-spread-sheet",this.onUpdateSpreadsheet),e.listen("disableSheet",this.onDisableSheet),e.listen("enableSheet",this.onEnableSheet),e.listen("hideSheetsBar",this.onHideSheetBar),e.listen("showSheetsBar",this.onShowSheetsBar),e.listen("updataSheetDom",this.onUpSheetDom),this.app.mutationBehavior.emitter.addListener(this.app.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.handleWorkbookRangeChange)}},h.dispose=function(){e.prototype.dispose.call(this);var t=r.Z.event.sheetsBar;t.remove("switchSheet",this.onSwitchSheet),t.remove("switchSheetEnd",this.onSwitchSheetEnd),t.remove("refresh",this.onRefresh),t.remove("bindStatusChange",this.onStatusChange),r.Z.event.default.remove("update-spread-sheet",this.onUpdateSpreadsheet),t.remove("disableSheet",this.onDisableSheet),t.remove("enableSheet",this.onEnableSheet),t.remove("hideSheetsBar",this.onHideSheetBar),t.remove("showSheetsBar",this.onShowSheetsBar),t.remove("updataSheetDom",this.onUpSheetDom),this.app.mutationBehavior.emitter.off(this.app.mutationBehavior.EVENT.AFTER_MUTATION_RUN,this.handleWorkbookRangeChange.bind(this))},h.handleWorkbookRangeChange=function(e){switch(e.mutation.id){case c.ZP.DEFINE_WORKBOOK_RANGE_MUTATION:case c.ZP.DELETE_WORKBOOK_RANGE_MUTATION:this.updateInnerSheetProps.bind(this)}},h.onRefresh=function(){this.footerEvent.triggerRefreshUI()},h.onStatusChange=function(){var e=m(this.innerSheets,this.app),t=e.contentWidth,n=e.sheets;this.contentWidth=t,this.innerSheets=n,this.updateUI({contentWidth:t,innerSheets:n})},h.onSwitchSheetEnd=function(){this.toggleLoadingStatus(!1)},h.checkInitScrollPosition=function(){var e=this.getActiveSheetPosition();this.setScrollMove(-e)},h.netWorkChange=function(){var e=this;this.app.sheetStatus.change((function(){e.disabled=!e.app.sheetStatus.workbookStatus.isOnline&&!(0,w.j)(),e.updateUI({disabled:e.disabled})}))},h.onDisableSheet=function(){this.disabled=!0,this.updateUI({disabled:!0})},h.onEnableSheet=function(){this.disabled=!1,this.updateUI({disabled:!1})},h.onHideSheetBar=function(){this.hidden=!0,this.updateUI({hidden:!0})},h.onHideFooter=function(){this.fadeOut=!0,this.updateUI({fadeOut:!0}),this.app.viewManager.resize()},h.onShowFooter=function(){this.fadeOut=!1,this.updateUI({fadeOut:!1}),this.app.viewManager.resize()},h.onShowSheetsBar=function(){this.hidden=!1,this.updateUI({hidden:!1})},h.toggleLoadingStatus=function(e,t){this.loading=e,this.relatedType=t,this.updateUI({loading:e,relatedType:t})},h.onSwitchSheet=function(e,t,s){var i,a,c,h;void 0===s&&(s={});var l=(new Date).getTime(),d=r.Z.event.sheetsBar,p=s,f=p.switchBackToHide,m=p.isRefresh,S=p.onSuccess,v=p.onFail,g=p.source;if(!this.toPreventSheetAction()&&!this.toPreventSwitchSheetAction(e)){this.switchSheetId=e,d.trigger("switchSheetStart");var w=(0,u.tZ)(this.app.feature,e);this.toggleLoadingStatus(!s.hideLoading,w),null===(i=n.g.log)||void 0===i||i.info("点击切表, sheetId = "+e+", preSheetId = "+t+", options = "+s),this.handleSwitchSheet(e,t,f,g).then((function(){var i;null===S||void 0===S||S.call(void 0),d.trigger("switchSheetEnd",e),null===(i=n.g.log)||void 0===i||i.info("切表完成, sheetId = "+e+", preSheetId = "+t+", options = "+s),o.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_sheet",action:"switch_sheet_time",ver5:(new Date).getTime()-l,ver11:e})})).catch((function(i){var r;null===v||void 0===v||v.call(void 0),null===(r=n.g.log)||void 0===r||r.error("切表失败, sheetId = "+e+", preSheetId = "+t+", options = "+s,i)})),this.moveIndex=this.getSheetIndex(e),m||(this.app.spreadsheet.activeSheetId=e,this.footerEvent.triggerRefreshUI()),(null===(c=null===(a=this.app.feature)||void 0===a?void 0:a.relateForm)||void 0===c?void 0:c.isOpenDialog())&&(null===(h=this.app.feature)||void 0===h||h.relateForm.hideSelectQuestionDialog())}},h.onUpSheetDom=function(e,t){for(var n=0;n<this.innerSheets.length;n++)this.innerSheets[n].id===e&&(this.innerSheets[n].dom=t)},h.getSheetIndex=function(e){for(var t=0;t<this.innerSheets.length;t++)if(this.innerSheets[t].id===e)return t;return this.moveIndex},h.triggerSetSheetInitializedForAddSheet=function(e){I.ZP.default.trigger("setSheetInitializedForSwitchSheet",{sheetId:e})},h.focusActiveSheet=function(e,t,n){var s=function(e,t){for(var n=0,s=0,i=0,r=0,o=0;o<e.length;o++){var a=e[o];a.id!==t?s?i+=Number(a.width):n+=Number(a.width):(s=Number(a.width),r=a.left)}return{leftWidth:n,rightWidth:i,currSheetWidth:s,activeSheetLeft:r}}(e,t),i=s.leftWidth,r=s.rightWidth,o=s.currSheetWidth,a=s.activeSheetLeft,c=this.wrapWidth,h=this.scrollDistance,l=i<=Math.abs(h),d=i-Math.abs(h)+o>=c;if("add"===n)return this.focusActiveSheetAdd(i,r,o,l,d);if("del"===n)return this.focusActiveSheetDel(i,r,o,l);if(l)return this.setScrollMove(-a);if(d){var u=i-this.wrapWidth+o;return this.setScrollMove(-u)}},h.setScrollMove=function(e){var t=r.Z.event.sheetsBar;this.scrollDistance=e,t.trigger("scroll",e),this.updateUI({scrollDistance:e})},h.updateIndex=function(e){},h.handleSwitchSheet=function(e,t,n,s){var i=this;return new Promise((function(r,o){var a;null===(a=i.commandService)||void 0===a||a.executeCommand(g.Z.SHEET_BAR_SWITCH_SHEET,{sheetId:e,preSheetId:t,source:s}).then((function(){i.focusActiveSheet(i.innerSheets,e),i.footerEvent.triggerUpdateStatistics(!0),r()})).catch((function(r){console.error(r);var a=i.app.spreadsheet.sheetManager.getSheetBySheetId(t);(null===a||void 0===a?void 0:a.isLoaded)&&(i.switchSheetId=t,i.handleSwitchSheet(t,e,n,s).then((function(){i.toggleLoadingStatus(!1),i.footerEvent.triggerRefreshUI(),o()})))}))}))},h.focusActiveSheetAdd=function(e,t,n,s,i){var o=r.Z.event.sheetsBar;if(void 0!==e&&n+t>this.wrapWidth){if(s)this.setScrollMove(-e);else if(i){var a=e-this.wrapWidth+n;this.setScrollMove(-a)}}else o.trigger("changeScrollRight",n)},h.focusActiveSheetDel=function(e,t,n,s){var i=r.Z.event.sheetsBar;n+t<this.wrapWidth&&n+e+t>this.wrapWidth?i.trigger("changeScrollRight",n):s&&this.setScrollMove(-e)},t}(v.JT),x=T},"../spread-sheet/src/external/view/main/footer/utils/report.ts":function(e,t,n){n.d(t,{BK:function(){return p},FT:function(){return l},F_:function(){return r},Fs:function(){return m},Ii:function(){return d},Pw:function(){return g},Si:function(){return s},Te:function(){return f},VC:function(){return i},Wd:function(){return v},cC:function(){return S},dY:function(){return u}});var s,i,r,o=n("../packages/report/src/index.ts"),a=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),c=n("../node_modules/i18next/dist/esm/i18next.js"),h=!1;function l(e){if(!h){h=!0;var t=(new Date).getTime()-e;o.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_sheet",action:"sheetsbar_render_cost",ver1:t})}}function d(){o.ZP.tdwReport({module:"edit_sheet",opername:"doc_sheet",action:"cannot_move"})}function u(){o.ZP.tdwReport({module:"edit_sheet",opername:"doc_sheet",action:"cannot_menu"})}function p(){o.ZP.tdwReport({module:"edit_sheet",opername:"doc_sheet",action:"cannot_new",eventcode:"doc_sheet-edit_sheet-cannot_new"})}function f(){a.default.show({message:c.ZP.t("暂无权限新增、移动、重命名工作表"),type:"info",duration:3e3})}function m(e){o.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_sheet",action:e})}function S(e){o.ZP.tdwReport({opername:"doc_smartsheet_editor",module:"excel_smartsheet",action:e})}function v(){o.ZP.tdwReport({opername:"doc_template_web",module:"create_new_sheet",action:"choose_pop_upv"})}function g(e){o.ZP.tdwReport({opername:"doc_template_web",module:"create_new_sheet",action:"choose_pop_clk",ver11:e})}!function(e){e.NEW_SHEET_BLANK="new_sheet",e.DEL_SHEET="del_sheet",e.RENAME_SHEET="rn_sheet_suc",e.COPY_SHEET="copy_sheet",e.SHOW_SHEET="show_sheet",e.HIDE_SHEET="hide_sheet"}(s||(s={})),function(e){e.NEW_SMART_SHEET_BLANK="new_smartsheet_blank",e.NEW_SMART_SHEET_TEMPLATE="new_smartsheet_template",e.DEL_SMART_SHEET="del_smartsheet",e.RENAME_SMART_SHEET="rename_smartsheet",e.COPY_SMART_SHEET="copy_smartsheet",e.HIDE_SMART_SHEET="hide_smartsheet",e.NEW_SMART_SHEET_BLANK_TIP="new_smartsheet_blank_tip"}(i||(i={})),function(e){e[e.ADD_NORMAL_SHEET=1]="ADD_NORMAL_SHEET",e[e.ADD_SMART_SHEET=2]="ADD_SMART_SHEET",e[e.ADD_SHEETS_FROM_TEMPLATE=3]="ADD_SHEETS_FROM_TEMPLATE"}(r||(r={}))},"../spread-sheet/src/external/view/main/footer/view/view.interface.ts":function(e,t,n){n.d(t,{_:function(){return r}}),n("../node_modules/core-js/modules/es.object.assign.js");var s=n("../node_modules/@tencent/containerized/build/main/index.js"),i=n("react-dom"),r=function(){function e(){var e=this;this.setUIRef=function(t){null!==t&&(e.component=t)},(0,s.wi)(this)}var t=e.prototype;return t.dispose=function(){i.unmountComponentAtNode(this.container),this.component=null,(0,s.jz)(this)},t.setState=function(e){var t;null===(t=this.component)||void 0===t||t.setState(Object.assign({},e))},e}()},"../spread-sheet/src/external/view/pc/footer/components/input/input.readonly.tsx":function(e,t,n){n.d(t,{Z:function(){return r}});var s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),i=n("react"),r=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={isActived:!1,val:String(t.val)},n}(0,s.Z)(t,e);var n=t.prototype;return n.componentWillReceiveProps=function(e){this.state.isActived||(this.state.val=e.val)},n.render=function(){return i.createElement("span",{className:"sheet-tab-name",style:{width:this.props.inputWidth},onDoubleClick:this.props.onDoubleClick},this.props.val)},t}(i.Component)},"../spread-sheet/src/external/view/pc/footer/components/loading/Loading.tsx":function(e,t,n){n.d(t,{Z:function(){return c}});var s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),i=n("../node_modules/i18next/dist/esm/i18next.js"),r=n("react"),o=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),a=n("../spread-sheet/src/core/utils/relate/RelateType.ts"),c=function(e){function t(){return e.apply(this,arguments)||this}return(0,s.Z)(t,e),t.prototype.render=function(){return r.createElement(r.Fragment,null,r.createElement(o.default,{className:"pc-switch-sheet-loading "+(this.props.isLoading?"":"hidden"),type:"loading",visible:this.props.isLoading,containerDom:this.props.container||document.body},this.props.relatedType===a.Z.FORM?i.ZP.t("正在同步收集结果…"):i.ZP.t("正在同步内容...")))},t}(r.Component)},"../spread-sheet/src/external/view/pc/footer/components/scroll/scroll.tsx":function(e,t,n){n.d(t,{Z:function(){return h}});var s=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=n("react-dom"),o=n("react"),a=n("../spread-sheet/src/base/index.ts"),c=n("../node_modules/i18next/dist/esm/i18next.js"),h=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={start:0,show:!1,wrapWidth:t.wrapWidth,contentWidth:t.contentWidth,innerSheet:t.innerSheet,activeSheetId:t.activeSheetId},n.checkDisplay(n.state),n.timer=null,n.goLeft=n.goLeft.bind((0,s.Z)(n)),n.goRight=n.goRight.bind((0,s.Z)(n)),n.goLeftStart=n.goLeftStart.bind((0,s.Z)(n)),n.goRightEnd=n.goRightEnd.bind((0,s.Z)(n)),n.handleSetScroll=n.handleSetScroll.bind((0,s.Z)(n)),n}(0,i.Z)(t,e);var n=t.prototype;return n.checkDisplay=function(e){e.contentWidth>e.wrapWidth&&e.wrapWidth>0&&e.innerSheet.length>1?this.state.show=!0:this.state.show=!1},n.componentDidMount=function(){var e=r.findDOMNode(this).parentNode;this.contentdom=e.querySelector(".sheetContent");var t=a.Z.event.sheetsBar;t.listen("changeScrollRight",this.goRightEnd),t.listen("changeScrollLeft",this.goLeftByReduce),this.state.start=this.props.startLeft(),t.listen("scroll",this.handleSetScroll)},n.handleSetScroll=function(e){this.setState({start:Math.abs(e)})},n.componentWillUnmount=function(){var e=a.Z.event.sheetsBar;e.remove("changeScrollRight",this.goRightEnd),e.remove("changeScrollLeft",this.goLeftByReduce),e.remove("scroll",this.handleSetScroll)},n.componentWillReceiveProps=function(e){this.state.wrapWidth=e.wrapWidth,this.state.contentWidth=e.contentWidth,this.state.innerSheet=e.innerSheet,this.state.activeSheetId=e.activeSheetId,this.checkDisplay(this.state)},n.animate=function(){var e,t;null===(t=(e=this.props).scrollCallback)||void 0===t||t.call(e,-this.state.start)},n.isEnd=function(e){return this.state.start<=0&&-1===e||this.state.start+this.state.wrapWidth>this.state.contentWidth&&1===e},n.goLeftByReduce=function(e){this.state.start=Math.max(this.state.start-e,0),this.animate()},n.goLeft=function(){if(a.Z.util.timer.erase(this.timer),!this.isEnd(-1)){var e=Math.min(this.state.start,this.state.wrapWidth);this.state.start=this.state.start-e,this.animate()}},n.goRight=function(){if(a.Z.util.timer.erase(this.timer),!this.isEnd(1)){var e=Math.min(this.state.contentWidth-this.state.wrapWidth-this.state.start,this.state.wrapWidth);this.state.start=this.state.start+e,this.animate()}},n.goRightEnd=function(){var e=this;this.timer=a.Z.util.timer.wait(500).run((function(){var t=Math.max(e.state.contentWidth-e.state.wrapWidth,0);e.state.start=t,e.animate()}))},n.goLeftStart=function(){var e=this;this.timer=a.Z.util.timer.wait(500).run((function(){e.state.start=0,e.animate()}))},n.render=function(){return o.createElement("div",{className:"sheetscroll",style:{display:this.state.show?"block":"none"}},o.createElement("div",{onMouseDown:this.goLeftStart,onMouseUp:this.goLeft,className:"sheetscrollleft","data-tooltip":c.ZP.t("向左滑动工作表")},o.createElement("div",{className:"sheetscrollleft-icon"})),o.createElement("div",{onMouseDown:this.goRightEnd,onMouseUp:this.goRight,className:"sheetscrollright","data-tooltip":c.ZP.t("向右滑动工作表")},o.createElement("div",{className:"sheetscrollright-icon"})))},t}(o.Component)},"../spread-sheet/src/external/view/pc/footer/components/sheetListBox/sheetListBox.tsx":function(e,t,n){n.d(t,{Z:function(){return I}});var s=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),i=n("../node_modules/i18next/dist/esm/i18next.js"),r=n("react"),o=n("../spread-sheet/src/base/event/event.ts"),a=n("../spread-sheet/src/base/util/timer.ts"),c=n("../node_modules/@tencent/dui/lib/components/Dropdown/index.js"),h=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/@tencent/dui/lib/components/Menu/index.js")),l=n("../node_modules/@tencent/dui/lib/components/Tooltip/index.js"),d=n("../spread-sheet/src/base/index.ts"),u=n("../spread-sheet/src/external/rangeAuth/util/util.ts"),p=n("../spread-sheet/src/external/rangeAuth/loader/RangeAuthManager.ts"),f=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),m=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};function S(e,t){return m(this,void 0,void 0,regeneratorRuntime.mark((function n(){var s,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=!0,!(0,u.isSheetRangeSetAuth)(e)||t){n.next=6;break}return n.next=4,p.d.instance.isSheetRangeCanEdit(e).catch((function(e){console.error(e)}));case 4:i=n.sent,s=!!i;case 6:return n.abrupt("return",s);case 7:case"end":return n.stop()}}),n)})))}function v(e,t){return m(this,void 0,void 0,regeneratorRuntime.mark((function n(){var s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(p.d.instance){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,S(e,t);case 4:if(s=n.sent,!t&&s){n.next=7;break}return n.abrupt("return",f.default.show({message:i.ZP.t("无取消隐藏权限"),type:"info",autoClose:!0,duration:3e3}));case 7:return f.default.show({message:i.ZP.t("已取消隐藏工作表"),type:"success",autoClose:!0,duration:3e3}),d.Z.event.sheetsBar.trigger("showSheet",e),n.abrupt("return",s);case 10:case"end":return n.stop()}}),n)})))}var g=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},w=function(e){function t(){return e.apply(this,arguments)||this}(0,s.Z)(t,e);var n=t.prototype;return n.showSheet=function(e){return g(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v(e,this.props.readonly);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},n.switchSheet=function(e){!function(e,t){d.Z.event.sheetsBar.trigger("switchSheet",e,t)}(e,this.props.activedId)},n.render=function(){var e=this,t=20;return 32*this.props.list.length>252&&(t-=10),r.createElement(h.default,{style:{minWidth:220,maxHeight:252,overflow:"auto"},className:"sheet-list-menu-parent"},this.props.list.map((function(n){var s=n.properties,o=s.title,a=s.hidden,c=n.getSheetId(),d=e.props.activedId===c,u=e.props.readonly?"sheet-list-menu-hidden-readonly":"";return a?r.createElement("div",{style:{width:"100%"}},r.createElement(l.default,{title:e.props.readonly?i.ZP.t("隐藏工作表"):i.ZP.t("取消隐藏"),placement:"right",trigger:"hover",offset:0},r.createElement(h.default.Item,{style:{paddingRight:26+t+"px"},className:u+" sheet-list-menu-hidden",onClick:e.showSheet.bind(e,c)},r.createElement("div",{style:{right:t+"px"},className:"sheet-list-menu-hidden-icon"}),o))):r.createElement(h.default.Item,{onClick:e.switchSheet.bind(e,c),selected:d},o)})))},t}(r.Component),E=n("../spread-sheet/src/base/event/eventName.ts"),_=new(function(){function e(){this.sheetListBoxShow=!1}var t=e.prototype;return t.setSheetListBoxShow=function(e){this.sheetListBoxShow=e,o.ZP.default.trigger(e?E.W1.UI_SHOW:E.W1.UI_HIDE,E.Xs.SHEET_LIST_BOX)},t.getSheetListBoxShow=function(){return this.sheetListBoxShow},e}()),b=n("../spread-sheet/src/core/view/level-2/collab-center-ent/utils.ts"),I=function(e){function t(t){var n;return(n=e.call(this,t)||this).destroy=function(){n.handleVisibleChange(!1)},n.bindListener=function(){o.ZP.default.listen("hideHistoryList",n.hideIcon),o.ZP.default.listen("showHistoryList",n.showIcon),o.ZP.sheetsBar.listen("listenHideSheetEvent",n.handleHideSheetEvent),o.ZP.sheetsBar.listen("listenDelSheetEvent",n.handleDelSheetEvent),o.ZP.sheetsBar.listen("hideSheet",n.handleHideSheet)},n.hideIcon=function(){n.changeIconVisible(!1)},n.showIcon=function(){n.changeIconVisible(!0)},n.handleHideSheetEvent=function(e){var t=e.sheetId;e.isCollab?t===n.props.app.spreadsheet.activeSheetId&&n.showHidingPromptTip(i.ZP.t("当前工作表被其他{{COLLAB_NAME}}隐藏",{COLLAB_NAME:b.PJ})):localStorage.getItem("checkShowHideTipFlag")||(localStorage.setItem("checkShowHideTipFlag","true"),n.showHidingPromptTip(i.ZP.t("已隐藏工作表，可编辑文档的成员可以在这里查看此工作表")))},n.handleDelSheetEvent=function(){n.handleSheetSnackbar("info",i.ZP.t("当前工作表已被其他"+b.PJ+"删除"))},n.handleHideSheet=function(){n.handleSheetSnackbar("success",i.ZP.t("已隐藏工作表"))},n.changeIconVisible=function(e){n.setState({iconVisible:e})},n.handleSheetSnackbar=function(e,t){f.default.show({message:t||i.ZP.t("已隐藏工作表"),type:e||"success",autoClose:!0,duration:3e3})},n.showHidingPromptTip=function(e){n.setState({tooltipVisible:!0,tipString:e||""},(function(){!0===n.state.tooltipVisible&&a.Z.wait(5e3).run((function(){n.setState({tooltipVisible:!1})}))}))},n.switchSheetList=function(){n.setState({visible:!n.state.visible}),n.viewStatus.setSheetListBoxShow(n.state.visible)},n.handleVisibleChange=function(e){n.setState({visible:e}),n.viewStatus.setSheetListBoxShow(e)},n.state={visible:!1,tooltipVisible:!1,iconVisible:!0,tipString:"",list:[],activedId:""},n.viewStatus=_,n}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.bindListener(),this.props.app.emitter.on(this.props.app.EVENT.RESTART_END,this.bindListener),this.props.app.emitter.on(this.props.app.EVENT.START_DESTROY,this.destroy)},n.componentWillUnmount=function(){this.unbindListener(),this.handleVisibleChange(!1)},n.unbindListener=function(){o.ZP.default.remove("hideHistoryList",this.hideIcon),o.ZP.default.remove("showHistoryList",this.showIcon),o.ZP.sheetsBar.remove("listenHideSheetEvent",this.handleHideSheetEvent),o.ZP.sheetsBar.remove("listenDelSheetEvent",this.handleDelSheetEvent),o.ZP.sheetsBar.remove("hideSheet",this.handleHideSheet),this.props.app.emitter.off(this.props.app.EVENT.START_DESTROY,this.destroy),this.props.app.emitter.off(this.props.app.EVENT.RESTART_END,this.bindListener)},n.render=function(){var e=this.props.app.spreadsheet,t=this.props.sheetLength?"borderRightNone":"",n=e.sheetManager.sheetList,s=e.activeSheetId;return r.createElement("div",{className:"sheet-list-box-container",style:{marginLeft:this.props.readonly?"32px":""}},r.createElement("div",{className:"hiding-prompt-tip-pc",style:{display:this.state.tooltipVisible?"block":"none"}},r.createElement("div",{className:"hiding-prompt-tip-pc-content"},this.state.tipString),r.createElement("div",{className:"hiding-prompt-tip-pc-arrow"})),r.createElement(c.default,{placement:"top",visible:this.state.visible,onVisibleChange:this.handleVisibleChange,dropContent:r.createElement(w,{list:n,activedId:s,readonly:this.props.readonly})},r.createElement(l.default,{title:i.ZP.t("全部工作表"),placement:"top",disabled:this.state.visible},r.createElement("div",{style:{display:this.state.iconVisible?"":"none"},className:"sheetListBoxIcon "+t,onClick:this.switchSheetList}))))},t}(r.Component)},"../spread-sheet/src/external/view/pc/footer/components/sheetsList/sheetComponent.readonly.tsx":function(e,t,n){n.d(t,{Z:function(){return _}});var s,i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=(n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/i18next/dist/esm/i18next.js")),o=n("react"),a=n("../spread-sheet/src/base/index.ts"),c=n("../spread-sheet/src/external/view/pc/footer/components/input/input.readonly.tsx"),h=n("../node_modules/@tencent/dui/lib/components/Tooltip/index.js"),l=n("../node_modules/classnames/index.js"),d=n.n(l),u=n("../node_modules/lodash/clone.js"),p=n.n(u),f=n("../spread-sheet/src/core/utils/relate/RelateType.ts"),m=n("../node_modules/@tencent/docs-design-resources/pc/svg/file_menu_form_24.svg"),S=n("../node_modules/@tencent/docs-design-resources/pc/svg/file_menu_x_24.svg"),v=((s={})[f.Z.FORM]=m,s[f.Z.AIO]=S,s),g=n("../spread-sheet/src/external/view/main/footer/media/sheet-icon.ts"),w=n("../spread-sheet/src/external/view/main/footer/utils/report.ts"),E=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),_=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleClickOrWheelClick=function(e){n.isNotInInputState()&&n.props.mouseDownCallback(n.props.index,e.pageX),n.click(e)},n.click=function(e){e.preventDefault(),e.stopPropagation(),n.startX=e.pageX;var t=a.Z.event.sheetsBar;void 0!==n.props.activeSheetId&&void 0!==n.props.id&&n.props.activeSheetId!==n.props.id&&t.trigger("switchSheet",n.props.id,n.props.activeSheetId,{isMultiSelect:e.shiftKey})},n.isNotInInputState=function(){var e,t,s;return!(null===(s=null===(t=null===(e=n.props.app.view)||void 0===e?void 0:e.canvas)||void 0===t?void 0:t.inputManager)||void 0===s?void 0:s.isInputtingState())},n.sheetBox=o.createRef(),n.canEditTab=!!E.q.getConfig("privilegeAttribute").can_edit_tab,n}(0,i.Z)(t,e);var n=t.prototype;return n.mouseup=function(e){var t,n;e.pageX!==this.startX&&this.isNotInInputState()&&(null===(n=(t=this.props).mouseUpCallback)||void 0===n||n.call(t,e,this.props.index))},n.mousedown=function(e){var t,n,s=this;if(0===e.button||1===e.button)this.handleClickOrWheelClick(e);else{if(!this.isNotInInputState())return;var i=a.Z.event.sheetsBar;if(this.props.renameSheetId!==this.props.id){var r=p()(e);i.one("switchSheetEnd",(function(){var e,t;null===(t=(e=s.props).showMenu)||void 0===t||t.call(e,r)})),this.props.activeSheetId===this.props.id&&(this.canEditTab||((0,w.dY)(),(0,w.Te)()),null===(n=(t=this.props).showMenu)||void 0===n||n.call(t,e)),this.props.updateIndex(this.props.index),this.click(e)}}},n.contextMenu=function(e){e.preventDefault(),e.stopPropagation()},n.render=function(){var e=d()({"sheet-box":!0,sheet:!0,"sheet-tab-focus":this.props.activeSheetId===this.props.id,"sheet-tab-blur":this.props.activeSheetId!==this.props.id}),t=this.props.isMoving?10004:0,n=this.props,s=n.width,i=n.left;return o.createElement("div",{className:this.props.sheetCls||e,ref:this.sheetBox,style:{zIndex:t,left:i,width:s,display:this.props.hidden?"none":"flex"},"data-id":this.props.id,key:this.props.id,"aria-label":this.props.name,role:"button",tabIndex:4,onMouseUp:this.mouseup.bind(this),onContextMenu:this.contextMenu.bind(this),onMouseDown:this.mousedown.bind(this),onKeyPress:this.props.onKeyPress},this.getTooltip(),this.getSheetIcon(),this.props.children?this.props.children:o.createElement(c.Z,{val:this.props.name,inputWidth:this.props.inputWidth}))},n.getTooltip=function(){var e=this.props.lockOpen?"lock-open-icon":"lock-close-icon";return this.props.lock?o.createElement(h.default,{className:"lock-icon-tooltip",title:r.ZP.t("工作表已被保护"),placement:"top",trigger:"hover"},o.createElement("div",{className:"lock-icon "+e})):o.createElement(o.Fragment,null)},n.getSheetIcon=function(){var e=this.props,t=e.relatedType,n=e.id,s=e.app.spreadsheet.sheetManager.getSheetBySheetId(n);return t?o.createElement("div",{className:"sheet-icon",style:{backgroundImage:"url("+v[t]+")"}}):(null===s||void 0===s?void 0:s.isExternalSheet())?o.createElement("div",{className:"sheet-icon",style:{backgroundImage:"url("+g.Z[s.getSheetType()]+")"}}):void 0},t}(o.Component)},"../spread-sheet/src/external/view/pc/footer/footer.ts":function(e,t,n){n.r(t),n.d(t,{default:function(){return Dt}});var s=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),i=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),r=(n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/esnext.reflect.metadata.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../packages/mutation/src/MutationId.ts")),o=n("../spread-sheet/src/base/index.ts"),a=n("../packages/model/src/sheet/SheetPropertiesSlot.ts"),c=n("../spread-sheet/src/core/view/spreadsheet-view/area-data/AreaData.interface.ts"),h=function(){function e(e,t,n){var s=this;this.app=e,this.spreadsheet=t,this.restart=function(){s.initListeners()},this._handleAfterMutationRun=function(e){var t=e.mutation,n=e.isCollab;switch(t.id){case r.ZP.INSERT_SHEET_MUTATION:s.insertSheet();break;case r.ZP.DELETE_SHEET_MUTATION:s.deleteSheet(t,n);break;case r.ZP.MOVE_SHEET_MUTATION:s.moveSheet();break;case r.ZP.SET_SHEET_PROPERTIES_MUTATION:s.setSheetProperties(t,n);break;case r.ZP.DEFINE_WORKBOOK_RANGE_MUTATION:s.defineWorkBookRange();break;case r.ZP.DELETE_WORKBOOK_RANGE_MUTATION:s.deleteWorkBookRange()}},this.footerEvent=n,this.initListeners(),this.app.emitter.on(this.app.EVENT.RESTART_END,this.restart)}var t=e.prototype;return t.initListeners=function(){o.Z.event.spreadsheetEvent.listen("renderAfterMutationRun",this._handleAfterMutationRun)},t.insertSheet=function(){this.footerEvent.triggerRefreshUI()},t.deleteSheet=function(e,t){var n=this;if(this.footerEvent.triggerRefreshUI(),t&&e.sheetId===this.spreadsheet.activeSheetId){var s=e.sheetIndex,i=Math.max(s-1,0),r=this.app.spreadsheet.sheetManager.getSheetIdBySheetIndex(i);o.Z.util.timer.wait(0).run((function(){o.Z.event.sheetsBar.trigger("switchSheet",r,n.spreadsheet.sheetManager.sheetList[0],{source:c.oz.API})}))}},t.moveSheet=function(){this.footerEvent.triggerRefreshUI()},t.defineWorkBookRange=function(){this.footerEvent.triggerRefreshUI()},t.deleteWorkBookRange=function(){this.footerEvent.triggerRefreshUI()},t.setSheetProperties=function(e,t){var n=this;if(e.type);else if(e.sheetDelta)for(var s=function(s){var i=e.sheetDelta.deltas[s],r=void 0,h=e.sheetId;switch(i.slotName){case a.b.SLOT_NAME:n.footerEvent.triggerRefreshUI();break;case a.b.SLOT_HIDE:t&&i.value&&e.sheetId===n.spreadsheet.activeSheetId?(r=n.spreadsheet.sheetManager.getNextDisplayedSheetIdBySheetId(h),o.Z.util.timer.wait(0).run((function(){o.Z.event.sheetsBar.trigger("switchSheet",r,n.spreadsheet.activeSheetId,{source:c.oz.API})}))):n.footerEvent.triggerRefreshUI()}},i=0;i<e.sheetDelta.deltas.length;i++)s(i)},e}(),l=JSON.parse('{"name":"tocConfig","displayName":"腾讯文档footer","description":"配置footer","version":"1.0.0","publisher":"tencent","license":"MIT","contributes":{"pc":{"isShowSheetBar":"true","isShowAdd":"!inToastPreview && tocConfig.addSheetIcon","isShowSheetListBox":"!inToastPreview && tocConfig.sheetListBox","isShowScrollWrap":"tocConfig.sheetScrollWrap","isShowScroll":"true","isShowMenu":"true","isShowStatistics":"true","isShowFullScreenBar":"tocConfig.fullScreenBar","isShowScaleBar":"tocConfig.scaleBar"},"mobile":{"isShowSheetBar":"true","isShowAdd":"app.sheetStatus.workbookStatus.canEdit","isShowSheetListBox":"true","isShowScrollWrap":"true","isShowScroll":"true","isShowMenu":"true","isShowStatistics":"true","isShowFullScreenBar":"true","isShowScaleBar":"true"},"pad":{"isShowSheetBar":"true","isShowAdd":"app.sheetStatus.workbookStatus.canEdit","isShowSheetListBox":"true","isShowScrollWrap":"true","isShowScroll":"true","isShowMenu":"true","isShowStatistics":"true","isShowFullScreenBar":"true","isShowScaleBar":"true"}}}'),d=n("../packages/common-utils/src/index.ts"),u=n("../node_modules/@tencent/containerized/build/main/index.js"),p=n("../packages/lib/index.ts"),f=function(){function e(){this._onHideFooter=new p.Q5,this.onHideFooter=this._onHideFooter.event,this._onShowFooter=new p.Q5,this.onShowFooter=this._onShowFooter.event,this._onRefreshUI=new p.Q5,this.onRefreshUI=this._onRefreshUI.event,this._onUpdateStatistics=new p.Q5,this.onUpdateStatistics=this._onUpdateStatistics.event,this._onUpdateWrapWidth=new p.Q5,this.onUpdateWrapWidth=this._onUpdateWrapWidth.event}var t=e.prototype;return t.triggerHideFooterEvent=function(){this._onHideFooter.fire()},t.triggerShowFooterEvent=function(){this._onShowFooter.fire()},t.triggerRefreshUI=function(){this._onRefreshUI.fire()},t.triggerUpdateStatistics=function(e){void 0===e&&(e=!1),this._onUpdateStatistics.fire(e)},t.triggerUpdateWrapWidth=function(e){this._onUpdateWrapWidth.fire(e)},t.dispose=function(){this._onHideFooter.dispose(),this._onShowFooter.dispose(),this._onRefreshUI.dispose(),this._onUpdateStatistics.dispose(),this._onUpdateWrapWidth.dispose()},e}(),m=n("../spread-sheet/src/base/util/appConfig.ts"),S="footer-component-config",v=function(e){function t(t,n,s){var i;return(i=e.call(this)||this).contributes=s,i.footerStartTime=new Date,i.app=t,i.spreadsheet=n,i.footerEvent=new f,i.initDataCallView(),i.initComponentConfig(),i.initSheetsStatusListenEvent(),i}(0,i.Z)(t,e);var n=t.prototype;return n.initComponentConfig=function(){var e=this.getTocShowConfig();this.contributes.setContribute({name:S,json:l,context:{"tocConfig.addSheetIcon":e.addSheetIcon,"tocConfig.sheetListBox":e.sheetListBox,"tocConfig.sheetScrollWrap":e.sheetScrollWrap,"tocConfig.fullScreenBar":e.fullScreenBar,"tocConfig.scaleBar":e.scaleBar,inToastPreview:!!(0,d.IZ)("inToastPreview"),"app.sheetStatus.workbookStatus.canEdit":this.app.sheetStatus.workbookStatus.canEdit}}),this.footerComponentConfig=this.contributes.getContribute(S)},n.getTocShowConfig=function(){var e=!0,t=!0,n=!0,s=!0,i=!0,r=!0;return m.Z&&(e=!!m.Z.getConfig("statusbar"),t=!!m.Z.getConfig("statusbar.addSheetIcon"),n=!!m.Z.getConfig("statusbar.sheetScrollWrap"),s=!!m.Z.getConfig("statusbar.sheetListBox"),i=!!m.Z.getConfig("statusbar.fullScreenBar"),r=!!m.Z.getConfig("statusbar.scaleBar")),{sheetBar:e,addSheetIcon:t,sheetScrollWrap:n,sheetListBox:s,fullScreenBar:i,scaleBar:r}},n.initSheetsStatusListenEvent=function(){var e=this;this.app.sheetStatus.sheetsStatus.change((function(){e.refreshUI()}))},n.initDataCallView=function(){var e=this;this.app.event.default.listen("hideHistoryList",(function(){e.spreadsheet=e.app.spreadsheet})),this._dataCallView=new h(this.app,this.spreadsheet,this.footerEvent)},t}(u.JT);v.EVENT={hideFooter:"hideFooter",showFooter:"showFooter",refreshUI:"refreshUI",updateStatistics:"updateStatistics",Update_WRAP_WIDTH:"updateWrapWidth"};var g=v,w=n("../spread-sheet/src/core/app/SpreadsheetApp.interface.ts"),E=n("../packages/model/src/spreadsheet/Spreadsheet.interface.ts"),_=(0,u.yh)("ISheetsbarService"),b=(n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.concat.js"),(0,u.yh)("ISheetsbarLogic")),I=n("../spread-sheet/src/core/behavior/api.interface.ts"),T=n("../spread-sheet/src/external/view/main/footer/commands/constants.ts"),x=n("../packages/report/src/index.ts"),C=n("../spread-sheet/src/external/view/main/footer/common/utils.ts"),y=n("../packages/model/src/sheet/SheetType.ts"),R=n("../spread-sheet/src/core/view/layout/interface/pc-view.ts"),A=n("../spread-sheet/src/flow/common/initialization.ts"),P=n("../spread-sheet/src/flow/browser/phase/services/commandService.ts"),W=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),L=n("../node_modules/i18next/dist/esm/i18next.js"),Z=n("../packages/model/src/sheet/sheetUtils.ts");function H(e){return""===e?L.ZP.t("工作表名称不能为空。"):e.length>=32?L.ZP.t("工作表名称不可以超过31个字符。"):(0,Z.isIncludeIllegalChar)(e)?L.ZP.t("工作表名称不能包含以下字符： : \\ / ? * [ ] ，请尝试删除这些字符。",{nsSeparator:"#"}):(0,Z.isStartOrEndWithSingleQuotes)(e)?L.ZP.t("工作表名称的起止位置不能为单引号 ' ，请尝试修改单引号位置。"):(0,Z.isIncludeInvisibleChar)(e)?L.ZP.t("工作表名称可能包含某些不可见的特殊字符，请删除这些字符或空格。"):void 0}function j(e,t,n){var s=n.sheetList;if(!n.hasSheetId(e))return L.ZP.t("工作表ID不存在。");for(var i=0,r=s.length;i<r;i++)if(s[i].getTitle().toUpperCase()===t.toUpperCase()&&s[i].getSheetId()!==e)return L.ZP.t("工作表名称可能重复，请修改。")}var F,k,D,M,N,O=n("../spread-sheet/src/core/utils/relate/relate.ts"),B=n("../spread-sheet/src/core/app/tool.ts"),U=function(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},V=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},G=function(e,t){return function(n,s){t(n,s,e)}},z=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},K=function(){function e(e,t,n,s,i){this.app=e,this.spreadsheet=t,this.dynamicApi=n,this.view=s,this.commandService=i,this.registerCommands()}var t=e.prototype;return t.changeSpreadsheet=function(e){this.spreadsheet=e},t.init=function(){return z(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dynamicApi.getInstance();case 2:case"end":return e.stop()}}),e,this)})))},t.makeInnerSheetProps=function(){var e=this,t=this.spreadsheet.sheetManager.sheetList,n=[];return t.forEach((function(t){var s=t.getSheetId(),i=t.getTitle(),r=(0,O.tZ)(e.app.feature,s),o={id:s,name:i,left:0,inputWidth:0,width:0,isMoving:!1,hidden:t.getDisplayHidden(),relatedType:r,setAuthLock:void 0!==e.app.sheetStatus.sheetsStatus.getSheetStatus(s)};n.push(o)})),n},t.registerCommands=function(){var e=this;this.commandService.registerCommand(T.Z.SHEET_BAR_ADD_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.addSheetAction.apply(e,s)})),this.commandService.registerCommand(T.Z.SHEET_BAR_COPY_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.copySheetAction.apply(e,s)})),this.commandService.registerCommand(T.Z.SHEET_BAR_DELETE_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.deleteSheetAction.apply(e,s)})),this.commandService.registerCommand(T.Z.SHEET_BAR_MOVE_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.moveSheetAction.apply(e,s)})),this.commandService.registerCommand(T.Z.SHEET_BAR_RENAME_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.renameSheetAction.apply(e,s)})),this.commandService.registerCommand(T.Z.SHEET_BAR_SWITCH_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.switchSheetAction.apply(e,s)})),this.commandService.registerCommand(T.Z.SHEET_BAR_SHOW_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.toggleSheetAction.apply(e,[!1].concat(s))})),this.commandService.registerCommand(T.Z.SHEET_BAR_HIDE_SHEET,(function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return e.toggleSheetAction.apply(e,[!0].concat(s))}))},t.addSheetAction=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return z(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dynamicApi.getInstance();case 2:return n=e.sent,x.ZP.jank.log({moduleValue:"sheetbar",actionValue:"addSheet"}),t[0].sheetType=t[0].sheetType||y.ZP.GRID,t[0].sheetName=t[0].sheetName||(0,C.h0)(this.app.spreadsheet.sheetManager.getSheetTitleList(),t[0].sheetType),t[0].sheetIndex=t[0].sheetIndex||this.spreadsheet.activeSheet.getIndex()+1,e.abrupt("return",new Promise((function(e,i){var r=t[0],o=r.sheetIndex,a=r.sheetName,c=r.sheetType,h=r.tableJSON,l=r.mutations,d=(0,C.eq)(s.spreadsheet.sheetManager.getSheetIdList());return n.insertSheet({sheetId:d,sheetIndex:o,sheetName:a,sheetType:c,isHidden:!1,tableJSON:h,mutations:l}).then((function(){l&&!s.app.spreadsheet.isExternalSheet(d)&&(s.app.dataCenter.updateSheetData(d),s.app.getCurrentMainThreadWorker().loadSheetToWorkerIfNeeded(d)),e(d)})).catch((function(e){console.error(e),i(e)}))})));case 8:case"end":return e.stop()}}),e,this)})))},t.copySheetAction=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return z(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,s,i,r,o,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dynamicApi.getInstance();case 2:if(n=e.sent,x.ZP.jank.log({moduleValue:"keyframeMutation",actionValue:"copySheet"}),s=t[0].sheetId,i=this.spreadsheet.sheetManager.getSheetBySheetId(s)){e.next=8;break}return e.abrupt("return",Promise.reject());case 8:return r=(0,C.eq)(),o=(0,C.jd)(this.spreadsheet.sheetManager.getSheetTitleList(),i.getName()),this.view.saveSelectionCache(s),this.view.saveSelectionCache(r),e.abrupt("return",new Promise((function(e,t){n.copySheet({sheetId:s,newSheetId:r,newSheetName:o}).then((function(){a.app.spreadsheet.isExternalSheet(s)||a.app.dataCenter.updateSheetData(r),e(r)})).catch((function(e){return t(e)}))})));case 13:case"end":return e.stop()}}),e,this)})))},t.deleteSheetAction=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return z(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,s,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dynamicApi.getInstance();case 2:if(n=e.sent,x.ZP.jank.log({moduleValue:"sheetbar",actionValue:"removeSheet"}),s=t[0].sheetId,this.app.messageCenterAdapter.sendMessageCenterAdapter.hasUncommittedChanges(s)&&x.ZP.monitor(35169886),i=this.spreadsheet.sheetManager.getSheetIndexBySheetId(s),s!==this.spreadsheet.activeSheetId){e.next=11;break}return r=this.spreadsheet.sheetManager.getNextDisplayedSheetIdBySheetId(s),e.next=11,this.switchSheetAction({sheetId:r,preSheetId:s});case 11:return e.abrupt("return",n.delSheet({sheetId:s,sheetIndex:i}).then((function(){B.Z.event.sheetsBar.trigger("deleteSheetEnd",s)})));case 12:case"end":return e.stop()}}),e,this)})))},t.moveSheetAction=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return z(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,s,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dynamicApi.getInstance();case 2:return n=e.sent,x.ZP.jank.log({moduleValue:"sheetbar",actionValue:"moveSheet"}),s=t[0],i=s.fromIndex,r=s.toIndex,e.abrupt("return",n.moveSheet({fromIndex:i,toIndex:r}));case 6:case"end":return e.stop()}}),e,this)})))},t.renameSheetAction=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];var i;return z(this,void 0,void 0,regeneratorRuntime.mark((function e(){var s,r,o,a,c,h,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t[0],r=s.sheetId,o=s.sheetName,a=j(r,o,this.spreadsheet.sheetManager),c=H(o),void 0===(h=a||c)){e.next=8;break}return null===(i=n.g.$(".sheet-tab-name.rename")[0])||void 0===i||i.focus(),W.default.show({message:h,closable:!1,autoClose:!0}),e.abrupt("return",Promise.reject());case 8:return e.next=10,this.dynamicApi.getInstance();case 10:return l=e.sent,e.abrupt("return",l.renameSheet({sheetId:r,sheetName:o}));case 12:case"end":return e.stop()}}),e,this)})))},t.switchSheetAction=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return z(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,s,i,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=+new Date,s=t[0].sheetId,i=t[0].source,this.app.event.sheetsBar.trigger("switchSheetStart",s),e.abrupt("return",new Promise((function(e,t){var a,c=r.spreadsheet.activeSheet.getSheetId();r.view.saveSelectionCache(c),x.ZP.jank.log({moduleValue:"sheetbar",actionValue:"switchSheet",detail:[c,s]}),x.ZP.jank.stopReport(),r.app.dataCenter?r.app.dataCenter.loadSheetData({sheetId:s,onFirstChunkSuccess:function(){return z(r,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.app.spreadsheet.setActiveSheetId(s),o.Z.event.default.trigger("refreshUrlAfterSwitchSheet"),t=this.app.spreadsheet.sheetManager.getSheetBySheetId(s),e.next=5,this.app.viewManager.renderView(t.getSheetType(),t.getSheetId(),{source:i});case 5:o.Z.event.sheetsBar.trigger("switchActiveSheetEnd",s),x.ZP.speed.runReport(o.Z.config.report.SPEED_REPORT_POINTS.SWITCH_SHEET_TIME,n,+new Date);case 7:case"end":return e.stop()}}),e,this)})))},onFinished:function(){return z(r,void 0,void 0,regeneratorRuntime.mark((function t(){var n,i,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return x.ZP.run(o.Z.config.report.CONFIG.SWITCH_SHEET_ON_SUCCESS,[c,s]),r=o.Z.event.sheetsBar,t.next=4,null===(n=this.app.view.rangeAuth)||void 0===n?void 0:n.handleSwitchSheetEnd();case 4:r.trigger("rangeAuthListenSwitchSheetEnd"),null===(i=this.app.view.canvas.collabFilterToast)||void 0===i||i.checkToastWhenSwitchSheet(s),a=this.app.spreadsheet.activeSheet,x.ZP.run(o.Z.config.report.CONFIG.SWITCH_SHEET_SUCC,"success"),x.ZP.run(o.Z.config.report.CONFIG.SHEET_STATUS_REPORT,a),x.ZP.jank.restartReport(),e(null);case 11:case"end":return t.stop()}}),t,this)})))},onFail:function(){x.ZP.run(o.Z.config.report.CONFIG.SWITCH_SHEET_ON_FAIL,[c,s]),x.ZP.run(o.Z.config.report.CONFIG.SWITCH_SHEET_SERVER_FAIL,"fail"),x.ZP.jank.restartReport(),t()}},!0):null===(a=r.app.historyDataCenter)||void 0===a||a.loadSheetData({subId:s,isSwitch:!0})})));case 5:case"end":return e.stop()}}),e,this)})))},t.toggleSheetAction=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return z(this,void 0,void 0,regeneratorRuntime.mark((function t(){var s,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dynamicApi.getInstance();case 2:if(s=t.sent,i=n[0].sheetId,r=i,e){t.next=11;break}if(this.spreadsheet.sheetManager.getSheetBySheetId(n[0].sheetId)){t.next=9;break}return t.abrupt("return",Promise.reject("sheet is not exsited"));case 9:t.next=12;break;case 11:r=this.spreadsheet.sheetManager.getNextDisplayedSheetIdBySheetId(i);case 12:return t.next=14,this.switchSheetAction({sheetId:r,preSheetId:i});case 14:return t.abrupt("return",new Promise((function(t,n){s.hideSheet({sheetId:i,hidden:e}).then((function(){t(e?r:i)})).catch((function(){n("hidden sheet fail")}))})));case 15:case"end":return t.stop()}}),t,this)})))},e}();K=U([G(0,w.m),G(1,E.V),G(2,I.V),G(3,R.w),G(4,P.H),V("design:paramtypes",["function"===typeof(F="undefined"!==typeof w.m&&w.m)?F:Object,"function"===typeof(k="undefined"!==typeof E.V&&E.V)?k:Object,"function"===typeof(D="undefined"!==typeof u.RU&&u.RU)?D:Object,"function"===typeof(M="undefined"!==typeof R.w&&R.w)?M:Object,"function"===typeof(N="undefined"!==typeof P.H&&P.H)?N:Object])],K),(0,A.Ch)(b,K);var X,q,Y,J,Q,$,ee=function(e){function t(){return e.call(this)||this}return(0,i.Z)(t,e),t}(u.Cv),te=n("../spread-sheet/src/external/view/main/footer/sheetsbar/baseController.ts"),ne=n("../spread-sheet/src/external/view/main/footer/logic/sheetOperationLogic.ts"),se=n("../spread-sheet/src/external/view/main/footer/utils/report.ts"),ie=(n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("react")),re=n.n(ie),oe=n("react-dom"),ae=n("../spread-sheet/src/external/view/pc/footer/components/loading/Loading.tsx"),ce=n("../spread-sheet/src/external/view/pc/footer/components/scroll/scroll.tsx"),he=n("../spread-sheet/src/external/view/pc/footer/components/sheetsList/sheetComponent.readonly.tsx"),le=n("../spread-sheet/src/external/view/pc/footer/components/sheetListBox/sheetListBox.tsx"),de=n("../spread-sheet/src/external/view/main/footer/view/view.interface.ts"),ue=n("../spread-sheet/src/external/view/main/footer/browser/utils.ts"),pe=function(e){function t(t){var n;return(n=e.call(this,t)||this).getSheetList=function(){return n.state.innerSheets.map((function(e,t){return ie.createElement(he.Z,{key:t,app:n.props.app,index:t,mouseDownCallback:function(){},id:e.id,activeSheetId:n.state.activeSheetId,width:Number(e.width),left:e.left,hidden:e.hidden,name:e.name,inputWidth:e.inputWidth,lock:e.setAuthLock,lockOpen:e.lockOpen,relatedType:e.relatedType,updateIndex:n.props.updateIndex})}))},n.app=t.app,n.scrollWrap=ie.createRef(),n.sheetbox=ie.createRef(),n.state=t.initialState,n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e,t;(0,ue.uC)(),null===(t=null===(e=this.scrollWrap)||void 0===e?void 0:e.current)||void 0===t||t.addEventListener("wheel",this.props.onWheel,{passive:!1})},n.componentWillUnmount=function(){var e,t;null===(t=null===(e=this.scrollWrap)||void 0===e?void 0:e.current)||void 0===t||t.removeEventListener("wheel",this.props.onWheel)},n.render=function(){var e=this.state.disabled?" sheet-disabled":"",t=this.state.componentConfig,n=t.isShowSheetListBox,s=t.isShowScrollWrap,i=t.isShowScroll;return ie.createElement("div",{className:"tsSheetbox"+e,onContextMenu:function(e){e.preventDefault()},ref:this.sheetbox,style:{width:this.state.wrapWidth+140}},ie.createElement(ae.Z,{isLoading:this.state.loading,relatedType:this.state.relatedType}),n&&ie.createElement(le.Z,{app:this.app,sheetLength:this.state.innerSheets.length,readonly:!0}),s&&ie.createElement("div",{className:"scrollWrap",ref:this.scrollWrap},ie.createElement("div",{className:"sheet-content",style:{width:this.state.contentWidth,transform:"translateX("+this.state.scrollDistance+"px)"}},this.getSheetList())),i&&ie.createElement(ce.Z,{wrapWidth:this.state.wrapWidth,startLeft:this.props.getActiveSheetPosition,contentWidth:this.state.contentWidth,innerSheet:this.state.innerSheets,activeSheetId:this.state.activeSheetId,scrollCallback:this.props.setScrollMove}))},t}(ie.Component),fe=function(e){function t(t){var n;return(n=e.call(this)||this).container=t,n}return(0,i.Z)(t,e),t.prototype.initViewProps=function(e){var t=this;return new Promise((function(n){var s=ie.createElement(pe,Object.assign({ref:t.setUIRef},e));oe.render(s,t.container,(function(){n()}))}))},t}(de._),me=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},Se=function(e){function t(t,n,s,i,r,o,a,c,h){var l;return(l=e.call(this,t,n,s,i,r,o,a,c,h)||this).handleWheel=function(e){var t,n,s=null===(n=(t=l.sheetOperation).onWheel)||void 0===n?void 0:n.call(t,e,l.wrapWidth,l.contentWidth,l.scrollDistance);void 0!==s&&l.setScrollMove(s)},l.sheetOperation=new ne.X(l.app,l.commandService),l}(0,i.Z)(t,e);var n=t.prototype;return n.initView=function(){var e;return me(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.view=new fe(this.container),this._register(this.view),t.next=4,this.view.initViewProps({app:this.app,updateIndex:this.updateIndex,getActiveSheetPosition:this.getActiveSheetPosition,setScrollMove:this.setScrollMove,initialState:this.getInitialState(),onWheel:this.handleWheel.bind(this)});case 4:(0,se.FT)((null===(e=this.app.view.footer)||void 0===e?void 0:e.footerStartTime).valueOf()),this.componentDidMount();case 6:case"end":return t.stop()}}),t,this)})))},n.getSelectedSheets=function(){return[this.activeSheetId]},n.getInitialState=function(){return{disabled:this.disabled,innerSheets:this.innerSheets,activeSheetId:this.activeSheetId,hidden:this.hidden,wrapWidth:this.wrapWidth,loading:this.loading,relatedType:this.relatedType,contentWidth:this.contentWidth,scrollDistance:this.scrollDistance,componentConfig:this.componentConfig,onWheel:this.handleWheel}},n.updateUI=function(e){this.view.setState(e)},t}(te.Z),ve=Se,ge=n("../spread-sheet/src/core/app/permissions/permissionManage.ts"),we=n("../spread-sheet/src/core/app/contributes/interface.ts"),Ee=n("../spread-sheet/src/base/event/eventName.ts"),_e=n("../spread-sheet/src/external/rangeAuth/constants/range-auth-event.ts"),be=function(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},Ie=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Te=function(e,t){return function(n,s){t(n,s,e)}},xe=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},Ce=function(e){function t(t,n,s,i,r,o){var a;return(a=e.call(this)||this).app=t,a.spreadsheet=n,a.sheetsbarLogic=s,a.commandService=i,a.permissionManage=r,a.contributes=o,a}(0,i.Z)(t,e);var s=t.prototype;return s.init=function(e,t,n){return xe(this,void 0,void 0,regeneratorRuntime.mark((function s(){var i,r,o=this;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(this.container=e,this.wrapWidth=t,this.footerEvent=n,i=!this.app.sheetStatus.workbookStatus.canEdit,r=!!(0,d.IZ)("inToastPreview"),!i){s.next=10;break}return s.next=8,this.switchToReadonly();case 8:s.next=18;break;case 10:if(!r){s.next=15;break}return s.next=13,this.switchToToastPreview();case 13:s.next=18;break;case 15:if(i){s.next=18;break}return s.next=18,this.switchToEditable();case 18:this.permissionManage.add(this.switchToReadonly.bind(this),this.switchToEditable.bind(this)),this.app.event.sheetsBar.trigger(Ee.QM.FOOTER_RENDER_END),B.Z.event.rangeAuthEvent.listen(_e.k.AUTH_INITED,(function(){o.refreshUI()}));case 21:case"end":return s.stop()}}),s,this)})))},s.changeSpreadsheet=function(e){this.spreadsheet=e,this.sheetsbarLogic.changeSpreadsheet(e)},s.refreshUI=function(){var e=this.spreadsheet.activeSheetId,t=this.sheetsbarLogic.makeInnerSheetProps();this.updateProps({activeSheetId:e,innerSheets:t})},s.switchToReadonly=function(){return xe(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disposeController(),e.next=3,this.renderReadonlySheetsbar();case 3:case"end":return e.stop()}}),e,this)})))},s.switchToEditable=function(){return xe(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disposeController(),e.next=3,this.renderEditableSheetsbar();case 3:case"end":return e.stop()}}),e,this)})))},s.switchToToastPreview=function(){return xe(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disposeController(),e.next=3,this.renderPreviewSheetsbar();case 3:case"end":return e.stop()}}),e,this)})))},s.updateProps=function(e){var t;null===(t=this.sheetsbarController)||void 0===t||t.updateProps(e)},s.renderReadonlySheetsbar=function(){return xe(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSheetsProps(),n=t.activeSheetId,s=t.innerSheets,e.next=3,new ve(this.app,this.container,s,n,this.wrapWidth,this.commandService,{},this.contributes.getContribute(S).pc,this.footerEvent);case 3:return this.sheetsbarController=e.sent,this._register(this.sheetsbarController),e.next=7,this.sheetsbarController.initView();case 7:case"end":return e.stop()}}),e,this)})))},s.renderEditableSheetsbar=function(){return xe(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,s,i,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSheetsProps(),s=t.activeSheetId,i=t.innerSheets,e.next=3,n.e("bundle_pc_editableController").then(n.bind(n,"../spread-sheet/src/external/view/pc/footer/sheetsbar/controller/editableController.ts"));case 3:return r=e.sent,o=r.default,this.sheetsbarController=new o(this.app,this.container,i,s,this.wrapWidth,this.commandService,{},this.contributes.getContribute(S).pc,this.footerEvent),this._register(this.sheetsbarController),e.next=9,this.sheetsbarController.initView();case 9:case"end":return e.stop()}}),e,this)})))},s.renderPreviewSheetsbar=function(){return xe(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,s,i,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSheetsProps(),s=t.activeSheetId,i=t.innerSheets,e.next=3,n.e("bundle_pc_previewController").then(n.bind(n,"../spread-sheet/src/external/view/pc/footer/sheetsbar/controller/previewController.ts"));case 3:return r=e.sent,o=r.default,this.sheetsbarController=new o(this.app,this.container,i,s,this.wrapWidth,this.commandService,{},this.contributes.getContribute(S).pc,this.footerEvent),this._register(this.sheetsbarController),e.next=9,this.sheetsbarController.initView();case 9:case"end":return e.stop()}}),e,this)})))},s.disposeController=function(){this.sheetsbarController&&this.sheetsbarController.dispose()},s.getSelectedSheets=function(){return this.sheetsbarController.getSelectedSheets()},s.getSheetsProps=function(){return{activeSheetId:this.spreadsheet.activeSheetId,innerSheets:this.sheetsbarLogic.makeInnerSheetProps()}},t}(ee);Ce=be([Te(0,w.m),Te(1,E.V),Te(2,b),Te(3,P.H),Te(4,ge.a),Te(5,we.T),Ie("design:paramtypes",["function"===typeof(X="undefined"!==typeof w.m&&w.m)?X:Object,"function"===typeof(q="undefined"!==typeof E.V&&E.V)?q:Object,"function"===typeof(Y="undefined"!==typeof b&&b)?Y:Object,"function"===typeof(J="undefined"!==typeof P.H&&P.H)?J:Object,"function"===typeof(Q="undefined"!==typeof ge.a&&ge.a)?Q:Object,"function"===typeof($="undefined"!==typeof we.T&&we.T)?$:Object])],Ce),(0,A.Ch)(_,Ce),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js");var ye=n("../node_modules/classnames/index.js"),Re=n.n(ye),Ae=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),Pe=n.n(Ae),We=Pe().isIPad||Pe().isAndroidPad?"":"can-select",Le=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={selectItem:"avg",selectPanelShow:!1},n.ref=ie.createRef(),n.statisticsUI=ie.createRef(),n.showSelectPanel=n.showSelectPanel.bind((0,s.Z)(n)),n}(0,i.Z)(t,e);var n=t.prototype;return n.getTooltipText=function(e){return"string"===typeof e&&e.length<=10?"":+e>t.MaxValue?e:""},n.getEllipsisString=function(e){return"string"===typeof e&&e.length<=10?e:+e>t.MaxValue?(+e).toString().slice(0,9)+"+":e},n.getCollapseEllipsisString=function(e){return"string"===typeof e&&e.length<=10||isNaN(Number(e))?e:+e>t.MaxCollapseValue?(+e).toString().slice(0,15)+"+":""+(+e).toString()},n.componentWillReceiveProps=function(){this.state.selectPanelShow&&this.setState({selectPanelShow:!1})},n.changeSelectItem=function(e){var t;this.setState({selectItem:e,selectPanelShow:!1}),this.props.getStatisticItem(e),"avg"===e?t="view_avg":"count"===e?t="view_no":"sum"===e&&(t="view_sum"),x.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_view",action:t})},n.getWidth=function(){var e;if(null===(e=this.ref)||void 0===e?void 0:e.current)return this.ref.current.offsetWidth},n.showSelectPanel=function(){this.props.isStatisticsCollapse&&(this.setState({selectPanelShow:!0}),x.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_view",action:"view_fold_count"}))},n.hideSelectPanel=function(){this.setState({selectPanelShow:!1})},n.componentDidMount=function(){},n.render=function(){var e=this,t=this.props,n=t.isStatisticsCollapse,s=t.isFastCalculate,i=this.state.selectItem,r=[{text:L.ZP.t("均值: "),name:"avg",value:this.props.statistics.avg},{text:L.ZP.t("计数: "),name:"count",value:this.props.statistics.count},{text:L.ZP.t("求和: "),name:"sum",value:this.props.statistics.sum}],o=r.map((function(t,s){var r,o=Re()(((r={"sheet-statistics__result":!0})["sheet-statistics-"+t.name]=!0,r.hidden=n&&i!==t.name,r["sheet-statistics-showItem"]=n,r.select=e.state.selectPanelShow,r));return ie.createElement("div",{tabIndex:-1,className:o,key:s,onMouseDown:e.showSelectPanel},ie.createElement("span",null,t.text),ie.createElement("span",{"data-tooltip":e.getTooltipText(t.value)},e.getEllipsisString(t.value)),n&&ie.createElement("span",{className:"sheet-statistics-icon"}))})),a=r.map((function(t,n){return ie.createElement("div",{className:"sheet-statistics-item "+(i===t.name?"sheet-statistics-item-selected":""),key:n,onMouseDown:e.changeSelectItem.bind(e,t.name)},ie.createElement("span",null,t.text),ie.createElement("span",{"data-tooltip":e.getTooltipText(t.value)},e.getCollapseEllipsisString(t.value)))})),c="sheet-statistics "+(this.props.statistics.singleRange?"hidden":n?"":"spread");return this.props.overflow&&(c+=" with-shadow"),ie.createElement("div",{ref:this.ref,className:c,style:this.props.style},ie.createElement("div",{ref:this.statisticsUI,className:"sheet-statistics__content "+We+" "+(s?"hidden":""),tabIndex:-1,onBlur:this.hideSelectPanel.bind(this)},o),ie.createElement("div",{className:"sheet-statistics__content fast-calculate "+(!s&&"hidden"),tabIndex:-1,onBlur:this.hideSelectPanel.bind(this)},ie.createElement("div",{tabIndex:-1,onMouseDown:this.showSelectPanel},ie.createElement("span",null,L.ZP.t("快速计算")),n&&ie.createElement("span",{className:"sheet-statistics-icon"}))),n&&this.state.selectPanelShow&&ie.createElement("div",{className:"sheet-statistics-collapse"},a),ie.createElement("div",{className:"sheet-statistics__division"},ie.createElement("span",{className:"sheet-division"})))},t}(ie.Component);Le.MaxValue=999999999,Le.MaxCollapseValue=999999999999999;var Ze=n("../spread-sheet/src/external/view/pc/footer/components/scalebar/scalebar.tsx"),He=n("../node_modules/@tencent/dui/lib/components/Dropdown/index.js"),je=(n("../node_modules/core-js/modules/es.object.keys.js"),{fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5}),Fe=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],ke=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],De=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],Me="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},Ne="fullscreenEnabled"in Me&&Object.keys(je)||Fe[0]in Me&&Fe||ke[0]in Me&&ke||De[0]in Me&&De||[],Oe={requestFullscreen:function(e){return e[Ne[je.requestFullscreen]]()},requestFullscreenFunction:function(e){return e[Ne[je.requestFullscreen]]},get exitFullscreen(){return Me[Ne[je.exitFullscreen]].bind(Me)},addEventListener:function(e,t,n){return Me.addEventListener(Ne[je[e]],t,n)},removeEventListener:function(e,t,n){return Me.removeEventListener(Ne[je[e]],t,n)},get fullscreenEnabled(){return Boolean(Me[Ne[je.fullscreenEnabled]])},set fullscreenEnabled(e){},get fullscreenElement(){return Me[Ne[je.fullscreenElement]]},set fullscreenElement(e){},get onfullscreenchange(){return Me[("on"+Ne[je.fullscreenchange]).toLowerCase()]},set onfullscreenchange(e){return Me[("on"+Ne[je.fullscreenchange]).toLowerCase()]=e},get onfullscreenerror(){return Me[("on"+Ne[je.fullscreenerror]).toLowerCase()]},set onfullscreenerror(e){return Me[("on"+Ne[je.fullscreenerror]).toLowerCase()]=e}},Be=n("../spread-sheet/src/core/ui/index.ts");function Ue(){x.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_view",action:"view_esc_full"})}var Ve=window,Ge=o.Z.event.sheetsBar,ze=Pe().isMac?"Cmd":"Ctrl";function Ke(){return!Pe().isMobile&&Pe().isWxWork&&/(Windows)|(Macintosh)/i.test(navigator.userAgent)}var Xe,qe=function(e){function t(t){var s;return(s=e.call(this,t)||this).isCancelFullScreenByEsc=!0,s.isNativeFullscreen=!1,s.handleSetFullScreen=function(){s.setFullScreen(),s.props.handleFullScreen(!0)},s.handleKeyDown=function(e){27===e.keyCode&&s.props.isFullScreen&&(e.preventDefault(),s.cancelFullScreen(),s.props.handleFullScreen(!1),Ue())},s.onNativeFullscreen=function(){var e,t;Ke()&&(null===(t=null===(e=window.tdocs)||void 0===e?void 0:e.onFullscreenChange)||void 0===t||t.call(e,(function(e){s.isNativeFullscreen=e.data})))},s.cancelFullscreenChangeHandler=function(){null===Oe.fullscreenElement&&(s.props.handleFullScreen(!1),s.isCancelFullScreenByEsc&&Ue(),s.isCancelFullScreenByEsc=!0)},s.fullscreenErrorHandler=function(){Be.Z.toast.showToast(L.ZP.t("点击右下角视图按钮进入全屏模式")),s.props.handleFullScreen(!1)},s.toggleFullScreen=function(){x.ZP.jank.log({moduleValue:"fullScreen",actionValue:"click",detail:[{width:n.g.SpreadsheetApp.view.canvas.clientRect.width,height:n.g.SpreadsheetApp.view.canvas.clientRect.height}]}),s.props.isFullScreen?s.cancelFullScreen():s.setFullScreen(),o.Z.event.default.trigger("updateFormulaEditorPosition"),s.props.handleFullScreen(!s.props.isFullScreen),function(e){var t=e?"view_normalscreen":"view_fullscreen";x.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_view",action:t})}(s.props.isFullScreen)},s.setWeWorkAppFullScreen=function(){var e,t;s.isNativeFullscreen||null===(t=null===(e=window.tdocs)||void 0===e?void 0:e.requestFullscreen)||void 0===t||t.call(e)},s.cancelWeWorkAppFullScreen=function(){var e,t;s.isNativeFullscreen&&(null===(t=null===(e=window.tdocs)||void 0===e?void 0:e.exitFullscreen)||void 0===t||t.call(e))},document.body.addEventListener("keydown",s.handleKeyDown),Ge.listen("toggleFullScreen",s.toggleFullScreen),Oe.addEventListener("fullscreenchange",s.cancelFullscreenChangeHandler,!1),Oe.addEventListener("fullscreenerror",s.fullscreenErrorHandler,!1),s.onNativeFullscreen(),s}(0,i.Z)(t,e);var s=t.prototype;return s.componentWillUnmount=function(){document.body.removeEventListener("keydown",this.handleKeyDown),Ge.remove("toggleFullScreen",this.toggleFullScreen),Oe.removeEventListener("fullscreenchange",this.cancelFullscreenChangeHandler,!1),Oe.removeEventListener("fullscreenerror",this.fullscreenErrorHandler,!1)},s.render=function(){var e=Re()({fullscreenbar:!0});return ie.createElement("div",{className:e,style:{marginRight:0},"data-tooltip":this.props.isFullScreen?L.ZP.t("普通模式"):L.ZP.t("全屏模式"),"aria-label":this.props.isFullScreen?L.ZP.t("普通模式"):L.ZP.t("全屏模式"),role:"button",tabIndex:4,onKeyDown:this.keyDownHander.bind(this)},ie.createElement("div",{className:"fullscreenbar__button",onClick:this.toggleFullScreen.bind(this)},this.props.isFullScreen?ie.createElement("div",{className:"icon-svg-exit-fullscreen sheetbar-fullscreenbar-icon"}):ie.createElement("div",{className:"icon-svg-entry-fullscreen sheetbar-fullscreenbar-icon"})))},s.setFullScreen=function(){Ke()?this.setWeWorkAppFullScreen():Oe.fullscreenEnabled?Oe.requestFullscreen(window.document.body):this.setFullScreenInPage()},s.cancelFullScreen=function(){if(!Ke())return Oe.fullscreenEnabled?(Oe.exitFullscreen(),void(this.isCancelFullScreenByEsc=!1)):void this.cancelFullScreenInPage();this.cancelWeWorkAppFullScreen()},s.setFullScreenInPage=function(){var e=Ve.$,t=e("header").height()||0,n=e("#canvasContainer").height()||0;e("header").attr("data-ishide","true"),e("header,#mainContainer").css({transition:"all 0.2s ease-in","-webkit-transition":"all 0.2s ease-in","-moz-transition":"all 0.2s ease-in",top:"-"+t+"px"}),e("#moreToolsView").css({display:"none"}),e("#logo-guide-wrapper").css({display:"none"}),e("#canvasContainer").length&&e("#canvasContainer").height(n+t),Ve.SpreadsheetApp&&Ve.SpreadsheetApp.view.canvas.resize.resize()},s.cancelFullScreenInPage=function(){var e=Ve.$,t=e("header").height()||0,n=e("#canvasContainer").height()||0;e("header").attr("data-ishide","false"),e("header,#mainContainer").css({transition:"all 0.2s ease-in","-webkit-transition":"all 0.2s ease-in","-moz-transition":"all 0.2s ease-in",top:"0px"}),e("#moreToolsView").css({display:"none"}),e("#foldBtn .login-container").remove(),e("#foldIcon").removeClass("icon-fold").addClass("icon-unfold"),e("#foldIcon").removeClass("hidefold"),e("#foldIcon").attr("data-tooltip",L.ZP.t("收起（{{Ctrl}}+F1）",{Ctrl:ze})),e("#canvasContainer").length&&e("#canvasContainer").height(n-t),Ve.SpreadsheetApp&&Ve.SpreadsheetApp.view.canvas.resize.resize()},s.keyDownHander=function(e){13===e.keyCode&&this.toggleFullScreen()},t}(ie.Component),Ye=1===window.__is_conversation_embedded||window.self!==window.top,Je=function(e){function t(t){var n;return(n=e.call(this,t)||this).handleFullScreen=function(e){n.setState({isFullScreen:e})},n.getFullAndScale=function(){var e=n.props,t=e.app,s=e.componentConfig,i=e.isDisableScaleBar;return re().createElement("div",{className:"dropdown-full-and-scale"},Ye?null:s.isShowFullScreenBar&&re().createElement(qe,{handleFullScreen:n.handleFullScreen,isFullScreen:n.state.isFullScreen}),s.isShowScaleBar&&re().createElement(Ze.Z,{app:t,disabled:i}))},n.state={isFullScreen:!1},n}return(0,i.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.app,n=e.componentConfig,s=e.isFullAndScaleCollapse,i=e.isDisableScaleBar;return s?re().createElement("div",{className:"full-and-scale divider-disable"},re().createElement("div",{className:"full-and-scale-switch","data-tooltip":"显示比例"}),re().createElement(He.Dropdown,{dropContent:this.getFullAndScale(),alignment:"right",placement:"top",animated:!1,destroyOnClose:!1},re().createElement("div",{className:"arrow-wrapper"},re().createElement("div",{className:"arrow"})))):re().createElement("div",{className:"full-and-scale-wrap"},Ye?null:n.isShowFullScreenBar&&re().createElement(qe,{handleFullScreen:this.handleFullScreen,isFullScreen:this.state.isFullScreen}),n.isShowScaleBar&&re().createElement(Ze.Z,{app:t,disabled:i}))},t}(re().Component),Qe=(n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.object.values.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.number.to-fixed.js"),n("../spread-sheet/src/core/utils/index.ts")),$e=n("../packages/model/src/range/gridRangeUtils.ts"),et=n("../packages/model/src/range/hexRangeUtils.ts"),tt=n("../packages/model/src/index.ts"),nt=n("../node_modules/@tencent/tdocs-format-render/lib/index.js"),st=n("../packages/model/src/cell/ExtendedValue.ts"),it=n("../spread-sheet/src/core/app/sheetStatus/auth-range.ts"),rt=n("../spread-sheet/src/base/util/timer.ts"),ot=n("../node_modules/lodash/isNumber.js"),at=n.n(ot),ct=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};function ht(e,t){return ct(this,void 0,void 0,regeneratorRuntime.mark((function n(){var s,i,r,o,a,c,h,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=e.view.getSelection().rangeSelections,r=Qe.Z.selection.singleRange(e)&&1===i.length,(s={})[Xe[109]]=0,s[Xe[103]]=0,s[Xe[101]]=0,s.singleRange=r,s.id=t,o=s,!r){n.next=5;break}return n.abrupt("return",o);case 5:if(!(0,it.Nb)(e,i)){n.next=7;break}return n.abrupt("return",{sum:0,avg:0,count:0,singleRange:r});case 7:i=(0,$e.getExceptGridRange)(i,e.spreadsheet.activeSheet),a=i.map((function(t){return(0,et.range2RelativeHex)(t,e.spreadsheet.activeSheet)})),c=Object.values(Xe).filter((function(e){return at()(e)})),h=0;case 11:if(!(h<c.length)){n.next=19;break}return l=lt(e,c[h],a),o[Xe[c[h]]]=l,n.next=16,(0,rt._)(10);case 16:h++,n.next=11;break;case 19:return n.abrupt("return",o);case 20:case"end":return n.stop()}}),n)})))}function lt(e,t,n){var s=e.calcController.getResultBySingleFormula("SUBTOTAL("+t+",("+n.join(",")+"))",e.spreadsheet.activeSheetId);if(s.isError||"number"!==typeof s.result)return 0;var i=dt.pointConvert(s.result);switch(t){case Xe.sum:return dt.formatValue(e,i)||String(i);case Xe.count:return i;case Xe.avg:return dt.formatValue(e,i)||String(i)||0;default:return 0}}!function(e){e[e.sum=109]="sum",e[e.count=103]="count",e[e.avg=101]="avg"}(Xe||(Xe={}));var dt={getRangeData:ht,formatValue:function(e,t){var n=e.view.getSelection();if(null===n)return null;var s=n.activeCell,i=s.rowIndex,r=s.colIndex,o=e.spreadsheet.activeSheet.getCellDataAtPosition(i,r);if(!o)return t;var a=st.Z.createInstance({value:t}),c=tt.Cell.cellDataUtils.getExportFormat(o),h=c?c.getNumberFormat():null,l=tt.Utils.numberFormatUtils.formatRenderEngine.render(a,(null===h||void 0===h?void 0:h.pattern)||"General");return l.error?t:l.data.value},pointConvert:function(e){var t=e.toString();e>99999999999&&(t=(0,nt.extToExponential)(e,9));var n=t.indexOf("e+"),s=t.split("e+"),i=15,r=t.indexOf("."),o="",a="";if(s.length>=2&&(i=15-s[1].length-2,o="e+"+s[1]),-1!==r&&-1!==n){var c=i-t.slice(0,r).length-1;a=Number(s[0]).toFixed(Math.min(i,c))+o}else if(-1!==r&&-1==n){var h=t.slice(r+1,t.length).length,l=i-t.slice(0,r).length-1;l<=0&&(l=0),a=Number(s[0]).toFixed(Math.min(h,l))}else a=s[0];return a}},ut=n("../spread-sheet/src/base/util/type.ts");n("../node_modules/core-js/modules/es.array.find.js");var pt=n("../node_modules/@tencent/dui/lib/components/ColorPicker/index.js"),ft=n("../node_modules/@tencent/dui/lib/components/Tooltip/index.js");function mt(){var e=localStorage.getItem("HighlightMode"),t=[];try{t=JSON.parse(e||"[]")}catch(n){localStorage.removeItem("HighlightMode")}return t}n("../node_modules/core-js/modules/es.array.find-index.js");var St,vt,gt,wt=n("../spread-sheet/src/core/view/config/default.ts"),Et=n("../spread-sheet/src/base/event/event.ts"),_t=function(e){function t(t){var n;return(n=e.call(this,t)||this).getColorPicker=function(){var e=n.state,t=e.highlightColor,s=e.isHighlightMode;return re().createElement(pt.default,{rowSpan:7},n.colors.map((function(e){var i=e.color,r=e.realColor,o=e.text;return re().createElement(ft.default,{title:o,key:r},re().createElement(pt.default.Item,{color:r,onClick:function(){return n.chooseColor(i)},selected:t===i&&s}))})))},n.updateHighlightStateFromLocal=function(){var e,t,s=n.props.sheetId,i=mt().find((function(e){return e.id===s})),r=!!(null===(e=null===i||void 0===i?void 0:i.value)||void 0===e?void 0:e.status),o=(null===(t=null===i||void 0===i?void 0:i.value)||void 0===t?void 0:t.color)||n.defaultColor;n.setState({isHighlightMode:r,highlightColor:o},(function(){r&&Et.ZP.sheetsBar.trigger("updateHighlightMode",{status:r,color:o})}))},n.updateHighlightMode=function(e){var t=n.props.sheetId;n.setState({isHighlightMode:e.status,highlightColor:e.color||n.defaultColor},(function(){!function(e,t){var n=mt(),s=n.findIndex((function(t){return t.id===e}));if(-1!==s){var i=n[s].value;n[s]={id:e,value:Object.assign(Object.assign({},i),t)}}else n.push({id:e,value:t});n.length>10&&n.shift();try{localStorage.setItem("HighlightMode",JSON.stringify(n))}catch(r){}}(t,e),Et.ZP.sheetsBar.trigger("updateHighlightMode",e)}))},n.toggleHighlightMode=function(){if(!n.props.disabled){var e={status:!n.state.isHighlightMode,color:n.state.highlightColor||n.defaultColor};n.updateHighlightMode(e)}},n.toggleShowPicker=function(e){n.setState({isShowPicker:null!==e&&void 0!==e?e:!n.state.isShowPicker})},n.chooseColor=function(e){var t={status:!0,color:e};n.updateHighlightMode(t),n.toggleShowPicker(!1)},n.state={isShowPicker:!1,isHighlightMode:!1,highlightColor:wt.OB[0].color},n.colors=wt.OB,n.defaultColor=wt.OB[0].color,n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.updateHighlightStateFromLocal()},n.render=function(){var e=this,t=this.props,n=t.inToastPreview,s=t.isFullAndScaleCollapse,i=t.disabled,r=this.state,o=r.isShowPicker,a=r.isHighlightMode,c=Re()("highlight",{on:a||o,"highlight-disable":i}),h=Re()("highlight-divider",{"highlight-divider-disable":n||s});return re().createElement(re().Fragment,null,re().createElement("div",{className:c},re().createElement("div",{className:"light-switch",onClick:this.toggleHighlightMode,"data-tooltip":L.ZP.t("高亮所在行列")}),re().createElement(He.default,{dropContent:this.getColorPicker(),alignment:"right",placement:"top",animated:!1,onVisibleChange:this.toggleShowPicker,dropContentClassName:"highlight-color-picker",disabled:i},re().createElement("div",{className:"color-switch",onClick:function(){return e.toggleShowPicker()}},re().createElement("div",{className:"arrow-wrapper"})))),re().createElement("div",{className:h}))},t}(re().Component),bt=(n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.string.includes.js"),n("../spread-sheet/src/external/view/pc/footer/footerComponent/redux/store.ts"));!function(e){e[e.LARGE=1280]="LARGE",e[e.MIDDLE=800]="MIDDLE",e[e.SMALL=512]="SMALL"}(St||(St={})),function(e){e[e.IS_COLLAPSE=110]="IS_COLLAPSE",e[e.NO_COLLAPSE=236]="NO_COLLAPSE"}(vt||(vt={})),function(e){e[e.FIXED_WIDTH=195]="FIXED_WIDTH",e[e.MIN_NOCOLLAPSE_STATISTICS168=168]="MIN_NOCOLLAPSE_STATISTICS168",e[e.MIN_COLLAPSE_STATISTICS=50]="MIN_COLLAPSE_STATISTICS",e[e.SMALL_STATISTICS_WIDEST_WIDTH=100]="SMALL_STATISTICS_WIDEST_WIDTH",e[e.STATISTICS_RIGHT=24]="STATISTICS_RIGHT",e[e.STATISTICS_PADDING=40]="STATISTICS_PADDING",e[e.NCOLLAPSE_STATISTICS_RIGHT=20]="NCOLLAPSE_STATISTICS_RIGHT",e[e.SCROLL_WIDTH=60]="SCROLL_WIDTH",e[e.FASTCALCULAT_WIDTH=60]="FASTCALCULAT_WIDTH",e[e.MIN_WRAPWIDTH=100]="MIN_WRAPWIDTH",e[e.INTOASRPREVIEW_RIGHT=60]="INTOASRPREVIEW_RIGHT",e[e.FULLANDSCALE_COLLAPSE_RIGHT=80]="FULLANDSCALE_COLLAPSE_RIGHT",e[e.FULLANDSCALE_NO_COLLAPSE_RIGHT=218]="FULLANDSCALE_NO_COLLAPSE_RIGHT"}(gt||(gt={}));var It,Tt,xt,Ct,yt=function(){var e=this;this.state={statistics:{sum:0,avg:0,count:0,max:0,min:0,singleRange:!0},wrapWidth:0,isStatisticsCollapse:!1,isFullAndScaleCollapse:!1,isFastCalculate:!1,hidden:!1,ref:document.createElement("div"),statisticItem:"avg",inToastPreview:!1},this.computeSheetWidth=function(t){e.state=t;var n=e.state.statistics.singleRange?e.computeWithoutStatistics():e.computeWithStatistics(),s=n.wrapWidth,i=n.isStatisticsCollapse,r=n.isFullAndScaleCollapse,o=n.isFastCalculate,a=bt.Z.getState().contentWidth;return s-=gt.SCROLL_WIDTH,a&&s>=a&&(s+=gt.SCROLL_WIDTH),{wrapWidth:Math.max(s,gt.MIN_WRAPWIDTH),isStatisticsCollapse:i,isFullAndScaleCollapse:r,isFastCalculate:o}},this.computeWithoutStatistics=function(){var t,n=(document.getElementById("footerContainer")||document.body||document.documentElement).clientWidth,s=bt.Z.getState().contentWidth,i=n-gt.FIXED_WIDTH,r=!1;return n>=St.MIDDLE?t=i-e.computeFullAndScaleWidth(!1):n<St.MIDDLE&&n>=St.SMALL?(r=s>=i-e.computeFullAndScaleWidth(!1),t=i-e.computeFullAndScaleWidth(r)):(r=!0,t=St.SMALL-gt.FIXED_WIDTH-e.computeFullAndScaleWidth(!0)),{wrapWidth:t,isStatisticsCollapse:!1,isFullAndScaleCollapse:r,isFastCalculate:!1}},this.computeWithStatistics=function(){var t,n=(document.getElementById("footerContainer")||document.body||document.documentElement).clientWidth,s=bt.Z.getState().contentWidth,i=n-gt.FIXED_WIDTH,r=!1,o=!1,a=!1,c=e.computeStatisticsWidthWhenCollapse(),h=e.computeStatisticsWidthWhenNotCollapse(),l=i-h-e.computeFullAndScaleWidth(!1),d=i-c-e.computeFullAndScaleWidth(!1);return n>=St.LARGE?t=l:n<St.LARGE&&n>=St.MIDDLE?t=(r=s>=l)?d:l:n<St.MIDDLE&&n>=St.SMALL?(r=s>=l,o=s>=d,t=e.computeComplexStatistics(c,h)):(r=!0,o=!0,a=e.computeWidestStatistics()>gt.SMALL_STATISTICS_WIDEST_WIDTH,t=St.SMALL-gt.FIXED_WIDTH-(a?gt.FASTCALCULAT_WIDTH:c+e.computeFullAndScaleWidth(!0))),{wrapWidth:t,isStatisticsCollapse:r,isFullAndScaleCollapse:o,isFastCalculate:a}},this.computeStatisticsWidthWhenCollapse=function(){var t=0,n=e.state.ref,s=Array.from(n.children);n.classList.add("temp-show");var i=s.find((function(t){return t.className.includes("sheet-statistics-"+e.state.statisticItem)}));return i.classList.add("temp-show"),t=i.offsetWidth,i.classList.remove("temp-show"),e.state.isStatisticsCollapse||(t+=gt.STATISTICS_RIGHT),n.classList.remove("temp-show"),Math.max(t,gt.MIN_COLLAPSE_STATISTICS)},this.computeStatisticsWidthWhenNotCollapse=function(){var t=gt.NCOLLAPSE_STATISTICS_RIGHT,n=e.state.ref,s=Array.from(n.children);return n.classList.add("temp-show"),s.forEach((function(n){n.classList.add("temp-show"),t+=n.offsetWidth,e.state.isStatisticsCollapse&&(t-=gt.STATISTICS_RIGHT),n.classList.remove("temp-show")})),n.classList.remove("temp-show"),Math.max(t+gt.STATISTICS_PADDING,gt.MIN_NOCOLLAPSE_STATISTICS168)},this.computeWidestStatistics=function(){var t,n=e.state.ref,s=Array.from(n.children),i=[];return n.classList.add("temp-show"),s.forEach((function(e){e.classList.add("temp-show"),i.push(e.offsetWidth),e.classList.remove("temp-show")})),n.classList.remove("temp-show"),t=Math.max.apply(Math,i),e.state.isStatisticsCollapse||(t+=gt.STATISTICS_RIGHT),t},this.computeComplexStatistics=function(t,n){var s=(document.getElementById("footerContainer")||document.body||document.documentElement).clientWidth,i=bt.Z.getState().contentWidth,r=s-gt.FIXED_WIDTH,o=r-n-e.computeFullAndScaleWidth(!1),a=r-t-e.computeFullAndScaleWidth(!1),c=r-t-e.computeFullAndScaleWidth(!0),h=i>=a;return i>=o||h?h?c:a:o},this.computeFullAndScaleWidth=function(t){return e.state.inToastPreview?0:t?vt.IS_COLLAPSE:vt.NO_COLLAPSE}},Rt=n("../node_modules/lodash/debounce.js"),At=n.n(Rt),Pt=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},Wt=function(e){function t(t){var n;return(n=e.call(this,t)||this).computeSheetWidth=At()((function(){var e,t,s=n.footerComponentController.computeSheetWidth(Object.assign(Object.assign({},n.state),{ref:null===(t=null===(e=n.statisticRef.current)||void 0===e?void 0:e.statisticsUI)||void 0===t?void 0:t.current,statisticItem:n.statisticItem,inToastPreview:n.inToastPreview})),i=s.wrapWidth,r=s.isStatisticsCollapse,o=s.isFullAndScaleCollapse,a=s.isFastCalculate;n.setState({wrapWidth:i,isStatisticsCollapse:r,isFullAndScaleCollapse:o,isFastCalculate:a}),n.props.footerEvent.triggerUpdateWrapWidth({wrapWidth:i}),!n.state.statistics.singleRange&&n.reportFlag&&(n.reportFlag=!1,function(e){var t=e?"view_sscount":"view_bscount";x.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_view",action:t})}(r))}),500),n.updateStatisticsId=0,n.onHideFooter=function(){n.setState({hidden:!0},(function(){n.app.viewManager.resize()}))},n.onShowFooter=function(){n.setState({hidden:!1},(function(){n.app.viewManager.resize()}))},n.updateStatistics=function(e){return Pt((0,s.Z)(n),void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.updateStatisticsId+=1,this.app&&this.app.view.canvas){t.next=3;break}return t.abrupt("return");case 3:if(this.app.calcController){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,ht(this.app,this.updateStatisticsId);case 7:if((n=t.sent).id===this.updateStatisticsId){t.next=10;break}return t.abrupt("return");case 10:e&&(n.singleRange=e),this.setState({statistics:n}),this.computeSheetWidth();case 13:case"end":return t.stop()}}),t,this)})))},n.isDisableScaleBar=function(){return n.props.app.spreadsheet.isExternalSheet()},n.isDisableHighlight=function(){return n.props.app.spreadsheet.isExternalSheet()},n.app=t.app,n.state={statistics:{sum:0,avg:0,count:0,max:0,min:0,singleRange:!0},wrapWidth:0,isStatisticsCollapse:!1,isFullAndScaleCollapse:!1,isFastCalculate:!1,hidden:!1},n.statisticItem="avg",n.reportFlag=!0,n.inToastPreview=!!(0,d.IZ)("inToastPreview"),n.statisticRef=ie.createRef(),n.getStatisticItem=n.getStatisticItem.bind((0,s.Z)(n)),n.throttleUpdateStatistics=(0,ut.throttle)(n.updateStatistics,500,(0,s.Z)(n)),n.onShowFooter=n.onShowFooter.bind((0,s.Z)(n)),n.padId=n.app.spreadsheet.getSpreadsheetId(),n.footerComponentController=new yt,n}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;this.registerListeners(),setTimeout((function(){return Pt(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.mountedCallback(this.state.wrapWidth);case 2:this.props.footerEvent.triggerShowFooterEvent(),this.computeSheetWidth();case 4:case"end":return e.stop()}}),e,this)})))}))},n.registerListeners=function(){o.Z.event.windowEvent.listen("resize",this.computeSheetWidth),this.modifySelectionDisposable=this.app.view.canvas.normalSelectData.onModifySelectData(this.throttleUpdateStatistics),o.Z.event.spreadsheetEvent.listen(o.Z.EVENT_NAME.DATA_CHANGE,this.throttleUpdateStatistics),this.app.mutationBehavior.emitter.on(this.app.mutationBehavior.EVENT.DATA_CHANGE,this.throttleUpdateStatistics),this.onHideDisposable=this.props.footerEvent.onHideFooter(this.onHideFooter),this.onShowDisposable=this.props.footerEvent.onShowFooter(this.onShowFooter),this.onUpdateStatisticsDisposable=this.props.footerEvent.onUpdateStatistics(this.updateStatistics)},n.getStatisticItem=function(e){this.statisticItem=e,this.computeSheetWidth()},n.componentWillUnmount=function(){this.destroy()},n.destroy=function(){var e;o.Z.event.windowEvent.remove("resize",this.computeSheetWidth),null===(e=this.modifySelectionDisposable)||void 0===e||e.dispose(),o.Z.event.spreadsheetEvent.remove(o.Z.EVENT_NAME.DATA_CHANGE,this.throttleUpdateStatistics),this.app.mutationBehavior.emitter.off(this.app.mutationBehavior.EVENT.DATA_CHANGE,this.throttleUpdateStatistics),this.onHideDisposable.dispose(),this.onShowDisposable.dispose(),this.onUpdateStatisticsDisposable.dispose()},n.render=function(){var e=this.props.componentConfig,t=Re()({"footer-bottom-pc":!0,"footer-hidden":this.state.hidden,"full-collapse":this.state.isFullAndScaleCollapse}),n=this.isDisableScaleBar(),s=this.isDisableHighlight();return ie.createElement("div",{id:"pcFooter",className:t},ie.createElement("div",{className:"aria-hide",tabIndex:4,"aria-label":L.ZP.t("已切换到底部工具栏")}),ie.createElement("div",{id:"sheetbarContainer"}),ie.createElement("div",{id:"sheetbar-right-container"},e.isShowStatistics&&ie.createElement(Le,{ref:this.statisticRef,statistics:this.state.statistics,isStatisticsCollapse:this.state.isStatisticsCollapse,isFastCalculate:this.state.isFastCalculate,getStatisticItem:this.getStatisticItem}),ie.createElement(_t,{inToastPreview:this.inToastPreview,sheetId:this.padId,isFullAndScaleCollapse:this.state.isFullAndScaleCollapse,disabled:s}),this.inToastPreview?ie.createElement(Ze.Z,{app:this.props.app,inToastPreview:this.inToastPreview,disabled:n}):ie.createElement(Je,{app:this.props.app,componentConfig:this.props.componentConfig,isFullAndScaleCollapse:this.state.isFullAndScaleCollapse,isDisableScaleBar:n})))},t}(ie.Component),Lt=Wt,Zt=function(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},Ht=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},jt=function(e,t){return function(n,s){t(n,s,e)}},Ft=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(t){r(t)}}function a(e){try{c(s.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},kt=function(e){function t(t,n,i,r){var o;return(o=e.call(this,t,n,r)||this).app=t,o.sheetsbarService=i,o.contributes=r,o.updateWrapWidth=function(e){o.sheetsbarService.wrapWidth=e.wrapWidth,o.updateProps(e)},o.updateProps=function(e){o.sheetsbarService.updateProps(e)},o.setRef=function(e){o.footerRef=e},o.handleFooterMounted=function(e){return Ft((0,s.Z)(o),void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.footerStartTime=new Date,n=document.getElementById("sheetbarContainer"),t.next=4,this.sheetsbarService.init(n,e,this.footerEvent);case 4:case"end":return t.stop()}}),t,this)})))},o.render=function(){var e=document.getElementById("footerContainer");return new Promise((function(t){oe.render(o.footerComponent,e,(function(){t({})}))}))},o.refreshUI=o.refreshUI.bind((0,s.Z)(o)),o.updateProps=o.updateProps.bind((0,s.Z)(o)),o.registerListeners(),o.getComponentConfig(),o}(0,i.Z)(t,e);var n=t.prototype;return n.getComponentConfig=function(){this.componentConfig=this.footerComponentConfig.pc},n.changeSpreadsheet=function(e){var t,n;this.spreadsheet=e,null===(n=(t=this.sheetsbarService).changeSpreadsheet)||void 0===n||n.call(t,e)},n.init=function(){this.footerComponent=ie.createElement(Lt,{app:this.app,mountedCallback:this.handleFooterMounted,componentConfig:this.componentConfig,footerEvent:this.footerEvent,ref:this.setRef}),this.render()},n.registerListeners=function(){this._register(this.footerEvent.onRefreshUI(this.refreshUI)),this._register(this.footerEvent.onUpdateWrapWidth(this.updateWrapWidth))},n.refreshUI=function(){var e=this.spreadsheet.activeSheetId;window.history.replaceState(e,"",(0,d.XK)(window.location.href,{tab:e})),this.footerRef.forceUpdate(),this.sheetsbarService.refreshUI()},n.getSelectedSheets=function(){return this.sheetsbarService.getSelectedSheets()},n.dispose=function(){e.prototype.dispose.call(this),this.sheetsbarService.dispose();var t=document.getElementById("footerContainer");oe.unmountComponentAtNode(t)},t}(g),Dt=kt=Zt([jt(0,w.m),jt(1,E.V),jt(2,_),jt(3,we.T),Ht("design:paramtypes",["function"===typeof(It="undefined"!==typeof w.m&&w.m)?It:Object,"function"===typeof(Tt="undefined"!==typeof E.V&&E.V)?Tt:Object,"function"===typeof(xt="undefined"!==typeof _&&_)?xt:Object,"function"===typeof(Ct="undefined"!==typeof we.T&&we.T)?Ct:Object])],kt)},"../spread-sheet/src/external/view/pc/footer/footerComponent/redux/interface.ts":function(e,t,n){var s;n.d(t,{o:function(){return s}}),function(e){e[e.UPDATE_WIDTH=0]="UPDATE_WIDTH"}(s||(s={}))},"../spread-sheet/src/external/view/pc/footer/footerComponent/redux/store.ts":function(e,t,n){n.d(t,{Z:function(){return o}});var s=n("../node_modules/redux/es/redux.js"),i=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../spread-sheet/src/external/view/pc/footer/footerComponent/redux/interface.ts")),r={contentWidth:0},o=(0,s.MT)((function(e,t){void 0===e&&(e=r);var n=Object.assign({},e),s=t.type,o=t.payload;return s===i.o.UPDATE_WIDTH?function(e,t){return Object.assign(Object.assign({},e),t)}(e,o):n}))}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/bundle_plugin_pcFooter.423c72261c69e09ae3e6.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=bundle_plugin_pcFooter.423c72261c69e09ae3e6.js.map