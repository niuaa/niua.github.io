self.window=self,window.jsExecStartTimeStamp=Date.now(),(self.webpackChunk_tencent_alloy_builder=self.webpackChunk_tencent_alloy_builder||[]).push([["spread-sheet_src_base_util_decorator_loading-decorator_ts-spread-sheet_src_core_feature_copyP-33f189"],{"../spread-sheet/src/base/util/decorator/loading-decorator.ts":function(e,t,n){n.d(t,{n:function(){return s}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.array.concat.js");var r=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))};function s(){return function(e,t,s){var o=s.value;s.value=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];var a,i;return r(this,void 0,void 0,regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(a=n.g.snackLoading)||void 0===a||a.show(3e3),e.next=3,o.call.apply(o,[this].concat(t));case 3:return r=e.sent,null===(i=n.g.snackLoading)||void 0===i||i.hide(),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})))}}}},"../spread-sheet/src/core/feature/copyPaste/copyPasteShape.ts":function(e,t,n){n.d(t,{Eb:function(){return g},O1:function(){return y},OO:function(){return s},ZP:function(){return w},tZ:function(){return f},w4:function(){return x}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.string.anchor.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.number.to-fixed.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.map.js");var r,s,o=n("../node_modules/i18next/dist/esm/i18next.js"),a=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),i=n.n(a),l=n("../node_modules/@tencent/dui/lib/components/Modal/index.js"),c=n("../spread-sheet/src/core/feature/copyPaste/utils/url.ts"),u=n("../spread-sheet/src/core/feature/copyPaste/convertor/convertShapeData2IAddImage.ts"),d=n("../spread-sheet/src/core/view/level-2/shape-upload/utils.ts"),p=n("../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/paste-special-api.ts"),h=n("../spread-sheet/src/base/error/index.ts"),m=n("../spread-sheet/src/base/error/error-code-report.ts"),f=n("../node_modules/@tencent/docs-design-resources/history/png@2x/placeholder_url@2x.png"),g=n("../node_modules/@tencent/docs-design-resources/history/png@2x/retina_placeholder_url@2x.png"),v=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))},y=function(e){e="undefined"!==typeof e?e:4;for(var t="",n=0;n<e;n++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t},b="default-pic-paste-type-"+(null===(r=n.g.spreadConfig)||void 0===r?void 0:r.getConfig("uid"));!function(e){e.CELL="0",e.FLOAT="1"}(s||(s={}));var S=!0,x=function(){return!!S&&(S=!1,!0)},w=function(){function e(e,t){this.isInputTriggered=!1,this.latestCanShowPSImgId="",this.enablePicturePasteSpecial=!1,this.hot=e,this.addImageFunc=t}e.defaultOuterPicturePasteType=function(){var e=localStorage.getItem(b);return null===e?s.FLOAT:e},e.setDefaultOuterPicturePasteType=function(e){localStorage.setItem(b,e)};var t=e.prototype;return t.inputTriggered=function(){this.isInputTriggered=!0},t.addShape=function(e,t){return void 0===t&&(t=!1),v(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,s,o,a,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.hot,s=r.spreadsheet.getActiveSheetId(),e.anchor||((o=null===r||void 0===r?void 0:r.view.canvas)?(a=o.normalSelectData.activeRow,i=o.normalSelectData.activeCol,e.anchor=a<0||i<0?{row:0,col:0}:{row:a,col:i}):e.anchor={row:0,col:0},e.offset={x:0,y:0}),e.size||(e.size={width:-1,height:-1}),n.next=6,this.addImageFunc((0,u.iS)(e,s),t);case 6:this.isInputTriggered=!1;case 7:case"end":return n.stop()}}),n,this)})))},t.getCopyContent=function(){var e,t,n=null===(t=null===(e=this.hot.view.canvas.shapeEditCenter)||void 0===e?void 0:e.shapeEdit)||void 0===t?void 0:t.shapeId;return this.getPickShapeCopyContent(n)},t.getPickShapeCopyContent=function(e){if(e){var t=this.hot.spreadsheet.activeSheet.imageManager.getImage(e);if(t){var n=Object.assign({},(0,u.Ir)(t)),r=t.position.overlayPosition.widthPixels.toFixed(),s=t.position.overlayPosition.heightPixels.toFixed(),o=t.clipInfo.clipTop.toFixed(),a=t.clipInfo.clipLeft.toFixed(),i=t.clipInfo.clipRight.toFixed(),l=t.clipInfo.clipBottom.toFixed();return{html:'<img src="'+t.url+'" style="width: '+r+"px; height: "+s+'px;" data-clip="'+o+"px "+i+"px "+l+"px "+a+'px"/>',plain:"图片",json:JSON.stringify([n])}}}return{html:"",plain:"",json:""}},t.onParse=function(e,t){return v(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,s,a,l,c,u=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.hot.view&&null!==e){n.next=2;break}return n.abrupt("return",null);case 2:return r=this.hot.view.canvas,n.next=5,this.hot.feature.getCopyPaste();case 5:if(s=n.sent,a=s.copyPasteCache,l=a.getPasteAnchor(),this.enablePicturePasteSpecial=1===e.length&&!i().isMobilePhone,"json"!==t&&"files"!==t){n.next=14;break}return n.next=12,Promise.all(e.map((function(e){return v(u,void 0,void 0,regeneratorRuntime.mark((function n(){var s,a,i,c,u,p,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("json"!==t){n.next=8;break}return e=JSON.stringify(e),(s=JSON.parse(e)).anchor=l,s.offset={x:0,y:0},s.id=(0,d.ki)(),this.addShapeWithTips(s,!0),n.abrupt("return",s);case 8:return n.prev=8,n.next=11,r.shapeUpload.handleImage(e);case 11:i=n.sent,c=i.url,u=i.id,p=i.width,f=i.height,a={url:c,id:u,size:{width:p,height:f},offset:{x:0,y:0},clipInfo:{clipTop:0,clipLeft:0,clipRight:0,clipBottom:0},anchor:l},n.next=23;break;case 19:return n.prev=19,n.t0=n.catch(8),(0,m.V)({errorCode:h.B.PASTE_IMAGE_FROM_OUTER,message:o.ZP.t("从外部粘贴图片上传错误"),tipsCustom:{stack:n.t0}}),n.abrupt("return",null);case 23:return this.addShapeWithTips(a),n.abrupt("return",a);case 25:case"end":return n.stop()}}),n,this,[[8,19]])})))})));case 12:return c=n.sent,n.abrupt("return",c);case 14:if("html"!==t){n.next=16;break}return n.abrupt("return",null);case 16:return console.error("unkonw format to paste"),n.abrupt("return",null);case 18:case"end":return n.stop()}}),n,this)})))},t.addShapeWithTips=function(t,n){var r,a,i=this;void 0===n&&(n=!1),this.latestCanShowPSImgId="";var c=this.hot,u=c.spreadsheet,d=c.view.getSelection().activeCell,p=d.rowIndex,h=d.colIndex;if(this.enablePicturePasteSpecial){this.latestCanShowPSImgId=t.id;var m=e.defaultOuterPicturePasteType()===s.CELL,f=!n&&(this.isInputTriggered||m);f&&x()&&(null===(a=null===(r=u.activeSheet.getCellDataAtPosition(p,h))||void 0===r?void 0:r.getEffectiveValue())||void 0===a?void 0:a.value)?l.Modal.confirm({title:o.ZP.t("粘贴为单元格图片"),content:o.ZP.t("粘贴单元格图片将会覆盖单元格已有内容，继续粘贴吗"),onOk:function(){i.doPasteSpecial(t,f)}}):this.doPasteSpecial(t,f)}else this.addShape(t)},t.doPasteSpecial=function(e,t){return v(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,s,o,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.hot,s=r.requestApi,o=r.spreadsheet,a=r.view,n.next=3,this.addShape(e,t);case 3:(0,p.lc)(a,s,o,e.id);case 4:case"end":return n.stop()}}),n,this)})))},t.findShapeById=function(e,t){return e[t]},t.handleOuterImg=function(e){var t=null,n=this.hot.view.canvas;return(0,c.Zp)(e)?(t=(0,d.rw)(e),n.shapeUpload.handleImage(t).then((function(e){return{url:e.url,id:e.id,size:{width:e.width,height:e.height},offset:{x:0,y:0},clipInfo:e.clipInfo}}))):e?n.shapeUpload.handleImageLink(e).then((function(e){return{url:e.url,id:e.id,size:{width:e.width,height:e.height},offset:{x:0,y:0},clipInfo:e.clipInfo}})):void 0},e}()},"../spread-sheet/src/core/feature/copyPaste/lib/ParsePasteHTML.ts":function(e,t,n){n.d(t,{Z:function(){return O}}),n("../node_modules/core-js/modules/es.array.slice.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.string.bold.js"),n("../node_modules/core-js/modules/es.string.fontsize.js"),n("../node_modules/core-js/modules/es.string.fontcolor.js"),n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.string.trim.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.string.anchor.js");var r=n("../node_modules/i18next/dist/esm/i18next.js"),s=(n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/es.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/esnext.map.delete-all.js"),n("../node_modules/core-js/modules/esnext.map.every.js"),n("../node_modules/core-js/modules/esnext.map.filter.js"),n("../node_modules/core-js/modules/esnext.map.find.js"),n("../node_modules/core-js/modules/esnext.map.find-key.js"),n("../node_modules/core-js/modules/esnext.map.includes.js"),n("../node_modules/core-js/modules/esnext.map.key-of.js"),n("../node_modules/core-js/modules/esnext.map.map-keys.js"),n("../node_modules/core-js/modules/esnext.map.map-values.js"),n("../node_modules/core-js/modules/esnext.map.merge.js"),n("../node_modules/core-js/modules/esnext.map.reduce.js"),n("../node_modules/core-js/modules/esnext.map.some.js"),n("../node_modules/core-js/modules/esnext.map.update.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.sort.js"),n("../node_modules/core-js/modules/es.object.entries.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.array.join.js"),function(){this.cssImportStatements=[],this.cssKeyframeStatements=[],this.cssRegex=new RegExp("([\\s\\S]*?){([\\s\\S]*?)}","gi"),this.cssMediaQueryRegex="((@media [\\s\\S]*?){([\\s\\S]*?}\\s*?)})",this.cssKeyframeRegex="((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})",this.combinedCSSRegex="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",this.cssCommentsRegex="(\\/\\*[\\s\\S]*?\\*\\/)",this.cssImportStatementRegex=new RegExp("@import .*?;","gi"),this.cssComments=/<!--|-->/g});s.prototype.stripComments=function(e){var t=new RegExp(this.cssCommentsRegex,"gi");return e.replace(t,"")},s.prototype.parseCSS=function(e){if(void 0===e)return[];for(var t=[];;){var n=this.cssImportStatementRegex.exec(e);if(null===n)break;this.cssImportStatements.push(n[0]),t.push({selector:"@imports",type:"imports",styles:n[0]})}e=(e=e.replace(this.cssComments,"")).replace(this.cssImportStatementRegex,"");for(var r,s=new RegExp(this.cssKeyframeRegex,"gi");null!==(r=s.exec(e));)t.push({selector:"@keyframes",type:"keyframes",styles:r[0]});e=e.replace(s,"");for(var o=new RegExp(this.combinedCSSRegex,"gi");null!==(r=o.exec(e));){var a="";a=void 0===r[2]?r[5].split("\r\n").join("\n").trim():r[2].split("\r\n").join("\n").trim();var i=new RegExp(this.cssCommentsRegex,"gi"),l=i.exec(a);if(null!==l&&(a=a.replace(i,"").trim()),-1!==(a=a.replace(/\n+/,"\n")).indexOf("@media")){var c={selector:a,type:"media",subStyles:this.parseCSS(r[3]+"\n}")};null!==l&&(c.comments=l[0]),t.push(c)}else{var u={selector:a,rules:this.parseRules(r[6])};"@font-face"===a&&(u.type="font-face"),null!==l&&(u.comments=l[0]),t.push(u)}}return t},s.prototype.parseRules=function(e){var t=[];e=(e=(e=e.split("\r\n").join("\n")).replace("\\;","8cbdb7f1309a1f76b65356e6afc3948b")).replace("\\\\;","8cbdb7f1309a1f76b65356e6afc3948a").split(new RegExp(";")).map((function(e){return(e=e.replace("8cbdb7f1309a1f76b65356e6afc3948b","\\;")).replace("8cbdb7f1309a1f76b65356e6afc3948a","\\\\;")}));for(var n=0;n<e.length;n++){var r=e[n];if(-1!==(r=r.trim()).indexOf(":")){var s=(r=r.split(":"))[0].trim(),o=r.slice(1).join(":").trim();if(s.length<1||o.length<1)continue;t.push({directive:s,value:o})}else"base64,"===r.trim().substr(0,7)?t[t.length-1].value+=r.trim():r.length>0&&t.push({directive:"",value:r,defective:!0})}return t},s.prototype.findCorrespondingRule=function(e,t,n){void 0===n&&(n=!1);for(var r=!1,s=0;s<e.length&&(e[s].directive!==t||(r=e[s],n!==e[s].value));s++);return r},s.prototype.findBySelector=function(e,t,n){void 0===n&&(n=!1);for(var r=[],s=0;s<e.length;s++)!1===n?e[s].selector===t&&r.push(e[s]):-1!==e[s].selector.indexOf(t)&&r.push(e[s]);if("@imports"===t||r.length<2)return r;var o=r[0];for(s=1;s<r.length;s++)this.intelligentCSSPush([o],r[s]);return[o]},s.prototype.deleteBySelector=function(e,t){for(var n=[],r=0;r<e.length;r++)e[r].selector!==t&&n.push(e[r]);return n},s.prototype.compressCSS=function(e){for(var t=[],n={},r=0;r<e.length;r++){var s=e[r];if(!0!==n[s.selector]){var o=this.findBySelector(e,s.selector);0!==o.length&&(t=t.concat(o),n[s.selector]=!0)}}return t},s.prototype.cssDiff=function(e,t){if(e.selector!==t.selector)return!1;if("media"===e.type||"media"===t.type)return!1;for(var n,r,s={selector:e.selector,rules:[]},o=0;o<e.rules.length;o++)n=e.rules[o],(!1===(r=this.findCorrespondingRule(t.rules,n.directive,n.value))||n.value!==r.value)&&s.rules.push(n);for(var a=0;a<t.rules.length;a++)r=t.rules[a],!1===(n=this.findCorrespondingRule(e.rules,r.directive))&&(r.type="DELETED",s.rules.push(r));return 0!==s.rules.length&&s},s.prototype.intelligentMerge=function(e,t,n){void 0===n&&(n=!1);for(var r=0;r<t.length;r++)this.intelligentCSSPush(e,t[r],n);for(r=0;r<e.length;r++){var s=e[r];"media"!==s.type&&"keyframes"!==s.type&&(s.rules=this.compactRules(s.rules))}},s.prototype.intelligentCSSPush=function(e,t,n){var r=t.selector,s=!1;if(void 0===n&&(n=!1),!1===n){for(var o=0;o<e.length;o++)if(e[o].selector===r){s=e[o];break}}else for(var a=e.length-1;a>-1;a--)if(e[a].selector===r){s=e[a];break}if(!1===s)e.push(t);else if("media"!==t.type)for(var i=0;i<t.rules.length;i++){var l=t.rules[i],c=this.findCorrespondingRule(s.rules,l.directive);!1===c?s.rules.push(l):"DELETED"===l.type?c.type="DELETED":c.value=l.value}else s.subStyles=s.subStyles.concat(t.subStyles)},s.prototype.compactRules=function(e){for(var t=[],n=0;n<e.length;n++)"DELETED"!==e[n].type&&t.push(e[n]);return t},s.prototype.getCSSForEditor=function(e,t){void 0===t&&(t=0);var n="";void 0===e&&(e=this.css);for(var r=0;r<e.length;r++)"imports"===e[r].type&&(n+=e[r].styles+"\n\n");for(r=0;r<e.length;r++){var s=e[r];if(void 0!==s.selector){var o="";void 0!==s.comments&&(o=s.comments+"\n"),"media"===s.type?(n+=o+s.selector+"{\n",n+=this.getCSSForEditor(s.subStyles,t+1),n+="}\n\n"):"keyframes"!==s.type&&"imports"!==s.type&&(n+=this.getSpaces(t)+o+s.selector+" {\n",n+=this.getCSSOfRules(s.rules,t+1),n+=this.getSpaces(t)+"}\n\n")}}for(r=0;r<e.length;r++)"keyframes"===e[r].type&&(n+=e[r].styles+"\n\n");return n},s.prototype.getImports=function(e){for(var t=[],n=0;n<e.length;n++)"imports"===e[n].type&&t.push(e[n].styles);return t},s.prototype.getCSSOfRules=function(e,t){for(var n="",r=0;r<e.length;r++)void 0!==e[r]&&(void 0===e[r].defective?n+=this.getSpaces(t)+e[r].directive+": "+e[r].value+";\n":n+=this.getSpaces(t)+e[r].value+";\n");return n||"\n"},s.prototype.getSpaces=function(e){for(var t="",n=0;n<4*e;n++)t+=" ";return t},s.prototype.applyNamespacing=function(e,t){var n=e,r="."+this.cssPreviewNamespace;void 0!==t&&(r=t),"string"===typeof e&&(n=this.parseCSS(e));for(var s=0;s<n.length;s++){var o=n[s];if(!(o.selector.indexOf("@font-face")>-1||o.selector.indexOf("keyframes")>-1||o.selector.indexOf("@import")>-1||o.selector.indexOf(".form-all")>-1||o.selector.indexOf("#stage")>-1))if("media"!==o.type){for(var a=o.selector.split(","),i=[],l=0;l<a.length;l++)-1===a[l].indexOf(".supernova")?i.push(r+" "+a[l]):i.push(a[l]);o.selector=i.join(",")}else o.subStyles=this.applyNamespacing(o.subStyles,t)}return n},s.prototype.clearNamespacing=function(e,t){void 0===t&&(t=!1);var n=e,r="."+this.cssPreviewNamespace;"string"===typeof e&&(n=this.parseCSS(e));for(var s=0;s<n.length;s++){var o=n[s];if("media"!==o.type){for(var a=o.selector.split(","),i=[],l=0;l<a.length;l++)i.push(a[l].split(r+" ").join(""));o.selector=i.join(",")}else o.subStyles=this.clearNamespacing(o.subStyles,!0)}return!1===t?this.getCSSForEditor(n):n},s.prototype.createStyleElement=function(e,t,n){if(void 0===n&&(n=!1),!1===this.testMode&&"nonamespace"!==n&&(t=this.applyNamespacing(t)),"string"!==typeof t&&(t=this.getCSSForEditor(t)),!0===n&&(t=this.getCSSForEditor(this.parseCSS(t))),!1!==this.testMode)return this.testMode("create style #"+e,t);var r=document.getElementById(e);r&&r.parentNode.removeChild(r);var s=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.id=e,o.type="text/css",s.appendChild(o),o.styleSheet&&!o.sheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))};var o,a=s,i=n("../spread-sheet/src/core/feature/copyPaste/lib/unescapeCssSequences.ts"),l=new a,c=function(){function e(e){var t,n=(t=e)?l.parseCSS(t):(console.error("invalid css string"),[]);this.styleSheetsParsed=this.transform(n),this.getComputedStyle=this.getComputedStyle.bind(this)}var t=e.prototype;return t.transform=function(e){return e.reduce((function(e,t){return e[t.selector]=(e[t.selector]||[]).concat(t.rules),e}),{})},t.getComputedStyle=function(e){var t=e.getAttribute("class"),n=e.getAttribute("style");return this.getMergedStyles(t,n,e.tagName.toLocaleLowerCase())},t.getMergedStyles=function(e,t,n){var r=this.getRulesBySelector("."+e),s=this.parseRules(t),o=this.getRulesBySelector(n)||[],a=r||[];return this.getMergeStyles(o.concat(a,s))},t.getMergeStyles=function(e){var t={};return e.forEach((function(e){var n=e.value;/mso/.test(e.directive)&&(n=(0,i.G)(e.value)),t[e.directive]=n})),t},t.reaplaceStylePropertyUnit=function(e,t,n){var r=getComputedStyle(e);return t[n]&&(t[n]=r.getPropertyValue(n)),t},t.parseRules=function(e){return(t=e)?l.parseRules(t):[];var t},t.getRulesBySelector=function(e){return this.styleSheetsParsed[e]},e}(),u=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),d=n.n(u),p=n("../spread-sheet/src/core/feature/copyPaste/middleware/index.ts"),h=n("../spread-sheet/src/core/feature/copyPaste/middleware/interface.ts"),m=n("../packages/model/src/cell/metadata/Metadata.ts");!function(e){e.STYLE_NODE="style",e.TABLE_NODE="table",e.IMG_NODE="img",e.TBODY_NODE="tbody",e.THEAD_NODE="thead",e.A_NODE="a",e.TR_NODE="tr",e.HR_NODE="hr",e.TH_NODE="th",e.TD_NODE="td",e.BR_NODE="br"}(o||(o={}));var f=function(){function e(){var e=this;this.parseSizeInfo=function(t){if(t){var n=e.parseColCount(t),r=e.parseRowCount(t),s=e.parseColWidthsAndHidden(t,n),o=e.parseRowHeightsAndHidden(t,r);return{col:n,row:r,colWidths:s?s.map((function(e){return e.size})):null,hiddenCols:s?s.map((function(e){return e.hidden})):null,rowHeights:o?o.map((function(e){return e.size})):null,hiddenRows:o?o.map((function(e){return e.hidden})):null}}return!e.size&&e.tableDOM&&(e.size=e.parseSizeInfo(e.tableDOM)),e.size},this.unsubscribe=function(t,n){if(void 0==n)e.notificationCenter.delete(t);else{var r=e.notificationCenter.get(t),s=r?r.indexOf(n):-1;s>-1&&(e.notificationCenter.get(t)[s]=function(){})}},this.sandBox=document.createElement("div"),this.init()}var t=e.prototype;return t.init=function(){this.initNotificationCenter(),this.initSubscription(),document.body.appendChild(this.sandBox)},t.initNotificationCenter=function(){this.notificationCenter=new Map},t.initSubscription=function(){this.subscribe("beforeStandardizeCells",this.standardizeCellsWithMergeCells)},t.clearTableInfo=function(){this.tableDOM=null,this.mergeCells=[],this.cellsStyleMaps=[[]],this.nowrap=null,this.noFormula=!1,this.rgba2hex={},this.size=void 0,this.isCopySourceExcel=void 0,this.cells=void 0,this.colgroup=void 0},t.setStyleGroup=function(e){try{this.mSOStyle=new c(e||"")}catch(t){console.warn("解析格式相关样式报错")}},t.initInfoArrays=function(){return{styles:[[]],data:[[]],template:[[]],formula:[[]],cellSelect:[[]],dataValidations:[[]],cellImage:[[]]}},t.setInfoItem=function(e){var t,n,r,s,o,a,i=e.styles,l=void 0===i?[[]]:i,c=e.data,u=void 0===c?[[]]:c,d=e.template,p=void 0===d?[[]]:d,h=e.formula,m=void 0===h?[[]]:h,f=e.cellSelect,g=void 0===f?[[]]:f,v=e.dataValidations,y=void 0===v?[[]]:v,b=e.cellImage,S=void 0===b?[[]]:b,x=e.index,w=e.info;l[x].push(w.style),u[x].push(null!==(t=w.data)&&void 0!==t?t:null),p[x].push(null!==(n=w.template)&&void 0!==n?n:null),m[x].push(null!==(r=w.formula)&&void 0!==r?r:null),g[x].push(null!==(s=w.cellSelect)&&void 0!==s?s:null),y[x].push(null!==(o=w.dataValidation)&&void 0!==o?o:null),S[x].push(null!==(a=w.cellImage)&&void 0!==a?a:null)},t.exceptionInExcel=function(e,t,n,r,s){var o,a=s.styles,i=s.data,l=s.template,c=s.formula,u=s.cellSelect,d=s.dataValidations,p=s.cellImage,h=parseInt(null===(o=e.attributes.getNamedItem("colspan"))||void 0===o?void 0:o.value);if(h>1){var m=r.style.border,f=null===m||void 0===m?void 0:m.colors[1];m.colors[1]=null,n=!0,this.setInfoItem({styles:a,data:i,template:l,formula:c,cellImage:p,cellSelect:u,dataValidations:d,index:t,info:r});for(var g=1;g<h;g++){var v={style:{border:{colors:[null,null,null,null],styles:[null,null,null,null]},cellcolor:""},data:null,template:{},formula:void 0};v.style.border.colors[0]=r.style.border.colors[0],v.style.border.colors[2]=r.style.border.colors[2],v.style.cellcolor=r.style.cellcolor,g===h-1&&(v.style.border.colors[t]=f),this.setInfoItem({styles:a,data:i,template:l,formula:c,cellImage:p,cellSelect:u,dataValidations:d,index:t,info:v})}}return n},t.parseCell=function(e,t,n,r){var s=r.styles,o=r.data,a=r.template,i=r.formula,l=r.cellSelect,c=r.dataValidations,u=r.cellImage;if(e){var d={style:{},data:null,template:{}},m=void 0;this.mSOStyle&&(m=this.cellsStyleMaps[t]&&this.cellsStyleMaps[t][n]),p.Z.run(h.aC.PASTE_ON_PARSE_HTML,"parseHTML",{element:e,style:m,ext:{mSOStyle:this.mSOStyle,noFormula:this.noFormula},info:d}),this.notify("beforeParseCell",e,m,d);var f=!1;"colspan"===(null===m||void 0===m?void 0:m["mso-ignore"])&&(f=this.exceptionInExcel(e,t,f,d,{styles:s,data:o,template:a,formula:i,cellSelect:l,dataValidations:c,cellImage:u})),f||this.setInfoItem({styles:s,data:o,template:a,formula:i,cellImage:u,cellSelect:l,dataValidations:c,index:t,info:d})}else void 0===o[t][n]&&this.setInfoItem({styles:s,data:o,template:a,formula:i,cellImage:u,cellSelect:l,dataValidations:c,index:t,info:{style:null,data:null,template:null,formula:null,cellSelect:null,cellImage:null}})},t.parse=function(e,t){var n=t.isNowrap,r=t.noFormula,s=void 0!==r&&r;this.clearTableInfo(),this.tableDOM=e,this.nowrap=n,this.noFormula=s;for(var o=this.parseSizeInfo(),a=this.getStandardCells(e),i=this.initInfoArrays(),l=i.styles,c=i.data,u=i.template,d=i.formula,p=i.cellImage,h=i.cellSelect,m=i.dataValidations,f=this.parseColumnTypeMetadata(e),g=0,v=o?o.row:0;g<v;g++){var y=a[g];l[g]=l[g]||[],c[g]=c[g]||[],u[g]=u[g]||[],d[g]=d[g]||[],h[g]=h[g]||[],m[g]=m[g]||[],p[g]=p[g]||[];for(var b=0,S=o?o.col:0;b<S;b++){var x=y[b];this.parseCell(x,g,b,{styles:l,data:c,template:u,formula:d,cellImage:p,cellSelect:h,dataValidations:m})}}return this.nowrap=null,{styles:l,data:c,template:u,formula:d,cellSelect:h,cellImage:p,mergeCells:this.mergeCells,size:o,hiddenRowCol:{hiddenRows:o.hiddenRows,hiddenCols:o.hiddenCols},selectType:"",dataValidations:m,columnTypeMetadatas:f}},t.parseColCount=function(e){var t=this.getColGroupDOM(e),n=0;if(t)if(t.getAttribute("span"))n+=parseInt(t.getAttribute("span"));else for(var r=0,s=t.childElementCount;r<s;r++){var a=t.children[r],i=parseInt(a.getAttribute("span"));n+=i||1}else{var l,c,u=this.getTNodeDOM(e),d=u&&Object.entries(u.children).sort((function(e,t){return t[1].children.length-e[1].children.length}));if(u&&(l=d&&d[0][1]||u.firstElementChild),l&&(c=l.firstElementChild),c&&(c.tagName.toLowerCase()==o.TD_NODE||c.tagName.toLowerCase()==o.TH_NODE))for(var p=c;p;){var h=parseInt(p.getAttribute("colspan"));n+=h||1,p=p.nextElementSibling}}return n},t.parseRowCount=function(e){var t=this.getTNodeDOM(e),n=0;return t&&(n=t.childElementCount),n},t.parseColWidthsAndHidden=function(e,t){var n=this.getColGroupDOM(e),r=[];if(n)for(var s=n.getElementsByTagName("col"),o=0;o<s.length;o++){var a=s[o],i=parseInt(a.getAttribute("span"),10),l=parseInt(a.style.width,10),c=isNaN(l),u=d().isMac&&!c?l:parseInt(a.getAttribute("width"),10),p=!!a.getAttribute("hiddenCol");if(isNaN(i))r.push({hidden:p,size:u||null});else for(var h=0;h<i;h++)r.push({hidden:p,size:u})}else{var m,f=this.getTNodeDOM(e);if(f&&(m=f.firstElementChild),!m)return null;var g=m.getElementsByTagName("td");r=Array.from(g&&g.length>0?g:m.getElementsByTagName("th")).map((function(e){var t=!!e.getAttribute("hiddenCol");return null!=e.getAttribute("width")?{hidden:t,size:parseInt(e.getAttribute("width"),10)}:{hidden:t,size:null}}))}return r.length==t?r:null},t.parseRowHeightsAndHidden=function(e,t){var n=this.getTNodeDOM(e);if(null===n||0===t)return null;var r=Array.from(n.getElementsByTagName(o.TR_NODE)).map((function(e){var t,n=!!e.getAttribute("hiddenRow"),r=parseInt(e.getAttribute("height"),10),s=parseInt(e.style.height,10);return isNaN(r)&&isNaN(s),{hidden:n,size:-1!==(null===(t=e.getAttribute("style"))||void 0===t?void 0:t.indexOf("mso-height-source:userset"))?d().isMac?isNaN(s)?r:s:isNaN(r)?s:r:null}}));return r.length==t?r:null},t.parseColumnTypeMetadata=function(e){var t=[],n=this.getColGroupDOM(e);if(n)for(var r=n.getElementsByTagName("col"),s=0;s<r.length;s++){var o=r[s].getAttribute("columnTypeMetadata"),a=null;if(o)try{a=(0,m.F)(JSON.parse(o))}catch(i){}t.push(a)}return t},t.standardizeCellsWithMergeCells=function(e){var t=[],n=[],r=[],s=this.parseSizeInfo();if(s)for(var o=0;o<s.row;o++){n[o]||(n[o]=[]),r[o]||(r[o]=[]);for(var a=e[o],i=0,l=0;i<s.col&&l<a.length;i++)if(void 0===n[o][i]){var c=a[l++];n[o][i]=c;var u=parseInt(c.getAttribute("rowspan"));u=u||1;var d=parseInt(c.getAttribute("colspan"));d=d||1;var p=this.mSOStyle&&this.mSOStyle.getComputedStyle(c)||{};r[o][i]=p;var h=p["mso-ignore"];if(h&&-1!==h.indexOf("colspan")&&(d=0),h&&-1!==h.indexOf("rowspan")&&(u=0),d>1)for(var m=1;m<d;m++){var f=c.cloneNode(!0);f.innerHTML="",n[o][i+m]=f}if(u>1)for(var g=1;g<u;g++){n[o+g]||(n[o+g]=[]);for(var v=0;v<d;v++){var y=c.cloneNode(!0);y.innerHTML="",n[o+g][i+v]=y}}(u>1||d>1)&&t.push({row:o,col:i,rowspan:u,colspan:d}),i+=d-1}}return this.mergeCells=t,this.cellsStyleMaps=r,n},t.getStandardCells=function(e){var t=this.getCells(e),n=this.notify("beforeStandardizeCells",t);return void 0!=n&&(t=n),t},t.getCells=function(e){if(!e)return!this.cells&&this.tableDOM&&(this.cells=this.getCells(this.tableDOM)),this.cells;var t=this.getTNodeDOM(e);if(t){for(var n=t.children,r=[],s=0,a=n?n.length:0;s<a;s++){for(var i=n[s].children,l=[],c=0,u=i?i.length:0;c<u;c++){var d=i[c];(d&&d.tagName.toLowerCase()==o.TD_NODE||d.tagName.toLowerCase()==o.TH_NODE)&&l.push(d)}r.push(l)}return r}},t.getColGroupDOM=function(e){if(e){var t=e.firstElementChild;if(t&&"colgroup"==t.tagName.toLowerCase())return t;for(var n=e.children,r=1;r<n.length;r++)if(n[r]&&"colgroup"==n[r].tagName.toLowerCase())return n[r];return null}return!this.colgroup&&this.tableDOM&&(this.colgroup=this.getColGroupDOM(this.tableDOM)),this.colgroup},t.getTNodeDOM=function(e){if(!e)return null;for(var t=null,n=0;n<e.children.length;n++){var r=e.children[n];if(r&&r.tagName.toLowerCase()===o.THEAD_NODE||r&&r.tagName.toLowerCase()===o.TBODY_NODE)if(t)for(var s=r.children;0<s.length;)t.appendChild(s[0]);else t=r}return t},t.subscribe=function(e,t){if(Array.isArray(t))for(var n=0,r=t.length;n<r;n++)this.subscribe(e,t[n]);var s=this.notificationCenter.get(e);s?s.push(t):(s=[t],this.notificationCenter.set(e,s))},t.notify=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var s=this.notificationCenter.get(e),o=-1,a=s?s.length:0,i=null,l=[],c=1,u=arguments.length;c<u;c++)l.push(arguments[c]);for(;++o<a;){var d=s[o],p=d.apply(this,l);void 0!=p&&(i=p)}return i},e}();f.getSingleton=function(){return g};var g=new f,v=f,y=n("../spread-sheet/src/core/feature/copyPaste/copyPasteShape.ts"),b=n("../spread-sheet/src/core/feature/copyPaste/utils/getDocsType.ts"),S=n("../spread-sheet/src/base/util/url.ts"),x=n("../spread-sheet/src/core/feature/copyPaste/utils/parser.ts"),w=n("../spread-sheet/src/core/feature/copyPaste/lib/parsers/validUrl.ts"),E=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),C=n("../spread-sheet/src/core/feature/copyPaste/lib/parsers/automaticIdentifyLink.ts"),I=n("../packages/model/src/cell/HyperlinkRun.ts"),T=n("../spread-sheet/src/core/feature/copyPaste/utils/onPaste.ts"),_=n("../spread-sheet/src/core/feature/copyPaste/utils/cellFloatImage.ts"),R=n("../spread-sheet/src/base/util/appConfig.ts"),j=function(){function e(){var e=this;this.cacheLinkFn=function(t){e.cacheLink=t}}e.getSingleton=function(){return P};var t=e.prototype;return t.securityCheck=function(e){return e=this.deleteTagByTagName(e,"script"),e=this.deleteTagByTagName(e,"iframe")},t.deleteTagByTagName=function(e,t){if(!e||!t)return e;for(var n,r=e,s=100;s--;){if((n=this.deleteOneTagByTagName(r,t))===r)return n;r=n}return 0==s?"":n},t.deleteOneTagByTagName=function(e,t){if(!t)return e;var n=e.indexOf("<"+t);if(-1!=n){var r=e.indexOf("</"+t);if(-1!=r)return e.substring(0,n)+e.substring(r+t.length+3)}return e},t.parsePasteTableHTML=function(e,t){var n=t.noFormula;return v.getSingleton().parse(e,{isNowrap:!0,noFormula:n})},t.fillRangeItem=function(e,t){var n=t.maxCols;return(0,T.kg)(e,n)},t.cellsToRange=function(e){e.data=this.fillRangeItem(e.data,e),e.styles=this.fillRangeItem(e.styles,e),e.template=this.fillRangeItem(e.template,e),e.formula=this.fillRangeItem(e.formula,e)},t.initResult=function(){return{styles:[],data:[],template:[],formula:[],mergeCells:[],size:null,hiddenRowCol:{hiddenRows:[],hiddenCols:[]},selectType:"",hasRowValue:!1,images:[],maxCols:0,columnTypeMetadatas:[]}},t.parseHTML=function(e){if(!e)return null;if(e=this.securityCheck(e),!(e=this.clipHTML(e)))return null;var t=(new DOMParser).parseFromString(e,"text/html");this.fromApp=b.Z.getApp(t);var n=this.parseSelectType(t);if(t&&t.body){this.styleHTML="";for(var r=t.getElementsByTagName(o.STYLE_NODE),s=0;s<(null===r||void 0===r?void 0:r.length);s++)r[s]&&(this.styleHTML+=r[s].innerHTML);v.getSingleton().setStyleGroup(this.styleHTML);var a=this.initResult();return this.parseNodes(t.body,a),a?(a.containTable&&a.containText&&(this.cellsToRange(a),a.size=null,a.hiddenRowCol=null),a.selectType=n,{table:a,images:a.images,fromApp:this.fromApp,containTable:a.containTable}):null}},t.parseImgIntable=function(e,t,n,r,s){for(var a=[].slice.call(e.rows),i=t.parentNode;i.tagName.toLowerCase()!==o.TD_NODE;)i=i.parentNode;for(var l=i.parentNode;l.tagName.toLowerCase()!==o.TR_NODE;)l=l.parentNode;if(-1===a.indexOf(l)){for(i=i.parentNode;i.tagName.toLowerCase()!==o.TD_NODE;)i=i.parentNode;for(l=i.parentNode;l.tagName.toLowerCase()!==o.TR_NODE;)l=l.parentNode}var c=[].slice.call(l.children),u=parseInt((null===i||void 0===i?void 0:i.getAttribute("colSpan"))||"1",10);return n=0+c.indexOf(i)*u,{imgRow:0+a.indexOf(l),col:n}},t.handleImgElement=function(e){var t=e.totalRows,n=e.tagName,r=e.node,s=e.images,a=Array.from(r.getElementsByTagName("img"));if("img"===n&&(a=[r]),null===a||void 0===a?void 0:a.length)for(var i=0;i<a.length;i++){var l=a[i],c=l.src,u=0,d=0+t,p=d,h=l.style.width?parseInt(l.style.width.replace("px","")):-1,m=l.style.height?parseInt(l.style.height.replace("px","")):-1;if(!l.getAttribute("tencent-sheet-cell-img")&&(0,_.nC)(h,m)){var f=null!==l.attributes.getNamedItem("v:shapes");if(n===o.TABLE_NODE){if("tencent-sheet-float-img"!==l.getAttribute("type"))continue;var g=this.parseImgIntable(r,l,u,d,p);p=g.imgRow,u=g.col}else if(n!==o.IMG_NODE){var v=r.innerText||"";p=d,(v=v.replace(/^\s+|\s+$/g,"")).length>0&&(d+=1)}var y=this.getImageData(l,c,p,u,f);y&&s.push(y)}}},t.makeMap=function(e){for(var t={},n=e.split(","),r=0;r<n.length;r++)t[n[r]]=!0;return t},t.getChildren=function(e){return e?e.childNodes:[]},t.getStyle=function(e){var t=e.style,n=t.fontWeight,r=t.color,s=t.fontFamily,o=t.fontSize,a=t.fontStyle,i=t.textDecoration;return{bold:"bold"===n||"700"===n?"bold":null,fontcolor:r||null,fontfamily:s?(0,x.L1)(s):null,fontsize:o?(0,x.bU)(o):null,italic:a||null,underline:i.indexOf("underline")>-1?"underline":null,strikeline:i.indexOf("line-through")>-1?"strikeline":null}},t.setEnterFormat=function(e){for(var t,n,r,s,o,a,i,l,c,u=0;u<e.styles.length;u++){var d=e.styles[u];if(d)for(var p=0;p<d.length;p++){var h=null===(t=d[p])||void 0===t?void 0:t.textFormatRuns;1===(null===h||void 0===h?void 0:h.length)&&(e.styles[u][p]=Object.assign(Object.assign({},e.styles[u][p]),{bold:null===(r=null===(n=h[p])||void 0===n?void 0:n.format)||void 0===r?void 0:r.bold,fontfamily:null===(o=null===(s=h[p])||void 0===s?void 0:s.format)||void 0===o?void 0:o.fontfamily,fontsize:null===(i=null===(a=h[p])||void 0===a?void 0:a.format)||void 0===i?void 0:i.fontsize,fontcolor:null===(c=null===(l=h[p])||void 0===l?void 0:l.format)||void 0===c?void 0:c.fontcolor}))}}},t.insertNewLine=function(e,t){void 0===t&&(t=!1),(e.hasRowValue||t)&&(e.data.push([""]),e.styles.push([]),e.formula.push([]),e.template.push([]),e.h_align=""),e.hasRowValue=!1},t.mergeTableData=function(e,t){var n=t.styles,r=t.data,s=t.template,o=t.formula,a=t.mergeCells,i=t.size,l=t.hiddenRowCol,c=t.cellSelect,u=t.dataValidations,d=t.columnTypeMetadatas;e.styles=e.styles!==[[]]?e.styles.concat(n):n,e.data=e.data!==[[]]?e.data.concat(r):r,e.template=e.template!==[[]]?e.template.concat(s):s,e.formula=e.formula!==[[]]?e.formula.concat(o):o,e.cellSelect=c,e.columnTypeMetadatas=d,p.Z.getAllMiddleWares({level:h.aC.CELL_PROPS,tableProps:!0}).forEach((function(n){var r=n.desc.tableProps,s=void 0===r?"":r;e[s]=t[s]})),e.size=i,e.hiddenRowCol=l,e.dataValidations=u;var m=a.map((function(t){return Object.assign(Object.assign({},t),{row:Math.max(e.data.length,0)-Math.max(r.length,0)+t.row})}));e.mergeCells=e.mergeCells.concat(m)},t.handleATag=function(e,t){var n=e.getAttribute("href"),r=e.getAttribute("data-sheets-hyperlink"),s=e.getAttribute("data-sheets-hyperlink"),o=void 0,a=[];try{var i=r?JSON.parse(r):void 0;(0,C.a6)(i)&&(o=i)}catch(p){}try{var l=s?JSON.parse(s):void 0;Array.isArray(l)&&l.forEach((function(e){"object"===typeof e&&a.push(I.Z.createInstance(e))}))}catch(p){}var c=e.dataset.tencent_doc_hyperlink_type||"",u=e.innerText;u&&(u=u.trim()),t.hasRowValue=!0;var d=(0,x.eO)(n||u,u,c&&parseInt(c)||(null===o||void 0===o?void 0:o.hyperlinkType),null===o||void 0===o?void 0:o.linkIconStatus,a.length>0?a:void 0);this.cacheLinkFn(d)},t.handleTextTag=function(e,t,n,r){var s,o,a=(null===(s=(n.styles[t]||[])[0])||void 0===s?void 0:s.textFormatRuns)||[],i=(r[t]||[])[0]||"";a.push({startIndex:i.length,format:this.getStyle(e.parentElement)}),n.styles[t]=[{textFormatRuns:a,h_align:n.h_align}],n.hasRowValue=!0,n.containText=!0;var l=(null===(o=e.nodeValue)||void 0===o?void 0:o.trim())||"";(0,w.D)(l)?(n.template[t]=[(0,x.eO)(l,l)],a[a.length-1].format=null):n.template[t]||(n.template[t]=[]),r[t]=[(i||"")+e.nodeValue],"a"===n.parentTag&&this.cacheLink&&(n.template[t]=[this.cacheLink],this.cacheLink=null)},t.parseNodes=function(e,t){for(var n,r=this.makeMap("style,meta,script,title,xml"),s=this.makeMap("a,address,article,applet,aside,audio,blockquote,button,canvas,center,div,dd,del,dir,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,iframe,img,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),a=this.getChildren(e),i=0;i<a.length;i++){var l=t.data||[],c=Math.max(l.length-1,0),u=a[i];if(!r[u.nodeName.toLowerCase()])if(u.nodeType===Node.TEXT_NODE){if(!(null===(n=u.nodeValue)||void 0===n?void 0:n.trim().length))continue;this.handleTextTag(u,c,t,l)}else if(u.nodeType===Node.ELEMENT_NODE){var d=u.nodeName.toLowerCase();if(d===o.IMG_NODE){var p=this.getImageData(u,u.src,c,0,!1);p&&t.images.push(p)}if(d===o.BR_NODE||d===o.HR_NODE){this.insertNewLine(t,!0);continue}if(d===o.A_NODE&&this.handleATag(u,t),d===o.TABLE_NODE){var h=this.parsePasteTableHTML(u,{noFormula:"tencent"!==this.fromApp});this.mergeTableData(t,h),this.handleImgElement({totalRows:c,tagName:o.TABLE_NODE,node:u,images:t.images});var m=h.data[0].length;t.maxCols=Math.max(1,t.maxCols,m),t.containTable=!0,t.hasRowValue=!0;continue}s[d]&&(this.insertNewLine(t),t.h_align=u.style.textAlign,t.parentTag=d),this.parseNodes(u,t)}}},t.domainFromUrl=function(e){var t,n;return(n=e.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im))&&(n=(t=n[1]).match(/^[^\.]+\.(.+\..+)$/))&&(t=n[1]),t},t.getImageData=function(e,t,n,r,s){var o=/^data:image\/(png|gif|jpeg|x-icon|jpg|tiff);base64,.+/i.test(t),a="";if(a=(null===window||void 0===window?void 0:window.devicePixelRatio)>=2?y.Eb:y.tZ,t.match(/^file:\/\/[\/].+(gif|jpg|jpeg|tiff|png)$/i)||t.match(/^[a-zA-Z]:.+(gif|jpg|jpeg|tiff|png)$/i)||s&&t&&!o)return t=a,e.src=t,{isFromHTML:!0,id:"attachment-"+ +new Date+"-"+(0,y.O1)(4),url:t,order:void 0,size:{width:440,height:330},anchor:{row:n,col:r},offset:{x:0,y:0},clipInfo:{clipTop:0,clipLeft:0,clipRight:0,clipBottom:0}};if((0,w.D)(t)||o){var i=[R.Z.getConfig("custom.standaloneDomains.qpic_cn"),R.Z.getConfig("custom.standaloneDomains.picgzc_qpic_cn")].concat((0,S.kq)()),l=this.domainFromUrl(t),c=l&&-1!==i.indexOf(l),u=e.style.width?parseInt(e.style.width.replace("px","")):-1,d=e.style.height?parseInt(e.style.height.replace("px","")):-1,p=0,h=0,m=0,f=0,g=e.dataset.clip;if(g){var v=g.match(/[\d\.]+/g);if(v&&v.length>=4){var b=v.map(Number);p=b[0],h=b[1],m=b[2],f=b[3]}}var x=e.dataset.anchor,E=n,C=r;if(x){var I=x.match(/[\d\.]+/g);if(I&&I.length>=2){var T=I.map(Number);E=T[0],C=T[1]}}var _=e.style.marginLeft?parseInt(e.style.marginLeft.replace("px","")):-1,j=e.style.marginTop?parseInt(e.style.marginTop.replace("px","")):-1;return{isFromHTML:!0,url:t,id:"attachment-"+ +new Date+"-"+(0,y.O1)(4),type:"pic",order:void 0,isOuterUrl:!c,anchor:{row:E,col:C},offset:{x:_,y:j},size:{width:u,height:d},clipInfo:{clipTop:p,clipLeft:f,clipRight:h,clipBottom:m}}}return null},t.parseSelectType=function(e){if(!e)return null;var t=e.getElementsByTagName("table")[0];return t&&t.getAttribute("selectType")},t.clipHTML=function(e){if(!e)return null;function t(e,t,n,r){var s=e.indexOf(t),o=e.lastIndexOf(n);return-1!=s&&-1!=o&&(r?s+=t.length:o+=n.length,e=e.substring(s,o)),e}var n="<html>\r\n<body>\r\n\x3c!--StartFragment--\x3e",r="\x3c!--EndFragment--\x3e\r\n</body>\r\n</html>";return e=t(e,n,r,!0),e=t(e,n="<html",r="</html>",!1)},t.parseHyperLinkRun=function(e){e.querySelector("#isFromOutHyperLinkRun")&&E.default.show({type:"info",message:r.ZP.t("链接失效"),autoClose:!0})},t.getParsedDocument=function(e){return(new DOMParser).parseFromString(e,"text/html")},e}(),P=new j,O=j},"../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/logics/userAction.ts":function(e,t,n){n.d(t,{z:function(){return C},v:function(){return I}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.array.iterator.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=function(e){return Array.isArray(e)&&e.length>0?e[0].map((function(t,n){return e.map((function(e){return e[n]}))})):e},s=n("../spread-sheet/src/core/feature/copyPaste/interfaces.ts"),o=n("../spread-sheet/src/base/util/object.ts"),a=function(e){var t,n=(0,o.clone)(e),a=n.merge,i=n.rowDataUpdate;return n.fromType=s.gN.OUTER,n.merge=(t=a)?r(t).map((function(e,t){return e.map((function(e,t){return e?{w:e.h,h:e.w}:e}))})):t,n.rowDataUpdate=function(e){var t=e.map((function(e){return e.values}));return r(t).map((function(e){return{values:e}}))}(i),n},i=n("../packages/model/src/cell/CellDataSlot.ts"),l=n("../packages/model/src/cell/ExtendedValueType.ts"),c=n("../packages/model/src/cell/ExtendedValue.ts"),u=n("../packages/model/src/cell/CellFormat.ts"),d=function(e){var t=(0,o.clone)(e),n=t.rowDataUpdate;return t.fromType=s.gN.CLEAR_AUTO_PARSE,t.rowDataUpdate=function(e){return e.map((function(e){return e.values})).map((function(e){return{values:e.map((function(e){var t,n=e&&e.getEffectiveValue();if(e&&n&&null!==n.originValue){var r=e.clone();return r.setEffectiveValue(c.Z.createInstance({type:l.Z.STRING,value:n.originValue})),r.setUserEnteredFormat(u.Z.createInstance(Object.assign(Object.assign({},null===(t=r.getUserEnteredFormat())||void 0===t?void 0:t.getOptions()),{numberFormat:{id:49,pattern:"@"}}))),r}return e}))}}))}(n),t},p=n("../spread-sheet/src/core/feature/copyPaste/lib/smartSplit/transformDataSP.ts"),h=n("../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/logics/pasteTypes.ts"),m=h.bX.MERGESTYLES,f=h.bX.ONLYVALUES,g=h.bX.TRANSPOSE,v=h.bX.SMARTSPLIT,y=(h.bX.KEEPDEFAULT,h.bX.CLEARAUTOPARSE),b=(h.bX.TRANS_TO_CELL_PIC,h.bX.TRANS_TO_FLOAT_PIC,function(e){var t=e.pasteData,n=e.type,r=e.smartSplitObj;switch(n){case g:return a(t);case m:return function(e){return Object.assign(e,{merge:null,cellMask:i.i.ALL-(1<<i.Z.SLOT_RICH_TEXT_STYLE_RUN)-(1<<i.Z.SLOT_HYPERLINK_RUN)-(1<<i.Z.SLOT_HYPERLINK),formatMask:0,fromType:s.gN.MERGE_STYLES})}(t);case f:return function(e){var t,n=e.merge;return Object.assign(e,{cellMask:i.i.ALL-(1<<i.Z.SLOT_FORMULA)-(1<<i.Z.SLOT_DATA_VALIDATION_RULE)-(1<<i.Z.SLOT_RICH_TEXT_STYLE_RUN)-(1<<i.Z.SLOT_HYPERLINK)-(1<<i.Z.SLOT_HYPERLINK_TYPE)-(1<<i.Z.SLOT_HYPERLINK_RUN)-(1<<i.Z.SLOT_METADATA)-(1<<i.Z.SLOT_REF_IDS),formatMask:0,merge:n?(t=n,t.map((function(e){return e.map((function(){return!1}))}))):n,fromType:s.gN.ONLYVALUE})}(t);case y:return d(t);case v:return(0,p.ZP)(r);default:return t}}),S=n("../node_modules/lodash/cloneDeep.js"),x=n.n(S),w=n("../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/paste-special-api.ts"),E=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))},C=function(e){var t=e.copyPaste,n=e.pasteData,r=e.pasteRange,s=e.type,o=e.envs,a=e.smartSplitObj,i=n;(null===o||void 0===o?void 0:o.triggeredBySP)&&(i=o.originPasteData||n);var l=s===h.bX.TRANSPOSE?n:i,c=Object.assign({},l);c.rowDataUpdate=l.rowDataUpdate;var u=b({pasteData:c,type:s,smartSplitObj:a}),d=w.Yr.bind({pasteData:x()(u)});t.doPaste({pasteData:x()(u),selectAreaCellRange:r,cb:d,envs:{triggeredBySP:!0,pasteSpecialType:s,originPasteData:i}}),t.copyPasteCache.cancelCopy()},I=function(e){var t=e.copyPaste,n=e.pasteData,r=e.pasteRange,s=e.type,o=e.undoredoStack,a=e.requestApi,i=e.cacheDoneActionsLength,l=e.smartSplitObj,c=e.envs;o.undoStack.length===i?a.undo().then((function(){return E(void 0,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C({copyPaste:t,pasteData:n,pasteRange:r,type:s,smartSplitObj:l,envs:c});case 1:case"end":return e.stop()}}),e)})))})):console.warn("not invalid doneActon length")}},"../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/paste-special-api.ts":function(e,t,n){n.d(t,{V3:function(){return Z},lc:function(){return U},Yr:function(){return M}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.string.trim.js");var r,s=n("../packages/report/src/index.ts"),o=n("../spread-sheet/src/core/feature/copyPaste/interfaces.ts"),a=n("../packages/model/src/embedded/index.ts"),i=n("../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/logics/pasteTypes.ts"),l=n("../node_modules/i18next/dist/esm/i18next.js"),c=n("react"),u=n.n(c),d=n("../node_modules/@tencent/dui/lib/components/Menu/index.js"),p=n("../node_modules/@tencent/dui/lib/components/Divider/index.js");!function(e){e[e.FLOAT_PICTURE=0]="FLOAT_PICTURE",e[e.CELL_PICTURE=1]="CELL_PICTURE",e[e.NORMAL=2]="NORMAL"}(r||(r={}));var h=function(e){var t,s,o,a=e.handleClickItem,c=e.pasteOptionType,h=void 0===c?r.NORMAL:c,m=e.disableTranspose,f=void 0===m||m,g=e.disableSmartSplit,v=void 0===g||g,y=i.bX.KEEPDEFAULT,b=i.bX.MERGESTYLES,S=i.bX.ONLYVALUES,x=i.bX.TRANSPOSE,w=i.bX.SMARTSPLIT,E=i.bX.CLEARAUTOPARSE,C=i.bX.TRANS_TO_CELL_PIC,I=i.bX.TRANS_TO_FLOAT_PIC,T=u().createElement(u().Fragment,null,u().createElement(d.default.Item,{id:y},l.ZP.t("保留源格式")),u().createElement(d.default.Item,{id:b},l.ZP.t("合并格式")),u().createElement(d.default.Item,{id:S},l.ZP.t("仅粘贴值")),u().createElement(d.default.Item,{id:E},l.ZP.t("清除自动识别")),u().createElement(p.default,null),u().createElement(d.default.Item,{id:x,disabled:f},l.ZP.t("转置行列")),(null===(o=null===(s=n.g.CoreSheet)||void 0===s?void 0:s.configurations)||void 0===o?void 0:o.aiAutoColumnEnable)?u().createElement(d.default.Item,{id:w,disabled:v},l.ZP.t("智能分列")):null),_=u().createElement(u().Fragment,null,u().createElement(d.default.Item,{id:C},l.ZP.t("转为单元格图片"))),R=u().createElement(u().Fragment,null,u().createElement(d.default.Item,{id:I},l.ZP.t("转为浮动图片"))),j=((t={})[r.NORMAL]=T,t[r.FLOAT_PICTURE]=_,t[r.CELL_PICTURE]=R,t);return u().createElement(d.default,{onClick:function(e){a(e)},itemStyle:{minWidth:"120px",fontSize:"14px"},selectable:!1,testId:"paste-special-menu-wrapper"},j[h])},m=n("../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"),f=(n("../node_modules/core-js/modules/es.object.assign.js"),n("../spread-sheet/src/core/feature/copyPaste/lib/PasteSpecial/logics/userAction.ts")),g=n("react-dom"),v=n.n(g),y=n("../node_modules/@tencent/dui/lib/components/Dropdown/Dropdown.js"),b=function(){return u().createElement("div",{className:"postpaste-parent",style:{top:"297px",left:"508px"}},u().createElement("div",{id:"post-paste-menu",className:"postpaste-container tx-toolbar-menu-button tx-inline-block","aria-label":l.ZP.t("粘贴格式"),title:"粘贴格式",role:"button","aria-expanded":"false",style:{userSelect:"none"},"aria-haspopup":"true"},u().createElement("div",{className:"tx-toolbar-menu-button-outer-box tx-inline-block"},u().createElement("div",{className:"tx-toolbar-menu-button-inner-box tx-inline-block"},u().createElement("div",{className:"tx-toolbar-menu-button-caption tx-inline-block"},u().createElement("div",{className:"docs-icon tx-inline-block "},u().createElement("div",{className:"docs-icon-img-container tx-docs-icon-img docs-icon-paste","aria-hidden":"true"}," "))),u().createElement("div",{className:"tx-toolbar-menu-button-dropdown postpaste-arrow tx-inline-block"}," ")))))},S=n("../spread-sheet/src/base/event/event.ts"),x=function(e){var t=u().createElement(h,Object.assign({},e));return u().createElement(y.default,{dropContent:t},u().createElement(b,null))},w="paste-special-container",E=function(){function e(e,t,n,r){void 0===n&&(n={}),this.view=e,this.requestApi=t,this.itemOptions=n,this.closeCb=r,this.handleEnterInput=this.close.bind(this),this.canvasView=e.canvas,this.canvasContainer=this.canvasView.mainBoard.element;var s=document.querySelector("#paste-special-container");s||((s=document.createElement("div")).id=w,s.style.position="absolute",s.style.zIndex="5",this.pasteSpecialContainer=s,this.canvasContainer.appendChild(s)),this.registerListener()}var t=e.prototype;return t.close=function(){var e,t;try{null===(e=this.canvasContainer)||void 0===e||e.removeChild(this.pasteSpecialContainer)}catch(r){n.g.log.error("Remove PasteSpecial Element Error - ",r)}this.unregisterListener(),null===(t=this.closeCb)||void 0===t||t.call(this)},t.render=function(){this.resetPosition(),v().render(u().createElement(x,Object.assign({handleClickItem:this.handleClickItem.bind(this)},this.itemOptions)),this.pasteSpecialContainer)},t.registerListener=function(){var e=this,t=this.canvasView,n=t.scale,r=t.normalSelectData,s=t.inputManager,o=t.areaData;this.disposeHandleScroll=o.onUpdateOffset((function(){return e.resetPosition()})),this.disposeHandleScale=n.onScale((function(){return e.resetPosition()})),this.disposeHandleUpdateSelectData=r.onUpdateSelectData((function(){return e.close()})),s.emitter.on(s.EVENT.ENTER_INPUT,this.handleEnterInput),S.ZP.sheetsBar.listen("switchSheetEnd",this.handleEnterInput)},t.unregisterListener=function(){var e=this.canvasView.inputManager;this.disposeHandleScroll.dispose(),this.disposeHandleScale.dispose(),this.disposeHandleUpdateSelectData.dispose(),e.emitter.off(e.EVENT.ENTER_INPUT,this.handleEnterInput),S.ZP.sheetsBar.remove("switchSheetEnd",this.handleEnterInput)},t.resetPosition=function(){var e=this.calPosition(),t=e.top,n=e.left;this.pasteSpecialContainer.style.left=n+"px",this.pasteSpecialContainer.style.top=t+"px"},e}();function C(e,t){var n,r,s=t.rowTop,o=t.rowBottom,a=t.colLeft,i=t.colRight,l=e.canvas.container,c=l.clientWidth,u=l.clientHeight,d=[a,i],p=[s,o],h=p[1]+60<u,m=d[1]+210<c;return h&&m?(n=d[1]+4,r=p[1]):h?(n=d[0],r=p[1]):m?(n=d[1]+4,r=p[0]):(n=d[0]-38-4,r=p[0]),{top:r,left:n}}function I(e){var t=e.canvas,n=e.getSelection().rangeSelections[0].clone();return C(e,{rowTop:t.areaData.getDisplayViewTopByRow(n.startRowIndex),rowBottom:t.areaData.getDisplayViewBottomByRow(n.endRowIndex),colLeft:t.areaData.getDisplayViewLeftByCol(n.startColIndex),colRight:t.areaData.getDisplayViewRightByCol(n.endColIndex)})}var T=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))},_=function(e){function t(t,n,r,s,o,a,i,l){var c;return(c=e.call(this,t,n,r,l)||this).featureCopyPaste=o,c.undoRedoStack=a,c.envs=i,c.pasteCacheData=Object.assign(Object.assign({},s),{smartSplitObj:[],cacheDoneActionsLength:c.undoRedoStack.undoStack.length}),c.render(),c}(0,m.Z)(t,e);var r=t.prototype;return r.setSmartSplitObj=function(e,t){var r;(null===(r=n.g.CoreSheet.configurations)||void 0===r?void 0:r.aiAutoColumnEnable)&&(this.pasteCacheData.smartSplitObj=e,this.itemOptions.disableSmartSplit=!1,this.smartSplitCb=t)},r.triggerSmartSplit=function(){return T(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.pasteCacheData,n=t.pasteData,r=t.pasteRange,s=t.cacheDoneActionsLength,o=t.smartSplitObj,(0,f.v)({copyPaste:this.featureCopyPaste,pasteData:n,pasteRange:r,type:i.bX.SMARTSPLIT,requestApi:this.requestApi,undoredoStack:this.undoRedoStack,cacheDoneActionsLength:s,smartSplitObj:o,envs:this.envs});case 2:case"end":return e.stop()}}),e,this)})))},r.handleClickItem=function(e){var t;return T(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,o,a,l,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=this.pasteCacheData,o=r.pasteData,a=r.pasteRange,l=r.cacheDoneActionsLength,c=r.smartSplitObj,(0,f.v)({copyPaste:this.featureCopyPaste,pasteData:o,pasteRange:a,type:e,requestApi:this.requestApi,undoredoStack:this.undoRedoStack,cacheDoneActionsLength:l,smartSplitObj:c,envs:this.envs}),this.canvasView.inputManager.switchFocusDomNode(),e===i.bX.SMARTSPLIT&&this.smartSplitCb&&(this.smartSplitCb(),s.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"clk_menu"}),(null===(t=this.envs)||void 0===t?void 0:t.pasteSpecialType)&&this.envs.pasteSpecialType!==i.bX.SMARTSPLIT&&s.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"clk_menu_indirect"}));case 4:case"end":return n.stop()}}),n,this)})))},r.calPosition=function(){return I(this.view)},t}(E),R=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),j=n("../node_modules/@tencent/dui/lib/components/Modal/index.js"),P=n("../packages/model/src/embedded/EmbeddedObjectType.ts"),O=n("../spread-sheet/src/core/feature/copyPaste/copyPasteShape.ts"),D=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))},N=function(e){function t(t,n,r,s,o,a,i){var l;if((l=e.call(this,t,n,a,i)||this).spreadSheet=r,l.pastedShapeID=s,l.toolFunctions=o,l.canUseUndo=!1,l.canUseRedo=!1,l.canvasView.shapeEdit){var c=l.canvasView.shapeEdit.edit,u=c.EVENT,d=c.emitter;l.shapeActiveHandler=l.close.bind((0,R.Z)(l)),d.on(u.SHOW,l.shapeActiveHandler)}return l.render(),l}(0,m.Z)(t,e);var n=t.prototype;return n.close=function(){if(e.prototype.close.call(this),this.canvasView.shapeEdit){var t=this.canvasView.shapeEdit.edit,n=t.EVENT,r=t.emitter;this.shapeActiveHandler&&r.off(n.SHOW,this.shapeActiveHandler)}},n.handleClickItem=function(e){return D(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next=t.t0===i.bX.TRANS_TO_CELL_PIC?3:t.t0===i.bX.TRANS_TO_FLOAT_PIC?5:7;break;case 3:return this.transFloatImgToCellImg(),t.abrupt("break",7);case 5:return this.convertToFloatImg(),t.abrupt("break",7);case 7:case"end":return t.stop()}}),t,this)})))},n.calPosition=function(){var e=this.spreadSheet.activeSheet.imageManager.getImage(this.pastedShapeID);return e?e.type===P.Z.CELL_IMAGE?I(this.view):function(e,t){var n=t.anchorCell,r=t.widthPixels,s=t.heightPixels,o=t.offsetXpixels,a=t.offsetYpixels,i=n.rowIndex,l=n.colIndex,c=e.canvas.areaData.getDisplayViewTopByRow(i)+a,u=e.canvas.areaData.getDisplayViewLeftByCol(l)+o;return C(e,{rowTop:c,rowBottom:c+s,colLeft:u,colRight:u+r})}(this.view,e.position.overlayPosition):{top:0,left:0}},n.tryUseUndoRedo=function(e){return this.canUseUndo?(this.requestApi.undo().then((function(){return null===e||void 0===e?void 0:e()})),this.togglePicOption(),!0):!!this.canUseRedo&&(this.requestApi.redo().then((function(){return null===e||void 0===e?void 0:e()})),this.togglePicOption(),!0)},n.togglePicOption=function(){this.canUseUndo=!this.canUseUndo,this.canUseRedo=!this.canUseRedo,this.itemOptions.pasteOptionType=this.itemOptions.pasteOptionType===r.FLOAT_PICTURE?r.CELL_PICTURE:r.FLOAT_PICTURE,this.render()},n.transFloatImgToCellImg=function(){var e,t,n=this,r=this.toolFunctions,s=r.getFloatImgRelatedCell,o=r.getCellDataAtPosition,a=s(this.pastedShapeID);if(a){var i=a.rowIndex,c=a.colIndex;(0,O.w4)()&&(null===(t=null===(e=o(i,c))||void 0===e?void 0:e.getEffectiveValue())||void 0===t?void 0:t.value)?j.Modal.confirm({title:l.ZP.t("粘贴为单元格图片"),content:l.ZP.t("粘贴单元格图片将会覆盖单元格已有内容，继续粘贴吗？"),onOk:function(){n.convertToCellImg()}}):this.convertToCellImg()}},n.convertToCellImg=function(){return D(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.ZP.setDefaultOuterPicturePasteType(O.OO.CELL),!this.tryUseUndoRedo()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.requestApi.convertImageType(this.pastedShapeID,P.Z.CELL_IMAGE);case 5:this.itemOptions.pasteOptionType=r.CELL_PICTURE,this.canUseUndo=!0,this.render();case 8:case"end":return e.stop()}}),e,this)})))},n.convertToFloatImg=function(){return D(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.ZP.setDefaultOuterPicturePasteType(O.OO.FLOAT),!this.tryUseUndoRedo()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.requestApi.convertImageType(this.pastedShapeID,P.Z.IMAGE);case 5:this.itemOptions.pasteOptionType=r.FLOAT_PICTURE,this.canUseUndo=!0,this.render();case 8:case"end":return e.stop()}}),e,this)})))},t}(E),L=n("../spread-sheet/src/core/feature/copyPaste/lib/smartSplit/SmartSplit.ts"),k=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))},A=null,M=function(e){var t,n,r=e.hotInstance,a=e.active,l=e.pasteType,c=e.toCheckSmartSplit,u=e.envs,d=e.isNewSheet;return k(this,void 0,void 0,regeneratorRuntime.mark((function e(){var p,h,m,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=this.stateBefore,h=this.pasteData,l!==o.lb.cut){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,F({hotInstance:r,active:a,pasteType:l,envs:u,stateBefore:p,pasteData:h});case 5:m=A=e.sent,f=(null===(n=null===(t=r.feature)||void 0===t?void 0:t.copyPaste)||void 0===n?void 0:n.value)||"",(null===u||void 0===u?void 0:u.triggeredBySP)&&(0,L.ep)()?u.pasteSpecialType!==i.bX.SMARTSPLIT&&m.setSmartSplitObj((0,L.ep)(),(function(){})):(null===u||void 0===u?void 0:u.triggeredBySP)||!0!==c||""===f.trim()?(0,L.BF)(null):((0,L.fG)(f,(function(e){m.setSmartSplitObj(e,(function(){(0,L.yC)()})),(0,L.PQ)(r,(function(){m.triggerSmartSplit(),d&&s.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"new_sheet_trigger"})}),A)})),s.ZP.tdwReport({opername:"doc_excel_editor",module:"excel_paste_split",action:"active_trigger"}));case 8:case"end":return e.stop()}}),e,this)})))};function F(e){var t=e.hotInstance,n=e.active,r=e.envs,s=e.stateBefore,o=e.pasteData;return k(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,i,l,c,u,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.view,i=t.requestApi,l=t.undoredoStack,c=a.getSelection().rangeSelections[0],e.next=4,t.feature.getCopyPaste();case 4:return u=e.sent,d={disableTranspose:c.startColIndex===c.endColIndex&&c.startRowIndex===c.endRowIndex},p={stateBefore:s,pasteData:o,pasteRange:n},A&&A.close(),e.abrupt("return",new _(a,i,d,p,u,l,r,(function(){A=null})));case 9:case"end":return e.stop()}}),e)})))}function U(e,t,n,s){e.canvas.shapeEdit;var o=n.activeSheet.imageManager.getImage(s);if(o){var i={pasteOptionType:o.type===a.EMBEDDED_OBJECT_TYPE.CELL_IMAGE?r.CELL_PICTURE:r.FLOAT_PICTURE},l={getActiveCell:function(){return e.getSelection().activeCell},getCellDataAtPosition:function(e,t){return n.activeSheet.getCellDataAtPosition(e,t)},getFloatImgRelatedCell:function(e){var t,r=n.activeSheet.imageManager.getImage(e);if(r){var s=r.position.overlayPosition.anchorCell,o=s.rowIndex,a=s.colIndex,i=null===(t=n.activeSheet.getCellDataAtPosition(o,a))||void 0===t?void 0:t.getMergeReference();return i&&(o=i.startRowIndex,a=i.startColIndex),{rowIndex:o,colIndex:a}}return null}};A&&A.close(),A=new N(e,t,n,o.id,l,i,(function(){A=null}))}}var Z=function(){A&&A.close()}},"../spread-sheet/src/core/feature/copyPaste/utils/copy-paste-type-and-source.ts":function(e,t,n){n.d(t,{$u:function(){return u},Xc:function(){return p},Xx:function(){return c},p7:function(){return m},qD:function(){return d},q_:function(){return h},qd:function(){return l},vy:function(){return f}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.match.js"),n("../node_modules/core-js/modules/es.regexp.constructor.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js");var r=n("../spread-sheet/src/core/feature/copyPaste/interfaces.ts"),s=n("../spread-sheet/src/base/util/url.ts"),o=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),a=n.n(o),i=n("../spread-sheet/src/core/feature/copyPaste/clipboardCopy.ui.ts"),l=function(e,t){var n=!e&&t&&t.clipboardData&&t.clipboardData.getData("text/json");return n},c=function(e,t){var n=!e&&t&&t.length>=1;return n},u=function(e,t){var n=!e&&t&&t.length>0;return n},d=function(e,t){var n=!e&&t;return n},p=function(e,t,n){var r=!e&&!t&&(null===n||void 0===n?void 0:n.length);return r},h=function(e,t){var n=!1;if(t&&t.length>0){var s=void 0;e===r.GI.table&&(s=t.match(/cutShapeIDs[\S]+cutShapeIDs/)),void 0!==s&&null!==s&&(n=!0)}return n},m=function(e,t){var n=new RegExp('<a href="https://'+(0,s.Fb)()+".*?>");return e&&n.test(e)||""===e&&(0,s.KM)(t)},f=function(e){var t=e.valid,n=(0,i.jZ)();return a().isPCTencentDocsClient&&"function"===typeof external.getClipboardType?g(e):n===r.GI.table&&t||n===r.GI.shapes||n===r.GI.input?r.P0.CACHE:r.P0.NONE},g=function(e){var t=e.valid,n=!1,s=external.getClipboardType();if(s&&s.length>0&&(n=!0),!n)return e.valid=!1,r.P0.NONE;if(t){var o=e.clipboardCopyData.html;return-1===s.indexOf(r.Gu.HTML)?r.P0.CLIPBOARD:o===external.getClipboardData(r.Gu.HTML)?r.P0.CACHE:r.P0.CLIPBOARD}return r.P0.CLIPBOARD}},"../spread-sheet/src/core/feature/copyPaste/utils/handle-clipboard-string.ts":function(e,t,n){n.d(t,{Cg:function(){return l},Wf:function(){return i},my:function(){return a}}),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/es.array.slice.js");var r=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),s=n.n(r),o=n("../spread-sheet/src/core/feature/copyPaste/lib/ParsePasteHTML.ts"),a=function(e){var t="";return e&&"undefined"!==typeof e.clipboardData?t=e.clipboardData.getData("text/plain"):"undefined"===typeof ClipboardEvent&&"undefined"!==typeof n.g.clipboardData&&(t=n.g.clipboardData.getData("Text")),t},i=function(e){var t,n=e;-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&(""===(t=n.split("\n"))[t.length-1]&&t.pop(),n=t.join("\n")),t=n.split("\n");for(var r=0;r<t.length-1;r++){var s=t[r].length;13===t[r].slice(s-1).charCodeAt(0)&&(t[r]=t[r].slice(0,s-1))}return n=t.join("\n")},l=function(e,t,n){var r,a=null===(r=null===n||void 0===n?void 0:n.clipboardData)||void 0===r?void 0:r.getData("text/link-preview");if(s().isChromiumEdge&&a&&"text/html;content=titled-hyperlink"===JSON.parse(a).preferred_format)return"";var i=o.Z.getSingleton().getParsedDocument(e).body,l=i.childElementCount,c=i.firstElementChild;if(1===l&&c&&"a"===c.tagName.toLowerCase()){var u=c.getAttribute("href"),d=c.textContent;if(t===u&&t!==d)return""}return e}},"../spread-sheet/src/core/feature/copyPaste/utils/loading.ts":function(e,t,n){n.d(t,{EB:function(){return i},Qj:function(){return l},jq:function(){return u},kl:function(){return c}});var r=n("../spread-sheet/src/core/ui/loading/index.ts"),s=n("../spread-sheet/src/base/util/timer.ts"),o=n("../spread-sheet/src/core/feature/copyPaste/utils/url.ts"),a=n("../spread-sheet/src/core/feature/copyPaste/utils/copy-paste-type-and-source.ts"),i=function(e){var t=e.view.getSelection().activeCell;return{row:t.rowIndex,col:t.colIndex}},l=function(e,t){if(t){t.hide();var n=e.spreadsheet.getActiveSheetId(),s=t.getPositionInfo(),o=s.row,a=s.col;r.ZP.removeInstance(o,a,n)}},c=function(e,t,n){if(t)return n?void s.Z.wait(1e3).run((function(){l(e,t)})):l(e,t)},u=function(e,t,n,r){var s=new Date;return e&&e.length>15e3||s.getTime()-t.getTime()>20||n||(0,o.kb)(e)||(0,a.p7)(e,r)}},"../spread-sheet/src/core/feature/copyPaste/utils/select-range.ts":function(e,t,n){n.d(t,{M:function(){return s},f:function(){return o}});var r=n("../packages/model/src/range/index.ts"),s=function(e,t,n,s){var o=e.view.getSelectionWithGridRanges(),a=e.spreadsheet.activeSheet;n&&(o=e.view.getSelectionWithGridRanges(s));var i=t?o.rangeSelections[0]:o.rangeSelections[o.rangeSelections.length-1];return{xRange:[i.startColIndex===r.DEFAULT_DIMENSION_INDEX?0:i.startColIndex,i.endColIndex===r.DEFAULT_DIMENSION_INDEX?a.getColCount()-1:i.endColIndex],yRange:[i.startRowIndex===r.DEFAULT_DIMENSION_INDEX?0:i.startRowIndex,i.endRowIndex===r.DEFAULT_DIMENSION_INDEX?a.getRowCount()-1:i.endRowIndex]}},o=function(e){return"undefined"===typeof e.startRowIndex||"undefined"===typeof e.startColIndex||"undefined"===typeof e.endRowIndex||"undefined"===typeof e.endColIndex}},"../spread-sheet/src/core/view/level-2/shape-upload/ShapeUpload.ts":function(e,t,n){n.r(t),n.d(t,{ImageUploadErrorType:function(){return s},ShapeType:function(){return r},VIP_IMG_SIZE_LIMIT:function(){return I},default:function(){return T}}),n("../node_modules/regenerator-runtime/runtime.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.promise.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.object.assign.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.split.js"),n("../node_modules/core-js/modules/es.array.includes.js");var r,s,o=n("../node_modules/i18next/dist/esm/i18next.js"),a=n("./node_modules/axios/index.js"),i=n.n(a),l=n("../node_modules/qs/lib/index.js"),c=n.n(l),u=n("../node_modules/@tencent/docs-user-agent/dist/index.js"),d=n.n(u),p=n("../packages/report/src/index.ts"),h=n("../node_modules/@tencent/image-components/dist/index.es2015.js"),m=n("../spread-sheet/src/base/util/timer.ts"),f=n("../spread-sheet/src/base/event/event.ts"),g=n("../spread-sheet/src/core/ui/loading/index.ts"),v=n("../spread-sheet/src/core/ui/toast/toast.tsx"),y=n("../spread-sheet/src/core/data/configService/spreadConfig.ts"),b=n("../spread-sheet/src/core/view/level-2/shape-upload/utils.ts"),S=n("../node_modules/@tencent/dui/lib/components/Snackbar/index.js"),x=(n("../spread-sheet/src/base/util/domain-config.ts"),n("../spread-sheet/src/base/util/appConfig.ts")),w=n("../spread-sheet/src/external/check-slr/sc-lazy-loader.ts"),E=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function a(e){try{l(r.next(e))}catch(t){o(t)}}function i(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))},C=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n},I=20971520;!function(e){e[e.CELL=0]="CELL",e[e.FLOAT=1]="FLOAT"}(r||(r={})),function(e){e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.FILESIZE_EXCEEDED_ERROR=2]="FILESIZE_EXCEEDED_ERROR",e[e.UNKNOWN_ERROR=3]="UNKNOWN_ERROR"}(s||(s={}));var T=function(){function e(e){var t=this,n=e.modifyShapeBroker,r=e.spreadsheet;this.canUploadImage=function(e){return t.isAvailableImageType(e.type)&&e.size<=I},this.modifyShapeBroker=n,this.spreadsheet=r,this.imageSelector=new h.m6({skipConfig:!0})}var t=e.prototype;return t.uploadImageFromDropFile=function(e,t,n,r){return E(this,void 0,void 0,regeneratorRuntime.mark((function s(){var o,a,i,l;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(this.canUploadImage(e)){s.next=2;break}return s.abrupt("return",!1);case 2:return o=this.spreadsheet.parent,null===(a=g.ZP.createInstance(o.event,o.view.canvas,n,r,t))||void 0===a||a.show(),s.next=7,this.handleImage(e);case 7:if(null!==(i=s.sent)){s.next=10;break}return s.abrupt("return",!1);case 10:return l=Object.assign(i,{x:r,y:n,sheetId:t}),(null===a||void 0===a?void 0:a.isValid)&&this.modifyShapeBroker.insertImage(l,!0),null===a||void 0===a||a.cancelUpload(),g.ZP.removeInstance(n,r,t),s.abrupt("return",!0);case 15:case"end":return s.stop()}}),s,this)})))},t.insertShape=function(e,t,n,s,o){return void 0===s&&(s={}),E(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,l,c,u,d,p,h,m;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return l=(i=s).capture,c=void 0!==l&&l,u=i.callback,a.prev=1,a.next=4,this.uploadImage(c,u);case 4:if(null!==(d=a.sent)){a.next=7;break}return a.abrupt("return");case 7:p=Object.assign(Object.assign({},d),{x:n,y:t,sheetId:e}),o===r.CELL?(h=this.spreadsheet.getActiveSheetId(),(null===(m=g.ZP.getInstance(t,n,h))||void 0===m?void 0:m.isValid)&&this.modifyShapeBroker.insertImage(p,!0),g.ZP.removeInstance(t,n,h)):this.modifyShapeBroker.insertImage(p),a.next=14;break;case 11:throw a.prev=11,a.t0=a.catch(1),a.t0;case 14:case"end":return a.stop()}}),a,this,[[1,11]])})))},t.handleImage=function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,s,o,a,i,l,c,u,d,p,h,g,v,y,S,x;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,b.ki)(),this.handleOverMaxSizeError(e),s=e.size,o=0,a=0,i=0,l=Date.now(),t.prev=7,t.next=10,(0,b.Gp)(e);case 10:return c=t.sent,u=c.file,d=C(c,["file"]),i=u.size,t.next=16,this.uploadBlobFileRequest(u);case 16:p=t.sent,h=p.response,g=p.path,v=h.data.url,this.handleEmptyUrlError(v),y=d.width,o=void 0===y?400:y,S=d.height,a=void 0===S?400:S,x=this.shrinkPictureSize(o,a),o=x.width,a=x.height;try{m.Z.wait(500).run((function(){f.ZP.toolBar.trigger("upload-image-successed",{url:v,key:g,id:r,replaceHolder:!0})})),_(o,a,s,i,l,"updown_succe")}catch(w){}return t.abrupt("return",{url:v,id:r,width:o,height:a});case 32:throw t.prev=32,t.t0=t.catch(7),n.g.log.error(t.t0.message),this.showErrorNotice(t.t0.message),_(o,a,s,i,l,"updown_fail"),t.t0;case 38:case"end":return t.stop()}}),t,this,[[7,32]])})))},t.handleImageLink=function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,s,a,l,u,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=1,t.next=4,i().post("/v1/image/trans_outer",c().stringify({url:e,globalPadId:y.q.getConfig("globalPadId")}));case 4:if(n=t.sent,r=n.data,s=r.url,a=r.width,l=r.height,u=r.retcode,d=r.file_size,90043!==u){t.next=9;break}throw S.default.show({type:"error",message:o.ZP.t("粘贴异常，请下载图片到本地再上传。"),autoClose:!1,closable:!0,action:o.ZP.t("好的")}),{fileSize:-1};case 9:if(s){t.next=11;break}throw{fileSize:-1};case 11:if(!(d>I)){t.next=13;break}throw{fileSize:d};case 13:return t.abrupt("return",{url:s,id:(0,b.ki)(),width:a,height:l});case 16:throw t.prev=16,t.t0=t.catch(1),{fileSize:t.t0.fileSize||-1};case 19:case"end":return t.stop()}}),t,null,[[1,16]])})))},t.handleEmptyUrlError=function(e){if(!e)throw p.ZP.monitor(34609503),Error("Uploaded image has no URL!")},t.uploadBlobFileRequest=function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="/ep/api/attach_local?globalPadId="+y.q.getConfig("globalPadId"),r=x.Z.getConfig("runtime.domainName")+"_"+y.q.getConfig("padId")+"_"+y.q.getConfig("userId")+"_"+Date.now(),(s=new FormData).append("file",e),t.next=6,i().post(n,s,{responseType:"json"});case 6:return o=t.sent,t.abrupt("return",{response:o,path:r});case 8:case"end":return t.stop()}}),t)})))},t.handleOverMaxSizeError=function(e){if(e.size>I)throw(0,v.showToast)(o.ZP.t("请选择20M以内的图片插入"),void 0,{toolToastCloseTime:5e3}),Error("File too large")},t.shrinkPictureSize=function(e,t){var n=e,r=t,s=e/t;return e>t?e>400&&(r=(n=400)/s):t>400&&(n=(r=400)*s),{width:n,height:r}},t.chooseImageFromWeWork=function(){var e;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(e=window.tdocs)||void 0===e?void 0:e.chooseImage({max_count:1});case 2:return n=t.sent,r=n.imgList[0],t.abrupt("return",{url:r.url,id:(0,b.ki)(),width:r.width,height:r.height});case 5:case"end":return t.stop()}}),t)})))},t.openCamera=function(){var e;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(e=window.tdocs)||void 0===e?void 0:e.openCamera();case 2:return n=t.sent,t.abrupt("return",{url:n.url,width:n.width,height:n.height,id:(0,b.ki)()});case 4:case"end":return t.stop()}}),t)})))},t.uploadImageFromWeWork=function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var s,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=null,a=!1,r.prev=2,!e){r.next=9;break}return r.next=6,this.openCamera().catch((function(e){throw JSON.stringify(e).indexOf("cancel")>-1||(0,v.showToast)(o.ZP.t("打开相机失败，请重试。"),void 0,{toolToastCloseTime:3e3}),a=!0,e}));case 6:s=r.sent,r.next=12;break;case 9:return r.next=11,this.chooseImageFromWeWork().catch((function(e){throw a=!0,e}));case 11:s=r.sent;case 12:r.next=17;break;case 14:r.prev=14,r.t0=r.catch(2),n.g.log.error(r.t0);case 17:return r.prev=17,a||s||null===t||void 0===t||t("start"),r.finish(17);case 20:return r.abrupt("return",s);case 21:case"end":return r.stop()}}),r,this,[[2,14,17,20]])})))},t.uploadImageH5=function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,s,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!d().isAndroid||!d().isWeChat){n.next=6;break}return n.next=3,this.selectImageMobile(e);case 3:r=n.sent,n.next=21;break;case 6:if(!e||!d().isMobile){n.next=15;break}return n.next=9,(0,w.e_)();case 9:return s=n.sent,n.next=12,s.pickImageFromCamera();case 12:r=n.sent,n.next=21;break;case 15:return n.next=17,(0,w.e_)();case 17:return a=n.sent,n.next=20,a.pickImageFromFile();case 20:r=n.sent;case 21:if(!(r.size>I)){n.next=24;break}return(0,v.showToast)(o.ZP.t("请选择20M以内的图片插入"),void 0,{toolToastCloseTime:5e3}),n.abrupt("return",null);case 24:if(0!==r.size){n.next=26;break}return n.abrupt("return",null);case 26:return null===t||void 0===t||t("start"),n.next=29,this.handleImage(r);case 29:return n.abrupt("return",n.sent);case 30:case"end":return n.stop()}}),n,this)})))},t.uploadImage=function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,r.next=7;break;case 4:case 9:return r.abrupt("return",r.sent);case 7:return r.next=9,this.uploadImageH5(e,t);case 10:r.next=21;break;case 12:if(r.prev=12,r.t0=r.catch(0),1!==(null===r.t0||void 0===r.t0?void 0:r.t0.retCode)){r.next=17;break}return S.default.show({message:o.ZP.t("无"+(e?"相机":"相册")+"权限，请在系统设置开启。"),autoClose:!0,duration:3e3}),r.abrupt("return",null);case 17:if(4!==(null===r.t0||void 0===r.t0?void 0:r.t0.retCode)){r.next=19;break}return r.abrupt("return",null);case 19:throw n.g.log.error(r.t0),Error("uploadImage unknown error");case 21:return r.prev=21,null===t||void 0===t||t("end"),r.finish(21);case 24:case"end":return r.stop()}}),r,this,[[0,12,21,24]])})))},t.selectImageMobile=function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){n.imageSelector.selectLocalImageFile({maxCount:1,callback:function(e){(null===e||void 0===e?void 0:e.length)>0?t(e[0]):r({retCode:4})},capture:e,errCallback:r})})));case 1:case"end":return t.stop()}}),t)})))},t.showErrorNotice=function(e){switch(e){case"Network Error":return(0,v.showToast)(o.ZP.t("网络异常，离线编辑中，当前无法上传图片。"),void 0,{showCloseBtn:!0}),s.NETWORK_ERROR;case"Not vip":return s.FILESIZE_EXCEEDED_ERROR;default:return(0,v.showToast)(o.ZP.t("文件错误，请重新上传图片。"),void 0,{toolToastCloseTime:5e3}),s.UNKNOWN_ERROR}},t.isAvailableImageType=function(e){var t=(e||"").split("/")[1]||"";return["png","jpg","jpeg","bmp","gif"].includes(t)},e}();function _(e,t,n,r,s,o){p.ZP.tdwReport({opername:"doc_excel",module:"pic",action:o,ver2:void 0,ver3:void 0,ver4:e,ver5:t,ver6:n,ver7:r,ver8:Date.now()-s})}},"../spread-sheet/src/core/view/level-2/wework-component-ent/utils.ts":function(e,t,n){n.d(t,{CF:function(){return s}}),n("../node_modules/core-js/modules/es.function.name.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.regexp.exec.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../packages/model/src/cell/ref-data/group-card.ts"),n("../packages/model/src/cell/ref-data/staff-card.ts"),n("../packages/model/src/cell/ref-data/schedule.ts"),n("../packages/model/src/cell/ref-data/third-party-app.ts"),n("../packages/model/src/cell/ref-data/mini-app.ts");var r=n("../spread-sheet/src/core/ui/toast/toast.tsx");function s(e){(0,r.showToast)(e,{},{showCloseBtn:!0,toolToastCloseTime:3e3})}}}]),window.jsExecEndTimeStamp=Date.now(),window.cachedPerformanceEntries||(window.cachedPerformanceEntries=[]),window.cachedPerformanceEntries.push({name:"jsExec: js/spread-sheet_src_base_util_decorator_loading-decorator_ts-spread-sheet_src_core_feature_copyP-33f189.2536b335f30cc773d617.js",entryType:"jsExec",startTime:window.jsExecStartTimeStamp,endTime:window.jsExecEndTimeStamp});
//# sourceMappingURL=spread-sheet_src_base_util_decorator_loading-decorator_ts-spread-sheet_src_core_feature_copyP-33f189.2536b335f30cc773d617.js.map